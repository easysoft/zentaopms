var W_=(N,kt,as)=>{if(!kt.has(N))throw TypeError("Cannot "+as)};var hr=(N,kt,as)=>(W_(N,kt,"read from private field"),as?as.call(N):kt.get(N)),Sf=(N,kt,as)=>{if(kt.has(N))throw TypeError("Cannot add the same private member more than once");kt instanceof WeakSet?kt.add(N):kt.set(N,as)},dr=(N,kt,as,xc)=>(W_(N,kt,"write to private field"),xc?xc.call(N,as):kt.set(N,as),as);(function(N,kt){typeof exports=="object"&&typeof module<"u"?kt(exports):typeof define=="function"&&define.amd?define(["exports"],kt):(N=typeof globalThis<"u"?globalThis:N||self,kt(N.zui={}))})(this,function(N){var $n,Dn,l_,c_;"use strict";const kt="",as="",xc="",_T="",bT="",wT="",CT="",xT="",kT="",ST="",TT="",$T="",kc="3.0.0",Ef="production",Af="c3411942b1688e1236fc562fdf3153083e0d8436",js=document,Po=window,Pf=js.documentElement,zn=js.createElement.bind(js),Lf=zn("div"),Sc=zn("table"),lb=zn("tbody"),Rf=zn("tr"),{isArray:Lo,prototype:zf}=Array,{concat:cb,filter:Tc,indexOf:Ff,map:Of,push:hb,slice:jf,some:$c,splice:db}=zf,ub=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,fb=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,pb=/<.+>/,mb=/^\w+$/;function Dc(i,e){const t=gb(e);return!i||!t&&!Fn(e)&&!yt(e)?[]:!t&&fb.test(i)?e.getElementsByClassName(i.slice(1).replace(/\\/g,"")):!t&&mb.test(i)?e.getElementsByTagName(i):e.querySelectorAll(i)}class Ro{constructor(e,t){if(!e)return;if(Ic(e))return e;let s=e;if(Lt(e)){const n=t||js;if(s=ub.test(e)&&Fn(n)?n.getElementById(e.slice(1).replace(/\\/g,"")):pb.test(e)?Kf(e):Ic(n)?n.find(e):Lt(n)?v(n).find(e):Dc(e,n),!s)return}else if(On(e))return this.ready(e);(s.nodeType||s===Po)&&(s=[s]),this.length=s.length;for(let n=0,r=this.length;n<r;n++)this[n]=s[n]}init(e,t){return new Ro(e,t)}}const ce=Ro.prototype,v=ce.init;v.fn=v.prototype=ce,ce.length=0,ce.splice=db,typeof Symbol=="function"&&(ce[Symbol.iterator]=zf[Symbol.iterator]);function Ic(i){return i instanceof Ro}function bi(i){return!!i&&i===i.window}function Fn(i){return!!i&&i.nodeType===9}function gb(i){return!!i&&i.nodeType===11}function yt(i){return!!i&&i.nodeType===1}function yb(i){return!!i&&i.nodeType===3}function vb(i){return typeof i=="boolean"}function On(i){return typeof i=="function"}function Lt(i){return typeof i=="string"}function Ut(i){return i===void 0}function pr(i){return i===null}function Bf(i){return!isNaN(parseFloat(i))&&isFinite(i)}function Mc(i){if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return e===null||e===Object.prototype}v.isWindow=bi,v.isFunction=On,v.isArray=Lo,v.isNumeric=Bf,v.isPlainObject=Mc;function St(i,e,t){if(t){let s=i.length;for(;s--;)if(e.call(i[s],s,i[s])===!1)return i}else if(Mc(i)){const s=Object.keys(i);for(let n=0,r=s.length;n<r;n++){const o=s[n];if(e.call(i[o],o,i[o])===!1)return i}}else for(let s=0,n=i.length;s<n;s++)if(e.call(i[s],s,i[s])===!1)return i;return i}v.each=St,ce.each=function(i){return St(this,i)},ce.empty=function(){return this.each((i,e)=>{for(;e.firstChild;)e.removeChild(e.firstChild)})};function zo(...i){const e=vb(i[0])?i.shift():!1,t=i.shift(),s=i.length;if(!t)return{};if(!s)return zo(e,v,t);for(let n=0;n<s;n++){const r=i[n];for(const o in r)e&&(Lo(r[o])||Mc(r[o]))?((!t[o]||t[o].constructor!==r[o].constructor)&&(t[o]=new r[o].constructor),zo(e,t[o],r[o])):t[o]=r[o]}return t}v.extend=zo,ce.extend=function(i){return zo(ce,i)};const _b=/\S+/g;function Fo(i){return Lt(i)?i.match(_b)||[]:[]}ce.toggleClass=function(i,e){const t=Fo(i),s=!Ut(e);return this.each((n,r)=>{yt(r)&&St(t,(o,a)=>{s?e?r.classList.add(a):r.classList.remove(a):r.classList.toggle(a)})})},ce.addClass=function(i){return this.toggleClass(i,!0)},ce.removeAttr=function(i){const e=Fo(i);return this.each((t,s)=>{yt(s)&&St(e,(n,r)=>{s.removeAttribute(r)})})};function bb(i,e){if(i){if(Lt(i)){if(arguments.length<2){if(!this[0]||!yt(this[0]))return;const t=this[0].getAttribute(i);return pr(t)?void 0:t}return Ut(e)?this:pr(e)?this.removeAttr(i):this.each((t,s)=>{yt(s)&&s.setAttribute(i,e)})}for(const t in i)this.attr(t,i[t]);return this}}ce.attr=bb,ce.removeClass=function(i){return arguments.length?this.toggleClass(i,!1):this.attr("class","")},ce.hasClass=function(i){return!!i&&$c.call(this,e=>yt(e)&&e.classList.contains(i))},ce.get=function(i){return Ut(i)?jf.call(this):(i=Number(i),this[i<0?i+this.length:i])},ce.eq=function(i){return v(this.get(i))},ce.first=function(){return this.eq(0)},ce.last=function(){return this.eq(-1)};function wb(i){return Ut(i)?this.get().map(e=>yt(e)||yb(e)?e.textContent:"").join(""):this.each((e,t)=>{yt(t)&&(t.textContent=i)})}ce.text=wb;function Bs(i,e,t){if(!yt(i))return;const s=Po.getComputedStyle(i,null);return t?s.getPropertyValue(e)||void 0:s[e]||i.style[e]}function Cs(i,e){return parseInt(Bs(i,e),10)||0}function Hf(i,e){return Cs(i,`border${e?"Left":"Top"}Width`)+Cs(i,`padding${e?"Left":"Top"}`)+Cs(i,`padding${e?"Right":"Bottom"}`)+Cs(i,`border${e?"Right":"Bottom"}Width`)}const Nc={};function Cb(i){if(Nc[i])return Nc[i];const e=zn(i);js.body.insertBefore(e,null);const t=Bs(e,"display");return js.body.removeChild(e),Nc[i]=t!=="none"?t:"block"}function Uf(i){return Bs(i,"display")==="none"}function Vf(i,e){const t=i&&(i.matches||i.webkitMatchesSelector||i.msMatchesSelector);return!!t&&!!e&&t.call(i,e)}function Oo(i){return Lt(i)?(e,t)=>Vf(t,i):On(i)?i:Ic(i)?(e,t)=>i.is(t):i?(e,t)=>t===i:()=>!1}ce.filter=function(i){const e=Oo(i);return v(Tc.call(this,(t,s)=>e.call(t,s,t)))};function on(i,e){return e?i.filter(e):i}ce.detach=function(i){return on(this,i).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),this};const xb=/^\s*<(\w+)[^>]*>/,kb=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,Wf={"*":Lf,tr:lb,td:Rf,th:Rf,thead:Sc,tbody:Sc,tfoot:Sc};function Kf(i){if(!Lt(i))return[];if(kb.test(i))return[zn(RegExp.$1)];const e=xb.test(i)&&RegExp.$1,t=Wf[e]||Wf["*"];return t.innerHTML=i,v(t.childNodes).detach().get()}v.parseHTML=Kf,ce.has=function(i){const e=Lt(i)?(t,s)=>Dc(i,s).length:(t,s)=>s.contains(i);return this.filter(e)},ce.not=function(i){const e=Oo(i);return this.filter((t,s)=>(!Lt(i)||yt(s))&&!e.call(s,t,s))};function Hs(i,e,t,s){const n=[],r=On(e),o=s&&Oo(s);for(let a=0,l=i.length;a<l;a++)if(r){const c=e(i[a]);c.length&&hb.apply(n,c)}else{let c=i[a][e];for(;c!=null&&!(s&&o(-1,c));)n.push(c),c=t?c[e]:null}return n}function qf(i){return i.multiple&&i.options?Hs(Tc.call(i.options,e=>e.selected&&!e.disabled&&!e.parentNode.disabled),"value"):i.value||""}function Sb(i){return arguments.length?this.each((e,t)=>{const s=t.multiple&&t.options;if(s||ip.test(t.type)){const n=Lo(i)?Of.call(i,String):pr(i)?[]:[String(i)];s?St(t.options,(r,o)=>{o.selected=n.indexOf(o.value)>=0},!0):t.checked=n.indexOf(t.value)>=0}else t.value=Ut(i)||pr(i)?"":i}):this[0]&&qf(this[0])}ce.val=Sb,ce.is=function(i){const e=Oo(i);return $c.call(this,(t,s)=>e.call(t,s,t))},v.guid=1;function xs(i){return i.length>1?Tc.call(i,(e,t,s)=>Ff.call(s,e)===t):i}v.unique=xs,ce.add=function(i,e){return v(xs(this.get().concat(v(i,e).get())))},ce.children=function(i){return on(v(xs(Hs(this,e=>e.children))),i)},ce.parent=function(i){return on(v(xs(Hs(this,"parentNode"))),i)},ce.index=function(i){const e=i?v(i)[0]:this[0],t=i?this:v(e).parent().children();return Ff.call(t,e)},ce.closest=function(i){const e=this.filter(i);if(e.length)return e;const t=this.parent();return t.length?t.closest(i):e},ce.siblings=function(i){return on(v(xs(Hs(this,e=>v(e).parent().children().not(e)))),i)},ce.find=function(i){return v(xs(Hs(this,e=>Dc(i,e))))};const Tb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,$b=/^$|^module$|\/(java|ecma)script/i,Db=["type","src","nonce","noModule"];function Ib(i,e){const t=v(i);t.filter("script").add(t.find("script")).each((s,n)=>{if($b.test(n.type)&&Pf.contains(n)){const r=zn("script");r.text=n.textContent.replace(Tb,""),St(Db,(o,a)=>{n[a]&&(r[a]=n[a])}),e.head.insertBefore(r,null),e.head.removeChild(r)}})}function Mb(i,e,t,s,n){s?i.insertBefore(e,t?i.firstChild:null):i.nodeName==="HTML"?i.parentNode.replaceChild(e,i):i.parentNode.insertBefore(e,t?i:i.nextSibling),n&&Ib(e,i.ownerDocument)}function an(i,e,t,s,n,r,o,a){return St(i,(l,c)=>{St(v(c),(h,d)=>{St(v(e),(f,m)=>{const y=t?d:m,b=t?m:d,w=t?h:f;Mb(y,w?b.cloneNode(!0):b,s,n,!w)},a)},o)},r),e}ce.after=function(){return an(arguments,this,!1,!1,!1,!0,!0)},ce.append=function(){return an(arguments,this,!1,!1,!0)};function Nb(i){if(!arguments.length)return this[0]&&this[0].innerHTML;if(Ut(i))return this;const e=/<script[\s>]/.test(i);return this.each((t,s)=>{yt(s)&&(e?v(s).empty().append(i):s.innerHTML=i)})}ce.html=Nb,ce.appendTo=function(i){return an(arguments,this,!0,!1,!0)},ce.wrapInner=function(i){return this.each((e,t)=>{const s=v(t),n=s.contents();n.length?n.wrapAll(i):s.append(i)})},ce.before=function(){return an(arguments,this,!1,!0)},ce.wrapAll=function(i){let e=v(i),t=e[0];for(;t.children.length;)t=t.firstElementChild;return this.first().before(e),this.appendTo(t)},ce.wrap=function(i){return this.each((e,t)=>{const s=v(i)[0];v(t).wrapAll(e?s.cloneNode(!0):s)})},ce.insertAfter=function(i){return an(arguments,this,!0,!1,!1,!1,!1,!0)},ce.insertBefore=function(i){return an(arguments,this,!0,!0)},ce.prepend=function(){return an(arguments,this,!1,!0,!0,!0,!0)},ce.prependTo=function(i){return an(arguments,this,!0,!0,!0,!1,!1,!0)},ce.contents=function(){return v(xs(Hs(this,i=>i.tagName==="IFRAME"?[i.contentDocument]:i.tagName==="TEMPLATE"?i.content.childNodes:i.childNodes)))},ce.next=function(i,e,t){return on(v(xs(Hs(this,"nextElementSibling",e,t))),i)},ce.nextAll=function(i){return this.next(i,!0)},ce.nextUntil=function(i,e){return this.next(e,!0,i)},ce.parents=function(i,e){return on(v(xs(Hs(this,"parentElement",!0,e))),i)},ce.parentsUntil=function(i,e){return this.parents(e,i)},ce.prev=function(i,e,t){return on(v(xs(Hs(this,"previousElementSibling",e,t))),i)},ce.prevAll=function(i){return this.prev(i,!0)},ce.prevUntil=function(i,e){return this.prev(e,!0,i)},ce.map=function(i){return v(cb.apply([],Of.call(this,(e,t)=>i.call(e,t,e))))},ce.clone=function(){return this.map((i,e)=>e.cloneNode(!0))},ce.offsetParent=function(){return this.map((i,e)=>{let t=e.offsetParent;for(;t&&Bs(t,"position")==="static";)t=t.offsetParent;return t||Pf})},ce.slice=function(i,e){return v(jf.call(this,i,e))};const Eb=/-([a-z])/g;function Ec(i){return i.replace(Eb,(e,t)=>t.toUpperCase())}ce.ready=function(i){const e=()=>setTimeout(i,0,v);return js.readyState!=="loading"?e():js.addEventListener("DOMContentLoaded",e),this},ce.unwrap=function(){return this.parent().each((i,e)=>{if(e.tagName==="BODY")return;const t=v(e);t.replaceWith(t.children())}),this},ce.offset=function(){const i=this[0];if(!i)return;const e=i.getBoundingClientRect();return{top:e.top+Po.pageYOffset,left:e.left+Po.pageXOffset}},ce.position=function(){const i=this[0];if(!i)return;const e=Bs(i,"position")==="fixed",t=e?i.getBoundingClientRect():this.offset();if(!e){const s=i.ownerDocument;let n=i.offsetParent||s.documentElement;for(;(n===s.body||n===s.documentElement)&&Bs(n,"position")==="static";)n=n.parentNode;if(n!==i&&yt(n)){const r=v(n).offset();t.top-=r.top+Cs(n,"borderTopWidth"),t.left-=r.left+Cs(n,"borderLeftWidth")}}return{top:t.top-Cs(i,"marginTop"),left:t.left-Cs(i,"marginLeft")}};const Gf={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};ce.prop=function(i,e){if(i){if(Lt(i))return i=Gf[i]||i,arguments.length<2?this[0]&&this[0][i]:this.each((t,s)=>{s[i]=e});for(const t in i)this.prop(t,i[t]);return this}},ce.removeProp=function(i){return this.each((e,t)=>{delete t[Gf[i]||i]})};const Ab=/^--/;function Ac(i){return Ab.test(i)}const Pc={},{style:Pb}=Lf,Lb=["webkit","moz","ms"];function Rb(i,e=Ac(i)){if(e)return i;if(!Pc[i]){const t=Ec(i),s=`${t[0].toUpperCase()}${t.slice(1)}`,n=`${t} ${Lb.join(`${s} `)}${s}`.split(" ");St(n,(r,o)=>{if(o in Pb)return Pc[i]=o,!1})}return Pc[i]}const zb={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function Zf(i,e,t=Ac(i)){return!t&&!zb[i]&&Bf(e)?`${e}px`:e}function Fb(i,e){if(Lt(i)){const t=Ac(i);return i=Rb(i,t),arguments.length<2?this[0]&&Bs(this[0],i,t):i?(e=Zf(i,e,t),this.each((s,n)=>{yt(n)&&(t?n.style.setProperty(i,e):n.style[i]=e)})):this}for(const t in i)this.css(t,i[t]);return this}ce.css=Fb;function Yf(i,e){try{return i(e)}catch{return e}}const Ob=/^\s+|\s+$/;function Jf(i,e){const t=i.dataset[e]||i.dataset[Ec(e)];return Ob.test(t)?t:Yf(JSON.parse,t)}function jb(i,e,t){t=Yf(JSON.stringify,t),i.dataset[Ec(e)]=t}function Bb(i,e){if(!i){if(!this[0])return;const t={};for(const s in this[0].dataset)t[s]=Jf(this[0],s);return t}if(Lt(i))return arguments.length<2?this[0]&&Jf(this[0],i):Ut(e)?this:this.each((t,s)=>{jb(s,i,e)});for(const t in i)this.data(t,i[t]);return this}ce.data=Bb;function Xf(i,e){const t=i.documentElement;return Math.max(i.body[`scroll${e}`],t[`scroll${e}`],i.body[`offset${e}`],t[`offset${e}`],t[`client${e}`])}St([!0,!1],(i,e)=>{St(["Width","Height"],(t,s)=>{const n=`${e?"outer":"inner"}${s}`;ce[n]=function(r){if(this[0])return bi(this[0])?e?this[0][`inner${s}`]:this[0].document.documentElement[`client${s}`]:Fn(this[0])?Xf(this[0],s):this[0][`${e?"offset":"client"}${s}`]+(r&&e?Cs(this[0],`margin${t?"Top":"Left"}`)+Cs(this[0],`margin${t?"Bottom":"Right"}`):0)}})}),St(["Width","Height"],(i,e)=>{const t=e.toLowerCase();ce[t]=function(s){if(!this[0])return Ut(s)?void 0:this;if(!arguments.length)return bi(this[0])?this[0].document.documentElement[`client${e}`]:Fn(this[0])?Xf(this[0],e):this[0].getBoundingClientRect()[t]-Hf(this[0],!i);const n=parseInt(s,10);return this.each((r,o)=>{if(!yt(o))return;const a=Bs(o,"boxSizing");o.style[t]=Zf(t,n+(a==="border-box"?Hf(o,!i):0))})}});const Qf="___cd";ce.toggle=function(i){return this.each((e,t)=>{if(!yt(t))return;const s=Uf(t);(Ut(i)?s:i)?(t.style.display=t[Qf]||"",Uf(t)&&(t.style.display=Cb(t.tagName))):s||(t[Qf]=Bs(t,"display"),t.style.display="none")})},ce.hide=function(){return this.toggle(!1)},ce.show=function(){return this.toggle(!0)};const ep="___ce",Lc=".",Rc={focus:"focusin",blur:"focusout"},tp={mouseenter:"mouseover",mouseleave:"mouseout"},Hb=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function zc(i){return tp[i]||Rc[i]||i}function Fc(i){const e=i.split(Lc);return[e[0],e.slice(1).sort()]}ce.trigger=function(i,e){if(Lt(i)){const[s,n]=Fc(i),r=zc(s);if(!r)return this;const o=Hb.test(r)?"MouseEvents":"HTMLEvents";i=js.createEvent(o),i.initEvent(r,!0,!0),i.namespace=n.join(Lc),i.___ot=s}i.___td=e;const t=i.___ot in Rc;return this.each((s,n)=>{t&&On(n[i.___ot])&&(n[`___i${i.type}`]=!0,n[i.___ot](),n[`___i${i.type}`]=!1),n.dispatchEvent(i)})};function sp(i){return i[ep]=i[ep]||{}}function Ub(i,e,t,s,n){const r=sp(i);r[e]=r[e]||[],r[e].push([t,s,n]),i.addEventListener(e,n)}function np(i,e){return!e||!$c.call(e,t=>i.indexOf(t)<0)}function jo(i,e,t,s,n){const r=sp(i);if(e)r[e]&&(r[e]=r[e].filter(([o,a,l])=>{if(n&&l.guid!==n.guid||!np(o,t)||s&&s!==a)return!0;i.removeEventListener(e,l)}));else for(e in r)jo(i,e,t,s,n)}ce.off=function(i,e,t){if(Ut(i))this.each((s,n)=>{!yt(n)&&!Fn(n)&&!bi(n)||jo(n)});else if(Lt(i))On(e)&&(t=e,e=""),St(Fo(i),(s,n)=>{const[r,o]=Fc(n),a=zc(r);this.each((l,c)=>{!yt(c)&&!Fn(c)&&!bi(c)||jo(c,a,o,e,t)})});else for(const s in i)this.off(s,i[s]);return this},ce.remove=function(i){return on(this,i).detach().off(),this},ce.replaceWith=function(i){return this.before(i).remove()},ce.replaceAll=function(i){return v(i).replaceWith(this),this};function Vb(i,e,t,s,n){if(!Lt(i)){for(const r in i)this.on(r,e,t,i[r],n);return this}return Lt(e)||(Ut(e)||pr(e)?e="":Ut(t)?(t=e,e=""):(s=t,t=e,e="")),On(s)||(s=t,t=void 0),s?(St(Fo(i),(r,o)=>{const[a,l]=Fc(o),c=zc(a),h=a in tp,d=a in Rc;c&&this.each((f,m)=>{if(!yt(m)&&!Fn(m)&&!bi(m))return;const y=function(b){if(b.target[`___i${b.type}`])return b.stopImmediatePropagation();if(b.namespace&&!np(l,b.namespace.split(Lc))||!e&&(d&&(b.target!==m||b.___ot===c)||h&&b.relatedTarget&&m.contains(b.relatedTarget)))return;let w=m;if(e){let D=b.target;for(;!Vf(D,e);)if(D===m||(D=D.parentNode,!D))return;w=D}Object.defineProperty(b,"currentTarget",{configurable:!0,get(){return w}}),Object.defineProperty(b,"delegateTarget",{configurable:!0,get(){return m}}),Object.defineProperty(b,"data",{configurable:!0,get(){return t}});const x=s.call(w,b,b.___td);n&&jo(m,c,l,e,y),x===!1&&(b.preventDefault(),b.stopPropagation())};y.guid=s.guid=s.guid||v.guid++,Ub(m,c,l,e,y)})}),this):this}ce.on=Vb;function Wb(i,e,t,s){return this.on(i,e,t,s,!0)}ce.one=Wb;const Kb=/\r?\n/g;function qb(i,e){return`&${encodeURIComponent(i)}=${encodeURIComponent(e.replace(Kb,`\r
`))}`}const Gb=/file|reset|submit|button|image/i,ip=/radio|checkbox/i;ce.serialize=function(){let i="";return this.each((e,t)=>{St(t.elements||[t],(s,n)=>{if(n.disabled||!n.name||n.tagName==="FIELDSET"||Gb.test(n.type)||ip.test(n.type)&&!n.checked)return;const r=qf(n);if(!Ut(r)){const o=Lo(r)?r:[r];St(o,(a,l)=>{i+=qb(n.name,l)})}})}),i.slice(1)},window.$=v;function rp(i,e){if(i==null)return[i,void 0];typeof e=="string"&&(e=e.split("."));const t=e.join(".");let s=i;const n=[s];for(;typeof s=="object"&&s!==null&&e.length;){let r=e.shift(),o;const a=r.indexOf("[");if(a>0&&a<r.length-1&&r.endsWith("]")&&(o=r.substring(a+1,r.length-1),r=r.substring(0,a)),s=s[r],n.push(s),o!==void 0)if(typeof s=="object"&&s!==null)s instanceof Map?s=s.get(o):s=s[o],n.push(s);else throw new Error(`Cannot access property "${r}[${o}]", the full path is "${t}".`)}if(e.length)throw new Error(`Cannot access property with rest path "${e.join(".")}", the full path is "${t}".`);return n}function mr(i,e,t,s){typeof e=="string"&&(e=e.split("."));try{const n=rp(i,e),r=n.length,o=n[r-1];return s&&s(r>1?n[r-2]:i,e[e.length-1]),o===void 0?t:o}catch{return t}}function ls(i,e,t,s){let n;const r=mr(i,e,void 0,o=>{n=o});return typeof r=="function"?r.apply(s??n,t):r}function jn(i){return typeof i=="string"&&i!==""}function $e(i,...e){if(e.length===0)return i;if(e.length===1&&typeof e[0]=="object"&&e[0]){const t=e[0];return Object.keys(t).forEach(s=>{const n=t[s]??"";i=i.replace(new RegExp(`\\{${s}\\}`,"g"),`${n}`)}),i}for(let t=0;t<e.length;t++){const s=e[t]??"";i=i.replace(new RegExp(`\\{${t}\\}`,"g"),`${s}`)}return i}var Oc=(i=>(i[i.B=1]="B",i[i.KB=1024]="KB",i[i.MB=1048576]="MB",i[i.GB=1073741824]="GB",i[i.TB=1099511627776]="TB",i))(Oc||{});function pt(i,e=2,t){return Number.isNaN(i)?"?KB":(t||(i<1024?t="B":i<1048576?t="KB":i<1073741824?t="MB":i<1099511627776?t="GB":t="TB"),(i/Oc[t]).toFixed(e)+t)}const ks=i=>{const e=/^[0-9]*(B|KB|MB|GB|TB)$/;i=i.toUpperCase(),i.endsWith("B")||(i+="B");const t=i.match(e);if(!t)return 0;const s=t[1];return i=i.replace(s,""),Number.parseInt(i,10)*Oc[s]},Us=i=>i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");let jc=(document.documentElement.getAttribute("lang")||"zh_cn").toLowerCase().replace("-","_"),Vs;function op(){return jc}function Zb(i){jc=i.toLowerCase().replace("-","_")}function ap(i,e){Vs||(Vs={}),typeof i=="string"&&(i={[i]:e??{}}),v.extend(!0,Vs,i)}function Pe(i,e,t,s,n,r){Array.isArray(i)?Vs&&i.unshift(Vs):i=Vs?[Vs,i]:[i],typeof t=="string"&&(r=n,n=s,s=t,t=void 0);const o=n||jc;let a;for(const l of i){if(!l)continue;const c=l[o]||l.default;if(!c)continue;const h=r&&l===Vs?`${r}.${e}`:e;if(a=mr(c,h),a!==void 0)break}return a===void 0?s:t?$e(a,...Array.isArray(t)?t:[t]):a}function Yb(i,e,t,s){return Pe(void 0,i,e,t,s)}Pe.addLang=ap,Pe.getLang=Yb,Pe.getCode=op,Pe.setCode=Zb,Pe.map=Vs,ap({zh_cn:{confirm:"确定",save:"保存",cancel:"取消",delete:"删除",reset:"重置",add:"添加",copy:"复制",close:"关闭",edit:"编辑",open:"打开"},zh_tw:{confirm:"確定",save:"儲存",cancel:"取消",delete:"刪除",reset:"重置",add:"添加",Copy:"複製",close:"關閉",edit:"編輯",open:"打開"},en:{confirm:"Confirm",save:"Save",cancel:"Cancel",delete:"Delete",reset:"Reset",add:"Add",copy:"Copy",close:"Close",edit:"Edit",open:"Open"}});function Bn(i,e,t){t!=null&&(Array.isArray(t)?t.forEach(s=>Bn(i,e,s)):!(t instanceof Blob)&&v.isPlainObject(t)?Object.entries(t).forEach(([s,n])=>{Bn(i,`${e}[${s}]`,n)}):i.append(e,t instanceof Blob?t:String(t)))}function gr(i,e){const t=e||new FormData;return i&&(typeof i=="string"&&(i=new URLSearchParams(i)),i instanceof URLSearchParams?i.forEach((s,n)=>{Bn(t,n,s)}):Array.isArray(i)?i.forEach(([s,n])=>{Bn(t,s,n)}):i instanceof FormData?i.forEach((s,n)=>{Bn(t,n,s)}):typeof i=="object"&&i&&Object.entries(i).forEach(([s,n])=>{Bn(t,s,n)})),t}function Xe(){return v.guid++}function yr(i,e){if(i===e)return!1;if(i&&e){const t=typeof i,s=typeof e;if(t!==s)return!0;if(t==="object"&&s==="object"){const n=Array.isArray(i),r=Array.isArray(e);if(n!==r)return!0;if(n&&r){if(i.length!==e.length)return!0;for(let l=0;l<i.length;l++)if(yr(i[l],e[l]))return!0;return!1}const o=Object.keys(i),a=Object.keys(e);if(o.length!==a.length)return!0;for(const l of o)if(yr(i[l],e[l]))return!0;return!1}if(t==="function"&&s==="function")return i.toString()!==e.toString()}return i!==e}class Hn{constructor(e,t){this._compute=e,this._dependencies=t}get value(){return this.compute()}get cache(){return this._lastDependencies?this._value:this.compute()}depends(e){return this._dependencies=e,this}forceCompute(e){return this._lastDependencies=void 0,this.compute(e)}compute(e){e!==void 0&&(this._dependencies=e),e=this._dependencies,typeof e=="function"&&(e=e());const t=this._lastDependencies;return(!t||e.some((s,n)=>s instanceof Hn?s.value!==t[n]:yr(s,t[n])))&&(this._value=this._compute(),this._lastDependencies=e.map(s=>s instanceof Hn?s.cache:s)),this._value}}function Bc(...i){const e=[],t=new Map,s=(n,r)=>{if(Array.isArray(n)&&(r=n[1],n=n[0]),!n.length)return;const o=t.get(n);typeof o=="number"?e[o][1]=!!r:(t.set(n,e.length),e.push([n,!!r]))};return i.forEach(n=>{typeof n=="function"&&(n=n()),Array.isArray(n)?Bc(...n).forEach(s):n&&typeof n=="object"?Object.entries(n).forEach(s):typeof n=="string"&&n.split(" ").forEach(r=>s(r,!0))}),e.sort((n,r)=>(t.get(n[0])||0)-(t.get(r[0])||0))}const K=(...i)=>Bc(...i).reduce((e,[t,s])=>(s&&e.push(t),e),[]).join(" ");v.classes=K,v.fn.setClass=function(i,...e){return this.each((t,s)=>{const n=v(s);i===!0?n.attr("class",K(n.attr("class"),...e)):n.addClass(K(i,...e))})};const wi=new WeakMap;function Bo(i,e,t){const s=wi.has(i),n=s?wi.get(i):{};typeof e=="string"?n[e]=t:e===null?Object.keys(n).forEach(r=>{delete n[r]}):Object.assign(n,e),Object.keys(n).forEach(r=>{n[r]===void 0&&delete n[r]}),Object.keys(n).length?(!s&&i instanceof Element&&Object.assign(n,v(i).dataset(),n),wi.set(i,n)):wi.delete(i)}function vr(i,e,t){let s=wi.get(i)||{};return t&&i instanceof Element&&(s=Object.assign({},v(i).dataset(),s)),e===void 0?s:s[e]}function Jb(i){wi.delete(i)}v.fn.dataset=v.fn.data,v.fn.data=function(...i){const[e,t]=i;return!i.length||i.length===1&&typeof e=="string"?this.length?vr(this[0],e,!0):void 0:this.each((s,n)=>Bo(n,e,t))},v.fn.removeData=function(i=null){return this.each((e,t)=>Bo(t,i))};function ln(i,...e){return i.includes("RAWJS")&&(i=i.split('"RAWJS<').join("").split('>RAWJS"').join("").split("<RAWJS_QUOTE>").join('"').split("<RAWJS_LINE>").join(`
`)),new Function(...e.map(([s])=>s),`return ${i}`)(...e.map(([,s])=>s))}function Ho(i,...e){return i.includes("RAWJS")?ln(i,...e):JSON.parse(i)}function Xb(i){return JSON.stringify(i,(e,t)=>typeof t=="function"?`RAWJS<${t.toString().split('"').join("<RAWJS_QUOTE>").split(`
`).join("<RAWJS_LINE>")}>RAWJS`:t)}function Ci(i,e){const t=v(i),s=t[0];if(!s)return;const{prefix:n,getter:r,evalValue:o,json:a=!0,evalArgs:l=[["_element",s],["_$element",t]]}={prefix:"z-",...typeof e=="string"?{prefix:e}:e},c=Array.isArray(o)?new Set(o):void 0;return Array.from(s.attributes).reduce((h,d)=>{let{name:f}=d;const{value:m}=d;let y=m;if(f.startsWith(n)){if(f=f.slice(n.length).replace(/-([a-z])/g,b=>b[1].toUpperCase()),r)y=r(f,m);else try{o&&(!c||c.has(f))||o===void 0&&m.includes("RAWJS")?y=ln(m,...l):a&&(y=JSON.parse(m))}catch{}h[f]=y}return h},{})}function Hc(i,e,t="z-"){const s=v(i);Object.keys(e).forEach(n=>{let r=e[n];typeof r=="function"&&(r=`RAWJS<${r}>RAWJS`),typeof r!="string"&&(r=JSON.stringify(r)),n=n.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`),s.attr(`${t}${n}`,r)})}function Qb(...i){var t;const e=i.length;if(!e)return Ci(this);if(e===1){const[s]=i;return typeof s=="string"?(t=Ci(this))==null?void 0:t[s]:(v.isPlainObject(s)&&Hc(this,s),this)}return Hc(this,{[i[0]]:i[1]}),this}v.fn.z=Qb,v.fn._attr=v.fn.attr,v.fn.extend({attr(...i){const[e,t]=i;return!i.length||i.length===1&&typeof e=="string"?this._attr.apply(this,i):typeof e=="object"?(e&&Object.keys(e).forEach(s=>{const n=e[s];n===null?this.removeAttr(s):this._attr(s,n)}),this):t===null?this.removeAttr(e):this._attr(e,t)}}),v.Event||(v.Event=(i,e)=>{const[t,...s]=i.split("."),n=new Event(t,{bubbles:!0,cancelable:!0});return n.namespace=s.join("."),n.___ot=t,n.___td=e,n});const Ss=(i,e)=>new Promise(t=>{const s=window.setTimeout(t,i);e&&e(s)}),lp={};v.share=lp;var Uo,tt,cp;N.isValidElement=void 0;var Un,hp,dp,up,fp,Uc,Vc,Wc,_r={},pp=[],ew=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,br=Array.isArray;function Ws(i,e){for(var t in e)i[t]=e[t];return i}function Kc(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function g(i,e,t){var s,n,r,o={};for(r in e)r=="key"?s=e[r]:r=="ref"?n=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?Uo.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return Vo(i,o,s,n,null)}function Vo(i,e,t,s,n){var r={type:i,props:e,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:n??++cp,__i:-1,__u:0};return n==null&&tt.vnode!=null&&tt.vnode(r),r}function ye(){return{current:null}}function cn(i){return i.children}function ae(i,e){this.props=i,this.context=e}function xi(i,e){if(e==null)return i.__?xi(i.__,i.__i+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?xi(i):null}function mp(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return mp(i)}}function gp(i){(!i.__d&&(i.__d=!0)&&Un.push(i)&&!Wo.__r++||hp!=tt.debounceRendering)&&((hp=tt.debounceRendering)||dp)(Wo)}function Wo(){for(var i,e,t,s,n,r,o,a=1;Un.length;)Un.length>a&&Un.sort(up),i=Un.shift(),a=Un.length,i.__d&&(t=void 0,s=void 0,n=(s=(e=i).__v).__e,r=[],o=[],e.__P&&((t=Ws({},s)).__v=s.__v+1,tt.vnode&&tt.vnode(t),qc(e.__P,t,s,e.__n,e.__P.namespaceURI,32&s.__u?[n]:null,r,n??xi(s),!!(32&s.__u),o),t.__v=s.__v,t.__.__k[t.__i]=t,wp(r,t,o),s.__e=s.__=null,t.__e!=n&&mp(t)));Wo.__r=0}function yp(i,e,t,s,n,r,o,a,l,c,h){var d,f,m,y,b,w,x,D=s&&s.__k||pp,I=e.length;for(l=tw(t,e,D,l,I),d=0;d<I;d++)(m=t.__k[d])!=null&&(f=m.__i==-1?_r:D[m.__i]||_r,m.__i=d,w=qc(i,m,f,n,r,o,a,l,c,h),y=m.__e,m.ref&&f.ref!=m.ref&&(f.ref&&Zc(f.ref,null,m),h.push(m.ref,m.__c||y,m)),b==null&&y!=null&&(b=y),(x=!!(4&m.__u))||f.__k===m.__k?l=vp(m,l,i,x):typeof m.type=="function"&&w!==void 0?l=w:y&&(l=y.nextSibling),m.__u&=-7);return t.__e=b,l}function tw(i,e,t,s,n){var r,o,a,l,c,h=t.length,d=h,f=0;for(i.__k=new Array(n),r=0;r<n;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=i.__k[r]=Vo(null,o,null,null,null):br(o)?o=i.__k[r]=Vo(cn,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=i.__k[r]=Vo(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):i.__k[r]=o,l=r+f,o.__=i,o.__b=i.__b+1,a=null,(c=o.__i=sw(o,t,l,d))!=-1&&(d--,(a=t[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(n>h?f--:n<h&&f++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?f--:c==l+1?f++:(c>l?f--:f++,o.__u|=4))):i.__k[r]=null;if(d)for(r=0;r<h;r++)(a=t[r])!=null&&!(2&a.__u)&&(a.__e==s&&(s=xi(a)),xp(a,a));return s}function vp(i,e,t,s){var n,r;if(typeof i.type=="function"){for(n=i.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=i,e=vp(n[r],e,t,s));return e}i.__e!=e&&(s&&(e&&i.type&&!e.parentNode&&(e=xi(i)),t.insertBefore(i.__e,e||null)),e=i.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ko(i,e){return e=e||[],i==null||typeof i=="boolean"||(br(i)?i.some(function(t){Ko(t,e)}):e.push(i)),e}function sw(i,e,t,s){var n,r,o,a=i.key,l=i.type,c=e[t],h=c!=null&&(2&c.__u)==0;if(c===null&&a==null||h&&a==c.key&&l==c.type)return t;if(s>(h?1:0)){for(n=t-1,r=t+1;n>=0||r<e.length;)if((c=e[o=n>=0?n--:r++])!=null&&!(2&c.__u)&&a==c.key&&l==c.type)return o}return-1}function _p(i,e,t){e[0]=="-"?i.setProperty(e,t??""):i[e]=t==null?"":typeof t!="number"||ew.test(e)?t:t+"px"}function qo(i,e,t,s,n){var r,o;e:if(e=="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof s=="string"&&(i.style.cssText=s=""),s)for(e in s)t&&e in t||_p(i.style,e,"");if(t)for(e in t)s&&t[e]==s[e]||_p(i.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(fp,"$1")),o=e.toLowerCase(),e=o in i||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),i.l||(i.l={}),i.l[e+r]=t,t?s?t.u=s.u:(t.u=Uc,i.addEventListener(e,r?Wc:Vc,r)):i.removeEventListener(e,r?Wc:Vc,r);else{if(n=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in i)try{i[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?i.removeAttribute(e):i.setAttribute(e,e=="popover"&&t==1?"":t))}}function bp(i){return function(e){if(this.l){var t=this.l[e.type+i];if(e.t==null)e.t=Uc++;else if(e.t<t.u)return;return t(tt.event?tt.event(e):e)}}}function qc(i,e,t,s,n,r,o,a,l,c){var h,d,f,m,y,b,w,x,D,I,E,P,O,W,J,Y,ve,ee=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(h=tt.__b)&&h(e);e:if(typeof ee=="function")try{if(x=e.props,D="prototype"in ee&&ee.prototype.render,I=(h=ee.contextType)&&s[h.__c],E=h?I?I.props.value:h.__:s,t.__c?w=(d=e.__c=t.__c).__=d.__E:(D?e.__c=d=new ee(x,E):(e.__c=d=new ae(x,E),d.constructor=ee,d.render=iw),I&&I.sub(d),d.state||(d.state={}),d.__n=s,f=d.__d=!0,d.__h=[],d._sb=[]),D&&d.__s==null&&(d.__s=d.state),D&&ee.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Ws({},d.__s)),Ws(d.__s,ee.getDerivedStateFromProps(x,d.__s))),m=d.props,y=d.state,d.__v=e,f)D&&ee.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),D&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(D&&ee.getDerivedStateFromProps==null&&x!==m&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(x,E),e.__v==t.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(x,d.__s,E)===!1){for(e.__v!=t.__v&&(d.props=x,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(ne){ne&&(ne.__=e)}),P=0;P<d._sb.length;P++)d.__h.push(d._sb[P]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(x,d.__s,E),D&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(m,y,b)})}if(d.context=E,d.props=x,d.__P=i,d.__e=!1,O=tt.__r,W=0,D){for(d.state=d.__s,d.__d=!1,O&&O(e),h=d.render(d.props,d.state,d.context),J=0;J<d._sb.length;J++)d.__h.push(d._sb[J]);d._sb=[]}else do d.__d=!1,O&&O(e),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++W<25);d.state=d.__s,d.getChildContext!=null&&(s=Ws(Ws({},s),d.getChildContext())),D&&!f&&d.getSnapshotBeforeUpdate!=null&&(b=d.getSnapshotBeforeUpdate(m,y)),Y=h,h!=null&&h.type===cn&&h.key==null&&(Y=Cp(h.props.children)),a=yp(i,br(Y)?Y:[Y],e,t,s,n,r,o,a,l,c),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),w&&(d.__E=d.__=null)}catch(ne){if(e.__v=null,l||r!=null)if(ne.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else{for(ve=r.length;ve--;)Kc(r[ve]);Gc(e)}else e.__e=t.__e,e.__k=t.__k,ne.then||Gc(e);tt.__e(ne,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=nw(t.__e,e,t,s,n,r,o,l,c);return(h=tt.diffed)&&h(e),128&e.__u?void 0:a}function Gc(i){i&&i.__c&&(i.__c.__e=!0),i&&i.__k&&i.__k.forEach(Gc)}function wp(i,e,t){for(var s=0;s<t.length;s++)Zc(t[s],t[++s],t[++s]);tt.__c&&tt.__c(e,i),i.some(function(n){try{i=n.__h,n.__h=[],i.some(function(r){r.call(n)})}catch(r){tt.__e(r,n.__v)}})}function Cp(i){return typeof i!="object"||i==null||i.__b&&i.__b>0?i:br(i)?i.map(Cp):Ws({},i)}function nw(i,e,t,s,n,r,o,a,l){var c,h,d,f,m,y,b,w=t.props||_r,x=e.props,D=e.type;if(D=="svg"?n="http://www.w3.org/2000/svg":D=="math"?n="http://www.w3.org/1998/Math/MathML":n||(n="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((m=r[c])&&"setAttribute"in m==!!D&&(D?m.localName==D:m.nodeType==3)){i=m,r[c]=null;break}}if(i==null){if(D==null)return document.createTextNode(x);i=document.createElementNS(n,D,x.is&&x),a&&(tt.__m&&tt.__m(e,r),a=!1),r=null}if(D==null)w===x||a&&i.data==x||(i.data=x);else{if(r=r&&Uo.call(i.childNodes),!a&&r!=null)for(w={},c=0;c<i.attributes.length;c++)w[(m=i.attributes[c]).name]=m.value;for(c in w)if(m=w[c],c!="children"){if(c=="dangerouslySetInnerHTML")d=m;else if(!(c in x)){if(c=="value"&&"defaultValue"in x||c=="checked"&&"defaultChecked"in x)continue;qo(i,c,null,m,n)}}for(c in x)m=x[c],c=="children"?f=m:c=="dangerouslySetInnerHTML"?h=m:c=="value"?y=m:c=="checked"?b=m:a&&typeof m!="function"||w[c]===m||qo(i,c,m,w[c],n);if(h)a||d&&(h.__html==d.__html||h.__html==i.innerHTML)||(i.innerHTML=h.__html),e.__k=[];else if(d&&(i.innerHTML=""),yp(e.type=="template"?i.content:i,br(f)?f:[f],e,t,s,D=="foreignObject"?"http://www.w3.org/1999/xhtml":n,r,o,r?r[0]:t.__k&&xi(t,0),a,l),r!=null)for(c=r.length;c--;)Kc(r[c]);a||(c="value",D=="progress"&&y==null?i.removeAttribute("value"):y!=null&&(y!==i[c]||D=="progress"&&!y||D=="option"&&y!=w[c])&&qo(i,c,y,w[c],n),c="checked",b!=null&&b!=i[c]&&qo(i,c,b,w[c],n))}return i}function Zc(i,e,t){try{if(typeof i=="function"){var s=typeof i.__u=="function";s&&i.__u(),s&&e==null||(i.__u=i(e))}else i.current=e}catch(n){tt.__e(n,t)}}function xp(i,e,t){var s,n;if(tt.unmount&&tt.unmount(i),(s=i.ref)&&(s.current&&s.current!=i.__e||Zc(s,null,e)),(s=i.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(r){tt.__e(r,e)}s.base=s.__P=null}if(s=i.__k)for(n=0;n<s.length;n++)s[n]&&xp(s[n],e,t||typeof i.type!="function");t||Kc(i.__e),i.__c=i.__=i.__e=void 0}function iw(i,e,t){return this.constructor(i,t)}function hn(i,e,t){var s,n,r,o;e==document&&(e=document.documentElement),tt.__&&tt.__(i,e),n=(s=typeof t=="function")?null:t&&t.__k||e.__k,r=[],o=[],qc(e,i=(!s&&t||e).__k=g(cn,null,[i]),n||_r,_r,e.namespaceURI,!s&&t?[t]:n?null:e.firstChild?Uo.call(e.childNodes):null,r,!s&&t?t:n?n.__e:e.firstChild,s,o),wp(r,i,o)}Uo=pp.slice,tt={__e:function(i,e,t,s){for(var n,r,o;e=e.__;)if((n=e.__c)&&!n.__)try{if((r=n.constructor)&&r.getDerivedStateFromError!=null&&(n.setState(r.getDerivedStateFromError(i)),o=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(i,s||{}),o=n.__d),o)return n.__E=n}catch(a){i=a}throw i}},cp=0,N.isValidElement=function(i){return i!=null&&i.constructor===void 0},ae.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Ws({},this.state),typeof i=="function"&&(i=i(Ws({},t),this.props)),i&&Ws(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),gp(this))},ae.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),gp(this))},ae.prototype.render=cn,Un=[],dp=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,up=function(i,e){return i.__v.__b-e.__v.__b},Wo.__r=0,fp=/(PointerCapture)$|Capture$/i,Uc=0,Vc=bp(!1),Wc=bp(!0);function Le(i,...e){return e.forEach(t=>{!t||typeof t!="object"||Object.keys(t).forEach(s=>{let n=t[s];const r=i[s];n!==r&&(r!==void 0&&(s==="className"||s.endsWith("Class")?n=[r,n]:s==="children"?n=[...Ko(r),...Ko(n)]:typeof r=="object"&&(s==="style"||s.endsWith("Style")||s==="attrs"||s.endsWith("Attrs")||s==="props")&&(n=v.extend(r,n))),i[s]=n)})}),i}function Yc(i){return Object.keys(i).forEach(e=>{i[e]===void 0&&delete i[e]}),i}function Go(i,e=!0){const t=v(i),s=t[0],n="zui-disable-scroll";if(e){if(t.data(n))return;if((t.css("scrollbar-gutter")||"").includes("stable")){t.data(n,{overflow:t.css("overflow")}).css("overflow","hidden");return}const r=s===document.body||t.is("html")?window.innerWidth-document.body.clientWidth:s.offsetWidth-s.clientWidth;if(!r)return;const o=t.css("paddingRight")||"0";t.data(n,{paddingRight:o,overflow:t.css("overflow")}).css({paddingRight:`${r+Number.parseInt(o,10)}px`,overflow:"hidden"})}else{const r=t.data(n);if(!r)return;t.css(r).removeData(n)}}v.fn.disableScroll=function(i=!0){return this.each((e,t)=>{Go(t,i)})},v.fn.enableScroll=function(i=!0){return this.disableScroll(!i)};function Jc(i,e,t){if(!(t.on||"click").split(" ").includes(e.type))return;const s=t.selector?v(e.target).closest(t.selector):i;if(!s.length)return;const n=c=>c===""?!0:c,r=c=>{if(typeof c=="string")try{c=JSON.parse(c)}catch{}return c};if(n(t.once)){if(t.onceCalled)return;i.dataset("once-called",!0)}if(n(t.prevent)&&e.preventDefault(),n(t.stop)&&e.stopPropagation(),n(t.self)&&e.currentTarget!==e.target)return;const o=[["$element",i],["event",e],["options",t],["$target",s]],a=c=>typeof c=="function"?c(...o):v.runJS(c,...o);if(t.if!==void 0&&!a(t.if))return;const l=t.call;if(l){let c;if(typeof l=="string"?c=/^[$A-Z_][0-9A-Z_$.]*$/i.test(l)?mr(window,l):a(l):c=l,typeof c=="function"){const h=[],d=t.params;t.params=h,typeof d=="string"&&d.length?d[0]==="["?h.push(...r(d)):h.push(...d.split(", ").map(f=>(f=f.trim(),f==="$element"?i:f==="event"?e:f==="options"?t:f.startsWith("$element.")||f.startsWith("event.")||f.startsWith("options.")?a(f):r(f)))):Array.isArray(d)?h.push(...d):h.push(d),c(...h)}}t.do&&a(t.do)}function rw(i){const e=v(this),t=i.type,s=e.attr("zui-on");if(s){const[o,a]=s.split("~").map(l=>l.trim());o&&o.split(" ").includes(t)&&Jc(e,i,v.extend({on:o},a?a.startsWith("{")?ln(a):{do:a}:Ci(e,{prefix:"data-",evalValue:["call","if","do"]})))}const n=e.attr(`zui-on-${t}`);n&&Jc(e,i,v.extend({on:t},n.startsWith("{")?ln(n):{do:n}));const r=e.attr("data-on");r&&r.split(" ").includes(t)&&Jc(e,i,Ci(e,{prefix:"data-",evalValue:["call","if","do"]}))}function kp(i){v(document).off(".zui.global").on(i.map(e=>`${e}.zui.global`).join(" "),`[zui-on],${i.map(e=>`[zui-on-${e}]`)},[data-on]`,rw)}v(()=>{kp(["click","change","inited"])});function dn(i,e){if(typeof i=="function")return dn(i(...e||[]));if(typeof i=="number")return[i];let t=i.match(/(\d+)(%|px)?/);return t?[parseInt(t[1]),t[2]]:(t=i.match(/(\d+)\/(\d+)/),t?[100*parseInt(t[1])/parseInt(t[2]),"%"]:[NaN])}function je(i,e){if(i==null)return null;const[t,s="px"]=dn(i,e);return Number.isNaN(t)?typeof i=="string"?i:null:`${t}${s}`}async function Ks(i,e){var s,n,r;if(i instanceof Blob){const o=document.createElement("a");return o.href=window.URL.createObjectURL(i),e&&(o.download=decodeURIComponent(e)),o.click(),o.remove(),i}if(i instanceof Response){const o=await i.blob();return e=e||((r=(n=(s=i.headers.get("Content-Disposition"))==null?void 0:s.split(";")[1])==null?void 0:n.split("=")[1])==null?void 0:r.replace(/"/g,"")),Ks(o,e)}const t=await fetch(i);return Ks(t)}class Sp{constructor(e){this._$target=v(e)}on(...e){return this._$target.on(...e),this}one(...e){return this._$target.one(...e),this}off(...e){return this._$target.off(...e),this}trigger(...e){return this._$target.trigger(...e),this}}const Ts=new Sp(document);v.bus=Ts,v.on=Ts.on.bind(Ts),v.one=Ts.one.bind(Ts),v.off=Ts.off.bind(Ts),v.trigger=Ts.trigger.bind(Ts);var ow=["Shift","Meta","Alt","Control"],Tp=typeof navigator=="object"?navigator.platform:"",$p=/Mac|iPod|iPhone|iPad/.test(Tp),aw=$p?"Meta":"Control",lw=Tp==="Win32"?["Control","Alt"]:$p?["Alt"]:[];function Xc(i,e){return typeof i.getModifierState=="function"&&(i.getModifierState(e)||lw.includes(e)&&i.getModifierState("AltGraph"))}function cw(i){return i.trim().split(" ").map(function(e){var t=e.split(/\b\+/),s=t.pop();return[t=t.map(function(n){return n==="$mod"?aw:n}),s]})}function Dp(i,e){var t;e===void 0&&(e={});var s=(t=e.timeout)!=null?t:1e3,n=Object.keys(i).map(function(a){return[cw(a),i[a]]}),r=new Map,o=null;return function(a){a instanceof KeyboardEvent&&(n.forEach(function(l){var c=l[0],h=l[1],d=r.get(c)||c;(function(f,m){return!(m[1].toUpperCase()!==f.key.toUpperCase()&&m[1]!==f.code||m[0].find(function(y){return!Xc(f,y)})||ow.find(function(y){return!m[0].includes(y)&&m[1]!==y&&Xc(f,y)}))})(a,d[0])?d.length>1?r.set(c,d.slice(1)):(r.delete(c),h(a)):Xc(a,a.key)||r.delete(c)}),o&&clearTimeout(o),o=setTimeout(r.clear.bind(r),s))}}function hw(i,e,t){var s;t===void 0&&(t={});var n=(s=t.event)!=null?s:"keydown",r=Dp(e,t);return i.addEventListener(n,r),function(){i.removeEventListener(n,r)}}function Qc(i,e={}){if(!i)return;const t=Object.keys(e).reduce((s,n)=>(e[n].optional||(s[n]={...e[n]}),s),{});return Object.keys(i).forEach(s=>{const n=i[s];n?n===!0?e[s]&&(t[s]={...e[s]}):t[s]=n:delete t[s]}),Object.keys(t).reduce((s,n)=>{const{keys:r,handler:o}=t[n];return typeof r=="string"?s[r]=o:r.forEach(a=>{s[a]=o}),s},{})}function eh(i,e,t){const{timeout:s,event:n="keydown",scope:r,when:o}=t||{},a=Dp(e,{timeout:s}),l=`.zui.hotkeys${r?`.${r}`:""}`,c="zui-hotkeys-composing";return v(i).on(`${n}${l}`,function(h){o&&o(h)===!1||v(h.target).data(c)||a(h)}).on(`compositionstart${l}`,h=>{v(h.target).data(c,!0)}).on(`compositionend${l}`,h=>{v(h.target).removeData(c)})}function th(i,e){return v(i).off(`.zui.hotkeys${e?`.${e}`:""}`)}const dw=hw;v.fn.hotkeys=function(i,e){return eh(this,i,e)},v.fn.unbindHotkeys=function(i){return th(this,i)},v.hotkeys=function(i,e){eh(window,i,e)},v.unbindHotkeys=function(i){th(window,i)};function Zo(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}async function Ip(i){(typeof i=="string"||i instanceof Element||i instanceof v)&&(i={target:i});const{target:e,onError:t,onSuccess:s,afterExit:n,afterEnter:r}=i,o=v(e),a=o[0];if(!a)return;const l=a.requestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen;if(!l){t==null||t.call(a,new Error("[ZUI] The browser does not support full screen feature."));return}try{await l.call(a),s==null||s.call(a),v(a).off(".zui.fullscreen"),n&&o.on("exitFullscreen.zui.fullscreen",n),r&&o.on("enterFullscreen.zui.fullscreen",r)}catch(c){t==null||t.call(a,c)}document.zuiBindFullscreenChange||(document.zuiBindFullscreenChange=!0,v(document).on("fullscreenchange.zui webkitfullscreenchange.zui mozfullscreenchange.zui",c=>{const h=Zo();let d=h;h?v(h).addClass("is-in-fullscreen"):(d=v(document).find(".is-in-fullscreen")[0]||document,v(d).removeClass("is-in-fullscreen")),v("body").toggleClass("has-in-fullscreen",!!h);const f={event:c,target:d,fullscreenElement:h};v(d).trigger(h?"enterFullscreen":"exitFullscreen",f).trigger("toggleFullscreen",f)}))}async function Yo(i){const e=Zo();return i===!1&&!!e===i?i:e?(document.exitFullscreen(),!1):(await Ip(i),!0)}v.fn.fullscreen=function(i){return Yo({target:this,...i})},v.getFullscreenElement=Zo,v.toggleFullscreen=Yo;function $s(i){return!i||i.parentNode===document?!1:i.parentNode?$s(i.parentNode):!0}v.isDetached=$s,v.fn.isDetached=function(){const i=this[0];return!i||$s(i)};const Vn=class K_{constructor(e,t){var y,b;this._inited=!1,this._autoDestory=0,this._destroyed=!1;const{KEY:s,DATA_KEY:n,MULTI_INSTANCE:r,NAME:o,ATTR_KEY:a,ALL:l,TYPED_ALL:c}=this.constructor;if(!o)throw new Error('[ZUI] The component must have a "NAME" static property.');const h=v(e);if(h.data(s)&&!r)throw new Error(`[ZUI] The component "${o}" has been initialized on element.`);const d=h[0];if(!d)throw new Error(`[ZUI] Invalid selector "${e}" for component "${o}", can not find the element matched.`);const f=Xe();this._gid=f,this._element=d,this.resetOptions(t),this._key=this.options.key??`__${f}`;let m=l.get(d);if(m?m.add(this):(m=new Set([this]),l.set(d,m)),c.has(o)?(y=c.get(o))==null||y.add(this):c.set(o,new Set([this])),h.data(s,this).attr(a,"").attr(n,`${f}`).attr("z-use",[...new Set([...m||[]].map(w=>w.constructor.NAME))].join(",")),r){const w=`${s}:ALL`;let x=h.data(w);x||(x=new Map,h.data(w,x)),x.set(this._key,this)}this.init(),(b=this.options.$onCreate)==null||b.call(this),requestAnimationFrame(async()=>{var x;const{$fetcher:w}=this.options;if(w){const D=await Ne(w,[],{dataType:"js"});if(this.destroyed)return;D&&this.setOptions(D)}this._inited=!0,await this.afterInit(),this.emit("inited",this.options),(x=this.options.$onInited)==null||x.call(this)})}static get ZUI(){return this.NAME.replace(/(^[A-Z]+)/,e=>e.toLowerCase())}static get KEY(){return`zui.${this.NAME}`}static get NAMESPACE(){return`.zui.${this.ZUI}`}static get DATA_KEY(){return`data-zui-${this.NAME}`}static get ATTR_KEY(){return`z-use-${this.NAME}`}static get SELECTOR(){return`[${this.DATA_KEY}]`}get inited(){return this._inited}get destroyed(){return this._destroyed}get element(){if(!this._element)throw new Error("[ZUI] Component element is not available.");return this._element}get key(){return this._key}get options(){if(!this._options)throw new Error("[ZUI] Component options are not available.");return this._options}get gid(){return this._gid}get $element(){return v(this.element)}get $emitter(){return this.$element}get i18nData(){return[this.options.i18n,this.constructor.i18n]}init(){}afterInit(){}render(e,t){this._options=this.setOptions(e,t);const{$class:s,$style:n}=this.options;s&&this.$element.setClass(s),n&&this.$element.css(n)}destroy(){var m;const{KEY:e,DATA_KEY:t,ALL:s,TYPED_ALL:n,NAME:r,MULTI_INSTANCE:o,ATTR_KEY:a}=this.constructor,{$element:l,element:c}=this;if(this.emit("destroyed"),this._destroyed=!0,l.off(this.namespace).removeData(e).removeAttr(a).removeAttr(t),o){const y=this.$element.data(`${e}:ALL`);if(y)if(y.delete(this._key),y.size===0)this.$element.removeData(`${e}:ALL`);else{const b=y.values().next().value;l.data(e,b).attr(t,String(b==null?void 0:b.gid))}}const h=s.get(c);h&&(h.delete(this),h.size===0&&s.delete(c));const d=n.get(r);d&&(d.delete(this),d.size===0&&n.delete(r));const f=s.get(c);f!=null&&f.size?l.attr("z-use",[...new Set([...f].map(y=>y.constructor.NAME))].join(",")):l.removeAttr("z-use"),(m=this.options.$onDestroy)==null||m.call(this)}autoDestroy(e=100){this._autoDestory&&clearTimeout(this._autoDestory),this._autoDestory=window.setTimeout(()=>{this._autoDestory=0,$s(this.element)&&this.destroy()},e)}setOptions(e,t){if(t){const s={...this.constructor.DEFAULT,...(e==null?void 0:e.$optionsFromDataset)!==!1?this.$element.dataset():{},...e},{$options:n}=s;if(n){const r=typeof n=="function"?n.call(this,this.element,s):n;r&&v.extend(s,r),delete s.$options}this._options=s}else e&&v.extend(this._options,e);if(!this._options)throw new Error("[ZUI] Component options are not available.");return this._options}resetOptions(e){return this.setOptions(e,!0)}emit(e,...t){const s=v.Event(e);return s.__src=this,this.$emitter.trigger(s,[this,...t]),s}on(e,t,s){const n=this;this.$element[s!=null&&s.once?"one":"on"](this._wrapEvent(e),function(r,o){(!r.__src||r.__src===n)&&t.call(this,r,o)})}one(e,t){this.on(e,t,{once:!0})}off(e){this.$element.off(this._wrapEvent(e))}i18n(e,t,s){const{i18nData:n}=this;return Pe(n,e,t,s,this.options.lang,this.constructor.NAME)??Pe(n,e,t,s,this.options.lang)??`{i18n:${e}}`}get namespace(){return`${this.constructor.NAMESPACE}.${this._key}`}_wrapEvent(e){return e.split(" ").map(t=>t.includes(".")?t:`${t}${this.namespace}`).join(" ")}static get(e,t){const s=v(e);if(this.MULTI_INSTANCE&&t!==void 0){const n=s.data(`${this.KEY}:ALL`);return n?n.get(t):void 0}return s.data(this.KEY)}static isValid(e){return!0}static ensure(e,t){const s=this.get(e,t==null?void 0:t.key);if(s){if(this.isValid(s))return t&&s.setOptions(t),s;s.destroy()}return new this(e,t)}static getAll(e,t){var l;const{SELECTOR:s,ALL:n,TYPED_ALL:r}=this,o=[],a=c=>{c instanceof this&&(!t||t(c)!==!1)&&o.push(c)};return e?v(e).find(s).each((c,h)=>{var d;(d=n.get(h))==null||d.forEach(a)}):this!==K_?(l=r.get(this.NAME))==null||l.forEach(a):n.forEach(c=>{c.forEach(a)}),o.sort((c,h)=>c.gid-h.gid)}static query(e,t,s){return e===void 0?this.getAll(void 0,s).pop():this.get(v(e).closest(this.SELECTOR),t)}static defineFn(e){let t=e||this.ZUI;v.fn[t]&&(t=`zui${this.NAME}`);const s=this;v.fn.extend({[t](n,...r){const o=typeof n=="object"?n:void 0,a=typeof n=="string"?n:void 0;let l;return this.each((c,h)=>{let d=s.get(h);if(d)o&&d.render(o);else{if(a)return;d=new s(h,o)}if(a){let f=d[a],m=d;f===void 0&&(m=d.$,f=m[a]),typeof f=="function"?l=f.call(m,...r):l=f}}),l!==void 0?l:this}})}static register(e,t){var n,r;e=e||this,t=(t??e.NAME).toLowerCase(),this.map.set(t,e);const s=(r=(n=e.toggle)==null?void 0:n.name)==null?void 0:r.toLowerCase();s&&s!==t&&this.toggleMap.set(s,e)}};Vn.DEFAULT={},Vn.MULTI_INSTANCE=!1,Vn.ALL=new Map,Vn.TYPED_ALL=new Map,Vn.map=new Map,Vn.toggleMap=new Map;let Ze=Vn;function wr(i){return Ze.map.get(i.toLowerCase())}function Jo(i,e,t={}){let s=typeof i=="function"?i:wr(i);if(s||(s=sh(i)),!s)return null;const{$update:n,...r}=t;if(!s.MULTI_INSTANCE){const o=s.get(e);if(o)return n&&o.render(r,n==="reset"),o}return new s(e,r)}function Mp(i,e,t={}){requestAnimationFrame(()=>Jo(i,e,t))}function Np(i,e){Ze.register(i,e)}function sh(i){const{zui:e}=window;if(e){i=i==null?void 0:i.toLowerCase();for(const t in e){const s=t.toLowerCase()===i;if(i&&!s)continue;const n=e[t];if(!(typeof n!="function"||!n.NAME||!n.ZUI)&&(Ze.map.has(t.toLowerCase())||Np(n),s))return n}}}function uw(i){var e;i?(e=wr(i))==null||e.defineFn():window._zuiDefined||(sh(),Ze.map.forEach(t=>{t.defineFn()}),Object.assign(window,{_zuiDefined:!0}))}function fw(i,e={}){const t=v(i);let s=t.attr("zui-create");const{update:n,onCreate:r}=e,o=(a,l)=>{if(l={$update:n,$optionsFromDataset:!1,...l},r){const h=r(a,l);if(h===!1)return;h&&(l=h)}const c=l.$lib;if(c){delete l.$lib,v.getLib(c).then(()=>Mp(a,i,l));return}Mp(a,i,l)};if(typeof s=="string"){s=s.trim();const a=s.length?s.split(",").map(h=>h.trim()):[],l=Ci(i,{prefix:"zui-create-",evalValue:!0})||{},c=Object.keys(l);if(!c.length&&a.length===1)o(a[0],t.dataset());else{const h=new Set;[...a,...c].forEach(d=>{if(h.has(d))return;const f=l[d];o(d,f),delete l[d],h.add(d)})}}else{const a=t.dataset(),l=a==null?void 0:a.zui;if(!l)return;console.warn("[ZUI] create component instance with [data-zui] is deprecated, use [zui-create] instead.",{element:i,options:e}),a==null||delete a.zui,o(l,a)}}function pw(){v(document).on("click.zui.toggle mouseenter.zui.toggle","[data-toggle],[zui-toggle]",function(i){const e=v(this),t=e.dataset("toggle")||e.attr("zui-toggle");if(!t)return;const s=Ze.toggleMap.get(t)||wr(t),n=s==null?void 0:s.toggle;if(!n)return;const{trigger:r="click",skip:o="[disabled],.disabled",check:a}=n,l=i.type==="mouseover"?"hover":"click";if(!r.includes(l)||a&&!a.call(s,this,l,i)||o&&e.is(o))return;const{onGet:c,onCreate:h,setOptions:d=!0,getOptions:f,prevent:m=!0,handler:y,onToggle:b,convertHref:w}=n;let x=e.dataset();const D=e.attr(`zui-toggle-${t}`);if(D&&(x=v.extend(x,ln(D,["_element",this],["_$element",e]))),w&&e.is("a")){const E=e.attr("href");if(E){const P=w===!0?{selector:"target",url:"url"}:w;"#.".includes(E[0])?P.selector&&x[P.selector]===void 0&&(x[P.selector]=E):P.url&&x[P.url]===void 0&&(x[P.url]=E)}}if(f&&(x=f.call(s,this,x,i)),y){y.call(s,this,x,l,i),m&&i.preventDefault();return}let I=c?c.call(s,this):s.get(this);if(I)d&&I.setOptions(x);else{const E=h?h.call(s,this,i,x):new s(this,x);if(!E)return;I=E}if(b){if(b.call(s,I,this,i)===!1)return}else{const{shown:E,show:P,hide:O,toggle:W}=I;let J;if(W?J=W:P&&O?E?J=O:J=P:P&&(J=P),J)J.call(I);else return}m&&i.preventDefault()})}function mw(i,e){const t=vr(i),s=[];return Object.keys(t).forEach(n=>{if(!n.startsWith("zui."))return;const r=t[n];(e==null?void 0:e(r,n))!==!1&&s.push(t[n])}),s}let Xo=0;function Ep(i=100){if(Xo&&clearTimeout(Xo),i){Xo=window.setTimeout(()=>Ep(0),i);return}Xo=0,Ze.ALL.forEach(e=>{e.forEach(t=>!t.options.$notDestroyOnDetach&&t.autoDestroy())})}function gw(){if(!document.body||vr(document.body,"_autoDestoryMob"))return;const i=new MutationObserver(e=>{let t=!1;for(const s of e)if(s.removedNodes.length){t=!0;break}t&&Ep()});i.observe(document.body,{childList:!0,subtree:!0}),Bo(document.body,"_autoDestoryMob",i)}function nh(i,e){const t=v(i);t.find("[zui-create],[data-zui]").each(function(){var s;((s=e==null?void 0:e.beforeCreate)==null?void 0:s.call(e,this))!==!1&&fw(this,e)}),t.find("[zui-init]").each(function(){if(this.hasAttribute("z-zui-inited"))return;this.setAttribute("z-zui-inited","");const s=this.getAttribute("zui-init");s&&v.runJS(s,["$element",v(this)])}),t.find(".hide-before-init").removeClass("invisible hidden opacity-0"),t.find(".scroll-into-view").scrollIntoView(),t.find('[data-on="inited"],[zui-on-inited]').each((s,n)=>{const r=v(n);r.zui()||r.trigger("inited")}),e!=null&&e.runJS&&t.runJS()}v.fn.zuiInit=function(i){return nh(this,i),this},v.fn.zui=function(i,e){const t=this[0];if(!t)return;if(typeof i!="string"){const n={};let r;return mw(t,(o,a)=>{n[a]=o,(!r||r.gid<o.gid)&&(r=n[a])}),i===!0?n:r}const s=wr(i);return s?e===!0?s.getAll(t):s.query(t,e):v(t).data(`zui.${i}`)},v.fn.zuiCall=function(i,e=[]){return this.each(function(){const t=i.split("."),s=t.length>1?t[0]:void 0,n=t[t.length>1?1:0],r=v(this).zui(s),o=r==null?void 0:r[n];typeof o=="function"&&o.apply(r,e)}),this},v(()=>{v("body").zuiInit({update:!0}),pw(),gw()});class Qo extends Ze{get $targets(){const{$element:e}=this,{targets:t}=this.options;return t?e.find(t):e}_handleScroll(e,t,s){const{offset:n=1}=this.options,r=this.$targets,o=e.getBoundingClientRect(),{scrollTop:a,scrollLeft:l}=e;r.each((c,h)=>{const d=h.getBoundingClientRect(),f=t==="top"&&a>0&&d.top<=o.top+n||t==="bottom"&&d.bottom>=o.bottom-n||t==="left"&&l>0&&d.left<=o.left+n||t==="right"&&l<e.scrollWidth-e.clientWidth;h.classList.toggle(s,f)})}init(){const{offset:e=1,side:t="top",zIndex:s,pinnedClass:n="is-pinned",scrollContainer:r}=this.options,{$element:o,$targets:a}=this;if(a.css({position:"sticky",zIndex:s,[t]:0}),r){const l=o.closest(r)[0]||o.find(r)[0];if(l){const c=()=>{this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this._handleScroll(l,t,n)})};this._scrollListener=c,l.addEventListener("scroll",c)}this._container=l,requestAnimationFrame(()=>{this._handleScroll(l,t,n)})}else this._ob=new IntersectionObserver(l=>{l.forEach(c=>{c.target.classList.toggle(n,c.intersectionRatio<e)})},{threshold:[1]}),a.css("side",-e).each((l,c)=>this._ob.observe(c))}destroy(){var e;(e=this._ob)==null||e.disconnect(),this._container&&(this._container.removeEventListener("scroll",this._scrollListener),this._raf&&cancelAnimationFrame(this._raf))}}Qo.NAME="Sticky";const ki=24*60*60*1e3,Je=i=>i===void 0?new Date:(i instanceof Date||(typeof i=="string"&&(i=i.trim(),/^\d+$/.test(i)&&(i=Number.parseInt(i,10))),typeof i=="number"&&i<1e10&&(i*=1e3),i=new Date(i)),i),Ap=(i,e,t="day")=>{if(typeof e=="string"){const s=Number.parseInt(e,10);t=e.replace(s.toString(),""),e=s}return i=new Date(Je(i).getTime()),t==="month"?i.setMonth(i.getMonth()+e):t==="year"?i.setFullYear(i.getFullYear()+e):t==="week"?i.setDate(i.getDate()+e*7):t==="hour"?i.setHours(i.getHours()+e):t==="minute"?i.setMinutes(i.getMinutes()+e):t==="second"?i.setSeconds(i.getSeconds()+e):i.setDate(i.getDate()+e),i},un=(i,e=new Date)=>Je(i).toDateString()===Je(e).toDateString(),Cr=(i,e=new Date)=>Je(i).getFullYear()===Je(e).getFullYear(),ea=(i,e=new Date)=>(i=Je(i),e=Je(e),i.getFullYear()===e.getFullYear()&&i.getMonth()===e.getMonth()),yw=(i,e=new Date)=>{i=Je(i),e=Je(e);const t=1e3*60*60*24,s=Math.floor(i.getTime()/t),n=Math.floor(e.getTime()/t);return Math.floor((s+4)/7)===Math.floor((n+4)/7)},Pp=(i,e)=>un(Je(e),i),Lp=(i,e)=>un(Je(e).getTime()-ki,i),vw=(i,e)=>un(Je(e).getTime()+ki,i),ih=i=>i!=null&&!isNaN(Je(i).getTime()),rt=(i,e="yyyy-MM-dd hh:mm",t="")=>{if(i=Je(i),!ih(i))return t;if(typeof e=="function")return e(i);const s={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"H+":i.getHours()%12,"m+":i.getMinutes(),"s+":i.getSeconds(),"S+":i.getMilliseconds()};return/(y+)/i.test(e)&&(e.includes("[yyyy-]")&&(e=e.replace("[yyyy-]",Cr(i)?"":"yyyy-")),e=e.replace(RegExp.$1,`${i.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(s).forEach(n=>{if(new RegExp(`(${n})`).test(e)){const r=`${s[n]}`;e=e.replace(RegExp.$1,RegExp.$1.length===1?r:`00${r}`.substring(r.length))}}),e},_w=(i,e,t)=>{const s={full:"yyyy-M-d",month:"M-d",day:"d",str:"{0} ~ {1}",...t},n=rt(i,Cr(i)?s.month:s.full);if(un(i,e))return n;const r=rt(e,Cr(i,e)?ea(i,e)?s.day:s.month:s.full);return s.str.replace("{0}",n).replace("{1}",r)};function rh(i){let e=0;if(typeof i!="string"&&(i=String(i)),i&&i.length)for(let t=0;t<i.length;++t)e+=(t+1)*i.charCodeAt(t);return e}function ta(i){if(!i)return;if(typeof i=="object")return i;if(i=i.replace(/^#/,""),!i.length)return;i.startsWith("/")||(i=`/${i}`);const e=new URL(window.location.origin+i),[,t="",...s]=e.pathname.split("/");let n=t.trim();if(!n.length)return;let r="";return n.includes("~")&&([r,n]=n.split("~")),{name:n,scope:r,options:Object.fromEntries([...e.searchParams.entries()].map(([o,a])=>{try{a.includes("%")&&(a=decodeURIComponent(a)),a=JSON.parse(a)}catch{}return[o,a]})),params:s.map(o=>{if(o!=="undefined"){if(o==="null")return null;try{return o.includes("%")&&(o=decodeURIComponent(o)),JSON.parse(o)}catch{return o}}})}}function Rp(i){if(Array.isArray(i))return{commands:i.map(ta).filter(Boolean)};if(typeof i=="object")return i;i=i.replace(/^#!?/,"");const e=i.includes(">"),t=i.split(e?">":"|").map(ta);return{async:e,commands:t.filter(Boolean)}}function oh(i,e,t){if(typeof i=="string"&&(i=ta(i)),!i)return;const{execute:s,event:n,scope:r}=e;if(!(r&&i.scope&&i.scope!==r))return s({name:i.name,options:{...e.options,...i.options},event:n,scope:i.scope,prevResult:t},i.params)}async function ah(i,e){const{async:t,commands:s}=Rp(i);if(!s.length)return[];const{signal:n}=e;if(t){const o=[];let a;for(const l of s){if(!(n!=null&&n.aborted))break;a=await oh(l,e,a),n!=null&&n.aborted&&(a=void 0),o.push(a)}return o}return await Promise.all(s.map(o=>{if(!(n!=null&&n.aborted))return oh(o,e)}))}const Si="zui.commands",Ti="z-commands",lh="zui-commands-proxy",zp="zui-command",sa={};function Fp(i,e){typeof i=="string"&&e?sa[i]=e:typeof i=="object"&&Object.assign(sa,i)}function $i(i,e){typeof e=="string"?e={scope:e}:typeof e=="function"&&(e={onCommand:e});const{scope:t="",events:s="click"}=e??{},n=v(i),r=(n.attr(Ti)||"").split(",");t&&!r.includes(t)&&r.push(t),n.attr(Ti,r.join(",")).data(Si,{[t]:{...e,scope:t,events:s,gid:Xe()},...n.data(Si)})}function xr(i,e=!0){const t=v(i);if(e===!0)t.removeAttr(Ti),t.removeData(Si);else if(e.length){const s=t.data(Si)||{};e.split(",").forEach(r=>{delete s[r]});const n=Object.keys(s);n.length?t.attr(Ti,n.join(",")).data(Si,$i):xr(t,!0)}}function Op(i,e){let t=i.closest(`[${Ti}],[${lh}]`).first();if(t.attr(lh)!==void 0&&(t=v(t.data("zui.commandProxy")||t.attr(lh)).closest(`[${Ti}]`)),!t.length)return;const s=t.data(Si)||{},n=Object.values(s).sort((o,a)=>a.gid-o.gid);let r;return e!=null&&e.length?(r=n.find(o=>o.scope===e),r||(r=n.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped})),r):(r=n.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped}),r||(r=n.find(o=>!o.scoped)),r?r.element=t[0]:r=Op(i.parent(),e),r)}function bw(i){if(!i.currentTarget)return;const e=v(i.currentTarget);if(e.closest(".disabled,[disabled]").length)return;const t=e.attr(zp)||(e.is('a[href^="#!"]')?e.attr("href"):"");if(!t)return;const s=new AbortController,n=()=>s.abort();ah(t,{signal:s.signal,execute:(r,o)=>{const{scope:a,name:l}=r,c={...r,abort:n};let h;const d=Op(e,a);if(d){c.element=d.element;const m=(d.commands?d.commands[`${a}~${l}`]||d.commands[l]:null)||d.onCommand;if(m&&(h=m(c,o),i.commandHandled))return h}const f=[c,o];if(e.trigger("command",f).trigger(`command:${a?`${l}.${a}`:l}`,f),a&&e.trigger(`command:.${a}`,f),i.commandHandled)return h;if(a==="event"){l==="stop"?i.stopPropagation():l==="prevent"?i.preventDefault():ls(i,l,o);return}if(a!=null&&a.startsWith(".")){let m;if(a===".")m=e.closest("[z-use]").zui();else{const y=a.substring(1);m=e.closest(`[z-use-${y}]`).zui(y)}if(m)return ls(m,l,o);console.warn(`[ZUI] Command "${l}" not found in scope "${a}".`);return}return a==="window"?ls(window,l,o):a==="zui"?ls(window.zui,l,o):a==="target"?ls(e[0],l,o):a==="$target"?ls(e,l,o):a==="$"?ls(v,l,o):a===""&&sa[l]!==void 0?sa[l](c,o):h},event:i})}v.fn.command=function(i,e){return this.on(`command:${i}`,e)},v.fn.offCommand=function(i,e){return this.off(`command:${i}`,e)},v.fn.commands=function(i){return this.each((e,t)=>$i(t,i)),this},v.fn.unbindCommands=function(i){return this.each((e,t)=>xr(t,i)),this},v(()=>{v(document).on("click.zui.command",`[${zp}],a[href^="#!"]`,bw)});function kr(i,e,t=!1){var n;const s=v(i);if(e!==void 0){if(typeof e=="string"&&e.length){const r=`zui-runjs-${Xe()}`;s.append(`<script id="${r}">${e}<\/script>`),t&&s.find(`#${r}`).remove()}return}if(s.is("script")){const r=(n=s[0])==null?void 0:n.textContent;r&&kr(s.parent(),r);return}s.find("script").each((r,o)=>{kr(s,o.textContent),o.remove()})}v.runJS=(i,...e)=>(i=i.trim(),!i.startsWith("return ")&&!i.endsWith(";")&&(i=`return ${i}`),new Function(...e.map(([s])=>s),i)(...e.map(([,s])=>s))),v.fn.runJS=function(i){return this.each((e,t)=>{kr(t,i)})};function ch(i){return new Promise(e=>{typeof i=="string"&&(i={accept:i});const t=document.createElement("input");t.type="file",t.accept=(i==null?void 0:i.accept)||"*/*",t.multiple=(i==null?void 0:i.multiple)||!1,t.onchange=()=>{t.files?e(t.multiple?t.files:t.files[0]):e(null),t.remove()},t.click()})}function ww(i){return new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{e(s.result)},s.onerror=n=>{t(n)},s.readAsText(i)})}function hh(i,e){const t=typeof e=="number"?{delay:e}:e,{delay:s=0,immediate:n=!1}=t??{};let r=null;const o=function(...a){const l=n&&!r;if(r&&clearTimeout(r),r=window.setTimeout(()=>{r=null,n||i.apply(this,a)},s),l)return i.apply(this,a)};return o.cancel=function(){r&&(clearTimeout(r),r=null)},o}function jp(i,e){v.libRoot=i,e&&(v.libVersion=e)}function dh(i,e){v.libMap||(v.libMap={}),!e.name&&e.id&&(e.id=`zui-lib-${i}`),v.libMap[i]=e}v.setLibRoot=jp,v.registerLib=dh,v.libVersion=1768967850625 .toString(36);function Bp(i){return new Promise((e,t)=>{typeof i=="string"&&(i={src:i});const{src:s,id:n,version:r}=i;if(v(n?`#${n}`:`link[href^="${s}"]`).length){e();return}const a=document.createElement("link");a.onload=()=>{e()},a.onerror=()=>{t(new Error(`[ZUI] Failed to load CSS from: ${s}`))},a.rel="stylesheet",a.href=`${s}${r?`${s.includes("?")?"&":"?"}v=${r}`:""}`,n&&(a.id=n),v("head").append(a)})}function Hp(i){return new Promise((e,t)=>{typeof i=="string"&&(i={src:i});const{src:s,id:n,version:r}=i,o=v(n?`#${n}`:`script[src^="${s}"]`);if(o.length){if(o.dataset("loaded"))e();else{const m=o.data("loadCalls")||[];m.push(e),o.data("loadCalls",m)}return}const{async:a=!0,defer:l=!1,noModule:c=!1,type:h,integrity:d}=i,f=document.createElement("script");f.async=a,f.defer=l,f.noModule=c,h&&(f.type=h),d&&(f.integrity=d),f.onload=()=>{e(),(v(f).dataset("loaded",!0).data("loadCalls")||[]).forEach(y=>y()),v(f).removeData("loadCalls")},f.onerror=m=>{t(new Error(`[ZUI] Failed to load JS from: ${s}`,{cause:m}))},v("head").append(f),f.src=`${s}${r?`${s.includes("?")?"&":"?"}v=${r}`:""}`})}function Up(i){return new Promise(e=>{typeof i=="string"&&(i={type:"module",src:i});const{src:t,imports:s,srcList:n=[],id:r}=i;t&&n.unshift({src:t,imports:s});const o=n.map(x=>x.src).join(","),a=v(r?`#${r}`:`script[data-src-list="${o}"]`);if(a.length){const x=a.data("module");if(x)e(x);else{const D=a.data("resolves")||[];D.push(e),a.data("resolves",D)}return}const{async:l=!0,defer:c=!1,integrity:h,globalVar:d,resolve:f}=i,m=document.createElement("script"),y=`zui-module-resolve-${v.guid++}`,b=v(m);Object.assign(window,{[y]:x=>{(b.data("module",x).data("resolves")||[]).forEach(I=>I(x)),b.removeData("resolves"),f==null||f(x),e(x),delete window[y]}}),m.async=l,m.defer=c,m.type="module",b.attr("data-src-list",o).attr("data-resolve-id",y);const w=[];m.text=[...n.map(({src:x,imports:D})=>{if(s){if(typeof D=="string")return w.push(D),`import * as ${D} from '${x}';`;if(D)return w.push(...Object.values(D)),`import {${Object.entries(D).map(([I,E])=>`${I} as ${E}`).join(",")}} from '${x}';`}return`import '${x}';`}),`const zuiImportResult = {${w.map(x=>`${x}: ${x},`)}};`,d?`Object.assign(window, ${d===!0?"zuiImportResult":`{${d}: zuiImportResult}`});`:"",`if(window['${y}']) window['${y}'](zuiImportResult);`].join(`
`),h&&(m.integrity=h),v("head").append(m)})}async function uh(i,e,t){var b;typeof i=="string"&&(i=((b=v.libMap)==null?void 0:b[i])||{src:i});let s=Array.isArray(i)?{src:i}:v.extend({},i);typeof e=="function"?s.success=e:e&&v.extend(s,e),t&&(s.success=t);let{src:n}=s;const{name:r,success:o}=s,a=v.libMap&&r?v.libMap[r]:null;if(a&&(s=v.extend({},a,s),n=a.src||s.src),typeof n=="string"&&(n=[n]),!n||!n.length)throw new Error("[ZUI] No src provided for $.getLib.");let{check:l=!0}=s;l===!0&&r&&(l=r);const c=typeof l=="string"?l:r;let h;const d=()=>{let w;if(c&&(w=window[c]||h),!(w instanceof Element))return w};typeof l=="string"&&(l=()=>!!d());const f=()=>(o==null||o(),d());if(typeof l=="function"&&await l())return f();const{root:m=v.libRoot,version:y=v.libVersion}=s;for(let w of n){typeof w=="string"&&(w={src:w});let{src:x}=w;m&&!/https?:\/\//.test(x)&&(x=`${m}${m.endsWith("/")||x.startsWith("/")?"":"/"}${x}`);const D={...s,...w,version:y,src:x};if(w.type==="css"||!w.type&&x.endsWith(".css")){await Bp(D);continue}if(D.type==="module"){h=await Up(D);continue}await Hp(D)}return f()}v.getLib=uh,v.getScript=v.getLib;class na{constructor(e,t){this._name=e,t&&this.register(t)}get Module(){if(!this._module)throw new Error("[ZUI] LibLoader.Module is not loaded.");return this._module}register(e){dh(this._name,e)}async load(e){const{throwError:t,noCache:s}=e||{};if(!s){if(this._module!==void 0)return this._module;if(this._error)return}try{this._module=await uh(this._name)}catch(n){if(this._error=n,t)throw n}return this._module}}function Vp(i,e,t){try{return i(...e)}catch(s){t==null||t(s)}}function Wp(i){const e=document.createElement("textarea");e.value=i,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}async function fh(i){typeof i=="string"&&(i={text:i});const e=!navigator.clipboard||!document.hasFocus();let t="";if(Array.isArray(i))if(e){for(const s of i)if(s.types.includes("text/plain")){t=await(await s.getType("text/plain")).text();break}}else{await navigator.clipboard.write(i);return}else{const s={};for(const[n,r]of Object.entries(i)){if(r===void 0)continue;let o=n;if(o==="text"?o="text/plain":o==="html"&&(o="text/html"),e&&o==="text/plain"){t=typeof r=="string"?r:await r.text();break}s[o]=r}e||(i=[new ClipboardItem(s)])}if(e)return Wp(t);await navigator.clipboard.write(i)}var Kp;function qp(i,e,t){i instanceof Headers?i.set(e,t):Array.isArray(i)?i.push([e,t]):i[e]=t}function Cw(i,e){if(i){const t={text:"text/plain",html:"text/html",json:"application/json",...e};for(const[s,n]of Object.entries(t))if(n.split(",").map(r=>r.trim()).includes(i))return s}return"text"}class Sr{constructor(e){this[Kp]="Ajax",this.setting=e,this._controller=new AbortController,this._callbacks={success:[],error:[],complete:[]}}get completed(){return this.data!==void 0||this.error!==void 0}on(e,t){return this._callbacks[e].push(t),this}success(e){return this.on("success",e)}done(e){return this.success(e)}fail(e){return this.on("error",e)}complete(e){return this.on("complete",e)}always(e){return this.complete(e)}then(e,t){return this.completed?t&&this.error?t(this.error):e(this.data):(this.success(s=>e(s)),t&&this.fail(t)),this}catch(e){return this.error?(e(this.error),this):this.on("error",t=>e(t))}finally(e){return this.completed?(e(),this):this.complete(()=>e())}abort(e){return this.completed?!1:(this._abortError=e,this._controller.abort(),!0)}getResponseHeader(e){var t;return(t=this.response)==null?void 0:t.headers.get(e)}_init(){if(this.completed)return;const{url:e,type:t,data:s,processData:n=!0,contentType:r,crossDomain:o,accepts:a,dataType:l,timeout:c,dataFilter:h,beforeSend:d,success:f,error:m,complete:y,...b}=this.setting;t&&(b.method=t);let w=s;w&&(n&&(w=gr(w)),b.body=w),o&&(b.mode="cors");const x=b.headers||{};qp(x,"X-Requested-With","XMLHttpRequest"),r&&qp(x,"Content-Type",r),b.headers=x,b.signal&&b.signal.addEventListener("abort",()=>{this.abort()});const D=[...this.constructor.globalBeforeSends,d];for(const I of D){if(!I)continue;const E=I.call(this,b);if(E===!1)return;E&&Object.assign(b,E)}f&&this.success(f),m&&this.fail(m),y&&this.complete(y),b.signal=this._controller.signal,this.url=e,this.request=b}_emit(e,...t){this._callbacks[e].forEach(s=>{s.call(this,...t)})}async send(){var d;if(this.completed)return[];this._init();const{timeout:e,dataType:t,accepts:s,dataFilter:n,throws:r,jsonParser:o,convert:a}=this.setting;e&&(this._timeoutID=window.setTimeout(()=>{this.abort(new Error("timeout"))},e));let l,c,h;try{l=await fetch(this.url,this.request),this.response=l;const{statusText:f}=l;if(l.ok){const m=(d=l.headers.get("Content-Disposition"))==null?void 0:d.startsWith("attachment"),y=m?"blob":t||Cw(l.headers.get("Content-Type"),s);m||y==="blob"||y==="file"?h=await l.blob():y==="json"?typeof o=="function"?(h=await l.text(),h=o(h)):h=await l.json():y==="js"?(h=await l.text(),h=Ho(h)):h=await l.text(),a&&(h=await a(h,y)),this.data=h;const b=(n==null?void 0:n(h,y))??h;this._emit("success",b,f,l)}else throw this.data=await l.text(),new Error(f)}catch(f){this.data===void 0&&h!==void 0&&(this.data=h),c=f;let m=!1;c.name==="AbortError"&&(this._abortError?c=this._abortError:m=!0),this.error=c,m||this._emit("error",c,l==null?void 0:l.statusText,c.message)}if(this._timeoutID&&clearTimeout(this._timeoutID),this._emit("complete",l,l==null?void 0:l.statusText),c&&r)throw c;return[h,c,l]}}Kp=Symbol.toStringTag,Sr.globalBeforeSends=[],v.ajax=(i,e)=>{e=e||{},typeof i=="string"?e.url=i:v.extend(e,i);const t=new Sr(e);return t.send(),t},v.getJSON=(i,e,t)=>(typeof e=="function"&&(t=e,e=void 0),v.ajax({url:i,data:e,success:t,dataType:"json"})),v.get=(i,e,t,s,n="GET")=>{let r,o;return typeof e=="function"?(r=e,o=void 0):o=e,typeof t=="function"?(r=t,s=void 0):s=t,v.ajax({method:n,url:i,data:o,success:r,dataType:s})},v.post=(i,e,t,s)=>v.get(i,e,t,s,"POST"),v.fn.load=function(i,e,t){typeof e=="function"&&(t=e,e=void 0);const[s,n]=i.split(" ");return v.get(s,e,(r,o,a)=>{n&&(r=v(r).find(n).html()),v(this).html(r).zuiInit(),t==null||t.call(this,r,o,a)},"html"),this};async function Ne(i,e=[],t,s,n){const r={throws:!0,dataType:"json"};if(typeof i=="string")r.url=i;else if(typeof i=="object")v.extend(r,i);else if(typeof i=="function"){const l=i.call(s,...e);return l instanceof Promise?await l:l}t&&v.extend(r,typeof t=="function"?t(r):t),r.url&&(r.url=$e(r.url,...e));const o=new Sr(r);n==null||n(o);const[a]=await o.send();return a}function ph(i){return!!(i&&(typeof i=="string"||typeof i=="object"&&i.url||typeof i=="function"))}v.fetch=Ne;function Tr(i,e={}){const t=v(i)[0];if(!t)return!1;let{viewport:s}=e;const{left:n,top:r,width:o,height:a}=t.getBoundingClientRect();if(e.checkZeroSize&&!(o*a))return!1;if(!s)if(e.container)s=v(t).closest(e.container)[0].getBoundingClientRect();else{const{innerHeight:y,innerWidth:b}=window,{clientHeight:w,clientWidth:x}=document.documentElement;s={left:0,top:0,width:b||x,height:y||w}}const{left:l,top:c,width:h,height:d}=s;if(e.fullyCheck)return n>=l&&r>=c&&n+o<=h+l&&r+a<=d+c;const f=n<=l+h&&n+o>=l;return r<=c+d&&r+a>=c&&f}v.fn.isVisible=function(i){return Tr(this,i)};function xw(i,e="both"){return(e==="vert"||e==="both")&&i.clientHeight<i.scrollHeight||(e==="horz"||e==="both")&&i.clientWidth<i.scrollWidth}function Gp(i,e){const t=v(i),{ifNeeded:s=!0,container:n,...r}=e||{};return t.each((o,a)=>{if(n){const l=v(a).closest(n);if(!l.length||!xw(l[0]))return}if(s){if(a.scrollIntoViewIfNeeded)return a.scrollIntoViewIfNeeded(r);if(Tr(a,{viewport:a.getBoundingClientRect()}))return}a.scrollIntoView(r)}),t}v.fn.scrollIntoView=function(i){return this.each((e,t)=>{Gp(t,i)})};function Zp(i,e){const t=v(i),s=new ResizeObserver(e);return t.each((n,r)=>{s.observe(r)}),s}v.fn.resize=function(i){return Zp(this,i)};function ia(i){const e=v(i);e.css({minHeight:0});const t=+(e.css("max-height")||"").replace("px","");let s=Math.max(32,e[0].scrollHeight);return t&&s>t&&(s=t),e.css({minHeight:s})}v.fn.autoHeight=function(i){return this.each(function(){const e=v(this);e.data("auto-height")||e.on("input paste change",function(){ia(this)}).data("auto-height",!0),i!=null&&i.fast||ia(e),setTimeout(()=>ia(e),100)})},v.autoHeight=ia;const kw=Object.freeze(Object.defineProperty({__proto__:null,isElementDetached:$s,isVisible:Tr,listenResize:Zp,scrollIntoView:Gp},Symbol.toStringTag,{value:"Module"}));var mh,Vt,gh,Yp,Jp=0,Xp=[],mt=tt,Qp=mt.__b,em=mt.__r,tm=mt.diffed,sm=mt.__c,nm=mt.unmount,im=mt.__;function Sw(i,e){mt.__h&&mt.__h(Vt,i,Jp||e),Jp=0;var t=Vt.__H||(Vt.__H={__:[],__h:[]});return i>=t.__.length&&t.__.push({}),t.__[i]}function rm(i,e){var t=Sw(mh++,7);return Dw(t.__H,e)&&(t.__=i(),t.__H=e,t.__h=i),t.__}function Tw(){for(var i;i=Xp.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(ra),i.__H.__h.forEach(yh),i.__H.__h=[]}catch(e){i.__H.__h=[],mt.__e(e,i.__v)}}mt.__b=function(i){Vt=null,Qp&&Qp(i)},mt.__=function(i,e){i&&e.__k&&e.__k.__m&&(i.__m=e.__k.__m),im&&im(i,e)},mt.__r=function(i){em&&em(i),mh=0;var e=(Vt=i.__c).__H;e&&(gh===Vt?(e.__h=[],Vt.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(ra),e.__h.forEach(yh),e.__h=[],mh=0)),gh=Vt},mt.diffed=function(i){tm&&tm(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(Xp.push(e)!==1&&Yp===mt.requestAnimationFrame||((Yp=mt.requestAnimationFrame)||$w)(Tw)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),gh=Vt=null},mt.__c=function(i,e){e.some(function(t){try{t.__h.forEach(ra),t.__h=t.__h.filter(function(s){return!s.__||yh(s)})}catch(s){e.some(function(n){n.__h&&(n.__h=[])}),e=[],mt.__e(s,t.__v)}}),sm&&sm(i,e)},mt.unmount=function(i){nm&&nm(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(s){try{ra(s)}catch(n){e=n}}),t.__H=void 0,e&&mt.__e(e,t.__v))};var om=typeof requestAnimationFrame=="function";function $w(i){var e,t=function(){clearTimeout(s),om&&cancelAnimationFrame(e),setTimeout(i)},s=setTimeout(t,35);om&&(e=requestAnimationFrame(t))}function ra(i){var e=Vt,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),Vt=e}function yh(i){var e=Vt;i.__c=i.__(),Vt=e}function Dw(i,e){return!i||i.length!==e.length||e.some(function(t,s){return t!==i[s]})}var Iw=Symbol.for("preact-signals");function oa(){if(pn>1)pn--;else{for(var i,e=!1;$r!==void 0;){var t=$r;for($r=void 0,_h++;t!==void 0;){var s=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&lm(t))try{t.c()}catch(n){e||(i=n,e=!0)}t=s}}if(_h=0,pn--,e)throw i}}function fn(i){if(pn>0)return i();pn++;try{return i()}finally{oa()}}var Qe=void 0;function vh(i){var e=Qe;Qe=void 0;try{return i()}finally{Qe=e}}var $r=void 0,pn=0,_h=0,aa=0;function am(i){if(Qe!==void 0){var e=i.n;if(e===void 0||e.t!==Qe)return e={i:0,S:i,p:Qe.s,n:void 0,t:Qe,e:void 0,x:void 0,r:e},Qe.s!==void 0&&(Qe.s.n=e),Qe.s=e,i.n=e,32&Qe.f&&i.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=Qe.s,e.n=void 0,Qe.s.n=e,Qe.s=e),e}}function vt(i,e){this.v=i,this.i=0,this.n=void 0,this.t=void 0,this.W=e==null?void 0:e.watched,this.Z=e==null?void 0:e.unwatched,this.name=e==null?void 0:e.name}vt.prototype.brand=Iw,vt.prototype.h=function(){return!0},vt.prototype.S=function(i){var e=this,t=this.t;t!==i&&i.e===void 0&&(i.x=t,this.t=i,t!==void 0?t.e=i:vh(function(){var s;(s=e.W)==null||s.call(e)}))},vt.prototype.U=function(i){var e=this;if(this.t!==void 0){var t=i.e,s=i.x;t!==void 0&&(t.x=s,i.e=void 0),s!==void 0&&(s.e=t,i.x=void 0),i===this.t&&(this.t=s,s===void 0&&vh(function(){var n;(n=e.Z)==null||n.call(e)}))}},vt.prototype.subscribe=function(i){var e=this;return Tt(function(){var t=e.value,s=Qe;Qe=void 0;try{i(t)}finally{Qe=s}},{name:"sub"})},vt.prototype.valueOf=function(){return this.value},vt.prototype.toString=function(){return this.value+""},vt.prototype.toJSON=function(){return this.value},vt.prototype.peek=function(){var i=Qe;Qe=void 0;try{return this.value}finally{Qe=i}},Object.defineProperty(vt.prototype,"value",{get:function(){var i=am(this);return i!==void 0&&(i.i=this.i),this.v},set:function(i){if(i!==this.v){if(_h>100)throw new Error("Cycle detected");this.v=i,this.i++,aa++,pn++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{oa()}}}});function pe(i,e){return new vt(i,e)}function lm(i){for(var e=i.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function cm(i){for(var e=i.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){i.s=e;break}}}function hm(i){for(var e=i.s,t=void 0;e!==void 0;){var s=e.p;e.i===-1?(e.S.U(e),s!==void 0&&(s.n=e.n),e.n!==void 0&&(e.n.p=s)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=s}i.s=t}function Wn(i,e){vt.call(this,void 0),this.x=i,this.s=void 0,this.g=aa-1,this.f=4,this.W=e==null?void 0:e.watched,this.Z=e==null?void 0:e.unwatched,this.name=e==null?void 0:e.name}Wn.prototype=new vt,Wn.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===aa))return!0;if(this.g=aa,this.f|=1,this.i>0&&!lm(this))return this.f&=-2,!0;var i=Qe;try{cm(this),Qe=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return Qe=i,hm(this),this.f&=-2,!0},Wn.prototype.S=function(i){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}vt.prototype.S.call(this,i)},Wn.prototype.U=function(i){if(this.t!==void 0&&(vt.prototype.U.call(this,i),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Wn.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;i!==void 0;i=i.x)i.t.N()}},Object.defineProperty(Wn.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var i=am(this);if(this.h(),i!==void 0&&(i.i=this.i),16&this.f)throw this.v;return this.v}});function xe(i,e){return new Wn(i,e)}function dm(i){var e=i.u;if(i.u=void 0,typeof e=="function"){pn++;var t=Qe;Qe=void 0;try{e()}catch(s){throw i.f&=-2,i.f|=8,bh(i),s}finally{Qe=t,oa()}}}function bh(i){for(var e=i.s;e!==void 0;e=e.n)e.S.U(e);i.x=void 0,i.s=void 0,dm(i)}function Mw(i){if(Qe!==this)throw new Error("Out-of-order effect");hm(this),Qe=i,this.f&=-2,8&this.f&&bh(this),oa()}function Di(i,e){this.x=i,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=e==null?void 0:e.name}Di.prototype.c=function(){var i=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{i()}},Di.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,dm(this),cm(this),pn++;var i=Qe;return Qe=this,Mw.bind(this,i)},Di.prototype.N=function(){2&this.f||(this.f|=2,this.o=$r,$r=this)},Di.prototype.d=function(){this.f|=8,1&this.f||bh(this)},Di.prototype.dispose=function(){this.d()};function Tt(i,e){var t=new Di(i,e);try{t.c()}catch(n){throw t.d(),n}var s=t.d.bind(t);return s[Symbol.dispose]=s,s}var wh;function Ii(i,e){tt[i]=e.bind(null,tt[i]||function(){})}function la(i){wh&&wh(),wh=i&&i.S()}function um(i){var e=this,t=i.data,s=Ew(t);s.value=t;var n=rm(function(){for(var r=e.__v;r=r.__;)if(r.__c){r.__c.__$f|=4;break}return e.__$u.c=function(){var o,a=e.__$u.S(),l=n.value;a(),N.isValidElement(l)||((o=e.base)==null?void 0:o.nodeType)!==3?(e.__$f|=1,e.setState({})):e.base.data=l},xe(function(){var o=s.value.value;return o===0?0:o===!0?"":o||""})},[]);return n.value}um.displayName="_st",Object.defineProperties(vt.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:um},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),Ii("__b",function(i,e){if(typeof e.type=="string"){var t,s=e.props;for(var n in s)if(n!=="children"){var r=s[n];r instanceof vt&&(t||(e.__np=t={}),t[n]=r,s[n]=r.peek())}}i(e)}),Ii("__r",function(i,e){la();var t,s=e.__c;s&&(s.__$f&=-2,(t=s.__$u)===void 0&&(s.__$u=t=function(n){var r;return Tt(function(){r=this}),r.c=function(){s.__$f|=1,s.setState({})},r}())),la(t),i(e)}),Ii("__e",function(i,e,t,s){la(),i(e,t,s)}),Ii("diffed",function(i,e){la();var t;if(typeof e.type=="string"&&(t=e.__e)){var s=e.__np,n=e.props;if(s){var r=t.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in s)&&(a.d(),r[o]=void 0)}else t.U=r={};for(var l in s){var c=r[l],h=s[l];c===void 0?(c=Nw(t,l,h,n),r[l]=c):c.o(h,n)}}}i(e)});function Nw(i,e,t,s){var n=e in i&&i.ownerSVGElement===void 0,r=pe(t);return{o:function(o,a){r.value=o,s=a},d:Tt(function(){var o=r.value.value;s[e]!==o&&(s[e]=o,n?i[e]=o:o?i.setAttribute(e,o):i.removeAttribute(e))})}}Ii("unmount",function(i,e){if(typeof e.type=="string"){var t=e.__e;if(t){var s=t.U;if(s){t.U=void 0;for(var n in s){var r=s[n];r&&r.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}i(e)}),Ii("__h",function(i,e,t,s){(s<3||s===9)&&(e.__$f|=2),i(e,t,s)}),ae.prototype.shouldComponentUpdate=function(i,e){var t=this.__$u,s=t&&t.s!==void 0;for(var n in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){if(!(s||2&this.__$f||4&this.__$f)||1&this.__$f)return!0}else if(!(s||4&this.__$f)||3&this.__$f)return!0;for(var r in i)if(r!=="__source"&&i[r]!==this.props[r])return!0;for(var o in this.props)if(!(o in i))return!0;return!1};function Ew(i){return rm(function(){return pe(i)},[])}const Ch=new Map,fm={};function ot(i,e){typeof i=="object"?Object.keys(i).forEach(t=>{ot(t,i[t])}):e&&(fm[i]=e,Ch.set(i.toLowerCase(),e))}function pm(i){return Ch.get(i.toLowerCase())}class Ke extends ae{constructor(e){super(e),this._gid=Xe(),this.state=this.getDefaultState(e)}get gid(){return this._gid}get element(){return document.querySelector(`[z-gid-${this._gid}]`)}get i18nData(){return[this.props.i18n,this.constructor.i18n]}get commandScope(){return this.constructor.NAME}getDefaultState(e){return{}}resetState(e,t){const s=this.getDefaultState(e);t?this.state=s:this.changeState(s)}i18n(e,t,s){const{i18nData:n}=this;return Pe(n,e,t,s,this.props.lang,this.constructor.NAME)??Pe(n,e,t,s,this.props.lang)??`{i18n:${e}}`}changeState(e,t){return new Promise(s=>{this.setState(e,()=>{t==null||t(),s(this.state)})})}executeCommand(e,t=[]){const{onCommand:s,commands:n}=this.props;let r;typeof e=="string"&&(e={name:e});const{scope:o,name:a}=e,l=n?n[`${o}~${a}`]||n[a]:null;return l?l.call(this,e,t):((!e.scope||e.scope===this.commandScope)&&(r=ls(this,e.name,t)),s&&(r=s.call(this,e,t)),r)}_getClassName(e){return e.className}_getProps(e){const{className:t,attrs:s,props:n,data:r,forwardRef:o,children:a,component:l,style:c,class:h,commands:d,onCommand:f,...m}=e,y=new Set(this.constructor.customProps),b="dangerouslySetInnerHTML",w=Object.keys(m).reduce((x,D)=>{if(!y.has(D)&&(D===b||/^(on[A-Z]|data-|zui-|z-)[a-zA-Z-]+/.test(D))){const I=m[D];x[D]=D!==b&&I&&typeof I=="object"?JSON.stringify(I):I}return x},{});return{ref:o,className:K(this._getClassName(e),h)||void 0,style:c,[`z-gid-${this._gid}`]:"",...w,...s,...n}}_getComponent(e){const{component:t="div"}=e;return(typeof t=="string"?pm(t):t)||t}_getChildren(e){return e.children}_beforeRender(e){return e}_onRender(e,t,s,n){return[e,t,s]}componentDidMount(){const{commands:e,onCommand:t}=this.props;(e||t)&&$i(this.element,{commands:e,scope:this.commandScope,onCommand:this.executeCommand.bind(this)})}componentWillUnmount(){const{commands:e,onCommand:t}=this.props;(e||t)&&xr(this.element,this.commandScope)}render(e){e=this._beforeRender(e)||e;let t=this._getComponent(e),s=this._getChildren(e),n=this._getProps(e);const r=this._onRender(t,n,s,e);return r&&([t,n,s]=r),g(t,n,s)}}Ke.HElement=!0,Ke.customProps=[];class ca extends Ke{constructor(e){super(e),this.signals={};const{state:t}=this;this.changeState(t),this.state={}}changeState(e,t){return new Promise(s=>{fn(()=>{typeof e=="function"&&(e=e(this.state));for(const n in e){const r=this.signals[n];r?r.value=e[n]:this.signals[n]=pe(e[n])}s(this.state),t==null||t()})})}resetState(e){this.changeState(this.getDefaultState(e))}}ca.HElementSignals=!0;var Aw=0;function k(i,e,t,s,n,r){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var c={type:i,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Aw,__i:-1,__u:0,__source:n,__self:r};if(typeof i=="function"&&(o=i.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return tt.vnode&&tt.vnode(c),c}class Ds extends ae{constructor(){super(...arguments),this._ref=ye()}_runJS(){this.props.executeScript&&v(this._ref.current).runJS().zuiInit()}componentDidMount(){this._runJS()}componentDidUpdate(e){this.props.html!==e.html&&this._runJS()}render(e){const{executeScript:t,html:s,...n}=e;return k(Ke,{forwardRef:this._ref,dangerouslySetInnerHTML:{__html:s},...n})}}function mm(i){const{tag:e,className:t,style:s,renders:n,generateArgs:r=[],generatorThis:o,generators:a,onGenerate:l,onRenderItem:c,...h}=i,d=[t],f={...s},m=[],y=[];return n.forEach(b=>{const w=[];if(typeof b=="string"&&a&&a[b]&&(b=a[b]),typeof b=="function")if(l)w.push(...l.call(o,b,m,...r));else{const x=b.call(o,m,...r);x&&(Array.isArray(x)?w.push(...x):w.push(x))}else w.push(b);w.forEach(x=>{x!=null&&(typeof x=="object"&&!N.isValidElement(x)&&("html"in x||"__html"in x||"className"in x||"style"in x||"attrs"in x||"children"in x)?x.html?m.push(k("div",{className:K(x.className),style:x.style,dangerouslySetInnerHTML:{__html:x.html},...x.attrs??{}})):x.__html?y.push(x.__html):(x.style&&Object.assign(f,x.style),x.className&&d.push(x.className),x.children&&m.push(x.children),x.attrs&&Object.assign(h,x.attrs)):m.push(x))})}),y.length&&Object.assign(h,{dangerouslySetInnerHTML:{__html:y}}),[{className:K(d),style:f,...h},m]}function xh({tag:i="div",...e}){const[t,s]=mm(e);return g(i,t,...s)}class ha extends ae{constructor(){super(...arguments),this.state={},this._ref=ye()}async load(e){const{props:t}=this,{fetcher:s,type:n,fetcherArgs:r,fetcherThis:o=this,clearBeforeLoad:a}=t;this.setState({loading:!0,error:void 0,...a?{content:void 0}:{}});try{const l=await Ne(e||s,r,{throws:!0,dataType:n==="custom"?"json":"text"},o,c=>{this._ajax=c});this.setState({content:l,loading:!1})}catch(l){this.setState({error:l,loading:!1})}this._ajax=void 0}componentDidMount(){this.load(),v(this._ref.current).on("loadContent.zui",(e,t)=>{e.stopPropagation(),this.load(t)})}componentDidUpdate(e){(this.props.fetcher!==e.fetcher||this.props.fetcherArgs!==e.fetcherArgs||this.props.fetcherThis!==e.fetcherThis)&&this.load()}componentWillUnmount(){var e;(e=this._ajax)==null||e.abort(),v(this._ref.current).off(".zui")}_renderContent(e,t){const{loading:s,error:n,content:r=""}=this.state,{loadingContent:o,errorText:a,type:l,clearBeforeLoad:c,...h}=t;return s&&c?o:n?a??n.message:l==="html"?k(Ds,{html:r,executeScript:!0,...h}):l==="text"?r:k(fe,{content:r,...h})}render(e){const{loading:t}=this.state,{id:s,loadingClass:n,loadingIndicator:r,className:o,style:a,attrs:l,loadingText:c,...h}=e;return k("div",{id:s,ref:this._ref,className:K("lazy-content",o,t?n:"",r?"load-indicator":""),"data-loading":c,style:a,...l,children:this._renderContent(e,h)})}}ha.defaultProps={type:"html",loadingIndicator:!0,loadingClass:"loading",clearBeforeLoad:!0};function da(i){const{content:e,generatorArgs:t,generatorThis:s,...n}=i;let r=e;if(typeof r=="function"&&(r=r.call(s,...t||[])),Array.isArray(r))return r.map(o=>da({...n,content:o,generatorThis:s,generatorArgs:t}));if(typeof r=="string"||typeof r=="number")return Object.keys(n).length?k("div",{...n,children:r}):r;if(r&&typeof r=="object"&&(typeof r.html=="string"||r.component||r.fetcher)){if(r.fetcher)return k(ha,{...Le(n,r)});if(r.html)return k(Ds,{...Le(n,r)});const{children:o,...a}=r;return o&&(r=Le({children:(Array.isArray(o)?o:[o]).map(l=>da({...n,content:l,generatorThis:s,generatorArgs:t}))},a)),k(Ke,{...Le(n,r)})}return N.isValidElement(r)?r:(r&&(console.groupCollapsed("[ZUI] CustomContent format error"),console.trace("content:",r),console.log("props:",i),console.groupEnd()),null)}function fe(i){const e=da(i);return e==null||typeof e=="boolean"?null:N.isValidElement(e)?e:k(cn,{children:e})}class gm extends ae{render(e){return fe(e)}}const ym=i=>i.startsWith("icon-")?i:`icon-${i}`;function Ie(i){const{icon:e,className:t,...s}=i;if(!e)return null;if(N.isValidElement(e))return e;const n=["icon",t];if(typeof e=="string")n.push(ym(e));else if(typeof e=="object"){const{className:r,icon:o,...a}=e;n.push(r,o?ym(o):""),Object.assign(s,a)}return k("i",{className:K(n),...s})}function Pw(i){return this.getChildContext=()=>i.context,i.children}function kh(i){const e=this,t=i._container;e.componentWillUnmount=function(){hn(null,e._temp),e._temp=null,e._container=null},e._container&&e._container!==t&&e.componentWillUnmount(),i._vnode?(e._temp||(e._container=t,e._temp={nodeType:1,parentNode:t,childNodes:[],appendChild(s){this.childNodes.push(s),e._container.appendChild(s)},insertBefore(s,n){this.childNodes.push(s),e._container.appendChild(s)},removeChild(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),e._container.removeChild(s)}}),hn(g(Pw,{context:e.context},i._vnode),e._temp)):e._temp&&e.componentWillUnmount()}function vm(i,e){const t=g(kh,{_vnode:i,_container:e});return t.containerInfo=e,t}class ua extends ae{constructor(){super(...arguments),this._ref=ye(),this._eleRef=ye()}get $(){return this._ref.current}initZuiComponent(){this._ref.current&&this._ref.current.destroy();const{$tagName:e,$rootAttrs:t,$forceUpdate:s,$use:n,$options:r,...o}=this.props;this._ref.current=Jo(n,this._eleRef.current,{...r,...o})}updateZuiComponent(){var a;const{$tagName:e,$rootAttrs:t,$forceUpdate:s,$use:n,$options:r,...o}=this.props;(a=this._ref.current)==null||a.render({...r,...o})}componentDidMount(){this.initZuiComponent()}componentDidUpdate(e){e.$forceUpdate!==this.props.$forceUpdate||e.$use!==this.props.$use||e.$tagName!==this.props.$tagName?this.initZuiComponent():this.updateZuiComponent()}componentWillUnmount(){var e;(e=this._ref.current)==null||e.destroy()}render(e){const{$tagName:t="div",$rootAttrs:s}=e;return k(t,{ref:this._eleRef,...s})}}ot({HElement:Ke,element:Ke,HtmlContent:Ds,html:Ds,CustomContent:fe,LazyContent:ha,custom:fe,lazy:ha,Icon:Ie,Portal:kh,ZUI:ua});class be extends Ze{constructor(){super(...arguments),this._ref=ye()}get $(){return this._ref.current}get i18nData(){const{i18n:e,i18nData:t}=this.constructor.Component;return t?[...t,this.constructor.i18n]:[e,...super.i18nData]}afterInit(){this.render()}destroy(){var e,t;(t=(e=this.$)==null?void 0:e.componentWillUnmount)==null||t.call(e),this.element&&(this.element.innerHTML=""),super.destroy()}_getRenderProps(e){return{ref:this._ref,...e}}render(e,t){var m;const{element:s,$:n}=this,{Component:r,replace:o}=this.constructor;super.render(e,t);const{$replace:a=o,$optionsFromDataset:l,$class:c,$style:h,...d}=this.options,f=this._getRenderProps(d);if(t&&((m=n==null?void 0:n.resetState)==null||m.call(n,f)),a&&r.HElement&&(s.tagName.toLowerCase()===a||a===!0)){const y=Array.from(s.attributes).reduce((b,w)=>{const{name:x,value:D}=w;return b[x==="class"?"className":x]=D,b},{});hn(g(r,Le({component:s.tagName.toLowerCase(),attrs:y},f)),s.parentElement,s)}else hn(g(r,f),s)}static renderHTML(e){const t=document.createElement("div");return hn(g(this.Component,e),t),t.innerHTML}}be.replace=!1;class fa extends be{}fa.NAME="Custom",fa.Component=gm,fa.register();var _m=function(i,e,t,s){var n;e[0]=0;for(var r=1;r<e.length;r++){var o=e[r++],a=e[r]?(e[0]|=o?1:2,t[e[r++]]):e[++r];o===3?s[0]=a:o===4?s[1]=Object.assign(s[1]||{},a):o===5?(s[1]=s[1]||{})[e[++r]]=a:o===6?s[1][e[++r]]+=a+"":o?(n=i.apply(a,_m(i,a,t,["",null])),s.push(n),a[0]?e[0]|=2:(e[r-2]=0,e[r]=n)):s.push(a)}return s},bm=new Map;function Sh(i){var e=bm.get(this);return e||(e=new Map,bm.set(this,e)),(e=_m(this,e.get(i)||(e.set(i,e=function(t){for(var s,n,r=1,o="",a="",l=[0],c=function(f){r===1&&(f||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?l.push(0,f,o):r===3&&(f||o)?(l.push(3,f,o),r=2):r===2&&o==="..."&&f?l.push(4,f,0):r===2&&o&&!f?l.push(5,0,!0,o):r>=5&&((o||!f&&r===5)&&(l.push(r,0,o,n),r=6),f&&(l.push(r,f,0,n),r=6)),o=""},h=0;h<t.length;h++){h&&(r===1&&c(),c(h));for(var d=0;d<t[h].length;d++)s=t[h][d],r===1?s==="<"?(c(),l=[l],r=3):o+=s:r===4?o==="--"&&s===">"?(r=1,o=""):o=s+o[0]:a?s===a?a="":o+=s:s==='"'||s==="'"?a=s:s===">"?(c(),r=1):r&&(s==="="?(r=5,n=o,o=""):s==="/"&&(r<5||t[h][d+1]===">")?(c(),r===3&&(l=l[0]),r=l,(l=l[0]).push(2,0,r),r=0):s===" "||s==="	"||s===`
`||s==="\r"?(c(),r=2):o+=s),r===3&&o==="!--"&&(r=4,l=l[0])}return c(),l}(i)),e),arguments,[])).length>1?e:e[0]}const Lw=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];let Th=i=>String(i).replace(/[&<>"']/g,e=>`&${Rw[e]};`),Rw={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},$h="dangerouslySetInnerHTML",wm={className:"class",htmlFor:"for"},Cm={};function xm(i,e){let t=[],s="";e=e||{};for(let n=arguments.length;n-- >2;)t.push(arguments[n]);if(typeof i=="function")return e.children=t.reverse(),i(e);if(i){if(s+="<"+i,e)for(let n in e)e[n]!==!1&&e[n]!=null&&n!==$h&&(s+=` ${wm[n]?wm[n]:Th(n)}="${Th(e[n])}"`);s+=">"}if(Lw.indexOf(i)===-1){if(e[$h])s+=e[$h].__html;else for(;t.length;){let n=t.pop();if(n)if(n.pop)for(let r=n.length;r--;)t.push(n[r]);else s+=Cm[n]===!0?n:Th(n)}s+=i?`</${i}>`:""}return Cm[s]=!0,s}const zw=Sh.bind(g),Fw=Sh.bind(xm);class we extends Ke{_beforeRender(e){const{text:t,loading:s,loadingText:n,caret:r,icon:o,trailingIcon:a,children:l}=e;this._isEmptyText=t==null||typeof t=="string"&&!t.length||s&&!n,this._onlyCaret=r&&this._isEmptyText&&!o&&!a&&!l&&!s}_getChildren(e){const{loading:t,loadingIcon:s,loadingText:n,icon:r,iconClass:o,text:a,textClass:l,children:c,trailingIcon:h,trailingIconClass:d,caret:f}=e;return[t?k(Ie,{icon:s||"icon-spinner-snake",className:"spin"}):k(Ie,{icon:r,className:o}),this._isEmptyText?null:k("span",{className:K("text",l),children:t?n:a}),t?null:c,t?null:k(Ie,{icon:h,className:d}),t?null:f?k("span",{className:typeof f=="string"?`caret-${f}`:"caret"}):null]}_getClassName(e){const{type:t,className:s,disabled:n,loading:r,active:o,children:a,square:l,size:c,rounded:h}=e;return["btn",t,s,{"btn-caret":this._onlyCaret,disabled:n||r,active:o,loading:r,square:l===void 0?!this._onlyCaret&&!a&&this._isEmptyText:l},c?`size-${c}`:"",typeof h=="string"?`rounded-${h}`:{rounded:h}]}_getComponent(e){return e.component||(e.url?"a":"button")}_getProps(e){const t=this._getComponent(e),{url:s,target:n,disabled:r,btnType:o="button",size:a,hint:l,command:c}=e,h=t==="a",d={...super._getProps(e),type:h?void 0:"button",disabled:!h&&r?"":void 0,title:l};return o&&(["button","reset","submit"].includes(o)?t==="button"&&(d.type=o):d.className=K([d.className,o])),r||(s!==void 0&&(d[h?"href":"data-url"]=s),n!==void 0&&(d[h?"target":"data-target"]=n),c&&(d["zui-command"]=c)),a&&typeof a=="number"&&Le(d,{style:{"--btn-height":`${a}px`}}),d}}ot(Object.freeze(Object.defineProperty({__proto__:null,Button:we},Symbol.toStringTag,{value:"Module"})));const MT="",NT="",ET="",AT="";let qs=class extends Ke{constructor(e){super(e),this._handleChange=t=>{const{onChange:s}=this.props,n=t.target.indeterminate?"indeterminate":t.target.checked;this._controlled||this.setState({checked:n}),s&&s.call(this,t,n)},this.state={checked:e.checked??e.defaultChecked??!1},this._controlled=e.checked!==void 0}get checked(){return this._controlled?this.props.checked:this.state.checked}_getClassName(e){const{disabled:t,type:s="checkbox"}=e,{checked:n}=this;return[e.className,s==="switch"?s:`${s}-primary`,{disabled:t,checked:n===!0,indeterminate:n==="indeterminate"}]}_getChildren(e){const{name:t,type:s,value:n,id:r,label:o}=e,{checked:a}=this;return[t!==!1?k("input",{type:s==="radio"?s:"checkbox",name:t,id:r,value:n,onChange:this._handleChange,indeterminate:a==="indeterminate",checked:typeof a=="boolean"?a:void 0},"input"):null,k("label",{htmlFor:r,children:k(fe,{content:o})},"label")]}};class Ow extends qs{}Ow.defaultProps={type:"radio"};class jw extends qs{}jw.defaultProps={type:"switch"};class Bw extends Ke{constructor(e){super(e),this._defaultID=`_check-list-${this._gid}`,this._handleChange=t=>{var l;const s=t.target.checked,{checked:n,isRadio:r}=this;if(r&&!s)return;const o=t.target.value;let a;r?a=o:a=s?n.includes(o)?n:[...n,o]:n.filter(c=>c!==o),a!==n&&(this._controlled||this.setState({checked:a}),t.stopPropagation(),(l=this.props.onChange)==null||l.call(this,a,t))},this.state={checked:e.checked??e.defaultChecked??(e.type==="radio"?"":[]),items:Array.isArray(e.items)?e.items:void 0},this._controlled=e.checked!==void 0}get isRadio(){return this.props.type==="radio"}get checked(){return this._controlled?this.props.checked??(this.isRadio?"":[]):this.state.checked}async load(){const{items:e}=this.props;if(!e||Array.isArray(e)){this.state.items!==e&&this.setState({items:Array.isArray(e)?e:[]});return}const t=await Ne(e);e===this.props.items&&this.setState({items:t})}componentDidUpdate(e){const{items:t}=this.props;t&&!Array.isArray(t)&&yr(t,e.items)&&this.load()}_getClassName(e){const{disabled:t,inline:s,type:n="checkbox"}=e,{checked:r}=this;return[e.className,s?"check-list-inline":"check-list",`is-type-${n}`,{disabled:t,loading:this.state.items===void 0,"has-checked":r.length}]}_getProps(e){return Le(super._getProps(e),{id:this._defaultID})}_getChildren(e){const{name:t,id:s=this._defaultID,disabled:n,type:r="checkbox"}=e,{items:o,checked:a}=this.state;return o==null?void 0:o.map(l=>k(qs,{name:t,id:`${s}_${l.value}`,label:l.label??l.text,type:r,value:l.value,checked:a.includes(l.value),onChange:this._handleChange,disabled:n},l.value))}}class pa extends be{}pa.NAME="Checkbox",pa.Component=qs,pa.register();const PT="";let $t=class extends Ke{constructor(e){super(e),this._forceUpdateKeyPrefix=0,this._handleClick=this._handleClick.bind(this)}get name(){return this.props.name||this.constructor.NAME}get itemName(){return this.props.itemName||this.constructor.ITEM_NAME}resetState(e,t){this._forceUpdateKeyPrefix++,super.resetState(e,t)}getItems(){return this._items}getRenderedItem(e){return this._renderedItems.find(t=>t.key===e)}getItem(e){return this._items[this.getItemIndex(e)]}getItemIndex(e){return this._renderedItems.findIndex(t=>t.key===e)}getItemByIndex(e){return this._items[e]}getKey(e){var t,s;return(s=(t=this._renderedItems)==null?void 0:t[e])==null?void 0:s.key}_getItemFromEvent(e,t){var l;const s=(t||e.target).closest("[z-item]");if(!s||!((l=s.parentElement)!=null&&l.hasAttribute(`z-gid-${this._gid}`)))return;const n=+s.getAttribute("z-item"),r=this._items[n];if(!r)return;const o=this.getKey(n);if(o===void 0)return;const a=this._renderedItems[n];return{index:n,item:r,element:s,event:e,key:o,renderedItem:a,relativeTarget:this.props.relativeTarget}}_handleClick(e){var s,n;const t=this._getItemFromEvent(e);if(t)return(s=this.props.onClickItem)==null||s.call(this,t),(n=t.item.onClick)==null||n.call(this,e,t),t}_renderItem(e,t,s){const{beforeRenderItem:n}=e;if(n){const h=n.call(this,t,s);h!==void 0&&(t=h)}const{type:r}=t,o=`${this._forceUpdateKeyPrefix}:${t.key}`;let{itemRender:a}=e;if(a&&typeof a=="object"&&(a=a[r]),a){const h=a.call(this,t,s);if(h!==void 0)return k(fe,{"z-key":t.key,"z-item":s,"z-type":r,content:h},o)}const{ItemComponents:l}=this.constructor;let c=l[r];if(!c&&t.component)return k(fe,{"z-key":t.key,"z-item":s,"z-type":r,content:{...t}},o);if(c=c||l.default||Ke,Array.isArray(c)){let h=c[1];typeof h=="function"&&(h=h.call(this,t,e)),t=Le({},h,t),c=c[0]}return k(c,{"z-key":t.key,"z-item":s,"z-type":r,...t},o)}_getItem(e,t,s){if(!t)return!1;const{itemProps:n,itemPropsMap:r={},getItem:o,itemKey:a}=e,{type:l=this.constructor.defaultItemType}=t,{name:c,itemName:h}=this,{defaultItemProps:d={},defaultItemPropsMap:f={}}=this.constructor;if(t=Le({type:l},d,f[l],n,r[l],{className:[c?`${c}-${l}`:"",h]},t,{_item:t,_index:s,key:String((a?t[a]:t.key)??t.key??s),onClick:void 0}),o){const m=o.call(this,t,s);if(m!==void 0)return m}return t}_getProps(e){const t=super._getProps(e);return{onClick:this._handleClick,...t}}_getClassName(e){return[this.name,e.className]}_getItems(e){let{items:t=[]}=e;typeof t=="function"?t=t.call(this):Array.isArray(t)||(t=[]);const{getItems:s}=e;if(s){const n=s.call(this,t);if(n!==void 0)return n}return t}_renderItems(e,t){return this._renderedItems=t.map((s,n)=>{const r=this._getItem(e,s,n);return r||void 0}),this._renderedItems.reduce((s,n,r)=>(n&&s.push(this._renderItem(e,n,r)),s),[])}_getChildren(e){const t=this._getItems(e);this._items=t;const s=this._renderItems(e,t);return e.children&&s.push(e.children),s}_getComponent(e){return e.component||this.constructor.TAG}};$t.NAME="CommonList",$t.ITEM_NAME="item",$t.TAG="ul",$t.ItemComponents={default:Ke,text:[Ke,i=>{const{text:e}=i;return{children:k("span",{className:"text",children:e})}}],divider:[Ke,{className:"divider"}],space:[Ke,i=>{const{space:e,flex:t,style:s}=i;return{style:{width:e,height:e,flex:t,...s}}}]},$t.defaultItemProps={component:"li"},$t.defaultItemPropsMap={},$t.defaultItemType="item",$t.defaultProps={itemKey:"id"};const Hw=Object.freeze(Object.defineProperty({__proto__:null,CommonList:$t},Symbol.toStringTag,{value:"Module"}));let cs=class extends $t{_isBtnType({type:e}){return e==="item"||e==="dropdown"}_getItem(e,t,s){if(!t)return!1;t.type||(t=v.extend({type:t.dropdown||t.items?"dropdown":"item"},t));let n=super._getItem(e,t,s);return n&&(this._isBtnType(n)&&(n=Le({},this._shareBtnProps,n)),n)}_beforeRender(e){const{btnProps:t,btnType:s,size:n}=e;this._shareBtnProps=Le({},t,Yc({btnType:s,size:n}))}};cs.NAME="btn-group",cs.TAG="nav",cs.ItemComponents={...$t.ItemComponents,default:we},cs.defaultItemProps={component:void 0};const LT="",ma=class q_ extends cs{_getProps(e){const{gap:t}=e,s=super._getProps(e);return t&&(typeof t=="number"?s.className=K(s.className,`gap-${t}`):s.style=v.extend(s.style||{},{gap:t})),s}_getItem(e,t,s){const n=super._getItem(e,t,s);if(!n)return n;const{type:r}=n,o=r==="btn-group"||r==="btnGroup";return o&&(n.btnProps=Le({},this._shareBtnProps,n.btnProps)),(o||r==="dropdown")&&!n.relativeTarget&&(n.relativeTarget=e.relativeTarget),n}static render(e,t,s,n){let r=typeof e=="function"?e.call(n??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),s&&(r=Le(s,r)),k(q_,{...r})}};ma.NAME="toolbar",ma.defaultProps={btnProps:{btnType:"ghost"}},ma.ItemComponents={...cs.ItemComponents,btnGroup:cs,angle:[Ke,{className:"angle chevron-right opacity-50 text-xs"}],"btn-group":cs};let Be=ma;const Uw=Object.freeze(Object.defineProperty({__proto__:null,Toolbar:Be},Symbol.toStringTag,{value:"Module"}));let Dr=class extends Ke{constructor(e){super(e),this._handleClickHeader=t=>{const s=t.target;(s.closest(".collapsible-toggle-btn")||this.props.toggleOnClickHeader&&!s.closest("a,button"))&&this.toggle()},this.state={collapsed:e.collapsed??e.defaultCollapsed??!1}}get collapsed(){return this.props.collapsed??this.state.collapsed}toggle(e){const{collapsed:t,onChange:s}=this.props;if(t===void 0){let n;this.setState(r=>(e=e??!r.collapsed,e!==r.collapsed?(n=e,{collapsed:e}):null),()=>{s&&typeof n=="boolean"&&s.call(this,n)})}else e=e??!t,t!==e&&(s==null||s.call(this,e))}_getClassName(e){const{disabled:t,header:s,bordered:n,title:r,actions:o}=e,{collapsed:a}=this;return[e.className,"collapsible",{disabled:t,bordered:n,"no-header":s===void 0&&r===void 0&&o===void 0,"is-collapsed":a}]}_renderHeader(e){const{header:t,headerClass:s,collapsedIcon:n,expandedIcon:r,toggleButton:o,title:a,actions:l,caption:c}=e,{collapsed:h}=this,d=h?n:r;return k("div",{className:K("collapsible-header",s),onClick:this._handleClickHeader,children:[k(we,{className:"collapsible-toggle-btn",size:"sm",type:"ghost",icon:d,square:!0,...o,children:d?null:k("span",{class:`text-xs ${h?"chevron-right":"chevron-down"}`})}),a?k(fe,{className:"collapsible-header-title",content:a}):null,c?k(fe,{className:"collapsible-header-caption",content:c}):null,t?k(fe,{content:t}):null,l?k("div",{className:"flex-1"}):null,l?Be.render(l,[],{key:"actions",className:"collapsible-header-actions",relativeTarget:e,size:"sm"},this):null]},"header")}_renderBody(e){const{content:t,contentClass:s,children:n,onlyHideOnCollapsed:r}=e;return!r&&this.collapsed?null:k("div",{className:K("collapsible-body",s),children:[k(fe,{content:t}),n]},"content")}_getChildren(e){return[this._renderHeader(e),this._renderBody(e)]}};Dr.defaultProps={toggleOnClickHeader:!0,onlyHideOnCollapsed:!0};class ga extends be{}ga.NAME="Collapsible",ga.Component=Dr,ga.replace=!0;const RT="";class Ir extends be{}Ir.NAME="CommonList",Ir.Component=$t,Ir.replace=$t.TAG,Ir.register(),ot(Hw);const zT="",FT="",OT="",jT="",BT="",HT="";function Vw(i){if(i.indexOf("#")===0&&(i=i.slice(1)),i.length===3&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),i.length!==6)throw new Error(`Invalid HEX color "${i}".`);return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16)]}function Ww(i){const[e,t,s]=typeof i=="string"?Vw(i):i;return e*.299+t*.587+s*.114>186}function km(i,e){return Ww(i)?(e==null?void 0:e.dark)??"#333333":(e==null?void 0:e.light)??"#ffffff"}function Sm(i,e=255){return Math.min(Math.max(i,0),e)}function Kw(i,e,t){i=i%360/360,e=Sm(e),t=Sm(t);const s=t<=.5?t*(e+1):t+e-t*e,n=t*2-s,r=o=>(o=o<0?o+1:o>1?o-1:o,o*6<1?n+(s-n)*o*6:o*2<1?s:o*3<2?n+(s-n)*(2/3-o)*6:n);return[r(i+1/3)*255,r(i)*255,r(i-1/3)*255]}function qw(i,e){return/^[\u4e00-\u9fa5\s]+$/.test(i)?i.length<=e?i:i.substring(i.length-e):/^[A-Za-z\d\s]+$/.test(i)?i[0].toUpperCase():i.length<=e?i:i.substring(0,e)}let Gs=class extends ae{render(){const{className:e,style:t,size:s="",circle:n,rounded:r,background:o,foreColor:a,icon:l,text:c,code:h,displayText:d,maxTextLength:f=2,src:m,hueDistance:y=43,saturation:b=.4,lightness:w=.6,children:x,...D}=this.props,I=["avatar",e],E={...t,background:o,color:a};let P=32;s&&(typeof s=="number"?(E.width=`${s}px`,E.height=`${s}px`,E.fontSize=`${Math.max(12,Math.round(s/2))}px`,P=s):(I.push(`size-${s}`),P={xs:20,sm:24,lg:48,xl:80}[s])),n?I.push("circle"):r&&(typeof r=="number"?E.borderRadius=`${r}px`:I.push(`rounded-${r}`));let O;if(m)I.push("has-img"),O=k("img",{className:"avatar-img",src:m,alt:c});else if(l)I.push("has-icon"),O=k(Ie,{icon:l});else if(c!=null&&c.length||d!=null&&d.length){const W=d??qw(c||"",f),J=W.length;I.push("has-text",`has-text-${J}`);let Y;P&&P<16*J&&(Y={transform:`scale(${P/(16*J)})`,whiteSpace:"nowrap"}),O=k("div",{"data-actualSize":P,className:"avatar-text",style:Y,children:W})}if(!m)if(o===void 0){const W=(h??c??d)||"",J=(typeof W=="number"?W:rh(W))*y%360;if(E.background=`hsl(${J},${b*100}%,${w*100}%)`,!a){const Y=Kw(J,b,w);E.color=km(Y)}}else!a&&o&&/#?[0-9a-fA-F]{6}/.test(o)&&(E.color=km(o));return k("div",{className:K(I),style:E,...D,children:[O,x]})}};const Gw=Object.freeze(Object.defineProperty({__proto__:null,Avatar:Gs},Symbol.toStringTag,{value:"Module"}));class Is extends Ke{_renderLeading(e){const{icon:t,iconClass:s,avatar:n,toggleIcon:r,leading:o,leadingClass:a,checked:l,checkbox:c,multiline:h}=e,d=[];if(r&&d.push(k(fe,{content:r},"toggleIcon")),l!==void 0&&d.push(k(qs,{className:"item-checkbox",checked:l,...c},"checkbox")),t&&d.push(k(Ie,{className:K("item-icon",s),icon:t},"icon")),n){const m=typeof n=="function"?n.call(this,e):n;m&&(m.className=K("item-avatar",m.className),d.push(k(Gs,{...m},"avatar")))}const f=o?k(fe,{content:o},"leading"):null;return f&&d.push(f),h?d.length?[k("div",{className:K("item-leading",a),children:d},"leading")]:[]:d}_renderContent(e,t){const{textClass:s,titleClass:n,titleAttrs:r,subtitle:o,subtitleClass:a,url:l,target:c,content:h,contentClass:d,contentAttrs:f}=e,m=l&&!t,y=m?"a":"div";let{title:b,text:w}=e;return b===void 0&&(b=w,w=null),[k("div",{className:K("item-content",d),...f,children:[b?k(y,{className:K("item-title",n),href:m?l:void 0,target:m?c:void 0,...r,children:k(fe,{content:b})},"title"):null,o?k("div",{className:K("item-subtitle",a),children:k(fe,{content:o})},"subtitle"):null,w?k("div",{className:K("item-text text",s),children:w},"text"):null,h?k(fe,{content:h},"extraContent"):null]},"content")]}_renderTrailing(e){const{multiline:t,trailing:s,trailingClass:n,trailingIcon:r,trailingIconClass:o,actions:a}=e,l=[];r&&l.push(k(Ie,{className:K("item-trailing-icon",o),icon:r},"trailing-icon")),a&&l.push(Be.render(a,[e],{key:"actions",className:"item-actions",relativeTarget:e,size:"sm"},this));const c=s?k(fe,{content:s},"trailing"):null;return c&&l.push(c),t?l.length?[k("div",{className:K("item-trailing",n),children:[l,c]},"trailing")]:[]:l}_render(e,t){const{innerComponent:s,innerClass:n,innerAttrs:r,url:o,actions:a,target:l,active:c,disabled:h,divider:d,checked:f,multiline:m,title:y,subtitle:b,hint:w,selected:x,command:D,hover:I}=e,E=s||(o&&!a?"a":"div"),P=E==="a",O=Le({key:"item",title:w,className:K("listitem",n,{active:c,disabled:h,"has-divider":d,"no-hover":I===!1,selected:x,checked:f,multiline:m??!!(y&&b),state:P&&!h})},D?{"zui-command":D}:null,P?{href:o||"javascript:;",target:l}:null,t,r);return k(E,{...O,children:[this._renderLeading(e),this._renderContent(e,P),this._renderTrailing(e)]})}_onRender(e,t,s,n){const r=Object.keys(t).reduce((o,a)=>(a.startsWith("data-")&&(o[a]=t[a],delete t[a]),o),{});return[e,t,[this._render(n,r),...Ko(s)]]}}let Dt=class extends $t{constructor(e){super(e),this._activeSet=new Hn(()=>{const t=new Set,{active:s}=this.props;Array.isArray(s)?s.forEach(r=>t.add(r)):typeof s=="string"?t.add(s):s&&Object.keys(s).forEach(r=>s[r]&&t.add(r));const{activeMap:n}=this.state;return Object.keys(n).forEach(r=>n[r]?t.add(r):t.delete(r)),t},()=>[this.state.activeMap,this.props.active]),this.state={checked:{},activeMap:{}}}get namespace(){return`.zui.${this.constructor.NAME}.list_${this.gid}`}get isLazyItems(){const{items:e}=this.props;return e&&!Array.isArray(e)}componentDidMount(){this._afterRender(!0),this.tryLoad(),this.props.activeOnHover&&!this.props.multipleActive&&v(this.element).on(`mouseenter${this.namespace}`,"[z-item]",e=>{const t=this._getItemFromEvent(e);t&&t.renderedItem.type==="item"&&!t.renderedItem.disabled&&t.renderedItem.hover!==!1&&!this.isActive(t.key)&&this.toggleActive(t.key,!0)})}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e;v(this.element).off(this.namespace),(e=this.props.beforeDestroy)==null||e.call(this)}setItems(e,t){const{onLoadFail:s}=this.props;return this.changeState({loading:!1,items:e||[],loadFailed:t?(typeof s=="function"?s.call(this,t):s)||String(t):void 0})}load(){const{items:e,onLoad:t}=this.props;this._loadedSetting=e,this.setState({loading:!0,items:[]},async()=>{try{const s=await Ne(e,[this],{throws:!0});this.setItems((t==null?void 0:t.call(this,s))||s)}catch(s){this.setItems(void 0,s)}})}tryLoad(){const{loading:e}=this.state,{items:t}=this.props;return e||!t||Array.isArray(t)||t===this._loadedSetting?!1:(this.load(),!0)}isChecked(e,t,s=!1){const n=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.state.checked[e]??n.checked??s}isAllChecked(){return this._renderedItems.every(({key:e},t)=>this.isChecked(e,t)===!0)}toggleAllChecked(e){return e===void 0&&(e=!this.isAllChecked()),this.toggleChecked(this._renderedItems.map(t=>t.key),e)}async toggleChecked(e,t){let s;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),s=e.reduce((n,r)=>(n[r]=t,n),{})}else if(typeof e=="object")s=e;else{const n=this.isChecked(e);t===void 0&&(t=!n),s={[e]:t}}Object.keys(s).length&&await this.changeState(n=>({checked:{...n.checked,...s}}),()=>{var r;const n=this.state.checked;(r=this.props.onCheck)==null||r.call(this,s,Object.keys(n).filter(o=>n[o]===!0))})}getChecks(){return this._renderedItems.reduce((e,{key:t},s)=>(t!==void 0&&this.isChecked(t,s)===!0&&e.push(t),e),[])}isActive(e){return typeof e=="object"&&(e=e.key),this._activeSet.cache.has(e)}getActiveKeys(){return[...this._activeSet.value]}getActiveKey(){return this.getActiveKeys()[0]}async toggleActive(e,t){typeof e=="string"&&(e=[e]),e.length&&(t=t??!this.isActive(e[0]),await this.changeState(s=>({activeMap:this.props.multipleActive?e.reduce((r,o)=>(r[o]=t,r),{...s.activeMap}):{[e[0]]:t}}),()=>{var s;(s=this.props.onActive)==null||s.call(this,e,t)}))}getNextItem(e,t,s=1,n=void 0){n=n||this._renderedItems,t=t||(l=>l.type==="item"&&!l.disabled);const r=n.length;let o=e===void 0?r-1:n.findIndex(l=>l.key===e),a=0;for(;a<r;){o=(o+s+r)%r;const l=n[o];if(l&&!l.hidden&&t.call(this,l,o))return l;a++}}getPrevItem(e,t){return this.getNextItem(e,t,-1)}activeNext(e,t=1){const s=this.getNextItem(this.getActiveKey(),e,t);s&&this.toggleActive(s.key)}activePrev(e){this.activeNext(e,-1)}activeFirst(e){const t=this.getNextItem(void 0,e);t&&this.toggleActive(t.key)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_beforeRender(e){var t;return(t=this.props.beforeRender)==null?void 0:t.call(this,e)}_getItems(e){const{items:t}=e,{items:s}=this.state;return s||(Array.isArray(t)?t:[])}_getRenderedItem(e,t,s){const{divider:n,multiline:r}=e;t=Le({},Yc({divider:n,multiline:r}),t);const{itemName:o,name:a}=this;if(t.innerClass=[o?`${o}-inner${a?` ${a}-${t.type}-inner`:""}`:"",t.innerClass],t.type==="item"){const{checkbox:l}=e;t.checkbox===!1?t.checked=void 0:(l||t.checkbox)&&(t.checked=this.isChecked(t.key,s,t.checked),typeof l=="object"&&t.checkbox!==!1&&(t.checkbox=t.checkbox?v.extend({},l,t.checkbox):l),e.selectOnChecked&&t.checked===!0&&(t.selected=!0)),t.active===void 0&&this.isActive(t)&&(t.active=!0)}return t.icon&&(this._hasIcons=!0),t.checked!==void 0&&(this._hasCheckbox=!0),t}_getItem(e,t,s){const n=super._getItem(e,t,s);return n&&this._getRenderedItem(e,n,s)}_renderItem(e,t,s){return t.type==="item"&&this._hasIcons&&t.icon===void 0&&(t.icon="EMPTY"),super._renderItem(e,t,s)}_handleClick(e){const t=super._handleClick(e);let{checkOnClick:s}=this.props;if(s==="any"?s=".item-checkbox,.item-content,.item-icon":s===!0&&(s=".item-checkbox"),!s||!t||!t.renderedItem)return t;const n=t.renderedItem,r=n.checkbox;if(r!==!1&&(this.props.checkbox||r||n.checked!==void 0)&&!n.disabled&&t&&e.target.closest(s)){this.toggleChecked(t.key),e.stopPropagation();return}return t}_getClassName(e){const{loading:t,loadFailed:s}=this.state;return[super._getClassName(e),t?"loading":s?"is-load-failed":"",e.hoverItemActions?"with-hover-actions":""]}_getProps(e){const{className:t,...s}=super._getProps(e);return{...s,className:K(t,this._hasIcons?"has-icons":"",this._hasCheckbox?"has-checkbox":"")}}_getChildren(e){this._hasIcons=!1,this._hasCheckbox=!1,this._activeSet.compute();const t=super._getChildren(e),{loadFailed:s}=this.state;return s&&t.push(s),t}};Dt.ItemComponents={...$t.ItemComponents,default:Ke,item:Is,heading:Is},Dt.NAME="list";const Dh="```ZUI_STR\n";class Mr{constructor(e="",t="local"){this._cache=new Map,this._type=t,this._id=e,this._name=`ZUI_STORE:${this._id}`,this._storage=t==="local"?localStorage:sessionStorage}get type(){return this._type}get session(){return this.type==="session"?this:(this._altStorage||(this._altStorage=new Mr(this._id,"session")),this._altStorage)}_getKey(e){return`${this._name}:${e}`}switch(e){this._id=e,this._name=`ZUI_STORE:${this._id}`,this._cache.clear()}get(e,t){if(this._cache.has(e))return this._cache.get(e);const s=this._storage.getItem(this._getKey(e));if(typeof s=="string"){if(s.startsWith(Dh))return s.substring(Dh.length);try{return JSON.parse(s)}catch{}}return s??t}setCache(e,t){this._cache.set(e,t)}set(e,t){if(t==null)return this.remove(e);try{this._storage.setItem(this._getKey(e),typeof t=="string"?`${Dh}${t}`:JSON.stringify(t))}catch(s){this.setCache(e,t),console.warn(`[ZUI] Failed to set value to ${this._type} store: ${this._getKey(e)}, use cache instead.`,s)}}remove(e){this._cache.delete(e),this._storage.removeItem(this._getKey(e))}each(e){const t=[];for(let s=0;s<this._storage.length;s++){const n=this._storage.key(s);if(n!=null&&n.startsWith(this._name)){const r=this._storage.getItem(n),o=n.substring(this._name.length+1);typeof r=="string"&&e(o,JSON.parse(r)),t.push(o)}}for(const s of this._cache.keys())t.includes(s)||e(s,this._cache.get(s))}getAll(){const e={};this.each((t,s)=>{e[t]=s});for(const t of this._cache.keys())e[t]=this._cache.get(t);return e}}const st=new Mr("DEFAULT");function Zw(i,e="local"){return new Mr(i,e)}Object.assign(st,{create:Zw});const UT="";function Tm(i,e){const{children:t}=i;t.length&&t.forEach(s=>{e(s),Tm(s,e)})}function Yw(i,e){let t=i.parent;for(;t;)e(t),t=t.parent}function $m(i){return i.split(":").reduce((e,t,s)=>(e.push(s?e[s-1]+":"+t:t),e),[])}function Ih(i,e,t,s,n=0,r){return i.reduce((o,a,l)=>{if(!a)return o;const c=String((e?a[e]:a.key)??a.key??l),h=r?`${r.keyPath}:${c}`:c,d={key:c,level:n,keyPath:h,parentKey:r==null?void 0:r.keyPath,parent:r,data:a,children:[]};return r&&r.children.push(d),o=t(o,d),Array.isArray(a.items)?Ih(a.items,e,t,o,n+1,d):o},s)}let Zs=class extends Dt{constructor(e){super(e);const{defaultNestedShow:t,preserve:s,nestedShow:n}=e;if(v.extend(this.state,typeof t=="boolean"?{defaultShow:t,nestedShow:{}}:{nestedShow:t||{}},n!==void 0?{nestedShow:n}:null),s&&n===void 0){this._storeID=`${this.constructor.NAME}:${s}:state`;const r=st.get(this._storeID);r&&(this.state.nestedShow=r.nestedShow)}if(!e.level){const r=this.state.nestedShow;r&&Object.keys(r).forEach(o=>{r[o]&&$m(o).forEach(a=>{r[a]=!0})}),this._needInitChecks=!0}this._renderedItemMap=new Map,this._handleClick=this._handleClick.bind(this),this._beforeRenderNestedItem=this._beforeRenderNestedItem.bind(this),this._handleNestedToggle=this._handleNestedToggle.bind(this),this._handleNestedCheck=this._handleNestedCheck.bind(this),this._preserveState=this._preserveState.bind(this)}get isRoot(){return!this.props.level}get nestedShow(){return this.props.nestedShow??this.state.nestedShow??!1}async setItems(e,t){var n;this.isRoot&&(this._needInitChecks=!0);const s=await super.setItems(e,t);return e&&((n=this.props.parent)==null?void 0:n.checked)===!0?this.toggleChecked(this._renderedItems.map(r=>r.key),!0):e!=null&&e.some(r=>r.checked)&&(this._needInitChecks=!0,this.forceUpdate()),s}getItemMap(e){if(e&&(this._itemMap||this._itemMapCache))return this._itemMap||this._itemMapCache;if(!this._itemMap){let t=!1;const s=Ih(this._items,this.props.itemKey,(n,r)=>(n.set(r.keyPath,r),r.data.items&&!Array.isArray(r.data.items)&&(t=!0),n),new Map);if(t)return this._renderedItemMap.forEach((n,r)=>{s.has(r)||s.set(r,{key:n.key,level:n._level,keyPath:r,parentKey:`${r.split(":").slice(0,-1).join(":")}`,children:[],data:n})}),s.forEach(n=>{const{parentKey:r}=n;if(!r)return;const o=s.get(r);o&&(o.children.push(n),n.parent=o)}),this._itemMapCache=s,s;this._itemMap=s}return this._itemMap}getRenderedItem(e){return this._renderedItemMap.get(e)}getItem(e){var n;const t=this._itemMap||this._itemMapCache;if(t)return(n=t.get(e))==null?void 0:n.data;const s=this.getRenderedItem(e);return s?s._item:super.getItem(e)}isExpanded(e){const{nestedShow:t}=this;return typeof t=="boolean"?t:!!(t[e]??this.state.defaultShow)}isAllExpanded(){const{nestedShow:e}=this;if(typeof e=="boolean")return e;const{defaultShow:t}=this.state;if(!Object.keys(e).length)return!!t;const s=this.getItemMap(!0);return Array.from(s.entries()).every(([n])=>e[n]??t)}async toggle(e,t,s){const n=this.isExpanded(e);if(!s&&t===n)return;t===void 0&&(t=!n);const{nestedShow:r,onToggle:o,accordion:a}=this.props;o&&o.call(this,e,t,s)===!1||r===void 0&&await this.changeState(l=>{let c={...s?{}:l.nestedShow,[e]:t};if(t&&a){let h=`${e.split(":").slice(0,-1).join(":")}`;h.length&&(h+=":"),Object.keys(c).forEach(d=>{d!==e&&d.startsWith(h)&&(c[d]=!1)})}return c=t?$m(e).reduce((h,d)=>(h[d]=t,h),c):c,{nestedShow:c}},this._preserveState)}toggleAll(e){if(this.props.nestedShow===void 0)return this.setState({nestedShow:{},defaultShow:e},this._preserveState)}getChecks(){return Array.from(this.getItemMap(!0).values()).reduce((e,{keyPath:t,data:s})=>{const n=this.state.checked[t];return(n===!0||s.checked&&n!==!1)===!0&&e.push(t),e},[])}isChecked(e,t,s=!1){const n=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.isRoot?this.state.checked[e]??n.checked??s:this.props.checkedState[`${this.props.parentKey}:${e}`]??n.checked??s}async toggleChecked(e,t){let s;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),s=e.reduce((a,l)=>(a[l]=t,a),{})}else typeof e=="object"?s=e:(t===void 0&&(t=!this.isChecked(e)),s={[e]:t});if(!Object.keys(s).length)return;if(this.isRoot){await this.changeState(({checked:a,nestedShow:l})=>{const c=m=>s[m.keyPath]??a[m.keyPath]??m.data.checked??!1,h=this.getItemMap(),d={},{expandChildrenOnCheck:f}=this.props;return Object.keys(s).forEach(m=>{t=s[m];const y=h.get(m);y&&(Tm(y,b=>{c(b)!==t&&(s[b.keyPath]=t)}),Yw(y,b=>{const{children:w}=b,x=w.reduce((D,I)=>(c(I)&&D++,D),0);s[b.keyPath]=x===w.length?!0:x?"indeterminate":!1}),f&&t&&y.data.items&&(d[m]=!0))}),{checked:{...a,...s},nestedShow:{...l,...d}}},()=>{var l;const a=this.state.checked;(l=this.props.onCheck)==null||l.call(this,s,Object.keys(a).filter(c=>a[c]===!0))});return}const{parentKey:n,onCheck:r}=this.props,o=Object.keys(s).reduce((a,l)=>(a[`${n!==void 0?`${n}:`:""}${l}`]=s[l],a),{});r.call(this,o,[])}getKeyPath(e){if(this.isRoot)return e;const t=this.props.parentKey;return e.startsWith(t+":")?e:`${t}:${e}`}isActive(e){if(typeof e=="object"){const t=e._keyPath??e.key;if(t===void 0)return!1;e=t}return this._activeSet.cache.has(this.getKeyPath(e))}async toggleActive(e,t){if(typeof e=="string"&&(e=[e]),e=e.map(s=>this.getKeyPath(s)),this.isRoot){await super.toggleActive(e,t),this.props.toggleOnActive&&e.forEach(s=>{this.isActive(s)&&!this.isExpanded(s)&&this.toggle(s,!0)});return}this.props.onActive.call(this,e,t??!this.isActive(e[0]))}activeNext(e,t=1){const s=this.getNextItem(this.getActiveKey(),e,t);s&&this.toggleActive(s._keyPath)}getNextItem(e,t,s=1,n=void 0){return n=n||Ih(this._items,this.props.itemKey,(r,o)=>(o.data.disabled||r.push({_keyPath:o.keyPath,type:"item",...o.data,...this._renderedItemMap.get(o.keyPath),key:o.keyPath}),r),[]),super.getNextItem(e,t,s,n)}_afterRender(e){if(super._afterRender(e),this._needInitChecks){const t={};this.getItemMap().forEach(n=>{n.data.checked!==void 0&&(t[n.keyPath]=n.data.checked)}),this.toggleChecked(t),this._needInitChecks=!1}}_preserveState(){this._storeID&&st.set(this._storeID,{nestedShow:this.state.nestedShow,defaultShow:this.state.defaultShow})}_getClassName(e){return[super._getClassName(e),"is-nested",e.level?"is-nested-sub":"is-nested-root"]}_getNestedProps(e,t,s,n){const{parentKey:r,level:o=0}=e,{isRoot:a}=this;return Le(this.constructor.inheritNestedProps.reduce((l,c)=>(l[c]=e[c],l),{}),{key:s.key,level:o+1,className:`is-nested-${n?"expanded":"collapsed"}`,items:t,parent:s,parentKey:r?`${r}:${s.key}`:s.key,nestedShow:this.nestedShow,defaultNestedShow:this.state.defaultShow,checkedState:e.checkedState||this.state.checked,onCheck:a?this._handleNestedCheck:e.onCheck,onToggle:a?this._handleNestedToggle:e.onToggle,beforeRenderItem:a?this._beforeRenderNestedItem:e.beforeRenderItem,active:a?this.getActiveKeys():e.active,onActive:a?this.toggleActive.bind(this):e.onActive},s.listProps)}_renderNestedList(e,t,s,n){if(!n&&!e.renderCollapsedList)return;const r=this._getNestedProps(e,t,s,n),o=this.constructor;return k(o,{...r},`nested:${s.key}`)}_renderNestedToggle(e,t){let s,n="";const{toggleIcons:r={}}=e;return typeof t=="boolean"?(s=t?r.expanded||k("span",{className:"caret-down"}):r.collapsed||k("span",{className:"caret-right"}),n=`state is-${t?"expanded":"collapsed"}`,N.isValidElement(s)||(s=k(Ie,{icon:s}))):(s=k(Ie,{icon:r.normal}),n="is-empty"),k("span",{className:K(`${this.name}-toggle nested-toggle-icon`,n),children:s})}_getItems(e){const t=super._getItems(e);return this.isRoot&&t!==this._items&&(this._itemMap=void 0),t}_getItem(e,t,s){const n=super._getItem(e,t,s)??t;if(!n)return n;const{parentKey:r}=e,o=n.key,a=`${r!==void 0?`${r}:`:""}${o}`;if(n.items){const l=n.expanded??this.isExpanded(a);Le(n,{expanded:l,className:["is-nested",`is-nested-${l?"show":"hide"}`]}),this._hasNestedItems=!0}return Le(n,{_level:e.level,_keyPath:a,parentKey:r})}_beforeRenderNestedItem(e,t){const{beforeRenderItem:s}=this.props;if(s){const n=s.call(this,e,t);n!==void 0&&(e=n)}return this._renderedItemMap.set(e._keyPath,e),e}_renderItem(e,t,s){(this._hasNestedItems||!this.isRoot)&&t.type==="item"&&t.toggleIcon===void 0&&(t.toggleIcon=this._renderNestedToggle(e,t.expanded));const n=t.items?this._renderNestedList(e,t.items,t,t.expanded):null;return t=Le(t,{"z-parent":t.parentKey,"z-key-path":t._keyPath},n?{children:n}:null),this._renderedItemMap.set(t._keyPath,t),super._renderItem(e,t,s)}_getItemFromEvent(e,t){t=t||e.target;let s=super._getItemFromEvent(e,t);if(!s){const r=t.closest("[z-list]");if(r){const o=r.getAttribute("z-list"),a=this.getItem(o),l=this.getRenderedItem(o);if(!a||!l)return;s={target:t,index:l._index,item:a,element:r,event:e,key:o,keyPath:o,renderedItem:l}}return}(e.type==="mouseenter"||e.type==="mouseleave"||e.type==="mouseover")&&(s.hover=e.type!=="mouseleave");const{parentKey:n}=this.props;return{...s,parentKey:n,keyPath:`${n!==void 0?`${n}:`:""}${s.key}`,target:t}}_handleNestedToggle(e,t,s){this.toggle(e,t,s)}_handleClick(e){const t=super._handleClick(e);if(t){const{renderedItem:s,keyPath:n,target:r}=t,{nestedToggle:o}=this.props;if(!s.items||e.defaultPrevented||r.closest(".not-nested-toggle")||o&&!s.disabled&&!r.closest(o)||!o&&!s.disabled&&r.closest("a,.btn,.item-checkbox,.open-url,input,select,textarea")&&!r.closest(".nested-toggle-icon,.item-icon"))return t;this.toggle(n),e.preventDefault()}return t}_handleNestedCheck(e){this.toggleChecked(e)}_getProps(e){const{level:t=0,indent:s=20,parentKey:n}=e,r=Le(super._getProps(e),{"z-level":t,"z-list":n,style:{"--list-nested-indent":`${t*s}px`,"--list-indent":`${s}px`},className:this._hasNestedItems?"has-nested-items":"no-nested-items"});return r.className=K(r.className),r}_beforeRender(e){return this._renderedItemMap.clear(),this._hasIcons=!1,this._hasNestedItems=!1,super._beforeRender(e)}};Zs.defaultProps={...Dt.defaultProps,defaultNestedShow:!1,level:0,indent:20},Zs.inheritNestedProps=["component","name","itemName","itemKey","indent","hover","divider","multiline","toggleIcons","nestedToggle","accordion","itemRender","itemProps","onToggle","checkbox","getItem","getItems","checkOnClick","selectOnChecked","checkedState","onClickItem","activeOnHover","multipleActive","onActive","hoverItemActions"];const Jw=Object.freeze(Object.defineProperty({__proto__:null,List:Dt,Listitem:Is,NestedList:Zs},Symbol.toStringTag,{value:"Module"}));class Nr extends be{}Nr.NAME="List",Nr.Component=Dt,Nr.replace=Dt.TAG,Nr.register();class Er extends be{}Er.NAME="NestedList",Er.Component=Zs,Er.replace=Zs.TAG,Er.register(),ot(Jw);const VT="",WT="",KT="",Mi=class G_ extends Zs{constructor(e){super(e),this._handleHover=this._handleHover.bind(this)}get isHoverTrigger(){return this.props.nestedTrigger==="hover"}_getClassName(e){return[super._getClassName(e),this._hasNestedItems?"menu-nested":"",e.className,e.wrap?{"scrollbar-thin":e.scrollbarThin,"scrollbar-hover":e.scrollbarHover}:{popup:e.popup,compact:e.compact}]}_getWrapClass(e){return["menu-wrapper",e.wrapClass,{popup:e.popup,compact:e.compact}]}_getWrapperProps(e){const{wrapAttrs:t,height:s,maxHeight:n,parentKey:r}=e,o=Le({"z-list-wrapper":r},t,s||n?{style:{height:s,maxHeight:n}}:null,this.isRoot&&this.isHoverTrigger?{onMouseEnter:this._handleHover,onMouseLeave:this._handleHover,onMouseOver:this._handleHover}:null);return o.className=K(this._getWrapClass(e),o.className),o}_renderWrapperHeader(e){return k(fe,{content:e.header,generatorThis:this},"header")}_renderWrapperFooter(e){return k(fe,{content:e.footer,generatorThis:this},"footer")}_handleHover(e){const t=e.target;if(!(t instanceof HTMLElement)||!this.isHoverTrigger)return;let s;if(e.type!=="mouseleave"){const c=t.closest("[z-item]");if(c)s=c.getAttribute("z-key-path"),c.classList.contains("is-nested")||(s=c.getAttribute("z-parent"));else{const h=t.closest("[z-list-wrapper]");s=h==null?void 0:h.getAttribute("z-list-wrapper")}}const n=this._hoverInfo,r=n==null?void 0:n.keyPath;if(r===s)return;n!=null&&n.timer&&clearTimeout(n.timer);const o=typeof s=="string",l=o?typeof r=="string"&&(n!=null&&n.shown)?50:200:n!=null&&n.shown?100:200;this._hoverInfo={keyPath:s,timer:window.setTimeout(()=>{o?(this.toggle(s,!0,!0),this._hoverInfo.shown=!0):(this.toggleAll(!1),this._hoverInfo=void 0)},l)}}componentWillUnmount(){var t;super.componentWillUnmount();const e=(t=this._hoverInfo)==null?void 0:t.timer;e&&clearTimeout(e)}render(e){const t=super.render(e);return e.wrap?k("menu",{...this._getWrapperProps(e),children:[this._renderWrapperHeader(e),t,this._renderWrapperFooter(e)]}):t}static render(e,t,s,n){let r=typeof e=="function"?e.call(n??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),s&&(r=Le(s,r)),k(G_,{...r})}};Mi.NAME="menu",Mi.TAG="menu",Mi.inheritNestedProps=[...Zs.inheritNestedProps,"compact"],Mi.ItemComponents={...Zs.ItemComponents,item:[Is,{innerComponent:"a"}]},Mi.defaultProps={...Zs.defaultProps,scrollbarHover:!0};let Rt=Mi;const qT="",GT="",ZT="";let mn=class extends ae{constructor(e){super(e),this._input=ye(),this._timer=0,this._handleClearBtnClick=t=>{t.stopPropagation(),this.clear(t)},this._handleChange=t=>{const s=this.state.value,n=t.target.value,{onChange:r,delay:o}=this.props;this.setState({value:n},()=>{!r||s===n||(o?(this._clearTimer(),this._timer=window.setTimeout(()=>{r(n,t),this._timer=0},o)):r(n,t))})},this._handleFocus=t=>{const s=t.type==="focus";this.setState({focus:s},()=>{const n=s?this.props.onFocus:this.props.onBlur;n==null||n(t)})},this.state={focus:!1,value:e.defaultValue||""},this._gid=e.id||`search-box-${Xe()}`}componentDidMount(){const{hotkeys:e}=this.props;if(e){const t=Qc(e,{clear:{keys:"Escape",handler:s=>{this.clear(s)}},enter:{keys:"Enter",handler:s=>{var n,r;(r=(n=this.props).onEnter)==null||r.call(n,this.state.value,s)}}});t&&(this._hotkeysScope=`SearchBox_${this._gid}`,v(this.input).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}}componentWillUnmount(){this._hotkeysScope&&v(this.input).unbindHotkeys(this._hotkeysScope)}get id(){return this._gid}get input(){return this._input.current}focus(){var e;(e=this.input)==null||e.focus()}blur(){var e;(e=this.input)==null||e.blur()}clear(e){const t=this.state.value;this.setState({value:""},()=>{const{onChange:s,onClear:n}=this.props;n==null||n(e),this.focus(),t.trim()!==""&&(s==null||s("",e))})}_clearTimer(){this._timer&&clearTimeout(this._timer),this._timer=0}render(e,t){const{style:s,className:n,rootClass:r,rootStyle:o,readonly:a,disabled:l,circle:c,placeholder:h,mergeIcon:d,searchIcon:f,clearIcon:m,value:y,compact:b,prefixClass:w,suffixClass:x,name:D}=e,{focus:I,value:E}=t,{id:P}=this,O=y??E,W=typeof O!="string"||!O.trim().length;let J,Y,ve;return f&&(ve=f===!0?k("span",{class:"magnifier"}):k(Ie,{icon:f})),!d&&f&&(J=k("label",{for:P,class:K("input-control-prefix",w),children:ve},"prefix")),m&&!W?Y=k("button",{type:"button",class:"btn ghost size-sm square rounded-full",onClick:this._handleClearBtnClick,children:m===!0?k("span",{class:"close"}):k(Ie,{icon:m})}):d&&f&&(Y=ve),Y&&(Y=k("label",{for:P,class:K("input-control-suffix",x),children:Y},"suffix")),k("div",{class:K("search-box input-control",r,{focus:I,empty:W,compact:b,"has-prefix-icon":J,"has-suffix-icon":Y}),style:o,children:[J,k("input",{ref:this._input,id:P,name:D,type:"text",class:K("form-control",{"rounded-full":c,"size-sm":b},n),style:s,placeholder:h,disabled:l,readonly:a,value:O,onInput:this._handleChange,onChange:this._handleChange,onFocus:this._handleFocus,onBlur:this._handleFocus},"input"),Y]})}};mn.defaultProps={clearIcon:!0,searchIcon:!0,delay:500,hotkeys:!0};const Xw=Object.freeze(Object.defineProperty({__proto__:null,SearchBox:mn},Symbol.toStringTag,{value:"Module"}));let dt=class extends Rt{constructor(e){super(e),this._handleSearchChange=t=>{const s=this.constructor.getSearchKeys(t);this._searchKeys=s,this.setState({search:s.join(" ")})},this.state.search=e.search??e.defaultSearch,this._searchKeys=this.constructor.getSearchKeys(this.state.search),this._isNestedItemMatch=this._isNestedItemMatch.bind(this)}componentWillUpdate(e){this.isRoot&&e.search!==void 0&&e.search!==this.props.search&&(this._searchKeys=this.constructor.getSearchKeys(e.search))}componentDidMount(){super.componentDidMount(),this._updateMatchedParents()}componentDidUpdate(){super.componentDidUpdate(),this._updateMatchedParents()}isExpanded(e){return this.props.expandOnSearch&&this._searchKeys.length?!0:super.isExpanded(e)}_updateMatchedParents(){var s;if(!this.isRoot)return;const e=v(this.element),t=e.find(".item.is-nested.is-not-match").filter((n,r)=>this._matchedParents.has(r.getAttribute("z-key-path")||"")).addClass("has-match-child");e.parent().toggleClass("no-match-child",!!((s=this._searchKeys)!=null&&s.length)&&!t.length&&!e.children(".item").not(".is-not-match").length)}_isItemMatch(e,t,s,n){const{isItemMatch:r,nestedSearch:o}=e,a=r?r.call(this,t,this._searchKeys,s,n):this.constructor.isItemMatch(t,this._searchKeys,e.searchProps);if(o&&this.isRoot&&a&&n!==void 0){let l="";String(n).split(":").forEach(c=>{l+=`${l.length?":":""}${c}`,this._matchedParents.add(l)})}return a}_isNestedItemMatch(e,t,s,n){return this._isItemMatch(this.props,e,s,n)}_getNestedProps(e,t,s,n){const r=super._getNestedProps(e,t,s,n);return this.isRoot&&e.nestedSearch?(r.isItemMatch=this._isNestedItemMatch,r.search=this._searchKeys.join(" ")):e.nestedSearch||Le(r,{search:void 0,defaultSearch:void 0},s.listProps),r}_getItem(e,t,s){const n=super._getItem(e,t,s);return n&&(this.isRoot&&this.props.limit&&this._showCount>=this.props.limit?!1:(n.hidden=!this._isItemMatch(e,t,s,e.parentKey),n.hidden||this._showCount++,n))}_renderItem(e,t,s){return t.hidden&&!this._hasNestedItems?null:(t.className=[t.className,t.hidden?"is-not-match":""],!t.hidden&&e.underlineKeys&&this._searchKeys.length&&["text","title","subtitle","content"].forEach(n=>{typeof t[n]=="string"&&(t[n]=this.constructor.underlineKeys(this._searchKeys,[t[n]]))}),super._renderItem(e,t,s))}_getWrapClass(e){const t=this.isRoot&&this._searchKeys.length;return K(super._getWrapClass(e),"search-menu",e.searchBox?`search-menu-on-${e.searchPlacement||"top"}`:"",t?"is-search-mode":"",t&&e.expandOnSearch?"no-toggle-on-search":"")}_getSearchBoxProps(e){const{searchBox:t}=e,s={compact:!0,className:"not-nested-toggle",onChange:this._handleSearchChange};return typeof t=="object"&&Le(s,t),e.search!==void 0&&(s.value=this._searchKeys.join(" "),s.disabled=!0),s}_renderSearchBox(e){const t=this._getSearchBoxProps(e);return k(mn,{...t},"search")}_renderWrapperHeader(e){const t=e.header,{noMatchHint:s,searchBox:n,searchPlacement:r,nestedSearch:o,headerClass:a}=e,l=(!o||this.isRoot)&&n&&r!=="bottom";return!t&&!l&&!s?null:[s?k("div",{className:"search-menu-no-match-hint",children:s},"noMatchHint"):null,t||l?k("header",{className:K("search-menu-header",a),children:[t?super._renderWrapperHeader(e):null,l?this._renderSearchBox(e):null]},"header"):null]}_renderWrapperFooter(e){const t=e.footer,{searchBox:s,searchPlacement:n,nestedSearch:r,footerClass:o,exceedLimitHint:a,limit:l}=e,c=(!r||this.isRoot)&&s&&n==="bottom",h=a&&l&&this._items.length>l;return!t&&!c&&!h?null:k("footer",{className:K("search-menu-footer",o),children:[h?k("div",{className:"search-menu-exceed-limit-hint",children:$e(a,this._items.length-l)}):null,t?super._renderWrapperFooter(e):null,c?this._renderSearchBox(e):null]},"footer")}_beforeRender(e){return this.isRoot&&(this._matchedParents=new Set,this._showCount=0),super._beforeRender(e)}static isItemMatch(e,t,s=["keys","text","title","subtitle"]){return t.length?t.every(n=>s.some(r=>{const o=typeof r=="function"?r(e):e[r];return typeof o=="string"&&o.length&&o.toLowerCase().includes(n)})):!0}static getSearchKeys(e=""){return v.unique(e.toLowerCase().split(" ").filter(t=>t.length))}static underlineKeys(e,t,s="is-match-keys"){return e.reduce((n,r)=>[...n].reduce((o,a)=>{if(typeof a!="string")return o.push(a),o;const l=a.toLowerCase().split(r);if(l.length===1)return o.push(a),o;let c=0;return l.forEach((h,d)=>{d&&(o.push(k("span",{class:s,children:a.substring(c,c+r.length)})),c+=r.length),o.push(a.substring(c,c+h.length)),c+=h.length}),o},[]),t)}};dt.inheritNestedProps=[...Rt.inheritNestedProps,"isItemMatch","search","underlineKeys","nestedSearch"],dt.defaultProps={...Rt.defaultProps,defaultNestedShow:!0,wrap:!0,nestedSearch:!0,underlineKeys:!0,limit:200};const Qw=Object.freeze(Object.defineProperty({__proto__:null,Menu:Rt,SearchMenu:dt},Symbol.toStringTag,{value:"Module"}));class ya extends be{}ya.NAME="Menu",ya.Component=Rt,ya.replace=Rt.TAG;class va extends be{}va.NAME="SearchMenu",va.Component=dt,va.replace=dt.TAG,ot(Qw);const YT="",JT="",XT="",QT="",e$="",t$="",s$="",n$="",i$="",r$="",o$="";function eC({className:i,style:e,actions:t,heading:s,content:n,contentClass:r,children:o,close:a,onClose:l,icon:c,iconClass:h,...d}){let f;a===!0?f=k(we,{className:"alert-close btn ghost square text-inherit",square:!0,onClick:l,children:k("span",{class:"close"})}):N.isValidElement(a)?f=a:typeof a=="object"&&(f=k(we,{...a,onClick:l}));const m=Be.render(t,[]);return k("div",{className:K("alert",i),style:e,...d,children:[k(Ie,{icon:c,className:K("alert-icon",h)}),typeof n!="string"?k(fe,{content:n}):k("div",{className:K("alert-content",r),children:[typeof s!="string"?k(fe,{content:s}):s&&k("div",{className:"alert-heading",children:s}),k("div",{className:"alert-text",children:n}),s?m:null]}),s?null:m,f,o]})}function tC(i){if(i==="center")return"fade-from-center";if(i){if(i.includes("top"))return"fade-from-top";if(i.includes("bottom"))return"fade-from-bottom"}return"fade"}let sC=class extends ae{render(e){const{margin:t,type:s,placement:n,animation:r,show:o,className:a,message:l,html:c,content:h,time:d,...f}=e,m=h?[h]:[];return typeof c=="string"&&m.push({html:c}),l&&m.push(l),k(eC,{className:K("messager",a,s,r===!0?tC(n):r,o?"in":""),content:m,...f})}};class Mh extends be{constructor(){super(...arguments),this._show=!1,this._showTimer=0,this._afterRender=({firstRender:e})=>{e&&this.show();const{margin:t}=this.options;t&&this.$element.css("margin",`${t}px`)}}get isShown(){return this._show}afterInit(){this.on("click",e=>{v(e.target).closest('.alert-close,[data-dismiss="messager"]').length&&(e.preventDefault(),e.stopPropagation(),this.hide())})}setOptions(e,t){return e=super.setOptions(e,t),{...e,show:this._show,afterRender:this._afterRender}}show(){this.render(),this.emit("show"),this._resetTimer(()=>{this._show=!0,this.render(),this._resetTimer(()=>{this.emit("shown");const{time:e}=this.options;e&&this._resetTimer(()=>this.hide(),e)})},100)}hide(){this._show&&this._resetTimer(()=>{this.emit("hide"),this._show=!1,this.render(),this._resetTimer(()=>{this.emit("hidden")})},50)}_resetTimer(e,t=200){this._showTimer&&clearTimeout(this._showTimer),this._showTimer=window.setTimeout(()=>{e(),this._showTimer=0},t)}}Mh.NAME="MessagerItem",Mh.Component=sC;const Ar=class Z_ extends Ze{get isShown(){var e;return!!((e=this._item)!=null&&e.isShown)}show(e){this.setOptions(e),this._getItem().show()}hide(){var e;(e=this._item)==null||e.hide()}_getItem(){const e={...this.options};if(this._item)this._item.setOptions(e);else{const t=this._getHolder(),s=new Mh(t,e);s.on("hidden",()=>{s.destroy(),t==null||t.remove(),this._holder=void 0,this._item=void 0}),this._item=s}return this._item}_getHolder(){if(this._holder)return this._holder;const{placement:e="top"}=this.options;let t=this.$element.find(`.messagers-${e}`);t.length||(t=v(`<div class="messagers messagers-${e}"></div>`).appendTo(this.$element));let s=t.find(`#messager-${this.gid}`);return s.length||(s=v(`<div class="messager-holder" id="messager-${this.gid}"></div>`).appendTo(t),this._holder=s[0]),s[0]}static show(e,t){typeof e=="string"&&(e={content:e});const{container:s,...n}=e;t=t??n.type;const r={type:t,key:`messager_${Xe()}`,content:void 0,message:void 0,...t?this.TypeOptions[t]:{},...n},o=Z_.ensure(s||"body",r);return o.hide(),o.show(),o}};Ar.NAME="messager",Ar.DEFAULT={placement:"top",animation:!0,close:!0,margin:6,time:5e3},Ar.MULTI_INSTANCE=!0,Ar.TypeOptions={};let Ms=Ar,_a=class extends ae{render(e){const{percent:t=50,color:s,background:n=null,height:r,width:o,children:a,className:l,style:c}=e;return k("div",{class:K("progress",l),style:{width:o,height:r,"--progress-bg":n,"--progress-bar-color":s,...c},children:[k("div",{class:"progress-bar",style:{width:`${t}%`}}),a]})}};_a.defaultProps={percent:50,height:20,width:"auto"},ot(Object.freeze(Object.defineProperty({__proto__:null,ProgressBar:_a},Symbol.toStringTag,{value:"Module"})));class Nh extends be{}Nh.NAME="ProgressBar",Nh.Component=_a,Nh.register();const l$="",c$="";let ba=class extends ae{render(e){const{percent:t=50,size:s=24,circleBg:n,circleColor:r,text:o,className:a,textStyle:l,textX:c,textY:h,children:d}=e,f=s/2;let{circleWidth:m=.1}=e;m<1&&(m=s*m);const y=(s-m)/2;return k("svg",{className:a,width:s,height:s,children:[k("circle",{cx:f,cy:f,r:y,"stroke-width":m,stroke:n,fill:"transparent"}),k("circle",{cx:f,cy:f,r:y,"stroke-width":m,stroke:r,fill:"transparent","stroke-linecap":"round","stroke-dasharray":Math.PI*y*2,"stroke-dashoffset":Math.PI*y*2*(100-t)/100,style:{transformOrigin:"center",transform:"rotate(-90deg)"}}),o?k("text",{x:c??f,y:h??f+m/2,"dominant-baseline":"middle","text-anchor":"middle",style:l||{fontSize:`${y}px`,stroke:"currentColor"},children:o===!0?Math.floor(t):o}):null,d]})}};ba.defaultProps={circleBg:"var(--color-surface)",circleColor:"var(--color-primary-500)",text:!0};class wa extends be{}wa.NAME="ProgressCircle",wa.Component=ba,wa.register(),ot(Object.freeze(Object.defineProperty({__proto__:null,ProgressCircle:ba},Symbol.toStringTag,{value:"Module"})));const d$="",u$="",f$="",p$="",m$="",g$="",y$="",v$="",_$="",Pr='[droppable="true"]';class Lr extends Ze{constructor(){super(...arguments),this._state={dragging:null,dropping:null},this._handleMouseDown=e=>{const{selector:t,handle:s,beforeDrag:n}=this.options,r=v(e.target),o=r.closest(t),a=o[0];!a||s&&!r.closest(s).length||n&&n.call(this,e,a)===!1||(o.attr("draggable","true"),this._setState({dragging:a}))},this._handleDragStart=e=>{const{dragElement:t}=this;if(!t){e.preventDefault();return}const{options:s}=this,{onDragStart:n}=s;if(n&&n.call(this,e,t)===!1){this._clean();return}const{$element:r}=this,{target:o,selector:a,draggingClass:l,droppableClass:c,hasDraggingClass:h,canDrop:d}=s;l&&(this.$element.find(l).removeClass(l),v(t).addClass(l));let f=typeof o=="function"?v(o.call(this,t)):r.find(o||a||Pr);if(d&&(f=f.filter((m,y)=>d.call(this,e,t,y)!==!1)),!f.length){this._clean();return}c&&(r.find(c).removeClass(c),f.addClass(c)),h&&r.addClass(h),r.find(Pr).removeAttr("droppable"),f.attr("droppable","true"),this._$targets=f},this._handleDrag=e=>{var s;const{dragElement:t}=this;t&&(this._setDragEffect(e),(s=this.options.onDrag)==null||s.call(this,e,t))},this._handleDragEnd=e=>{var s;const{dragElement:t}=this;t&&((s=this.options.onDragEnd)==null||s.call(this,e,t)),this._clean()},this._handleDragEnter=e=>{this._handleDragOver(e)},this._handleDragOver=e=>{var o,a;const{dragElement:t}=this,n=v(e.target).closest(Pr)[0];if(!t||!n)return;const r=this.state.dropping;if(e.preventDefault(),this._setDragEffect(e),r!==n){const{droppingClass:l}=this.options;l&&(r&&this._leaveDropElement(e,r),v(n).addClass(l)),this._setState({dropping:n}),(o=this.options.onDragEnter)==null||o.call(this,e,t,n)}(a=this.options.onDragOver)==null||a.call(this,e,t,n)},this._handleDragLeave=e=>{const{dragElement:t}=this,s=v(e.target).filter(Pr)[0];!t||!s||(e.preventDefault(),this._leaveDropElement(e,s),this._setState({dropping:null}))},this._handleDrop=e=>{var s;const t=v(e.target).closest(Pr)[0];t&&(e.preventDefault(),(s=this.options.onDrop)==null||s.call(this,e,this.dragElement,t)),this._needClean=!0,setTimeout(()=>{this._needClean&&this._clean()},50)}}get state(){return this._state}get dragElement(){return this._state.dragging}get dropElement(){return this._state.dropping}async afterInit(){const{namespace:e}=this,{dragContainer:t,dropContainer:s,onDrag:n}=this.options;this._$dragContainer=t?v(t):this.$element,this._$dropContainer=s?v(s):this._$dragContainer,this._$dragContainer.on("mousedown"+e,this._handleMouseDown).on("dragstart"+e,this._handleDragStart).on("dragend"+e,this._handleDragEnd),n&&this._$dragContainer.on("drag"+e,this._handleDrag),this._$dropContainer.on("dragover"+e,this._handleDragOver).on("dragenter"+e,this._handleDragEnter).on("dragleave"+e,this._handleDragLeave).on("drop"+e,this._handleDrop),v(document).on(`mouseup${this.namespace}`,this._clean.bind(this))}destroy(){this._clean(),v(document).off(this.namespace),this._$dragContainer.off(this.namespace),this._$dropContainer.off(this.namespace),super.destroy()}_setState(e){var r;const t=this._state,{dragging:s=t.dragging,dropping:n=t.dropping}=e;s===t.dragging&&n===t.dropping||(this._state={dragging:s,dropping:n},(r=this.options.onChange)==null||r.call(this,this._state,t))}_setDragEffect(e){const{dropEffect:t}=this.options;t&&(e.dataTransfer.dropEffect=t)}_leaveDropElement(e,t){var n;const{droppingClass:s}=this.options;s&&v(t).removeClass(s),(n=this.options.onDragLeave)==null||n.call(this,e,this.dragElement,t)}_clean(){this._needClean=!0;const{draggingClass:e,droppableClass:t,droppingClass:s,hasDraggingClass:n}=this.options;n&&this.$element.removeClass(n);const{dragElement:r}=this;if(r){const a=v(r);e&&a.removeClass(e)}this._setState({dropping:null,dragging:null});const o=this._$targets;o&&(t&&o.removeClass(t),s&&o.removeClass(s),this._$targets=void 0)}}Lr.NAME="Draggable",Lr.DEFAULT={selector:'[draggable="true"]',dropEffect:"move",hasDraggingClass:"has-dragging",draggingClass:"is-dragging",droppableClass:"is-droppable",droppingClass:"is-dropping"};const nC='[moveable="true"]',Eh=class Y_ extends Ze{constructor(){super(...arguments),this._handleMouseDown=e=>{const{options:t}=this,{selector:s,handle:n,onMoveStart:r}=t,o=v(e.target),a=s==="self"?this.$element:o.closest(s),l=a[0];if(!l||n&&!o.closest(n).length||r&&r.call(this,e,l)===!1)return;a.attr("moveable","true");const{movingClass:c,hasMovingClass:h}=t;c&&a.addClass(c),h&&this.$element.addClass(h),e.preventDefault(),this._setState(e,l),v(document).off("mousemove mouseup").on(`mousemove${this.namespace}`,this._handleMouseMove.bind(this)).on(`mouseup${this.namespace}`,this._handleMouseUp.bind(this))},this._handleMouseMove=e=>{const t=this._state;!t||!e.buttons||(e.preventDefault(),this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{var s;this._raf=0,this._setState(e),(s=this.options.onMove)==null||s.call(this,e,t)}))},this._handleMouseUp=e=>{var s,n;const t=this._state;t&&(this._raf&&(cancelAnimationFrame(this._raf),this._raf=0),this._setState(e),(s=this.options.onMove)==null||s.call(this,e,t),(n=this.options.onMoveEnd)==null||n.call(this,e,t),this._clean())}}get state(){return this._state}get moveElement(){var e;return(e=this._state)==null?void 0:e.target}async afterInit(){this.on("mousedown",this._handleMouseDown)}destroy(){this._clean(),v(document).off(this.namespace),super.destroy()}_setState(e,t){var l;let s={x:e.pageX,y:e.pageY};const n=this._state;if(t){const c=v(t);let h;if(this.options.move===!0){const f=c.css("position");h=f==="fixed"||f==="absolute"||f==="relative"?"position":"transform"}else h=this.options.move||"none";const d=h==="transform"?Y_.getTranslate(t):h==="scroll"?{left:t.scrollLeft,top:t.scrollTop}:c.position();s=v.extend(s,{strategy:h,target:t,startX:s.x,startY:s.y,deltaX:0,deltaY:0,startLeft:d.left,startTop:d.top,left:d.left,top:d.top,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop})}else if(n){const c=s.x-n.startX,h=s.y-n.startY;s=v.extend({},n,s,{deltaX:c,deltaY:h,left:n.startLeft+c,top:n.startTop+h})}this._state=s;const{strategy:r,target:o}=s,a=v(o);r==="position"?a.css({left:s.left,top:s.top}):r==="transform"?a.css("transform",`translate(${s.left}px, ${s.top}px)`):r==="scroll"&&(o.scrollLeft=s.scrollLeft-s.deltaX,o.scrollTop=s.scrollTop-s.deltaY),(l=this.options.onChange)==null||l.call(this,s,n,e)}_clean(){v(document).off("mousemove mouseup");const{hasMovingClass:e,movingClass:t}=this.options;e&&this.$element.removeClass(e);const{moveElement:s}=this;if(s){const n=v(s);t&&n.removeClass(t)}this._state=void 0}static getTranslate(e){const s=window.getComputedStyle(e).getPropertyValue("transform");if(s==="none")return{left:0,top:0};const n=s.match(/^matrix\((.+)\)$/);if(!n)return{left:0,top:0};const r=n[1].split(", ");return{left:parseFloat(r[4]),top:parseFloat(r[5])}}};Eh.NAME="Moveable",Eh.DEFAULT={selector:nC,hasMovingClass:"has-moving",movingClass:"is-moving",move:!0};let Ni=Eh;const Ah=class J_ extends Ze{async afterInit(){const e=await J_.loadModule(),{options:t}=this;if(t.dragShadow!==void 0&&t.dragShadow!==!0){const{dragShadow:s,onEnd:n,setData:r}=t;t.setData=(o,a)=>{s===!1&&!this._emptyShadow&&(this._emptyShadow=a.cloneNode(!0),this._emptyShadow.classList.add("sortable-empty-shadow"),document.body.appendChild(this._emptyShadow)),o.setDragImage(s===!1?this._emptyShadow:s,0,0),r==null||r(o,a)},t.onEnd=o=>{var a;n==null||n(o),(a=this._emptyShadow)==null||a.remove(),this._emptyShadow=void 0},delete t.dragShadow}this.module=new e(this.element,t)}option(e,t){if(t===void 0)return this.module.option(e);this.module.option(e,t)}closest(e,t){return this.module.closest(e,t)}sort(e,t){this.module.sort(e,t)}save(){this.module.save()}destroy(){var e;super.destroy(),(e=this.module)==null||e.destroy()}toArray(){return this.module.toArray()}static async loadModule(){return this.Module||(this.Module=await v.getLib("sortablejs")),this.Module}};Ah.NAME="Sortable",Ah.DEFAULT={animation:150};let Ca=Ah;v.registerLib("sortablejs",{src:"sortable/sortable.min.js",check:"Sortable"});let Rr=class extends Dt{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new Ca(this.element,e))}componentWillUnmount(){this._sortable&&this._sortable.destroy()}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-list"]}_getSortableOptions(){const{sortable:e,canSortTo:t}=this.props;if(!e)return;const s=typeof e=="object"?e:{};return{group:`SortableList.${this.gid}`,dataIdAttr:"z-key",draggable:".list-item",...s,onSort:n=>{var o,a;const r=this.getOrders();(o=this.props.onSort)==null||o.call(this,n,r),(a=s.onSort)==null||a.call(this,n)},onMove:(n,r)=>{var o;if(t){const a=n.dragged.getAttribute("z-key-path"),l=n.related.getAttribute("z-key-path"),c=this.getItem(a),h=this.getItem(l),d=t.call(this,n,c,h);if(d!==void 0)return d}return(o=s.onMove)==null?void 0:o.call(this,n,r)}}}};Rr.defaultProps={...Dt.defaultProps,sortable:!0};let zt=class extends Rt{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,s){return this.constructor.getTreeItem(e,super._getItem(e,t,s))}static getTreeItem(e,t){return t&&(t.type==="item"&&(t.icon===void 0&&(t.icon=t.items?t.expanded?e.expandedIcon:e.collapsedIcon:e.normalIcon),t.actions===void 0&&(t.actions=e.itemActions)),t)}};zt.NAME="tree",zt.defaultProps={...Rt.defaultProps,indent:12},zt.defaultItemProps={...Rt.defaultItemProps,innerComponent:"div"},zt.inheritNestedProps=[...Rt.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"];let Kn=class extends dt{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,s){return zt.getTreeItem(e,super._getItem(e,t,s))}};Kn.NAME="tree",Kn.inheritNestedProps=[...dt.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"],Kn.ItemComponents={...dt.ItemComponents,item:[Is,{innerComponent:"div"}]};const iC=Object.freeze(Object.defineProperty({__proto__:null,SearchTree:Kn,Tree:zt},Symbol.toStringTag,{value:"Module"}));let Ei=class extends zt{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new Ca(this.element,e))}componentWillUnmount(){this._sortable&&this._sortable.destroy()}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-tree"]}_getSortableOptions(){const{sortable:e}=this.props;if(!e)return;const t=typeof e=="object"?e:{},{onSort:s,canSortTo:n,parentKey:r}=this.props;return{group:`SortableTree.${this.gid}`,dataIdAttr:"z-key",draggable:".tree-item",...t,onSort:o=>{var l;const a=this.getOrders();s==null||s.call(this,o,a,r),(l=t.onSort)==null||l.call(this,o)},onMove:(o,a)=>{var l;if(n){const c=o.dragged.getAttribute("z-key-path"),h=o.related.getAttribute("z-key-path"),d=this.getItem(c),f=this.getItem(h),m=n.call(this,o,d,f,r);if(m!==void 0)return m}return(l=t.onMove)==null?void 0:l.call(this,o,a)}}}};Ei.defaultProps={...zt.defaultProps,sortable:!0},Ei.inheritNestedProps=[...zt.inheritNestedProps,"onSort","sortable","canSortTo"];class xa extends be{}xa.NAME="SortableList",xa.Component=Rr,xa.replace=Rr.TAG;class ka extends be{}ka.NAME="SortableTree",ka.Component=Ei,ka.replace=Ei.TAG;const b$="";var ts=typeof window<"u"?window:null,Ph=ts===null,zr=Ph?void 0:ts.document,hs="addEventListener",ds="removeEventListener",Lh="getBoundingClientRect",Fr="_a",us="_b",Ys="_c",Sa="horizontal",fs=function(){return!1},rC=Ph?"calc":["","-webkit-","-moz-","-o-"].filter(function(i){var e=zr.createElement("div");return e.style.cssText="width:"+i+"calc(9px)",!!e.style.length}).shift()+"calc",Dm=function(i){return typeof i=="string"||i instanceof String},Im=function(i){if(Dm(i)){var e=zr.querySelector(i);if(!e)throw new Error("Selector "+i+" did not match a DOM element");return e}return i},Nt=function(i,e,t){var s=i[e];return s!==void 0?s:t},Ta=function(i,e,t,s){if(e){if(s==="end")return 0;if(s==="center")return i/2}else if(t){if(s==="start")return 0;if(s==="center")return i/2}return i},oC=function(i,e){var t=zr.createElement("div");return t.className="gutter gutter-"+e,t},aC=function(i,e,t){var s={};return Dm(e)?s[i]=e:s[i]=rC+"("+e+"% - "+t+"px)",s},lC=function(i,e){var t;return t={},t[i]=e+"px",t},Mm=function(i,e){if(e===void 0&&(e={}),Ph)return{};var t=i,s,n,r,o,a,l;Array.from&&(t=Array.from(t));var c=Im(t[0]),h=c.parentNode,d=getComputedStyle?getComputedStyle(h):null,f=d?d.flexDirection:null,m=Nt(e,"sizes")||t.map(function(){return 100/t.length}),y=Nt(e,"minSize",100),b=Array.isArray(y)?y:t.map(function(){return y}),w=Nt(e,"maxSize",1/0),x=Array.isArray(w)?w:t.map(function(){return w}),D=Nt(e,"expandToMin",!1),I=Nt(e,"gutterSize",10),E=Nt(e,"gutterAlign","center"),P=Nt(e,"snapOffset",30),O=Array.isArray(P)?P:t.map(function(){return P}),W=Nt(e,"dragInterval",1),J=Nt(e,"direction",Sa),Y=Nt(e,"cursor",J===Sa?"col-resize":"row-resize"),ve=Nt(e,"gutter",oC),ee=Nt(e,"elementStyle",aC),ne=Nt(e,"gutterStyle",lC);J===Sa?(s="width",n="clientX",r="left",o="right",a="clientWidth"):J==="vertical"&&(s="height",n="clientY",r="top",o="bottom",a="clientHeight");function Ce(ge,G,de,Te){var Re=ee(s,G,de,Te);Object.keys(Re).forEach(function(nt){ge.style[nt]=Re[nt]})}function Me(ge,G,de){var Te=ne(s,G,de);Object.keys(Te).forEach(function(Re){ge.style[Re]=Te[Re]})}function ze(){return l.map(function(ge){return ge.size})}function He(ge){return"touches"in ge?ge.touches[0][n]:ge[n]}function te(ge){var G=l[this.a],de=l[this.b],Te=G.size+de.size;G.size=ge/this.size*Te,de.size=Te-ge/this.size*Te,Ce(G.element,G.size,this[us],G.i),Ce(de.element,de.size,this[Ys],de.i)}function X(ge){var G,de=l[this.a],Te=l[this.b];this.dragging&&(G=He(ge)-this.start+(this[us]-this.dragOffset),W>1&&(G=Math.round(G/W)*W),G<=de.minSize+de.snapOffset+this[us]?G=de.minSize+this[us]:G>=this.size-(Te.minSize+Te.snapOffset+this[Ys])&&(G=this.size-(Te.minSize+this[Ys])),G>=de.maxSize-de.snapOffset+this[us]?G=de.maxSize+this[us]:G<=this.size-(Te.maxSize-Te.snapOffset+this[Ys])&&(G=this.size-(Te.maxSize+this[Ys])),te.call(this,G),Nt(e,"onDrag",fs)(ze()))}function Ee(){var ge=l[this.a].element,G=l[this.b].element,de=ge[Lh](),Te=G[Lh]();this.size=de[s]+Te[s]+this[us]+this[Ys],this.start=de[r],this.end=de[o]}function Ae(ge){if(!getComputedStyle)return null;var G=getComputedStyle(ge);if(!G)return null;var de=ge[a];return de===0?null:(J===Sa?de-=parseFloat(G.paddingLeft)+parseFloat(G.paddingRight):de-=parseFloat(G.paddingTop)+parseFloat(G.paddingBottom),de)}function We(ge){var G=Ae(h);if(G===null||b.reduce(function(nt,Ot){return nt+Ot},0)>G)return ge;var de=0,Te=[],Re=ge.map(function(nt,Ot){var jt=G*nt/100,er=Ta(I,Ot===0,Ot===ge.length-1,E),tr=b[Ot]+er;return jt<tr?(de+=tr-jt,Te.push(0),tr):(Te.push(jt-tr),jt)});return de===0?ge:Re.map(function(nt,Ot){var jt=nt;if(de>0&&Te[Ot]-de>0){var er=Math.min(de,Te[Ot]-de);de-=er,jt=nt-er}return jt/G*100})}function Xt(){var ge=this,G=l[ge.a].element,de=l[ge.b].element;ge.dragging&&Nt(e,"onDragEnd",fs)(ze()),ge.dragging=!1,ts[ds]("mouseup",ge.stop),ts[ds]("touchend",ge.stop),ts[ds]("touchcancel",ge.stop),ts[ds]("mousemove",ge.move),ts[ds]("touchmove",ge.move),ge.stop=null,ge.move=null,G[ds]("selectstart",fs),G[ds]("dragstart",fs),de[ds]("selectstart",fs),de[ds]("dragstart",fs),G.style.userSelect="",G.style.webkitUserSelect="",G.style.MozUserSelect="",G.style.pointerEvents="",de.style.userSelect="",de.style.webkitUserSelect="",de.style.MozUserSelect="",de.style.pointerEvents="",ge.gutter.style.cursor="",ge.parent.style.cursor="",zr.body.style.cursor=""}function wt(ge){if(!("button"in ge&&ge.button!==0)){var G=this,de=l[G.a].element,Te=l[G.b].element;G.dragging||Nt(e,"onDragStart",fs)(ze()),ge.preventDefault(),G.dragging=!0,G.move=X.bind(G),G.stop=Xt.bind(G),ts[hs]("mouseup",G.stop),ts[hs]("touchend",G.stop),ts[hs]("touchcancel",G.stop),ts[hs]("mousemove",G.move),ts[hs]("touchmove",G.move),de[hs]("selectstart",fs),de[hs]("dragstart",fs),Te[hs]("selectstart",fs),Te[hs]("dragstart",fs),de.style.userSelect="none",de.style.webkitUserSelect="none",de.style.MozUserSelect="none",de.style.pointerEvents="none",Te.style.userSelect="none",Te.style.webkitUserSelect="none",Te.style.MozUserSelect="none",Te.style.pointerEvents="none",G.gutter.style.cursor=Y,G.parent.style.cursor=Y,zr.body.style.cursor=Y,Ee.call(G),G.dragOffset=He(ge)-G.end}}m=We(m);var It=[];l=t.map(function(ge,G){var de={element:Im(ge),size:m[G],minSize:b[G],maxSize:x[G],snapOffset:O[G],i:G},Te;if(G>0&&(Te={a:G-1,b:G,dragging:!1,direction:J,parent:h},Te[us]=Ta(I,G-1===0,!1,E),Te[Ys]=Ta(I,!1,G===t.length-1,E),f==="row-reverse"||f==="column-reverse")){var Re=Te.a;Te.a=Te.b,Te.b=Re}if(G>0){var nt=ve(G,J,de.element);Me(nt,I,G),Te[Fr]=wt.bind(Te),nt[hs]("mousedown",Te[Fr]),nt[hs]("touchstart",Te[Fr]),h.insertBefore(nt,de.element),Te.gutter=nt}return Ce(de.element,de.size,Ta(I,G===0,G===t.length-1,E),G),G>0&&It.push(Te),de});function rs(ge){var G=ge.i===It.length,de=G?It[ge.i-1]:It[ge.i];Ee.call(de);var Te=G?de.size-ge.minSize-de[Ys]:ge.minSize+de[us];te.call(de,Te)}l.forEach(function(ge){var G=ge.element[Lh]()[s];G<ge.minSize&&(D?rs(ge):ge.minSize=G)});function Mt(ge){var G=We(ge);G.forEach(function(de,Te){if(Te>0){var Re=It[Te-1],nt=l[Re.a],Ot=l[Re.b];nt.size=G[Te-1],Ot.size=de,Ce(nt.element,nt.size,Re[us],nt.i),Ce(Ot.element,Ot.size,Re[Ys],Ot.i)}})}function Rs(ge,G){It.forEach(function(de){if(G!==!0?de.parent.removeChild(de.gutter):(de.gutter[ds]("mousedown",de[Fr]),de.gutter[ds]("touchstart",de[Fr])),ge!==!0){var Te=ee(s,de.a.size,de[us]);Object.keys(Te).forEach(function(Re){l[de.a].element.style[Re]="",l[de.b].element.style[Re]=""})}})}return{setSizes:Mt,getSizes:ze,collapse:function(G){rs(l[G])},destroy:Rs,parent:h,pairs:It}};const w$="";function Nm(i,e,t,s){for(e=e-(t-1)*s;i.length<t;)i.push(void 0);i=i.splice(0,t);const n=[],r=[];let o=0;if(i.forEach((a,l)=>{if(a==null){r.push(l);return}const[c,h]=dn(a);if(Number.isNaN(c)){r.push(l);return}const d=h==="%"?e*c/100:c;o+=d,n[l]=d}),r.length){const a=Math.max(1,(e-o)/r.length);r.forEach(l=>{n[l]=a,o+=a})}return n.map(a=>100*a/o)}class $a extends Ze{constructor(){super(...arguments),this._sizeBack=[]}get count(){return this._elements.length}get isVertical(){return this.options.direction==="vertical"||!!this.options.vertical}get totalSize(){return this.$element[this.isVertical?"height":"width"]()}isCollapsed(e){return v(this._elements[e])[this.isVertical?"height":"width"]()<1}setSizes(e,t){t||(e=Nm(e,this.totalSize,this.count,this.options.gutterSize)),this._split.setSizes(e),this._update()}getSizes(){return this._split.getSizes()}collapse(e){this._sizeBack[e]=this.getSizes(),this._split.collapse(e),this._update()}expand(e){const t=this.getSizes(),s=this._sizeBack[e];if(s){t[e]=s[e];const n=e===this.count-1?e-1:e+1;t[n]=s[n]}else t[e]=50;this.setSizes(t)}toggle(e){this.isCollapsed(e)?this.expand(e):this.collapse(e)}afterInit(){const{elements:e=".split-cell",toggleBtn:t,vertical:s,sizes:n,gutterSize:r=8,animation:o,dblClickToggle:a,...l}=this.options,c=(Array.isArray(e)?e:[e]).reduce((f,m)=>(m&&(m instanceof HTMLElement?f.push(m):(typeof m=="string"?this.$element.children(m):v(m)).each((y,b)=>{f.push(b)})),f),[]);c.forEach(f=>v(f).addClass("split-cell")),this._elements=c,this._handleDragEnd=this._handleDragEnd.bind(this),this._createGutter=this._createGutter.bind(this);let h;n&&(h=Nm(n,this.totalSize,c.length,r)),this._split=Mm(c,{direction:s?"vertical":"horizontal",sizes:h,gutterSize:r,...l,onDragEnd:this._handleDragEnd,gutter:this._createGutter});const d=f=>{const m=f.z("index"),{count:y}=this;this.toggle(m===y-1&&y>2?m:m-1)};t&&this.on("click",f=>{const m=v(f.target).closest(".gutter-toggle");m.length&&d(m.parent())}),a&&this.on("dblclick",f=>{const m=v(f.target).closest(".gutter");m.length&&d(m)}),o&&this.on("transitionend",this._update.bind(this,!1)),this._update()}destroy(e,t){return super.destroy(),this.off("click transitionend"),this._raf&&cancelAnimationFrame(this._raf),this._split.destroy(e,t)}render(){super.render(),this._update()}_update(e){if(!e){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this._update(!0)});return}const{animation:t,vertical:s,gutterSize:n}=this.options,r=this.isVertical||!!s;this.$element.css("--split-gutter-size",`${n}px`).toggleClass("split-vert",r).toggleClass("split-horz",!r).toggleClass("has-animation",!!t),this._elements.forEach((o,a)=>{const l=this.isCollapsed(a),c=v(this._elements[a]).toggleClass("is-collapsed",l);c.prev(".gutter").toggleClass("is-next-collapsed",l),c.next(".gutter").toggleClass("is-prev-collapsed",l)})}_createGutter(e,t){const{toggleBtn:s}=this.options,{count:n}=this,r=v(`<div class="gutter gutter-${t==="vertical"?"vert":"horz"}" />`).z("index",e).toggleClass("is-first",e===1).toggleClass("is-last",e===n-1);return(s===!0||Array.isArray(s)&&s[e])&&r.append('<button class="gutter-toggle" type="button"><span class="chevron-left"></span></button>'),r[0]}_handleDragEnd(e){var t,s;this._update(),(s=(t=this.options).onDragEnd)==null||s.call(t,e)}}$a.NAME="Split",$a.DEFAULT={gutterSize:8,dblClickToggle:!0},$a.SplitJS=Mm;const C$="";/*! js-cookie v3.0.5 | MIT */function Da(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)i[s]=t[s]}return i}var cC={read:function(i){return i[0]==='"'&&(i=i.slice(1,-1)),i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(i){return encodeURIComponent(i).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Rh(i,e){function t(n,r,o){if(!(typeof document>"u")){o=Da({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var l in o)o[l]&&(a+="; "+l,o[l]!==!0&&(a+="="+o[l].split(";")[0]));return document.cookie=n+"="+i.write(r,n)+a}}function s(n){if(!(typeof document>"u"||arguments.length&&!n)){for(var r=document.cookie?document.cookie.split("; "):[],o={},a=0;a<r.length;a++){var l=r[a].split("="),c=l.slice(1).join("=");try{var h=decodeURIComponent(l[0]);if(o[h]=i.read(c,h),n===h)break}catch{}}return n?o[n]:o}}return Object.create({set:t,get:s,remove:function(n,r){t(n,"",Da({},r,{expires:-1}))},withAttributes:function(n){return Rh(this.converter,Da({},this.attributes,n))},withConverter:function(n){return Rh(Da({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(i)}})}var Em=Rh(cC,{path:"/"});window.$&&Object.assign(window.$,{cookie:Em});var Am=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hC(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Pm={exports:{}};(function(i,e){(function(t,s){i.exports=s()})(Am,function(){var t=function(u,p){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,C){_.__proto__=C}||function(_,C){for(var S in C)Object.prototype.hasOwnProperty.call(C,S)&&(_[S]=C[S])})(u,p)},s=function(){return(s=Object.assign||function(u){for(var p,_=1,C=arguments.length;_<C;_++)for(var S in p=arguments[_])Object.prototype.hasOwnProperty.call(p,S)&&(u[S]=p[S]);return u}).apply(this,arguments)};function n(u,p,_){if(_||arguments.length===2)for(var C,S=0,T=p.length;S<T;S++)!C&&S in p||((C=C||Array.prototype.slice.call(p,0,S))[S]=p[S]);return u.concat(C||Array.prototype.slice.call(p))}var r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Am,o=Object.keys,a=Array.isArray;function l(u,p){return typeof p!="object"||o(p).forEach(function(_){u[_]=p[_]}),u}typeof Promise>"u"||r.Promise||(r.Promise=Promise);var c=Object.getPrototypeOf,h={}.hasOwnProperty;function d(u,p){return h.call(u,p)}function f(u,p){typeof p=="function"&&(p=p(c(u))),(typeof Reflect>"u"?o:Reflect.ownKeys)(p).forEach(function(_){y(u,_,p[_])})}var m=Object.defineProperty;function y(u,p,_,C){m(u,p,l(_&&d(_,"get")&&typeof _.get=="function"?{get:_.get,set:_.set,configurable:!0}:{value:_,configurable:!0,writable:!0},C))}function b(u){return{from:function(p){return u.prototype=Object.create(p.prototype),y(u.prototype,"constructor",u),{extend:f.bind(null,u.prototype)}}}}var w=Object.getOwnPropertyDescriptor,x=[].slice;function D(u,p,_){return x.call(u,p,_)}function I(u,p){return p(u)}function E(u){if(!u)throw new Error("Assertion Failed")}function P(u){r.setImmediate?setImmediate(u):setTimeout(u,0)}function O(u,p){if(typeof p=="string"&&d(u,p))return u[p];if(!p)return u;if(typeof p!="string"){for(var _=[],C=0,S=p.length;C<S;++C){var T=O(u,p[C]);_.push(T)}return _}var M=p.indexOf(".");if(M!==-1){var A=u[p.substr(0,M)];return A==null?void 0:O(A,p.substr(M+1))}}function W(u,p,_){if(u&&p!==void 0&&!("isFrozen"in Object&&Object.isFrozen(u)))if(typeof p!="string"&&"length"in p){E(typeof _!="string"&&"length"in _);for(var C=0,S=p.length;C<S;++C)W(u,p[C],_[C])}else{var T,M,A=p.indexOf(".");A!==-1?(T=p.substr(0,A),(M=p.substr(A+1))===""?_===void 0?a(u)&&!isNaN(parseInt(T))?u.splice(T,1):delete u[T]:u[T]=_:W(A=!(A=u[T])||!d(u,T)?u[T]={}:A,M,_)):_===void 0?a(u)&&!isNaN(parseInt(p))?u.splice(p,1):delete u[p]:u[p]=_}}function J(u){var p,_={};for(p in u)d(u,p)&&(_[p]=u[p]);return _}var Y=[].concat;function ve(u){return Y.apply([],u)}var ai="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ve([8,16,32,64].map(function(u){return["Int","Uint","Float"].map(function(p){return p+u+"Array"})}))).filter(function(u){return r[u]}),ee=new Set(ai.map(function(u){return r[u]})),ne=null;function Ce(u){return ne=new WeakMap,u=function p(_){if(!_||typeof _!="object")return _;var C=ne.get(_);if(C)return C;if(a(_)){C=[],ne.set(_,C);for(var S=0,T=_.length;S<T;++S)C.push(p(_[S]))}else if(ee.has(_.constructor))C=_;else{var M,A=c(_);for(M in C=A===Object.prototype?{}:Object.create(A),ne.set(_,C),_)d(_,M)&&(C[M]=p(_[M]))}return C}(u),ne=null,u}var Me={}.toString;function ze(u){return Me.call(u).slice(8,-1)}var He=typeof Symbol<"u"?Symbol.iterator:"@@iterator",te=typeof He=="symbol"?function(u){var p;return u!=null&&(p=u[He])&&p.apply(u)}:function(){return null};function X(u,p){return p=u.indexOf(p),0<=p&&u.splice(p,1),0<=p}var Ee={};function Ae(u){var p,_,C,S;if(arguments.length===1){if(a(u))return u.slice();if(this===Ee&&typeof u=="string")return[u];if(S=te(u)){for(_=[];!(C=S.next()).done;)_.push(C.value);return _}if(u==null)return[u];if(typeof(p=u.length)!="number")return[u];for(_=new Array(p);p--;)_[p]=u[p];return _}for(p=arguments.length,_=new Array(p);p--;)_[p]=arguments[p];return _}var We=typeof Symbol<"u"?function(u){return u[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},bo=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],os=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(bo),Xt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function wt(u,p){this.name=u,this.message=p}function It(u,p){return u+". Errors: "+Object.keys(p).map(function(_){return p[_].toString()}).filter(function(_,C,S){return S.indexOf(_)===C}).join(`
`)}function rs(u,p,_,C){this.failures=p,this.failedKeys=C,this.successCount=_,this.message=It(u,p)}function Mt(u,p){this.name="BulkError",this.failures=Object.keys(p).map(function(_){return p[_]}),this.failuresByPos=p,this.message=It(u,this.failures)}b(wt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),b(rs).from(wt),b(Mt).from(wt);var Rs=os.reduce(function(u,p){return u[p]=p+"Error",u},{}),ge=wt,G=os.reduce(function(u,p){var _=p+"Error";function C(S,T){this.name=_,S?typeof S=="string"?(this.message="".concat(S).concat(T?`
 `+T:""),this.inner=T||null):typeof S=="object"&&(this.message="".concat(S.name," ").concat(S.message),this.inner=S):(this.message=Xt[p]||_,this.inner=null)}return b(C).from(ge),u[p]=C,u},{});G.Syntax=SyntaxError,G.Type=TypeError,G.Range=RangeError;var de=bo.reduce(function(u,p){return u[p+"Error"]=G[p],u},{}),Te=os.reduce(function(u,p){return["Syntax","Type","Range"].indexOf(p)===-1&&(u[p+"Error"]=G[p]),u},{});function Re(){}function nt(u){return u}function Ot(u,p){return u==null||u===nt?p:function(_){return p(u(_))}}function jt(u,p){return function(){u.apply(this,arguments),p.apply(this,arguments)}}function er(u,p){return u===Re?p:function(){var _=u.apply(this,arguments);_!==void 0&&(arguments[0]=_);var C=this.onsuccess,S=this.onerror;this.onsuccess=null,this.onerror=null;var T=p.apply(this,arguments);return C&&(this.onsuccess=this.onsuccess?jt(C,this.onsuccess):C),S&&(this.onerror=this.onerror?jt(S,this.onerror):S),T!==void 0?T:_}}function tr(u,p){return u===Re?p:function(){u.apply(this,arguments);var _=this.onsuccess,C=this.onerror;this.onsuccess=this.onerror=null,p.apply(this,arguments),_&&(this.onsuccess=this.onsuccess?jt(_,this.onsuccess):_),C&&(this.onerror=this.onerror?jt(C,this.onerror):C)}}function KS(u,p){return u===Re?p:function(_){var C=u.apply(this,arguments);l(_,C);var S=this.onsuccess,T=this.onerror;return this.onsuccess=null,this.onerror=null,_=p.apply(this,arguments),S&&(this.onsuccess=this.onsuccess?jt(S,this.onsuccess):S),T&&(this.onerror=this.onerror?jt(T,this.onerror):T),C===void 0?_===void 0?void 0:_:l(C,_)}}function qS(u,p){return u===Re?p:function(){return p.apply(this,arguments)!==!1&&u.apply(this,arguments)}}function Uu(u,p){return u===Re?p:function(){var _=u.apply(this,arguments);if(_&&typeof _.then=="function"){for(var C=this,S=arguments.length,T=new Array(S);S--;)T[S]=arguments[S];return _.then(function(){return p.apply(C,T)})}return p.apply(this,arguments)}}Te.ModifyError=rs,Te.DexieError=wt,Te.BulkError=Mt;var zs=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function h_(u){zs=u}var _o={},d_=100,ai=typeof Promise>"u"?[]:function(){var u=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[u,c(u),u];var p=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[p,c(p),u]}(),bo=ai[0],os=ai[1],ai=ai[2],os=os&&os.then,li=bo&&bo.constructor,Vu=!!ai,wo=function(u,p){Co.push([u,p]),Jl&&(queueMicrotask(ZS),Jl=!1)},Wu=!0,Jl=!0,ci=[],Xl=[],Ku=nt,In={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Re,pgp:!1,env:{},finalize:Re},ke=In,Co=[],hi=0,Ql=[];function me(u){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var p=this._PSD=ke;if(typeof u!="function"){if(u!==_o)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Gu(this,this._value))}this._state=null,this._value=null,++p.ref,function _(C,S){try{S(function(T){if(C._state===null){if(T===C)throw new TypeError("A promise cannot be resolved with itself.");var M=C._lib&&sr();T&&typeof T.then=="function"?_(C,function(A,R){T instanceof me?T._then(A,R):T.then(A,R)}):(C._state=!0,C._value=T,f_(C)),M&&nr()}},Gu.bind(null,C))}catch(T){Gu(C,T)}}(this,u)}var qu={get:function(){var u=ke,p=nc;function _(C,S){var T=this,M=!u.global&&(u!==ke||p!==nc),A=M&&!Nn(),R=new me(function(z,H){Zu(T,new u_(m_(C,u,M,A),m_(S,u,M,A),z,H,u))});return this._consoleTask&&(R._consoleTask=this._consoleTask),R}return _.prototype=_o,_},set:function(u){y(this,"then",u&&u.prototype===_o?qu:{get:function(){return u},set:qu.set})}};function u_(u,p,_,C,S){this.onFulfilled=typeof u=="function"?u:null,this.onRejected=typeof p=="function"?p:null,this.resolve=_,this.reject=C,this.psd=S}function Gu(u,p){var _,C;Xl.push(p),u._state===null&&(_=u._lib&&sr(),p=Ku(p),u._state=!1,u._value=p,C=u,ci.some(function(S){return S._value===C._value})||ci.push(C),f_(u),_&&nr())}function f_(u){var p=u._listeners;u._listeners=[];for(var _=0,C=p.length;_<C;++_)Zu(u,p[_]);var S=u._PSD;--S.ref||S.finalize(),hi===0&&(++hi,wo(function(){--hi==0&&Yu()},[]))}function Zu(u,p){if(u._state!==null){var _=u._state?p.onFulfilled:p.onRejected;if(_===null)return(u._state?p.resolve:p.reject)(u._value);++p.psd.ref,++hi,wo(GS,[_,u,p])}else u._listeners.push(p)}function GS(u,p,_){try{var C,S=p._value;!p._state&&Xl.length&&(Xl=[]),C=zs&&p._consoleTask?p._consoleTask.run(function(){return u(S)}):u(S),p._state||Xl.indexOf(S)!==-1||function(T){for(var M=ci.length;M;)if(ci[--M]._value===T._value)return ci.splice(M,1)}(p),_.resolve(C)}catch(T){_.reject(T)}finally{--hi==0&&Yu(),--_.psd.ref||_.psd.finalize()}}function ZS(){di(In,function(){sr()&&nr()})}function sr(){var u=Wu;return Jl=Wu=!1,u}function nr(){var u,p,_;do for(;0<Co.length;)for(u=Co,Co=[],_=u.length,p=0;p<_;++p){var C=u[p];C[0].apply(null,C[1])}while(0<Co.length);Jl=Wu=!0}function Yu(){var u=ci;ci=[],u.forEach(function(C){C._PSD.onunhandled.call(null,C._value,C)});for(var p=Ql.slice(0),_=p.length;_;)p[--_]()}function ec(u){return new me(_o,!1,u)}function lt(u,p){var _=ke;return function(){var C=sr(),S=ke;try{return En(_,!0),u.apply(this,arguments)}catch(T){p&&p(T)}finally{En(S,!1),C&&nr()}}}f(me.prototype,{then:qu,_then:function(u,p){Zu(this,new u_(null,null,u,p,ke))},catch:function(u){if(arguments.length===1)return this.then(null,u);var p=u,_=arguments[1];return typeof p=="function"?this.then(null,function(C){return(C instanceof p?_:ec)(C)}):this.then(null,function(C){return(C&&C.name===p?_:ec)(C)})},finally:function(u){return this.then(function(p){return me.resolve(u()).then(function(){return p})},function(p){return me.resolve(u()).then(function(){return ec(p)})})},timeout:function(u,p){var _=this;return u<1/0?new me(function(C,S){var T=setTimeout(function(){return S(new G.Timeout(p))},u);_.then(C,S).finally(clearTimeout.bind(null,T))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&y(me.prototype,Symbol.toStringTag,"Dexie.Promise"),In.env=p_(),f(me,{all:function(){var u=Ae.apply(null,arguments).map(ic);return new me(function(p,_){u.length===0&&p([]);var C=u.length;u.forEach(function(S,T){return me.resolve(S).then(function(M){u[T]=M,--C||p(u)},_)})})},resolve:function(u){return u instanceof me?u:u&&typeof u.then=="function"?new me(function(p,_){u.then(p,_)}):new me(_o,!0,u)},reject:ec,race:function(){var u=Ae.apply(null,arguments).map(ic);return new me(function(p,_){u.map(function(C){return me.resolve(C).then(p,_)})})},PSD:{get:function(){return ke},set:function(u){return ke=u}},totalEchoes:{get:function(){return nc}},newPSD:Mn,usePSD:di,scheduler:{get:function(){return wo},set:function(u){wo=u}},rejectionMapper:{get:function(){return Ku},set:function(u){Ku=u}},follow:function(u,p){return new me(function(_,C){return Mn(function(S,T){var M=ke;M.unhandleds=[],M.onunhandled=T,M.finalize=jt(function(){var A,R=this;A=function(){R.unhandleds.length===0?S():T(R.unhandleds[0])},Ql.push(function z(){A(),Ql.splice(Ql.indexOf(z),1)}),++hi,wo(function(){--hi==0&&Yu()},[])},M.finalize),u()},p,_,C)})}}),li&&(li.allSettled&&y(me,"allSettled",function(){var u=Ae.apply(null,arguments).map(ic);return new me(function(p){u.length===0&&p([]);var _=u.length,C=new Array(_);u.forEach(function(S,T){return me.resolve(S).then(function(M){return C[T]={status:"fulfilled",value:M}},function(M){return C[T]={status:"rejected",reason:M}}).then(function(){return--_||p(C)})})})}),li.any&&typeof AggregateError<"u"&&y(me,"any",function(){var u=Ae.apply(null,arguments).map(ic);return new me(function(p,_){u.length===0&&_(new AggregateError([]));var C=u.length,S=new Array(C);u.forEach(function(T,M){return me.resolve(T).then(function(A){return p(A)},function(A){S[M]=A,--C||_(new AggregateError(S))})})})}),li.withResolvers&&(me.withResolvers=li.withResolvers));var Ct={awaits:0,echoes:0,id:0},YS=0,tc=[],sc=0,nc=0,JS=0;function Mn(u,p,_,C){var S=ke,T=Object.create(S);return T.parent=S,T.ref=0,T.global=!1,T.id=++JS,In.env,T.env=Vu?{Promise:me,PromiseProp:{value:me,configurable:!0,writable:!0},all:me.all,race:me.race,allSettled:me.allSettled,any:me.any,resolve:me.resolve,reject:me.reject}:{},p&&l(T,p),++S.ref,T.finalize=function(){--this.parent.ref||this.parent.finalize()},C=di(T,u,_,C),T.ref===0&&T.finalize(),C}function ir(){return Ct.id||(Ct.id=++YS),++Ct.awaits,Ct.echoes+=d_,Ct.id}function Nn(){return!!Ct.awaits&&(--Ct.awaits==0&&(Ct.id=0),Ct.echoes=Ct.awaits*d_,!0)}function ic(u){return Ct.echoes&&u&&u.constructor===li?(ir(),u.then(function(p){return Nn(),p},function(p){return Nn(),ct(p)})):u}function XS(){var u=tc[tc.length-1];tc.pop(),En(u,!1)}function En(u,p){var _,C=ke;(p?!Ct.echoes||sc++&&u===ke:!sc||--sc&&u===ke)||queueMicrotask(p?(function(S){++nc,Ct.echoes&&--Ct.echoes!=0||(Ct.echoes=Ct.awaits=Ct.id=0),tc.push(ke),En(S,!0)}).bind(null,u):XS),u!==ke&&(ke=u,C===In&&(In.env=p_()),Vu&&(_=In.env.Promise,p=u.env,(C.global||u.global)&&(Object.defineProperty(r,"Promise",p.PromiseProp),_.all=p.all,_.race=p.race,_.resolve=p.resolve,_.reject=p.reject,p.allSettled&&(_.allSettled=p.allSettled),p.any&&(_.any=p.any))))}function p_(){var u=r.Promise;return Vu?{Promise:u,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:u.all,race:u.race,allSettled:u.allSettled,any:u.any,resolve:u.resolve,reject:u.reject}:{}}function di(u,p,_,C,S){var T=ke;try{return En(u,!0),p(_,C,S)}finally{En(T,!1)}}function m_(u,p,_,C){return typeof u!="function"?u:function(){var S=ke;_&&ir(),En(p,!0);try{return u.apply(this,arguments)}finally{En(S,!1),C&&queueMicrotask(Nn)}}}function Ju(u){Promise===li&&Ct.echoes===0?sc===0?u():enqueueNativeMicroTask(u):setTimeout(u,0)}(""+os).indexOf("[native code]")===-1&&(ir=Nn=Re);var ct=me.reject,ui=String.fromCharCode(65535),nn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",g_="String expected.",rr=[],rc="__dbnames",Xu="readonly",Qu="readwrite";function fi(u,p){return u?p?function(){return u.apply(this,arguments)&&p.apply(this,arguments)}:u:p}var y_={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function oc(u){return typeof u!="string"||/\./.test(u)?function(p){return p}:function(p){return p[u]===void 0&&u in p&&delete(p=Ce(p))[u],p}}function v_(){throw G.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Ge(u,p){try{var _=__(u),C=__(p);if(_!==C)return _==="Array"?1:C==="Array"?-1:_==="binary"?1:C==="binary"?-1:_==="string"?1:C==="string"?-1:_==="Date"?1:C!=="Date"?NaN:-1;switch(_){case"number":case"Date":case"string":return p<u?1:u<p?-1:0;case"binary":return function(S,T){for(var M=S.length,A=T.length,R=M<A?M:A,z=0;z<R;++z)if(S[z]!==T[z])return S[z]<T[z]?-1:1;return M===A?0:M<A?-1:1}(b_(u),b_(p));case"Array":return function(S,T){for(var M=S.length,A=T.length,R=M<A?M:A,z=0;z<R;++z){var H=Ge(S[z],T[z]);if(H!==0)return H}return M===A?0:M<A?-1:1}(u,p)}}catch{}return NaN}function __(u){var p=typeof u;return p!="object"?p:ArrayBuffer.isView(u)?"binary":(u=ze(u),u==="ArrayBuffer"?"binary":u)}function b_(u){return u instanceof Uint8Array?u:ArrayBuffer.isView(u)?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):new Uint8Array(u)}function ac(u,p,_){var C=u.schema.yProps;return C?(p&&0<_.numFailures&&(p=p.filter(function(S,T){return!_.failures[T]})),Promise.all(C.map(function(S){return S=S.updatesTable,p?u.db.table(S).where("k").anyOf(p).delete():u.db.table(S).clear()})).then(function(){return _})):_}var xo=(w_.prototype.execute=function(u){var p=this["@@propmod"];if(p.add!==void 0){var _=p.add;if(a(_))return n(n([],a(u)?u:[],!0),_,!0).sort();if(typeof _=="number")return(Number(u)||0)+_;if(typeof _=="bigint")try{return BigInt(u)+_}catch{return BigInt(0)+_}throw new TypeError("Invalid term ".concat(_))}if(p.remove!==void 0){var C=p.remove;if(a(C))return a(u)?u.filter(function(S){return!C.includes(S)}).sort():[];if(typeof C=="number")return Number(u)-C;if(typeof C=="bigint")try{return BigInt(u)-C}catch{return BigInt(0)-C}throw new TypeError("Invalid subtrahend ".concat(C))}return _=(_=p.replacePrefix)===null||_===void 0?void 0:_[0],_&&typeof u=="string"&&u.startsWith(_)?p.replacePrefix[1]+u.substring(_.length):u},w_);function w_(u){this["@@propmod"]=u}function C_(u,p){for(var _=o(p),C=_.length,S=!1,T=0;T<C;++T){var M=_[T],A=p[M],R=O(u,M);A instanceof xo?(W(u,M,A.execute(R)),S=!0):R!==A&&(W(u,M,A),S=!0)}return S}var x_=(it.prototype._trans=function(u,p,_){var C=this._tx||ke.trans,S=this.name,T=zs&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(u==="readonly"?"read":"write"," ").concat(this.name));function M(z,H,L){if(!L.schema[S])throw new G.NotFound("Table "+S+" not part of transaction");return p(L.idbtrans,L)}var A=sr();try{var R=C&&C.db._novip===this.db._novip?C===ke.trans?C._promise(u,M,_):Mn(function(){return C._promise(u,M,_)},{trans:C,transless:ke.transless||ke}):function z(H,L,V,F){if(H.idbdb&&(H._state.openComplete||ke.letThrough||H._vip)){var j=H._createTransaction(L,V,H._dbSchema);try{j.create(),H._state.PR1398_maxLoop=3}catch(B){return B.name===Rs.InvalidState&&H.isOpen()&&0<--H._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),H.close({disableAutoOpen:!1}),H.open().then(function(){return z(H,L,V,F)})):ct(B)}return j._promise(L,function(B,U){return Mn(function(){return ke.trans=j,F(B,U,j)})}).then(function(B){if(L==="readwrite")try{j.idbtrans.commit()}catch{}return L==="readonly"?B:j._completion.then(function(){return B})})}if(H._state.openComplete)return ct(new G.DatabaseClosed(H._state.dbOpenError));if(!H._state.isBeingOpened){if(!H._state.autoOpen)return ct(new G.DatabaseClosed);H.open().catch(Re)}return H._state.dbReadyPromise.then(function(){return z(H,L,V,F)})}(this.db,u,[this.name],M);return T&&(R._consoleTask=T,R=R.catch(function(z){return console.trace(z),ct(z)})),R}finally{A&&nr()}},it.prototype.get=function(u,p){var _=this;return u&&u.constructor===Object?this.where(u).first(p):u==null?ct(new G.Type("Invalid argument to Table.get()")):this._trans("readonly",function(C){return _.core.get({trans:C,key:u}).then(function(S){return _.hook.reading.fire(S)})}).then(p)},it.prototype.where=function(u){if(typeof u=="string")return new this.db.WhereClause(this,u);if(a(u))return new this.db.WhereClause(this,"[".concat(u.join("+"),"]"));var p=o(u);if(p.length===1)return this.where(p[0]).equals(u[p[0]]);var _=this.schema.indexes.concat(this.schema.primKey).filter(function(A){if(A.compound&&p.every(function(z){return 0<=A.keyPath.indexOf(z)})){for(var R=0;R<p.length;++R)if(p.indexOf(A.keyPath[R])===-1)return!1;return!0}return!1}).sort(function(A,R){return A.keyPath.length-R.keyPath.length})[0];if(_&&this.db._maxKey!==ui){var T=_.keyPath.slice(0,p.length);return this.where(T).equals(T.map(function(R){return u[R]}))}!_&&zs&&console.warn("The query ".concat(JSON.stringify(u)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(p.join("+"),"]"));var C=this.schema.idxByName;function S(A,R){return Ge(A,R)===0}var M=p.reduce(function(L,R){var z=L[0],H=L[1],L=C[R],V=u[R];return[z||L,z||!L?fi(H,L&&L.multi?function(F){return F=O(F,R),a(F)&&F.some(function(j){return S(V,j)})}:function(F){return S(V,O(F,R))}):H]},[null,null]),T=M[0],M=M[1];return T?this.where(T.name).equals(u[T.keyPath]).filter(M):_?this.filter(M):this.where(p).equals("")},it.prototype.filter=function(u){return this.toCollection().and(u)},it.prototype.count=function(u){return this.toCollection().count(u)},it.prototype.offset=function(u){return this.toCollection().offset(u)},it.prototype.limit=function(u){return this.toCollection().limit(u)},it.prototype.each=function(u){return this.toCollection().each(u)},it.prototype.toArray=function(u){return this.toCollection().toArray(u)},it.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},it.prototype.orderBy=function(u){return new this.db.Collection(new this.db.WhereClause(this,a(u)?"[".concat(u.join("+"),"]"):u))},it.prototype.reverse=function(){return this.toCollection().reverse()},it.prototype.mapToClass=function(u){var p,_=this.db,C=this.name;function S(){return p!==null&&p.apply(this,arguments)||this}(this.schema.mappedClass=u).prototype instanceof v_&&(function(R,z){if(typeof z!="function"&&z!==null)throw new TypeError("Class extends value "+String(z)+" is not a constructor or null");function H(){this.constructor=R}t(R,z),R.prototype=z===null?Object.create(z):(H.prototype=z.prototype,new H)}(S,p=u),Object.defineProperty(S.prototype,"db",{get:function(){return _},enumerable:!1,configurable:!0}),S.prototype.table=function(){return C},u=S);for(var T=new Set,M=u.prototype;M;M=c(M))Object.getOwnPropertyNames(M).forEach(function(R){return T.add(R)});function A(R){if(!R)return R;var z,H=Object.create(u.prototype);for(z in R)if(!T.has(z))try{H[z]=R[z]}catch{}return H}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=A,this.hook("reading",A),u},it.prototype.defineClass=function(){return this.mapToClass(function(u){l(this,u)})},it.prototype.add=function(u,p){var _=this,C=this.schema.primKey,S=C.auto,T=C.keyPath,M=u;return T&&S&&(M=oc(T)(u)),this._trans("readwrite",function(A){return _.core.mutate({trans:A,type:"add",keys:p!=null?[p]:null,values:[M]})}).then(function(A){return A.numFailures?me.reject(A.failures[0]):A.lastResult}).then(function(A){if(T)try{W(u,T,A)}catch{}return A})},it.prototype.upsert=function(u,p){var _=this,C=this.schema.primKey.keyPath;return this._trans("readwrite",function(S){return _.core.get({trans:S,key:u}).then(function(T){var M=T??{};return C_(M,p),C&&W(M,C,u),_.core.mutate({trans:S,type:"put",values:[M],keys:[u],upsert:!0,updates:{keys:[u],changeSpecs:[p]}}).then(function(A){return A.numFailures?me.reject(A.failures[0]):!!T})})})},it.prototype.update=function(u,p){return typeof u!="object"||a(u)?this.where(":id").equals(u).modify(p):(u=O(u,this.schema.primKey.keyPath),u===void 0?ct(new G.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(u).modify(p))},it.prototype.put=function(u,p){var _=this,C=this.schema.primKey,S=C.auto,T=C.keyPath,M=u;return T&&S&&(M=oc(T)(u)),this._trans("readwrite",function(A){return _.core.mutate({trans:A,type:"put",values:[M],keys:p!=null?[p]:null})}).then(function(A){return A.numFailures?me.reject(A.failures[0]):A.lastResult}).then(function(A){if(T)try{W(u,T,A)}catch{}return A})},it.prototype.delete=function(u){var p=this;return this._trans("readwrite",function(_){return p.core.mutate({trans:_,type:"delete",keys:[u]}).then(function(C){return ac(p,[u],C)}).then(function(C){return C.numFailures?me.reject(C.failures[0]):void 0})})},it.prototype.clear=function(){var u=this;return this._trans("readwrite",function(p){return u.core.mutate({trans:p,type:"deleteRange",range:y_}).then(function(_){return ac(u,null,_)})}).then(function(p){return p.numFailures?me.reject(p.failures[0]):void 0})},it.prototype.bulkGet=function(u){var p=this;return this._trans("readonly",function(_){return p.core.getMany({keys:u,trans:_}).then(function(C){return C.map(function(S){return p.hook.reading.fire(S)})})})},it.prototype.bulkAdd=function(u,p,_){var C=this,S=Array.isArray(p)?p:void 0,T=(_=_||(S?void 0:p))?_.allKeys:void 0;return this._trans("readwrite",function(M){var z=C.schema.primKey,A=z.auto,z=z.keyPath;if(z&&S)throw new G.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(S&&S.length!==u.length)throw new G.InvalidArgument("Arguments objects and keys must have the same length");var R=u.length,z=z&&A?u.map(oc(z)):u;return C.core.mutate({trans:M,type:"add",keys:S,values:z,wantResults:T}).then(function(j){var L=j.numFailures,V=j.results,F=j.lastResult,j=j.failures;if(L===0)return T?V:F;throw new Mt("".concat(C.name,".bulkAdd(): ").concat(L," of ").concat(R," operations failed"),j)})})},it.prototype.bulkPut=function(u,p,_){var C=this,S=Array.isArray(p)?p:void 0,T=(_=_||(S?void 0:p))?_.allKeys:void 0;return this._trans("readwrite",function(M){var z=C.schema.primKey,A=z.auto,z=z.keyPath;if(z&&S)throw new G.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(S&&S.length!==u.length)throw new G.InvalidArgument("Arguments objects and keys must have the same length");var R=u.length,z=z&&A?u.map(oc(z)):u;return C.core.mutate({trans:M,type:"put",keys:S,values:z,wantResults:T}).then(function(j){var L=j.numFailures,V=j.results,F=j.lastResult,j=j.failures;if(L===0)return T?V:F;throw new Mt("".concat(C.name,".bulkPut(): ").concat(L," of ").concat(R," operations failed"),j)})})},it.prototype.bulkUpdate=function(u){var p=this,_=this.core,C=u.map(function(M){return M.key}),S=u.map(function(M){return M.changes}),T=[];return this._trans("readwrite",function(M){return _.getMany({trans:M,keys:C,cache:"clone"}).then(function(A){var R=[],z=[];u.forEach(function(L,V){var F=L.key,j=L.changes,B=A[V];if(B){for(var U=0,q=Object.keys(j);U<q.length;U++){var Z=q[U],Q=j[Z];if(Z===p.schema.primKey.keyPath){if(Ge(Q,F)!==0)throw new G.Constraint("Cannot update primary key in bulkUpdate()")}else W(B,Z,Q)}T.push(V),R.push(F),z.push(B)}});var H=R.length;return _.mutate({trans:M,type:"put",keys:R,values:z,updates:{keys:C,changeSpecs:S}}).then(function(L){var V=L.numFailures,F=L.failures;if(V===0)return H;for(var j=0,B=Object.keys(F);j<B.length;j++){var U,q=B[j],Z=T[Number(q)];Z!=null&&(U=F[q],delete F[q],F[Z]=U)}throw new Mt("".concat(p.name,".bulkUpdate(): ").concat(V," of ").concat(H," operations failed"),F)})})})},it.prototype.bulkDelete=function(u){var p=this,_=u.length;return this._trans("readwrite",function(C){return p.core.mutate({trans:C,type:"delete",keys:u}).then(function(S){return ac(p,u,S)})}).then(function(M){var S=M.numFailures,T=M.lastResult,M=M.failures;if(S===0)return T;throw new Mt("".concat(p.name,".bulkDelete(): ").concat(S," of ").concat(_," operations failed"),M)})},it);function it(){}function ko(u){function p(M,A){if(A){for(var R=arguments.length,z=new Array(R-1);--R;)z[R-1]=arguments[R];return _[M].subscribe.apply(null,z),u}if(typeof M=="string")return _[M]}var _={};p.addEventType=T;for(var C=1,S=arguments.length;C<S;++C)T(arguments[C]);return p;function T(M,A,R){if(typeof M!="object"){var z;A=A||qS;var H={subscribers:[],fire:R=R||Re,subscribe:function(L){H.subscribers.indexOf(L)===-1&&(H.subscribers.push(L),H.fire=A(H.fire,L))},unsubscribe:function(L){H.subscribers=H.subscribers.filter(function(V){return V!==L}),H.fire=H.subscribers.reduce(A,R)}};return _[M]=p[M]=H}o(z=M).forEach(function(L){var V=z[L];if(a(V))T(L,z[L][0],z[L][1]);else{if(V!=="asap")throw new G.InvalidArgument("Invalid event config");var F=T(L,nt,function(){for(var j=arguments.length,B=new Array(j);j--;)B[j]=arguments[j];F.subscribers.forEach(function(U){P(function(){U.apply(null,B)})})})}})}}function So(u,p){return b(p).from({prototype:u}),p}function or(u,p){return!(u.filter||u.algorithm||u.or)&&(p?u.justLimit:!u.replayFilter)}function ef(u,p){u.filter=fi(u.filter,p)}function tf(u,p,_){var C=u.replayFilter;u.replayFilter=C?function(){return fi(C(),p())}:p,u.justLimit=_&&!C}function lc(u,p){if(u.isPrimKey)return p.primaryKey;var _=p.getIndexByKeyPath(u.index);if(!_)throw new G.Schema("KeyPath "+u.index+" on object store "+p.name+" is not indexed");return _}function k_(u,p,_){var C=lc(u,p.schema);return p.openCursor({trans:_,values:!u.keysOnly,reverse:u.dir==="prev",unique:!!u.unique,query:{index:C,range:u.range}})}function cc(u,p,_,C){var S=u.replayFilter?fi(u.filter,u.replayFilter()):u.filter;if(u.or){var T={},M=function(A,R,z){var H,L;S&&!S(R,z,function(V){return R.stop(V)},function(V){return R.fail(V)})||((L=""+(H=R.primaryKey))=="[object ArrayBuffer]"&&(L=""+new Uint8Array(H)),d(T,L)||(T[L]=!0,p(A,R,z)))};return Promise.all([u.or._iterate(M,_),S_(k_(u,C,_),u.algorithm,M,!u.keysOnly&&u.valueMapper)])}return S_(k_(u,C,_),fi(u.algorithm,S),p,!u.keysOnly&&u.valueMapper)}function S_(u,p,_,C){var S=lt(C?function(T,M,A){return _(C(T),M,A)}:_);return u.then(function(T){if(T)return T.start(function(){var M=function(){return T.continue()};p&&!p(T,function(A){return M=A},function(A){T.stop(A),M=Re},function(A){T.fail(A),M=Re})||S(T.value,T,function(A){return M=A}),M()})})}var QS=(Ye.prototype._read=function(u,p){var _=this._ctx;return _.error?_.table._trans(null,ct.bind(null,_.error)):_.table._trans("readonly",u).then(p)},Ye.prototype._write=function(u){var p=this._ctx;return p.error?p.table._trans(null,ct.bind(null,p.error)):p.table._trans("readwrite",u,"locked")},Ye.prototype._addAlgorithm=function(u){var p=this._ctx;p.algorithm=fi(p.algorithm,u)},Ye.prototype._iterate=function(u,p){return cc(this._ctx,u,p,this._ctx.table.core)},Ye.prototype.clone=function(u){var p=Object.create(this.constructor.prototype),_=Object.create(this._ctx);return u&&l(_,u),p._ctx=_,p},Ye.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ye.prototype.each=function(u){var p=this._ctx;return this._read(function(_){return cc(p,u,_,p.table.core)})},Ye.prototype.count=function(u){var p=this;return this._read(function(_){var C=p._ctx,S=C.table.core;if(or(C,!0))return S.count({trans:_,query:{index:lc(C,S.schema),range:C.range}}).then(function(M){return Math.min(M,C.limit)});var T=0;return cc(C,function(){return++T,!1},_,S).then(function(){return T})}).then(u)},Ye.prototype.sortBy=function(u,p){var _=u.split(".").reverse(),C=_[0],S=_.length-1;function T(R,z){return z?T(R[_[z]],z-1):R[C]}var M=this._ctx.dir==="next"?1:-1;function A(R,z){return Ge(T(R,S),T(z,S))*M}return this.toArray(function(R){return R.sort(A)}).then(p)},Ye.prototype.toArray=function(u){var p=this;return this._read(function(_){var C=p._ctx;if(C.dir==="next"&&or(C,!0)&&0<C.limit){var S=C.valueMapper,T=lc(C,C.table.core.schema);return C.table.core.query({trans:_,limit:C.limit,values:!0,query:{index:T,range:C.range}}).then(function(A){return A=A.result,S?A.map(S):A})}var M=[];return cc(C,function(A){return M.push(A)},_,C.table.core).then(function(){return M})},u)},Ye.prototype.offset=function(u){var p=this._ctx;return u<=0||(p.offset+=u,or(p)?tf(p,function(){var _=u;return function(C,S){return _===0||(_===1?--_:S(function(){C.advance(_),_=0}),!1)}}):tf(p,function(){var _=u;return function(){return--_<0}})),this},Ye.prototype.limit=function(u){return this._ctx.limit=Math.min(this._ctx.limit,u),tf(this._ctx,function(){var p=u;return function(_,C,S){return--p<=0&&C(S),0<=p}},!0),this},Ye.prototype.until=function(u,p){return ef(this._ctx,function(_,C,S){return!u(_.value)||(C(S),p)}),this},Ye.prototype.first=function(u){return this.limit(1).toArray(function(p){return p[0]}).then(u)},Ye.prototype.last=function(u){return this.reverse().first(u)},Ye.prototype.filter=function(u){var p;return ef(this._ctx,function(_){return u(_.value)}),(p=this._ctx).isMatch=fi(p.isMatch,u),this},Ye.prototype.and=function(u){return this.filter(u)},Ye.prototype.or=function(u){return new this.db.WhereClause(this._ctx.table,u,this)},Ye.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ye.prototype.desc=function(){return this.reverse()},Ye.prototype.eachKey=function(u){var p=this._ctx;return p.keysOnly=!p.isMatch,this.each(function(_,C){u(C.key,C)})},Ye.prototype.eachUniqueKey=function(u){return this._ctx.unique="unique",this.eachKey(u)},Ye.prototype.eachPrimaryKey=function(u){var p=this._ctx;return p.keysOnly=!p.isMatch,this.each(function(_,C){u(C.primaryKey,C)})},Ye.prototype.keys=function(u){var p=this._ctx;p.keysOnly=!p.isMatch;var _=[];return this.each(function(C,S){_.push(S.key)}).then(function(){return _}).then(u)},Ye.prototype.primaryKeys=function(u){var p=this._ctx;if(p.dir==="next"&&or(p,!0)&&0<p.limit)return this._read(function(C){var S=lc(p,p.table.core.schema);return p.table.core.query({trans:C,values:!1,limit:p.limit,query:{index:S,range:p.range}})}).then(function(C){return C.result}).then(u);p.keysOnly=!p.isMatch;var _=[];return this.each(function(C,S){_.push(S.primaryKey)}).then(function(){return _}).then(u)},Ye.prototype.uniqueKeys=function(u){return this._ctx.unique="unique",this.keys(u)},Ye.prototype.firstKey=function(u){return this.limit(1).keys(function(p){return p[0]}).then(u)},Ye.prototype.lastKey=function(u){return this.reverse().firstKey(u)},Ye.prototype.distinct=function(){var u=this._ctx,u=u.index&&u.table.schema.idxByName[u.index];if(!u||!u.multi)return this;var p={};return ef(this._ctx,function(S){var C=S.primaryKey.toString(),S=d(p,C);return p[C]=!0,!S}),this},Ye.prototype.modify=function(u){var p=this,_=this._ctx;return this._write(function(C){var S=typeof u=="function"?u:function(B){return C_(B,u)},T=_.table.core,z=T.schema.primaryKey,M=z.outbound,A=z.extractKey,R=200,z=p.db._options.modifyChunkSize;z&&(R=typeof z=="object"?z[T.name]||z["*"]||200:z);function H(B,Z){var q=Z.failures,Z=Z.numFailures;V+=B-Z;for(var Q=0,se=o(q);Q<se.length;Q++){var re=se[Q];L.push(q[re])}}var L=[],V=0,F=[],j=u===T_;return p.clone().primaryKeys().then(function(B){function U(Z){var Q=Math.min(R,B.length-Z),se=B.slice(Z,Z+Q);return(j?Promise.resolve([]):T.getMany({trans:C,keys:se,cache:"immutable"})).then(function(re){var he=[],ie=[],oe=M?[]:null,ue=j?se:[];if(!j)for(var le=0;le<Q;++le){var _e=re[le],Oe={value:Ce(_e),primKey:B[Z+le]};S.call(Oe,Oe.value,Oe)!==!1&&(Oe.value==null?ue.push(B[Z+le]):M||Ge(A(_e),A(Oe.value))===0?(ie.push(Oe.value),M&&oe.push(B[Z+le])):(ue.push(B[Z+le]),he.push(Oe.value)))}return Promise.resolve(0<he.length&&T.mutate({trans:C,type:"add",values:he}).then(function(Ue){for(var qe in Ue.failures)ue.splice(parseInt(qe),1);H(he.length,Ue)})).then(function(){return(0<ie.length||q&&typeof u=="object")&&T.mutate({trans:C,type:"put",keys:oe,values:ie,criteria:q,changeSpec:typeof u!="function"&&u,isAdditionalChunk:0<Z}).then(function(Ue){return H(ie.length,Ue)})}).then(function(){return(0<ue.length||q&&j)&&T.mutate({trans:C,type:"delete",keys:ue,criteria:q,isAdditionalChunk:0<Z}).then(function(Ue){return ac(_.table,ue,Ue)}).then(function(Ue){return H(ue.length,Ue)})}).then(function(){return B.length>Z+Q&&U(Z+R)})})}var q=or(_)&&_.limit===1/0&&(typeof u!="function"||j)&&{index:_.index,range:_.range};return U(0).then(function(){if(0<L.length)throw new rs("Error modifying one or more objects",L,V,F);return B.length})})})},Ye.prototype.delete=function(){var u=this._ctx,p=u.range;return!or(u)||u.table.schema.yProps||!u.isPrimKey&&p.type!==3?this.modify(T_):this._write(function(_){var C=u.table.core.schema.primaryKey,S=p;return u.table.core.count({trans:_,query:{index:C,range:S}}).then(function(T){return u.table.core.mutate({trans:_,type:"deleteRange",range:S}).then(function(R){var A=R.failures,R=R.numFailures;if(R)throw new rs("Could not delete some values",Object.keys(A).map(function(z){return A[z]}),T-R);return T-R})})})},Ye);function Ye(){}var T_=function(u,p){return p.value=null};function eT(u,p){return u<p?-1:u===p?0:1}function tT(u,p){return p<u?-1:u===p?0:1}function Qt(u,p,_){return u=u instanceof D_?new u.Collection(u):u,u._ctx.error=new(_||TypeError)(p),u}function ar(u){return new u.Collection(u,function(){return $_("")}).limit(0)}function hc(u,p,_,C){var S,T,M,A,R,z,H,L=_.length;if(!_.every(function(j){return typeof j=="string"}))return Qt(u,g_);function V(j){S=j==="next"?function(U){return U.toUpperCase()}:function(U){return U.toLowerCase()},T=j==="next"?function(U){return U.toLowerCase()}:function(U){return U.toUpperCase()},M=j==="next"?eT:tT;var B=_.map(function(U){return{lower:T(U),upper:S(U)}}).sort(function(U,q){return M(U.lower,q.lower)});A=B.map(function(U){return U.upper}),R=B.map(function(U){return U.lower}),H=(z=j)==="next"?"":C}V("next"),u=new u.Collection(u,function(){return An(A[0],R[L-1]+C)}),u._ondirectionchange=function(j){V(j)};var F=0;return u._addAlgorithm(function(j,B,U){var q=j.key;if(typeof q!="string")return!1;var Z=T(q);if(p(Z,R,F))return!0;for(var Q=null,se=F;se<L;++se){var re=function(he,ie,oe,ue,le,_e){for(var Oe=Math.min(he.length,ue.length),Ue=-1,qe=0;qe<Oe;++qe){var es=ie[qe];if(es!==ue[qe])return le(he[qe],oe[qe])<0?he.substr(0,qe)+oe[qe]+oe.substr(qe+1):le(he[qe],ue[qe])<0?he.substr(0,qe)+ue[qe]+oe.substr(qe+1):0<=Ue?he.substr(0,Ue)+ie[Ue]+oe.substr(Ue+1):null;le(he[qe],es)<0&&(Ue=qe)}return Oe<ue.length&&_e==="next"?he+oe.substr(he.length):Oe<he.length&&_e==="prev"?he.substr(0,oe.length):Ue<0?null:he.substr(0,Ue)+ue[Ue]+oe.substr(Ue+1)}(q,Z,A[se],R[se],M,z);re===null&&Q===null?F=se+1:(Q===null||0<M(Q,re))&&(Q=re)}return B(Q!==null?function(){j.continue(Q+H)}:U),!1}),u}function An(u,p,_,C){return{type:2,lower:u,upper:p,lowerOpen:_,upperOpen:C}}function $_(u){return{type:1,lower:u,upper:u}}var D_=(Object.defineProperty(xt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),xt.prototype.between=function(u,p,_,C){_=_!==!1,C=C===!0;try{return 0<this._cmp(u,p)||this._cmp(u,p)===0&&(_||C)&&(!_||!C)?ar(this):new this.Collection(this,function(){return An(u,p,!_,!C)})}catch{return Qt(this,nn)}},xt.prototype.equals=function(u){return u==null?Qt(this,nn):new this.Collection(this,function(){return $_(u)})},xt.prototype.above=function(u){return u==null?Qt(this,nn):new this.Collection(this,function(){return An(u,void 0,!0)})},xt.prototype.aboveOrEqual=function(u){return u==null?Qt(this,nn):new this.Collection(this,function(){return An(u,void 0,!1)})},xt.prototype.below=function(u){return u==null?Qt(this,nn):new this.Collection(this,function(){return An(void 0,u,!1,!0)})},xt.prototype.belowOrEqual=function(u){return u==null?Qt(this,nn):new this.Collection(this,function(){return An(void 0,u)})},xt.prototype.startsWith=function(u){return typeof u!="string"?Qt(this,g_):this.between(u,u+ui,!0,!0)},xt.prototype.startsWithIgnoreCase=function(u){return u===""?this.startsWith(u):hc(this,function(p,_){return p.indexOf(_[0])===0},[u],ui)},xt.prototype.equalsIgnoreCase=function(u){return hc(this,function(p,_){return p===_[0]},[u],"")},xt.prototype.anyOfIgnoreCase=function(){var u=Ae.apply(Ee,arguments);return u.length===0?ar(this):hc(this,function(p,_){return _.indexOf(p)!==-1},u,"")},xt.prototype.startsWithAnyOfIgnoreCase=function(){var u=Ae.apply(Ee,arguments);return u.length===0?ar(this):hc(this,function(p,_){return _.some(function(C){return p.indexOf(C)===0})},u,ui)},xt.prototype.anyOf=function(){var u=this,p=Ae.apply(Ee,arguments),_=this._cmp;try{p.sort(_)}catch{return Qt(this,nn)}if(p.length===0)return ar(this);var C=new this.Collection(this,function(){return An(p[0],p[p.length-1])});C._ondirectionchange=function(T){_=T==="next"?u._ascending:u._descending,p.sort(_)};var S=0;return C._addAlgorithm(function(T,M,A){for(var R=T.key;0<_(R,p[S]);)if(++S===p.length)return M(A),!1;return _(R,p[S])===0||(M(function(){T.continue(p[S])}),!1)}),C},xt.prototype.notEqual=function(u){return this.inAnyRange([[-1/0,u],[u,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},xt.prototype.noneOf=function(){var u=Ae.apply(Ee,arguments);if(u.length===0)return new this.Collection(this);try{u.sort(this._ascending)}catch{return Qt(this,nn)}var p=u.reduce(function(_,C){return _?_.concat([[_[_.length-1][1],C]]):[[-1/0,C]]},null);return p.push([u[u.length-1],this.db._maxKey]),this.inAnyRange(p,{includeLowers:!1,includeUppers:!1})},xt.prototype.inAnyRange=function(q,p){var _=this,C=this._cmp,S=this._ascending,T=this._descending,M=this._min,A=this._max;if(q.length===0)return ar(this);if(!q.every(function(Z){return Z[0]!==void 0&&Z[1]!==void 0&&S(Z[0],Z[1])<=0}))return Qt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",G.InvalidArgument);var R=!p||p.includeLowers!==!1,z=p&&p.includeUppers===!0,H,L=S;function V(Z,Q){return L(Z[0],Q[0])}try{(H=q.reduce(function(Z,Q){for(var se=0,re=Z.length;se<re;++se){var he=Z[se];if(C(Q[0],he[1])<0&&0<C(Q[1],he[0])){he[0]=M(he[0],Q[0]),he[1]=A(he[1],Q[1]);break}}return se===re&&Z.push(Q),Z},[])).sort(V)}catch{return Qt(this,nn)}var F=0,j=z?function(Z){return 0<S(Z,H[F][1])}:function(Z){return 0<=S(Z,H[F][1])},B=R?function(Z){return 0<T(Z,H[F][0])}:function(Z){return 0<=T(Z,H[F][0])},U=j,q=new this.Collection(this,function(){return An(H[0][0],H[H.length-1][1],!R,!z)});return q._ondirectionchange=function(Z){L=Z==="next"?(U=j,S):(U=B,T),H.sort(V)},q._addAlgorithm(function(Z,Q,se){for(var re,he=Z.key;U(he);)if(++F===H.length)return Q(se),!1;return!j(re=he)&&!B(re)||(_._cmp(he,H[F][1])===0||_._cmp(he,H[F][0])===0||Q(function(){L===S?Z.continue(H[F][0]):Z.continue(H[F][1])}),!1)}),q},xt.prototype.startsWithAnyOf=function(){var u=Ae.apply(Ee,arguments);return u.every(function(p){return typeof p=="string"})?u.length===0?ar(this):this.inAnyRange(u.map(function(p){return[p,p+ui]})):Qt(this,"startsWithAnyOf() only works with strings")},xt);function xt(){}function Fs(u){return lt(function(p){return To(p),u(p.target.error),!1})}function To(u){u.stopPropagation&&u.stopPropagation(),u.preventDefault&&u.preventDefault()}var $o="storagemutated",sf="x-storagemutated-1",Pn=ko(null,$o),sT=(Os.prototype._lock=function(){return E(!ke.global),++this._reculock,this._reculock!==1||ke.global||(ke.lockOwnerFor=this),this},Os.prototype._unlock=function(){if(E(!ke.global),--this._reculock==0)for(ke.global||(ke.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var u=this._blockedFuncs.shift();try{di(u[1],u[0])}catch{}}return this},Os.prototype._locked=function(){return this._reculock&&ke.lockOwnerFor!==this},Os.prototype.create=function(u){var p=this;if(!this.mode)return this;var _=this.db.idbdb,C=this.db._state.dbOpenError;if(E(!this.idbtrans),!u&&!_)switch(C&&C.name){case"DatabaseClosedError":throw new G.DatabaseClosed(C);case"MissingAPIError":throw new G.MissingAPI(C.message,C);default:throw new G.OpenFailed(C)}if(!this.active)throw new G.TransactionInactive;return E(this._completion._state===null),(u=this.idbtrans=u||(this.db.core||_).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=lt(function(S){To(S),p._reject(u.error)}),u.onabort=lt(function(S){To(S),p.active&&p._reject(new G.Abort(u.error)),p.active=!1,p.on("abort").fire(S)}),u.oncomplete=lt(function(){p.active=!1,p._resolve(),"mutatedParts"in u&&Pn.storagemutated.fire(u.mutatedParts)}),this},Os.prototype._promise=function(u,p,_){var C=this;if(u==="readwrite"&&this.mode!=="readwrite")return ct(new G.ReadOnly("Transaction is readonly"));if(!this.active)return ct(new G.TransactionInactive);if(this._locked())return new me(function(T,M){C._blockedFuncs.push([function(){C._promise(u,p,_).then(T,M)},ke])});if(_)return Mn(function(){var T=new me(function(M,A){C._lock();var R=p(M,A,C);R&&R.then&&R.then(M,A)});return T.finally(function(){return C._unlock()}),T._lib=!0,T});var S=new me(function(T,M){var A=p(T,M,C);A&&A.then&&A.then(T,M)});return S._lib=!0,S},Os.prototype._root=function(){return this.parent?this.parent._root():this},Os.prototype.waitFor=function(u){var p,_=this._root(),C=me.resolve(u);_._waitingFor?_._waitingFor=_._waitingFor.then(function(){return C}):(_._waitingFor=C,_._waitingQueue=[],p=_.idbtrans.objectStore(_.storeNames[0]),function T(){for(++_._spinCount;_._waitingQueue.length;)_._waitingQueue.shift()();_._waitingFor&&(p.get(-1/0).onsuccess=T)}());var S=_._waitingFor;return new me(function(T,M){C.then(function(A){return _._waitingQueue.push(lt(T.bind(null,A)))},function(A){return _._waitingQueue.push(lt(M.bind(null,A)))}).finally(function(){_._waitingFor===S&&(_._waitingFor=null)})})},Os.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new G.Abort))},Os.prototype.table=function(u){var p=this._memoizedTables||(this._memoizedTables={});if(d(p,u))return p[u];var _=this.schema[u];if(!_)throw new G.NotFound("Table "+u+" not part of transaction");return _=new this.db.Table(u,_,this),_.core=this.db.core.table(u),p[u]=_},Os);function Os(){}function nf(u,p,_,C,S,T,M,A){return{name:u,keyPath:p,unique:_,multi:C,auto:S,compound:T,src:(_&&!M?"&":"")+(C?"*":"")+(S?"++":"")+I_(p),type:A}}function I_(u){return typeof u=="string"?u:u?"["+[].join.call(u,"+")+"]":""}function rf(u,p,_){return{name:u,primKey:p,indexes:_,mappedClass:null,idxByName:(C=function(S){return[S.name,S]},_.reduce(function(S,T,M){return M=C(T,M),M&&(S[M[0]]=M[1]),S},{}))};var C}var Do=function(u){try{return u.only([[]]),Do=function(){return[[]]},[[]]}catch{return Do=function(){return ui},ui}};function of(u){return u==null?function(){}:typeof u=="string"?(p=u).split(".").length===1?function(_){return _[p]}:function(_){return O(_,p)}:function(_){return O(_,u)};var p}function M_(u){return[].slice.call(u)}var nT=0;function Io(u){return u==null?":id":typeof u=="string"?u:"[".concat(u.join("+"),"]")}function iT(u,p,R){function C(U){if(U.type===3)return null;if(U.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var F=U.lower,j=U.upper,B=U.lowerOpen,U=U.upperOpen;return F===void 0?j===void 0?null:p.upperBound(j,!!U):j===void 0?p.lowerBound(F,!!B):p.bound(F,j,!!B,!!U)}function S(V){var F,j=V.name;return{name:j,schema:V,mutate:function(B){var U=B.trans,q=B.type,Z=B.keys,Q=B.values,se=B.range;return new Promise(function(re,he){re=lt(re);var ie=U.objectStore(j),oe=ie.keyPath==null,ue=q==="put"||q==="add";if(!ue&&q!=="delete"&&q!=="deleteRange")throw new Error("Invalid operation type: "+q);var le,_e=(Z||Q||{length:1}).length;if(Z&&Q&&Z.length!==Q.length)throw new Error("Given keys array must have same length as given values array.");if(_e===0)return re({numFailures:0,failures:{},results:[],lastResult:void 0});function Oe(Bt){++es,To(Bt)}var Ue=[],qe=[],es=0;if(q==="deleteRange"){if(se.type===4)return re({numFailures:es,failures:qe,results:[],lastResult:void 0});se.type===3?Ue.push(le=ie.clear()):Ue.push(le=ie.delete(C(se)))}else{var oe=ue?oe?[Q,Z]:[Q,null]:[Z,null],Fe=oe[0],At=oe[1];if(ue)for(var Pt=0;Pt<_e;++Pt)Ue.push(le=At&&At[Pt]!==void 0?ie[q](Fe[Pt],At[Pt]):ie[q](Fe[Pt])),le.onerror=Oe;else for(Pt=0;Pt<_e;++Pt)Ue.push(le=ie[q](Fe[Pt])),le.onerror=Oe}function Cc(Bt){Bt=Bt.target.result,Ue.forEach(function(gi,kf){return gi.error!=null&&(qe[kf]=gi.error)}),re({numFailures:es,failures:qe,results:q==="delete"?Z:Ue.map(function(gi){return gi.result}),lastResult:Bt})}le.onerror=function(Bt){Oe(Bt),Cc(Bt)},le.onsuccess=Cc})},getMany:function(B){var U=B.trans,q=B.keys;return new Promise(function(Z,Q){Z=lt(Z);for(var se,re=U.objectStore(j),he=q.length,ie=new Array(he),oe=0,ue=0,le=function(Ue){Ue=Ue.target,ie[Ue._pos]=Ue.result,++ue===oe&&Z(ie)},_e=Fs(Q),Oe=0;Oe<he;++Oe)q[Oe]!=null&&((se=re.get(q[Oe]))._pos=Oe,se.onsuccess=le,se.onerror=_e,++oe);oe===0&&Z(ie)})},get:function(B){var U=B.trans,q=B.key;return new Promise(function(Z,Q){Z=lt(Z);var se=U.objectStore(j).get(q);se.onsuccess=function(re){return Z(re.target.result)},se.onerror=Fs(Q)})},query:(F=z,function(B){return new Promise(function(U,q){U=lt(U);var Z,Q,se,oe=B.trans,re=B.values,he=B.limit,le=B.query,ie=he===1/0?void 0:he,ue=le.index,le=le.range,oe=oe.objectStore(j),ue=ue.isPrimaryKey?oe:oe.index(ue.name),le=C(le);if(he===0)return U({result:[]});F?((ie=re?ue.getAll(le,ie):ue.getAllKeys(le,ie)).onsuccess=function(_e){return U({result:_e.target.result})},ie.onerror=Fs(q)):(Z=0,Q=!re&&"openKeyCursor"in ue?ue.openKeyCursor(le):ue.openCursor(le),se=[],Q.onsuccess=function(_e){var Oe=Q.result;return Oe?(se.push(re?Oe.value:Oe.primaryKey),++Z===he?U({result:se}):void Oe.continue()):U({result:se})},Q.onerror=Fs(q))})}),openCursor:function(B){var U=B.trans,q=B.values,Z=B.query,Q=B.reverse,se=B.unique;return new Promise(function(re,he){re=lt(re);var ue=Z.index,ie=Z.range,oe=U.objectStore(j),oe=ue.isPrimaryKey?oe:oe.index(ue.name),ue=Q?se?"prevunique":"prev":se?"nextunique":"next",le=!q&&"openKeyCursor"in oe?oe.openKeyCursor(C(ie),ue):oe.openCursor(C(ie),ue);le.onerror=Fs(he),le.onsuccess=lt(function(_e){var Oe,Ue,qe,es,Fe=le.result;Fe?(Fe.___id=++nT,Fe.done=!1,Oe=Fe.continue.bind(Fe),Ue=(Ue=Fe.continuePrimaryKey)&&Ue.bind(Fe),qe=Fe.advance.bind(Fe),es=function(){throw new Error("Cursor not stopped")},Fe.trans=U,Fe.stop=Fe.continue=Fe.continuePrimaryKey=Fe.advance=function(){throw new Error("Cursor not started")},Fe.fail=lt(he),Fe.next=function(){var At=this,Pt=1;return this.start(function(){return Pt--?At.continue():At.stop()}).then(function(){return At})},Fe.start=function(At){function Pt(){if(le.result)try{At()}catch(Bt){Fe.fail(Bt)}else Fe.done=!0,Fe.start=function(){throw new Error("Cursor behind last entry")},Fe.stop()}var Cc=new Promise(function(Bt,gi){Bt=lt(Bt),le.onerror=Fs(gi),Fe.fail=gi,Fe.stop=function(kf){Fe.stop=Fe.continue=Fe.continuePrimaryKey=Fe.advance=es,Bt(kf)}});return le.onsuccess=lt(function(Bt){le.onsuccess=Pt,Pt()}),Fe.continue=Oe,Fe.continuePrimaryKey=Ue,Fe.advance=qe,Pt(),Cc},re(Fe)):re(null)},he)})},count:function(B){var U=B.query,q=B.trans,Z=U.index,Q=U.range;return new Promise(function(se,re){var he=q.objectStore(j),ie=Z.isPrimaryKey?he:he.index(Z.name),he=C(Q),ie=he?ie.count(he):ie.count();ie.onsuccess=lt(function(oe){return se(oe.target.result)}),ie.onerror=Fs(re)})}}}var T,M,A,H=(M=R,A=M_((T=u).objectStoreNames),{schema:{name:T.name,tables:A.map(function(V){return M.objectStore(V)}).map(function(V){var F=V.keyPath,U=V.autoIncrement,j=a(F),B={},U={name:V.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:F==null,compound:j,keyPath:F,autoIncrement:U,unique:!0,extractKey:of(F)},indexes:M_(V.indexNames).map(function(q){return V.index(q)}).map(function(se){var Z=se.name,Q=se.unique,re=se.multiEntry,se=se.keyPath,re={name:Z,compound:a(se),keyPath:se,unique:Q,multiEntry:re,extractKey:of(se)};return B[Io(se)]=re}),getIndexByKeyPath:function(q){return B[Io(q)]}};return B[":id"]=U.primaryKey,F!=null&&(B[Io(F)]=U.primaryKey),U})},hasGetAll:0<A.length&&"getAll"in M.objectStore(A[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),R=H.schema,z=H.hasGetAll,H=R.tables.map(S),L={};return H.forEach(function(V){return L[V.name]=V}),{stack:"dbcore",transaction:u.transaction.bind(u),table:function(V){if(!L[V])throw new Error("Table '".concat(V,"' not found"));return L[V]},MIN_KEY:-1/0,MAX_KEY:Do(p),schema:R}}function rT(u,p,_,C){var S=_.IDBKeyRange;return _.indexedDB,{dbcore:(C=iT(p,S,C),u.dbcore.reduce(function(T,M){return M=M.create,s(s({},T),M(T))},C))}}function dc(u,C){var _=C.db,C=rT(u._middlewares,_,u._deps,C);u.core=C.dbcore,u.tables.forEach(function(S){var T=S.name;u.core.schema.tables.some(function(M){return M.name===T})&&(S.core=u.core.table(T),u[T]instanceof u.Table&&(u[T].core=S.core))})}function uc(u,p,_,C){_.forEach(function(S){var T=C[S];p.forEach(function(M){var A=function R(z,H){return w(z,H)||(z=c(z))&&R(z,H)}(M,S);(!A||"value"in A&&A.value===void 0)&&(M===u.Transaction.prototype||M instanceof u.Transaction?y(M,S,{get:function(){return this.table(S)},set:function(R){m(this,S,{value:R,writable:!0,configurable:!0,enumerable:!0})}}):M[S]=new u.Table(S,T))})})}function af(u,p){p.forEach(function(_){for(var C in _)_[C]instanceof u.Table&&delete _[C]})}function oT(u,p){return u._cfg.version-p._cfg.version}function aT(u,p,_,C){var S=u._dbSchema;_.objectStoreNames.contains("$meta")&&!S.$meta&&(S.$meta=rf("$meta",E_("")[0],[]),u._storeNames.push("$meta"));var T=u._createTransaction("readwrite",u._storeNames,S);T.create(_),T._completion.catch(C);var M=T._reject.bind(T),A=ke.transless||ke;Mn(function(){return ke.trans=T,ke.transless=A,p!==0?(dc(u,_),z=p,((R=T).storeNames.includes("$meta")?R.table("$meta").get("version").then(function(H){return H??z}):me.resolve(z)).then(function(H){return V=H,F=T,j=_,B=[],H=(L=u)._versions,U=L._dbSchema=pc(0,L.idbdb,j),(H=H.filter(function(q){return q._cfg.version>=V})).length!==0?(H.forEach(function(q){B.push(function(){var Z=U,Q=q._cfg.dbschema;mc(L,Z,j),mc(L,Q,j),U=L._dbSchema=Q;var se=lf(Z,Q);se.add.forEach(function(ue){cf(j,ue[0],ue[1].primKey,ue[1].indexes)}),se.change.forEach(function(ue){if(ue.recreate)throw new G.Upgrade("Not yet support for changing primary key");var le=j.objectStore(ue.name);ue.add.forEach(function(_e){return fc(le,_e)}),ue.change.forEach(function(_e){le.deleteIndex(_e.name),fc(le,_e)}),ue.del.forEach(function(_e){return le.deleteIndex(_e)})});var re=q._cfg.contentUpgrade;if(re&&q._cfg.version>V){dc(L,j),F._memoizedTables={};var he=J(Q);se.del.forEach(function(ue){he[ue]=Z[ue]}),af(L,[L.Transaction.prototype]),uc(L,[L.Transaction.prototype],o(he),he),F.schema=he;var ie,oe=We(re);return oe&&ir(),se=me.follow(function(){var ue;(ie=re(F))&&oe&&(ue=Nn.bind(null,null),ie.then(ue,ue))}),ie&&typeof ie.then=="function"?me.resolve(ie):se.then(function(){return ie})}}),B.push(function(Z){var Q,se,re=q._cfg.dbschema;Q=re,se=Z,[].slice.call(se.db.objectStoreNames).forEach(function(he){return Q[he]==null&&se.db.deleteObjectStore(he)}),af(L,[L.Transaction.prototype]),uc(L,[L.Transaction.prototype],L._storeNames,L._dbSchema),F.schema=L._dbSchema}),B.push(function(Z){L.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(L.idbdb.version/10)===q._cfg.version?(L.idbdb.deleteObjectStore("$meta"),delete L._dbSchema.$meta,L._storeNames=L._storeNames.filter(function(Q){return Q!=="$meta"})):Z.objectStore("$meta").put(q._cfg.version,"version"))})}),function q(){return B.length?me.resolve(B.shift()(F.idbtrans)).then(q):me.resolve()}().then(function(){N_(U,j)})):me.resolve();var L,V,F,j,B,U}).catch(M)):(o(S).forEach(function(H){cf(_,H,S[H].primKey,S[H].indexes)}),dc(u,_),void me.follow(function(){return u.on.populate.fire(T)}).catch(M));var R,z})}function lT(u,p){N_(u._dbSchema,p),p.db.version%10!=0||p.objectStoreNames.contains("$meta")||p.db.createObjectStore("$meta").add(Math.ceil(p.db.version/10-1),"version");var _=pc(0,u.idbdb,p);mc(u,u._dbSchema,p);for(var C=0,S=lf(_,u._dbSchema).change;C<S.length;C++){var T=function(M){if(M.change.length||M.recreate)return console.warn("Unable to patch indexes of table ".concat(M.name," because it has changes on the type of index or primary key.")),{value:void 0};var A=p.objectStore(M.name);M.add.forEach(function(R){zs&&console.debug("Dexie upgrade patch: Creating missing index ".concat(M.name,".").concat(R.src)),fc(A,R)})}(S[C]);if(typeof T=="object")return T.value}}function lf(u,p){var _,C={del:[],add:[],change:[]};for(_ in u)p[_]||C.del.push(_);for(_ in p){var S=u[_],T=p[_];if(S){var M={name:_,def:T,recreate:!1,del:[],add:[],change:[]};if(""+(S.primKey.keyPath||"")!=""+(T.primKey.keyPath||"")||S.primKey.auto!==T.primKey.auto)M.recreate=!0,C.change.push(M);else{var A=S.idxByName,R=T.idxByName,z=void 0;for(z in A)R[z]||M.del.push(z);for(z in R){var H=A[z],L=R[z];H?H.src!==L.src&&M.change.push(L):M.add.push(L)}(0<M.del.length||0<M.add.length||0<M.change.length)&&C.change.push(M)}}else C.add.push([_,T])}return C}function cf(u,p,_,C){var S=u.db.createObjectStore(p,_.keyPath?{keyPath:_.keyPath,autoIncrement:_.auto}:{autoIncrement:_.auto});return C.forEach(function(T){return fc(S,T)}),S}function N_(u,p){o(u).forEach(function(_){p.db.objectStoreNames.contains(_)||(zs&&console.debug("Dexie: Creating missing table",_),cf(p,_,u[_].primKey,u[_].indexes))})}function fc(u,p){u.createIndex(p.name,p.keyPath,{unique:p.unique,multiEntry:p.multi})}function pc(u,p,_){var C={};return D(p.objectStoreNames,0).forEach(function(S){for(var T=_.objectStore(S),M=nf(I_(z=T.keyPath),z||"",!0,!1,!!T.autoIncrement,z&&typeof z!="string",!0),A=[],R=0;R<T.indexNames.length;++R){var H=T.index(T.indexNames[R]),z=H.keyPath,H=nf(H.name,z,!!H.unique,!!H.multiEntry,!1,z&&typeof z!="string",!1);A.push(H)}C[S]=rf(S,M,A)}),C}function mc(u,p,_){for(var C=_.db.objectStoreNames,S=0;S<C.length;++S){var T=C[S],M=_.objectStore(T);u._hasGetAll="getAll"in M;for(var A=0;A<M.indexNames.length;++A){var R=M.indexNames[A],z=M.index(R).keyPath,H=typeof z=="string"?z:"["+D(z).join("+")+"]";!p[T]||(z=p[T].idxByName[H])&&(z.name=R,delete p[T].idxByName[H],p[T].idxByName[R]=z)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(u._hasGetAll=!1)}function E_(u){return u.split(",").map(function(p,_){var T=p.split(":"),C=(S=T[1])===null||S===void 0?void 0:S.trim(),S=(p=T[0].trim()).replace(/([&*]|\+\+)/g,""),T=/^\[/.test(S)?S.match(/^\[(.*)\]$/)[1].split("+"):S;return nf(S,T||null,/\&/.test(p),/\*/.test(p),/\+\+/.test(p),a(T),_===0,C)})}var cT=(lr.prototype._createTableSchema=rf,lr.prototype._parseIndexSyntax=E_,lr.prototype._parseStoresSpec=function(u,p){var _=this;o(u).forEach(function(C){if(u[C]!==null){var S=_._parseIndexSyntax(u[C]),T=S.shift();if(!T)throw new G.Schema("Invalid schema for table "+C+": "+u[C]);if(T.unique=!0,T.multi)throw new G.Schema("Primary key cannot be multiEntry*");S.forEach(function(M){if(M.auto)throw new G.Schema("Only primary key can be marked as autoIncrement (++)");if(!M.keyPath)throw new G.Schema("Index must have a name and cannot be an empty string")}),S=_._createTableSchema(C,T,S),p[C]=S}})},lr.prototype.stores=function(_){var p=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,_):_;var _=p._versions,C={},S={};return _.forEach(function(T){l(C,T._cfg.storesSource),S=T._cfg.dbschema={},T._parseStoresSpec(C,S)}),p._dbSchema=S,af(p,[p._allTables,p,p.Transaction.prototype]),uc(p,[p._allTables,p,p.Transaction.prototype,this._cfg.tables],o(S),S),p._storeNames=o(S),this},lr.prototype.upgrade=function(u){return this._cfg.contentUpgrade=Uu(this._cfg.contentUpgrade||Re,u),this},lr);function lr(){}function hf(u,p){var _=u._dbNamesDB;return _||(_=u._dbNamesDB=new rn(rc,{addons:[],indexedDB:u,IDBKeyRange:p})).version(1).stores({dbnames:"name"}),_.table("dbnames")}function df(u){return u&&typeof u.databases=="function"}function uf(u){return Mn(function(){return ke.letThrough=!0,u()})}function ff(u){return!("from"in u)}var Et=function(u,p){if(!this){var _=new Et;return u&&"d"in u&&l(_,u),_}l(this,arguments.length?{d:1,from:u,to:1<arguments.length?p:u}:{d:0})};function Mo(u,p,_){var C=Ge(p,_);if(!isNaN(C)){if(0<C)throw RangeError();if(ff(u))return l(u,{from:p,to:_,d:1});var S=u.l,C=u.r;if(Ge(_,u.from)<0)return S?Mo(S,p,_):u.l={from:p,to:_,d:1,l:null,r:null},P_(u);if(0<Ge(p,u.to))return C?Mo(C,p,_):u.r={from:p,to:_,d:1,l:null,r:null},P_(u);Ge(p,u.from)<0&&(u.from=p,u.l=null,u.d=C?C.d+1:1),0<Ge(_,u.to)&&(u.to=_,u.r=null,u.d=u.l?u.l.d+1:1),_=!u.r,S&&!u.l&&No(u,S),C&&_&&No(u,C)}}function No(u,p){ff(p)||function _(C,R){var T=R.from,M=R.to,A=R.l,R=R.r;Mo(C,T,M),A&&_(C,A),R&&_(C,R)}(u,p)}function A_(u,p){var _=gc(p),C=_.next();if(C.done)return!1;for(var S=C.value,T=gc(u),M=T.next(S.from),A=M.value;!C.done&&!M.done;){if(Ge(A.from,S.to)<=0&&0<=Ge(A.to,S.from))return!0;Ge(S.from,A.from)<0?S=(C=_.next(A.from)).value:A=(M=T.next(S.from)).value}return!1}function gc(u){var p=ff(u)?null:{s:0,n:u};return{next:function(_){for(var C=0<arguments.length;p;)switch(p.s){case 0:if(p.s=1,C)for(;p.n.l&&Ge(_,p.n.from)<0;)p={up:p,n:p.n.l,s:1};else for(;p.n.l;)p={up:p,n:p.n.l,s:1};case 1:if(p.s=2,!C||Ge(_,p.n.to)<=0)return{value:p.n,done:!1};case 2:if(p.n.r){p.s=3,p={up:p,n:p.n.r,s:0};continue}case 3:p=p.up}return{done:!0}}}}function P_(u){var p,_,C=(((p=u.r)===null||p===void 0?void 0:p.d)||0)-(((_=u.l)===null||_===void 0?void 0:_.d)||0),S=1<C?"r":C<-1?"l":"";S&&(p=S=="r"?"l":"r",_=s({},u),C=u[S],u.from=C.from,u.to=C.to,u[S]=C[S],_[S]=C[p],(u[p]=_).d=L_(_)),u.d=L_(u)}function L_(_){var p=_.r,_=_.l;return(p?_?Math.max(p.d,_.d):p.d:_?_.d:0)+1}function yc(u,p){return o(p).forEach(function(_){u[_]?No(u[_],p[_]):u[_]=function C(S){var T,M,A={};for(T in S)d(S,T)&&(M=S[T],A[T]=!M||typeof M!="object"||ee.has(M.constructor)?M:C(M));return A}(p[_])}),u}function pf(u,p){return u.all||p.all||Object.keys(u).some(function(_){return p[_]&&A_(p[_],u[_])})}f(Et.prototype,((os={add:function(u){return No(this,u),this},addKey:function(u){return Mo(this,u,u),this},addKeys:function(u){var p=this;return u.forEach(function(_){return Mo(p,_,_)}),this},hasKey:function(u){var p=gc(this).next(u).value;return p&&Ge(p.from,u)<=0&&0<=Ge(p.to,u)}})[He]=function(){return gc(this)},os));var pi={},mf={},gf=!1;function vc(u){yc(mf,u),gf||(gf=!0,setTimeout(function(){gf=!1,yf(mf,!(mf={}))},0))}function yf(u,p){p===void 0&&(p=!1);var _=new Set;if(u.all)for(var C=0,S=Object.values(pi);C<S.length;C++)R_(M=S[C],u,_,p);else for(var T in u){var M,A=/^idb\:\/\/(.*)\/(.*)\//.exec(T);A&&(T=A[1],A=A[2],(M=pi["idb://".concat(T,"/").concat(A)])&&R_(M,u,_,p))}_.forEach(function(R){return R()})}function R_(u,p,_,C){for(var S=[],T=0,M=Object.entries(u.queries.query);T<M.length;T++){for(var A=M[T],R=A[0],z=[],H=0,L=A[1];H<L.length;H++){var V=L[H];pf(p,V.obsSet)?V.subscribers.forEach(function(U){return _.add(U)}):C&&z.push(V)}C&&S.push([R,z])}if(C)for(var F=0,j=S;F<j.length;F++){var B=j[F],R=B[0],z=B[1];u.queries.query[R]=z}}function hT(u){var p=u._state,_=u._deps.indexedDB;if(p.isBeingOpened||u.idbdb)return p.dbReadyPromise.then(function(){return p.dbOpenError?ct(p.dbOpenError):u});p.isBeingOpened=!0,p.dbOpenError=null,p.openComplete=!1;var C=p.openCanceller,S=Math.round(10*u.verno),T=!1;function M(){if(p.openCanceller!==C)throw new G.DatabaseClosed("db.open() was cancelled")}function A(){return new me(function(V,F){if(M(),!_)throw new G.MissingAPI;var j=u.name,B=p.autoSchema||!S?_.open(j):_.open(j,S);if(!B)throw new G.MissingAPI;B.onerror=Fs(F),B.onblocked=lt(u._fireOnBlocked),B.onupgradeneeded=lt(function(U){var q;H=B.transaction,p.autoSchema&&!u._options.allowEmptyDB?(B.onerror=To,H.abort(),B.result.close(),(q=_.deleteDatabase(j)).onsuccess=q.onerror=lt(function(){F(new G.NoSuchDatabase("Database ".concat(j," doesnt exist")))})):(H.onerror=Fs(F),U=U.oldVersion>Math.pow(2,62)?0:U.oldVersion,L=U<1,u.idbdb=B.result,T&&lT(u,H),aT(u,U/10,H,F))},F),B.onsuccess=lt(function(){H=null;var U,q,Z,Q,se,re=u.idbdb=B.result,he=D(re.objectStoreNames);if(0<he.length)try{var ie=re.transaction((Q=he).length===1?Q[0]:Q,"readonly");if(p.autoSchema)q=re,Z=ie,(U=u).verno=q.version/10,Z=U._dbSchema=pc(0,q,Z),U._storeNames=D(q.objectStoreNames,0),uc(U,[U._allTables],o(Z),Z);else if(mc(u,u._dbSchema,ie),((se=lf(pc(0,(se=u).idbdb,ie),se._dbSchema)).add.length||se.change.some(function(oe){return oe.add.length||oe.change.length}))&&!T)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),re.close(),S=re.version+1,T=!0,V(A());dc(u,ie)}catch{}rr.push(u),re.onversionchange=lt(function(oe){p.vcFired=!0,u.on("versionchange").fire(oe)}),re.onclose=lt(function(){u.close({disableAutoOpen:!1})}),L&&(se=u._deps,ie=j,re=se.indexedDB,se=se.IDBKeyRange,df(re)||ie===rc||hf(re,se).put({name:ie}).catch(Re)),V()},F)}).catch(function(V){switch(V==null?void 0:V.name){case"UnknownError":if(0<p.PR1398_maxLoop)return p.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),A();break;case"VersionError":if(0<S)return S=0,A()}return me.reject(V)})}var R,z=p.dbReadyResolve,H=null,L=!1;return me.race([C,(typeof navigator>"u"?me.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(V){function F(){return indexedDB.databases().finally(V)}R=setInterval(F,100),F()}).finally(function(){return clearInterval(R)}):Promise.resolve()).then(A)]).then(function(){return M(),p.onReadyBeingFired=[],me.resolve(uf(function(){return u.on.ready.fire(u.vip)})).then(function V(){if(0<p.onReadyBeingFired.length){var F=p.onReadyBeingFired.reduce(Uu,Re);return p.onReadyBeingFired=[],me.resolve(uf(function(){return F(u.vip)})).then(V)}})}).finally(function(){p.openCanceller===C&&(p.onReadyBeingFired=null,p.isBeingOpened=!1)}).catch(function(V){p.dbOpenError=V;try{H&&H.abort()}catch{}return C===p.openCanceller&&u._close(),ct(V)}).finally(function(){p.openComplete=!0,z()}).then(function(){var V;return L&&(V={},u.tables.forEach(function(F){F.schema.indexes.forEach(function(j){j.name&&(V["idb://".concat(u.name,"/").concat(F.name,"/").concat(j.name)]=new Et(-1/0,[[[]]]))}),V["idb://".concat(u.name,"/").concat(F.name,"/")]=V["idb://".concat(u.name,"/").concat(F.name,"/:dels")]=new Et(-1/0,[[[]]])}),Pn($o).fire(V),yf(V,!0)),u})}function vf(u){function p(T){return u.next(T)}var _=S(p),C=S(function(T){return u.throw(T)});function S(T){return function(R){var A=T(R),R=A.value;return A.done?R:R&&typeof R.then=="function"?R.then(_,C):a(R)?Promise.all(R).then(_,C):_(R)}}return S(p)()}function _c(u,p,_){for(var C=a(u)?u.slice():[u],S=0;S<_;++S)C.push(p);return C}var dT={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(u){return s(s({},u),{table:function(p){var _=u.table(p),C=_.schema,S={},T=[];function M(L,V,F){var j=Io(L),B=S[j]=S[j]||[],U=L==null?0:typeof L=="string"?1:L.length,q=0<V,q=s(s({},F),{name:q?"".concat(j,"(virtual-from:").concat(F.name,")"):F.name,lowLevelIndex:F,isVirtual:q,keyTail:V,keyLength:U,extractKey:of(L),unique:!q&&F.unique});return B.push(q),q.isPrimaryKey||T.push(q),1<U&&M(U===2?L[0]:L.slice(0,U-1),V+1,F),B.sort(function(Z,Q){return Z.keyTail-Q.keyTail}),q}p=M(C.primaryKey.keyPath,0,C.primaryKey),S[":id"]=[p];for(var A=0,R=C.indexes;A<R.length;A++){var z=R[A];M(z.keyPath,0,z)}function H(L){var V,F=L.query.index;return F.isVirtual?s(s({},L),{query:{index:F.lowLevelIndex,range:(V=L.query.range,F=F.keyTail,{type:V.type===1?2:V.type,lower:_c(V.lower,V.lowerOpen?u.MAX_KEY:u.MIN_KEY,F),lowerOpen:!0,upper:_c(V.upper,V.upperOpen?u.MIN_KEY:u.MAX_KEY,F),upperOpen:!0})}}):L}return s(s({},_),{schema:s(s({},C),{primaryKey:p,indexes:T,getIndexByKeyPath:function(L){return(L=S[Io(L)])&&L[0]}}),count:function(L){return _.count(H(L))},query:function(L){return _.query(H(L))},openCursor:function(L){var V=L.query.index,F=V.keyTail,j=V.isVirtual,B=V.keyLength;return j?_.openCursor(H(L)).then(function(q){return q&&U(q)}):_.openCursor(L);function U(q){return Object.create(q,{continue:{value:function(Z){Z!=null?q.continue(_c(Z,L.reverse?u.MAX_KEY:u.MIN_KEY,F)):L.unique?q.continue(q.key.slice(0,B).concat(L.reverse?u.MIN_KEY:u.MAX_KEY,F)):q.continue()}},continuePrimaryKey:{value:function(Z,Q){q.continuePrimaryKey(_c(Z,u.MAX_KEY,F),Q)}},primaryKey:{get:function(){return q.primaryKey}},key:{get:function(){var Z=q.key;return B===1?Z[0]:Z.slice(0,B)}},value:{get:function(){return q.value}}})}}})}})}};function _f(u,p,_,C){return _=_||{},C=C||"",o(u).forEach(function(S){var T,M,A;d(p,S)?(T=u[S],M=p[S],typeof T=="object"&&typeof M=="object"&&T&&M?(A=ze(T))!==ze(M)?_[C+S]=p[S]:A==="Object"?_f(T,M,_,C+S+"."):T!==M&&(_[C+S]=p[S]):T!==M&&(_[C+S]=p[S])):_[C+S]=void 0}),o(p).forEach(function(S){d(u,S)||(_[C+S]=p[S])}),_}function bf(u,p){return p.type==="delete"?p.keys:p.keys||p.values.map(u.extractKey)}var uT={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(u){return s(s({},u),{table:function(p){var _=u.table(p),C=_.schema.primaryKey;return s(s({},_),{mutate:function(S){var T=ke.trans,M=T.table(p).hook,A=M.deleting,R=M.creating,z=M.updating;switch(S.type){case"add":if(R.fire===Re)break;return T._promise("readwrite",function(){return H(S)},!0);case"put":if(R.fire===Re&&z.fire===Re)break;return T._promise("readwrite",function(){return H(S)},!0);case"delete":if(A.fire===Re)break;return T._promise("readwrite",function(){return H(S)},!0);case"deleteRange":if(A.fire===Re)break;return T._promise("readwrite",function(){return function L(V,F,j){return _.query({trans:V,values:!1,query:{index:C,range:F},limit:j}).then(function(B){var U=B.result;return H({type:"delete",keys:U,trans:V}).then(function(q){return 0<q.numFailures?Promise.reject(q.failures[0]):U.length<j?{failures:[],numFailures:0,lastResult:void 0}:L(V,s(s({},F),{lower:U[U.length-1],lowerOpen:!0}),j)})})}(S.trans,S.range,1e4)},!0)}return _.mutate(S);function H(L){var V,F,j,B=ke.trans,U=L.keys||bf(C,L);if(!U)throw new Error("Keys missing");return(L=L.type==="add"||L.type==="put"?s(s({},L),{keys:U}):s({},L)).type!=="delete"&&(L.values=n([],L.values,!0)),L.keys&&(L.keys=n([],L.keys,!0)),V=_,j=U,((F=L).type==="add"?Promise.resolve([]):V.getMany({trans:F.trans,keys:j,cache:"immutable"})).then(function(q){var Z=U.map(function(Q,se){var re,he,ie,oe=q[se],ue={onerror:null,onsuccess:null};return L.type==="delete"?A.fire.call(ue,Q,oe,B):L.type==="add"||oe===void 0?(re=R.fire.call(ue,Q,L.values[se],B),Q==null&&re!=null&&(L.keys[se]=Q=re,C.outbound||W(L.values[se],C.keyPath,Q))):(re=_f(oe,L.values[se]),(he=z.fire.call(ue,re,Q,oe,B))&&(ie=L.values[se],Object.keys(he).forEach(function(le){d(ie,le)?ie[le]=he[le]:W(ie,le,he[le])}))),ue});return _.mutate(L).then(function(Q){for(var se=Q.failures,re=Q.results,he=Q.numFailures,Q=Q.lastResult,ie=0;ie<U.length;++ie){var oe=(re||U)[ie],ue=Z[ie];oe==null?ue.onerror&&ue.onerror(se[ie]):ue.onsuccess&&ue.onsuccess(L.type==="put"&&q[ie]?L.values[ie]:oe)}return{failures:se,results:re,numFailures:he,lastResult:Q}}).catch(function(Q){return Z.forEach(function(se){return se.onerror&&se.onerror(Q)}),Promise.reject(Q)})})}}})}})}};function z_(u,p,_){try{if(!p||p.keys.length<u.length)return null;for(var C=[],S=0,T=0;S<p.keys.length&&T<u.length;++S)Ge(p.keys[S],u[T])===0&&(C.push(_?Ce(p.values[S]):p.values[S]),++T);return C.length===u.length?C:null}catch{return null}}var fT={stack:"dbcore",level:-1,create:function(u){return{table:function(p){var _=u.table(p);return s(s({},_),{getMany:function(C){if(!C.cache)return _.getMany(C);var S=z_(C.keys,C.trans._cache,C.cache==="clone");return S?me.resolve(S):_.getMany(C).then(function(T){return C.trans._cache={keys:C.keys,values:C.cache==="clone"?Ce(T):T},T})},mutate:function(C){return C.type!=="add"&&(C.trans._cache=null),_.mutate(C)}})}}}};function F_(u,p){return u.trans.mode==="readonly"&&!!u.subscr&&!u.trans.explicit&&u.trans.db._options.cache!=="disabled"&&!p.schema.primaryKey.outbound}function O_(u,p){switch(u){case"query":return p.values&&!p.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var pT={stack:"dbcore",level:0,name:"Observability",create:function(u){var p=u.schema.name,_=new Et(u.MIN_KEY,u.MAX_KEY);return s(s({},u),{transaction:function(C,S,T){if(ke.subscr&&S!=="readonly")throw new G.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ke.querier));return u.transaction(C,S,T)},table:function(C){var S=u.table(C),T=S.schema,M=T.primaryKey,L=T.indexes,A=M.extractKey,R=M.outbound,z=M.autoIncrement&&L.filter(function(F){return F.compound&&F.keyPath.includes(M.keyPath)}),H=s(s({},S),{mutate:function(F){function j(le){return le="idb://".concat(p,"/").concat(C,"/").concat(le),Q[le]||(Q[le]=new Et)}var B,U,q,Z=F.trans,Q=F.mutatedParts||(F.mutatedParts={}),se=j(""),re=j(":dels"),he=F.type,ue=F.type==="deleteRange"?[F.range]:F.type==="delete"?[F.keys]:F.values.length<50?[bf(M,F).filter(function(le){return le}),F.values]:[],ie=ue[0],oe=ue[1],ue=F.trans._cache;return a(ie)?(se.addKeys(ie),(ue=he==="delete"||ie.length===oe.length?z_(ie,ue):null)||re.addKeys(ie),(ue||oe)&&(B=j,U=ue,q=oe,T.indexes.forEach(function(le){var _e=B(le.name||"");function Oe(qe){return qe!=null?le.extractKey(qe):null}function Ue(qe){return le.multiEntry&&a(qe)?qe.forEach(function(es){return _e.addKey(es)}):_e.addKey(qe)}(U||q).forEach(function(qe,At){var Fe=U&&Oe(U[At]),At=q&&Oe(q[At]);Ge(Fe,At)!==0&&(Fe!=null&&Ue(Fe),At!=null&&Ue(At))})}))):ie?(oe={from:(oe=ie.lower)!==null&&oe!==void 0?oe:u.MIN_KEY,to:(oe=ie.upper)!==null&&oe!==void 0?oe:u.MAX_KEY},re.add(oe),se.add(oe)):(se.add(_),re.add(_),T.indexes.forEach(function(le){return j(le.name).add(_)})),S.mutate(F).then(function(le){return!ie||F.type!=="add"&&F.type!=="put"||(se.addKeys(le.results),z&&z.forEach(function(_e){for(var Oe=F.values.map(function(Fe){return _e.extractKey(Fe)}),Ue=_e.keyPath.findIndex(function(Fe){return Fe===M.keyPath}),qe=0,es=le.results.length;qe<es;++qe)Oe[qe][Ue]=le.results[qe];j(_e.name).addKeys(Oe)})),Z.mutatedParts=yc(Z.mutatedParts||{},Q),le})}}),L=function(j){var B=j.query,j=B.index,B=B.range;return[j,new Et((j=B.lower)!==null&&j!==void 0?j:u.MIN_KEY,(B=B.upper)!==null&&B!==void 0?B:u.MAX_KEY)]},V={get:function(F){return[M,new Et(F.key)]},getMany:function(F){return[M,new Et().addKeys(F.keys)]},count:L,query:L,openCursor:L};return o(V).forEach(function(F){H[F]=function(j){var B=ke.subscr,U=!!B,q=F_(ke,S)&&O_(F,j)?j.obsSet={}:B;if(U){var Z=function(oe){return oe="idb://".concat(p,"/").concat(C,"/").concat(oe),q[oe]||(q[oe]=new Et)},Q=Z(""),se=Z(":dels"),B=V[F](j),U=B[0],B=B[1];if((F==="query"&&U.isPrimaryKey&&!j.values?se:Z(U.name||"")).add(B),!U.isPrimaryKey){if(F!=="count"){var re=F==="query"&&R&&j.values&&S.query(s(s({},j),{values:!1}));return S[F].apply(this,arguments).then(function(oe){if(F==="query"){if(R&&j.values)return re.then(function(Oe){return Oe=Oe.result,Q.addKeys(Oe),oe});var ue=j.values?oe.result.map(A):oe.result;(j.values?Q:se).addKeys(ue)}else if(F==="openCursor"){var le=oe,_e=j.values;return le&&Object.create(le,{key:{get:function(){return se.addKey(le.primaryKey),le.key}},primaryKey:{get:function(){var Oe=le.primaryKey;return se.addKey(Oe),Oe}},value:{get:function(){return _e&&Q.addKey(le.primaryKey),le.value}}})}return oe})}se.add(_)}}return S[F].apply(this,arguments)}}),H}})}};function j_(u,p,_){if(_.numFailures===0)return p;if(p.type==="deleteRange")return null;var C=p.keys?p.keys.length:"values"in p&&p.values?p.values.length:1;return _.numFailures===C?null:(p=s({},p),a(p.keys)&&(p.keys=p.keys.filter(function(S,T){return!(T in _.failures)})),"values"in p&&a(p.values)&&(p.values=p.values.filter(function(S,T){return!(T in _.failures)})),p)}function wf(u,p){return _=u,((C=p).lower===void 0||(C.lowerOpen?0<Ge(_,C.lower):0<=Ge(_,C.lower)))&&(u=u,(p=p).upper===void 0||(p.upperOpen?Ge(u,p.upper)<0:Ge(u,p.upper)<=0));var _,C}function B_(u,p,V,C,S,T){if(!V||V.length===0)return u;var M=p.query.index,A=M.multiEntry,R=p.query.range,z=C.schema.primaryKey.extractKey,H=M.extractKey,L=(M.lowLevelIndex||M).extractKey,V=V.reduce(function(F,j){var B=F,U=[];if(j.type==="add"||j.type==="put")for(var q=new Et,Z=j.values.length-1;0<=Z;--Z){var Q,se=j.values[Z],re=z(se);q.hasKey(re)||(Q=H(se),(A&&a(Q)?Q.some(function(le){return wf(le,R)}):wf(Q,R))&&(q.addKey(re),U.push(se)))}switch(j.type){case"add":var he=new Et().addKeys(p.values?F.map(function(_e){return z(_e)}):F),B=F.concat(p.values?U.filter(function(_e){return _e=z(_e),!he.hasKey(_e)&&(he.addKey(_e),!0)}):U.map(function(_e){return z(_e)}).filter(function(_e){return!he.hasKey(_e)&&(he.addKey(_e),!0)}));break;case"put":var ie=new Et().addKeys(j.values.map(function(_e){return z(_e)}));B=F.filter(function(_e){return!ie.hasKey(p.values?z(_e):_e)}).concat(p.values?U:U.map(function(_e){return z(_e)}));break;case"delete":var oe=new Et().addKeys(j.keys);B=F.filter(function(_e){return!oe.hasKey(p.values?z(_e):_e)});break;case"deleteRange":var ue=j.range;B=F.filter(function(_e){return!wf(z(_e),ue)})}return B},u);return V===u?u:(V.sort(function(F,j){return Ge(L(F),L(j))||Ge(z(F),z(j))}),p.limit&&p.limit<1/0&&(V.length>p.limit?V.length=p.limit:u.length===p.limit&&V.length<p.limit&&(S.dirty=!0)),T?Object.freeze(V):V)}function H_(u,p){return Ge(u.lower,p.lower)===0&&Ge(u.upper,p.upper)===0&&!!u.lowerOpen==!!p.lowerOpen&&!!u.upperOpen==!!p.upperOpen}function mT(u,p){return function(_,C,S,T){if(_===void 0)return C!==void 0?-1:0;if(C===void 0)return 1;if((C=Ge(_,C))===0){if(S&&T)return 0;if(S)return 1;if(T)return-1}return C}(u.lower,p.lower,u.lowerOpen,p.lowerOpen)<=0&&0<=function(_,C,S,T){if(_===void 0)return C!==void 0?1:0;if(C===void 0)return-1;if((C=Ge(_,C))===0){if(S&&T)return 0;if(S)return-1;if(T)return 1}return C}(u.upper,p.upper,u.upperOpen,p.upperOpen)}function gT(u,p,_,C){u.subscribers.add(_),C.addEventListener("abort",function(){var S,T;u.subscribers.delete(_),u.subscribers.size===0&&(S=u,T=p,setTimeout(function(){S.subscribers.size===0&&X(T,S)},3e3))})}var yT={stack:"dbcore",level:0,name:"Cache",create:function(u){var p=u.schema.name;return s(s({},u),{transaction:function(_,C,S){var T,M,A=u.transaction(_,C,S);return C==="readwrite"&&(M=(T=new AbortController).signal,S=function(R){return function(){if(T.abort(),C==="readwrite"){for(var z=new Set,H=0,L=_;H<L.length;H++){var V=L[H],F=pi["idb://".concat(p,"/").concat(V)];if(F){var j=u.table(V),B=F.optimisticOps.filter(function(_e){return _e.trans===A});if(A._explicit&&R&&A.mutatedParts)for(var U=0,q=Object.values(F.queries.query);U<q.length;U++)for(var Z=0,Q=(he=q[U]).slice();Z<Q.length;Z++)pf((ie=Q[Z]).obsSet,A.mutatedParts)&&(X(he,ie),ie.subscribers.forEach(function(_e){return z.add(_e)}));else if(0<B.length){F.optimisticOps=F.optimisticOps.filter(function(_e){return _e.trans!==A});for(var se=0,re=Object.values(F.queries.query);se<re.length;se++)for(var he,ie,oe,ue=0,le=(he=re[se]).slice();ue<le.length;ue++)(ie=le[ue]).res!=null&&A.mutatedParts&&(R&&!ie.dirty?(oe=Object.isFrozen(ie.res),oe=B_(ie.res,ie.req,B,j,ie,oe),ie.dirty?(X(he,ie),ie.subscribers.forEach(function(_e){return z.add(_e)})):oe!==ie.res&&(ie.res=oe,ie.promise=me.resolve({result:oe}))):(ie.dirty&&X(he,ie),ie.subscribers.forEach(function(_e){return z.add(_e)})))}}}z.forEach(function(_e){return _e()})}}},A.addEventListener("abort",S(!1),{signal:M}),A.addEventListener("error",S(!1),{signal:M}),A.addEventListener("complete",S(!0),{signal:M})),A},table:function(_){var C=u.table(_),S=C.schema.primaryKey;return s(s({},C),{mutate:function(T){var M=ke.trans;if(S.outbound||M.db._options.cache==="disabled"||M.explicit||M.idbtrans.mode!=="readwrite")return C.mutate(T);var A=pi["idb://".concat(p,"/").concat(_)];return A?(M=C.mutate(T),T.type!=="add"&&T.type!=="put"||!(50<=T.values.length||bf(S,T).some(function(R){return R==null}))?(A.optimisticOps.push(T),T.mutatedParts&&vc(T.mutatedParts),M.then(function(R){0<R.numFailures&&(X(A.optimisticOps,T),(R=j_(0,T,R))&&A.optimisticOps.push(R),T.mutatedParts&&vc(T.mutatedParts))}),M.catch(function(){X(A.optimisticOps,T),T.mutatedParts&&vc(T.mutatedParts)})):M.then(function(R){var z=j_(0,s(s({},T),{values:T.values.map(function(H,L){var V;return R.failures[L]?H:(H=(V=S.keyPath)!==null&&V!==void 0&&V.includes(".")?Ce(H):s({},H),W(H,S.keyPath,R.results[L]),H)})}),R);A.optimisticOps.push(z),queueMicrotask(function(){return T.mutatedParts&&vc(T.mutatedParts)})}),M):C.mutate(T)},query:function(T){if(!F_(ke,C)||!O_("query",T))return C.query(T);var M=((z=ke.trans)===null||z===void 0?void 0:z.db._options.cache)==="immutable",L=ke,A=L.requery,R=L.signal,z=function(j,B,U,q){var Z=pi["idb://".concat(j,"/").concat(B)];if(!Z)return[];if(!(B=Z.queries[U]))return[null,!1,Z,null];var Q=B[(q.query?q.query.index.name:null)||""];if(!Q)return[null,!1,Z,null];switch(U){case"query":var se=Q.find(function(re){return re.req.limit===q.limit&&re.req.values===q.values&&H_(re.req.query.range,q.query.range)});return se?[se,!0,Z,Q]:[Q.find(function(re){return("limit"in re.req?re.req.limit:1/0)>=q.limit&&(!q.values||re.req.values)&&mT(re.req.query.range,q.query.range)}),!1,Z,Q];case"count":return se=Q.find(function(re){return H_(re.req.query.range,q.query.range)}),[se,!!se,Z,Q]}}(p,_,"query",T),H=z[0],L=z[1],V=z[2],F=z[3];return H&&L?H.obsSet=T.obsSet:(L=C.query(T).then(function(j){var B=j.result;if(H&&(H.res=B),M){for(var U=0,q=B.length;U<q;++U)Object.freeze(B[U]);Object.freeze(B)}else j.result=Ce(B);return j}).catch(function(j){return F&&H&&X(F,H),Promise.reject(j)}),H={obsSet:T.obsSet,promise:L,subscribers:new Set,type:"query",req:T,dirty:!1},F?F.push(H):(F=[H],(V=V||(pi["idb://".concat(p,"/").concat(_)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[T.query.index.name||""]=F)),gT(H,F,A,R),H.promise.then(function(j){return{result:B_(j.result,T,V==null?void 0:V.optimisticOps,C,H,M)}})}})}})}};function bc(u,p){return new Proxy(u,{get:function(_,C,S){return C==="db"?p:Reflect.get(_,C,S)}})}var rn=(ht.prototype.version=function(u){if(isNaN(u)||u<.1)throw new G.Type("Given version is not a positive number");if(u=Math.round(10*u)/10,this.idbdb||this._state.isBeingOpened)throw new G.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,u);var p=this._versions,_=p.filter(function(C){return C._cfg.version===u})[0];return _||(_=new this.Version(u),p.push(_),p.sort(oT),_.stores({}),this._state.autoSchema=!1,_)},ht.prototype._whenReady=function(u){var p=this;return this.idbdb&&(this._state.openComplete||ke.letThrough||this._vip)?u():new me(function(_,C){if(p._state.openComplete)return C(new G.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return void C(new G.DatabaseClosed);p.open().catch(Re)}p._state.dbReadyPromise.then(_,C)}).then(u)},ht.prototype.use=function(u){var p=u.stack,_=u.create,C=u.level,S=u.name;return S&&this.unuse({stack:p,name:S}),u=this._middlewares[p]||(this._middlewares[p]=[]),u.push({stack:p,create:_,level:C??10,name:S}),u.sort(function(T,M){return T.level-M.level}),this},ht.prototype.unuse=function(u){var p=u.stack,_=u.name,C=u.create;return p&&this._middlewares[p]&&(this._middlewares[p]=this._middlewares[p].filter(function(S){return C?S.create!==C:!!_&&S.name!==_})),this},ht.prototype.open=function(){var u=this;return di(In,function(){return hT(u)})},ht.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var u=this._state,p=rr.indexOf(this);if(0<=p&&rr.splice(p,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}u.isBeingOpened||(u.dbReadyPromise=new me(function(_){u.dbReadyResolve=_}),u.openCanceller=new me(function(_,C){u.cancelOpen=C}))},ht.prototype.close=function(_){var p=(_===void 0?{disableAutoOpen:!0}:_).disableAutoOpen,_=this._state;p?(_.isBeingOpened&&_.cancelOpen(new G.DatabaseClosed),this._close(),_.autoOpen=!1,_.dbOpenError=new G.DatabaseClosed):(this._close(),_.autoOpen=this._options.autoOpen||_.isBeingOpened,_.openComplete=!1,_.dbOpenError=null)},ht.prototype.delete=function(u){var p=this;u===void 0&&(u={disableAutoOpen:!0});var _=0<arguments.length&&typeof arguments[0]!="object",C=this._state;return new me(function(S,T){function M(){p.close(u);var A=p._deps.indexedDB.deleteDatabase(p.name);A.onsuccess=lt(function(){var R,z,H;R=p._deps,z=p.name,H=R.indexedDB,R=R.IDBKeyRange,df(H)||z===rc||hf(H,R).delete(z).catch(Re),S()}),A.onerror=Fs(T),A.onblocked=p._fireOnBlocked}if(_)throw new G.InvalidArgument("Invalid closeOptions argument to db.delete()");C.isBeingOpened?C.dbReadyPromise.then(M):M()})},ht.prototype.backendDB=function(){return this.idbdb},ht.prototype.isOpen=function(){return this.idbdb!==null},ht.prototype.hasBeenClosed=function(){var u=this._state.dbOpenError;return u&&u.name==="DatabaseClosed"},ht.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ht.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ht.prototype,"tables",{get:function(){var u=this;return o(this._allTables).map(function(p){return u._allTables[p]})},enumerable:!1,configurable:!0}),ht.prototype.transaction=function(){var u=(function(p,_,C){var S=arguments.length;if(S<2)throw new G.InvalidArgument("Too few arguments");for(var T=new Array(S-1);--S;)T[S-1]=arguments[S];return C=T.pop(),[p,ve(T),C]}).apply(this,arguments);return this._transaction.apply(this,u)},ht.prototype._transaction=function(u,p,_){var C=this,S=ke.trans;S&&S.db===this&&u.indexOf("!")===-1||(S=null);var T,M,A=u.indexOf("?")!==-1;u=u.replace("!","").replace("?","");try{if(M=p.map(function(z){if(z=z instanceof C.Table?z.name:z,typeof z!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return z}),u=="r"||u===Xu)T=Xu;else{if(u!="rw"&&u!=Qu)throw new G.InvalidArgument("Invalid transaction mode: "+u);T=Qu}if(S){if(S.mode===Xu&&T===Qu){if(!A)throw new G.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");S=null}S&&M.forEach(function(z){if(S&&S.storeNames.indexOf(z)===-1){if(!A)throw new G.SubTransaction("Table "+z+" not included in parent transaction.");S=null}}),A&&S&&!S.active&&(S=null)}}catch(z){return S?S._promise(null,function(H,L){L(z)}):ct(z)}var R=(function z(H,L,V,F,j){return me.resolve().then(function(){var B=ke.transless||ke,U=H._createTransaction(L,V,H._dbSchema,F);if(U.explicit=!0,B={trans:U,transless:B},F)U.idbtrans=F.idbtrans;else try{U.create(),U.idbtrans._explicit=!0,H._state.PR1398_maxLoop=3}catch(Q){return Q.name===Rs.InvalidState&&H.isOpen()&&0<--H._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),H.close({disableAutoOpen:!1}),H.open().then(function(){return z(H,L,V,null,j)})):ct(Q)}var q,Z=We(j);return Z&&ir(),B=me.follow(function(){var Q;(q=j.call(U,U))&&(Z?(Q=Nn.bind(null,null),q.then(Q,Q)):typeof q.next=="function"&&typeof q.throw=="function"&&(q=vf(q)))},B),(q&&typeof q.then=="function"?me.resolve(q).then(function(Q){return U.active?Q:ct(new G.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):B.then(function(){return q})).then(function(Q){return F&&U._resolve(),U._completion.then(function(){return Q})}).catch(function(Q){return U._reject(Q),ct(Q)})})}).bind(null,this,T,M,S,_);return S?S._promise(T,R,"lock"):ke.trans?di(ke.transless,function(){return C._whenReady(R)}):this._whenReady(R)},ht.prototype.table=function(u){if(!d(this._allTables,u))throw new G.InvalidTable("Table ".concat(u," does not exist"));return this._allTables[u]},ht);function ht(u,p){var _=this;this._middlewares={},this.verno=0;var C=ht.dependencies;this._options=p=s({addons:ht.addons,autoOpen:!0,indexedDB:C.indexedDB,IDBKeyRange:C.IDBKeyRange,cache:"cloned"},p),this._deps={indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange},C=p.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var S,T,M,A,R,z={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Re,dbReadyPromise:null,cancelOpen:Re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:p.autoOpen};z.dbReadyPromise=new me(function(L){z.dbReadyResolve=L}),z.openCanceller=new me(function(L,V){z.cancelOpen=V}),this._state=z,this.name=u,this.on=ko(this,"populate","blocked","versionchange","close",{ready:[Uu,Re]}),this.once=function(L,V){var F=function(){for(var j=[],B=0;B<arguments.length;B++)j[B]=arguments[B];_.on(L).unsubscribe(F),V.apply(_,j)};return _.on(L,F)},this.on.ready.subscribe=I(this.on.ready.subscribe,function(L){return function(V,F){ht.vip(function(){var j,B=_._state;B.openComplete?(B.dbOpenError||me.resolve().then(V),F&&L(V)):B.onReadyBeingFired?(B.onReadyBeingFired.push(V),F&&L(V)):(L(V),j=_,F||L(function U(){j.on.ready.unsubscribe(V),j.on.ready.unsubscribe(U)}))})}}),this.Collection=(S=this,So(QS.prototype,function(q,U){this.db=S;var F=y_,j=null;if(U)try{F=U()}catch(Z){j=Z}var B=q._ctx,U=B.table,q=U.hook.reading.fire;this._ctx={table:U,index:B.index,isPrimKey:!B.index||U.schema.primKey.keyPath&&B.index===U.schema.primKey.name,range:F,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:j,or:B.or,valueMapper:q!==nt?q:null}})),this.Table=(T=this,So(x_.prototype,function(L,V,F){this.db=T,this._tx=F,this.name=L,this.schema=V,this.hook=T._allTables[L]?T._allTables[L].hook:ko(null,{creating:[er,Re],reading:[Ot,nt],updating:[KS,Re],deleting:[tr,Re]})})),this.Transaction=(M=this,So(sT.prototype,function(L,V,F,j,B){var U=this;L!=="readonly"&&V.forEach(function(q){q=(q=F[q])===null||q===void 0?void 0:q.yProps,q&&(V=V.concat(q.map(function(Z){return Z.updatesTable})))}),this.db=M,this.mode=L,this.storeNames=V,this.schema=F,this.chromeTransactionDurability=j,this.idbtrans=null,this.on=ko(this,"complete","error","abort"),this.parent=B||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new me(function(q,Z){U._resolve=q,U._reject=Z}),this._completion.then(function(){U.active=!1,U.on.complete.fire()},function(q){var Z=U.active;return U.active=!1,U.on.error.fire(q),U.parent?U.parent._reject(q):Z&&U.idbtrans&&U.idbtrans.abort(),ct(q)})})),this.Version=(A=this,So(cT.prototype,function(L){this.db=A,this._cfg={version:L,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,So(D_.prototype,function(L,V,F){if(this.db=R,this._ctx={table:L,index:V===":id"?null:V,or:F},this._cmp=this._ascending=Ge,this._descending=function(j,B){return Ge(B,j)},this._max=function(j,B){return 0<Ge(j,B)?j:B},this._min=function(j,B){return Ge(j,B)<0?j:B},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new G.MissingAPI})),this.on("versionchange",function(L){0<L.newVersion?console.warn("Another connection wants to upgrade database '".concat(_.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(_.name,"'. Closing db now to resume the delete request.")),_.close({disableAutoOpen:!1})}),this.on("blocked",function(L){!L.newVersion||L.newVersion<L.oldVersion?console.warn("Dexie.delete('".concat(_.name,"') was blocked")):console.warn("Upgrade '".concat(_.name,"' blocked by other connection holding version ").concat(L.oldVersion/10))}),this._maxKey=Do(p.IDBKeyRange),this._createTransaction=function(L,V,F,j){return new _.Transaction(L,V,F,_._options.chromeTransactionDurability,j)},this._fireOnBlocked=function(L){_.on("blocked").fire(L),rr.filter(function(V){return V.name===_.name&&V!==_&&!V._state.vcFired}).map(function(V){return V.on("versionchange").fire(L)})},this.use(fT),this.use(yT),this.use(pT),this.use(dT),this.use(uT);var H=new Proxy(this,{get:function(L,V,F){if(V==="_vip")return!0;if(V==="table")return function(B){return bc(_.table(B),H)};var j=Reflect.get(L,V,F);return j instanceof x_?bc(j,H):V==="tables"?j.map(function(B){return bc(B,H)}):V==="_createTransaction"?function(){return bc(j.apply(this,arguments),H)}:j}});this.vip=H,C.forEach(function(L){return L(_)})}var wc,os=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",vT=(Cf.prototype.subscribe=function(u,p,_){return this._subscribe(u&&typeof u!="function"?u:{next:u,error:p,complete:_})},Cf.prototype[os]=function(){return this},Cf);function Cf(u){this._subscribe=u}try{wc={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{wc={indexedDB:null,IDBKeyRange:null}}function U_(u){var p,_=!1,C=new vT(function(S){var T=We(u),M,A=!1,R={},z={},H={get closed(){return A},unsubscribe:function(){A||(A=!0,M&&M.abort(),L&&Pn.storagemutated.unsubscribe(F))}};S.start&&S.start(H);var L=!1,V=function(){return Ju(j)},F=function(B){yc(R,B),pf(z,R)&&V()},j=function(){var B,U,q;!A&&wc.indexedDB&&(R={},B={},M&&M.abort(),M=new AbortController,q=function(Z){var Q=sr();try{T&&ir();var se=Mn(u,Z);return se=T?se.finally(Nn):se}finally{Q&&nr()}}(U={subscr:B,signal:M.signal,requery:V,querier:u,trans:null}),Promise.resolve(q).then(function(Z){_=!0,p=Z,A||U.signal.aborted||(R={},function(Q){for(var se in Q)if(d(Q,se))return;return 1}(z=B)||L||(Pn($o,F),L=!0),Ju(function(){return!A&&S.next&&S.next(Z)}))},function(Z){_=!1,["DatabaseClosedError","AbortError"].includes(Z==null?void 0:Z.name)||A||Ju(function(){A||S.error&&S.error(Z)})}))};return setTimeout(V,0),H});return C.hasValue=function(){return _},C.getValue=function(){return p},C}var mi=rn;function xf(u){var p=Ln;try{Ln=!0,Pn.storagemutated.fire(u),yf(u,!0)}finally{Ln=p}}f(mi,s(s({},Te),{delete:function(u){return new mi(u,{addons:[]}).delete()},exists:function(u){return new mi(u,{addons:[]}).open().then(function(p){return p.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(u){try{return p=mi.dependencies,_=p.indexedDB,p=p.IDBKeyRange,(df(_)?Promise.resolve(_.databases()).then(function(C){return C.map(function(S){return S.name}).filter(function(S){return S!==rc})}):hf(_,p).toCollection().primaryKeys()).then(u)}catch{return ct(new G.MissingAPI)}var p,_},defineClass:function(){return function(u){l(this,u)}},ignoreTransaction:function(u){return ke.trans?di(ke.transless,u):u()},vip:uf,async:function(u){return function(){try{var p=vf(u.apply(this,arguments));return p&&typeof p.then=="function"?p:me.resolve(p)}catch(_){return ct(_)}}},spawn:function(u,p,_){try{var C=vf(u.apply(_,p||[]));return C&&typeof C.then=="function"?C:me.resolve(C)}catch(S){return ct(S)}},currentTransaction:{get:function(){return ke.trans||null}},waitFor:function(u,p){return p=me.resolve(typeof u=="function"?mi.ignoreTransaction(u):u).timeout(p||6e4),ke.trans?ke.trans.waitFor(p):p},Promise:me,debug:{get:function(){return zs},set:function(u){h_(u)}},derive:b,extend:l,props:f,override:I,Events:ko,on:Pn,liveQuery:U_,extendObservabilitySet:yc,getByKeyPath:O,setByKeyPath:W,delByKeyPath:function(u,p){typeof p=="string"?W(u,p,void 0):"length"in p&&[].map.call(p,function(_){W(u,_,void 0)})},shallowClone:J,deepClone:Ce,getObjectDiff:_f,cmp:Ge,asap:P,minKey:-1/0,addons:[],connections:rr,errnames:Rs,dependencies:wc,cache:pi,semVer:"4.2.1",version:"4.2.1".split(".").map(function(u){return parseInt(u)}).reduce(function(u,p,_){return u+p/Math.pow(10,2*_)})})),mi.maxKey=Do(mi.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Pn($o,function(u){Ln||(u=new CustomEvent(sf,{detail:u}),Ln=!0,dispatchEvent(u),Ln=!1)}),addEventListener(sf,function(u){u=u.detail,Ln||xf(u)}));var cr,Ln=!1,V_=function(){};return typeof BroadcastChannel<"u"&&((V_=function(){(cr=new BroadcastChannel(sf)).onmessage=function(u){return u.data&&xf(u.data)}})(),typeof cr.unref=="function"&&cr.unref(),Pn($o,function(u){Ln||cr.postMessage(u)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(u){if(!rn.disableBfCache&&u.persisted){zs&&console.debug("Dexie: handling persisted pagehide"),cr!=null&&cr.close();for(var p=0,_=rr;p<_.length;p++)_[p].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(u){!rn.disableBfCache&&u.persisted&&(zs&&console.debug("Dexie: handling persisted pageshow"),V_(),xf({all:new Et(-1/0,[[]])}))})),me.rejectionMapper=function(u,p){return!u||u instanceof wt||u instanceof TypeError||u instanceof SyntaxError||!u.name||!de[u.name]?u:(p=new de[u.name](p||u.message,u),"stack"in u&&y(p,"stack",{get:function(){return this.inner.stack}}),p)},h_(zs),s(rn,Object.freeze({__proto__:null,Dexie:rn,liveQuery:U_,Entity:v_,cmp:Ge,PropModification:xo,replacePrefix:function(u,p){return new xo({replacePrefix:[u,p]})},add:function(u){return new xo({add:u})},remove:function(u){return new xo({remove:u})},default:rn,RangeSet:Et,mergeRanges:No,rangesOverlap:A_}),{default:rn}),rn})})(Pm);var dC=Pm.exports;const zh=hC(dC),Lm=Symbol.for("Dexie"),qn=globalThis[Lm]||(globalThis[Lm]=zh);if(zh.semVer!==qn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${zh.semVer} and ${qn.semVer}`);const{liveQuery:uC,mergeRanges:fC,rangesOverlap:pC,RangeSet:mC,cmp:gC,Entity:yC,PropModification:vC,replacePrefix:_C,add:bC,remove:wC,DexieYProvider:CC}=qn,xC=Object.freeze(Object.defineProperty({__proto__:null,Dexie:qn,DexieYProvider:CC,Entity:yC,PropModification:vC,RangeSet:mC,add:bC,cmp:gC,default:qn,liveQuery:uC,mergeRanges:fC,rangesOverlap:pC,remove:wC,replacePrefix:_C},Symbol.toStringTag,{value:"Module"}));class Js{}Js.TABLE={name:"cache",schema:"++id, type, key, data, createTime, updateTime, [type+key]",version:1},Js.DEFAULT_TYPE="cache";const Rm=Object.freeze(Object.defineProperty({__proto__:null,CacheData:Js},Symbol.toStringTag,{value:"Module"})),kC=Object.values(Rm).reduce((i,e)=>Math.max(e.TABLE.version,i),1),SC=Object.values(Rm).reduce((i,{TABLE:e})=>(i[e.name]=e.schema,i),{});class zm extends qn{constructor(e="DataHub"){super(e),this.version(kC).stores(SC),this.cache.mapToClass(Js)}async getCache(e,t=Js.DEFAULT_TYPE){return this.cache.where("[type+key]").equals([t,e]).first()}async getCacheData(e,t=Js.DEFAULT_TYPE){const s=await this.getCache(e,t);return s==null?void 0:s.data}async limitSize(e=Js.DEFAULT_TYPE,t=1e3){let s=await this.cache.where("type").equals(e).count();for(;s>=t;){const n=await this.cache.where("type").equals(e).first();if(!n)break;await this.cache.delete(n.id),s=await this.cache.where("type").equals(e).count()}}async setCacheData(e,t,s,n=Js.DEFAULT_TYPE){if(t===null)return this.deleteCacheData(e,n);const r=await this.getCache(e,n);return s=s||Date.now(),r?(await this.cache.update(r.id,{data:t,updateTime:s}),r.id):await this.cache.add({key:e,data:t,type:n,createTime:s,updateTime:s})}async deleteCacheData(e,t=Js.DEFAULT_TYPE){return typeof e=="number"?this.cache.delete(e):this.cache.where("[type+key]").equals([t,e]).delete()}async getPageData(e,t,s){const{currentModule:n,currentMethod:r}=window.config;return this.getCacheData(e,`PAGE_${t||n}_${s||r}`)}setPageData(e,t,s,n){const{currentModule:r,currentMethod:o}=window.config;return this.setCacheData(e,t,void 0,`PAGE_${s||r}_${n||o}`)}}Object.defineProperty(window.$,"db",{get(){var i;if(!this._db){try{window.parent!==window&&(this._db=window.parent.$.db)}catch{}this._db||(this._db=new zm(`zentao_${((i=window.config)==null?void 0:i.account)||""}`))}return this._db}});const TC=qn;class Fh extends be{}Fh.NAME="Avatar",Fh.Component=Gs,ot(Gw);const x$="",k$="",S$="",T$="";class Oh extends be{}Oh.NAME="BtnGroup",Oh.Component=cs,ot(Object.freeze(Object.defineProperty({__proto__:null,BtnGroup:cs},Symbol.toStringTag,{value:"Module"})));const D$="",I$="",Fm=Symbol("EVENT_PICK");class Ia extends ae{constructor(e){super(e),this._handleClick=this._handleClick.bind(this),this._hasInput=!!v(`#${e.id}`).length}get hasInput(){return this._hasInput}_handleClick(e){const{togglePop:t,clickType:s,onClick:n}=this.props;let r=s==="open"?!0:void 0;const o=v(e.target),a=n==null?void 0:n(e);if(!e.defaultPrevented){if(typeof a=="boolean")r=a;else{if(o.closest('[data-dismiss="pick"]').length){t(!1);return}if(o.closest("a,input").length)return}requestAnimationFrame(()=>t(r))}}_getClass(e){const{state:t,className:s,disabled:n,readonly:r,pickerName:o,empty:a}=e,{open:l}=t;return K("pick",s,o?`${o}-pick`:"",l&&"is-open focus",n&&"disabled",r&&"readonly",a?"is-empty-value":"")}_getProps(e){const{id:t,style:s,attrs:n}=e;return{id:`pick-${t}`,className:this._getClass(e),style:s,tabIndex:-1,onClick:this._handleClick,...n}}_renderTrigger(e){const{children:t,state:s}=e;return t??s.value}_renderValue(e){const{name:t,state:{value:s=""},disabled:n,readonly:r,id:o,onRenderValue:a}=e;if(a)return a.call(this,s,e);if(t)if(this._hasInput)v(`#${o}`).val(s);else return k("input",{id:o,type:"hidden",className:"pick-value",name:t,value:s,readonly:r,disabled:n});return null}componentDidMount(){const{id:e}=this.props;v(`#${e}`).on(`change.zui.pick.${e} syncValue.zui.pick.${e}`,(t,s)=>{if(typeof s=="symbol")return;const n=v.isPlainObject(s)&&typeof s.setValue=="string"?s.setValue:t.target.value;this._skipTriggerChange=n,this.props.changeState({value:n})})}componentWillUnmount(){const{id:e}=this.props;v(`#${e}`).off(`change.zui.pick.${e}`)}componentDidUpdate(e){const{id:t,state:s,name:n}=this.props;n&&e.state.value!==s.value&&(this._skipTriggerChange!==s.value&&v(`#${t}`).trigger("change",Fm),this._skipTriggerChange=!1)}render(e){return g(e.tagName||"div",this._getProps(e),this._renderTrigger(e),this._renderValue(e))}}const gn=Math.min,Wt=Math.max,Ma=Math.round,Na=Math.floor,Ns=i=>({x:i,y:i}),$C={left:"right",right:"left",bottom:"top",top:"bottom"},DC={start:"end",end:"start"};function jh(i,e,t){return Wt(i,gn(e,t))}function Ai(i,e){return typeof i=="function"?i(e):i}function yn(i){return i.split("-")[0]}function Pi(i){return i.split("-")[1]}function Om(i){return i==="x"?"y":"x"}function Bh(i){return i==="y"?"height":"width"}const IC=new Set(["top","bottom"]);function Xs(i){return IC.has(yn(i))?"y":"x"}function Hh(i){return Om(Xs(i))}function MC(i,e,t){t===void 0&&(t=!1);const s=Pi(i),n=Hh(i),r=Bh(n);let o=n==="x"?s===(t?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Ea(o)),[o,Ea(o)]}function NC(i){const e=Ea(i);return[Uh(i),e,Uh(e)]}function Uh(i){return i.replace(/start|end/g,e=>DC[e])}const jm=["left","right"],Bm=["right","left"],EC=["top","bottom"],AC=["bottom","top"];function PC(i,e,t){switch(i){case"top":case"bottom":return t?e?Bm:jm:e?jm:Bm;case"left":case"right":return e?EC:AC;default:return[]}}function LC(i,e,t,s){const n=Pi(i);let r=PC(yn(i),t==="start",s);return n&&(r=r.map(o=>o+"-"+n),e&&(r=r.concat(r.map(Uh)))),r}function Ea(i){return i.replace(/left|right|bottom|top/g,e=>$C[e])}function RC(i){return{top:0,right:0,bottom:0,left:0,...i}}function Hm(i){return typeof i!="number"?RC(i):{top:i,right:i,bottom:i,left:i}}function Aa(i){const{x:e,y:t,width:s,height:n}=i;return{width:s,height:n,top:t,left:e,right:e+s,bottom:t+n,x:e,y:t}}function Um(i,e,t){let{reference:s,floating:n}=i;const r=Xs(e),o=Hh(e),a=Bh(o),l=yn(e),c=r==="y",h=s.x+s.width/2-n.width/2,d=s.y+s.height/2-n.height/2,f=s[a]/2-n[a]/2;let m;switch(l){case"top":m={x:h,y:s.y-n.height};break;case"bottom":m={x:h,y:s.y+s.height};break;case"right":m={x:s.x+s.width,y:d};break;case"left":m={x:s.x-n.width,y:d};break;default:m={x:s.x,y:s.y}}switch(Pi(e)){case"start":m[o]-=f*(t&&c?-1:1);break;case"end":m[o]+=f*(t&&c?-1:1);break}return m}const zC=async(i,e,t)=>{const{placement:s="bottom",strategy:n="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:i,floating:e,strategy:n}),{x:h,y:d}=Um(c,s,l),f=s,m={},y=0;for(let b=0;b<a.length;b++){const{name:w,fn:x}=a[b],{x:D,y:I,data:E,reset:P}=await x({x:h,y:d,initialPlacement:s,placement:f,strategy:n,middlewareData:m,rects:c,platform:o,elements:{reference:i,floating:e}});h=D??h,d=I??d,m={...m,[w]:{...m[w],...E}},P&&y<=50&&(y++,typeof P=="object"&&(P.placement&&(f=P.placement),P.rects&&(c=P.rects===!0?await o.getElementRects({reference:i,floating:e,strategy:n}):P.rects),{x:h,y:d}=Um(c,f,l)),b=-1)}return{x:h,y:d,placement:f,strategy:n,middlewareData:m}};async function Vh(i,e){var t;e===void 0&&(e={});const{x:s,y:n,platform:r,rects:o,elements:a,strategy:l}=i,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:d="floating",altBoundary:f=!1,padding:m=0}=Ai(e,i),y=Hm(m),w=a[f?d==="floating"?"reference":"floating":d],x=Aa(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(w)))==null||t?w:w.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),D=d==="floating"?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,I=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),E=await(r.isElement==null?void 0:r.isElement(I))?await(r.getScale==null?void 0:r.getScale(I))||{x:1,y:1}:{x:1,y:1},P=Aa(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:D,offsetParent:I,strategy:l}):D);return{top:(x.top-P.top+y.top)/E.y,bottom:(P.bottom-x.bottom+y.bottom)/E.y,left:(x.left-P.left+y.left)/E.x,right:(P.right-x.right+y.right)/E.x}}const FC=i=>({name:"arrow",options:i,async fn(e){const{x:t,y:s,placement:n,rects:r,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:h=0}=Ai(i,e)||{};if(c==null)return{};const d=Hm(h),f={x:t,y:s},m=Hh(n),y=Bh(m),b=await o.getDimensions(c),w=m==="y",x=w?"top":"left",D=w?"bottom":"right",I=w?"clientHeight":"clientWidth",E=r.reference[y]+r.reference[m]-f[m]-r.floating[y],P=f[m]-r.reference[m],O=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let W=O?O[I]:0;(!W||!await(o.isElement==null?void 0:o.isElement(O)))&&(W=a.floating[I]||r.floating[y]);const J=E/2-P/2,Y=W/2-b[y]/2-1,ve=gn(d[x],Y),ee=gn(d[D],Y),ne=ve,Ce=W-b[y]-ee,Me=W/2-b[y]/2+J,ze=jh(ne,Me,Ce),He=!l.arrow&&Pi(n)!=null&&Me!==ze&&r.reference[y]/2-(Me<ne?ve:ee)-b[y]/2<0,te=He?Me<ne?Me-ne:Me-Ce:0;return{[m]:f[m]+te,data:{[m]:ze,centerOffset:Me-ze-te,...He&&{alignmentOffset:te}},reset:He}}}),OC=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var t,s;const{placement:n,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:h=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...w}=Ai(i,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const x=yn(n),D=Xs(a),I=yn(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(c.floating)),P=f||(I||!b?[Ea(a)]:NC(a)),O=y!=="none";!f&&O&&P.push(...LC(a,b,y,E));const W=[a,...P],J=await Vh(e,w),Y=[];let ve=((s=r.flip)==null?void 0:s.overflows)||[];if(h&&Y.push(J[x]),d){const Me=MC(n,o,E);Y.push(J[Me[0]],J[Me[1]])}if(ve=[...ve,{placement:n,overflows:Y}],!Y.every(Me=>Me<=0)){var ee,ne;const Me=(((ee=r.flip)==null?void 0:ee.index)||0)+1,ze=W[Me];if(ze&&(!(d==="alignment"?D!==Xs(ze):!1)||ve.every(X=>Xs(X.placement)===D?X.overflows[0]>0:!0)))return{data:{index:Me,overflows:ve},reset:{placement:ze}};let He=(ne=ve.filter(te=>te.overflows[0]<=0).sort((te,X)=>te.overflows[1]-X.overflows[1])[0])==null?void 0:ne.placement;if(!He)switch(m){case"bestFit":{var Ce;const te=(Ce=ve.filter(X=>{if(O){const Ee=Xs(X.placement);return Ee===D||Ee==="y"}return!0}).map(X=>[X.placement,X.overflows.filter(Ee=>Ee>0).reduce((Ee,Ae)=>Ee+Ae,0)]).sort((X,Ee)=>X[1]-Ee[1])[0])==null?void 0:Ce[0];te&&(He=te);break}case"initialPlacement":He=a;break}if(n!==He)return{reset:{placement:He}}}return{}}}},jC=new Set(["left","top"]);async function BC(i,e){const{placement:t,platform:s,elements:n}=i,r=await(s.isRTL==null?void 0:s.isRTL(n.floating)),o=yn(t),a=Pi(t),l=Xs(t)==="y",c=jC.has(o)?-1:1,h=r&&l?-1:1,d=Ai(e,i);let{mainAxis:f,crossAxis:m,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(m=a==="end"?y*-1:y),l?{x:m*h,y:f*c}:{x:f*c,y:m*h}}const HC=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var t,s;const{x:n,y:r,placement:o,middlewareData:a}=e,l=await BC(e,i);return o===((t=a.offset)==null?void 0:t.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:n+l.x,y:r+l.y,data:{...l,placement:o}}}}},UC=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:t,y:s,placement:n}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:w=>{let{x,y:D}=w;return{x,y:D}}},...l}=Ai(i,e),c={x:t,y:s},h=await Vh(e,l),d=Xs(yn(n)),f=Om(d);let m=c[f],y=c[d];if(r){const w=f==="y"?"top":"left",x=f==="y"?"bottom":"right",D=m+h[w],I=m-h[x];m=jh(D,m,I)}if(o){const w=d==="y"?"top":"left",x=d==="y"?"bottom":"right",D=y+h[w],I=y-h[x];y=jh(D,y,I)}const b=a.fn({...e,[f]:m,[d]:y});return{...b,data:{x:b.x-t,y:b.y-s,enabled:{[f]:r,[d]:o}}}}}},VC=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(e){var t,s;const{placement:n,rects:r,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Ai(i,e),h=await Vh(e,c),d=yn(n),f=Pi(n),m=Xs(n)==="y",{width:y,height:b}=r.floating;let w,x;d==="top"||d==="bottom"?(w=d,x=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(x=d,w=f==="end"?"top":"bottom");const D=b-h.top-h.bottom,I=y-h.left-h.right,E=gn(b-h[w],D),P=gn(y-h[x],I),O=!e.middlewareData.shift;let W=E,J=P;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(J=I),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(W=D),O&&!f){const ve=Wt(h.left,0),ee=Wt(h.right,0),ne=Wt(h.top,0),Ce=Wt(h.bottom,0);m?J=y-2*(ve!==0||ee!==0?ve+ee:Wt(h.left,h.right)):W=b-2*(ne!==0||Ce!==0?ne+Ce:Wt(h.top,h.bottom))}await l({...e,availableWidth:J,availableHeight:W});const Y=await o.getDimensions(a.floating);return y!==Y.width||b!==Y.height?{reset:{rects:!0}}:{}}}};function Pa(){return typeof window<"u"}function Li(i){return Vm(i)?(i.nodeName||"").toLowerCase():"#document"}function Kt(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function Es(i){var e;return(e=(Vm(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function Vm(i){return Pa()?i instanceof Node||i instanceof Kt(i).Node:!1}function ps(i){return Pa()?i instanceof Element||i instanceof Kt(i).Element:!1}function As(i){return Pa()?i instanceof HTMLElement||i instanceof Kt(i).HTMLElement:!1}function Wm(i){return!Pa()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Kt(i).ShadowRoot}const WC=new Set(["inline","contents"]);function Or(i){const{overflow:e,overflowX:t,overflowY:s,display:n}=ms(i);return/auto|scroll|overlay|hidden|clip/.test(e+s+t)&&!WC.has(n)}const KC=new Set(["table","td","th"]);function qC(i){return KC.has(Li(i))}const GC=[":popover-open",":modal"];function La(i){return GC.some(e=>{try{return i.matches(e)}catch{return!1}})}const ZC=["transform","translate","scale","rotate","perspective"],YC=["transform","translate","scale","rotate","perspective","filter"],JC=["paint","layout","strict","content"];function Wh(i){const e=Kh(),t=ps(i)?ms(i):i;return ZC.some(s=>t[s]?t[s]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||YC.some(s=>(t.willChange||"").includes(s))||JC.some(s=>(t.contain||"").includes(s))}function XC(i){let e=vn(i);for(;As(e)&&!Ri(e);){if(Wh(e))return e;if(La(e))return null;e=vn(e)}return null}function Kh(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const QC=new Set(["html","body","#document"]);function Ri(i){return QC.has(Li(i))}function ms(i){return Kt(i).getComputedStyle(i)}function Ra(i){return ps(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function vn(i){if(Li(i)==="html")return i;const e=i.assignedSlot||i.parentNode||Wm(i)&&i.host||Es(i);return Wm(e)?e.host:e}function Km(i){const e=vn(i);return Ri(e)?i.ownerDocument?i.ownerDocument.body:i.body:As(e)&&Or(e)?e:Km(e)}function jr(i,e,t){var s;e===void 0&&(e=[]),t===void 0&&(t=!0);const n=Km(i),r=n===((s=i.ownerDocument)==null?void 0:s.body),o=Kt(n);if(r){const a=qh(o);return e.concat(o,o.visualViewport||[],Or(n)?n:[],a&&t?jr(a):[])}return e.concat(n,jr(n,[],t))}function qh(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function qm(i){const e=ms(i);let t=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const n=As(i),r=n?i.offsetWidth:t,o=n?i.offsetHeight:s,a=Ma(t)!==r||Ma(s)!==o;return a&&(t=r,s=o),{width:t,height:s,$:a}}function Gh(i){return ps(i)?i:i.contextElement}function zi(i){const e=Gh(i);if(!As(e))return Ns(1);const t=e.getBoundingClientRect(),{width:s,height:n,$:r}=qm(e);let o=(r?Ma(t.width):t.width)/s,a=(r?Ma(t.height):t.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const e0=Ns(0);function Gm(i){const e=Kt(i);return!Kh()||!e.visualViewport?e0:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function t0(i,e,t){return e===void 0&&(e=!1),!t||e&&t!==Kt(i)?!1:e}function Gn(i,e,t,s){e===void 0&&(e=!1),t===void 0&&(t=!1);const n=i.getBoundingClientRect(),r=Gh(i);let o=Ns(1);e&&(s?ps(s)&&(o=zi(s)):o=zi(i));const a=t0(r,t,s)?Gm(r):Ns(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,h=n.width/o.x,d=n.height/o.y;if(r){const f=Kt(r),m=s&&ps(s)?Kt(s):s;let y=f,b=qh(y);for(;b&&s&&m!==y;){const w=zi(b),x=b.getBoundingClientRect(),D=ms(b),I=x.left+(b.clientLeft+parseFloat(D.paddingLeft))*w.x,E=x.top+(b.clientTop+parseFloat(D.paddingTop))*w.y;l*=w.x,c*=w.y,h*=w.x,d*=w.y,l+=I,c+=E,y=Kt(b),b=qh(y)}}return Aa({width:h,height:d,x:l,y:c})}function za(i,e){const t=Ra(i).scrollLeft;return e?e.left+t:Gn(Es(i)).left+t}function Zm(i,e){const t=i.getBoundingClientRect(),s=t.left+e.scrollLeft-za(i,t),n=t.top+e.scrollTop;return{x:s,y:n}}function s0(i){let{elements:e,rect:t,offsetParent:s,strategy:n}=i;const r=n==="fixed",o=Es(s),a=e?La(e.floating):!1;if(s===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=Ns(1);const h=Ns(0),d=As(s);if((d||!d&&!r)&&((Li(s)!=="body"||Or(o))&&(l=Ra(s)),As(s))){const m=Gn(s);c=zi(s),h.x=m.x+s.clientLeft,h.y=m.y+s.clientTop}const f=o&&!d&&!r?Zm(o,l):Ns(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+h.x+f.x,y:t.y*c.y-l.scrollTop*c.y+h.y+f.y}}function n0(i){return Array.from(i.getClientRects())}function i0(i){const e=Es(i),t=Ra(i),s=i.ownerDocument.body,n=Wt(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),r=Wt(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-t.scrollLeft+za(i);const a=-t.scrollTop;return ms(s).direction==="rtl"&&(o+=Wt(e.clientWidth,s.clientWidth)-n),{width:n,height:r,x:o,y:a}}const Ym=25;function r0(i,e){const t=Kt(i),s=Es(i),n=t.visualViewport;let r=s.clientWidth,o=s.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;const h=Kh();(!h||h&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}const c=za(s);if(c<=0){const h=s.ownerDocument,d=h.body,f=getComputedStyle(d),m=h.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,y=Math.abs(s.clientWidth-d.clientWidth-m);y<=Ym&&(r-=y)}else c<=Ym&&(r+=c);return{width:r,height:o,x:a,y:l}}const o0=new Set(["absolute","fixed"]);function a0(i,e){const t=Gn(i,!0,e==="fixed"),s=t.top+i.clientTop,n=t.left+i.clientLeft,r=As(i)?zi(i):Ns(1),o=i.clientWidth*r.x,a=i.clientHeight*r.y,l=n*r.x,c=s*r.y;return{width:o,height:a,x:l,y:c}}function Jm(i,e,t){let s;if(e==="viewport")s=r0(i,t);else if(e==="document")s=i0(Es(i));else if(ps(e))s=a0(e,t);else{const n=Gm(i);s={x:e.x-n.x,y:e.y-n.y,width:e.width,height:e.height}}return Aa(s)}function Xm(i,e){const t=vn(i);return t===e||!ps(t)||Ri(t)?!1:ms(t).position==="fixed"||Xm(t,e)}function l0(i,e){const t=e.get(i);if(t)return t;let s=jr(i,[],!1).filter(a=>ps(a)&&Li(a)!=="body"),n=null;const r=ms(i).position==="fixed";let o=r?vn(i):i;for(;ps(o)&&!Ri(o);){const a=ms(o),l=Wh(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&!!n&&o0.has(n.position)||Or(o)&&!l&&Xm(i,o))?s=s.filter(h=>h!==o):n=a,o=vn(o)}return e.set(i,s),s}function c0(i){let{element:e,boundary:t,rootBoundary:s,strategy:n}=i;const o=[...t==="clippingAncestors"?La(e)?[]:l0(e,this._c):[].concat(t),s],a=o[0],l=o.reduce((c,h)=>{const d=Jm(e,h,n);return c.top=Wt(d.top,c.top),c.right=gn(d.right,c.right),c.bottom=gn(d.bottom,c.bottom),c.left=Wt(d.left,c.left),c},Jm(e,a,n));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function h0(i){const{width:e,height:t}=qm(i);return{width:e,height:t}}function d0(i,e,t){const s=As(e),n=Es(e),r=t==="fixed",o=Gn(i,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=Ns(0);function c(){l.x=za(n)}if(s||!s&&!r)if((Li(e)!=="body"||Or(n))&&(a=Ra(e)),s){const m=Gn(e,!0,r,e);l.x=m.x+e.clientLeft,l.y=m.y+e.clientTop}else n&&c();r&&!s&&n&&c();const h=n&&!s&&!r?Zm(n,a):Ns(0),d=o.left+a.scrollLeft-l.x-h.x,f=o.top+a.scrollTop-l.y-h.y;return{x:d,y:f,width:o.width,height:o.height}}function Zh(i){return ms(i).position==="static"}function Qm(i,e){if(!As(i)||ms(i).position==="fixed")return null;if(e)return e(i);let t=i.offsetParent;return Es(i)===t&&(t=t.ownerDocument.body),t}function eg(i,e){const t=Kt(i);if(La(i))return t;if(!As(i)){let n=vn(i);for(;n&&!Ri(n);){if(ps(n)&&!Zh(n))return n;n=vn(n)}return t}let s=Qm(i,e);for(;s&&qC(s)&&Zh(s);)s=Qm(s,e);return s&&Ri(s)&&Zh(s)&&!Wh(s)?t:s||XC(i)||t}const u0=async function(i){const e=this.getOffsetParent||eg,t=this.getDimensions,s=await t(i.floating);return{reference:d0(i.reference,await e(i.floating),i.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function f0(i){return ms(i).direction==="rtl"}const p0={convertOffsetParentRelativeRectToViewportRelativeRect:s0,getDocumentElement:Es,getClippingRect:c0,getOffsetParent:eg,getElementRects:u0,getClientRects:n0,getDimensions:h0,getScale:zi,isElement:ps,isRTL:f0};function tg(i,e){return i.x===e.x&&i.y===e.y&&i.width===e.width&&i.height===e.height}function m0(i,e){let t=null,s;const n=Es(i);function r(){var a;clearTimeout(s),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),r();const c=i.getBoundingClientRect(),{left:h,top:d,width:f,height:m}=c;if(a||e(),!f||!m)return;const y=Na(d),b=Na(n.clientWidth-(h+f)),w=Na(n.clientHeight-(d+m)),x=Na(h),I={rootMargin:-y+"px "+-b+"px "+-w+"px "+-x+"px",threshold:Wt(0,gn(1,l))||1};let E=!0;function P(O){const W=O[0].intersectionRatio;if(W!==l){if(!E)return o();W?o(!1,W):s=setTimeout(()=>{o(!1,1e-7)},1e3)}W===1&&!tg(c,i.getBoundingClientRect())&&o(),E=!1}try{t=new IntersectionObserver(P,{...I,root:n.ownerDocument})}catch{t=new IntersectionObserver(P,I)}t.observe(i)}return o(!0),r}function sg(i,e,t,s){s===void 0&&(s={});const{ancestorScroll:n=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,c=Gh(i),h=n||r?[...c?jr(c):[],...jr(e)]:[];h.forEach(x=>{n&&x.addEventListener("scroll",t,{passive:!0}),r&&x.addEventListener("resize",t)});const d=c&&a?m0(c,t):null;let f=-1,m=null;o&&(m=new ResizeObserver(x=>{let[D]=x;D&&D.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var I;(I=m)==null||I.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let y,b=l?Gn(i):null;l&&w();function w(){const x=Gn(i);b&&!tg(b,x)&&t(),b=x,y=requestAnimationFrame(w)}return t(),()=>{var x;h.forEach(D=>{n&&D.removeEventListener("scroll",t),r&&D.removeEventListener("resize",t)}),d==null||d(),(x=m)==null||x.disconnect(),m=null,l&&cancelAnimationFrame(y)}}const Yh=HC,Jh=UC,Xh=OC,ng=VC,g0=FC,Qh=(i,e,t)=>{const s=new Map,n={platform:p0,...t},r={...n.platform,_c:s};return zC(i,e,{...n,platform:r})};class ed extends ae{constructor(e){super(e),this._ref=ye(),this._handleDocClick=t=>{const{state:{open:s},id:n,togglePop:r}=this.props,o=v(t.target);s!=="closing"&&!o.closest(`#pick-${n},#pick-pop-${n}`).length&&o.parent().length&&r(!1)},this._handleClick=this._handleClick.bind(this)}get trigger(){return v(`#pick-${this.props.id}`)[0]}get element(){var e;return(e=this._ref)==null?void 0:e.current}get container(){return this._container}_handleClick(e){const{togglePop:t,onClickItem:s,state:n}=this.props,r=v(e.target),o=r.closest("[data-pick-value]");if(s&&s(e,n.value),o.length)return e.stopPropagation(),t(!1,{value:`${o.dataset("pickValue")}`});if(r.closest('[data-dismiss="pick"]').length)return t(!1)}_getClass(e){const{className:t,state:s,pickerName:n,empty:r}=e,{open:o}=s;return K("pick-pop",n?`${n}-pick-pop`:"",t,o===!0&&"in",r?"is-empty-value":"")}_getProps(e){const{id:t,style:s,maxHeight:n,maxWidth:r,minHeight:o,minWidth:a}=e,l=v.extend({maxHeight:n,maxWidth:r,minHeight:o,minWidth:a},s);return{id:`pick-pop-${t}`,className:this._getClass(e),style:l,ref:this._ref,onClick:this._handleClick}}_getContainer(e){if(!this._container){const t=v(e.container||"body");let s=t.find(".pick-container");s.length||(s=v("<div>").addClass("pick-container").appendTo(t)),this._container=s[0]}return this._container}_renderHeader(e){const{header:t}=e;return t?k(fe,{component:"header",className:"pick-pop-header",content:t},"header"):null}_renderFooter(e){const{footer:t}=e;return t?k(fe,{component:"footer",className:"pick-pop-footer",content:t},"footer"):null}_render(e){return k("div",{...this._getProps(e),children:[this._renderHeader(e),this._renderPop(e),this._renderFooter(e)]})}_renderPop(e){return e.children}_getStyle(e={},t){var c;const s=(c=this.trigger)==null?void 0:c.getBoundingClientRect();if(!s)return{};const{width:n,minWidth:r,maxWidth:o,maxHeight:a}=this.props,l=s.width;if(typeof n=="function"?e.width=n():n==="100%"?e.width=l:n&&(e.width=je(n)),r==="100%"&&(e.minWidth=l),o==="100%"&&(e.maxWidth=l),this.props.limitInScreen&&t&&(!a||a==="auto"||typeof a=="number")){let h;if(t.includes("bottom"))h=window.innerHeight-s.bottom-2;else{const d=this.element.getBoundingClientRect().height;h=s.top,d>h&&typeof e.top=="number"&&(e.top+=d-h)}h&&(e.maxHeight=typeof a=="number"?Math.min(h,a):h)}else a&&(e.maxHeight=a);return e}layout(){const{element:e,trigger:t,props:s}=this,{state:n}=s;if(!e||!t||!n.open){this._layoutWatcher&&(this._layoutWatcher(),this._layoutWatcher=void 0);return}this._layoutWatcher||(this._layoutWatcher=sg(t,e,()=>{const{placement:r,width:o,noFlipAfterShow:a}=s,l=this._lastPlacement;Qh(t,e,{placement:a&&l?l:!r||r==="auto"?"bottom-start":r,middleware:[r==="auto"&&(!a||!l)?Xh():null,Jh(),Yh(1)].filter(Boolean)}).then(({x:c,y:h,placement:d})=>{var f,m;if($s(t)||!Tr(t,{checkZeroSize:!0})){v(e).css({display:"none"});return}v(e).css(this._getStyle({left:c,top:h},d)),(m=(f=this.props).onLayout)==null||m.call(f,e),l||(this._lastPlacement=d)}),o==="100%"&&v(e).css(this._getStyle())}))}componentDidMount(){var e,t;this.layout(),v(document).on("click",this._handleDocClick),(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!0})}componentDidUpdate(){var e,t;(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!1})}componentWillUnmount(){var t,s;v(document).off("click",this._handleDocClick);const e=this._layoutWatcher;e&&(e(),this._layoutWatcher=void 0),this._container=void 0,this._ref=void 0,v(`#pick-pop-${this.props.id}`).remove(),(s=(t=this.props).beforeDestroy)==null||s.call(t)}render(e){return vm(this._render(e),this._getContainer(e))}}const M$="";let at=class extends ae{constructor(e){super(e),this._toggleTimer=0,this._pop=ye(),this._trigger=ye(),this.toggle=async(t,s)=>{(this.props.disabled||this.props.readonly)&&(t=!1);const{state:n}=this;if(typeof t=="boolean"&&t===(!!n.open&&n.open!=="closing"))return s&&await this.changeState(s),this.state;this._toggleTimer&&(clearTimeout(this._toggleTimer),this._toggleTimer=0);let r=await this.changeState(a=>(t=t??!a.open,{open:t?"opening":"closing",...s}));const{open:o}=r;return o==="closing"?(await Ss(200,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!1})):o==="opening"&&(await Ss(50,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!0})),r},this._id=e.id??`_pick${Xe()}`,this.changeState=this.changeState.bind(this),this.state=this.getDefaultState(e)}get id(){return this._id}get pop(){return this._pop.current}get trigger(){return this._trigger.current}get value(){return this.props.value??this.state.value}getDefaultState(e){const{value:t,defaultValue:s=""}=e||this.props;return{value:String(t??s),open:!1}}resetState(e,t){const s=this.getDefaultState(e);t?this.state=s:this.changeState(s)}changeState(e,t){return new Promise(s=>{this.setState(e,()=>{t==null||t(),s(this.state)})})}open(e){return this.toggle(!0,e)}close(e){return this.toggle(!1,e)}_getTriggerProps(e,t){return{id:this.id,ref:this._trigger,state:t,className:e.className,pickerName:e.pickerName,style:e.style,name:e.name,tagName:e.tagName,attrs:e.attrs,disabled:e.disabled,readonly:e.readonly,clickType:e.clickType,onRenderValue:e.onRenderValue,onClick:e.onClick,changeState:this.changeState,togglePop:this.toggle}}_getPopProps(e,t){return{id:this.id,state:t,className:e.popClass,pickerName:e.pickerName,style:e.popStyle,disabled:e.disabled,readonly:e.readonly,changeState:this.changeState,togglePop:this.toggle,placement:e.popPlacement,container:e.popContainer,width:e.popWidth,height:e.popHeight,minHeight:e.popMinHeight,maxHeight:e.popMaxHeight,maxWidth:e.popMaxWidth,minWidth:e.popMinWidth,limitInScreen:e.limitPopInScreen,onClickItem:e.onClickItem,header:e.popHeader,footer:e.popFooter}}_renderTrigger(e,t){return null}_renderPop(e,t){return null}_afterRender(e=!1){var t;(t=this.props.afterRender)==null||t.call(this,{firstRender:e})}_getPop(e){return e.Pop||this.constructor.Pop}_getTrigger(e){return e.Trigger||this.constructor.Trigger}_isEmptyValue(){const{value:e}=this.state;return e==null||e===""}_handleChange(e,t){const{onChange:s}=this.props;s&&s.call(this,e,t)}_handlePopToggle(e){const{onPopShown:t,onPopHidden:s}=this.props;e===!0&&t?t.call(this):!e&&s&&s.call(this)}async setValue(e,t){typeof e!="string"&&(e=String(e));const{beforeChange:s}=this.props;if(s){const n=await s.call(this,e,this.state.value);if(n===!1)return;typeof n=="string"&&(e=n)}if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.changeState({value:e})}componentDidMount(){this._afterRender(!0);const{value:e,defaultValue:t}=this.props,s=e??t??"",n=this.state.value;s!==n&&this._handleChange(n,s)}componentWillUpdate(e,t){const{open:s}=this.state,{open:n}=t;if(!s==!n)return;const{onPopShow:r,onPopHide:o}=this.props;n&&r?r.call(this):!n&&o&&o.call(this)}componentDidUpdate(e,t){if(e.value!==this.props.value&&this.props.value!==void 0){this.setValue(this.props.value);return}const{open:s,value:n}=this.state,{open:r,value:o}=t;!!s!=!!r&&this._handlePopToggle(!!s),n!==o&&this._handleChange(n,o),this._afterRender()}componentWillUnmount(){var t;(t=this.props.beforeDestroy)==null||t.call(this),this._toggleTimer&&clearTimeout(this._toggleTimer);const e=this._pop.current;e&&e.componentWillUnmount&&e.componentWillUnmount()}render(e,t){const{open:s}=t,n=this._getTrigger(e);let r;if(s&&(!e.hidePopWhenEmpty||!this._isEmptyValue())){const o=this._getPop(e);r=k(o,{ref:this._pop,...this._getPopProps(e,t),children:this._renderPop(e,t)},"pop")}return[k(n,{...this._getTriggerProps(e,t),children:this._renderTrigger(e,t)},"pick"),r]}};at.Trigger=Ia,at.Pop=ed,at.defaultProps={popContainer:"body",popClass:"popup",popWidth:"100%",popPlacement:"auto",popMinWidth:50,popMinHeight:32,popMaxHeight:300,limitPopInScreen:!0,clickType:"open"};let ig=class extends at{getDefaultState(e){const t=super.getDefaultState(e);return t.value===void 0&&(e||this.props).required&&(t.value=this.getColors()[0]),t}getColors(){const{colors:e}=this.props;return typeof e=="string"?e.split(","):e||[]}componentDidMount(){this.syncColor()}syncColor(){const{syncBackground:e,syncBorder:t,syncColor:s,syncValue:n}=this.props,r=this.state.value||"";if(e&&v(e).css("backgroundColor",r),t&&v(t).css("borderColor",r),s&&v(s).css("color",r),n){const o=v(n);o.is("input,textarea,select")?o.val(r):o.text(r)}}_handleChange(e,t){this.props.disabled||(super._handleChange(e||"",t||""),this.syncColor())}_renderTrigger(e,t){const{icon:s,hint:n=""}=e,{value:r}=t;return[s?k(Ie,{icon:s,title:n},"icon"):k("span",{class:"color-picker-item bg-current ring ring-gray ring-inset",style:{background:r},title:n})]}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return s.style=v.extend({color:t.value},s.style),s.className=K("color-picker",s.className,{disabled:e.disabled}),s}_renderPop(e,t){const{closeBtn:s,heading:n}=e,r=this.getColors(),{value:o}=t;let a;return n&&(a=k("div",{className:"color-picker-heading",children:[n,s?k("button",{className:"btn ghost square rounded size-sm","data-dismiss":"pick",children:k("span",{class:"close"})}):null]},"heading")),[a,k("div",{className:"color-picker-row",children:[r.map(l=>k("button",{className:"btn color-picker-item",style:{backgroundColor:l},"data-pick-value":l,children:o===l?k(Ie,{icon:"check"}):null},l)),k("button",{className:"btn color-picker-item","data-pick-value":"",children:k(Ie,{className:"text-fore",icon:"trash"})})]},"row")]}};ig.defaultProps={...at.defaultProps,className:"rounded btn square size-sm ghost",popClass:"color-picker-pop popup",colors:["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#14b8a6","#0ea5e9","#6366f1","#a855f7","#d946ef","#ec4899"],closeBtn:!0,popWidth:"auto",popMinWidth:184};class _n extends be{}_n.NAME="ColorPicker",_n.Component=ig,_n.register();const N$="";let y0=class extends ae{render(e){const{id:t,popup:s,title:n,content:r,style:o,className:a,closeBtn:l,arrow:c,headingClass:h,titleClass:d,contentClass:f,arrowStyle:m,onlyInner:y,footer:b,footerClass:w}=e;let x=k(fe,{content:r},"content");(f||n)&&(x=k("div",{className:f,children:x},"content"));let D=k(fe,{content:b},"footer");(w||n)&&(D=k("div",{className:w,children:D},"footer"));const I=[],E=l?k("button",{className:"btn ghost square size-sm btn-close","data-dismiss":"popover",children:k("span",{className:"close"})}):null;return n?I.push(k("div",{className:h,children:[n?k(fe,{className:d,content:n}):null,E]},"heading")):I.push(E),I.push(x,D),c&&I.push(k("div",{className:typeof c=="string"?c:"arrow",style:m},"arrow")),y?I:k("div",{id:t,className:K("popover",a,{popup:s,"has-heading":n}),style:o,children:I})}};class Fa extends be{}Fa.NAME="PopoverPanel",Fa.Component=y0;const rg="show",og="in",Fi=class X_ extends Ze{constructor(){super(...arguments),this._handlePanelInited=()=>{this.layout()},this._getClickBounding=()=>{const e=this._triggerEvent;return{x:e.clientX,y:e.clientY,left:e.clientX,top:e.clientY,width:0,height:0,bottom:e.clientY,right:e.clientX}}}get shown(){return this._shown}get id(){return this._id}get zIndex(){return this._zIndex}get trigger(){return this._triggerElement}get target(){return this._targetElement}afterInit(){const{trigger:e,id:t,triggerEvent:s}=this.options;this._triggerEvent=s,this._id=t||`popover_${this.gid}`;const n=this.getTriggerElement();if(n instanceof HTMLElement){const o=v(n),{namespace:a}=this;if(e){const l=()=>{let c=o.dataset();const h=o.attr(`zui-toggle-${this.constructor.ZUI}`);h&&(c=v.extend(c,ln(h))),this.setOptions(c)};e==="hover"?o.on(`mouseenter${a}`,c=>{o.is("[disabled],.disabled")||(l(),this._clearDelayHide(),this.shown||this.show({delay:!0,event:c}))}).on(`mouseleave${a}`,()=>{this.delayHide()}):o.on(`${e}${a}`,c=>{o.is("[disabled],.disabled")||(this.shown||l(),this.toggle({event:c,delay:!0}),c.preventDefault())})}}const{show:r}=this.options;r&&this.show({delay:typeof r=="number"?r:!1})}getTriggerElement(){if(!this._triggerElement){let{element:e=this.element}=this.options;e===document.body&&(e={getBoundingClientRect:this._getClickBounding}),this._triggerElement=e,this._virtual=!(e instanceof HTMLElement)}return this._triggerElement}initTarget(){let e=this.options.target;return this._dynamic=!e,e?(typeof e=="function"&&(e=e()),typeof e=="string"&&(e==="$next"?e=v(this._triggerElement).next():e.startsWith("$target:")&&(e=v(this._triggerElement).closest(e.slice(8)))),v(e)[0]):this._createTarget()}show(e){const{delay:t,event:s,hideOthers:n=this.options.hideOthers}=e||{};if(s&&(this._triggerEvent=s),t)return this._resetTimer(()=>{this.show()},t===!0?this.options.delay:t);if(!this.inited){this.setOptions({show:!0});return}if(this._shown)return;const r=this.initTarget();if(!r)return;this._targetElement=r;const o=v(r),{animation:a,onShow:l,onShown:c,trigger:h,elementShowClass:d}=this.options,{SHOWN_POPOVERS:f}=this.constructor;o.addClass(rg),a&&o.addClass(a===!0?"fade":a),this._zIndex=X_.Z_INDEX++,this._shown=!0,this.render(),f.set(this.gid,this),l==null||l.call(this),this.emit("show"),n&&f.forEach(y=>{y!==this&&y.hide()});const{namespace:m}=this;h==="hover"&&(this._clearDelayHide(),o.off(m).on(`mouseenter${m}`,()=>{this._clearDelayHide()}).on(`mouseleave${m}`,()=>{this.delayHide()})),this._virtual||(o.attr("zui-commands-proxy","").data("zui.commandProxy",this._triggerElement),d&&v(this._triggerElement).addClass(d)),this._resetTimer(()=>{o.addClass(og),this._resetTimer(()=>{c==null||c.call(this),this.emit("shown")},200)},50)}hide(e){(!this._shown||!this._targetElement)&&this._resetTimer();const{destroyOnHide:t,animation:s,onHide:n,onHidden:r,trigger:o,hideNewOnHide:a,elementShowClass:l}=this.options,c=v(this._targetElement),{SHOWN_POPOVERS:h}=this.constructor;if(this._shown=!1,h.delete(this.gid),n==null||n.call(this),this.emit("hide"),c.removeClass(og),o==="hover"&&(this._clearDelayHide(),c.off(this.namespace)),!this._virtual){const d=v(this._triggerElement);d.removeAttr("zui-commands-proxy").removeData("zui.commandProxy"),l&&d.removeClass(l).removeAttr("data-pop-placement")}a&&h.forEach(d=>{d!==this&&d.zIndex>this.zIndex&&d.hide()}),this._resetTimer(()=>{r==null||r.call(this),this.emit("hidden"),c.removeClass(rg),(t||e)&&this._resetTimer(()=>{this.destroy()},!e&&typeof t=="number"?t:0),this._destoryTarget()},s&&!e?200:0)}toggle(e){this._shown?this.hide():this.show(e)}destroy(){if(super.destroy(),!this._virtual){const{namespace:e}=this;v(this._triggerElement).off(e)}this.$element.hasClass("popover-tmp")&&this.$element.remove(),this._resetTimer(),this._destoryTarget(),this._clearDelayHide()}updateLayout(){if(this.destroyed||!this._shown)return;const e=this.getTriggerElement(),t=this._targetElement,{minWidth:s,minHeight:n,maxWidth:r,maxHeight:o}=this.options;if(!this._virtual){const a={minWidth:je(s),minHeight:je(n),maxWidth:je(r),maxHeight:je(o)},{width:l,height:c}=this.options;l&&(a.width=typeof l=="function"?l():l==="100%"?v(e).outerWidth():l),c&&(a.height=typeof c=="function"?c():c),Object.keys(a).length&&v(t).css(a)}this.updatePosition()}updatePosition(){const e=this.getTriggerElement(),t=this._targetElement,{animation:s,name:n="popover",limitInScreen:r,onLayout:o}=this.options;Qh(...this._getLayoutOptions()).then(({x:a,y:l,middlewareData:c,placement:h,strategy:d})=>{if(e instanceof HTMLElement&&$s(e)){this.hide(!0);return}const f={position:d,left:a,top:l},m=v(t).css(f);r&&m.css({top:Math.max(0,Math.min(window.innerHeight-m.outerHeight(),l)),left:Math.max(0,Math.min(window.innerWidth-m.outerWidth(),a))});const y=h.split("-")[0],b={top:"bottom",right:"left",bottom:"top",left:"right"}[y],w=c.arrow;w&&m.attr("data-pop-placement",y).find(".arrow").css({left:w.x,top:w.y}).attr("class",`arrow ${n}-arrow arrow-${b}`),s===!0&&m.attr("class",`${m.attr("class").split(" ").filter(x=>x!=="fade"&&!x.startsWith("fade-from")).join(" ")} fade-from-${b}`),this._virtual||v(this._triggerElement).attr("data-pop-placement",y),o&&o.call(this,{target:t,trigger:e,popSide:y,arrowSide:b,x:a,y:l,placement:h,strategy:d})})}layout(){const e=this._triggerElement,t=this._targetElement,s=this._layoutWatcher;if(!t||!e||!this._shown){s&&(s(),this._layoutWatcher=void 0);return}s||(this._layoutWatcher=sg(e,t,this.updateLayout.bind(this),{ancestorResize:!1}))}render(e){super.render(e);const t=this._targetElement;if(!t)return;const s=this._getRenderOptions(),n=v(t);if(n.z("popover",this.gid).toggleClass("popup",s.popup).css(s.style),s.className&&n.setClass(s.className),this._dynamic){let r=this._panel;r&&r.element!==t&&(r.destroy(),r=void 0),r?r.render(s):(r=new Fa(t,s),r.on("inited",this._handlePanelInited)),this._panel=r}else s.arrow&&(n.find(".arrow").length||n.append(v('<div class="arrow"></div>').css(s.arrowStyle))),this.layout()}handleClickOutside(e){if(this.options.mask){const t=this._triggerElement;t instanceof HTMLElement&&v(e.target).closest(t).length||this.hide()}}handleClickTarget(e){}delayHide(e=150){this._resetTimer(),this._clearDelayHide(),this._hideTimer=window.setTimeout(()=>{this._hideTimer=0,this.hide()},e)}_clearDelayHide(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=0)}_getLayoutOptions(){const e=this.getTriggerElement(),t=this._targetElement,{placement:s,flip:n,limitSize:r,shift:o,offset:a,arrow:l,strategy:c}=this.options,h=l?t.querySelector(".arrow"):null,d=h?typeof l=="number"?l:5:0,f=()=>typeof a=="function"?a:typeof a=="object"?{mainAxis:(a.mainAxis||0)+d,...a}:(a||0)+d;return[e,t,{placement:s,strategy:c,middleware:[n?Xh():null,o?Jh(typeof o=="object"?o:void 0):null,a||d?Yh(f()):null,l?g0({element:h}):null,r?ng({apply({availableWidth:m,availableHeight:y,placement:b}){v(t).css({maxHeight:y-(["top","bottom"].includes(b.split("-")[0])?d:0)-2,maxWidth:m-2})}}):null].filter(Boolean)}]}_getRenderOptions(){const{name:e="popover"}=this.options,{popup:t,title:s,content:n,headingClass:r=`${e}-heading`,titleClass:o=`${e}-title`,contentClass:a=`${e}-content`,style:l,className:c=e,closeBtn:h,arrow:d,footer:f,footerClass:m=`${e}-footer`}=this.options;return{popup:t,title:s,titleClass:o,headingClass:r,contentClass:a,content:n,style:{zIndex:this._zIndex,...l},className:c,closeBtn:h,arrow:d?`arrow ${e}-arrow`:!1,arrowStyle:{"--arrow-size":`${typeof d=="number"?d:5}px`},onlyInner:!0,footer:f,footerClass:m}}_destoryTarget(){var e,t,s;(e=this._layoutWatcher)==null||e.call(this),this._layoutWatcher=void 0,this._dynamic&&((t=this._panel)==null||t.destroy(),(s=this._targetElement)==null||s.remove(),this._panel=void 0,this._targetElement=void 0)}_resetTimer(e,t=0){this._timer&&clearTimeout(this._timer),e&&(this._timer=window.setTimeout(()=>{this._timer=0,e()},t))}_createTarget(){const{container:e="body"}=this.options,t=v(e);let s=t.find(`#${this._id}`);return s.length||(s=v("<div />").attr({id:this._id,class:"popover"}).appendTo(t)),s[0]}static create(e,t){const{element:s,container:n="body",id:r=`popover_${Xe()}`}=e||{};return t=t||(s instanceof HTMLElement?s:void 0),t||(t=v(`<div id="${r}" class="popover-tmp"></div>`).appendTo(v(n))[0]),this.ensure(t,{id:r,destroyOnHide:!0,...e})}static show(e){const{element:t,event:s,...n}=e,r=t||(s==null?void 0:s.currentTarget);return this.create({element:r,show:!0,destroyOnHide:!0,triggerEvent:s,...n},r instanceof HTMLElement?r:document.body)}};Fi.NAME="Popover",Fi.Z_INDEX=1700,Fi.MULTI_INSTANCE=!0,Fi.DEFAULT={placement:"top",strategy:"absolute",flip:!0,arrow:!0,offset:1,trigger:"click",mask:!0,delay:0,animation:!0,closeBtn:!0,popup:!0,elementShowClass:"with-popover-show",hideNewOnHide:!0},Fi.SHOWN_POPOVERS=new Map;let qt=Fi;qt.toggle={trigger:["click","hover"],convertHref:{selector:"target"},check(i,e){const t=v(i);return t.data(this.KEY)?!1:e==="hover"?(t.dataset("trigger")||this.DEFAULT.trigger)==="hover":!0},getOptions(i,e,t){return{triggerEvent:t,...e}},onToggle(i,e,t){i.toggle({event:t})}},qt.register(),v(()=>{v(document).on(`click.${qt.NAMESPACE}`,i=>{const{SHOWN_POPOVERS:e}=qt;if(!e.size)return;const t=v(i.target),s=t.closest("[z-popover]"),n=s.length?s.z("popover"):0,r=n?e.get(n):null;if(r){const a=r.options.name??r.constructor.ZUI;if(t.closest(`[data-dismiss="popover"],[data-dismiss="${a}"]`).length){r.hide();return}if(r.handleClickTarget(i))return}const o=[...e.values()].sort((a,l)=>l.zIndex-a.zIndex);for(const a of o)if(a!==r&&a.handleClickOutside(i))return})}),Object.assign(window,{Popover:qt});const E$="";class Zn extends qt{_getRenderOptions(){const{type:e,className:t,title:s,content:n}=this.options;let r=s,o=n;return o===void 0&&(o=r,r=void 0),{...super._getRenderOptions(),title:r,content:o,className:K("tooltip",e,t,r?"tooltip-has-title":""),contentClass:r?"tooltip-content":""}}}Zn.NAME="Tooltip",Zn.DEFAULT={...qt.DEFAULT,trigger:"hover",delay:500,closeBtn:!1,popup:!1,name:"tooltip",animation:"fade",destroyOnHide:5e3,hideOthers:!0,hideNewOnHide:!1},Zn.register();const A$="",P$="",L$="";let Yn=class extends Ze{constructor(){super(...arguments),this._timer=0,this._copying=!1}async getContent(){const{copy:e,target:t,onCopy:s}=this.options;let n=e;if(t&&n===void 0){const r=v(t);n={text:r.text(),html:r.html()}}if(s){const r=await s.call(this,n);r!==void 0&&(r instanceof v?n={text:r.text(),html:r.html()}:n=r)}return n}async copy(){if(this._copying)return;this._copying=!0,this._hideTip();const{onCopied:e,copyingClass:t}=this.options;t&&this.$element.addClass(t);const s=await this.getContent();if(s===!1||s===void 0){this._copying=!1;return}await fh(s),this._showTip(),e&&e.call(this),this._copying=!1}_showTip(){const{$element:e}=this,{mode:t,tooltipOptions:s,copiedText:n,duration:r,copiedIcon:o,overlayClass:a,copiedClass:l}=this.options;let c=n;if(c===void 0&&(c={zh_cn:"已复制",zh_tw:"已複製",en:"Copied"}[Pe.getCode()]??"Copied"),l&&e.addClass(l),t==="tooltip"){let h=this._tooltip;(!h||h.destroyed)&&(h=new Zn(this.$element,{trigger:"manual",type:"success",title:c,placement:"top",...s}),this._tooltip=h),h.show()}else a&&e.addClass(a),e.addClass("hide-children"),o&&e.append(`<i class="copied-overlay icon ${o.startsWith("icon-")?o:`icon-${o}`}" style="display:inline!important"></i>`),e.append(`<span class="copied-overlay text" style="display:inline!important">${c}</span>`);this._timer=window.setTimeout(()=>{this._hideTip()},r)}_hideTip(){var o;this._timer&&(clearTimeout(this._timer),this._timer=0);const{$element:e,options:t}=this,{copyingClass:s,copiedClass:n,overlayClass:r}=t;e.removeClass("hide-children"),e.children(".copied-overlay").remove(),[s,n,r].forEach(a=>{a&&e.removeClass(a)}),(o=this._tooltip)==null||o.hide()}destroy(){var e;this._hideTip(),(e=this._tooltip)==null||e.destroy()}};Yn.NAME="CopyBtn",Yn.DEFAULT={mode:"tooltip",duration:3e3,copiedClass:"is-copied",overlayClass:"success-pale",copyingClass:"is-copying"},Yn.toggle={trigger:"click",convertHref:{selector:"target"},onToggle(i){i.copy()}},Yn.register();const R$="";class ag extends ae{constructor(){super(...arguments),this._ref=ye(),this._handleClickItem=(e,t)=>{var s,n;(n=(s=this.props).onChange)==null||n.call(s,e,+t.item.key)}}componentDidMount(){setTimeout(()=>{v(this._ref.current).find(".menu-item>.active").scrollIntoView({container:".menu"})},100)}render(e){const{minuteStep:t=5,hour:s,minute:n}=e,r=[],o=[];for(let l=0;l<24;++l)r.push({key:String(l),text:l<10?`0${l}`:l,active:s===l});for(let l=0;l<60;l+=t)o.push({key:String(l),text:l<10?`0${l}`:l,active:n===l});const a="col w-10 max-h-full overflow-y-auto scrollbar-thin scrollbar-hover";return k("div",{className:"time-picker-menu row",ref:this._ref,children:[k(Rt,{className:a,items:r,onClickItem:this._handleClickItem.bind(this,"hour")}),k(Rt,{className:a,items:o,onClickItem:this._handleClickItem.bind(this,"minute")})]})}}const z$="",lg=i=>{if(!i)return;const e=Je(`1999-01-01 ${i}`);if(!Number.isNaN(e.getDay()))return e};let Oa=class extends at{constructor(){super(...arguments),this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setTime(e.target.value)},this._handleSetTime=(e,t)=>{this.setTime({[e]:String(t)})},this._handleClearBtnClick=()=>{this.setTime("")}}getDefaultState(e){const t=super.getDefaultState(e);return t.value==="now"&&(t.value=rt(new Date,(e||this.props).format)),t}setTime(e,t){if(!t&&(this.props.disabled||this.props.readonly))return;let s="";if(typeof e=="string")s=e;else{const[c,h]=(this.state.value||"00:00").split(":"),{hour:d=+c,minute:f=+h}=e;s=`${d}:${f}`}const n=lg(s),{onInvalid:r,required:o,defaultValue:a,format:l}=this.props;return this.changeState({value:n?rt(n,l):o?a:""},()=>{!n&&r&&r(s)})}setValue(e,t){if(t){const s=this._trigger.current;s&&(s._skipTriggerChange=e)}return this.setTime(e,!0)}getTime(){const e=lg(this.state.value);return e?[e.getHours(),e.getMinutes()]:null}_renderTrigger(e,t){const{placeholder:s,icon:n,required:r,disabled:o,readonly:a}=e,{value:l="",open:c}=t,h=`time-picker-${this.id}`;let d;return c&&!r&&l.length?d=k("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:k("span",{className:"close"})}):n&&(n===!0?d=k("i",{class:"i-time"}):d=k(Ie,{icon:n})),[k("input",{id:h,type:"text",className:"form-control",placeholder:s,value:l,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),d?k("label",{for:h,className:"input-control-suffix",children:d},"icon"):null]}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return{...s,className:K(s.className,"time-picker input-control has-suffix-icon")}}_renderPop(e){const[t,s]=this.getTime()||[];return k(ag,{hour:t,minute:s,minuteStep:e.minuteStep,onChange:this._handleSetTime})}};Oa.defaultProps={...at.defaultProps,popWidth:"auto",popMaxHeight:320,minuteStep:5,format:"hh:mm",icon:!0};function v0(i,e,t){return e&&i<e?e:t&&i>t?t:i}function Br(i){if(i==null)return null;if(typeof i=="function"&&(i=i()),typeof i=="string"&&i.startsWith("today")){const e=new Date;i.length>6?i=Ap(e,i.substring(5).replace("+","")):i=e}else i=Je(i);return ih(i)?i:null}Pe.addLang({zh_cn:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},zh_tw:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},en:{today:"Today",yearFormat:"{0}",weekNames:["SUN","MON","TUE","WED","THU","FRI","SAT"],monthNames:["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sept.","Oct.","Nov.","Dec."]}});const _0=(i,e,t=0)=>{const s=new Date(i,e-1,1),n=s.getDay(),r=s.getTime()-(7+n-t)%7*ki;return{days:7*5,startTime:r,firstDay:s.getTime()}},cg=(i,e)=>new Set((Array.isArray(i)?i:[i]).map(t=>rt(t,e)));class b0 extends ae{constructor(){super(...arguments),this._handleClickDate=e=>{const{onClickDate:t}=this.props;if(!t)return;const s=v(e.target).closest(".mini-calendar-day").dataset("date");s&&t(s)}}render(e){var ve,ee;const t=new Date,{weekStart:s=1,weekNames:n=Pe.getLang("weekNames"),monthNames:r=Pe.getLang("monthNames"),year:o=t.getFullYear(),month:a=t.getMonth()+1,highlights:l=[],selections:c=[],maxDate:h,minDate:d,isAllowDate:f}=e,m=[],y="btn ghost square rounded-full";for(let ne=0;ne<7;ne++){const Ce=(s+ne)%7;m.push(k("div",{className:K("col mini-calendar-day",{"is-weekend":Ce===0||Ce===6}),children:k("div",{children:n?n[Ce]:Ce})},ne))}const{startTime:b,days:w,firstDay:x}=_0(o,a,s),D=x+w*ki;let I=b;const E=[],P="yyyy-MM-dd",O=cg(l,P),W=cg(c,P),J=((ve=h?Je(h):null)==null?void 0:ve.getTime())??Number.MAX_SAFE_INTEGER,Y=((ee=d?Je(d):null)==null?void 0:ee.getTime())??0;for(;I<=D;){const ne=[];for(let Ce=0;Ce<7;Ce++){const Me=new Date(I);let ze=(f==null?void 0:f(Me))??!0;typeof ze=="boolean"&&(ze={allow:ze});const He=Me.getDate(),te=rt(Me,P),X=Me.getDay(),Ee=ea(Me,x),Ae=K("col mini-calendar-day",{active:O.has(te),selected:W.has(te),"is-first":He===1,"is-in-month":Ee,"is-out-month":!Ee,"is-today":un(Me,t),"is-weekend":X===0||X===6,disabled:!ze.allow||(I>J||I<Y)&&!un(Me,J)&&!un(Me,Y)});ne.push(k("div",{className:Ae,"data-date":te,children:k("button",{type:"button",className:y,onClick:this._handleClickDate,title:ze.hint,children:He===1&&r?r[Me.getMonth()]:Me.getDate()})},te)),I+=ki}E.push(k("div",{className:"row",children:ne},I))}return k("div",{className:"mini-calendar",children:[k("div",{className:"row",children:m},"header"),E]},`${o}-${a}`)}}class hg extends ae{constructor(){super(...arguments),this._ref=ye(),this._handleClickItem=e=>{const{onChange:t}=this.props;if(!t)return;const n=v(e.target).closest("[data-value]").dataset("value");n&&(t(+n),e.stopPropagation())}}render(e){const{className:t,max:s,min:n,value:r}=e,o=[],a=new Date().getFullYear();for(let l=n;l<=s;++l)o.push(k(we,{type:"ghost","data-value":l,active:l===r,className:K(a===l?"is-current":""),onClick:this._handleClickItem,children:l},l));return k("div",{className:t,ref:this._ref,children:o})}}class w0 extends ae{constructor(e){super(e),this._ref=ye(),this._handleClick=n=>{const r=v(n.target).closest("[data-set-date]");r.length&&this.changeDate(r.dataset("set-date"))},this._switchToPrevMonth=()=>{const{year:n,month:r}=this.state;r===1?this.setState({year:n-1,month:12}):this.setState({month:r-1})},this._switchToNextMonth=()=>{const{year:n,month:r}=this.state;r===12?this.setState({year:n+1,month:1}):this.setState({month:r+1})},this._changeYear=n=>{this.setState({year:n,select:"day"})},this._changeMonth=n=>{this.setState({month:n,select:"day"})},this.changeDate=n=>{var r,o;(o=(r=this.props).onChange)==null||o.call(r,n)};const{date:t}=e,s=Br(t)||new Date;this.state={select:"day",year:s.getFullYear(),month:s.getMonth()+1}}_renderMenu(e){return Rt.render(e.menu,[],{onClickItem:t=>{const s=t.item.value;typeof s=="string"&&this.changeDate(s)}},this)}_renderFooter(e){let{actions:t}=e;const{todayText:s=Pe.getLang("today"),clearText:n}=e;return t===void 0&&(t=[{text:s,"data-set-date":rt(new Date,"yyyy-MM-dd")}]),Array.isArray(t)&&(t={items:t}),k("div",{className:"date-picker-menu-footer",children:[k(Be,{btnProps:{className:"ghost text-primary"},...t}),n?k(we,{type:"ghost text-link","data-set-date":"",children:n}):null]})}_showSelect(e){this.setState(t=>t.select===e?{select:"day"}:{select:e})}render(e,t){const{date:s,yearText:n=Pe.getLang("yearFormat")||"{0}",weekNames:r=Pe.getLang("weekNames"),monthNames:o=Pe.getLang("monthNames"),minDate:a,maxDate:l,weekStart:c}=e,h=Br(s),{year:d,month:f,select:m}=t,y=m==="day",b=a||Je("1970-1-1"),w=l||Je("2099-12-31");return k("div",{className:"date-picker-menu row",ref:this._ref,onClick:this._handleClick,children:[this._renderMenu(e),k("div",{className:"cell",style:"width: 312px",children:[k("div",{className:"row p-2",children:[k(we,{type:m==="year"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"year"),children:$e(n,d)}),k(we,{type:m==="month"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"month"),children:o?o[f-1]:f}),k("div",{className:"flex-auto"}),y?k("div",{children:[k(we,{type:"ghost",size:"sm",square:!0,onClick:this._switchToPrevMonth,children:k("i",{className:"chevron-left"})}),k(we,{type:"ghost",size:"sm",square:!0,onClick:this._switchToNextMonth,children:k("i",{className:"chevron-right"})})]}):null]}),y?k(b0,{weekStart:c,weekNames:r,monthNames:o,maxDate:w,minDate:b,year:d,month:f,selections:h||[],onClickDate:this.changeDate,isAllowDate:e.isAllowDate}):null,m==="year"?k(hg,{className:"date-pick-menu-years overflow-y-auto scrollbar-hover scrollbar-thin",value:d,min:b.getFullYear(),max:w.getFullYear(),onChange:this._changeYear}):m==="month"?k(hg,{className:"date-pick-menu-month overflow-y-auto scrollbar-hover scrollbar-thin",value:f,min:1,max:12,onChange:this._changeMonth}):null,y?this._renderFooter(e):null]})]})}}const F$="";let Oi=class extends at{constructor(){super(...arguments),this.setDate=(e,t)=>{const{disabled:s,readonly:n}=this.props;if(!t&&(s||n))return;const r=this._calcValue(e);return this.changeState({value:r},()=>{this._afterSetDate()})},this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setDate(e.target.value)},this._handleClearBtnClick=()=>{this.setDate("")},this._handleSetDate=e=>{this.setDate(e)}}getDefaultState(e){const t=super.getDefaultState(e);return{...t,value:this._calcValue(t.value)}}getDate(){return this._date}setValue(e,t){if(t){const s=this._trigger.current;s&&(s._skipTriggerChange=e)}return this.setDate(e,!0)}_calcValue(e){const{onInvalid:t,defaultValue:s="",required:n,allowInvalid:r,format:o}=this.props;let a=this._parseDate(e);if(!a&&t){const l=t(e);l&&(a=this._parseDate(l))}return this._date=a,a?rt(a,o):r?e:n?s:""}_getDateRange(e){const{minDate:t,maxDate:s}=this.props;return[Br(typeof t=="function"?t(e):t),Br(typeof s=="function"?s(e):s)]}_parseDate(e){const t=Br(e);return t&&this._isAllowDate(t)?v0(t,...this._getDateRange(e)):null}_afterSetDate(){this.toggle(!1)}_renderTrigger(e,t){const{placeholder:s,icon:n,required:r,disabled:o,readonly:a,display:l}=e,{value:c="",open:h}=t,d=`date-picker-${this.id}`;let f;h&&!r&&c.length?f=k("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:k("span",{className:"close"})}):n&&(n===!0?f=k("i",{class:"i-calendar"}):f=k(Ie,{icon:n}));const m=h?c:l?l(c,this._date):c;return[k("input",{id:d,type:"text",className:"form-control",placeholder:s,value:m,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),f?k("label",{for:d,className:"input-control-suffix",children:f},"icon"):null]}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return{...s,className:K(s.className,"date-picker input-control has-suffix-icon")}}_getPopProps(e,t){const s=super._getPopProps(e,t);return{...s,className:K(s.className,"popup")}}_isAllowDate(e){var s;const t=((s=this.props.isAllowDate)==null?void 0:s.call(this,e))??!0;return t===!0||typeof t=="object"&&t&&t.allow}_renderPop(e,t){const{weekNames:s,monthNames:n,weekStart:r,yearText:o,todayText:a,clearText:l,menu:c,actions:h,required:d,isAllowDate:f}=e,[m,y]=this._getDateRange(t.value);return k(w0,{onChange:this._handleSetDate,date:this._date,weekNames:s,monthNames:n,weekStart:r,yearText:o,todayText:a,clearText:d?"":l,menu:c,actions:h,minDate:m,maxDate:y,isAllowDate:f?this._isAllowDate.bind(this):void 0})}};Oi.defaultProps={...at.defaultProps,popWidth:"auto",popMaxHeight:320,format:"yyyy-MM-dd",icon:!0,limitPopInScreen:!1};let td=class extends Oi{constructor(){super(...arguments),this._handleSetDate=e=>{const t=Je(e),s=this.getDate()||new Date;t.setHours(s.getHours()),t.setMinutes(s.getMinutes()),this.setDate(rt(t,this.props.format))},this._handleSetTime=(e,t)=>{const s=this.getDate()||new Date;e==="hour"?s.setHours(t):s.setMinutes(t),this.setDate(rt(s,this.props.format))}}getTime(){const e=this.getDate();return e?[e.getHours(),e.getMinutes()]:null}_afterSetDate(){}_renderPop(e,t){const[s,n]=this.getTime()||[];return k("div",{className:"datetime-picker-menu row",children:[super._renderPop(e,t),k("div",{className:"divider"}),k(ag,{hour:s,minute:n,minuteStep:e.minuteStep,onChange:this._handleSetTime})]})}};td.defaultProps={...Oi.defaultProps,popMaxHeight:310,format:"yyyy-MM-dd hh:mm",minuteStep:5};class ja extends be{}ja.NAME="TimePicker",ja.Component=Oa,ja.register();class Ba extends be{}Ba.NAME="DatePicker",Ba.Component=Oi,Ba.register();class Ha extends be{}Ha.NAME="DatetimePicker",Ha.Component=td,Ha.register();const O$="",dg="show",sd="in",C0='[data-dismiss="modal"]',Ua="modal-hide",ji=class yi extends Ze{constructor(){super(...arguments),this._timer=0,this._handleClick=e=>{const t=e.target,s=t.closest(".modal");!s||s!==this.modalElement||(t.closest(C0)||this.options.backdrop===!0&&t===s)&&(e.preventDefault(),this.hide())}}static get SELECTOR(){return".modal"}get modalElement(){return this.element}get shown(){return this._shown}get dialog(){return this.modalElement.querySelector(".modal-dialog")}get rob(){return this._rob}_observeResize(){var e;if(this.options.responsive&&typeof ResizeObserver<"u"){(e=this._rob)==null||e.disconnect();const{dialog:t}=this;if(t){const s=new ResizeObserver(()=>{if(!this._shown)return;const n=t.clientWidth,r=t.clientHeight,[o,a]=this._lastDialogSize||[];(o!==n||a!==r)&&(this._lastDialogSize=[n,r],this.layout())});s.observe(t),this._rob=s}}}_cancelObserver(){var e;(e=this._rob)==null||e.disconnect(),this._rob=void 0}afterInit(){this.on("click",this._handleClick),this.options.show&&(this.show(),this._observeResize()),this.on("hidden",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();const s=e.target.closest(".modal")===t;s&&this._cancelObserver(),s&&!yi.getAll().some(n=>n.shown)&&v("html").enableScroll()}),this.on("show",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();e.target.closest(".modal")===t&&(this._observeResize(),v("html").disableScroll())}),this.shown&&v("html").disableScroll()}destroy(){super.destroy(),this._cancelObserver()}show(e){var c;const{modalElement:t}=this,s=v(t);if(this._shown&&s.hasClass(sd))return s.removeClass(Ua).css("z-index",`${yi.zIndex++}`),!1;this._shown=!0,this.setOptions(e);const{animation:n,backdrop:r,className:o,style:a}=this.options;s.setClass({"modal-trans":n,"modal-no-backdrop":!r,[Ua]:!1},dg,o).css({zIndex:`${yi.zIndex++}`,...a});const l=this.constructor;return l.hideOthers&&this.options.hideOthers!==!1&&l.getAll().forEach(h=>{h!==this&&h.shown&&!s.closest(h.modalElement).length&&h.hideForOther()}),this.options.closeOthers&&l.getAll().forEach(h=>{h!==this&&!s.closest(h.modalElement).length&&h.hide()}),this.layout(),(c=this.options.onShow)==null||c.call(this),this.emit("show"),this._setTimer(()=>{s.addClass(sd),this._setTimer(()=>{var h,d;(h=s.find("[autofocus]")[0])==null||h.focus(),(d=this.options.onShown)==null||d.call(this),this.emit("shown")})},50),!0}hideForOther(){v(this.modalElement).addClass(Ua)}hide(){var t;if(!this._shown||(this._shown=!1,v(this.modalElement).removeClass(sd),((t=this.options.onHide)==null?void 0:t.call(this))===!1))return!1;this.emit("hide"),this._setTimer(()=>{var s;v(this.modalElement).removeClass(dg),(s=this.options.onHidden)==null||s.call(this),this.emit("hidden")});const e=this.constructor;return e.hideOthers&&this.options.hideOthers!==!1&&e.getAll().forEach(s=>{s.shown&&s!==this&&v(s.modalElement).removeClass(Ua)}),!0}layout(e,t){if(!this._shown)return;const{dialog:s}=this;if(!s)return;const n=v(s);if(t=t??this.options.size,t){n.removeAttr("data-size");const h={width:"",height:""};typeof t=="object"?(h.width=t.width,h.height=t.height):typeof t=="string"&&["md","sm","lg","full"].includes(t)?n.attr("data-size",t):t&&(h.width=t),n.css(h)}e=e??this.options.position??"fit";const r=s.clientWidth,o=s.clientHeight;this._lastDialogSize=[r,o],typeof e=="function"&&(e=e({width:r,height:o}));const a={left:null,bottom:null,right:null};let l=null,c="center";typeof e=="number"?(c="flex-start",l=e):typeof e=="object"&&e?(Object.assign(a,e),l=a.top??l,c=a.alignSelf??"flex-start"):e==="fit"?(c="flex-start",l=`${Math.max(0,Math.floor((window.innerHeight-o)/3))}px`):e==="bottom"?c="flex-end":e==="top"?c="flex-start":e!=="center"&&typeof e=="string"&&(c="flex-start",l=e),a.top=l,a.alignSelf=c,n.css(a),v(this.modalElement).css("justifyContent",a.left?"flex-start":"center")}_setTimer(e,t){this._timer&&(clearTimeout(this._timer),this._timer=0),e&&(this.options.animation?this._timer=window.setTimeout(e,t??this.options.transTime):e())}static last(e){return yi.query(e,void 0,t=>t.shown)}static hide(e){var t;(t=yi.last(e))==null||t.hide()}static show(e){var t;(t=yi.query(e,void 0,s=>!s.shown))==null||t.show()}};ji.NAME="Modal",ji.MULTI_INSTANCE=!0,ji.DEFAULT={position:"fit",show:!0,keyboard:!0,animation:!0,backdrop:!0,responsive:!0,transTime:300},ji.hideOthers=!0,ji.zIndex=1500;let Bi=ji;v(window).on(`resize.${Bi.NAMESPACE}`,()=>{Bi.getAll().forEach(i=>{const e=i;e.shown&&e.options.responsive&&e.layout()})});class ug extends ae{constructor(e){super(e),this._ref=ye(),this.state={showed:!e.waitShowEvent}}componentDidMount(){const{waitShowEvent:e,afterRender:t}=this.props;t==null||t.call(this,{firstRender:!0}),e&&v(this._ref.current).on(e,()=>{this.setState({showed:!0})})}componentDidUpdate(){var e;(e=this.props.afterRender)==null||e.call(this,{firstRender:!1})}componentWillUnmount(){var e;(e=this.props.beforeDestroy)==null||e.call(this)}renderHeader(){const{header:e,headerClass:t,title:s}=this.props;return N.isValidElement(e)?e:e===!1||!s?null:e?k(fe,{className:K("modal-header",t),content:e}):k("div",{className:K("modal-header",t),children:k("div",{className:"modal-title",children:s})})}renderActions(){const{actions:e,closeBtn:t}=this.props;return!t&&!e?null:N.isValidElement(e)?e:k("div",{className:"modal-actions",children:[e?k(Be,{...e}):null,t?k("button",{type:"button",class:"btn square ghost","data-dismiss":"modal",children:k("span",{class:"close"})}):null]})}renderBody(){const{body:e,bodyClass:t}=this.props;return e?N.isValidElement(e)?e:k(fe,{className:K("modal-body",t),content:e}):null}renderFooter(){const{footer:e,footerClass:t,footerActions:s}=this.props;return N.isValidElement(e)?e:e===!1||!s?null:e?k(fe,{className:K("modal-footer",t),content:e}):k("div",{className:K("modal-footer",t),children:s?k(Be,{...s}):null})}render(){const{className:e,style:t,contentClass:s,children:n,waitShowEvent:r}=this.props,o=r&&!this.state.showed;return k("div",{ref:r?this._ref:void 0,className:K("modal-dialog",e,o?"loading":""),style:t,children:[k("div",{className:K("modal-content",s),children:[this.renderHeader(),this.renderActions(),this.renderBody(),n,this.renderFooter()]}),o?k("div",{class:"load-indicator loading"}):null]})}}ug.defaultProps={closeBtn:!0};class nd extends ae{constructor(){super(...arguments),this._ref=ye(),this._height=pe(),this._timer=0,this._handleError=e=>{e.message.includes("ResizeObserver loop completed with undelivered notifications")&&this.componentWillUnmount()},this._handleIframeLoad=()=>{const e=this.iframeDoc;if(!e)return;const{iframeBodyClass:t,watchHeight:s}=this.props;s&&this._watchIframeHeight(),t&&e.body.classList.add(t),v(this._ref.current).trigger("modal-iframe-loaded")}}get iframeDoc(){var e,t;return(t=(e=this._ref.current)==null?void 0:e.contentWindow)==null?void 0:t.document}componentDidMount(){this.props.watchHeight&&this._watchIframeHeight(),window.addEventListener("error",this._handleError)}componentWillUnmount(){var e;window.removeEventListener("error",this._handleError),(e=this._rob)==null||e.disconnect(),this._timer&&clearTimeout(this._timer)}_watchIframeHeight(){const e=this.iframeDoc;if(!e)return;let t=this._rob;t==null||t.disconnect(),t=new ResizeObserver(()=>{this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{const s=e.body,n=e.documentElement,r=Math.ceil(Math.max(s.scrollHeight,s.offsetHeight,n.offsetHeight));r&&r!==this._height.value&&(this._height.value=r),this._timer=0},10)}),t.observe(e.body),this._rob=t}render(){return k("iframe",{className:"modal-iframe",style:this._height.value?`height: ${this._height.value}px;`:void 0,src:this.props.url,ref:this._ref,onLoad:this._handleIframeLoad})}}nd.defaultProps={watchHeight:!0};var id=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},gs=(i,e,t)=>(id(i,e,"read from private field"),t?t.call(i):e.get(i)),Hr=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Hi=(i,e,t,s)=>(id(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t),Va=(i,e,t)=>(id(i,e,"access private method"),t),Qs,Ur,en,Wa,rd,Ka,od;function x0(i,e){const{custom:t,title:s,content:n,closeBtn:r}=e;return{body:n,closeBtn:r,title:s,...typeof t=="function"?t():t}}async function k0(i,e){const{dataType:t="html",url:s,request:n,custom:r,title:o,replace:a=!0,executeScript:l=!0}=e,c=await v.ajax({url:s,headers:{"X-ZUI-Modal":"true"},...n});if(t!=="html")try{const h=JSON.parse(c);return{title:o,...r,...h}}catch{}return a!==!1&&t==="html"?[c]:{title:o,...r,body:t==="html"?k(Ds,{className:"modal-body",html:c,executeScript:l}):c}}async function S0(i,e){const{url:t,custom:s,title:n,size:r}=e,o=typeof r=="object"&&typeof r.height=="number";return{title:n,...s,waitShowEvent:"modal-iframe-loaded",body:k(nd,{url:t,watchHeight:!o})}}const T0={custom:x0,ajax:k0,iframe:S0},fg="loading",pg=class vi extends Bi{constructor(){super(...arguments),Hr(this,Wa),Hr(this,Ka),Hr(this,Qs,void 0),Hr(this,Ur,void 0),Hr(this,en,void 0),this._builded=!1}get id(){return gs(this,Ur)}get loading(){var e;return(e=gs(this,Qs))==null?void 0:e.classList.contains(fg)}get shown(){var e;return!!((e=gs(this,Qs))!=null&&e.classList.contains("show"))}get modalElement(){let e=gs(this,Qs);if(!e){const{options:t}=this;let s=gs(this,Ur);s||(s=t.id||`modal-${Xe()}`,Hi(this,Ur,s));const{$element:n}=this;if(e=n.find(`#${s}`)[0],e)v(e).data(this.constructor.KEY,this);else{const r=this.key;e=v("<div>").attr({id:s,"data-key":r}).data(this.constructor.KEY,this).css(t.style||{}).setClass("modal modal-async load-indicator",t.className).appendTo(n)[0]}Hi(this,Qs,e)}return e}get $emitter(){const e=gs(this,Qs);return e?v(e):this.$element}afterInit(){super.afterInit(),this.options.type==="static"?(this._staticMbo=new MutationObserver(t=>{let s=!1;for(const n of t)if(n.removedNodes.length){s=!0;break}s&&this.autoDestroy()}),this._staticMbo.observe(this.modalElement.parentNode,{childList:!0})):this.options.destroyOnHide&&this.on("hidden",t=>{v(t.target).data("key")===this.key&&this.destroy()})}autoDestroy(e=100){this._autoDestory&&clearTimeout(this._autoDestory),this._autoDestory=window.setTimeout(()=>{this._autoDestory=0,($s(this.element)||this.options.type==="static"&&$s(this.modalElement))&&this.destroy()},e)}show(e){return super.show(e)?(this.buildDialog(),!0):!1}destroy(){var t;super.destroy();const e=gs(this,Qs);e&&(v(e).removeData(this.constructor.KEY).remove(),Hi(this,Qs,void 0)),(t=this._staticMbo)==null||t.disconnect()}render(e){return super.render(e),this.buildDialog()}async buildDialog(){if(this.loading)return!1;gs(this,en)&&clearTimeout(gs(this,en));const{modalElement:e,options:t}=this,s=v(e),{type:n,loadTimeout:r,loadingClass:o=fg,loadingText:a=null,cache:l}=t;if(!n||n==="static")return!0;if(l&&this._builded)return this.layout(),!0;const c=T0[n];if(!c)return console.warn(`Modal: Cannot build modal with type "${n}"`),!1;s.attr("data-loading",a).addClass(o),r&&Hi(this,en,window.setTimeout(()=>{Hi(this,en,0),Va(this,Ka,od).call(this,this.options.timeoutTip)},r));const h=await c.call(this,e,t);return this._destroyed?!1:(h===!1?await Va(this,Ka,od).call(this,this.options.failedTip):h&&typeof h=="object"&&await Va(this,Wa,rd).call(this,h),gs(this,en)&&(clearTimeout(gs(this,en)),Hi(this,en,0)),this.layout(),this._builded=!0,await Ss(100),s.removeClass(o),!0)}static isValid(e){return!v.isDetached(e.modalElement)}static open(e){return new Promise(t=>{const{container:s=document.body,ref:n,...r}=e,o={show:!0,...r};!o.type&&o.url&&(o.type="ajax"),!o.type&&e.id&&(o.type="static"),o.key===void 0&&(o.key=o.id);const a=vi.ensure(s,o);n&&(n.current=a);const l=`${vi.NAMESPACE}.open${Xe()}`;a.on(`hidden${l}`,()=>{a.off(l),t(a)}),a.show()})}static async alert(e){typeof e=="string"&&(e={message:e});const{type:t,message:s,icon:n,iconClass:r="icon-lg muted",actions:o="confirm",onClickAction:a,custom:l,key:c="__alert",...h}=e,d=(typeof l=="function"?l():l)||{};let f=k(fe,{content:s});n?f=k("div",{className:K("modal-body row gap-4 items-center",d.bodyClass),children:[k("div",{className:`icon ${n} ${r}`}),f]}):f=k("div",{className:K("modal-body",d.bodyClass),children:f});const m=[];(Array.isArray(o)?o:o?[o]:[]).forEach(w=>{w={...typeof w=="string"?{key:w}:w},typeof w.key=="string"&&(w.text||(w.text=Pe.getLang(w.key,w.key)),w.btnType||(w.btnType=`btn-wide ${w.key==="confirm"?"primary":"btn-default"}`)),w&&m.push(w)},[]);let y;const b=m.length?{gap:4,items:m,onClickItem:({item:w,event:x})=>{const D=vi.query(x.target);if(!D||D.key!==c)return;y=w.key,(a==null?void 0:a(w,D))!==!1&&D&&D.hide()}}:void 0;return await vi.open({key:c,type:"custom",size:400,className:"modal-alert",content:f,modal:!0,backdrop:"static",hideOthers:!1,custom:{footerActions:b,...d},...h}),y}static async confirm(e){typeof e=="string"&&(e={message:e});const{onClickAction:t,onResult:s,...n}=e;return await vi.alert({actions:["confirm","cancel"],onClickAction:(o,a)=>{s==null||s(o.key==="confirm",a),t==null||t(o,a)},...n})==="confirm"}static async prompt(e){typeof e=="string"&&(e={message:e});const{defaultValue:t="",placeholder:s,onResult:n,onShown:r,message:o,content:a,bodyClass:l,custom:c,multiline:h,...d}=e;let f=t,m=!1;const y=D=>{f=D.target.value},b=ye(),w=D=>{var I,E;D.key==="Enter"?(m=!0,D.preventDefault(),(I=b.current)==null||I.hide()):D.key==="Escape"&&((E=b.current)==null||E.hide())};return await vi.confirm({...d,custom:{closeBtn:!1,...c},message:o,ref:b,content:k("div",{className:K("modal-body",l),children:[k(fe,{content:o}),h?k("textarea",{className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:s,defaultValue:t,onChange:y,onKeyDown:w,rows:10}):k("input",{type:"text",className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:s,defaultValue:t,onChange:y,onKeyDown:w}),a]})})||m?f:null}};Qs=new WeakMap,Ur=new WeakMap,en=new WeakMap,Wa=new WeakSet,rd=function(i){return new Promise(e=>{if(Array.isArray(i))return v(this.modalElement).html(i[0]).zuiInit(),this.layout(),this._observeResize(),e();const{afterRender:t,...s}=i;i={afterRender:n=>{this.layout(),t==null||t(n),this._observeResize(),e()},...s},hn(k(ug,{...i}),this.modalElement)})},Ka=new WeakSet,od=function(i){if(i)return Va(this,Wa,rd).call(this,{body:k("div",{className:"modal-load-failed",children:i})})},pg.DEFAULT={...Bi.DEFAULT,loadTimeout:1e4,destroyOnHide:!0};let Ve=pg;Ve.register();class Ui extends Ze{get modal(){return this._modal}get container(){const{container:e}=this.options;return typeof e=="string"?document.querySelector(e):e instanceof HTMLElement?e:document.body}show(){var e;return(e=this._initModal())==null?void 0:e.show()}hide(){var e;return(e=this._modal)==null?void 0:e.hide()}_getBuilderOptions(){const{container:e,...t}=this.options,s=t,n=this.$element.attr("href")||"";return s.type||(s.target||n[0]==="#"?s.type="static":s.type=s.type||(s.url||n?"ajax":"custom")),!s.url&&(s.type==="iframe"||s.type==="ajax")&&n[0]!=="#"&&(s.url=n),s.key===void 0&&(s.key=`${this._key}`),s}_initModal(){const e=this._getBuilderOptions();let t=this._modal;if(t)return t.setOptions(e),t;if(e.type==="static"){const s=this._getStaticModalElement();if(!s)return;t=Bi.ensure(s,e)}else t=Ve.ensure(this.container,e);return this._modal=t,t.on("destroyed",()=>{this._modal=void 0}),t}_getStaticModalElement(){let e=this.options.target;if(!e){const{$element:t}=this;if(t.is("a")){const s=t.attr("href");s!=null&&s.startsWith("#")&&(e=s)}}return this.container.querySelector(e||".modal")}}Ui.NAME="ModalTrigger",Ui.toggle={name:"modal",skip:"[disabled],.disabled,.open-in-parent",convertHref:!0,onGet(i){return Ui.get(i)},onCreate(i,e,t){return new Ui(i,t)}},Ui.register();const mg={zh_cn:{selectFile:"选择文件",fileSelectTip:"（不超过 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超过了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超过了总大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超过了数量 {maxFileCount} 的限制。"},zh_tw:{selectFile:"選擇文件",fileSelectTip:"（不超過 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超過了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超過了總大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超過了數量 {maxFileCount} 的限制。"},en:{selectFile:"Select File",fileSelectTip:"(Not exceeding {maxFileSize})",removeFile:"Remove File",renameFile:"Rename",duplicatedTip:"File “{name}” ({size}) already exists.",exceededSizeTip:"File “{name}” ({size}) exceeds the limit of {maxFileSize}.",exceededTotalSizeTip:"File “{name}” ({size}) exceeds the total size limit of {totalFileSize}.",exceededCountTip:"File “{name}” ({size}) exceeds the limit of {maxFileCount}."}};let bn=class extends Ke{constructor(e){if(e.totalFileSize)if(e.maxFileSize){const{maxFileSize:t,totalFileSize:s}=e,n=typeof t=="number"?t:ks(t),r=typeof s=="number"?s:ks(s);e.maxFileSize=n>r?s:t}else e.maxFileSize=e.totalFileSize;e.maxFileSize||(e.maxFileSize="100MB"),super(e),this._input=ye(),this._file=ye(),this._id=`file-selector-input-${Xe()}`,this._data=new DataTransfer,this.stopRenameFile=()=>{const{renaming:t,newName:s}=this.state;this.cancelRenameFile(),!(!t||!s)&&this.renameFile(t,s)},this.cancelRenameFile=()=>{this.setState({renaming:""})},this._handleChange=t=>{const s=t.target;s.files&&(this.selectFiles(s.files),this.setState({inputKey:Xe()}))},this._handleDragOver=t=>{t.preventDefault(),this.state.dragging||this.setState({dragging:!0})},this._handleDragLeave=t=>{t.preventDefault(),this.setState({dragging:!1})},this._handleDrop=t=>{this._handleDragLeave(t);const s=t.dataTransfer;if(!s)return;const n=[];if(s.items)for(const o of s.items){if(o.kind==="file"&&o.webkitGetAsEntry){const l=o.webkitGetAsEntry();if(l&&l.isDirectory)continue}const a=o.getAsFile();a&&n.push(a)}else n.push(...Array.from(s.files||[]));const r=this.constructor.filterFiles(n,this.props.accept);r.length&&(this.selectFiles(r),this.setState({inputKey:Xe()}))},this._handleRenameChange=t=>{this.setState({newName:t.target.value})},this._handleClick=t=>{if(this.props.disabled)return;const n=v(t.target).closest("[data-remove-file],[data-rename-file]");if(!n.length)return;const r=n.data();r.renameFile?this.startRenameFile(String(r.renameFile)):r.removeFile&&this.removeFile(String(r.removeFile))},this.state={files:(e.defaultFiles||[]).map(t=>this.constructor.getInfo(t)),inputKey:0}}get size(){return this.state.files.reduce((e,t)=>e+t.size,0)}get count(){return this.state.files.length}get multiple(){const{multiple:e,maxFileCount:t,name:s=""}=this.props;return!!(t!==1&&(e??s.endsWith("[]")))}get info(){const{maxFileSize:e=0,maxFileCount:t=Number.MAX_SAFE_INTEGER}=this.props;return{size:pt(this.size,1),maxFileSize:pt(typeof e=="string"?ks(e):e,1),maxFileCount:t,count:this.count}}get files(){return this._data.files}componentDidMount(){const e=this.state.files.reduce((t,s)=>(s.file&&t.push(s.file),t),[]);e.length&&(e.forEach(t=>this._data.items.add(t)),this._syncFiles())}getFile(e){return this.state.files.find(t=>t.id===e)}getFileByName(e){return this.state.files.find(t=>t.name===e)}select(){var e;(e=this._input.current)==null||e.click()}async selectFiles(e){var t;if(((t=this.props.onSelect)==null?void 0:t.call(this,e))!==!1){this._skipAddMore=!1;for(const s of e)if(await this.addFile(s),this._skipAddMore)break}}async _checkDuplicated(e){const{allowSameName:t,onDuplicated:s,duplicatedTip:n=this.i18n("duplicatedTip")}=this.props,{name:r}=e,o=t?this.getFile(e.id):this.getFileByName(r);return o?((s==null?void 0:s.call(this,r,e,o))===!0||n&&await this._showAlert(n,{name:r,size:pt(e.size,1)}),!0):!1}async _checkExceededSize(e){const{maxFileSize:t,onExceededSize:s,exceededSizeTip:n=this.i18n("exceededSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?ks(t):t;return e.size<=r?!1:((s==null?void 0:s.call(this,r,e))===!0||n&&await this._showAlert(n,{name:e.name,size:pt(e.size,1),maxFileSize:t}),!0)}async _checkTotalSize(e){const{totalFileSize:t,onExceededTotalSize:s,exceededTotalSizeTip:n=this.i18n("exceededTotalSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?ks(t):t,o=e.size+this.size;return o<=r?!1:((s==null?void 0:s.call(this,r,e))===!0||n&&await this._showAlert(n,{name:e.name,size:pt(e.size,1),totalSize:pt(o,1)}),!0)}async _checkExceededCount(e){const{maxFileCount:t=0,onExceededCount:s,exceededCountTip:n=this.i18n("exceededCountTip")}=this.props;if(!t)return!1;const r=this.count+1;return r<=t?!1:((s==null?void 0:s.call(this,t,e))===!0||n&&await this._showAlert(n,{name:e.name,size:pt(e.size,1),exceededCount:r}),!0)}async addFile(e){const{onAdd:t,disabled:s}=this.props;if(s)return!1;const n=this.constructor.getInfo(e);return await this._checkExceededCount(n)?(this._skipAddMore=!0,!1):await this._checkDuplicated(n)?!1:await this._checkExceededSize(n)?(this._skipAddMore=!0,!1):await this._checkTotalSize(n)?(this._skipAddMore=!0,!1):t&&t.call(this,n)===!1?!1:(this._data.items.add(e),this._syncFiles(!0),await this.changeState(c=>({files:[...c.files,n]})),!0)}startRenameFile(e){this.setState({renaming:e,newName:void 0},()=>{const t=v(this._file.current).closest(".file-selector").find(".file-selector-rename-input")[0];t&&(t.select(),t.focus())})}replaceFileName(e,t){const s=e.file;if(!s)return;const n=new File([s],t,{type:s.type,lastModified:s.lastModified}),r=Array.from(this._data.files).indexOf(s);return r>=0&&this._data.items.remove(r),this._data.items.add(n),e.file=n,this._syncFiles(!0),n}async renameFile(e,t){const s=this.getFile(e);if(!s||s.name===t)return;const{onRename:n}=this.props;if(n&&await n.call(this,t,s.name,s)===!1)return;const{files:r,renamedFiles:o={}}=this.state;s.file?this.replaceFileName(s,t):o[s.id]=t,s.name=t,s.ext=this.constructor.getExt(t);const a=r.indexOf(s);a>=0?r.splice(a,1,s):r.push(s),this.setState({files:[...r],renamedFiles:{...o}})}async removeFile(e){const t=this.getFile(e);if(!t)return;const{onRemove:s,removeConfirm:n}=this.props;if(n){let c=n;if(typeof c=="string"&&(c={message:c}),typeof c.message=="string"&&(c.message=$e(c.message,{name:t.name,size:pt(t.size,1)})),!await Ve.confirm(c))return}if(s&&await s.call(this,t)===!1)return;if(t.file){const c=Array.from(this._data.files).indexOf(t.file);c>=0&&this._data.items.remove(c)}const{files:r,deletedFiles:o=[],renamedFiles:a={}}=this.state,l=r.indexOf(t);l>=0&&(!t.file&&!o.includes(t.id)&&(delete a[t.id],o.push(t.id)),r.splice(l,1),this.setState({files:[...r],deletedFiles:[...o],renamedFiles:{...a}}),this._syncFiles(!0))}_syncFiles(e=!1){const t=this._data.files,s=this._file.current;s.files=t,e&&v(s).trigger("change",{files:t})}_showAlert(e,t){return typeof e=="string"&&(e={message:e}),typeof e.message=="string"&&(e.message=$e(e.message,{...this.info,...t})),Ve.alert(e)}_getTip(e){return typeof e=="string"?$e(e,this.info):e}_renderInput(e){return k("input",{id:this._id,multiple:this.multiple,accept:e.accept,style:"display:none",type:"file",ref:this._input,onChange:this._handleChange},`input${this.state.inputKey}`)}_getDraggableProps(){const e={};return this.props.draggable&&!this.props.disabled&&(e.onDragOver=this._handleDragOver,e.onDragLeave=this._handleDragLeave,e.onDrop=this._handleDrop),e}_renderUpload(e){const{mode:t,disabled:s,tip:n=this.i18n("fileSelectTip"),uploadBtn:r}=e,o=Le({component:"label",attrs:{for:s?void 0:this._id},disabled:s,text:this.i18n("selectFile")},typeof r=="object"?r:typeof r=="string"?{text:r}:{}),a=k("div",{className:"file-selector-tip",children:k(fe,{content:this._getTip(n),generatorThis:this,generatorArgs:[this.state]})}),l=t==="grid",c=l?{}:this._getDraggableProps();return l||t==="box"?k(we,{...o,...c,className:K(l?"file-selector-grid-btn":"file-selector-box",o.className),children:a},"upload"):k("div",{className:"file-selector-btn",...c,children:[k(we,{rounded:"full",size:"sm",...o}),a]},"upload")}_renderForForm(e){const{name:t,accept:s,onChange:n,deleteName:r,renameName:o}=e,{deletedFiles:a,renamedFiles:l}=this.state,c=[k("input",{ref:this._file,type:"file",name:t,multiple:this.multiple,accept:s,style:"display:none",onChange:n},"form")];return r&&a&&c.push(...a.map(h=>k("input",{type:"hidden",name:`${r}[${h}]`,value:h},`delete:${h}`))),o&&l&&c.push(...Object.entries(l).map(([h,d])=>k("input",{type:"hidden",name:`${o}[${h}]`,value:d},`rename:${h}`))),c}_getIcon(e){let{fileIcons:t}=this.props;if(t)return typeof t=="string"&&(t={default:t}),t[e.ext]??t.default}_getThumbnail(e){if((e.file||e.url)&&this.props.thumbnail&&this.constructor.isImage(e))return e.url||URL.createObjectURL(e.file)}_getAvatar(e){const t=this._getThumbnail(e);let s;if(t)s={src:t};else{const n=this._getIcon(e);n&&(s={icon:n})}return s&&{size:this.props.mode==="grid"?void 0:"sm",...s}}_getFileActions(e){if(this.props.disabled)return;let{removeBtn:t,renameBtn:s}=this.props;typeof t=="function"&&(t=t.call(this,e)),typeof t=="string"?t={text:t}:t===!0&&(t={hint:this.i18n("removeFile"),icon:"trash"}),typeof s=="function"&&(s=s.call(this,e)),typeof s=="string"?s={text:s}:s===!0&&(s={hint:this.i18n("renameFile"),icon:"edit"});const n=[];return s&&n.push({"data-rename-file":e.id,...s}),t&&n.push({"data-remove-file":e.id,...t}),n}_renderFile(e){const{itemProps:t}=this.props,s=Le({className:this.props.mode==="grid"?"file-selector-grid-item":"file-selector-item",multiline:!1,title:e.name,subtitle:pt(e.size,1),avatar:this._getAvatar(e),actions:this._getFileActions(e),"z-id":e.id},typeof t=="function"?t.call(this,e):t);return k(Is,{...s},e.id)}_renderFileRename(e){const{itemProps:t}=this.props,{newName:s=e.name}=this.state,n=this.props.mode==="grid",r=k("div",{className:"file-selector-rename-text",children:[k("div",{className:"form-control size-sm",children:s}),k("input",{type:"text",defaultValue:e.name,className:"form-control size-sm select-all file-selector-rename-input",autofocus:!0,onBlur:n?this.stopRenameFile:void 0,onChange:this._handleRenameChange,onInput:this._handleRenameChange})]}),o=Le({className:`${n?"file-selector-grid-item":"file-selector-item"} is-renaming`,multiline:!1,avatar:this._getAvatar(e),"z-id":e.id,contentClass:"file-selector-rename",content:n?r:[r,k(we,{icon:"check",text:this.i18n("confirm"),type:"primary-pale",size:"sm",onClick:this.stopRenameFile}),k(we,{icon:"close",text:this.i18n("cancel"),type:"gray-pale",size:"sm",onClick:this.cancelRenameFile})]},typeof t=="function"?t.call(this,e):t);return k(Is,{...o},e.id)}_renderList(e){const{files:t,renaming:s}=this.state;return k("div",{className:`file-selector-list${t.length?"":" is-empty"}`,onClick:this._handleClick,children:t.map(n=>n.id===s?this._renderFileRename(n):this._renderFile(n))},"list")}_renderGrid(e){const t=this._getDraggableProps(),{gridWidth:s=120,gridHeight:n=148,gridGap:r=12}=e,o={"--file-selector-grid-width":je(s),"--file-selector-grid-height":je(n),"--file-selector-grid-gap":je(r)},{files:a,renaming:l}=this.state;return k("div",{className:"file-selector-grid",style:o,onClick:this._handleClick,...t,children:[a.map(c=>c.id===l?this._renderFileRename(c):this._renderFile(c)),this._renderUpload(e)]},"grid")}_getClassName(e){return["file-selector",`is-mode-${e.mode}`,e.className,this.state.dragging?"is-dragging":""]}_getChildren(e){const t=e.mode==="grid";return[t?null:this._renderUpload(e),t?this._renderGrid(e):this._renderList(e),this._renderInput(e),this._renderForForm(e)]}static getExt(e){return(e.split(".").pop()||"").toLowerCase()}static getInfo(e){const{name:t,size:s,type:n}=e;if(e instanceof File)return{name:t,size:s,type:n,file:e,id:[t,s].join(":"),ext:this.getExt(t)};const r=typeof s=="string"?ks(s):s;return{name:t,size:r,id:e.id?String(e.id):[t,r].join(":"),type:n??"",ext:this.getExt(t),file:e.file,url:e.url}}static isAccept(e,t){return!t||!t.length?!0:(Array.isArray(t)?t:t.split(",")).some(n=>e.type&&n===e.type?!0:n.startsWith(".")?e.name.endsWith(n):n.endsWith("/*")?e.type.startsWith(n.slice(0,-1)):!1)}static isImage(e){return this.isAccept(e,this.imageAccepts)}static filterFiles(e,t){if(!t||!t.length)return e;e instanceof FileList&&(e=Array.from(e));const s=t.split(",");return e.filter(n=>n.type===""&&!n.size&&!n.name.includes(".")?!1:this.isAccept(n,s))}};bn.defaultProps={mode:"button",fileIcons:"file",renameBtn:!0,removeBtn:!0,draggable:!0,thumbnail:!0,maxFileCount:0},bn.i18n=mg,bn.imageAccepts="image/*,.png,.jpg,.jpeg,.gif";let ad=class extends bn{};ad.defaultProps={...bn.defaultProps,mode:"grid",accept:bn.imageAccepts};const $0=Object.freeze(Object.defineProperty({__proto__:null,FileSelector:bn,ImageSelector:ad},Symbol.toStringTag,{value:"Module"}));class qa extends be{}qa.NAME="FileSelector",qa.Component=bn,qa.replace=!0;class Ga extends be{}Ga.NAME="ImageSelector",Ga.Component=ad,Ga.replace=!0,ot($0);const j$="";class ld extends ae{constructor(e){super(e),this._searchInput=ye(),this._measure=ye(),this._changeTimer=0,this._handleChange=t=>{if(t.isComposing)return;const s=t.target.value;this.setState({search:s},()=>{const{onSearch:n}=this.props;n&&(this._changeTimer&&clearTimeout(this._changeTimer),this._changeTimer=window.setTimeout(()=>{this._changeTimer=0,n(s)},this.props.debounce||300))}),t.stopPropagation()},this._handleClear=t=>{t.stopPropagation(),this.clear()},this.state={search:e.defaultSearch??""}}get $pop(){return v(`#pick-pop-${this.props.id}`)}focus(){var e;(e=this._searchInput.current)==null||e.focus()}setSearch(e,t=!0){var n,r,o,a;if(!e.length&&this.state.search.length&&((r=(n=this.props).onClear)==null||r.call(n)),((o=this._searchInput.current)==null?void 0:o.value)===e){t&&this.focus();return}v((a=this._searchInput)==null?void 0:a.current).val(e).trigger("change"),t&&this.focus()}clear(){this.setSearch("")}componentDidMount(){this.focus();const{hotkeys:e}=this.props;if(e){const t=Qc(e,{clear:{keys:"Escape",handler:()=>{this.state.search.trim().length?this.clear():this.$pop.trigger("hidePop")}},enter:{keys:"Enter",handler:s=>{s.preventDefault(),this.$pop.trigger("selectActive"),this.clear()}},activeNext:{keys:"ArrowDown",handler:()=>{this.$pop.trigger("activeNext")}},activePrev:{keys:"ArrowUp",handler:()=>{this.$pop.trigger("activePrev")}},deselectLast:{keys:"Backspace",handler:()=>{this.state.search.trim().length||this.$pop.trigger("deselectLast")}}});t&&(this._hotkeysScope=`PickerSearch_${Xe()}`,v(this._searchInput.current).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}v(this._searchInput.current).on("compositionend",this._handleChange)}componentDidUpdate(){const{inline:e}=this.props;if(e){const{current:t}=this._measure,{current:s}=this._searchInput;if(t&&s){const n=v(s).parent();n.width(Math.ceil(Math.min(t.clientWidth,n.closest(".picker").outerWidth()-32)))}}}componentWillUnmount(){clearTimeout(this._changeTimer),this._hotkeysScope&&v(this._searchInput.current).unbindHotkeys(this._hotkeysScope),v(this._searchInput.current).off("compositionend",this._handleChange)}render(e,t){const{placeholder:s,inline:n}=e,{search:r}=t,o=r.trim().length>0;let a;return n?a=k("div",{className:"picker-search-measure",ref:this._measure,children:r}):o?a=k("button",{type:"button",className:"btn picker-search-clear square size-sm ghost",onClick:this._handleClear,children:k("span",{className:"close"})}):a=k("span",{className:"magnifier"}),k("div",{className:`picker-search${n?" is-inline":""}`,children:[k("input",{className:"form-control picker-search-input",type:"text",placeholder:s,value:r,autoComplete:"off",onChange:this._handleChange,onInput:this._handleChange,ref:this._searchInput}),a]})}}class gg extends Ia{constructor(){super(...arguments),this._search=ye(),this._handleDeselectClick=e=>{const{onDeselect:t,state:{selections:s}}=this.props,n=v(e.target).closest(".picker-deselect-btn").attr("data-value");t&&s.length&&typeof n=="string"&&t(n),e.stopPropagation()},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})},this._renderSelection=e=>{const{text:t}=e;return k("div",{className:"picker-multi-selection",title:typeof t=="string"?t:void 0,children:[k("span",{className:"text",children:k(fe,{content:t})}),this.props.disabled||this.props.readonly?null:k("div",{className:"picker-deselect-btn btn size-xs ghost",onClick:this._handleDeselectClick,"data-value":e.value,children:k("span",{className:"close"})})]},e.value)}}get searchBox(){return this._search.current}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return K(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-multi form-control")}_renderSearch(e){const{state:{search:t},searchHint:s,hotkeys:n}=e;return k(ld,{inline:!0,id:e.id,ref:this._search,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:s,hotkeys:n})}_renderTrigger(e){const{state:{selections:t=[],open:s,value:n},search:r,placeholder:o,display:a,valueList:l,children:c,caretClass:h}=this.props,d=s&&r;let f;const m=!d&&!t.length;return a&&(!m||o===void 0)?(typeof a=="function"?f=a.call(this,l,t):typeof a=="string"&&(f=$e(a,{value:n,values:l,count:l.length})),f=k("div",{className:"picker-multi-selections",children:f},"selections")):m?f=k("span",{className:"picker-select-placeholder",children:o},"selections"):f=k("div",{className:"picker-multi-selections",children:[t.map(this._renderSelection),d?this._renderSearch(e):null]},"selections"),[f,c,k("span",{class:K("caret",h)},"caret")]}_renderValue(e){const{name:t,state:{value:s=""},disabled:n,id:r,valueList:o,emptyValue:a,onRenderValue:l}=e;if(l)return l(o,e);if(t)if(this.hasInput)v(`#${r}`).val(s);else{const c=o.length?o:[a];return k("select",{id:r,multiple:!0,className:"pick-value",name:t.endsWith("[]")?t:`${t}[]`,disabled:n,style:{display:"none"},children:c.map(h=>k("option",{value:h,children:h},h))})}return null}componentDidMount(){super.componentDidMount();const{id:e,valueList:t,emptyValue:s}=this.props;v(`#${e}`).val(t.length?t:[s])}componentDidUpdate(e){const{id:t,state:s,name:n,valueList:r,emptyValue:o}=this.props;if(n&&e.state.value!==s.value){const a=v(`#${t}`).val(r.length?r:[o]);this._skipTriggerChange!==s.value&&a.trigger("change",Fm),this._skipTriggerChange=!1}}}class yg extends Ia{constructor(){super(...arguments),this._search=ye(),this._handleDeselectClick=e=>{this.props.disabled||(this.props.onClear(),e.stopPropagation())},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})}}get searchBox(){return this._search.current}_getSearchPlaceholder(){const{searchHint:e,state:{value:t,selections:s}}=this.props;let n=e;if(n===void 0){const r=s.find(o=>o.value===t);r&&typeof r.text=="string"&&(n=r.text)}return n}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return K(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-single form-control")}_renderSearch(e){const{state:{search:t},hotkeys:s}=e;return k(ld,{ref:this._search,id:e.id,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:this._getSearchPlaceholder(),hotkeys:s})}_renderTrigger(e){const{children:t,state:{selections:s=[],value:n,open:r},placeholder:o,search:a,disabled:l,clearable:c,display:h,caretClass:d}=e,[f]=s,m=r&&a;let y;if(m)y=this._renderSearch(e);else if(f||o===void 0&&h){const{text:x}=f||{text:"",value:""};typeof h=="function"?y=h.call(this,n,s):typeof h=="string"?y=$e(h,f):y=k(fe,{content:x}),y=k("span",{className:"picker-single-selection",title:typeof x=="string"?x:void 0,children:y},"main")}else y=k("span",{className:"picker-select-placeholder",children:o},"main");const b=c&&!m?k("button",{type:"button",className:"btn picker-deselect-btn size-xs square ghost",disabled:l,onClick:this._handleDeselectClick,children:k("span",{className:"close"})},"deselect"):null,w=m?null:k("span",{className:K("caret flex-none",d)},"caret");return[y,t,b,w]}}function vg(i,e){return i.reduce((t,s)=>(Array.isArray(s.items)&&vg(s.items,t),typeof s.value=="string"&&t.set(s.value,s),t),e||new Map)}class _g extends ed{constructor(){super(...arguments),this._menu=ye(),this._disabledSet=new Set,this._getItem=(e,t)=>{var c;if(e.parentKey!==void 0)return e;const s=new Set(this.props.valueList);let n=e.items,r=!1,o=!1;Array.isArray(n)&&this.props.multiple&&!this.props.noNestedPick&&(r=!0,n=n.reduce((h,d,f)=>{const m=this._getItem(d,f);return m&&(m.selected?o=!0:r=!1,h.push(m)),h},[]));const a=r||s.has(e.value);e={selected:a,hint:typeof e.text=="string"?e.text:void 0,...e,checked:this._hasCheckbox||typeof e.checked=="boolean"?r?!0:o?"indeterminate":a:void 0,className:K(e.className,{hover:e.value!==void 0&&e.value===this.props.state.hoverItem}),items:n},e.content&&e.text&&delete e.text,this.props.getItem&&(e=this.props.getItem(e,t));const l=((c=this._getItemCallback)==null?void 0:c.call(this,e,t))??e;return l&&((l.disabled||l.value===void 0)&&(l.hover===void 0&&(l.hover=!1),l.disabled===void 0&&(l.disabled=!0),this._disabledSet.add(l.value)),a&&!l.disabled&&l.value!==void 0&&this._firstSelected===void 0&&(this._firstSelected=l.value),l)},this._beforeRenderItem=(e,t)=>{var s;return(s=this._renderItemCallback)==null?void 0:s.call(this,e,t)},this._handleItemClick=({item:e,event:t})=>{const s=e.value,n=t.target;if(e.disabled||s===void 0||n.closest(".item-icon,.nested-toggle-icon,.disabled")||Array.isArray(e.items)&&e.items.every(l=>this._disabledSet.has(l.value)))return;const{multiple:r,onPick:o,noNestedPick:a}=this.props;if(r)if(e.items&&!a){const c=[...vg(e.items).values()].filter(h=>!h.items&&!this._disabledSet.has(h.value)).map(h=>h.value);v(n).closest(".item").children(".item-inner.selected").length?o({diselect:c}):o({select:c})}else o({toggle:s});else o({select:s})}}get menu(){return this._menu.current}get picker(){return this.props.picker}componentDidMount(){var e,t;super.componentDidMount(),this._firstSelected===void 0?(e=this.menu)==null||e.activeNext():(t=this.menu)==null||t.toggleActive(this._firstSelected,!0),v(this.element).on("activeNext.zui.Picker",()=>{var s;(s=this.menu)==null||s.activeNext()}).on("activePrev.zui.Picker",()=>{var s;(s=this.menu)==null||s.activePrev()}).on("selectActive.zui.Picker",()=>{const s=this.menu;if(!s)return;const n=s.getActiveKey();if(n!==void 0){const r=s.getRenderedItem(n);r&&v(this.element).find(`.item[z-key-path="${r._keyPath}"]`).trigger("click")}}).on("hidePop.zui.Picker",()=>{this.props.togglePop(!1)}).on("deselectLast.zui.Picker",()=>{if(this.props.multiple){const{valueList:s}=this.props,n=s[s.length-1];n&&this.props.onDeselect(n)}}),setTimeout(()=>{var s;v((s=this.menu)==null?void 0:s.element).find(".menu-item>.selected").scrollIntoView({block:"center"})},100)}componentWillUnmount(){super.componentWillUnmount(),v(this.element).off(".zui.Picker")}_getClass(e){return K(super._getClass(e),"picker-menu")}_getMenuProps(e){const{menu:t,tree:s,state:n,checkbox:r,header:o,footer:a,noMatchHint:l,maxItemsCount:c,exceedLimitHint:h}=e,{items:d,search:f}=n;return Le({ref:this._menu,className:"picker-menu-list",underlineKeys:!0,limit:c,items:d,defaultNestedShow:!0,activeOnHover:!0,search:f,exceedLimitHint:h,onClickItem:this._handleItemClick,nestedToggle:".nested-toggle-icon,.item-icon",checkbox:r,searchProps:["keys","text","title","subtitle","value"],header:o,footer:a,noMatchHint:l,relativeTarget:this},t,s)}_renderHeader(){return null}_renderFooter(){return null}_renderPop(e){const{tree:t}=e;this._firstSelected=void 0,this._disabledSet.clear();const s=this._getMenuProps(e);return this._hasCheckbox=!!s.checkbox,this._getItemCallback=s.getItem,this._renderItemCallback=s.beforeRenderItem,s.getItem=this._getItem,s.beforeRenderItem=this._beforeRenderItem,t?k(Kn,{...s}):k(dt,{...s})}}function Jn(i,e){return i.reduce((t,s)=>(Array.isArray(s.items)&&Jn(s.items,t),t.set(s.value===void 0?"":String(s.value),s),t),e||new Map)}const Za=class _i extends at{constructor(e){super(e),this._updateTimer=0,this.toggleValue=(t,s)=>{if(!this.props.multiple)return s||t!==this.value?this.setValue(t):this.setValue();const{valueList:n}=this,r=n.indexOf(t);if(s!==r>=0)return r>-1?n.splice(r,1):n.push(t),this.setValue(n)},this.deselect=(t=[])=>{const{valueList:s}=this,n=new Set(this.formatValueList(t)),r=s.filter(o=>!n.has(o));this.setValue(r)},this.clear=()=>{this.setValue()},this.select=t=>{const s=this.formatValueList(t),n=this.props.multiple?[...this.valueList,...s]:s[0];return this.setValue(n)},this.isSelected=t=>this.valueList.includes(t),this._handlePickValue=t=>{var o,a;const{toggle:s,select:n,diselect:r}=t;s!==void 0?this.toggleValue(s):n!==void 0?this.select(n):r!==void 0&&this.deselect(r),this.props.multiple?this.props.clearSearchOnSelect&&((o=this.state.search)!=null&&o.length)&&this.focusSearch(""):(this.toggle(!1),(a=this.searchBox)==null||a.clear())},this._getMenuItem=t=>{var s;return(s=this._sharedValueSet)!=null&&s.has(t.value)&&(t.disabled=!0),t},this.setValue=this.setValue.bind(this),this.isEmptyValue=this.isEmptyValue.bind(this)}get valueList(){if(this.props.multiple)return this.formatValueList(this.state.value);const e=this.state.value;return this.isEmptyValue(e)?[]:[e]}get firstEmptyValue(){return this._emptyValueSet.values().next().value}get searchBox(){var e;return(e=this.trigger)==null?void 0:e.searchBox}get value(){return this.props.value??this.state.value}focusSearch(e){const{searchBox:t}=this;t&&(typeof e=="string"?t.setSearch(e):t.focus())}getDefaultState(e){const{items:t,valueSplitter:s=",",emptyValue:n=""}=e||this.props,r={...super.getDefaultState(e),loading:!1,search:"",items:Array.isArray(t)?t:[],selections:[]};if(this._emptyValueSet=new Set(typeof n=="string"?n.split(s):[]),Array.isArray(t)&&t.length){const{limitValueInList:o,required:a,multiple:l}=this.props;if(t.forEach(c=>{typeof c.value=="number"&&(c.value=String(c.value))}),o){const c=Jn(t);r.value=this.formatValueList(r.value,s).filter(h=>c.has(h)).join(s),a&&!l&&!this.formatValueList(r.value,s).length&&(r.value=t[0].value??"")}}return r}isEmptyValue(e){return this._emptyValueSet.has(e)}deselectAll(){this.setValue([])}selectAll(){const{items:e}=this.state;if(!Array.isArray(e))return;const s=[...Jn(e).values()].reduce((n,r)=>(!r.disabled&&!r.items&&n.push(r.value),n),[]);return this.select(s)}isSelectedAll(){const{items:e}=this.state;if(!Array.isArray(e))return!1;const t=Jn(e),s=new Set(this.valueList);return[...t.values()].every(n=>n.disabled||s.has(n.value))}async load(){let e=this._abort;e&&e.abort();const{items:t=[],searchDelay:s}=this.props,{search:n=""}=this.state;let r=[];if(Array.isArray(t))r=t;else{if(e=new AbortController,this._abort=e,await Ss(s||500),this._abort!==e)return r;let o=t;if(typeof o=="string"&&(o={url:o}),typeof o=="object"&&o.url&&(o={...o,url:$e(o.url,{search:encodeURIComponent(n)})}),r=await Ne(o,[this,n],{signal:e.signal}),this._abort!==e)return r}return this._abort=void 0,r}changeState(e,t){return super.changeState(s=>{const n=typeof e=="function"?e(s):e;if(n.value!==void 0&&n.value!==s.value||n.items&&n.items!==s.items){const r=n.items||s.items,o=new Map;Array.isArray(s.items)&&s.items!==n.items&&Jn(s.items,o),Array.isArray(r)&&(Jn(r,o),n.selections=this.formatValueList(n.value??s.value).reduce((a,l)=>(this.isEmptyValue(l)||a.push(o.get(l)||{value:l,text:l}),a),[]))}return n},t)}async update(e){const{state:t,props:s}=this,n=this._itemsCacheInfo||{},r={};if(this._itemsCacheInfo=n,!t.loading&&(e||n.search!==t.search||s.items!==n.items)){await this.changeState({loading:!0});let a=await this.load();const l=c=>c.filter(h=>(h.key=h.key??h.value,typeof h.value=="number"&&(h.value=String(h.value)),this.isEmptyValue(h.value)?!1:(Array.isArray(h.items)&&(h.items=l(h.items)),!0)));a=l(a),r.loading=!1,r.items=a,n.items=s.items,n.search=t.search}else n.items&&!t.open&&s.cache===!1&&!Array.isArray(s.items)&&(n.items=void 0);(e||n.value!==t.value)&&(n.value=t.value);const o=r.items;s.limitValueInList&&s.required&&!s.multiple&&this.isEmptyValue(this.state.value)&&Array.isArray(o)&&o.length&&(r.value=o[0].value),Object.keys(r).length&&await this.changeState(r)}async tryUpdate(){this._updateTimer&&clearTimeout(this._updateTimer),this._updateTimer=window.setTimeout(()=>{this._updateTimer=0,this.update()},50)}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.tryUpdate()}componentDidMount(){super.componentDidMount(),this.tryUpdate();const{shareSelections:e}=this.props;if(e){const t=_i.sharedPickers.get(e)||new Set;t.add(this),_i.sharedPickers.set(e,t)}}componentWillUnmount(){var t;(t=this._abort)==null||t.abort(),this._abort=void 0,this._itemsCacheInfo=void 0,clearTimeout(this._updateTimer);const{shareSelections:e}=this.props;if(e){const s=_i.sharedPickers.get(e)||new Set;s.delete(this),s.size||_i.sharedPickers.delete(e)}super.componentWillUnmount()}_handleChange(e,t){if(super._handleChange(e,t),e!==t){const{onDeselect:s,onSelect:n,onClear:r,multiple:o}=this.props,a=this.formatValueList(t),l=this.valueList;if(r&&!l.length&&a.length&&r.call(this),s){const c=a.filter(h=>!l.includes(h));c.length&&s.call(this,o?c:c[0])}if(n){const c=l.filter(h=>!a.includes(h));c.length&&n.call(this,o?c:c[0])}}}_getTriggerProps(e,t){return{...super._getTriggerProps(e,t),multiple:e.multiple,hotkeys:e.hotkeys,placeholder:e.placeholder,search:e.search,display:e.display,searchHint:e.searchHint,caretClass:e.caretClass,clearable:!!this.valueList.length&&!e.required,valueList:this.valueList,emptyValue:this.firstEmptyValue,onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue}}_getPopProps(e,t){return e.shareSelections&&(this._sharedValueSet=_i.getSharedSelections(e.shareSelections)),{...super._getPopProps(e,t),picker:this,menu:e.menu,tree:e.tree,getItem:e.shareSelections?this._getMenuItem:void 0,checkbox:e.checkbox,multiple:e.multiple,search:e.search,maxItemsCount:e.maxItemsCount,noNestedPick:e.noNestedPick,footer:this._renderToolbar(),valueList:this.valueList,noFlipAfterShow:!0,noMatchHint:t.loading?Pe.getLang("loadingHint"):e.searchEmptyHint??Pe.getLang("searchEmptyHint"),exceedLimitHint:e.exceedLimitHint??Pe.getLang("exceedLimitHint"),onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue,onPick:this._handlePickValue}}_getTrigger(e){return e.Trigger||(e.multiple?gg:yg)}_renderToolbar(){let{toolbar:e}=this.props;return e?(e===!0&&(e=[{key:"selectAll",text:Pe.getLang("selectAll")},{key:"cancelSelect",text:Pe.getLang("cancelSelect")}]),Be.render(e,[],{size:"sm",relativeTarget:this,getItem:t=>(t.onClick||(t.key==="selectAll"?(t.onClick=this.selectAll.bind(this),t.disabled=this.isSelectedAll()):t.key==="cancelSelect"&&(t.onClick=this.deselectAll.bind(this),t.disabled=!this.valueList.length)),t)},this)):null}formatValueList(e,t){let s;return typeof e=="string"&&e.length?s=e.split(t??this.props.valueSplitter??","):Array.isArray(e)?s=e:s=[e],v.unique(s).reduce((n,r)=>(r==null||(r=typeof r!="string"?String(r):r,this.isEmptyValue(r)||n.push(r)),n),[])}formatValue(e){const t=this.formatValueList(e);return t.length?t.join(this.props.valueSplitter??","):this.firstEmptyValue}setValue(e=[],t){let s=this.formatValueList(e);if(s.length){const{items:r,limitValueInList:o}=this.props;if(o){const a=Jn(Array.isArray(r)?r:this.state.items);s=s.filter(l=>a.has(l))}}const n=this.formatValue(s);return super.setValue(n,t)}static getSharedSelections(e){const t=new Set;return(_i.sharedPickers.get(e)||new Set).forEach(n=>{n.valueList.forEach(r=>t.add(r))}),t}};Za.defaultProps={...at.defaultProps,className:"picker",valueSplitter:",",limitValueInList:!0,search:!0,emptyValue:"",cache:!0,hotkeys:!0,clearSearchOnSelect:!0},Za.Pop=_g,Za.sharedPickers=new Map;let Gt=Za;const D0=Object.freeze(Object.defineProperty({__proto__:null,Picker:Gt,PickerMenu:_g,PickerMultiSelect:gg,PickerSearch:ld,PickerSingleSelect:yg},Symbol.toStringTag,{value:"Module"}));class I0 extends ae{constructor(e){super(e),this._handleChange=t=>{const{onChange:s}=this.props,n=Array.from(t.target.selectedOptions).map(o=>o.value),r=this.props.multiple?n:n[0];this.setState({value:r}),s&&s(r,t)},this.state={value:e.value??e.defaultValue??(e.multiple?[]:"")}}get value(){return this.state.value}componentDidUpdate(e){e.value!==this.props.value&&this.setState({value:this.props.value??this.props.defaultValue??(this.props.multiple?[]:"")})}render(e){const{items:t=[],className:s,value:n,defaultValue:r,multiple:o,placeholder:a,onChange:l,...c}=e,{value:h}=this.state,d=new Set(o?h:[h]);let f=!1;const m=t.map(y=>{const b=d.has(y.value);return b&&(f=!0),k("option",{value:y.value,selected:b,children:y.text},y.value)});return k("select",{className:K("form-control",s),multiple:o,onChange:this._handleChange,...c,children:[f&&!o?null:k("option",{value:"",children:a}),m]})}}class M0 extends ae{constructor(e){super(e),this._handleChange=t=>{const{onChange:s,type:n}=this.props,r=t.target.value;s&&s(n==="number"?+r:r,t)},this._controlled=e.value!==void 0}get value(){return this.base.value}render(e){const{type:t="text",className:s,onChange:n,...r}=e;return k("input",{type:t,className:K("form-control",s),onChange:this._handleChange,...r})}}class N0 extends ae{constructor(){super(...arguments),this._handleChange=e=>{const{onChange:t}=this.props,s=e.target.value;t&&t(s,e)}}get value(){return this.base.value}autoHeight(){v.autoHeight(this.base)}componentDidMount(){this.props.autoHeight&&(this.autoHeight(),v(this.base).on("input paste change",()=>{this.autoHeight()}))}componentWillUnmount(){this.props.autoHeight&&v(this.base).off("input paste change")}render(e){const{className:t,onChange:s,...n}=e;return k("textarea",{className:K("form-control",t),onChange:this._handleChange,...n})}}class E0 extends ae{constructor(e){super(e),this._handleValueChange=s=>{const n=s.target,r=v(n).closest(".string-list-edit-item").attr("z-key");typeof r=="string"&&this.setValue(+r,n.value)},this._handleDeleteClick=s=>{const n=v(s.target).closest(".string-list-edit-item").attr("z-key");typeof n=="string"&&this.remove(+n)},this._handleAddClick=s=>{const n=v(s.target).closest(".string-list-edit-item").attr("z-key");this.add(typeof n=="string"?+n:void 0)};const t=e.defaultValue?e.defaultValue.map(s=>[Xe(),s]):[];t.length||t.push([Xe(),""]),this._items$=pe(t),this._value=t.reduce((s,[n,r])=>(r.length&&s.push(r),s),[]),this._changeEffect=Tt(()=>{const s=this._value,n=this._items$.value.reduce((o,[a,l])=>(l.length&&o.push(l),o),[]);(s.length!==n.length||s.some((o,a)=>o!==o[a]))&&(this._value=n,this.props.onChange&&requestAnimationFrame(()=>{var o,a;(a=(o=this.props).onChange)==null||a.call(o,n)}))})}get value(){return this._value}componentDidUpdate(){this._preserveOne()}componentWillUnmount(){this._changeEffect()}_preserveOne(){this._items$.value.length||this.add()}_renderItem(e,t){const{readonly:s,placeholder:n}=this.props;return k("div",{className:"string-list-edit-item","z-key":e,children:[k("input",{className:"string-list-edit-item-value form-control",type:"text",value:t,placeholder:n,readonly:s,onChange:this._handleValueChange}),k("div",{className:"string-list-edit-item-actions",children:[k(we,{type:"ghost",size:"sm",icon:"plus",onClick:this._handleAddClick}),k(we,{type:"ghost",size:"sm",icon:"trash",onClick:this._handleDeleteClick})]})]},e)}setValue(e,t){const s=this._items$.value,n=s.findIndex(([r])=>r===e);s[n][1]=t,this._items$.value=[...s]}add(e){const t=this._items$.value,s=e?t.findIndex(([n])=>n===e):t.length-1;t.splice(s+1,0,[Xe(),""]),this._items$.value=[...t]}remove(e){const t=this._items$.value,s=t.findIndex(([n])=>n===e);t.splice(s,1),t.length||t.push([Xe(),""]),this._items$.value=[...t]}render(e){const t=this._items$.value,{itemWidth:s,maxWidth:n=400}=e,r={};return s&&s!=="auto"&&(r["--string-list-edit-item-width"]=je(s)||""),n&&n!=="auto"&&n!=="100%"&&(r.maxWidth=je(n)||""),k("div",{className:"string-list-edit",style:r,children:t.map(([o,a])=>this._renderItem(o,a))})}}class Ya extends ae{constructor(e){super(e),this._handleKeyChange=s=>{const n=s.target,r=v(n).closest(".map-edit-item").attr("z-key");typeof r=="string"&&this.setKey(+r,n.value)},this._handleValueChange=s=>{const n=s.target,r=v(n).closest(".map-edit-item").attr("z-key");typeof r=="string"&&this.setValue(+r,n.value)},this._handleDeleteClick=s=>{const n=v(s.target).closest(".map-edit-item").attr("z-key");typeof n=="string"&&this.remove(+n)},this._handleAddClick=s=>{const n=v(s.target).closest(".map-edit-item").attr("z-key");this.add(typeof n=="string"?+n:void 0)};const t=e.defaultValue?Object.entries(e.defaultValue).map(([s,n])=>[Xe(),s,n]):[];t.length||t.push([Xe(),"",""]),this._pairs$=pe(t),this._valuePairs=Ya.formatPairs(t),this._pairsChangeEffect=Tt(()=>{const s=this._valuePairs,n=Ya.formatPairs(this._pairs$.value);(s.length!==n.length||s.some(([o,a],l)=>o!==n[l][0]||a!==n[l][1]))&&(this._valuePairs=n,this.props.onChange&&requestAnimationFrame(()=>{var o,a;(a=(o=this.props).onChange)==null||a.call(o,this.value)}))})}static formatPairs(e){return e.reduce((t,[s,n,r])=>(n.length&&t.push([n,r]),t),[]).sort((t,s)=>t[0].localeCompare(s[0]))}get value(){return this._valuePairs.reduce((e,[t,s])=>(e[t]=s,e),{})}componentDidUpdate(){this._preserveOne()}componentWillUnmount(){this._pairsChangeEffect()}_preserveOne(){this._pairs$.value.length||this.add()}_renderItem(e,t,s){const{readonly:n}=this.props;return k("div",{className:"map-edit-item","z-key":e,children:[k("input",{className:"map-edit-item-key form-control",type:"text",value:t,readonly:n,onChange:this._handleKeyChange}),k("input",{className:"map-edit-item-value form-control",type:"text",value:s,readonly:n,onChange:this._handleValueChange}),k("div",{className:"map-edit-item-actions",children:[k(we,{type:"ghost",size:"sm",icon:"plus",onClick:this._handleAddClick}),k(we,{type:"ghost",size:"sm",icon:"trash",onClick:this._handleDeleteClick})]})]},e)}setKey(e,t){const s=this._pairs$.value,n=s.findIndex(([r])=>r===e);s[n][1]=t,this._pairs$.value=[...s]}setValue(e,t){const s=this._pairs$.value,n=s.findIndex(([r])=>r===e);s[n][2]=t,this._pairs$.value=[...s]}add(e){const t=this._pairs$.value,s=e?t.findIndex(([n])=>n===e):t.length-1;t.splice(s+1,0,[Xe(),"",""]),this._pairs$.value=[...t]}remove(e){const t=this._pairs$.value,s=t.findIndex(([n])=>n===e);t.splice(s,1),t.length||t.push([Xe(),"",""]),this._pairs$.value=[...t]}render(e){const t=this._pairs$.value,{keyWidth:s,valueWidth:n,maxWidth:r=400}=e,o={};return s&&s!=="auto"&&(o["--map-edit-key-width"]=je(s)||""),n&&n!=="auto"&&(o["--map-edit-value-width"]=je(n)||""),r&&r!=="auto"&&r!=="100%"&&(o.maxWidth=je(r)||""),k("div",{className:"map-edit",style:o,children:t.map(([a,l,c])=>this._renderItem(a,l,c))})}}class A0 extends ae{constructor(){super(...arguments),this._defaultID=`_form-control-${Xe()}`}_renderZUIComponent(e,t){return e.ZUI?k(ua,{$use:e,$options:t}):k(e,{...t})}_renderSelect(e){return k(I0,{...e})}_renderCheckbox(e){const{className:t,type:s,name:n,defaultValue:r,disabled:o,...a}=e;return k("div",{className:`check-list-inline is-type-${s}`,children:k(qs,{type:s,id:n??this._defaultID,className:t,name:n,defaultChecked:!!r,disabled:!!o,...a})})}_renderCheckList(e){const{items:t=[],type:s="radio",className:n,disabled:r,block:o=!1,name:a,defaultValue:l,...c}=e;return k(Bw,{type:s,items:t,className:n,name:a,defaultChecked:l,disabled:!!r,inline:!o,...c})}_renderText(e){const{value:t,className:s,...n}=e;return k("div",{className:K("form-static-text",s),...n,children:t})}_renderTextarea(e){return k(N0,{...e})}_renderInput(e){return k(M0,{...e})}_renderMap(e){return k(Ya,{...e})}_renderStringList(e){return k(E0,{...e})}render(e){const{widget:t="input",props:s,...n}=e,r=Le({},n,s);return typeof t=="function"?this._renderZUIComponent(t,r):t==="select"||t==="multiSelect"?this._renderSelect({multiple:t==="multiSelect",...r}):t==="checkbox"||t==="switch"?this._renderCheckbox({type:t,...r}):t==="checkboxList"||t==="switchList"||t==="radioList"||t==="radio"?this._renderCheckList({type:t==="switchList"?"switch":t==="radioList"||t==="radio"?"radio":"checkbox",...r}):t==="text"?this._renderText(r):t==="textarea"?this._renderTextarea(r):t==="input"?this._renderInput(r):t==="map"?this._renderMap(r):t==="stringList"?this._renderStringList(r):k(ua,{$use:t,$options:r})}}function P0(i){const{children:e,name:t,label:s,tooltip:n,labelClass:r,required:o,style:a,className:l,hint:c,control:h}=i;return k("div",{className:K("form-group",l,(h==null?void 0:h.widget)==="text"?"is-static-text":null),"data-name":t,style:a,children:[s!==void 0?k("label",{class:K("form-label",r,o?"required":""),for:t,children:[k("div",{class:"form-label-text",title:typeof s=="string"?s:void 0,children:k(fe,{content:s})}),n?k("div",{className:"state","zui-toggle":"tooltip","data-content":n,children:k(Ie,{icon:"info"})}):null]}):null,h?k(A0,{...h}):null,e,c?k(fe,{className:"form-tip",content:c}):null]})}class L0 extends ae{constructor(){super(...arguments),this._handleChange=e=>{const{schemaInfo:t,onChangeField:s}=this.props,n=t.widget[2];let r;if(n)r=n(e);else{if(e===void 0)return;if(e instanceof Event){const o=e.target;if(o.tagName==="INPUT"&&o.type==="radio"&&!v(o).prop("checked"))return;o.tagName==="INPUT"&&o.type==="checkbox"?r=v(o).prop("checked"):o.tagName==="SELECT"&&o.multiple?r=Array.from(v(o).val()):r=o.value}else if(typeof e=="function"||typeof e=="object"&&!Array.isArray(e)&&!v.isPlainObject(e)){console.warn("[ZUI] Unsupported value type:",typeof e,e);return}else r=e}s(t.path,r)}}render({schemaInfo:e}){const{schema:t,value:s,widget:n,path:r,required:o}=e,{title:a,description:l,tooltip:c,disabled:h,readonly:d,placeholder:f}=t,[m,y]=n,b={widget:m,disabled:h,readonly:d,placeholder:f,required:o,props:y,value:s,onChange:this._handleChange};return k(P0,{name:r,label:a,hint:l,tooltip:c,required:b.required,control:b})}}class Ja extends ae{_getSchemaInfo(e){const{infoGetter:t,path:s=""}=e;return e.schemaInfo||t(s)}_renderObjectSchema(e){const{infoGetter:t,errorsGetter:s,path:n="",onChangeField:r}=this.props,{schema:o,properties:a=[]}=e,{title:l,description:c}=o,h=[];for(const d of a){const f=n.length?`${n}.${d}`:d,m=s(f);h.push(k(Ja,{infoGetter:t,path:f,onChangeField:r,errorsGetter:s,errors:m.length?m:void 0},d))}return n.length?k(Dr,{title:l,caption:c,className:"form-builder-collapsible",contentClass:"form-builder-items",children:h},n):k("div",{className:"form-builder-items",children:h})}_renderArraySchema(e){const{infoGetter:t,errorsGetter:s,path:n=""}=this.props;if(!e)return console.warn("[ZUI] Schema not found:",n),null;const r=e.schema,{title:o,description:a,items:l}=r;if(l){const c=t(`${n}[]`);if(!c)return console.warn("[ZUI] Schema not found:",`${n}[]`),null;const h=c.value;return k(Dr,{title:o,caption:a,disabled:r.collapsed==="disabled",collapsed:typeof r.collapsed=="boolean"?r.collapsed:!r.title,className:"form-builder-collapsible",children:h.map((d,f)=>{const m={...c,path:`${n}[${f}]`,value:d},y=s(m.path);return k(Ja,{infoGetter:t,errors:y.length?y:void 0,errorsGetter:s,path:m.path,schemaInfo:m,onChangeField:this.props.onChangeField})})})}return this._renderFormItem(e)}_renderSchema(e){const{type:t}=e.schema;return t==="object"?this._renderObjectSchema(e):t==="array"?this._renderArraySchema(e):this._renderFormItem(e)}_renderFormItem(e){return k(L0,{schemaInfo:e,onChangeField:this.props.onChangeField})}_getWidthStyle(e){if(typeof e!="string"&&typeof e!="number")return"";if(typeof e=="number")return`${e/12*100}%`;if(e==="full")return"100%";if(/^\d+\/\d+$/.test(e)){const[t,s]=e.split("/").map(Number);return`${t/s*100}%`}return e}render(e){const{infoGetter:t,errors:s,path:n=""}=e,r=e.schemaInfo||t(n);if(!r)return console.warn("[ZUI] Schema not found:",n),null;const{schema:o}=r;if(o.hidden)return null;const{extra:a,hint:l,width:c,type:h,disabled:d,readonly:f,required:m}=o,y=this._getWidthStyle(c);return k("div",{"z-key":n,"z-type":h,className:K("form-builder-item",{"is-root":!n.length,"is-disabled":d,"is-readonly":f,"is-required":m,"has-error":s==null?void 0:s.length}),style:y?{"flex-basis":y}:void 0,children:[this._renderSchema(r),s!=null&&s.length?k("div",{class:"form-item-errors",children:s.map(([b,w])=>k("div",{class:"form-item-error",children:w},b))}):null,l?k("div",{className:"form-hint",children:l}):null,a?k(fe,{className:"form-builder-extra",content:a}):null]},n)}}const R0={validate:{required:"“{title}”不能为空",minLength:"“{title}”的长度不能少于{min}",maxLength:"“{title}”的长度不能超过{max}",minCount:"“{title}”的数目不能少于{min}",maxCount:"“{title}”的数目不能超过{max}",min:"“{title}”不能小于{min}",max:"“{title}”不能超过{max}",pattern:"“{title}”格式不正确",integer:"“{title}”必须是整数"}},z0={validate:{required:"“{title}”不能為空",minLength:"“{title}”的長度不能少於{min}",maxLength:"“{title}”的長度不能超過{max}",minCount:"“{title}”的數目不能少於{min}",maxCount:"“{title}”的數目不能超過{max}",min:"“{title}”不能小於{max}",max:"“{title}”不能超過{max}",pattern:"“{title}”格式不正確",integer:"“{title}”必須是整數"}},F0={validate:{required:'"{title}" is required',minLength:'"{title}" length must be greater than {min}',maxLength:'"{title}" length must be less than {max}',minCount:'"{title}" count must be greater than {min}',maxCount:'"{title}" count must be less than {max}',min:'"{title}" must be greater than {min}',max:'"{title}" must be less than {max}',pattern:'"{title}" format is incorrect',integer:'"{title}" must be an integer'}};Pe.addLang({zh_cn:{formBuilder:R0},zh_tw:{formBuilder:z0},en:{formBuilder:F0}});function O0(i,e,t){return Pe.getLang(`formBuilder.${i}`,e,t)}const Vr=class Rn extends Ke{constructor(e){super(e),this._map=new Map,this.setFieldValue=(s,n)=>{const r=this.getFieldSchemaInfo(s),o=(r==null?void 0:r.schema).autoTrim;o&&typeof n=="string"&&(o==="start"?n=n.trimStart():o==="end"?n=n.trimEnd():n=n.trim());const l=this._dataMap$.value[s];l!==n&&requestAnimationFrame(()=>{var h;const c=(h=this.props.onFieldChange)==null?void 0:h.call(this,s,n,l);c!==!1&&fn(()=>{const d={[s]:n,...typeof c=="object"?c:{}};this._dataMap$.value={...this._dataMap$.value,...d};const f=Object.keys(d);this._updateFieldInfos(f)})})},this.getFieldValidationErrors=s=>this.validationErrors[s]||[],this.getFieldSchemaInfo=(s="")=>{var n;return(n=this.getFieldSchemaInfo$(s))==null?void 0:n.value},this._handleSubmit=s=>{const{onSubmit:n,autoValidate:r}=this.props;if(r!=null&&r.onSubmit&&!this.validate()){s.preventDefault();return}(n==null?void 0:n.call(this,s,this.formData))===!1&&s.preventDefault()},this._schema$=pe(e.schema);const t=Rn.buildDataMap(e.schema,e.defaultData);this._dataMap$=pe(t),this._schemaPatches$=pe({}),this._validationErrors$=pe({}),this._formData$=xe(()=>Rn.buildFormData(this._dataMap$.value)),this._lastFormData=Rn.buildFormData(t),this._schemaMap$=xe(()=>{const s={},n=this._schemaPatches$.value;return Rn.loopSchema(this.schema,(r,o)=>{s[o]=v.extend(!0,r,n[o])}),s}),this._formDataEffect=Tt(()=>{var n;const s=this._lastFormData;this._lastFormData=this._formData$.value,(n=this.props.onDataChange)==null||n.call(this,this._formData$.value,s)})}get schema$(){return this._schema$}get schema(){return this._schema$.value}get formData(){return this._formData$.value}get schemaMap(){return this._schemaMap$.value}get validationErrors(){return this._validationErrors$.value}componentDidMount(){var e;(e=this.props.afterRender)==null||e.call(this,!0)}componentDidUpdate(e){var t;e.schema!==this.props.schema?this._schema$.value=this.props.schema:(t=this.props.afterRender)==null||t.call(this,!1)}componentWillUnmount(){this._formDataEffect()}getSchemaByPath(e){return this.schemaMap[e]}setSchemaByPath(e,t,s=!0){const n=this._schemaPatches$.value;this._schemaPatches$.value={...n,[e]:s?v.extend(!0,n[e]||{},t):{...n[e],...t}}}validateField(e,t){const s=typeof e=="string"?this.getFieldSchemaInfo(e):e,n=s==null?void 0:s.schema.type;if(!n||n==="object")return[];const{schema:r}=s,o=(t==null?void 0:t.value)??s.value,a=h=>[h,O0(`validate.${h}`,r)],l=(h,d,f="pattern")=>{if(!h)return;const m=typeof h=="string"?{pattern:h}:h;if(!new RegExp(m.pattern).test(d))return m.message?[f,m.message]:a(f)};if(s.required&&(o==null||n==="string"&&o===""||n==="array"&&(!Array.isArray(o)||o.length===0)||n==="map"&&Object.keys(o).length===0||(n==="number"||n==="integer")&&Number.isNaN(o)))return[a("required")];const c=[];if(r.type==="string"){typeof r.min=="number"&&r.min>0&&String(o??"").length<r.min&&c.push(a("minLength")),typeof r.max=="number"&&r.max>0&&String(o??"").length>r.max&&c.push(a("maxLength"));const h=l(r.pattern,String(o??""));h&&c.push(h)}else if(r.type==="number"||r.type==="integer")typeof r.min=="number"&&r.min>0&&Number(o??0)<r.min&&c.push(a("min")),typeof r.max=="number"&&r.max>0&&Number(o??0)>r.max&&c.push(a("max")),r.type==="integer"&&!Number.isInteger(Number(o??0))&&c.push(a("integer"));else if(r.type==="array")typeof r.min=="number"&&r.min>0&&Array.isArray(o)&&o.length<r.min&&c.push(a("minCount")),typeof r.max=="number"&&r.max>0&&Array.isArray(o)&&o.length>r.max&&c.push(a("maxCount"));else if(r.type==="map"&&(r.keyPattern||r.valuePattern)){const h=o,{keyPattern:d,valuePattern:f}=r;for(const[m,y]of Object.entries(h)){const b=l(d,m,"keyPattern"),w=l(f,String(y??""),"valuePattern");b&&c.push(b),w&&c.push(w)}}if(!(t!=null&&t.skipUpdate)){const{validationErrors:h}=this;if(JSON.stringify(h[s.path])===JSON.stringify(c))return c;this._validationErrors$.value={...h,[s.path]:c},this._updateFieldInfo(s.path)}return c}validate(){const e={},{validationErrors:t}=this,s={skipUpdate:!0};let n=!1,r="";return Rn.loopSchema(this.schema,(o,a)=>{const l=this.validateField(a,s);!n&&JSON.stringify(t[a]||[])!==JSON.stringify(l)&&(n=!0),l.length>0&&(e[a]=l,r=a)}),n?(this._validationErrors$.value=e,r.length&&v(this.element).find(`[z-key="${r}"]`).scrollIntoView(),!1):!0}_updateMap(){const e=this._map,t=new Set(e.keys());Rn.loopSchema(this.schema,(s,n)=>{t.delete(n),this._updateFieldInfo(n)});for(const s of t.keys())e.delete(s)}_updateFieldInfos(e){const t=new Set(e);for(const s of e)this._updateFieldInfo(s,t)}_updateFieldInfo(e,t){var a;const s=this._createFieldSchemaInfo(e);if(!s)return;const n=this._map;let r=n.get(e);r?r.value=s:(r=pe(s),this._map.set(e,r)),t=t||new Set,n.values().forEach(({value:l})=>{!l||l.path===e||t.has(l.path)||!l.dependenciesSet.has(e)||this._updateFieldInfo(l.path,t)});const{autoValidate:o={}}=this.props;if(o.onChange){const l=this._validationErrors$.value;o.onChange==="removeErrors"&&((a=l[e])!=null&&a.length)?this._validationErrors$.value={...l,[e]:[]}:this.validateField(e)}return s}getFieldSchemaInfo$(e=""){let t=this._map.get(e);return t||(this._updateFieldInfo(e),t=this._map.get(e)),t}_evaluateExpression(e,...t){try{const s=e.substring(2,e.length-2);return v.runJS(s,...t)}catch(s){console.warn("[ZUI] Failed to evaluate expression:",e,s)}}_createFieldSchemaInfo(e){const t=this.schemaMap[e];if(!t)return;const s=this._dataMap$.value[e],n=Object.keys(t),r={};for(const h of n){let d=t[h];typeof d=="string"&&d.startsWith("{{")&&d.endsWith("}}")&&(d=this._evaluateExpression(d,["formBuilder",this],["schema",t],["formData",this.formData],["value",s],["path",e])),r[h]=d}const o=r.type,a=o==="object"&&r.properties?Object.keys(r.properties):void 0;if(a){const h=new Map;for(const d of a){const f=r.properties[d];if(typeof f.order!="number")break;h.set(d,f.order)}h.size===a.length&&a.sort((d,f)=>h.get(d)-h.get(f))}let l=Array.isArray(r.required)?!1:!!r.required;if(o!=="object"&&r.required===void 0&&e.length>2&&e.includes(".")){const h=e.split("."),d=h.pop(),f=h.join("."),m=this.getFieldSchemaInfo(f),y=m?m.schema:this.getSchemaByPath(f);y&&(l=Array.isArray(y.required)&&y.required.includes(d))}const c={required:l,path:e,schema:r,properties:a,value:s,dependenciesSet:new Set(t.dependencies||[])};return{...c,widget:this._getWidget(c)}}_getWidget(e){const{widget:t,props:s}=e.schema,{widgetMap:n}=Rn,{widgets:r={}}=this.props;let o;if(t)for(o=r[t]||n[t];typeof o=="string"&&o!==t;){const l=r[o]||n[o];if(!l||o===l)break;o=l}o||(o=t||r._||n._),typeof o=="function"&&(o=o.call(this,e,this));const a=Array.isArray(o)?o:[o];return s&&(a[1]=Le({},s,a[1])),a}_renderHeader(e){const{header:t}=e;return t?k(fe,{className:"form-builder-header",content:t},"header"):null}_renderBody(e){const{schema:t,actions:s}=e,{title:n}=t;return k("div",{className:`form-builder-body form-grid form-${t.displayType||"vert"}`,children:[n?k("div",{className:"form-builder-title",children:n}):null,k(Ja,{infoGetter:this.getFieldSchemaInfo,errorsGetter:this.getFieldValidationErrors,onChangeField:this.setFieldValue}),s?Be.render(s,[],{className:"form-actions"}):null]},"body")}_renderFooter(e){const{footer:t}=e;return t?k(fe,{className:"form-builder-footer",content:t},"footer"):null}_getProps(e){return Le({},super._getProps(e),{action:e.formAction,onSubmit:this._handleSubmit})}_getClassName(e){return["form-builder",e.className]}_getChildren(e){return[this._renderHeader(e),this._renderBody(e),this._renderFooter(e),e.formName?k("input",{type:"hidden",name:e.formName,value:JSON.stringify(this.formData)}):null]}static loopSchema(e,t,s=""){if(t(e,s),e.type==="object")for(const n in e.properties){const r=e.properties[n];this.loopSchema(r,t,s.length?`${s}.${n}`:n)}else e.type==="array"&&e.items&&this.loopSchema(e.items,t,`${s}[]`)}static buildDataMap(e,t,s="",n={}){if(e.type==="object"&&"properties"in e)for(const r in e.properties){const o=e.properties[r],a=t&&typeof t=="object"?t[r]:void 0;this.buildDataMap(o,a,s.length?`${s}.${r}`:r,n)}else{const r=e.type==="array"&&e.items?`${s}[]`:s;n[r]=t??JSON.parse(JSON.stringify(e.defaultValue??this.typeDefaultValueMap[e.type]??""))}return n}static buildFormData(e){return Object.keys(e).reduce((t,s)=>{const n=e[s],r=s.split(".");let o=t;return r.forEach((a,l)=>{l===r.length-1?o[a.endsWith("[]")?a.substring(0,a.length-2):a]=n:(o[a]||(o[a]={}),o=o[a])}),t},{})}};Vr.NAME="FormBuilder",Vr.defaultProps={autoValidate:{onChange:"removeErrors",onSubmit:!0}},Vr.widgetMap={_:i=>i.schema.type==="boolean"?"checkbox":"input",picker:({schema:i})=>{var s;const e=i.type==="array",t=((s=i.props)==null?void 0:s.multiple)??(i.widget==="multiPicker"?!0:e);return[Gt,{multiple:t},n=>{var r;return t&&e?n.split(((r=i.props)==null?void 0:r.valueSplitter)??","):n}]},multiPicker:"picker",input:({schema:i})=>{const{type:e="string"}=i;return e==="number"||e==="integer"?["input",{type:"number"}]:"input"}},Vr.typeDefaultValueMap={string:"",number:0,integer:0,boolean:!1,array:[],object:{},map:{}};let cd=Vr;const j0=Object.freeze(Object.defineProperty({__proto__:null,FormBuilder:cd},Symbol.toStringTag,{value:"Module"}));class Xa extends be{}Xa.NAME="FormBuilder",Xa.Component=cd,Xa.register(),ot(j0);const B$="",H$="";class Vi{constructor(e,t){const{DEFAULT:s,globalControls:n}=this.constructor;this._options={...s,...t,controls:{...n,...s.controls,...t==null?void 0:t.controls}},this._$element=v(e),this._cachedFields=new Map}get element(){return this._$element[0]}get options(){return this._options}get $element(){return this._$element}_queryField(e){const t=this._$element;if("#.[".includes(e[0])){const o=t.find(e);return o.length?o:void 0}const s=this._options,n=e.replaceAll("[","\\[").replaceAll("]","\\]");let r=t.find(`[zui-form-field="${n}"]`);return r.length||(r=t.find(`[name="${n}"]`)),!r.length&&s.matchID&&(r=t.find(`#${n}`)),!r.length&&s.matchBrackets&&!e.includes("[")&&(r=t.find(`[name="${n}\\[\\]"]`),r.length||(r=t.find(`[name^="${n}["]`))),r.length?r:void 0}_getControl(e){const{controls:t}=this._options;if(t)for(const[s,n]of Object.entries(t)){const r=n(e,this._$element);if(r)return{type:s,...r}}}getFieldInfo(e){const{cacheQuery:t,allowSameName:s,fields:n}=this._options;let r;if(n){const a=typeof n=="function"?n:n[e];if(a){const l=a.call(this,e,this._$element);if(l instanceof v)r=l;else if(l)return l;if(l===!1)return}}const o=r||(t?this._cachedFields.get(e):this._queryField(e));if(o!=null&&o.length){if(!s&&o.length>1)throw new Error(`[ZUI] FormHelper: Multiple fields found for query "${e}".`);return t&&this._cachedFields.set(e,o),{$field:o,query:e,name:o.attr("name")??"",value:o.val(),control:this._getControl(o)}}}getFieldVal(e){const t=this.getFieldInfo(e);if(t)return t.control?t.control.getVal():t.value}setFieldVal(e,t){const s=this.getFieldInfo(e);if(!s){if(this._options.throwError)throw new Error(`[ZUI] FormHelper: Field "${e}" not found.`);return!1}return s.control?s.control.setVal(t):(s.$field.val(t),!0)}setFormData(e){Object.entries(e).forEach(([t,s])=>{this.setFieldVal(t,s)})}static registerControl(e,t){this.globalControls[e]=t}}Vi.DEFAULT={matchID:!0,matchBrackets:!0,throwError:!0},Vi.globalControls={picker:(i,e)=>{let t=i.closest("[z-use-picker]"),s=!1;if(!t.length&&i.hasClass("pick-value")&&(t=i.closest("[z-use]"),s=!0),!t.length||e&&!t.closest(e).length)return;const n=s?t.zui():t.data("zui.Picker");if(n)return{type:"picker",$element:t,instance:n,getVal:()=>{var r;return(r=n.$)==null?void 0:r.value},setVal:r=>{var o;return(o=n.$)==null||o.setValue(r),!0}}}};function B0(i,e){return new Vi(i,e)}const hd=class Q_ extends Dt{_getClassName(e){const{type:t,stacked:s,justified:n}=e;return[super._getClassName(e),t?`nav-${t}`:"",s?"nav-stacked":"",n?"nav-justified":""]}static render(e,t,s,n){let r=typeof e=="function"?e.call(n??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),s&&(r=Le(s,r)),k(Q_,{...r})}};hd.NAME="nav",hd.defaultItemProps={component:"li",innerComponent:"a"};let dd=hd;const H0=Object.freeze(Object.defineProperty({__proto__:null,Nav:dd},Symbol.toStringTag,{value:"Module"}));class ud extends be{}ud.NAME="Nav",ud.Component=dd,ot(H0);const U$="",V$="",W$="",K$="",q$="",G$="",Z$="",Y$="",J$="",X$="",Q$="",eD="",tD="";function Wr(i,e){const t=i.pageTotal||Math.ceil(i.recTotal/i.recPerPage);return typeof e=="string"&&(e==="first"?e=1:e==="last"?e=t:e==="prev"?e=i.page-1:e==="next"?e=i.page+1:e==="current"?e=i.page:e=Number.parseInt(e,10)),e=e!==void 0?Math.max(1,Math.min(e<0?t+e:e,t)):i.page,{...i,pageTotal:t,page:e}}function bg({key:i,type:e,btnType:t,page:s,format:n,pagerInfo:r,linkCreator:o,...a}){const l=Wr(r,s);return a.text===void 0&&!a.icon&&n&&(a.text=typeof n=="function"?n(l):$e(n,l)),a.url===void 0&&o&&(a.url=typeof o=="function"?o(l):$e(o,l)),a.disabled===void 0&&(a.disabled=s!==void 0&&l.page===r.page),k(we,{type:t,"z-go-to-page":l.page,...a})}function wg({key:i,type:e,page:t,text:s="",pagerInfo:n,children:r,...o}){const a=Wr(n,t);return s=typeof s=="function"?s(a):$e(s,a),k(Ke,{...o,children:[r,s]})}function U0({type:i,btnType:e,count:t=12,pagerInfo:s,linkCreator:n,...r}){if(!s.pageTotal)return;const o={...r,square:!0},a=()=>(o.text="",o.icon="icon-ellipsis-h",o.disabled=!0,k(we,{type:e,...o})),l=(h,d)=>{const f=[];for(let m=h;m<=d;m++){o.text=m,delete o.icon,o.disabled=!1;const y=Wr(s,m);n&&(o.url=typeof n=="function"?n(y):$e(n,y)),f.push(k(we,{type:e,...o}))}return f};let c=[];return c=[...l(1,1)],s.pageTotal<=1||(s.pageTotal<=t?c=[...c,...l(2,s.pageTotal)]:s.page<t-2?c=[...c,...l(2,t-2),a(),...l(s.pageTotal,s.pageTotal)]:s.page>s.pageTotal-t+3?c=[...c,a(),...l(s.pageTotal-t+3,s.pageTotal)]:c=[...c,a(),...l(s.page-Math.ceil((t-4)/2),s.page+Math.floor((t-4)/2)),a(),...l(s.pageTotal,s.pageTotal)]),c}class ss extends qt{handleClickTarget(e){const t=v(e.target),{notHideOnClick:s}=this.options;return(!s||!t.closest(s).length)&&this.hide(),!0}_getMenuOptions(){const{items:e,placement:t,menu:s,tree:n,onClickItem:r,relativeTarget:o=this._triggerElement}=this.options;return{items:e,placement:t,tree:n,onClickItem:r,nestedToggle:".item",accordion:!0,relativeTarget:{target:o,event:this.options.triggerEvent,dropdown:this},dropdown:this,popup:!0,...s}}_getRenderOptions(){const e=super._getRenderOptions();return this._dynamic?{...e,contentClass:"",popup:!1,content:g(Qa,this._getMenuOptions())}:e}}ss.NAME="Dropdown",ss.DEFAULT={...qt.DEFAULT,name:"dropdown",placement:"bottom-start",arrow:!1,closeBtn:!1,animation:"fade",limitSize:!0,notHideOnClick:".not-hide-menu,.form-control,input,label,.nested-toggle-icon"},ss.toggle={...qt.toggle,getOptions(i,e,t){var s,n;return e=((n=(s=qt.toggle)==null?void 0:s.getOptions)==null?void 0:n.call(this,i,e,t))||{},!e.target&&!e.items&&!e.menu&&(e.target=v(i).next(".dropdown-menu")),e}},ss.register();class ys extends we{constructor(){super(...arguments),this._ref=ye()}get triggerElement(){return this._ref.current}_updateData(){const{dropdown:e,menu:t,items:s,onClickItem:n,relativeTarget:r=this.triggerElement}=this.props,o=ss.get(this.triggerElement),a={items:s,onClickItem:n,menu:t,relativeTarget:r,...v(this.triggerElement).dataset(),...e};o?o.setOptions(a):new ss(this.triggerElement,a)}componentDidMount(){this._updateData()}componentDidUpdate(){this._updateData()}componentWillUnmount(){var e;(e=ss.get(this.triggerElement))==null||e.destroy()}_getProps(e){const{trigger:t,placement:s}=e;return{...super._getProps(e),"data-toggle":"dropdown","data-trigger":t,"data-placement":s,ref:this._ref}}}ys.defaultProps={caret:!0},Object.assign(cs.ItemComponents,{dropdown:ys}),Object.assign(Be.ItemComponents,{dropdown:ys});class Qa extends dt{constructor(){super(...arguments),this._handleSearchFocus=()=>{this._searchFocused=!0},this._handleSearchBlur=()=>{this._searchFocused=!1}}get isHoverTrigger(){const{nestedTrigger:e,tree:t}=this.props;return e?e==="hover":!t}get dropdown(){return this.props.dropdown}layout(){var h;if(this.props.tree||this.isRoot)return;const e=(h=this.element)==null?void 0:h.parentElement,t=v(e);e&&this._searchFocused&&this._position&&t.css(this._position);const r=t.parent().children(".dropdown-menu").children(`[z-key-path="${this.props.parentKey}"]`)[0];if(!e||!r)return;let{maxHeight:o}=this.props;const{flip:a,shift:l,offset:c}=this.props;Qh(r,e,{placement:this.props.placement,middleware:[a?Xh():null,l?Jh(typeof l=="object"?l:void 0):null,Yh(c),ng({apply({availableWidth:d,availableHeight:f}){if(o){const[m,y]=dn(o);o=Math.min(y==="%"?m*window.innerHeight:m,f-2)}else o=f;t.css({maxHeight:o,maxWidth:d-2})}})]}).then(({x:d,y:f})=>{t.css({left:d,top:f}),this._position={left:d,top:f,width:e.offsetWidth,height:e.offsetHeight}})}_getClassName(e){return["dropdown-menu scrollbar-hover scrollbar-thin",super._getClassName(e)]}_afterRender(e){super._afterRender(e),this.layout()}_getNestedProps(e,t,s,n){return Le(this.isHoverTrigger?{"z-key":s.key,"z-hover":this.props.parentKey??"root",onMouseEnter:this._handleHover,onMouseLeave:this._handleHover}:{},super._getNestedProps(e,t,s,n))}_getItemFromEvent(e){const t=super._getItemFromEvent(e);if(t)return t;const s=v(e.target).closest(".dropdown-menu[z-key]");if(s.length){const n=s.attr("z-key"),r=s.parent().parent().children(".dropdown-menu").children(`[z-key="${n}"]`);if(r.length)return super._getItemFromEvent(e,r[0])}}_renderNestedList(e,t,s,n){const r=super._renderNestedList(e,t,s,n);if(this.props.tree)return r;this._nestedContextMenu.push(r)}_getWrapClass(e){return[super._getWrapClass(e),e.tree?"is-tree":this.isRoot?"is-contextmenu":"is-contextmenu popup"]}_renderWrapperFooter(e){const t=super._renderWrapperFooter(e),s=this._nestedContextMenu;return this.props.tree||!s.length?t:[t,...s]}_renderNestedToggle(e,t){if(this.props.tree)return super._renderNestedToggle(e,t);if(typeof t=="boolean")return k("span",{className:`${this.name}-toggle nested-toggle-icon`,children:k("span",{className:"caret-right"})})}_getSearchBoxProps(e){return{...super._getSearchBoxProps(e),onFocus:this._handleSearchFocus,onBlur:this._handleSearchBlur}}_beforeRender(e){return this._nestedContextMenu=[],super._beforeRender(e)}}Qa.defaultProps={...dt.defaultProps,searchBox:!1,placement:"right-start",defaultNestedShow:!1,expandOnSearch:!1,nestedSearch:!1,flip:!0,shift:!0,offset:1},Qa.inheritNestedProps=[...dt.inheritNestedProps,"container","tree"];const V0=Object.freeze(Object.defineProperty({__proto__:null,DropdownButton:ys,DropdownMenu:Qa},Symbol.toStringTag,{value:"Module"}));function W0({type:i,pagerInfo:e,linkCreator:t,items:s=[5,10,15,20,25,30,35,40,45,50,100,200,500,1e3,2e3],dropdown:n={},menu:r,itemProps:o,...a}){var c;n.items=s.map(h=>{const d={...e,recPerPage:h};return{...o,key:h,text:`${h}`,active:h===e.recPerPage,url:t?typeof t=="function"?t(d):$e(t,d):void 0,"z-change-page-size":h}});const{text:l=""}=a;return a.text=typeof l=="function"?l(e):$e(l,e),n.menu={...r,...n.menu,className:K((c=n.menu)==null?void 0:c.className,"pager-size-menu")},k(ys,{dropdown:n,...a})}function Cg({key:i,page:e,type:t,btnType:s,pagerInfo:n,size:r,onClick:o,onChange:a,linkCreator:l,...c}){const h={...c};let d;const f=b=>{var w;d=Number((w=b.target)==null?void 0:w.value)||1,d=d>n.pageTotal?n.pageTotal:d},m=b=>{if(!(b!=null&&b.target))return;d=d<=n.pageTotal?d:n.pageTotal;const w=Wr(n,d);a&&!a({info:w,event:b})||(b.target.href=h.url=typeof l=="function"?l(w):$e(l,w))},y=Wr(n,e||0);return h.url=typeof l=="function"?l(y):$e(l,y),k("div",{className:K("input-group","pager-goto-group",r?`size-${r}`:""),children:[k("input",{type:"number",class:"form-control",max:n.pageTotal,min:"1",onInput:f}),k(we,{type:s,...h,onClick:m})]})}const el=class Tf extends Be{constructor(){super(...arguments),this._pagerChanges=pe({}),this._changedPager=xe(()=>Tf.format({...this.props,...this._pagerChanges.value})),this._changeEffect=Tt(()=>{const{onChangePageInfo:e}=this.props,t=this._changedPager.value;e&&this._changeEvent&&(e(t,this._changeEvent),this._changeEvent=void 0)}),this._handleClickLink=e=>{const t=v(e.currentTarget);if(t.is(".disabled"))return;const s=t.z("goToPage");typeof s=="number"&&(this._changeEvent=e,this._pagerChanges.value={...this._pagerChanges.value,page:s})},this._handleClickSizeMenu=e=>{const{item:t}=e,s=t["z-change-page-size"];typeof s=="number"&&!t.disabled&&(this._changeEvent=e.event,this._pagerChanges.value={...this._pagerChanges.value,recPerPage:s})}}_isBtnType(e){const{type:t}=e;return super._isBtnType(e)||["link","nav","size-menu","goto"].includes(t)}componentDidUpdate(e){if(this.props.useState)this.props.recTotal!==e.recTotal&&(this._pagerChanges.value={...this._pagerChanges.value,recTotal:this.props.recTotal});else{const{page:t,recTotal:s,recPerPage:n}=this.props;(t!==e.page||s!==e.recTotal||n!==e.recPerPage)&&(this._pagerChanges.value={})}}componentWillUnmount(){this._changeEffect()}_beforeRender(e){return this._pagerInfo=e.useState?this._changedPager.value:Tf.format(e),super._beforeRender(e)}_getItem(e,t,s){const n=super._getItem(e,t,s);if(!n)return!1;const{type:r="item"}=t,o=this._pagerInfo;return r==="info"?v.extend(n,{pagerInfo:o}):(r==="link"||r==="size-menu"||r==="nav"||r==="goto")&&v.extend(n,{pagerInfo:o,linkCreator:e.linkCreator}),r==="size-menu"&&(n.menu={onClickItem:this._handleClickSizeMenu,...n.menu}),r==="link"&&(n.onClick=this._handleClickLink),n}static format(e){const{page:t=1,recTotal:s=0,recPerPage:n=10}=e,r=Math.max(0,+s),o=Math.max(1,+n),a=o?Math.ceil(r/o):0;return{page:Math.min(Math.max(1,+t),a),recTotal:r,recPerPage:o,pageTotal:a}}};el.NAME="pager",el.ItemComponents={...Be.ItemComponents,info:wg,link:bg,nav:U0,"size-menu":W0,goto:Cg},el.defaultItemProps={btnType:"ghost",size:"sm"};let Kr=el;class fd extends be{}fd.NAME="Pager",fd.Component=Kr,ot(Object.freeze(Object.defineProperty({__proto__:null,Pager:Kr,PagerGoto:Cg,PagerInfoItem:wg,PagerLink:bg},Symbol.toStringTag,{value:"Module"})));const nD="",iD="";class tl extends be{}tl.NAME="Pick",tl.Component=at,tl.replace=!0;const rD="",oD="",aD="",lD="";class sl extends be{}sl.NAME="Picker",sl.Component=Gt,sl.register(),Pe.addLang({zh_cn:{selectAll:"全选",cancelSelect:"取消选择",searchEmptyHint:"无匹配选项",loadingHint:"正在加载...",exceedLimitHint:"还有 {0} 个选项没有显示，可尝试搜索来查找"},zh_tw:{selectAll:"全選",cancelSelect:"取消選擇",searchEmptyHint:"無匹配選項",loadingHint:"正在載入...",exceedLimitHint:"還有 {0} 個選項沒有顯示，可嘗試搜索來查找"},en:{selectAll:"Select All",cancelSelect:"Cancel Select",searchEmptyHint:"No matching options",loadingHint:"Loading...",exceedLimitHint:"There are {0} items not displayed, try searching to find"}}),ot(D0);class nl extends be{}nl.NAME="SearchBox",nl.Component=mn,nl.register(),ot(Xw);function pd(i,e){const[t,s]=dn(i);return s==="%"?e*t/100:t}const xg="is-sidebar-resizing",kg="has-sidebar-animation",md="is-animating",il=".sidebar-gutter";let qr=class extends Ze{get side(){return this._side}get width(){return this._width}get $parent(){const{parent:e}=this.options;return e?v(e):this.$element.parent()}afterInit(){const{$element:e}=this,t=e.parent(),s=t[0],n=t.width();this._container=s;const{preserve:r,side:o=e.hasClass("sidebar-right")?"right":"left",animation:a,dragToResize:l,width:c,minWidth:h=0,maxWidth:d=Number.MAX_SAFE_INTEGER,toggleBtn:f,dbclick:m}=this.options;this._storeID=r?`SIDEBAR:${r}:width`:"",this._side=o,this._minWidth=pd(h,n),this._maxWidth=pd(d,n),this._defaultWidth=Math.max(this._minWidth,Math.min(this._maxWidth,pd(c||e.width(),n))),this._width=(r?st.get(this._storeID):null)??this._defaultWidth,this.render(),f&&e.on(`click${this.namespace}`,".gutter-toggle",()=>this.toggle()),m&&e.on(`dblclick${this.namespace}`,il,()=>{m==="reset"?this.update(this._defaultWidth):this.toggle()}).on("mousedown",il,y=>{y.preventDefault()}),l&&(this._moveable=new Ni(e,{selector:il,move:!1,onMoveStart:()=>{this._startWidth=this._width,this.$parent.addClass(xg).removeClass(kg)},onMove:(y,b)=>{const{deltaX:w}=b;Math.abs(w)<10||this.update(this._startWidth+w*(o==="left"?1:-1))},onMoveEnd:()=>{a&&this.$parent.addClass(kg),this.$parent.removeClass(xg)}})),a&&this.on("transitionend",y=>{y.target===e[0]&&y.propertyName==="width"&&e.removeClass(md)})}destroy(){var e;super.destroy(),this._raf&&cancelAnimationFrame(this._raf),(e=this._moveable)==null||e.destroy()}toggle(e){e=e??!!this._width,e&&(this._widthBack=this._width),this.update(e?0:this._widthBack||this._defaultWidth)}update(e,t){if(!t){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this.update(e,!0)});return}const{preserve:s,toggleBtn:n,onResize:r,onToggle:o,animation:a}=this.options;if(e=e<this._minWidth?n?0:this._minWidth:Math.min(this._maxWidth,e,this._container.clientWidth),e===this._width)return;const l=!this._width,c=!e;this._width=e,s&&st.set(this._storeID,e),this.render(),r==null||r(e),l!==c&&(l&&a&&this.$element.addClass(md),o==null||o(c)),this.emit("sidebarResize",e)}render(){var h;const{side:e,width:t,$element:s,$parent:n}=this,r=!t,{toggleBtn:o,gutterWidth:a=dn(s.parent().css("gap"))[0]||1,animation:l}=this.options;s.addClass(`sidebar-${e}`).toggleClass("is-collapsed",r).toggleClass("is-expanded",!r).css({"--gutter-width":`${a}px`,width:`var(--sidebar-${e}-width)`,"--sidebar-duration":typeof l=="number"?`${l}ms`:null});let c=s.find(il);c.length||(c=v('<div class="sidebar-gutter gutter gutter-horz"></div>').appendTo(s)),o?c.children(".gutter-toggle").length||c.append(`<button class="gutter-toggle" type="button"><span class="chevron-${e}"></span></button>`):c.children(".gutter-resize-handler").length||c.append('<div class="gutter-resize-handler"></div>'),n.addClass(`has-sidebar-${e}`).css(`--sidebar-${e}-width`,`${t}px`).toggleClass(`is-sidebar-${e}-collapsed`,r),(h=this._moveable)!=null&&h.state&&s.removeClass(md)}};qr.NAME="Sidebar",qr.DEFAULT={minWidth:40,toggleBtn:!0,animation:!0,dragToResize:!0,dbclick:"reset"};const cD="",hD="",dD="";class gd extends be{}gd.NAME="Toolbar",gd.Component=Be,ot(Uw);const uD="";class rl extends be{}rl.NAME="Tree",rl.Component=zt,rl.replace=zt.TAG;class yd extends be{}yd.NAME="SearchTree",yd.Component=Kn,ot(iC);const fD="",pD="",mD="",gD="";class ol extends Ze{init(){const{multiple:e,defaultFileList:t,limitSize:s}=this.options;this.fileMap=new Map,this.renameMap=new Map,this.itemMap=new Map,this.dataTransfer=new DataTransfer,this.limitBytes=s?ks(s):Number.MAX_VALUE,this.currentBytes=0,e||(this.options.limitCount=1),this.$element.addClass("upload"),this.initFileInputCash(),this.initUploadCash(),t&&this.addFileItem(t)}initUploadCash(){const{name:e,uploadText:t,uploadIcon:s,listPosition:n,btnClass:r,tip:o,draggable:a}=this.options;this.$list=v('<ul class="file-list py-1"></ul>');const l=v(`<span class="upload-tip">${o}</span>`);if(!a){if(this.$label=v(`<label class="btn ${r}" for="${e}">${t}</label>`),s){const f=v(`<i class="icon icon-${s}"></i>`);this.$label.prepend(f)}const d=n==="bottom"?[this.$label,l,this.$list]:[this.$list,this.$label,l];this.$element.append(this.$input,...d);return}const c=v(`<span class="text-primary">${t}</span>`);if(s){const d=v(`<i class="icon icon-${s} mr-1"></i>`);c.prepend(d)}this.$label=v(`<label class="draggable-area col justify-center items-center cursor-pointer block w-full h-16" for="${e}"></label>`).append(c).append(l),this.bindDragEvent();const h=n==="bottom"?[this.$label,this.$list]:[this.$list,this.$label];this.$element.append(this.$input,...h)}bindDragEvent(){this.$label.on("dragover",e=>{e.preventDefault(),this.$label.hasClass("border-primary")||(this.$label.removeClass("border-gray"),this.$label.addClass("border-primary")),this.$label.hasClass("dragover")||this.$label.addClass("dragover")}).on("dragleave",e=>{e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover")}).on("drop",e=>{var s;e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover");const t=Array.from(((s=e.dataTransfer)==null?void 0:s.files)??[]);console.log(e.dataTransfer.files),this.addFileItem(t)})}initFileInputCash(){const{name:e,multiple:t,accept:s}=this.options;this.$input=v("<input />").addClass("hidden").prop("type","file").prop("name",e).prop("id",e).prop("multiple",t).on("change",n=>{const r=n.target.files;if(!r)return;const o=[...r];this.addFileItem(o)}),s&&this.$input.prop("accept",s)}addFile(e){const{multiple:t,onSizeChange:s}=this.options;t||(this.renameMap.clear(),this.fileMap.clear(),this.dataTransfer.items.clear(),this.currentBytes=e.size),this.renameMap.set(e.name,e.name),this.fileMap.set(e.name,e),this.dataTransfer.items.add(e),this.$input.prop("files",this.dataTransfer.files),this.currentBytes+=e.size,s==null||s(this.currentBytes)}renameDuplicatedFile(e){if(!this.fileMap.has(e.name))return e;const t=e.name.lastIndexOf(".");if(t===-1)return this.renameDuplicatedFile(new File([e],`${e.name}(1)`));const s=e.name.substring(0,t),n=e.name.substring(t);return this.renameDuplicatedFile(new File([e],`${s}(1)${n}`))}filterFiles(e){const{accept:t}=this.options;if(!t)return e;const s=t.replace(/\s/g,"").split(","),n=[],r=[],o=[];return s.forEach(a=>{a.endsWith("/*")?r.push(a.substring(0,a.length-1)):a.includes("/")?n.push(a):a.startsWith(".")&&o.push(a)}),e.filter(a=>n.includes(a.type)||r.some(l=>a.type.startsWith(l))||o.some(l=>a.name.endsWith(l)))}addFileItem(e){e=this.filterFiles(e);const{multiple:t,limitCount:s,exceededSizeHint:n,onExceededSize:r,exceededCountHint:o,onExceededCount:a,onAdd:l}=this.options;if(t){for(let f of e){if(s&&this.fileMap.size>=s){a==null||a(s),o&&alert(o);return}if(this.currentBytes+f.size>this.limitBytes){r==null||r(this.limitBytes),n&&alert(n);return}f=this.renameDuplicatedFile(f);const m=l==null?void 0:l(f);if(!m)continue;f=m;const y=this.createFileItem(f);this.itemMap.set(f.name,y),this.$list.append(y)}return}if(e.length===0||e[0].size>this.limitBytes)return;let c=this.renameDuplicatedFile(e[0]);const h=l==null?void 0:l(c);if(!h)return;c=h;const d=this.createFileItem(c);this.itemMap.clear(),this.itemMap.set(c.name,d),this.$list.empty().append(d)}deleteFileItem(e){var l,c;const t=this.renameMap.get(e)??e;this.renameMap.delete(e);const s=this.fileMap.get(t);if(!s)return;const{onDelete:n,onSizeChange:r}=this.options,o=this.itemMap.get(s.name);this.itemMap.delete(s.name),o==null||o.addClass("hidden");const a=(l=o==null?void 0:o.find(".file-delete"))==null?void 0:l.data("tooltip");a&&(a.destroy(),(c=a.tooltip)==null||c.remove()),setTimeout(()=>o==null?void 0:o.remove(),3e3),n==null||n(s),this.fileMap.delete(s.name),this.currentBytes-=s.size,r==null||r(this.currentBytes),this.dataTransfer=new DataTransfer,this.fileMap.forEach(h=>this.dataTransfer.items.add(h)),this.$input.prop("files",this.dataTransfer.files)}renameFileItem(e,t){var r,o;const s=this.renameMap.get(e.name);this.renameMap.set(e.name,t),s&&(e=this.fileMap.get(s)??e);const n=this.itemMap.get(e.name);n&&(this.itemMap.set(t,n).delete(e.name),(o=(r=this.options).onRename)==null||o.call(r,t,e.name),this.fileMap.delete(e.name),this.dataTransfer=new DataTransfer,e=new File([e],t),this.fileMap.set(t,e).forEach(a=>this.dataTransfer.items.add(a)),this.$input.prop("files",this.dataTransfer.files))}createFileItem(e){const{showIcon:t}=this.options;return this.addFile(e),v('<li class="file-item my-1 flex items-center gap-2"></li>').append(t?this.fileIcon():null).append(this.createFileInfo(e)).append(this.createRenameContainer(e))}fileIcon(){const{icon:e}=this.options;return v(`<i class="icon icon-${e}"></i>`)}fileRenameBtn(){const{useIconBtn:e,renameText:t,renameIcon:s,renameClass:n}=this.options;if(e){const r=v(`<button class="btn btn-link h-5 w-5 p-0 ${n}"><i class="icon icon-${s}"></i></button>`).prop("type","button").addClass("file-action file-rename");return new Zn(r,{title:t}),r}return v("<button />").prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-rename ${n}`).html(t)}fileDeleteBtn(){const{useIconBtn:e,deleteText:t,deleteIcon:s,deleteClass:n}=this.options;if(e){const r=v(`<button class="btn btn-link h-5 w-5 p-0 ${n}"><i class="icon icon-${s}"></i></button>`).prop("type","button").addClass("file-action file-delete");return r.data("tooltip",new Zn(r,{title:t})),r}return v("<button />").html(t).prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-delete ${n}`)}fileName(e){return v(`<span class="file-name">${e}</span>`)}fileSize(e){return v(`<span class="file-size text-gray">${pt(e)}</span>`)}createFileInfo(e){const{renameBtn:t,deleteBtn:s,showSize:n}=this.options,r=v('<div class="file-info flex items-center gap-2"></div>');return r.append(this.fileName(e.name)),n&&r.append(this.fileSize(e.size)),t&&r.append(this.fileRenameBtn().on("click",o=>{r.addClass("hidden").closest(".file-item").find(".input-rename-container.hidden").removeClass("hidden");const a=v(o.target).closest("li").find("input")[0];a.focus(),a.value.lastIndexOf(".")!==-1&&a.setSelectionRange(0,a.value.lastIndexOf("."))})),s&&r.append(this.fileDeleteBtn().on("click",()=>this.deleteFileItem(e.name))),r}createRenameContainer(e){const{confirmText:t,cancelText:s,duplicatedHint:n,onDuplicated:r}=this.options,o=v('<div class="input-group input-rename-container hidden"></div>'),a=v("<input />").addClass("form-control").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).on("keydown",d=>{if(d.key==="Enter"){const f=o.closest(".file-item"),m=f.find(".file-name");if(m.html()===a.val()){o.addClass("hidden"),f.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),n&&alert(n);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),f.find(".file-info.hidden").removeClass("hidden"),m.html(a.val())}else d.key==="Escape"&&(a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden"))}),l=v("<button />").addClass("btn primary rename-confirm-btn").prop("type","button").html(t).on("click",()=>{const d=o.closest(".file-item"),f=d.find(".file-name");if(f.html()===a.val()){o.addClass("hidden"),d.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),n&&alert(n);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),d.find(".file-info.hidden").removeClass("hidden"),f.html(a.val())}),c=v("<button />").prop("type","button").addClass("btn rename-cancel-btn").html(s).on("click",()=>{a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden")}),h=v('<div class="btn-group"></div').append(l).append(c);return o.append(a).append(h)}}ol.NAME="Upload",ol.DEFAULT={uploadText:"上传文件",confirmText:"确定",cancelText:"取消",useIconBtn:!0,renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!0,multiple:!0,listPosition:"bottom",limitSize:!1,icon:"file-o",btnClass:"",tip:"",draggable:!1,showSize:!0,onAdd:i=>i};const yD="";class vd extends ol{init(){this.initUploadButtonItemCash(),this.options.onSizeChange=()=>{this.$uploadInfo.html(this.options.totalCountText.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.fileMap.size>0?(this.$tip.remove(),this.$list.append(this.$uploadButtonItem)):(this.$uploadButtonItem.remove(),this.$label.append(this.$tip))},super.init(),this.$list.addClass("flex")}initUploadButtonItemCash(){this.$uploadButtonItem=v(`<label class="upload-button-item order-last" for="${this.options.name}" />`).addClass("flex justify-center items-center cursor-pointer").css({width:120,height:120,background:"var(--color-slate-100)"}).append(v('<i class="icon icon-plus" />'))}initUploadCash(){const{name:e,tip:t,uploadText:s,uploadIcon:n,totalCountText:r}=this.options;this.$list=v('<ul class="file-list py-1 flex-wrap gap-x-4 gap-y-4"></ul>'),this.$label=v('<div class="draggable-area relative block w-full border border-dashed border-gray"></div>').css({minHeight:64});const o=v(`<label for="${e}" class="text-primary cursor-pointer">${s}</label>`);if(n){const a=v(`<i class="icon icon-${n} mr-1"></i>`);o.prepend(a)}this.$tip=v('<div class="absolute inset-0 col justify-center items-center"></div>').append(o),t&&this.$tip.append(v(`<span class="upload-tip">${t}</span>`)),this.$label.append(this.$tip),this.$label.append(this.$input,this.$list),this.bindDragEvent(),this.$element.append(this.$label),this.$uploadInfo=v('<div class="py-1" />').css({color:"var(--color-slate-500)"}).html(r.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.$element.append(this.$uploadInfo)}filterFiles(e){const{accept:t}=this.options;if(t==="image/*")return e.filter(n=>n.type.includes("image"));const s=t.replace(/\s/g,"").replace(/\./g,"image/").split(",");return e.filter(n=>s.includes(n.type))}createFileItem(e){const t=super.createFileItem(e).addClass("relative").removeClass("flex items-center gap-2 my-1");this.setImageUrl(e,t);const{deleteBtn:s,showSize:n}=this.options;return s&&t.append(this.fileDeleteBtn().addClass("absolute right-0 top-0 text-white").css({background:"var(--color-slate-500)"}).on("click",()=>this.deleteFileItem(e.name))),n&&t.append(this.fileSize(e.size).addClass("file-size label text-white circle darker absolute px-1 hidden").removeClass("text-gray").css({top:96,left:4})),t}setImageUrl(e,t){const s=new FileReader;s.onload=()=>{v('<div class="img flex-none" />').addClass("rounded").css({backgroundImage:`url(${s.result})`,backgroundSize:"cover"}).prependTo(t)},s.readAsDataURL(e)}createFileInfo(e){const t=this.fileRenameBtn().addClass("flex-none").on("click",n=>{const r=v(n.target).closest(".file-item");r.find(".file-info").addClass("hidden"),r.find(".input-rename-container").removeClass("hidden");const o=r.find("input")[0];o.focus(),o.value.lastIndexOf(".")!==-1&&o.setSelectionRange(0,o.value.lastIndexOf("."))});return v('<div class="file-info flex justify-between items-center"></div>').css({width:120}).append(v(`<div class="file-name py-1 ellipsis">${e.name}</div>`)).append(t)}createRenameContainer(e){const{duplicatedHint:t,onDuplicated:s}=this.options,n=v("<input />").addClass("input-rename-container border-primary border hidden").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).css({width:120}).on("keydown",r=>{if(r.key==="Enter"){const o=n.closest(".file-item").find(".file-name");if(o.html()===n.val()){n.addClass("hidden"),o.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(n.val())){s==null||s(n.val()),t&&alert(t);return}this.renameFileItem(e,n.val()),n.addClass("hidden"),o.html(n.val()).closest(".file-info").removeClass("hidden")}else r.key==="Escape"&&n.val(e.name).addClass("hidden").closest(".file-item").find(".file-name").removeClass("hidden")}).on("blur",()=>{const r=n.closest(".file-item").find(".file-name");if(r.html()===n.val()){n.addClass("hidden"),r.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(n.val())){s==null||s(n.val()),t&&alert(t);return}this.renameFileItem(e,n.val()),n.addClass("hidden"),r.html(n.val()).closest(".file-info").removeClass("hidden")});return n}}vd.NAME="UploadImgs",vd.DEFAULT={uploadText:"添加文件",renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!1,multiple:!0,limitSize:!1,btnClass:"",draggable:!0,accept:"image/jpg, image/jpeg, image/gif, image/png",showSize:!0,useIconBtn:!0,totalCountText:'共 <span class="font-bold text-black">%s</span> 个文件 <span class="font-bold text-black">%s</span> 个文件等待上传。'};class K0 extends ae{constructor(){super(...arguments),this._element=ye()}get sidebar(){return this._sidebar}componentDidMount(){const{current:e}=this._element;if(e){const{className:t,style:s,children:n,contentClass:r,contentStyle:o,...a}=this.props;this._sidebar=new qr(e,a)}}componentWillUnmount(){var e;(e=this._sidebar)==null||e.destroy()}render(e){const{className:t="w-40",side:s="left",style:n,children:r,contentClass:o,contentStyle:a}=e;return k("div",{ref:this._element,className:K(`sidebar side-bar-${s}`,t),style:n,children:k("div",{className:K("sidebar-content",o),style:a,children:r})})}}class q0 extends Ke{_getClassName(e){return[super._getClassName(e),"container-with-side"]}}const G0="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ft=(i=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)e+=G0[t[i]&63];return e};const Z0={newChat:"新对话",recentChats:"最近对话",untitledChat:"未命名对话",deleteChat:"删除对话",sendboxPlaceholder:"输入消息...",noMessagesTip:"暂无消息，快来跟我对话吧~",selectChatTip:"请从左侧选择一个对话",deleteConfirm:"确定删除对话“{title}”吗？",close:"关闭",send:"发送",rename:"重命名",copy:"复制",copied:"已复制",maximize:"最大化",minimize:"最小化",loading:"加载中...",searchChats:"搜索对话",selectModel:"选择模型",defaultModel:"默认模型",processing:"正在处理...",thinking:"正在思考...",thinkCompleted:"思考完成",updateTitle:"更新标题",timeConsuming:"耗时{time}s",completed:"已完成",toolCalling:"调用工具",functionCallingConfirm:"确定要执行该工具吗？",noChatModelHint:"没有可用的对话模型，请检查模型配置",needSubmitFormFirst:"请先填写并提交表单",formSubmitted:"已提交表单",toolCallingStatus:{wait:"等待执行",running:"执行中...",finished:"已完成",error:"错误",cancelled:"已取消"},toolCallingMessages:{wait:"正在生成数据...",running:"正在执行...",finished:"已完成",error:"发生了错误",cancelled:"用户已终止执行"},dateGroup:{today:"今天",yesterday:"昨天",thisMonth:"本月",thisWeek:"本周",other:"其他"},errors:{loadDataFailed:"加载数据失败，请稍后重试",loadChatFailed:"加载对话数据失败",createChatFailed:"创建对话失败，请稍后重试",postMessageFailed:"请求失败，请稍后重试","Internal Server Error":"服务器错误，请稍后重试",unauthorized:"未授权，请联系管理员检查应用 ID 和应用密钥",configNotValid:"配置不正确，请联系管理员检查配置",zaiConfigNotValid:"ZAI 配置不正确，ZAI 服务地址、应用 ID 和应用 Token 不能为空，请联系管理员检查配置",code:{invalid_api_key:"授权失败，无效的 API 密钥，请联系管理员检查应用 ID 和应用密钥"}},zentaoAgentResult:{changeTitleFormat:"变更{type} {id}",dataListSizeInfo:"共 {0} 条数据",notSupportPreview:"暂不支持预览该内容",changeProp:"属性",changeDetail:"变更详情",applyFormFormat:"应用到{0}表单",applyFormSuccess:"已成功应用到{0}表单"},taskStatus:{wait:"未开始",doing:"进行中",done:"待验收",fail:"执行失败",closed:"已关闭",cancel:"已取消"},taskNoMessagesTip:"暂无消息。",taskStatusMessage:{wait:"执行等待中，请稍后查看。",doing:"任务正在执行..."},taskVerifyTip:"请输入补充要求",taskVerifyPass:"验收通过",taskVerifyPassFailed:"验收失败，请稍后重试",taskVerifyPassSuccess:"验收通过成功",taskVerifyRefine:"继续完善"},Y0={newChat:"新對話",untitledChat:"未命名對話",deleteChat:"刪除對話",sendboxPlaceholder:"輸入訊息...",noMessagesTip:"尚無訊息，快來跟我對話吧~",selectChatTip:"請從左側選擇一個對話",deleteConfirm:"確定刪除對話“{title}”嗎？",close:"關閉",send:"發送",rename:"重命名",copy:"複製",copied:"已複製",maximize:"最大化",minimize:"最小化",loading:"加載中...",searchChats:"搜索對話",selectModel:"選擇模型",defaultModel:"預設模型",processing:"正在處理...",thinking:"正在思考...",thinkCompleted:"思考完成",updateTitle:"更新標題",timeConsuming:"耗時{time}s",completed:"已完成",toolCalling:"調用工具",functionCallingConfirm:"確定要執行該工具嗎？",noChatModelHint:"沒有可用的對話模型，請檢查模型配置",needSubmitFormFirst:"請先填寫並提交表單",formSubmitted:"已提交表單",toolCallingStatus:{wait:"等待執行",running:"執行中...",finished:"已完成",error:"錯誤",cancelled:"已取消"},toolCallingMessages:{wait:"正在生成數據...",running:"正在執行...",finished:"已完成",error:"發生了錯誤",cancelled:"用戶已終止執行"},dateGroup:{today:"今天",yesterday:"昨天",thisMonth:"本月",thisWeek:"本周",other:"其他"},errors:{loadDataFailed:"加載數據失敗，請稍後重試",loadChatFailed:"加載對話數據失敗，請稍後重試",createChatFailed:"創建對話失敗，請稍後重試",postMessageFailed:"請求失敗，請稍後重試","Internal Server Error":"服務器錯誤，請稍後重試",unauthorized:"未授權，請聯系管理員檢查應用 ID 和應用密鑰",configNotValid:"配置不正確，請聯系管理員檢查配置",zaiConfigNotValid:"ZAI 配置不正確，ZAI 服務地址、應用 ID 和應用 Token 不能為空，請聯系管理員檢查配置",code:{invalid_api_key:"授權失敗，無效的 API 密鑰，請聯系管理員檢查應用 ID 和應用密鑰"}},zentaoAgentResult:{changeTitleFormat:"變更{type} {id}",dataListSizeInfo:"共 {0} 條數據",notSupportPreview:"暫不支持預覽該內容",changeProp:"屬性",changeDetail:"變更詳情",applyFormFormat:"應用到{0}表單",applyFormSuccess:"已成功應用到{0}表單"},taskStatus:{wait:"未開始",doing:"進行中",done:"待驗收",fail:"執行失敗",closed:"已關閉",cancel:"已取消"},taskNoMessagesTip:"尚無消息。",taskStatusMessage:{wait:"執行等待中，請稍後查看。",doing:"任務正在執行..."},taskVerifyTip:"請輸入補充要求...",taskVerifyPass:"驗收通過",taskVerifyPassFailed:"驗收失敗，請稍後重試",taskVerifyPassSuccess:"驗收通過成功",taskVerifyRefine:"繼續完善"},J0={newChat:"New Chat",untitledChat:"Untitled Chat",deleteChat:"Delete Chat",sendboxPlaceholder:"Enter message...",noMessagesTip:"No messages yet, let's chat with me~",selectChatTip:"Please select a chat from the left panel.",deleteConfirm:'Are you sure you want to delete the chat "{title}"?',close:"Close",send:"Send",rename:"Rename",copy:"Copy",copied:"Copied",maximize:"Maximize",minimize:"Minimize",loading:"Loading...",searchChats:"Search chats",selectModel:"Select Model",defaultModel:"Default Model",processing:"Processing...",thinking:"Thinking...",thinkCompleted:"Thinking completed",updateTitle:"Update Title",timeConsuming:"Time consuming {time}s",completed:"Completed",toolCalling:"Call Tools",functionCallingConfirm:"Are you sure you want to execute the tool?",noChatModelHint:"No chat model available, please check the model configuration",needSubmitFormFirst:"Please fill in the form and submit it first",formSubmitted:"Form submitted",toolCallingStatus:{wait:"Waiting",running:"Running...",finished:"Completed",error:"Error",cancelled:"Cancelled"},toolCallingMessages:{wait:"Generating data...",running:"Running...",finished:"Completed",error:"Error",cancelled:"Cancelled"},dateGroup:{today:"Today",yesterday:"Yesterday",thisMonth:"This Month",thisWeek:"This Week",other:"Other"},errors:{loadDataFailed:"Load data failed, try again later.",loadChatFailed:"Load chat failed, try again later.",createChatFailed:"Create chat failed, try again later.",postMessageFailed:"Request failed, try again later.","Internal Server Error":"Server error, try again later.",unauthorized:"Unauthorized, please contact the administrator to check the application ID and application key.",configNotValid:"Config is not valid, please contact the administrator to check the config.",zaiConfigNotValid:"ZAI config is not valid, ZAI service address, application ID and application token cannot be empty, please contact the administrator to check the config.",code:{invalid_api_key:"Authorization failed, invalid API key, please contact the administrator to check the application ID and application key."}},zentaoAgentResult:{changeTitleFormat:"Change {type} {id}",dataListSizeInfo:"Total {0} items",notSupportPreview:"Not supported preview this content",changeProp:"Property",changeDetail:"Change detail",applyFormFormat:"Apply to {0} form",applyFormSuccess:"Successfully applied to {0} form"},taskStatus:{wait:"Waiting",doing:"Doing",done:"Pending review",fail:"Failed",closed:"Closed",cancel:"Canceled"},taskNoMessagesTip:"No messages yet.",taskStatusMessage:{wait:"Execution waiting, please check later.",doing:"Task is running..."},taskVerifyTip:"Please enter the supplement requirements...",taskVerifyPass:"Pass review",taskVerifyPassFailed:"Review failed, please try again later.",taskVerifyPassSuccess:"Review passed successfully",taskVerifyRefine:"Continue to improve"};Pe.addLang({zh_cn:{ai:Z0},zh_tw:{ai:Y0},en:{ai:J0}});function Se(i,e,t){return Pe.getLang(`ai.${i}`,e,t)}class Gr{constructor(e){this._alias=xe(()=>{const t=this._options$.value.alias;return t!=null&&t.length?new Set(Array.isArray(t)?t:[t]):new Set}),this._options$=pe(e)}get code(){return this._options$.value.code}get name(){return this._options$.value.name}get desc(){return this._options$.value.desc}get icon(){return this._options$.value.icon}get options(){return this._options$.value}get tools(){return this._options$.value.tools}get welcome(){return this._options$.value.welcome}get alias(){return this._alias.value}getTitle(e,t){const s=this.options.title;return typeof s=="function"?s(e,t||{}):s??e}getPrompt(e,t){const s=this.options.prompt;return typeof s=="function"?s(e,t||{}):s??e}getMemory(e,t){const s=this.options.memory;return typeof s=="function"?s(e,t||{}):s??void 0}getTools(e){const t=this.options.tools;return typeof t=="function"?t.call(this,e):t||[]}static define(e,t){return new Gr({code:e,name:e,...t})}}function X0(i){return Object.fromEntries(Object.entries(i).map(([e,t])=>[e,new Gr({...t,code:e})]))}const al=class ws{constructor(e){var t;this._methods={},this._events={},this._contextProviders={},this._options$=pe({...e}),this._agents$=pe(X0(e.agents||{})),this._suggestions$=pe(e.suggestions||[]),this._methods={...e.methods},this._events={...e.events},this._i18n={...e.i18n},(t=e.contextProviders)==null||t.forEach(this.defineContextProvider.bind(this))}get code(){return this._options$.value.code}get name(){return this.tryGetLangText(this._options$.value.name)}get desc(){return this.tryGetLangText(this._options$.value.desc)}get icon(){return this._options$.value.icon}get options(){return this._options$.value}get agents(){return this._agents$.value}get suggestions(){return this._suggestions$.value}get methods(){return this._methods}get events(){return this._events}get contextProviders(){return Object.values(this._contextProviders)}tryGetLangText(e){if(!(e!=null&&e.length))return e;if(e.startsWith("{{")&&e.endsWith("}}")){const t=e.slice(2,-2).trim();return this.getLang(t,[],e)}return e}getLang(e,t,s){return Pe(this._i18n,e,t,s)}getAgent(e){return this._agents$.value[e]||Object.values(this._agents$.value).find(t=>t.alias.has(e))}defineAgent(e,t){const s=this.agents;return this._agents$.value={...s,[e]:new Gr({...t,code:e})},this}formatCommand(e,t){return e[0]==="."?e=`${t}~${this.code}${e}`:e[0]==="~"&&(e=`${t}${e}`),e}defineSuggestion(e){return this._suggestions$.value=[...this.suggestions,e],this}getSuggestions(e){return this.suggestions.reduce((t,s)=>{if(!s.when||s.when(e)){const{command:n,title:r,items:o,hint:a,...l}=s,c={...l,_plugin:this.code,command:typeof n=="string"?this.formatCommand(n,e.commandScope):n,title:this.tryGetLangText(r)??r,hint:this.tryGetLangText(a)??a};if(o){const h=typeof o=="function"?o(e):o;Array.isArray(h)&&h.forEach(d=>{(!d.when||d.when(e))&&t.push({...c,...d})})}else t.push(c)}return t},[])}getContextProviderFromDefinition(e){const{code:t,title:s,hint:n,...r}=e;return{...r,$provider:!0,code:t,plugin:this.code,title:this.tryGetLangText(s)??s,hint:this.tryGetLangText(n)??n}}defineContextProvider(e){const t=this.getContextProviderFromDefinition(e);return this._contextProviders[t.code]=t,this}defineMethod(e,t){return this._methods[e]=t,this}callMethod(e,t,...s){var n;return(n=this._methods[t])==null?void 0:n.call(this,e,...s)}bindEvent(e,t){return this._events[e]=t,this}triggerEvent(e,t,s){var n;(n=this._events[t])==null||n.call(this,e,s)}attach(e){return this.callCallback("onAttach",e)}detach(e){return this.callCallback("onDetach",e)}defineCallback(e,t){return this._options$.value[e]=t,this}hasCallback(e){return!!this._options$.value[e]}callCallback(e,...t){const s=this._options$.value[e];if(s)return s.apply(this,t)}getToolsMap(){const e=new Map,t=(s,n)=>{if(Array.isArray(s)){s.forEach(o=>t(o,n));return}n=Array.isArray(n)?n:[n];const r=e.get(s)||[];e.set(s,[...r,...n])};return Object.entries(this._agents$.value).forEach(([s,{name:n,tools:r,alias:o}])=>{!(r!=null&&r.length)||!Array.isArray(r)||(t([`@${n}`,`@${s}`,...Array.from(o).map(a=>`@${a}`)],r),r.forEach(a=>{t(`@${n}/${a.name}`,a);const{shortcuts:l=!0}=a;l&&t(l===!0?a.name:l,a)}))}),e}static use(e){return e==="ALL"?ws.all.value:(e=Array.isArray(e)?e:[e],e.reduce((t,s)=>{if(typeof s=="string"){const n=ws.map.value.get(s);n&&(s=n)}else typeof s=="object"&&!(s instanceof ws)&&(s=new ws(s));return s instanceof ws?t.push(s):console.warn(`[AIPlugin] Use invalid plugin: ${s}`),t},[]))}static define(e,t){const s=new ws({...t,code:e});return ws.all.value=[...ws.all.value,s],s}static remove(e){const t=ws.all.value,s=t.findIndex(n=>n.code===e);s!==-1&&(t.splice(s,1),ws.all.value=[...t])}};al.all=pe([]),al.map=xe(()=>{const i=al.all.value;return new Map(i.map(e=>[e.code,e]))});let _d=al;function Sg(i=[],e){const{noDisabled:t}=e||{},s=[...i],n=[],r=new Set;for(let o=s.length-1;o>=0;o--){const a=s[o];if(t&&a.disabled)continue;const{code:l}=a;r.has(l)||(r.add(l),n.unshift(a))}return n}function Tg(i,e){var n,r;const t=((n=e.$local)==null?void 0:n.tools)||[],s=((r=i.$local)==null?void 0:r.tools)||[];return{...i,...e,$local:{...i.$local,...e.$local,tools:Array.from(new Set([...s,...t]))},custom_data:{...i.custom_data,...e.custom_data},settings:{...i.settings,...e.settings}}}const tn="$global";function Q0(i,e){const{globalMemory:t}=e||{};i=Array.isArray(i)?i:[i];const s={collections:[],content_filter:{}},n=new Set;for(const r of i){r.collections.forEach(h=>{h===tn&&t&&(h=t),!(!h||n.has(h))&&(n.add(h),s.collections.push(h))});const{attrs:o,...a}=s.content_filter||{},{attrs:l,...c}=r.content_filter||{};s.content_filter=v.extend(!0,a,c),o&&l?(Object.keys(l).forEach(h=>{const d=l[h];let f=o[h];f===void 0?o[h]=d:((!f||typeof f!="object")&&(f={$in:[f]}),f.$in||(f={$in:[]}),f.$in.push(d)),o[h]=f}),s.content_filter.attrs=o):s.content_filter.attrs=o||l}return s}function $g(i,...e){const t=e.reduce((s,n)=>(n.refs&&(s.refs=[...s.refs||[],...n.refs]),n.taskResults&&(s.taskResults=[...s.taskResults||[],...n.taskResults]),Object.keys(n).forEach(r=>{r!=="refs"&&r!=="taskResults"&&n[r]!==void 0&&(s[r]=n[r])}),s),{...i});return t.refs&&!t.refs.length&&delete t.refs,t}function Dg(i){return i.type?i.type==="task":i.id.startsWith("task-")}function bd(i,e=`
`){return typeof i=="string"?i.trim():i.reduce((t,s)=>`${t}${e}${s.trim()}`,"").trim()}function Ig(i){const e=[],t=[],s={},n=[],r=[];for(const c of i){if(typeof c=="string"){t.push(c);continue}const{role:h,content:d="",invisibleContent:f="",custom_data:m={}}=c;if(h==="tool")n.push(c);else if(h==="system")d.length&&e.push(d);else if(h==="assistant")r.push(c);else if(h==="user"&&d.length)if(m.invisible)e.push(d);else{const y=m.invisiblePromptIndex;typeof y=="number"?(e.push(d.slice(0,y)),t.push(d.slice(y))):t.push(d)}f.length&&e.push(f),Object.keys(m).length&&Object.assign(s,m)}const o=[],a=bd(t,`

`),l=bd(e,`

`);if(a.length||l.length){let c=l;a.length&&(c=`${c}
${a}`),a.length?l.length&&(s.invisiblePromptIndex=l.length,delete s.invisible):(s.invisible=!0,delete s.invisiblePromptIndex),o.push({role:"user",content:c,custom_data:s})}return r.length&&o.push(...r),n.length&&r.some(c=>{var h;return(h=c.tool_calls)==null?void 0:h.length})&&o.push(...n),o}class Mg{constructor(e){this._revokeEventTimers=new Map,this._context=xe(()=>({store:this._store,events:this.events,state:this.state,panel:this._panel,commandScope:this.commandScope})),this._pluginMap=xe(()=>this.plugins.reduce((t,s)=>(t.set(s.code,s),t),new Map)),this._suggestions=xe(()=>{const t=[],s=this._context.value;return this._plugins$.value.forEach(n=>{t.push(...n.getSuggestions(s))}),t.sort((n,r)=>(r.priority??0)-(n.priority??0))}),this._contextProviders=xe(()=>{const t=new Map;return this._plugins$.value.forEach(s=>{s.contextProviders.forEach(n=>{t.set(n.code,n)})}),t}),this._toolsMap=xe(()=>this.plugins.reduce((t,s)=>(s.getToolsMap().forEach((r,o)=>{t.has(o)?t.get(o).push(...r):t.set(o,r)}),t),new Map)),this._agentsMap=xe(()=>this.plugins.reduce((t,s)=>(Object.entries(s.agents).forEach(([n,r])=>{t.set(n,r),t.set(`${s.code}.${r.code}`,r),r.alias.forEach(o=>{t.set(o,r)})}),t),new Map)),this._plugins$=pe(_d.use(e.plugins||[])),this._state$=pe({events:{},selectedText:"",lastSelectedText:""}),this._store=e.store,this.plugins.forEach(t=>{t.attach(this.context)})}get toolsMap(){return this._toolsMap.value}get agentsMap(){return this._agentsMap.value}get commandScope(){var e;return((e=this._panel)==null?void 0:e.commandScope)??"ai"}get pluginMap(){return this._pluginMap.value}get context(){return this._context.value}get suggestions(){return this._suggestions.value}get suggestions$(){return this._suggestions}get contextProviders(){return Array.from(this._contextProviders.value.values()).sort((e,t)=>t.order-e.order)}get contextProviders$(){return this._contextProviders}get plugins(){return this._plugins$.value}get state(){return this._state$.value}get state$(){return this._state$}get events(){return this._state$.value.events}get selectedChat(){const{selectedChatID:e}=this.state;return e?this._store.getChat(e):void 0}getContext(e){return{...this.context,...e}}getChat(e){return e?typeof e=="string"&&(e=this._store.getChat(e)):e=this.selectedChat,e}getTools(e){var m;const{chatTools:t=[],extraTools:s=[],agents:n=[],chat:r,message:o}=e,{toolsMap:a}=this,l=[],c=((m=e.userPrompt)==null?void 0:m.trim())??"",h=(...y)=>{for(const b of y)typeof b=="string"?l.push(...a.get(b)||[]):l.push(b)};if(h(...t),n.length){const y=this.getContext({...this.context,chat:r,message:o,userPrompt:c});n.forEach(b=>{if(typeof b=="string"){const x=this.getAgent(b);if(!x)return;b=x}const w=b.getTools(y);h(...w)})}c.length&&a.forEach((y,b)=>{(c.startsWith(`/${b} `)||c.includes(` /${b} `)||c.endsWith(` /${b}`))&&h(...y)}),h(...s);const d=new Set,f=[];for(let y=l.length-1;y>=0;y--){const b=l[y];d.has(b.name)||(f.unshift(b),d.add(b.name))}return f}getContextProvider(e){return this._contextProviders.value.get(e)}getChatContextProviders(e,t){const s=this.getContext({chat:e});return(t||this.contextProviders).reduce((n,r)=>{if(!r.when||r.when(s)){const{command:o,display:a,when:l,...c}=r,h=this.getPlugin(r.plugin);n.push({...c,command:typeof o=="string"&&h?h.formatCommand(o,s.commandScope):o,...a?a.call(this,s):{}})}return n},[])}async getSubChatContextProviders(e,t){let{items:s=[]}=t;const n=this.context;typeof s=="function"&&(s=await s(n));const r=this.getPlugin(t.plugin);return this.getChatContextProviders(e,s.map(o=>r.getContextProviderFromDefinition(o)))}getChatContextSettingsFromProvider(e){const{chat:t,providerOrName:s,userPrompt:n="",onlyGenerate:r}=e,o=typeof s=="string"?this.getContextProvider(s):s;if(!o)return[];const{code:a,title:l,icon:c,data:h,generate:d}=o,f=this.getPlugin(o.plugin),m={plugin:f.code,code:a,title:l,icon:c,data:h};if(d){const y=d.call(this,this.getContext({chat:t,plugin:f,userPrompt:n}));if(y)return(Array.isArray(y)?y:[y]).map(w=>({...m,...w,autoGen:!0}));if(r)return[]}return m.data?[m]:[]}generateChatContextSettings(e){const{chat:t,contextLikes:s=[],userPrompt:n=""}=e;return s.reduce((r,o)=>(typeof o=="string"||"$provider"in o?r.push(...this.getChatContextSettingsFromProvider({chat:t,providerOrName:o,userPrompt:n})):r.push(o),r),[])}generateChatContextSettingsFromPrompt(e){const{chat:t}=e,s=e.providers||this.getChatContextProviders(t),n=e.userPrompt.trim();return n.length?s.reduce((r,o)=>(o.generate&&r.push(...this.getChatContextSettingsFromProvider({chat:t,providerOrName:o,userPrompt:n,onlyGenerate:!0})),r),[]):[]}updateLocalChatContextsFromPrompt(e,t){const s=e.$local.contexts||[],n=new Set,r=s.reduce((c,h)=>(c.set(h.code,h),h.autoGen&&!h.disabled&&n.add(h.code),c),new Map),o=[];this.generateChatContextSettingsFromPrompt({chat:e,userPrompt:t}).forEach(c=>{const h=r.get(c.code);if(h){if(h.disabled||!h.autoGen)return}else n.delete(c.code);r.set(c.code,c),o.push(c)});const l=Sg([...s.filter(c=>!n.has(c.code)),...o]);e.$local.contexts=l}getUsedChatContextSettings(e){var r;const{chat:t,noDisabled:s}=e,n=[];return t.$local.id?n.push(...t.$local.contexts||[]):n.push(...((r=t.custom_data.contexts)==null?void 0:r.map(o=>({...o,data:{}})))||[]),Sg(n,{noDisabled:s})}async getCreatingChatContextsData(e){var a;const t=e.$local.contexts||[],s=e.$local.memories||[],n=(a=e.settings)==null?void 0:a.prompt,r=e.$local.agents||[],o=[n];for(const l of r){const c=await l.getPrompt("",{chat:e});c.length&&o.push(c)}for(const l of t){let{data:c}=l;typeof c=="function"&&(c=await c.call(this,this.getContext({chat:e,contextSetting:l,plugin:this.getPlugin(l.plugin)})));const{memory:h,prompt:d}=c;h&&s.push(h),d!=null&&d.length&&o.push(d)}return{memories:s.filter(Boolean),prompt:o.filter(Boolean).join(`

`)}}async addChatContext(e,t){const s=this.getChat(e);if(!s){console.warn("[ZUI] add chat context failed, no chat provided.");return}const n=this.generateChatContextSettings({chat:s,contextLikes:[t]}),r=s.$local.contexts||[];n.forEach(o=>{const a=r.findIndex(l=>l.code===o.code);a!==-1?r[a]=o:r.push(o)}),this._store.updateChatLocalData(s.id,{contexts:[...r]})}removeChatContext(e,t){const s=this.getChat(e);if(!s){console.warn("[ZUI] remove chat context failed, no chat provided.");return}const n=s.$local.contexts||[],r=n.findIndex(o=>o.code===t);r!==-1&&(n.splice(r,1),this._store.updateChatLocalData(s.id,{contexts:[...n]}))}toggleChatContext(e,t){const s=this.getChat(e);if(!s){console.warn("[ZUI] remove chat context failed, no chat provided.");return}if(t.autoGen&&!t.disabled)this.addChatContext(s,{disabled:!0,...t});else{if((s.$local.contexts||[]).some(r=>r.code===t.code))return this.removeChatContext(s,t.code),!1;this.addChatContext(s,t)}return!0}async applyProviderContextSettings(e,t){const s=this.getChat(e);if(!s){console.warn("[ZUI] remove chat context failed, no chat provided.");return}let{contexts:n}=t;if(!n||(typeof n=="function"&&(n=await n(this.getContext({chat:s,provider:t}))),!(n!=null&&n.length)))return;const r=s.$local.contexts||[];let o=!1;for(const a of n){if(!a.data)continue;const l=r.findIndex(h=>h.code===a.code),c={...a,plugin:t.plugin};l!==-1?r[l]=c:r.push(c),o=!0}o&&this._store.updateChatLocalData(s.id,{contexts:[...r]})}getPlugin(e){return this.pluginMap.get(e)}getAgent(e){return this.agentsMap.get(e)}getAgents(e,t){var r;const s=(Array.isArray(e)?[...e]:[e]).filter(Boolean);if(t!=null&&t.startsWith("@")){const o=((r=t.split(`
`).shift())==null?void 0:r.split(" "))||[];for(let a of o){if(a=a.trim(),!/^@[\w.]+$/.test(a))break;s.push(a.slice(1))}}const n=new Set;return s.reduce((o,a)=>{const l=typeof a=="object"?a:this.agentsMap.get(a);return l&&!n.has(l)&&(n.add(l),o.push(l)),o},[])}executeCommand(e,t){if(!this._panel){console.warn("[ZUI] Execute command failed, no panel found.");return}ah(e,{event:t,execute:this._panel.executeCommand.bind(this._panel)})}acceptSuggestion(e,t){e.action&&e.action(this.context),e.command&&this.executeCommand(e.command,t)}hasPluginMethod(e){const[t,s]=e.split("."),n=this.pluginMap.get(t);return!!n&&!!n.methods[s]}callPluginMethod(e,...t){const[s,n]=e.split("."),r=this.pluginMap.get(s);if(!r||!r.methods[n])throw new Error(`Plugin ${s} method ${n} not found.`);return r.callMethod(this.context,n,...t)}async callPluginsCallback(e,t,s){const{plugins:n}=this;for(const r of n){if(!r.hasCallback(e))continue;let o,a;try{o=await r.callCallback(e,...t)}catch(l){a=new Error(`[ZUI] Call plugin ${r.code} callback ${e} failed: ${String(a)}`,{cause:l}),console.warn(a)}if(s&&await s(o,a,r)===!1)return!1}}selectChat(e){this.setState({selectedChatID:e})}setPanel(e){this._panel=e}setState(e){const t=this._state$.value,s={};Object.keys(e).forEach(n=>{e[n]!==t[n]&&(s[n]=e[n])}),Object.keys(s).length&&(this._state$.value={...t,...s})}trigger(e,t,s,n){const r={type:e,data:t||{},time:Date.now(),gid:Xe()},o={events:{...this._state$.value.events,[e]:r},lastEvent:r,...s};if(this.setState(o),n!=null&&n.lifeTime){this._revokeEventTimers.has(e)&&window.clearTimeout(this._revokeEventTimers.get(e));const a=window.setTimeout(()=>{this.revokeEvent(e)},n.lifeTime);this._revokeEventTimers.set(e,a)}this.plugins.forEach(a=>{a.triggerEvent(this.context,e,r.data)})}revokeEvent(e){this._revokeEventTimers.delete(e);const t=this._state$.value.events,s=t[e];if(!s)return;delete t[e];let n=this.state.lastEvent;(n==null?void 0:n.gid)===s.gid&&(n=Object.values(t).sort((o,a)=>o.gid-a.gid)[0]);const r={events:t,lastEvent:n};this.setState(r)}destroy(){this._revokeEventTimers.forEach(e=>{window.clearTimeout(e)}),this._plugins$.value.forEach(e=>{e.detach(this.context)}),this._plugins$.value=[],this._panel=void 0}}class ns{constructor(e){this._chats=pe([]),this._chatMap=xe(()=>this._chats.value.reduce((t,s)=>(t.set(s.id,s),t),new Map)),this._loadingMap=pe({}),this._llmModels=pe([]),this._isLoading=xe(()=>!!Object.values(this._loadingMap.value).length),this._info=pe(),this._error=pe(),this._chatModels=xe(()=>this._llmModels.value.filter(t=>{var s;return(s=t.abilities)==null?void 0:s.includes("chat")})),this._sortedChats=xe(()=>this._chats.value.sort((t,s)=>(s.created_at||0)-(t.created_at||0))),this._sortedChats$=xe(()=>this._sortedChats),this._formatMessage=t=>{var n;this._options.formatMessage&&(t=this._options.formatMessage(t));let s=t.created_at||t.created_on;if(typeof s=="string"&&(this._options.useISODate&&!s.includes("Z")&&(s=s+"Z"),t.created_at=new Date(s).getTime()),t.custom_data||(t.custom_data={}),t.custom_data.invisiblePromptIndex!==void 0&&(t.invisibleContent=t.content.slice(0,t.custom_data.invisiblePromptIndex).trim(),t.content=t.content.slice(t.custom_data.invisiblePromptIndex).trim(),t.content.length||(t.custom_data.invisible=!0,delete t.custom_data.invisiblePromptIndex)),!((n=t.reasonContent)!=null&&n.length)&&t.content.startsWith("<think>")){const{content:r}=t,o=r.indexOf("</think>");o!==-1?(t.reasonContent=r.substring(0,o),t.content=r.substring(o+7)):(t.reasonContent=r,t.content=""),t.$reasonType||(t.$reasonType="thinking")}return t},this._formatChat=t=>{this._options.formatChat&&(t=this._options.formatChat(t)),t.$local||(t.$local={}),t.title===""&&(t.$local.tempTitle||(t.$local.tempTitle=this._untitledChatTitle)),t.custom_data||(t.custom_data={}),t.custom_data.type=t.custom_data.type||"chat";let s=t.created_at||t.created_on;typeof s=="string"&&(this._options.useISODate&&!s.includes("Z")&&(s=s+"Z"),t.created_at=new Date(s).getTime());let n=t.updated_at||t.updated;return typeof n=="string"&&(this._options.useISODate&&!n.includes("Z")&&(n=n+"Z"),t.updated_at=new Date(n).getTime()),t},this._context=pe(e.context),this._fetchers=e.fetchers,this._untitledChatTitle=e.defaultChatTitle??Se("untitledChat")??"New Chat",this._reactions=new Mg({store:this,plugins:e.plugins}),this._options=e,this._privs=pe(e.privs||"allow-all"),setTimeout(()=>{this.getInfo()},0)}get error(){return this._error.value}get sortedChats(){return this._sortedChats.value}get info$(){return this._info}get info(){return this._info.value}get llmProviders(){return this._llmModels.value}get chatModels(){return this._chatModels.value}get chatModels$(){return this._chatModels}get assetBaseUrl(){return this._context.value.assetBaseUrl||this._context.value.baseUrl}get context(){return this._context.value}get context$(){return this._context}get chats(){return this._chats.value}get chats$(){return this._chats}get chatMap(){return this._chatMap.value}get chatMap$(){return this._chatMap}get isLoading(){return this._isLoading.value}get isLoading$(){return this._isLoading}get reactions(){return this._reactions}get globalMemory(){return this._context.value.globalMemory}get privs(){return this._privs.value}get isDisabledAllPrivs(){return this.privs==="disable-all"}hasPriv(e){const t=this.privs;return t==="disable-all"?!1:typeof t=="object"?t[e]??!1:t==="allow-all"}isLoadingNow(e){return Object.values(this._loadingMap.value).some(t=>t.type===e)}setError(e){this._error.value=e}getChat(e){return this._chatMap.value.get(e)||this.getLocalChat(e)}getLocalChat(e){return this._chats.value.find(t=>t.$local.id===e)}setContext(e){this._context.value={...this._context.value,...e}}isConfigOK(){return!0}async getInfo(e){if(this._info.value&&!e)return this._info.value;const t=this._checkFetcher("getInfo");let s;try{s=await Ne(t,[this.context])}catch(n){console.error("[ZUI] getInfo error",n)}return this._info.value=s,s}async isOK(){if(this.setError(),!this.isConfigOK())return this._error.value||this.setError({message:Se("errors.configNotValid")||"The config is not valid.",type:"configNotValid"}),!1;const t=await this.getInfo();return!t||typeof t!="object"||!t.version?!1:(await this.getLlmModels(),!this.error)}async extractFile(e){const t=this._checkFetcher("extractFile");return await Ne(t,[this.context,e])}async tryLoadChat(e){var s;const t=this.getChat(e);t?t!=null&&t.messages||(await this.getMessages(e),(s=t.messages)!=null&&s.length&&await this.tryUpdateChatTitle(t)):await this.loadChat(e,!0),this._llmModels.value.length||await this.getLlmModels()}async buildChat(e,t){const{localID:s="",title:n="",tempTitle:r=this._untitledChatTitle,model:o=this.context.defaultModel,agent:a=[],welcome:l,type:c,data:h,userPrompt:d,prompt:f,contexts:m,tools:y,memories:b,form:w,formData:x,customData:D}=e||{},I=Array.isArray(a)?a:[a],E=this.reactions.getAgents(I,d);let P={id:s,title:n,messages:[],custom_data:{agents:E.map(O=>O.code),welcome:l,type:c,data:h,tools:y==null?void 0:y.reduce((O,W)=>(typeof W=="string"?O.push(W):O.push(W.name),O),[]),form:x?{data:x}:void 0,...D},settings:{model:o,prompt:f},$local:{id:s,agents:E,tools:y?this.reactions.getTools({extraTools:y}):[],userPrompt:d,contexts:[],tempTitle:n.length?void 0:r,memories:b?b.map(O=>typeof O=="string"?{collections:[O]}:O):[],creatingOptions:e,form:w?{config:w,data:x}:void 0},created_at:Date.now()};if(m&&(P.$local.contexts=this.reactions.generateChatContextSettings({chat:P,contextLikes:m,userPrompt:d}),P.custom_data.contexts=P.$local.contexts.map(O=>({code:O.code,title:O.title,icon:O.icon??"",plugin:O.plugin}))),t){let O=!1;if(await this.reactions.callPluginsCallback("onBuildChat",[{chat:P,userPrompt:d,isLocal:!!s.length}],W=>{if(W===!1)return O=!0,!1;W&&typeof W=="object"&&(P=Tg({...P},W))}),O)return}return P}async createLocalChat(e){const t=(e==null?void 0:e.localID)??Ft(),s=await this.buildChat({...e,localID:t},!0);if(s)return this._updateChats(s),t}async createChat(e){var d;const t=e==null?void 0:e.localID,s=t?this.getLocalChat(t):void 0,n=await this.buildChat({...s==null?void 0:s.$local.creatingOptions,...e,...s?{contexts:s.$local.contexts}:{},...(d=s==null?void 0:s.$local.form)!=null&&d.data?{formData:s.$local.form.data}:{},localID:""},!0);if(!n)return;const{prompt:r,memories:o}=await this.reactions.getCreatingChatContextsData(n),a=this._checkFetcher("createConversation");let l={title:jn(n.title)?n.title:n.$local.tempTitle??this._untitledChatTitle,customData:n.custom_data,settings:n.settings,memories:o,prompt:r};const c=n.$local.userPrompt;await this.reactions.callPluginsCallback("onCreateChat",[{chat:n,options:l,userPrompt:c}],f=>{f&&typeof f=="object"&&(l={...l,...f,settings:{...l.settings,...f.settings},customData:{...l.customData,...f.customData}})});const h=await Ne(a,[this.context,l]);return await this.reactions.callPluginsCallback("afterCreateChat",[{chat:h}]),this._updateChats({...n,...h,$local:{...n.$local,id:void 0,tools:n.$local.tools}}),t&&this._updateChats(this._chats.value.filter(f=>f.$local.id!==t),!0),h.id}destroy(){this._chats.value=[],this._reactions.destroy()}async deleteChat(e){const t=this.getChat(e),s=()=>{this._updateChats(this._chats.value.filter(o=>o.id!==e),!0)};if(t!=null&&t.$local.id){s();return}const n=this._checkFetcher("deleteConversation");await Ne(n,[this.context,e])!==!1&&s()}async loadChats(e){const t=this._checkFetcher("getConversations"),s=this._startLoad("loadChats");try{const n=await Ne(t,[this.context]);fn(()=>{this._updateChats(n,e)}),this._endLoad(s)}catch(n){throw this._endLoad(s),n}}async tryLoadChats(){if(!(this._chats.value.filter(e=>!e.$local.id).length||this.isLoadingNow("getConversations")))return this.loadChats(!0)}async loadChat(e,t=!1){const s=this._checkFetcher("getConversation"),n=this._startLoad("loadChat"),r=await Ne(s,[this.context,e]);if(r)this._updateChats(r),t&&await this.getMessages(e),this._endLoad(n);else throw this._endLoad(n),new Error(`Cannot load chat with id ${e}.`)}async getMessages(e,t=!0){const s=this._checkFetcher("getMessages"),n=this._startLoad("getMessages");try{const r=await Ne(s,[this.context,e]);fn(()=>this._updateChatMessages(e,r,t))}catch(r){console.error("[ZUI] getMessages error",r)}this._endLoad(n)}async getLlmModels(e=!0){let t=this._llmModels.value;if(e||!t.length){const s=this._checkFetcher("getLlmModels");t=await Ne(s,[this.context]),this._llmModels.value=t}return t}async getTextEmbeddingModel(e){const t=await this.getLlmModels(!1);return e?t.find(s=>s.id===e):t.find(s=>{var n;return(n=s.abilities)==null?void 0:n.includes("embedding")})}async ensureChat(e,t={},s){if(e==="NEW"){const r=await this.createChat(t);return r?(s==null||s.call(this,r),this.getChat(r)):void 0}const n=this.getChat(e);if(n!=null&&n.$local.id){const r=await this.createChat({localID:n.$local.id,...t});if(r)return s==null||s.call(this,r),this.getChat(r)}return n}async runTools(e,t,s){const n=t.$toolCalls;if(!(n!=null&&n.length))return[];t.$state="tools_running";const r={},o=(c,h,d,f,m)=>{const y={name:h?h.displayName??h.name:c.function.name,status:d,error:f,result:m};h!=null&&h.display&&(y.message=h.display(y)),r[c.id]=y,t.$toolCallingStates=r,this._updateChatMessages(e,t)},a=n.map(async c=>{const h=s.get(c.function.name);if(!h){o(c,h,"error",`The tool "${c.function.name}" is not found.`);return}o(c,h,"running");try{const d=JSON.parse(c.function.arguments);let f=h.confirm;typeof f=="function"&&(f=f.call(this,c));let m=!1;f&&(await Ve.confirm(typeof f=="string"?f:Se("functionCallingConfirm"))||(o(c,h,"cancelled"),m=!0));let y=await(m?h.cancel||(()=>""):h.fn).call(this,d);if(y===void 0)return;typeof y=="string"&&(y={message:y,result:y}),o(c,h,m?"cancelled":"finished",void 0,y||void 0);const{message:b,result:w}=y;if(b&&typeof b=="object")return b;if(b!==void 0||w!==void 0)return{role:"tool",tool_call_id:c.id,name:c.function.name,content:b??JSON.stringify(w)}}catch(d){console.error(`[ZUI] AIStore: run tool ${h.name} error`,d),o(c,h,"error",d.message)}});return(await Promise.all(a)).filter(Boolean)}async postFormDataToChat(e,t,s){const n=this.getChat(e);if(!n)return;const r=n.$local.form,o=r==null?void 0:r.config;if(!o)return;let a;const l=o.prompt;if(typeof l=="function"){const d=await l(t);a=typeof d=="string"?{user:d}:d}else typeof l=="string"?a={user:$e(l,t)}:l&&typeof l=="object"?a={system:jn(l.system)?$e(l.system,t):void 0,user:jn(l.user)?$e(l.user,t):void 0}:a={system:JSON.stringify(t)};let c="";typeof o.summary=="string"?c=o.summary:typeof o.summary=="function"?c=await o.summary(t):c=a.user?"":Se("formSubmitted")??"";const h=[a.system?{role:"system",content:a.system}:void 0,a.user?{role:"user",content:a.user}:void 0].filter(Boolean);return n.$local.id?this.postMessage({content:h,chat:{localID:n.$local.id,formData:t}}):(this._updateChats({id:e,$local:{form:{...r,data:t}},custom_data:{form:{summary:c,data:t}}}),await this.postMessage({content:h,chat:n.id,...s}),await this.updateChatData(n.id,{...n.custom_data,form:{summary:c,data:t}}),n.id)}async postMessage(e,t){var ne,Ce,Me,ze,He;const s=typeof e=="string"?{content:e}:{...e},n=s.content;if(!n||!(n!=null&&n.length)){console.error("[ZUI] postMessage error","The content is empty.");return}let r=Ig([...Array.isArray(n)?n:[n],...s.messages||[]]);const o=(ne=r.find(te=>te.role==="user"))==null?void 0:ne.content;console.log("> postMessage",{content:n,options:s,postContents:r,userPrompt:o});const a=typeof t=="string"?t:typeof s.chat=="string"?s.chat:"NEW",l={...typeof s.chat=="object"?s.chat:{},...typeof t=="object"?t:{},userPrompt:o},c=await Vp(this.ensureChat.bind(this),[a,l,(Ce=s.onCreateChat)==null?void 0:Ce.bind(this)]);if(!c){console.error("[ZUI] postMessage error","Cannot create or find chat before post message.");return}const h=c.id;if(c.$local.form&&!c.$local.form.data)return this._updateChats({id:h,$local:{waitingMessages:r}}),h;const d=c.$local.waitingMessages;d&&r.unshift(...d);const f=this._startLoad("postMessage");this._updateChats({id:h,$local:{generating:!0,waitingMessages:void 0}});const m=r.reduce((te,X)=>(X.role==="user"&&te.push({id:Ft(),$state:"local",created_at:Date.now(),content:"",...X}),te),[]);m.length&&this._updateChatMessages(h,m);const y={id:Ft(),role:"assistant",content:"",reasonContent:"",$state:"generating",$reasonTime:0,created_at:Date.now()};this._updateChatMessages(h,y);const b=[],w=[],x=[];s.noPlugins||await this.reactions.callPluginsCallback("onPostMessage",[{chat:c,userMessages:m,pendingMessage:y,postingMessages:r,updateState:te=>{y.$stateText=te,this._updateChatMessages(h,y)}}],te=>{te&&(te.tools&&w.push(...te.tools),te.systemPrompt&&b.push(te.systemPrompt),te.refs&&x.push(...te.refs))}),b&&(r=Ig([...r,{role:"system",content:bd(b)}]));const D={chat:c,message:y,userPrompt:o,chatTools:s.noChatTools?void 0:c.$local.tools,agents:s.noAgentTools?void 0:c.custom_data.agents,extraTools:[...s.tools||[],...w]},I=this.reactions.getTools(D),E=I.reduce((te,X)=>(te.set(X.name,X),te),new Map),P=Date.now(),O={chat:"",reason:""};let W="";const J=te=>{var Ee,Ae;let X=!1;te.content!==null&&(te.type==="chat"?y.content=`${y.content}${te.content}`:te.type==="reason"&&(y.$reasonTime=Date.now()-P,y.$reasonType=te.reasonType,y.reasonContent=`${y.reasonContent}${te.content}`),O[te.type]=`${O[te.type]}${te.content}`,y.content=O.chat,y.reasonContent=O.reason,X=!0),(Ee=te.tool_calls)!=null&&Ee.length&&(y.$toolCalls=te.tool_calls.map(We=>{var Xt;return{...We,name:((Xt=E.get(We.function.name))==null?void 0:Xt.displayName)??We.function.name}}),X=!0),te.model&&(W=te.model),X&&(this._updateChatMessages(h,y),(Ae=s==null?void 0:s.onResponse)==null||Ae.call(s,y,h))};let Y=$g(s.custom_data||{},{refs:x});Object.keys(Y).length||(Y=void 0);const[ve,ee]=r.reduce((te,X)=>(X.role==="user"?te[0]=X:te[1].push(X),te),[void 0,[]]);try{if(ve){const X=this._checkFetcher("postMessage");await Ne(X,[this.context,{id:h,content:ve.content,tools:I.length?I:void 0,messages:ee.length?ee:void 0,custom_data:ve.custom_data&&Y?$g(ve.custom_data,Y):ve.custom_data||Y},J])}else{const X=this._checkFetcher("postBatchMessages");await Ne(X,[this.context,{id:h,messages:ee,tools:I.length?I:void 0},J])}y.created_at=Date.now();const te=y.$toolCalls||[];if(te.length){const X=await this.runTools(h,y,E);X.some(Ee=>Ee.role==="tool")&&X.push({role:"assistant",tool_calls:te,content:"工具调用完成",custom_data:{test:Date.now()}}),X.length&&this.postMessage({content:X,chat:h,noAgentTools:!0,noChatTools:!0,noPlugins:!0})}y.$state="synced",c.custom_data.type!=="temp"&&this.tryUpdateChatTitle(c,1e3)}catch(te){console.error("[ZUI] postMessage error",te),y.$state="error",y.$error=Se(`errors.${te.message}`)||Se("errors.postMessageFailed"),y.created_at=Date.now()}return this._updateChatMessages(h,y),this._updateChats({id:h,$local:{generating:!1},...W?{custom_data:{model:W}}:{}}),this._endLoad(f),(Me=s.onFinish)==null||Me.call(s,y,h),W&&!((ze=c.settings)!=null&&ze.model)&&((He=c.custom_data)==null?void 0:He.model)!==W&&this.updateChatData(h,{model:W}),h}postTempMessage(e){const t=typeof e=="string"?{content:e}:e;return new Promise((s,n)=>{this.postMessage({...t,chat:{type:"temp"},onFinish:(r,o)=>{s({message:r,chat:this.getChat(o)})}},t.chat).then(r=>{r&&this.deleteChat(r)}).catch(n)})}async generateContentTitle(e){const t=typeof e=="string"?{content:e}:e,n=(await this.postTempMessage({...t,chat:{agent:"generateTitle"}})).message.content;return Array.isArray(n)?n.join(""):n}async updateChatTitle(e){const t=this._checkFetcher("getConversationTitle");try{const s=await Ne(t,[this.context,e]),n=this.getChat(e);n&&s&&(n.title=s.title,delete n.$local.tempTitle,this._updateChats(n))}catch(s){console.error("[ZUI] Update chat title error",s)}}async tryUpdateChatTitle(e,t=0){const s=typeof e=="string"?this.getChat(e):e;if(!s)return;const n=s.id;(!s.title.length||s.title===s.$local.tempTitle||s.title===this._untitledChatTitle)&&(await Ss(t),await this.updateChatTitle(n))}async renameChatTitle(e,t){const s=this._checkFetcher("updateConversation");try{const n=await Ne(s,[this.context,{title:t,id:e}]),r=this.getChat(e);r&&n&&(r.title=t,this._updateChats(r))}catch(n){console.error("[ZUI] Rename chat title error",n)}}async updateChatData(e,t){const s=this._checkFetcher("updateConversation");try{const n=this.getChat(e);if(!n)return;await Ne(s,[this.context,{id:e,custom_data:{...n.custom_data,...t}}])&&(n.custom_data={...n.custom_data,...t},this._updateChats(n))}catch(n){console.error("[ZUI] Update chat data error",n)}}updateChatLocalData(e,t){const s=this.getChat(e);s&&(s.$local={...s.$local,...t},this._updateChats(s))}updateUserPrompt(e,t){const s=this.getChat(e);s&&s.$local.userPrompt!==t&&(s.$local={...s.$local,userPrompt:t},this.reactions.updateLocalChatContextsFromPrompt(s,t),this._updateChats(s))}getAvatar(e,t,s){const n=this._options.getAvatar;if(!n)return{...s};let r=n(e,t);if(r!==!1)return typeof r=="string"&&(r.startsWith("./")||r.startsWith("/")?r={src:r}:r={icon:r}),Le({},s,r)}_checkFetcher(e){const t=this._fetchers[e];if(!t)throw new Error(`The fetcher "${e}" is not defined.`);return t}_updateChatMessages(e,t,s=!1){const n=this._chats.value,r=n.findIndex(l=>l.id===e);if(r<0)throw new Error(`The chat "${e}" is not found.`);const o=n[r],a=o.messages||[];if(t=Array.isArray(t)?t:[t],s)o.messages=t.map(this._formatMessage).sort((l,c)=>l.created_at-c.created_at);else for(const l of t){const c=a.findIndex(h=>h.id===l.id);c!==-1?a[c]=this._formatMessage({...a[c],...l}):a.push(this._formatMessage({...l})),o.messages=[...a].sort((h,d)=>h.created_at-d.created_at)}n[r]={...o},this._chats.value=[...n]}_updateChats(e,t){const s=this._chats.value;if(e=Array.isArray(e)?e:[e],t)this._chats.value=e.map(this._formatChat);else{const n=[];for(const r of e){const o=s.findIndex(a=>{var l;return a.$local.id&&a.$local.id===((l=r.$local)==null?void 0:l.id)||a.id===r.id});o!==-1?s[o]=this._formatChat(Tg(s[o],r)):n.push(this._formatChat(r))}this._chats.value=[...n,...s]}}_startLoad(e){const t=Xe();return this._loadingMap.value={...this._loadingMap.value,[t]:{startTime:Date.now(),type:e}},t}_endLoad(e){const t=this._loadingMap.value;t[e]&&(delete t[e],this._loadingMap.value={...t})}}ns.NAME="AIStore";var Ng=11;function ex(i,e){var t=e.attributes,s,n,r,o,a;if(!(e.nodeType===Ng||i.nodeType===Ng)){for(var l=t.length-1;l>=0;l--)s=t[l],n=s.name,r=s.namespaceURI,o=s.value,r?(n=s.localName||n,a=i.getAttributeNS(r,n),a!==o&&(s.prefix==="xmlns"&&(n=s.name),i.setAttributeNS(r,n,o))):(a=i.getAttribute(n),a!==o&&i.setAttribute(n,o));for(var c=i.attributes,h=c.length-1;h>=0;h--)s=c[h],n=s.name,r=s.namespaceURI,r?(n=s.localName||n,e.hasAttributeNS(r,n)||i.removeAttributeNS(r,n)):e.hasAttribute(n)||i.removeAttribute(n)}}var ll,tx="http://www.w3.org/1999/xhtml",Ht=typeof document>"u"?void 0:document,sx=!!Ht&&"content"in Ht.createElement("template"),nx=!!Ht&&Ht.createRange&&"createContextualFragment"in Ht.createRange();function ix(i){var e=Ht.createElement("template");return e.innerHTML=i,e.content.childNodes[0]}function rx(i){ll||(ll=Ht.createRange(),ll.selectNode(Ht.body));var e=ll.createContextualFragment(i);return e.childNodes[0]}function ox(i){var e=Ht.createElement("body");return e.innerHTML=i,e.childNodes[0]}function ax(i){return i=i.trim(),sx?ix(i):nx?rx(i):ox(i)}function cl(i,e){var t=i.nodeName,s=e.nodeName,n,r;return t===s?!0:(n=t.charCodeAt(0),r=s.charCodeAt(0),n<=90&&r>=97?t===s.toUpperCase():r<=90&&n>=97?s===t.toUpperCase():!1)}function lx(i,e){return!e||e===tx?Ht.createElement(i):Ht.createElementNS(e,i)}function cx(i,e){for(var t=i.firstChild;t;){var s=t.nextSibling;e.appendChild(t),t=s}return e}function wd(i,e,t){i[t]!==e[t]&&(i[t]=e[t],i[t]?i.setAttribute(t,""):i.removeAttribute(t))}var Eg={OPTION:function(i,e){var t=i.parentNode;if(t){var s=t.nodeName.toUpperCase();s==="OPTGROUP"&&(t=t.parentNode,s=t&&t.nodeName.toUpperCase()),s==="SELECT"&&!t.hasAttribute("multiple")&&(i.hasAttribute("selected")&&!e.selected&&(i.setAttribute("selected","selected"),i.removeAttribute("selected")),t.selectedIndex=-1)}wd(i,e,"selected")},INPUT:function(i,e){wd(i,e,"checked"),wd(i,e,"disabled"),i.value!==e.value&&(i.value=e.value),e.hasAttribute("value")||i.removeAttribute("value")},TEXTAREA:function(i,e){var t=e.value;i.value!==t&&(i.value=t);var s=i.firstChild;if(s){var n=s.nodeValue;if(n==t||!t&&n==i.placeholder)return;s.nodeValue=t}},SELECT:function(i,e){if(!e.hasAttribute("multiple")){for(var t=-1,s=0,n=i.firstChild,r,o;n;)if(o=n.nodeName&&n.nodeName.toUpperCase(),o==="OPTGROUP")r=n,n=r.firstChild,n||(n=r.nextSibling,r=null);else{if(o==="OPTION"){if(n.hasAttribute("selected")){t=s;break}s++}n=n.nextSibling,!n&&r&&(n=r.nextSibling,r=null)}i.selectedIndex=t}}},Zr=1,Ag=11,Pg=3,Lg=8;function wn(){}function hx(i){if(i)return i.getAttribute&&i.getAttribute("id")||i.id}function dx(i){return function(t,s,n){if(n||(n={}),typeof s=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var r=s;s=Ht.createElement("html"),s.innerHTML=r}else s=ax(s);else s.nodeType===Ag&&(s=s.firstElementChild);var o=n.getNodeKey||hx,a=n.onBeforeNodeAdded||wn,l=n.onNodeAdded||wn,c=n.onBeforeElUpdated||wn,h=n.onElUpdated||wn,d=n.onBeforeNodeDiscarded||wn,f=n.onNodeDiscarded||wn,m=n.onBeforeElChildrenUpdated||wn,y=n.skipFromChildren||wn,b=n.addChild||function(te,X){return te.appendChild(X)},w=n.childrenOnly===!0,x=Object.create(null),D=[];function I(te){D.push(te)}function E(te,X){if(te.nodeType===Zr)for(var Ee=te.firstChild;Ee;){var Ae=void 0;X&&(Ae=o(Ee))?I(Ae):(f(Ee),Ee.firstChild&&E(Ee,X)),Ee=Ee.nextSibling}}function P(te,X,Ee){d(te)!==!1&&(X&&X.removeChild(te),f(te),E(te,Ee))}function O(te){if(te.nodeType===Zr||te.nodeType===Ag)for(var X=te.firstChild;X;){var Ee=o(X);Ee&&(x[Ee]=X),O(X),X=X.nextSibling}}O(t);function W(te){l(te);for(var X=te.firstChild;X;){var Ee=X.nextSibling,Ae=o(X);if(Ae){var We=x[Ae];We&&cl(X,We)?(X.parentNode.replaceChild(We,X),Y(We,X)):W(X)}else W(X);X=Ee}}function J(te,X,Ee){for(;X;){var Ae=X.nextSibling;(Ee=o(X))?I(Ee):P(X,te,!0),X=Ae}}function Y(te,X,Ee){var Ae=o(X);if(Ae&&delete x[Ae],!Ee){var We=c(te,X);if(We===!1||(We instanceof HTMLElement&&(te=We,O(te)),i(te,X),h(te),m(te,X)===!1))return}te.nodeName!=="TEXTAREA"?ve(te,X):Eg.TEXTAREA(te,X)}function ve(te,X){var Ee=y(te,X),Ae=X.firstChild,We=te.firstChild,Xt,wt,It,rs,Mt;e:for(;Ae;){for(rs=Ae.nextSibling,Xt=o(Ae);!Ee&&We;){if(It=We.nextSibling,Ae.isSameNode&&Ae.isSameNode(We)){Ae=rs,We=It;continue e}wt=o(We);var Rs=We.nodeType,ge=void 0;if(Rs===Ae.nodeType&&(Rs===Zr?(Xt?Xt!==wt&&((Mt=x[Xt])?It===Mt?ge=!1:(te.insertBefore(Mt,We),wt?I(wt):P(We,te,!0),We=Mt,wt=o(We)):ge=!1):wt&&(ge=!1),ge=ge!==!1&&cl(We,Ae),ge&&Y(We,Ae)):(Rs===Pg||Rs==Lg)&&(ge=!0,We.nodeValue!==Ae.nodeValue&&(We.nodeValue=Ae.nodeValue))),ge){Ae=rs,We=It;continue e}wt?I(wt):P(We,te,!0),We=It}if(Xt&&(Mt=x[Xt])&&cl(Mt,Ae))Ee||b(te,Mt),Y(Mt,Ae);else{var G=a(Ae);G!==!1&&(G&&(Ae=G),Ae.actualize&&(Ae=Ae.actualize(te.ownerDocument||Ht)),b(te,Ae),W(Ae))}Ae=rs,We=It}J(te,We,wt);var de=Eg[te.nodeName];de&&de(te,X)}var ee=t,ne=ee.nodeType,Ce=s.nodeType;if(!w){if(ne===Zr)Ce===Zr?cl(t,s)||(f(t),ee=cx(t,lx(s.nodeName,s.namespaceURI))):ee=s;else if(ne===Pg||ne===Lg){if(Ce===ne)return ee.nodeValue!==s.nodeValue&&(ee.nodeValue=s.nodeValue),ee;ee=s}}if(ee===s)f(t);else{if(s.isSameNode&&s.isSameNode(ee))return;if(Y(ee,s,w),D)for(var Me=0,ze=D.length;Me<ze;Me++){var He=x[D[Me]];He&&P(He,He.parentNode,!1)}}return!w&&ee!==t&&t.parentNode&&(ee.actualize&&(ee=ee.actualize(t.ownerDocument||Ht)),t.parentNode.replaceChild(ee,t)),ee}}var ux=dx(ex);function Cd(i,e,t={}){const s=v(i);if(typeof e=="string"&&!e.length){t.childrenOnly?s.empty():s.replaceWith(document.createTextNode(""));return}if(e===null){s.remove();return}const n="z-zui-inited",{getNodeKey:r,onElUpdated:o,onBeforeElUpdated:a,onBeforeElChildrenUpdated:l,executeScript:c=!0,...h}=t,d=new Set;ux(i,e,{...h,getNodeKey:function(f){const m=r==null?void 0:r(f);if(m!==void 0)return m;if(f instanceof Element&&f.tagName==="BODY")return f.tagName;if(f.getAttribute)return f.getAttribute("zui-key")??f.id},onBeforeElUpdated(f,m){const y=a==null?void 0:a(f,m);if(y!==void 0)return y;if(f.classList.contains("preserve-on-morph"))return!1;if(f.classList.contains("no-morph")||f.hasAttribute("zui-create")!==m.hasAttribute("zui-create")||f.tagName==="IFRAME"&&!f.classList.contains("morph")||f.tagName==="ZEN-EDITOR"||f.tagName.includes("-")&&f.isEqualNode(m))return f.replaceWith(m),!1;if(f.tagName==="SCRIPT"&&c){const w=m.textContent;w&&v(f).addClass("zui-js-run").parent().runJS(w)}const b=v(f);if((f.hasAttribute("zui-create")||f.hasAttribute("data-zui"))&&(!m.childNodes.length||b.zui()instanceof be)){if(f.isEqualNode(m))d.add(f);else{let w=!0;Array.from(m.attributes).forEach(x=>{const{name:D,value:I}=x;D==="class"?b.addClass(I):f.getAttribute(D)!==I&&((D==="zui-create"||D.startsWith("zui-create-"))&&(w=!1),f.setAttribute(D,I))}),w&&d.add(f)}return!1}return!0},onBeforeElChildrenUpdated(f,m){const y=l==null?void 0:l(f,m);return y!==void 0?y:f.classList.contains("no-morph")?!1:!f.tagName.includes("-")},onElUpdated(f){if(o==null||o(f),f.tagName!=="SCRIPT"){f.hasAttribute(n)&&f.removeAttribute(n);const m=vr(f);Object.keys(m).forEach(y=>{const b=m[y];if(y==="zui.commands"&&b)f.setAttribute("z-commands",","+Object.keys(b).join());else if(b instanceof Ze){const{ATTR_KEY:w,DATA_KEY:x}=b.constructor;f.setAttribute(w,""),f.setAttribute(x,`${b.gid}`)}})}}}),s.zuiInit({update:"reset",beforeCreate:f=>!d.has(f)}),d.forEach(f=>{v(f).trigger("skipMorph")}),c&&s.find("script:not(.zui-js-run)").each((f,m)=>{const y=m.textContent;y&&s.runJS(y)})}v.fn.morph=function(i,e){return this.each((t,s)=>{Cd(s,i,e)})},v.fn.morphInner=function(i,e){return this.each((t,s)=>{Cd(s,i,{...e,childrenOnly:!0})})};let Wi;const Rg=function(){var e;if(Wi)return Wi;const i=window.parent;if(((e=window.config)==null?void 0:e.currentModule)==="index"&&window.config.currentMethod==="index")Wi="home";else if(window===i)Wi="single";else{let t="";try{t=i.getZentaoPageType?i.getZentaoPageType():""}catch{window.top=window,window.parent=window}Wi=t==="home"?"app":"single"}return Wi};Object.assign(window,{getZentaoPageType:Rg});const zg=new na("marked",{src:["markdown/marked/marked.min.js"],check:"marked",success:()=>{const{markedHighlight:i,marked:e}=window;i&&e&&Object.assign(e,i)}}),Fg=class Eo extends Ze{constructor(){super(...arguments),this._updateID=0}async afterInit(){var n,r;const{$element:e,options:{code:t,lang:s}}=this;t===void 0&&(this.options.code=e.text().trim()),s===void 0&&(this.options.lang=e.attr("data-lang")||((r=(n=e.attr("class"))==null?void 0:n.split(" ").find(o=>o.startsWith("lang-")))==null?void 0:r.substring(5))||""),await Eo.loadModule(),await this.render()}async update(e,t){const{className:s,style:n,code:r,...o}={...this.options,...t},{$element:a}=this;s&&a.setClass(s),n&&a.css(n);const l=++this._updateID,c=await Eo.codeToHtml(e??r??"",o);l===this._updateID&&a.html(c)}async render(e){super.render(e),await this.update()}static async codeToHtml(e,t){const s=await Eo.loadModule();try{return await s.codeToHtml(e,{theme:"github-light",lang:"txt",...t})}catch(n){return console.warn(`[ZUI] Highlight: ${n}`),`<div>${Us(e)}</div>`}}static async createHighlighter(e){return await(await Eo.loadModule()).createHighlighter(e)}static async loadModule(){if(!this.Module&&!this.Module){const e=await v.getLib("shiki");this.Module=e}return this.Module}};Fg.NAME="Highlight";let Yr=Fg;v.registerLib("shiki",{src:"highlight/shiki/shiki.umd.js",check:"shiki"}),Yr.register();const vD="",hl=class ur extends Ze{init(){const{content:e}=this.options;e===void 0&&(this.options.content=this.$element.text(),this.$element.empty()),this.$element.addClass("markdown-content article")}async _initMarked(){let{marked:e}=this.options;if(e&&typeof e=="function")return this._marked=e,e;typeof e=="string"&&(e=[e,{}]);const{highlight:t,markedExts:s=[],htmlSandbox:n,assetBaseUrl:r,copyCode:o}=this.options,a={async:!0,gfm:!0,breaks:!0,highlight:t,markedExts:s,assetBaseUrl:r,htmlSandbox:n,copyCode:o};if(Array.isArray(e)){const[l,c]=e,h=ur.sharedMarkeds.get(l);if(h)return this._marked=h,h;const d=await ur.marked({...a,...c});d&&ur.sharedMarkeds.set(l,d),this._marked=d}else this._marked=await ur.marked({...a,...e});return this._marked}async afterInit(){try{await this._initMarked()}catch(e){console.error("[ZUI] Markdown: init marked failed",e)}await this.render()}parse(e,t){const s=this._marked;return e=e??this.options.content,s?s.parse(e,{...this.options,...t}):`<p style="white-space:pre-wrap">${e??""}</p>`}async render(e,t){super.render(e,t);const s=await this.parse();this.options.morph?this.$element.morphInner(`<div>${s}</div>`):this.$element.html(s)}static async parsed(e,t,s){let n;typeof s=="string"&&(n=s,s=this.sharedMarkeds.get(s));try{s=s||await this.marked(t),n&&s&&this.sharedMarkeds.set(n,s);let r=await s.parse(e,{async:!0,...t});return r.endsWith(`
`)&&(r=r.substring(0,r.length-1)),(!r.startsWith("<")||!r.includes("<")||!r.endsWith(">"))&&(r=`<p style="white-space:pre-wrap">${r}</p>`),r}catch(r){console.error("[ZUI] Markdown: parsed failed",r)}return`<p style="white-space:pre-wrap">${e}</p>`}static async marked(e){const t=await ur.loadModule();if(!t)return;const{highlight:s,markedExts:n=[],html:r,assetBaseUrl:o,htmlSandbox:a,copyCode:l,...c}=e||{};s&&await Yr.loadModule()&&n.push(t.markedHighlight({emptyLangClass:"code-highlight",langPrefix:"code-highlight language-",async:!0,highlight:async(y,b)=>{if(a&&b==="html"){const x=y.trim();if((y.startsWith("<!DOCTYPE html>")||y.startsWith("<html ")||y.startsWith("<html>"))&&y.endsWith("</html>"))return`<div zui-create="htmlsandbox" zui-create-htmlsandbox='{html:${JSON.stringify(x).replaceAll("'","&#039;")}}'></div>`}if(b==="mermaid")return`<div zui-create="mermaid" zui-create-mermaid='{text:${JSON.stringify(y).replaceAll("'","&#039;")}}'></div>`;if(b==="svg"){const x=y.trim();if(x.startsWith("<svg")&&x.endsWith("</svg>"))return`<div zui-create="svgbox" zui-create-svgbox='{svg:${JSON.stringify(x).replaceAll("'","&#039;")}}'></div>`}const w=await Yr.codeToHtml(y,{theme:"github-light",structure:"inline",...typeof s=="object"?s:{},lang:b});return`<pre class="markdown-code-block code-highlight github-light code-lang-${b}" z-lang="${b}">${l?`<button type="button" title="${Pe.getLang("copy")}" class="btn size-xs copy-code-btn" zui-toggle="copybtn" zui-toggle-copybtn="{onCopy:() => _$element.next('code')}"><i class="icon icon-copy"></i></button>`:""}<code>${w}</code></pre>`}}));const h=new t.Marked(...n),d={};(a||s)&&(d.code=m=>m.text),r||(d.html=m=>Us(m.text));const f=m=>/^(https?:)?\/\//.test(m);return d.image=({href:m,title:y,text:b})=>{if(m&&m.trim().toLowerCase().startsWith("javascript:"))return"";o&&m&&!m.startsWith("http")&&!m.startsWith("data:")&&(m=`${o}${m}`);const w=y?` title="${Us(y)}"`:"",x=m&&f(m)?' referrerpolicy="no-referrer"':"";return`<img src="${Us(m)}" alt="${Us(b)}"${w}${x}>`},d.link=function({href:m,title:y,tokens:b}){if(m&&m.trim().toLowerCase().startsWith("javascript:"))return"";const w=this.parser.parseInline(b),x=y?` title="${Us(y)}"`:"",D=m&&f(m),I=D?' referrerpolicy="no-referrer"':"",E=D?' target="_blank" rel="noopener noreferrer"':"";return`<a href="${Us(m)}"${x}${E}${I}>${w}</a>`},h.use({renderer:d}),c&&h.setOptions(c),h}static get Module(){return zg.Module}static loadModule(){return zg.load()}};hl.NAME="Markdown",hl.DEFAULT={highlight:!0,copyCode:!0},hl.sharedMarkeds=new Map;let xd=hl;xd.register();class dl extends ae{constructor(){super(...arguments),this._ref=ye(),this._transitionTimer=0}async update(){const{content:e,className:t,style:s,marked:n,morph:r,transition:o,...a}=this.props,l=await xd.parsed(e,a,n);if(e!==this.props.content)return;const{base:c}=this;if(c&&e===this.props.content)if(r){const h=o?new Set(["DIV","P","H1","H2","H3","H4","H5","H6","LI","PRE","BLOCKQUOTE","TD","TH","DETAILS","SUMMARY"]):void 0;v(c).morphInner(`<div>${l}</div>`,o?{onNodeAdded:d=>{d.nodeType===Node.ELEMENT_NODE&&h.has(d.tagName)&&this.transitionText(d)},onElUpdated:d=>{const f=this._transitionEle;d===f?this.transitionText(d):f&&v(d).closest(f).length&&this.transitionText(f)}}:void 0)}else v(c).html(l)}transitionText(e){const t=this._transitionEle;t&&e!==t&&t.classList.remove("changing-text"),this._transitionTimer&&clearTimeout(this._transitionTimer),e.classList.add("changing-text"),this._transitionEle=e,this._transitionTimer=window.setTimeout(()=>{var s;(s=this._transitionEle)==null||s.classList.remove("changing-text")},500)}componentDidMount(){this.update()}componentDidUpdate(e){e.content!==this.props.content&&this.update()}componentWillUnmount(){clearTimeout(this._transitionTimer),this._transitionEle=void 0}render(e){const{className:t,style:s}=e;return g("div",{ref:this._ref,className:K("markdown-content article",t),style:s})}}dl.defaultProps={morph:!0,copyCode:!0};const fx=Object.freeze(Object.defineProperty({__proto__:null,MarkdownContent:dl},Symbol.toStringTag,{value:"Module"}));class Og extends ae{constructor(){super(...arguments),this._copied=pe(!1),this._copyTimer=0,this._handleCopyBtnClick=async()=>{let e;const{content:t,onCopy:s}=this.props;if(typeof s=="function")e=s();else{const n=this.base.querySelector(".ai-message-bubble-content");e=n?{html:n.innerHTML,text:n.textContent||""}:{},typeof t=="string"?e.text=t:v.isPlainObject(t)&&"markdown"in t&&(e.text=t.markdown)}await fh(e),this._copied.value=!0,this._copyTimer&&clearTimeout(this._copyTimer),this._copyTimer=window.setTimeout(()=>{this._copied.value=!1,this._copyTimer=0},2e3)}}componentWillUnmount(){this._copyTimer&&clearTimeout(this._copyTimer)}_renderAvatar(e){const{role:t="user",avatar:s,store:n,userName:r}=e;if(s===!1)return null;if(typeof s=="object")return g(Gs,{...s});const o=r??t;let a,l,c="";c={user:"contacts",assistant:"ai",system:"chats"}[t],t==="assistant"&&(a="linear-gradient(to left, var(--color-primary-500) 0%, var(--color-secondary-500) 50%, var(--color-secondary-600) 100%)",l="#fff");let d={className:"ai-message-bubble-avatar",background:a,text:o,code:o,icon:c,foreColor:l,circle:!0};return n&&(d=n.getAvatar("role",{role:t},d)),d?g(Gs,{...d}):null}_renderMarkdownContent(e,t){return g(dl,{key:"content",className:K("ai-markdown-content",t),content:e,highlight:!0,marked:"ai-message-bubble",htmlSandbox:!0})}_renderCustomContent(e){return v.isPlainObject(e)&&"markdown"in e?this._renderMarkdownContent(e.markdown):g(fe,{key:"content",content:e})}_renderActions(e){const{showCopy:t=!0,actions:s,date:n,isEmpty:r}=e,o=[];if(t){const a=this._copied.value;o.push({btnType:a?"success-pale":"ghost",icon:a?"check":"copy text-gray",hint:Se("copy"),text:a?Se("copied"):null,rounded:"lg",disabled:r,onClick:r?void 0:this._handleCopyBtnClick})}return s&&o.push(...s),n&&o.push({type:"text",className:"muted",text:rt(n,"yyyy-MM-dd hh:mm")}),o.length?g(Be,{key:"actions",class:"ai-message-actions",items:o,size:"sm",gap:2}):null}render(e){const{role:t="user",avatar:s,content:n,children:r,className:o}=e;return g("div",{className:`ai-message-bubble is-role-${t}${this._copied.value?" is-copied":""} ${o}`},s===!1?null:this._renderAvatar(e),g("div",{class:"ai-message-bubble-container"},n?this._renderCustomContent(n):null,r,this._renderActions(e)))}}const jg=class eb extends Ze{afterInit(){this.$element.addClass("htmldiff"),this.render()}async update(e){const{before:t="",after:s="",className:n,dataPrefix:r,atomicTags:o}={...this.options,...e},a=await eb.diff(t,s,n,r,o);this.element.innerHTML=a}render(e){super.render(e),this.update()}static async diff(e,t,s,n,r){return(await this.loadModule())(e,t,s,n,r)}static async loadModule(){return this.Module||(this.Module=await v.getLib("htmldiff")),this.Module}};jg.NAME="HTMLDiff";let kd=jg;v.registerLib("htmldiff",{src:["htmldiff/htmldiff.min.js"],check:"htmldiff"});class px extends ae{constructor(){super(...arguments),this._ref=ye()}get HTMLDiffer(){return this._HTMLDiffer}componentDidMount(){this._HTMLDiffer=new kd(this._ref.current,this.props)}componentDidUpdate(e){(e.before!==this.props.before||e.after!==this.props.after)&&this.update()}componentWillUnmount(){var e;(e=this._HTMLDiffer)==null||e.destroy()}update(){var e;return(e=this._HTMLDiffer)==null?void 0:e.update()}render(e){const{className:t}=e;return g("div",{ref:this._ref,className:K("htmldiff",t)})}}const Xn=(i,e,t)=>Se(`zentaoAgentResult.${i}`,e,t);let Sd=class extends ae{_renderValue(e){if(e==null)return"";if(typeof e!="object")return e;const t=Object.keys(e),s=t.length===1&&Array.isArray(e[t[0]])?e[t[0]]:e;if(Array.isArray(s)){const n=s[0];return n&&(n.title||n.name)?g("ul",null,s.map(r=>g("li",null,r.title||r.name))):Xn("dataListSizeInfo",[s.length])}return Xn("notSupportPreview")}_renderChangeProp(e,t,s,n){if(s[e]===void 0)return null;let r=n[e];r==null&&(r=""),t==null&&(t=""),typeof r=="string"&&r.length&&(r=v("<div/>").html(r).text());const o=typeof t=="string"?t:JSON.stringify(t),a=typeof r=="string"?r:JSON.stringify(r),l=o===a;let c=null;return l?c=this._renderValue(t):a.length?c=g(px,{className:"article whitespace-prewrap",before:a,after:o}):c=g("div",{class:"htmldiff article whitespace-prewrap"},g("ins",{"data-operation-index":"0"},o)),g("tr",{class:"whitespace-pre-wrap",key:e},g("td",{class:"font-bold"},s[e]),g("td",null,c))}_renderResult(e){const{result:t,objectType:s,objectID:n,tool:r,targetForm:o,objectData:a,objectProps:l}=e,c=(a==null?void 0:a[s])||{},h=l[s],d=!o||o==="empty.empty",f=r.parameters.properties.data,m=f.properties,y=f.title===h.common;return d||(h.title===void 0&&(h.title=f.title),Object.keys(m).forEach(b=>{h[b]===void 0&&(h[b]=m[b].title||m[b].description)})),y&&c?[g("h6",{key:"changeTitle"},$e(Xn("changeTitleFormat"),{type:h.common||s,id:n?`#${n}`:""})),g("table",{key:"changeTable",class:"table bordered condensed",style:"min-width: 600px"},g("thead",null,g("tr",null,g("th",{style:"width: 100px;"},Xn("changeProp")),g("th",null,Xn("changeDetail")))),g("tbody",null,Object.entries(t.data).map(([b,w])=>this._renderChangeProp(b,w,h,c))))]:[g("h6",{key:"name"},e.targetFormName),g("div",{key:"data",class:"ring rounded p-2 article whitespace-prewrap col gap-2 success-pale"},Object.entries(t.data).map(b=>{const[w,x]=b;return g("div",{class:"text-fore"},g("div",{class:"font-bold"},h[w]||w),g("div",null,this._renderValue(x)))}))]}_renderActions(e){const{actions:t=[],onOpenTargetForm:s=window.openPageForm,targetFormName:n,formLocation:r,result:o,targetForm:a}=e;if(t===!1)return null;const l=String(n||a),c=[s?{text:Xn("applyFormFormat",[l]),onClick:()=>{s.call(this,r,o.data,()=>Ms.show({content:Xn("applyFormSuccess",[l]),type:"success"}))},type:"primary-pale",trailingIcon:"icon-arrow-right"}:null,...t].filter(Boolean);return g(Be,{className:"ai-tool-call-result-actions",items:c})}render(e){const{className:t}=e;return g("div",{className:K("ai-tool-call-result col gap-2 overflow-x-auto",t)},e.result.title?g("h4",null,e.result.title):null,this._renderResult(e),e.result.summary?g("div",{className:"whitespace-pre-line"},g("i",{class:"icon icon-lightbulb text-gray mr-1"}),e.result.summary):null,this._renderActions(e))}};class Bg extends ae{constructor(){super(...arguments),this._handleFormSubmit=(e,t)=>{var o;const{message:s,onSubmitForm:n}=this.props,{onSubmit:r}=((o=s.$form)==null?void 0:o.config)||{};return r&&r.call(this,t)===!1||n==null||n.call(this,t,s),!1},this._getCopyContents=()=>{var n;const{message:e}=this.props,{content:t="",reasonContent:s=""}=e;return{text:[s,t].filter(Boolean).join(`
`),html:(n=this.base.querySelector(".ai-message-bubble-content"))==null?void 0:n.innerHTML}}}_getToolCallingStateMessage(e){return e.status==="wait"?Se("processing"):e.message}_renderMarkdownContent(e,t){return g(dl,{className:K("ai-markdown-content",t),content:e,highlight:!0,assetBaseUrl:this.props.assetBaseUrl,marked:"ai-message-bubble",htmlSandbox:!0,transition:Ef==="development"})}_renderCustomContent(e){return v.isPlainObject(e)&&"markdown"in e?this._renderMarkdownContent(e.markdown):g(fe,{content:e})}_renderToolcall(e,t){t=t||{status:"wait",name:e.name??e.function.name};const{status:s,message:n,name:r,error:o,result:a={}}=t,{view:l,actions:c,info:h}=a,d=Se(`toolCallingStatus.${t.status}`)??t.status,f={wait:"spinner-indicator spin  text-gray",running:"spinner-indicator spin text-gray",finished:"check-circle text-success",error:"alert text-danger",cancelled:"ban-circle text-warning"}[s],m=!c&&!l,y=n||Se(`toolCallingMessages.${s}`);return g(Dr,{key:`${e.id}:${m}`,class:"ai-message-bubble-shape ai-message-tool-calling",bordered:!0,defaultCollapsed:m,"data-status":s,header:g("div",{className:"row items-center gap-2 flex-auto min-w-0"},g(Ie,{icon:`${f} flex-none`,title:d}),g("div",{class:"flex-none whitespace-nowrap",title:d},r),g("div",{class:"text-gray text-sm flex-auto min-w-0 text-left",title:"messageText"},g("div",{class:`whitespace-nowrap overflow-hidden text-ellipsis max-w-full${s==="wait"||s==="running"?" text-shimmer":""}`},y)))},n||m?g("div",{class:"text-gray text-sm"},y):null,l?this._renderCustomContent(l):null,h?this._renderCustomContent(h):null,o?g("div",{class:"text-danger text-sm"},o):null,c?Be.render(c,[],{key:"actions",className:"ai-message-tool-calling-actions",btnType:"gray-outline",relativeTarget:t,size:"sm"},this):null)}_renderToolCalls(e){const t=e.$toolCallingStates||{},s=e.$toolCalls;return s!=null&&s.length?s.map(n=>this._renderToolcall(n,t[n.id])):null}_renderForm(e){const t={};e.config.width&&(t.width=je(e.config.width));const s={displayType:"horz",...e.config.schema};return g("div",{className:"ai-message-form",style:t},g(cd,{component:"form",header:e.config.title?g("div",{className:"form-header font-bold px-2"},e.config.title):null,footer:e.config.hint?g("div",{className:"form-footer px-2 text-gray text-sm"},e.config.hint):null,schema:s,defaultData:e.data??e.config.data,actions:[{btnType:"submit",type:"primary btn-wide",text:e.config.submitBtnText??Pe.getLang("confirm")}],onSubmit:this._handleFormSubmit}))}_renderTaskResults(e){return g("div",{class:"ai-message-bubble-content space-y-2"},e.map(t=>g(Sd,{className:"py-2",key:t.callID,...t})))}_renderContent(e){var d,f;const{message:t,noThinkLog:s}=e,{content:n="",reasonContent:r="",role:o,$form:a,custom_data:l={}}=t;if((d=l.taskResults)!=null&&d.length&&o!=="assistant")return this._renderTaskResults(l.taskResults);if(a)return this._renderForm(a);if(!n.length&&!r.length)return(f=t.$toolCalls)!=null&&f.length?null:g("div",{className:"px-4 py-2"},t.$error?g("div",{className:"text-danger"},t.$error):g(Ie,{icon:"spinner-indicator",className:"spin muted"}),t.$stateText?g("span",{className:"text-gray text-shimmer text-sm ml-2"},t.$stateText):null);let h;if(r)if(s)h=n.length?null:g("div",{className:"text-gray flex items-center gap-2 my-1.5"},g(Ie,{icon:"spinner-indicator",className:"spin muted"}),g("span",null,r.length?r.split(`
`).pop():Se("processing")));else{const m=t.$reasonType==="thinking",y=t.$reasonTime,b=y?Se("timeConsuming",{time:(y/1e3).toFixed(1)}):"";h=g("details",{open:!n.length,class:"ai-message-thinking text-sm px-2 py-1 rounded mt-2 mb-2"},g("summary",{class:"border-b cursor-pointer"},n.length?`${Se(m?"thinkCompleted":"completed")}${b?`(${b})`:""}`:g("span",{class:"text-shimmer"},Se(m?"thinking":"processing")),n.length?null:g(Ie,{icon:"spinner-indicator",className:"spin muted ml-2"})),this._renderMarkdownContent(r,"ai-message-thinking-content pl-2.5"))}return!h&&!n?null:g("div",{className:"ai-message-bubble-content"},h,n?this._renderMarkdownContent(n):null)}render(e){const{message:t,noAvatar:s,store:n}=e,{content:r="",reasonContent:o="",role:a="user",custom_data:l={}}=t,c=!r.length&&!o.length,h=this._renderContent(e),d=this._renderToolCalls(t);return g(Og,{store:n,className:t.$state?`is-state-${t.$state}`:"",role:l.asRole??a,date:t.created_at,avatar:s?!1:void 0,isEmpty:c,onCopy:this._getCopyContents},h||!d?g("div",{key:"content",className:"ai-message-bubble-shape ai-message-main-content"},h):null,d)}}function Hg(i){i=i||location.search,i[0]==="?"&&(i=i.substring(1));try{const e=new URLSearchParams(i),t={};for(const s of e.keys())t[s]=e.getAll(s).join(",");return t}catch{return{}}}function Ug(i,e){if(!i)return{url:i};const{config:t}=window;if(/^https?:\/\//.test(i)){const c=window.location.origin;if(!i.includes(c))return{external:!0,url:i};i=(t.webRoot.endsWith("/")?"/":"")+i.substring((c+t.webRoot).length)}const s=i.split("#"),n=s[0].split("?"),r=n[1],o=r?Hg(r):{};let a=n[0];e=e||t.requestType,e==="auto"&&(r!=null&&r.length||(e="PATH_INFO"),e=i.startsWith(`${t.router}?${t.moduleVar}=`)?"GET":"PATH_INFO");const l={url:i,isOnlyBody:o.onlybody==="yes",vars:[],hash:s[1]||"",params:o,tid:o.tid||"",requestType:e};if(e==="GET"){l.moduleName=o[t.moduleVar]||"index",l.methodName=o[t.methodVar]||"index",l.viewType=o[t.viewVar]||t.defaultView;for(const c in o)c!==t.moduleVar&&c!==t.methodVar&&c!==t.viewVar&&c!=="onlybody"&&c!=="tid"&&l.vars.push([c,o[c]])}else{let c=a.lastIndexOf("/");c===a.length-1&&(a=a.substring(0,c),c=a.lastIndexOf("/")),c>=0&&(a=a.substring(c+1));const h=a.lastIndexOf(".");h>=0?(l.viewType=a.substring(h+1),a=a.substring(0,h)):l.viewType=t.defaultView;const d=a.split(t.requestFix);if(l.moduleName=d[0]||"index",l.methodName=d[1]||"index",d.length>2)for(let f=2;f<d.length;f++)l.vars.push(["",d[f]]),o["$"+(f-1)]=d[f]}return l}function ut(i,e,t,s,n,r){if(typeof i=="object")return ut(i.moduleName,i.methodName,i.vars,i.viewType,i.hash,i.params);const o=window.config||{};if(t){typeof t=="string"&&(t=t.split("&"));for(let c=0;c<t.length;c++){const h=t[c];if(typeof h=="string"){const d=h.split("=");t[c]=[d.shift(),d.join("=")]}}}const a=[],l=o.requestType==="GET";if(l){if(a.push(o.router,"?",o.moduleVar,"=",i,"&",o.methodVar,"=",e),t)for(const c of t)a.push("&",c[0],"=",c[1]);s&&s!==o.defaultView&&a.push("&",o.viewVar,"=",s)}else{if(o.requestType=="PATH_INFO"&&a.push(o.webRoot,i,o.requestFix,e),o.requestType=="PATH_INFO2"&&a.push(o.webRoot,"index.php/",i,o.requestFix,e),t)for(const c of t)a.push(o.requestFix+c[1]);s=s||o.defaultView,s&&a.push(".",s)}return r&&Object.keys(r).forEach(c=>{const h=r[c];c[0]!=="$"&&a.push(!l&&!a.includes("?")?"?":"&",c,"=",h)}),typeof n=="string"&&a.push(n.startsWith("#")?"":"#",n),a.join("")}v.fn._append=v.fn.append,v.fn._prepend=v.fn.prepend,v.fn._before=v.fn.before,v.fn._after=v.fn.after,v.fn._html=v.fn.html;function ul(i,e){return typeof e=="string"&&(e.includes("zui-create")||e.includes("zui-init"))&&i.zuiInit(),i}function mx(i){return!!i&&i.nodeType===1}v.extend(v.fn,{append(...i){return ul(this._append(...i),i.join(""))},prepend(...i){return ul(this._prepend(...i),i.join(""))},before(...i){const e=this.parent();return this._before(...i),ul(e,i.join("")),this},after(...i){const e=this.parent();return this._after(...i),ul(e,i.join("")),this},html(i,e){if(!arguments.length)return this[0]&&this[0].innerHTML;if(i===void 0)return this;const t=/<script[\s>]/.test(i);return typeof e=="boolean"&&(e={zuiInit:e}),this.each((s,n)=>{mx(n)&&(t?v(n).empty()._append(i):n.innerHTML=i,(e==null?void 0:e.zuiInit)!==!1&&v(n).zuiInit())})}});const gx=Object.freeze(Object.defineProperty({__proto__:null,createLink:ut,parseLink:Ug,parseUrlParams:Hg},Symbol.toStringTag,{value:"Module"}));window.$&&Object.assign(window.$,{...gx,parseRawData:Ho});class Vg extends at{constructor(){super(...arguments),this._subProviderMap=pe({}),this._chat=xe(()=>this.props.store.getChat(this.props.chatID)),this._selectedProviders=xe(()=>this.props.store.reactions.getUsedChatContextSettings({chat:this._chat.value})),this._recommendProviders=xe(()=>{const{selectedProviders:e}=this;if(e.length>3)return[];const t=new Set(e.map(n=>n.code)),s=[];for(const n of this._providerMap.value.values())n.recommend&&!t.has(n.code)&&s.push(n);return s.sort((n,r)=>n.order-r.order),s.length>3&&(s.length=3),s}),this._chatContextProviders=xe(()=>{const e=this._chat.value;return e?this.store.reactions.getChatContextProviders(e):[]}),this._providerMap=xe(()=>{const e=new Map;this._chatContextProviders.value.forEach(n=>{e.set(n.code,n)});const s=this._subProviderMap.value;return Object.entries(s).forEach(([n,r])=>{e.set(n,r)}),e}),this._handleTriggerClick=e=>{e.target instanceof HTMLElement&&e.target.closest(".ai-chat-context-provider-item")&&e.preventDefault()},this._handleClickItem=async e=>{const{_item:t}=e.item;if(e.event.preventDefault(),e.event.stopPropagation(),t.items){const s=await this.reactions.getSubChatContextProviders(this._chat.value,t);this.setState(({parentProviders:n})=>{const r=this._subProviderMap.value;return s.forEach(o=>{r[o.code]=o}),this._subProviderMap.value={...r},{parentProviders:[...n,{provider:t,items:s}]}});return}t.data?this.reactions.toggleChatContext(this._chat.value,t):t.contexts&&(this.reactions.applyProviderContextSettings(this._chat.value,t),this.close()),t.command&&(this.reactions.executeCommand(t.command,e.event),this.close())},this._goToParentList=()=>{this.setState(({parentProviders:e})=>(e.pop(),{parentProviders:[...e]}))},this._handleGoToParentList=e=>{e.stopPropagation(),this._goToParentList()},this._handleClickProviderItem=e=>{this.reactions.toggleChatContext(this._chat.value,e)},this._renderProviderItem=(e,t)=>{const s=e.display??e.title;return jn(s)?g("div",{key:e.code,className:`ai-chat-context-provider-item ${t?" selected":"is-recommend"}`,title:e.hint??s},g(Ie,{icon:e.icon}),g("div",{className:"text"},s),g("div",{className:"ai-chat-context-provider-item-btn state",onClick:this._handleClickProviderItem.bind(this,e)},g(Ie,{icon:t?"close":"plus"}))):null}}get chatContextProviders(){return this._chatContextProviders.value}get selectedProviders(){return this._selectedProviders.value}get recommendProviders(){return this._recommendProviders.value}get parentProvider(){return this.state.parentProviders[this.state.parentProviders.length-1]}get store(){return this.props.store}get reactions(){return this.props.store.reactions}_getProviders(e){const t=this._providerMap.value;return t.size?e.reduce((s,n)=>{const r=t.get(n);return r&&s.push(r),s},[]):[]}getDefaultState(e){return{...super.getDefaultState(e),value:"",open:!1,parentProviders:[]}}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return s.onClick=this._handleTriggerClick,s}_renderTrigger(e,t){return[e.disabled?null:g(we,{icon:"at scale-90",size:18,hint:"添加上下文"}),this.selectedProviders.map(s=>this._renderProviderItem(s,!s.disabled)),e.disabled?null:this.recommendProviders.map(s=>this._renderProviderItem(s,!1))]}_getItems(e,t){const{parentProviders:s}=t,n=this._chatContextProviders.value,r=s.length?s[s.length-1].items:n;r.sort((a,l)=>{const c=(a.recommend?0:1)-(l.recommend?0:1);return c||a.order-l.order});const o=new Set(this.selectedProviders.map(a=>a.code));return r.reduce((a,l)=>{const c=o.has(l.code);return l.hidden||a.push({...l,key:l.code,items:void 0,trailingIcon:l.items?"angle-right":c?"check":null,selected:c,disabled:!l.data&&!l.command&&!l.items&&!l.contexts,_item:l}),a},[])}_getSearchBoxProps(e,t){var s;return{placeholder:((s=this.parentProvider)==null?void 0:s.provider.title)??"搜索..."}}_renderPop(e,t){const s=this._getItems(e,t),n=t.parentProviders.length;return g(dt,{wrapClass:"ai-chat-context-picker-list",className:"ai-chat-context-picker-items",maxHeight:300,header:n?g(we,{icon:"arrow-left",size:"sm",type:"ghost",className:"absolute left-2 top-2 z-10",onClick:this._handleGoToParentList}):null,searchBox:this._getSearchBoxProps(e,t),items:s,onClickItem:this._handleClickItem})}}Vg.defaultProps={...at.defaultProps,className:"ai-chat-context-picker",popClass:"ai-chat-context-picker-pop popup rounded",popWidth:"auto",popMinWidth:200,popMaxWidth:300,popPlacement:"top-start",popMaxHeight:9999};class Wg extends ae{constructor(e){super(e),this._headerRef=ye(),this._inputTimer=0,this._textareaRef=ye(),this._handleHeaderResize=()=>{const t=this._headerRef.current;t&&(this._headerHeight.value=t.clientHeight)},this._syncContent=()=>{const t=this._textareaRef.current;if(t){const s=t.value;this._content.value=s,this.props.store.updateUserPrompt(this.props.chatID,s)}},this._handleInput=()=>{this._inputTimer&&clearTimeout(this._inputTimer),this._inputTimer=window.setTimeout(()=>{this._syncContent(),this._inputTimer=0},100)},this._handleKeyDown=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this._handleSend())},this._handleSend=async()=>{var o,a;this._inputTimer&&(clearTimeout(this._inputTimer),this._inputTimer=0,this._syncContent());const{disabled:t,loading:s,onSend:n}=this.props;if(!n||t||this.disabledSend)return;const r=this._content.value.trim();if(r&&!t&&!s){this._loading.value=!0;try{const l=(o=this.base)==null?void 0:o.querySelector("textarea");l&&(l.value=""),this._content.value="",await n(r,{model:this._model.value}),this.props.store.updateUserPrompt(this.props.chatID,"")}catch(l){const c=(a=this.base)==null?void 0:a.querySelector("textarea");c&&(c.value=r),this._content.value=r,this.props.store.updateUserPrompt(this.props.chatID,r),console.error(l)}this._loading.value=!1,v(this.textarea).autoHeight()}},this._handleModelChange=t=>{const s=t.target;this._model.value=s.value},this._content=pe(e.defaultContent||""),this._loading=pe(e.loading||!1),this._model=pe(e.defaultModel||""),this._headerHeight=pe(0)}get textarea(){var e;return(e=this.base)==null?void 0:e.querySelector("textarea")}get disabledSend(){return this.props.generating||this.props.disabled||this._loading.value||!this._content.value.trim().length}componentDidMount(){const e=this.textarea;e&&!this.props.disabled&&(v(e).autoHeight(),e.focus());const t=this._headerRef.current;t&&(this._headerRzObserver=new ResizeObserver(this._handleHeaderResize),this._headerRzObserver.observe(t),this._headerHeight.value=t.clientHeight)}componentWillUpdate(e){if(e.chatID!==this.props.chatID){const{textarea:t}=this;t&&(t.focus(),t.value="")}}componentWillUnmount(){var e;(e=this._headerRzObserver)==null||e.disconnect()}_renderModelSelector(e){const{llmProviders:t=[],canSelectModel:s}=e;if(!t.length)return null;const n=this._model.value,r=this.props.currentModel??n,o=r?t.find(a=>a.id===r):null;return!o&&!s?null:g("div",{class:"ai-model-selector",title:Se("selectModel"),"data-model":n},g("div",{class:`state rounded ${o&&s?"primary-pale":"gray-pale"} px-1.5 flex items-center gap-2`},g(Ie,{icon:"ai"}),g("small",null,((o==null?void 0:o.name)||(o==null?void 0:o.id))??Se("defaultModel"))),s?g("select",{className:"form-control",onChange:this._handleModelChange},g("option",{value:"",selected:n===""},`[${Se("defaultModel")}]`),t.map(a=>g("option",{value:a.id,selected:n===a.id},a.name??a.id))):null)}_renderContextSelector(e){let{contexts:t}=e;return typeof t=="function"&&(t=t(e.chat)),t===!0?null:Array.isArray(t)?g("div",{className:"ai-chat-sendbox-contexts py-2 row flex-wrap gap-1"},t.map(s=>g("div",{class:"ai-chat-context-provider-item text-gray border-strong",key:s.code},g(Ie,{icon:s.icon}),g("div",null,s.title)))):g(Vg,{disabled:!e.chat.$local.id||t==="readonly",chatID:e.chatID,store:e.store})}render(e){const{defaultContent:t,disabled:s,placeholder:n=Se("sendboxPlaceholder"),sendBtn:r,extraBtns:o}=e,a=this.disabledSend,l=this._renderModelSelector(e),c=!!l,h=this._headerHeight.value,d=typeof n=="function"?n(e.chat):n;return g("div",{className:`ai-chat-sendbox ${c?"has-toolbar":""}${h?" is-header-fixed":""}${s?" is-disabled":""}`,style:{"--ai-chat-sendbox-header-height":h?`${h}px`:void 0}},g("div",{className:"ai-chat-sendbox-container"},s?null:g("div",{className:"ai-sendbox-header",ref:this._headerRef},this._renderContextSelector(e)),g("textarea",{className:"ai-chat-sendbox-input form-control py-2",autoFocus:!s,placeholder:d,defaultValue:t,onKeyDown:this._handleKeyDown,onInput:this._handleInput,rows:2,ref:this._textareaRef}),g("div",{className:"ai-sendbox-footer"},g("div",{className:"ai-sendbox-toolbar"},l),g("div",{className:"ai-sendbox-actions"},o==null?void 0:o.map(f=>g(we,{type:"primary-pale",size:"sm",...f})),g(we,{key:"sendBtn",className:"size-sm ",icon:"send",type:a?"primary-pale":"primary",disabled:a,hint:Se("send")+" (Enter)",onClick:this._handleSend,...r})))))}}function fl(i){const{className:e="animate-pulse row gap-2 items-center",iconClass:t="w-7 h-7",text:s,textClass:n="text-gray"}=i;return g("div",{className:K("ai-loading-box",e)},g("div",{className:K("ai-loading bg-primary",t)}),s&&g("div",{className:K("ai-loading-text",n)},s))}let Td=class extends ae{constructor(e){super(e),this._loadChatError=pe(),this._loadID=0,this._chat=xe(()=>{const t=this._chatID.value;return t?this.store.getChat(t):void 0}),this._loading=xe(()=>this.props.store.isLoading||!this._chat.value&&!this.props.store.error),this._handleCreateChat=t=>{var s,n;(n=(s=this.props).onCreateChat)==null||n.call(s,t,this._chatID.value),this._chatID.value=t},this._handleSend=async(t,s)=>{var o;const n=(o=this.base)==null?void 0:o.querySelector(".ai-chat-view-messages");n&&(n.scrollTop=0);const r=this._chat.value;this.postMessage(t,r&&!r.$local.id?r.id:{model:s.model,localID:r==null?void 0:r.$local.id})},this._handleSubmitForm=(t,s)=>{const n=this._chat.value;if(!n)return;const r=n.$local.id??n.id;this.store.postFormDataToChat(r,t,{onCreateChat:this._handleCreateChat})},this._renderItem=t=>{var n;const s=t;return s.role==="tool"||(n=s.custom_data)!=null&&n.invisible?null:g(Bg,{store:this.props.store,message:s,chat:this.chat,noAvatar:this._noAvatar,noThinkLog:this._noThinkLog,assetBaseUrl:this.props.store.assetBaseUrl,onSubmitForm:this._handleSubmitForm})},this._chatID=pe(e.chatID)}get chat(){return this._chat.value}get store(){return this.props.store}get error(){return this.props.store.error}get loading(){return this._loading.value}async loadChat(e,t){const s=++this._loadID;if(e=e||this._chatID.value,e==="NEW"||t)e=await this.store.createLocalChat(t);else if(e)try{if(await this.store.tryLoadChat(e),s!==this._loadID)return;this._loadChatError.value=void 0}catch(n){if(s!==this._loadID)return;this._loadChatError.value={error:n,message:Se("errors.loadChatFailed"),type:"load-chat-failed"}}s===this._loadID&&(this._chatID.value=e)}async postMessage(e,t){const{store:s}=this,n=await s.postMessage({chat:t,...typeof e=="string"?{content:e}:e,onCreateChat:this._handleCreateChat});return this._chatID.value=n,n}async _init(){const{chatID:e="NEW",postMessage:t,creatingChat:s}=this.props;this._chatID.value=e,await this.loadChat(e,s),t&&await this.postMessage(t,this._chatID.value)}componentDidUpdate(e){(e.chatID!==this.props.chatID||e.postMessage!==this.props.postMessage||e.creatingChat!==this.props.creatingChat)&&this._init()}componentDidMount(){this._init()}_renderError(e,t){if(t=t??this.error,!t)return null;const{getErrorContent:s}=e,n=(s==null?void 0:s(t))??t.message;return g("div",{key:"error",className:"ai-chats-panel-error"},g(fe,{className:"ai-chats-panel-error-content",content:n,generatorArgs:[e],generatorThis:this}))}render(e){var E,P,O,W;const t=this.chat;if(!t){const J=this._loadChatError.value||this.error;return J?this._renderError(e,J):g(fl,{text:Se("loading"),className:"animate-pulse h-full justify-center row gap-2 items-center"})}const{messages:s=[]}=t,n=!!t.$local.id,{noThinkLog:r,noAvatar:o,mode:a="full",embed:l=!1}=e,{hideUserMessage:c=a!=="full",hideHeader:h=a==="lite",sendbox:d=a==="full",noMessagesTip:f}=e,m=this.loading,y=!s.length,b=t.created_at||t.created_on||Date.now();let w=[...s].reverse();const{form:x}=t.$local,D=x&&!x.data;D?w.push({id:"form-0",role:"assistant",content:"",created_at:b,$form:x}):jn((E=t.custom_data.form)==null?void 0:E.summary)&&w.push({id:"form-summary",role:"assistant",content:(P=t.custom_data.form)==null?void 0:P.summary,created_at:b}),t.custom_data.welcome&&w.push({id:"welcome",role:"assistant",content:t.custom_data.welcome,created_at:b}),c&&(w=w.filter(J=>{var Y;return(((Y=J.custom_data)==null?void 0:Y.asRole)??J.role)!=="user"})),this._noAvatar=o??c,this._noThinkLog=r??h;const I=c&&this._noAvatar&&!d;return g("div",{className:K(`ai-chat-view is-mode-${a}`,{"is-only-response":I,"is-embed":l,"is-no-message":y})},h?null:g("div",{className:"ai-chat-view-header"},g(Ie,{icon:"chat"}),g("div",{className:"ai-chat-view-title",title:t.title},t.$local.tempTitle??t.title)),g("div",{className:"ai-chat-view-body"},w.length?g($t,{className:"ai-chat-view-messages scrollbar-hover",itemKey:"id",items:w,itemRender:this._renderItem}):g("div",{className:"muted h-full center py-4 my-8"},m?g(fl,{text:Se("loading"),className:"animate-pulse col gap-2 items-center"}):g(fe,{content:f??Se("noMessagesTip"),generatorArgs:[e],generatorThis:this}))),d&&g(Wg,{key:t.id,chat:t,store:this.store,chatID:t.id,disabled:!!this.store.error||D,onSend:this._handleSend,placeholder:D?Se("needSubmitFormFirst"):void 0,generating:t.$local.generating,llmProviders:e.store.chatModels,defaultModel:(O=t.settings)==null?void 0:O.model,currentModel:(W=t.custom_data)==null?void 0:W.model,canSelectModel:n,contexts:e.noContexts,...typeof e.sendbox=="object"?e.sendbox:{}}))}};function Kg(i){const e=v(i)[0];if(!e)return!1;if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)return e.select(),!0;const t=window.getSelection;if(t){const s=t();if(s){const n=document.createRange();return n.selectNodeContents(e),s.removeAllRanges(),s.addRange(n),!0}}return!1}v.fn.selectText=function(){return this.each((i,e)=>{Kg(e)})};class yx extends ae{constructor(){super(...arguments),this._renameChatID=pe(""),this._handleClickItem=e=>{var t,s;e.item.items||(s=(t=this.props).onSelectChat)==null||s.call(t,e.item.key)},this._getItemMoreActions=e=>{var r,o;const t=(o=(r=e.props.relativeTarget)==null?void 0:r.target)==null?void 0:o.key;if(!t)return;const{store:s}=this.props,n=s.getChat(t);return[n!=null&&n.$local.id?null:{icon:"edit",text:Se("rename"),onClick:this._startRenameChat.bind(this,t)},n!=null&&n.$local.id?null:{icon:"refresh",text:Se("updateTitle"),onClick:this._handleUpdateChatTitle.bind(this,t)},{icon:"trash",text:Se("deleteChat"),onClick:this._handleDeleteChat.bind(this,t)}]},this._startRenameChat=e=>{this._renameChatID.value=e,setTimeout(()=>{const t=v(this.base).find(`.item.is-renaming[z-key="${e}"]`).find("input");t.length&&(t[0].focus(),Kg(t))},10)},this._handleDeleteChat=async(e,t)=>{var c,h,d,f;const{store:s}=this.props,n=s.chats.findIndex(m=>m.id===e);if(n===-1)return;const r=s.chats[n];if(!r||!await Ve.confirm({type:"custom",message:Se("deleteConfirm",{title:r.title}),custom:{}}))return;await s.deleteChat(e);const a=s.chats,l=((c=a[n])==null?void 0:c.id)||((h=a[0])==null?void 0:h.id);l&&((f=(d=this.props).onSelectChat)==null||f.call(d,l))},this._getItemActions=()=>[{icon:"ellipsis-v",type:"dropdown",caret:!1,items:this._getItemMoreActions}],this._handleUpdateChatTitle=e=>this.props.store.updateChatTitle(e),this._handleRenameChatTitleKeyUp=e=>{e.key==="Enter"&&this._handleRenameChatTitle(e)},this._handleRenameChatTitle=async e=>{const t=e.target.value;t.length&&await this.props.store.renameChatTitle(this._renameChatID.value,t),this._renameChatID.value=""}}autoScrollToCurrent(){const{currentChatID:e}=this.props;e&&v(this.base).find(`[z-key="${e}"]`).scrollIntoView({behavior:"smooth",block:"center"})}componentDidMount(){this.autoScrollToCurrent()}componentDidUpdate(e){e.currentChatID!==this.props.currentChatID&&this.autoScrollToCurrent()}_getItems(e){const{chats:t,currentChatID:s,store:n}=e,r=[],o=this._renameChatID.value,a={},l=e.getItem||(d=>{const f=d.id===s,m=d.id===o,y=m?void 0:n.getAvatar("chat",{chat:d},{icon:{icon:"chat",className:f?"text-primary":"text-gray"},size:20,background:"transparent"});return{type:"item",className:`item menu-item${m?" is-renaming":""}`,avatar:y,key:d.id,title:m?g("input",{className:"form-control",defaultValue:d.title,onChange:this._handleRenameChatTitle,onBlur:()=>this._renameChatID.value="",onKeyUp:this._handleRenameChatTitleKeyUp}):d.$local.tempTitle??d.title,hint:d.created_at?`${d.title}（${rt(d.created_at,"yyyy-MM-dd hh:mm")}）`:d.title,selected:f,component:"li",innerComponent:m?"div":"a",contentClass:f?"font-bold":"",actions:m||Dg(d)?null:this._getItemActions}}),c=new Date,h=d=>(d=Je(d),Pp(d,c)?"today":Lp(d,c)?"yesterday":ea(d,c)?"thisMonth":rt(d,"yyyy-MM"));return t.forEach(d=>{const f=d.created_at?h(d.created_at):"other";a[f]||(a[f]={type:f,start:d.created_at||0,items:[]}),a[f].items.push(l(d))}),Object.values(a).forEach(d=>{r.push({key:d.type,title:Se("dateGroup."+d.type,[],d.type),items:d.items})}),r}render(e){return g(Rt,{className:"ai-chats-list",items:this._getItems(e),onClickItem:this._handleClickItem,defaultNestedShow:!0,indent:0,nestedToggle:"a",hoverItemActions:!0,activeOnHover:!1})}}class vx extends ae{constructor(e){var s;super(e),this._searchValue=pe(""),this._loadedChats=pe({}),this._loading=pe(""),this._currentTab=xe(()=>{const n=this._currentTabKey.value;return this.props.tabs.find(r=>r.key===n)||{key:"RECENTS",title:Se("recentChats"),chatTypes:["chat"]}}),this._filteredChats=xe(()=>{const n=this._searchValue.value,{chats:r,chatTypes:o=[],chatsFetcher:a}=this._currentTab.value,l=r||(a?this._loadedChats.value[this._currentTabKey.value]??[]:this.props.store.sortedChats),c=new Set(o);return l.length&&(o||n)?l.filter(h=>(!n||h.title.includes(n))&&(!c.size||c.has(h.custom_data.type||"chat"))):l}),this._handleNewChat=()=>{var n,r;(r=(n=this.props).onCreateChat)==null||r.call(n)},this._handleSearch=n=>{this._searchValue.value=n},this._handleClickTab=n=>{const r=n.item.key;this._currentTabKey.value=r,this.load(r)},this._handleSelectChat=n=>{var o,a;const r=this._filteredChats.value.find(l=>l.id===n);r&&((a=(o=this.props).onSelectChat)==null||a.call(o,r,this._currentTab.value))};const t=e.currentTab??((s=this.props.tabs[0])==null?void 0:s.key)??"";this._currentTabKey=pe(t)}get currentTab(){return this._currentTab.value}async load(e){e=e??this._currentTabKey.value;const t=this.props.tabs.find(n=>n.key===e);if(!t||!t.chatsFetcher)return;this._loading.value=e;const s=await Ne(t.chatsFetcher,[this.props.store,t]);return this._loadedChats.value={...this._loadedChats.value,[e]:s},this._loading.value="",s}render(e){const{tabs:t}=e,s=this._filteredChats.value||[],n=this._currentTab.value,r=n.key;return g(K0,{className:"ai-chats-panel-side",contentClass:"scrollbar-hover overflow-auto h-full",minWidth:160,maxWidth:"60%"},g("div",{class:"sticky top-0 bg-canvas z-10 rounded-lg px-2 pt-2 space-y-2"},(t==null?void 0:t.length)>1?g(dd,{className:"ai-chats-sidebar-tabs bg-primary-100 rounded-full",type:"pills",justified:!0,items:t.map(o=>({text:o.title,key:o.key})),active:r,onClickItem:this._handleClickTab}):null,n.searchBox!==!1||n.onCreate!==!1?g("div",{className:"pb-1 flex items-center gap-2 rounded-lg"},n.searchBox!==!1?g(mn,{circle:!0,onChange:this._handleSearch,className:"flex-auto",placeholder:Se("searchChats"),...typeof n.searchBox=="object"?n.searchBox:{}}):null,n.onCreate!==!1?g(we,{hint:Se("newChat"),icon:"plus",type:"primary-pale",rounded:"full",disabled:e.disabled,className:"flex-none",onClick:typeof n.onCreate=="function"?n.onCreate:this._handleNewChat}):null):null),g(yx,{store:e.store,currentChatID:e.currentChatID,chats:s,onSelectChat:this._handleSelectChat,getItem:n.onRenderMenuItem}),!(s!=null&&s.length)&&r===this._loading.value?g("div",{className:"px-4 py-2"},g(Ie,{icon:"spinner-indicator",className:"spin muted"}),g("span",{className:"text-gray text-shimmer text-sm ml-2"},Se("loading"))):null)}}class qg extends ae{constructor(e){super(e),this._loadError=pe(),this._loadedID="",this._loading=xe(()=>this._loadedID===this.props.chatID),this._timer=0,this.verifyTask=async(t,s="")=>{const{task:n}=this;if(n.status!=="done")return;const r=n.id.replace("task-",""),o=ut("aitask","verify",`taskID=${r}`),a=await v.post(o,{result:t,remark:s},"json");if(a.result!=="success"){Ve.alert(a.message??Se("taskVerifyPassFailed"));return}this._task.value={...n,status:t==="pass"?"closed":"wait"},Ms.show({content:a.message??Se("taskVerifyPassSuccess"),type:"success"})},this._handleSend=t=>this.verifyTask("refine",t),this._handleClose=()=>this.verifyTask("pass"),this._renderItem=t=>{var n;const s=t;return s.role==="assistant"&&s.result?g(Og,{role:s.role,store:this.props.store,avatar:this._noAvatar?!1:void 0,date:s.created_at},g("div",{className:"ai-message-bubble-shape py-2 px-3"},g(Sd,{className:"ai-message-bubble-content",...s.result}))):s.role==="assistant"&&!s.content.length||s.role==="tool"||(n=s.custom_data)!=null&&n.invisible?null:g(Bg,{store:this.props.store,message:s,chat:this.props.task,noAvatar:this._noAvatar,assetBaseUrl:this.props.store.assetBaseUrl})},this._task=pe(e.task||{id:e.chatID,type:"task",title:"",custom_data:{},$local:{}})}get store(){return this.props.store}get error(){return this.props.store.error}get loading(){return this._loading.value}get task(){return this._task.value}async loadChat(e){if(e=e??this.props.chatID,this._loadedID!==e){this._loadedID=e,e!==this._task.value.id&&(this._task.value={id:e,type:"task",title:"",custom_data:{},$local:{}});try{const t=+e.replace("task-",""),s=await this.store.getTaskMessages(t);this.props.chatID===this._loadedID&&(this._task.value=s)}catch(t){console.error("[ZUI] AITaskView: Load task error",t)}this._loadedID=""}}async _init(){await this.loadChat()}componentDidUpdate(e){e.chatID!==this.props.chatID&&this._init()}componentDidMount(){this._init(),this._timer=window.setInterval(()=>{this.loadChat()},6e4)}componentWillUnmount(){this._timer&&(window.clearInterval(this._timer),this._timer=0)}_renderError(e,t){if(t=t??this.error,!t)return null;const{getErrorContent:s}=e,n=(s==null?void 0:s(t))??t.message;return g("div",{key:"error",className:"ai-chats-panel-error"},g(fe,{className:"ai-chats-panel-error-content",content:n,generatorArgs:[e],generatorThis:this}))}_renderStatus(e){const t=Se(`taskStatus.${e}`);return g("div",{className:K("ml-2 font-normal label size-sm rounded-full",{wait:"gray-pale",doing:"warning-pale",done:"primary-pale",fail:"danger-pale",closed:"gray-pale",cancel:"light"}[e]??"gray-pale")},t)}_renderSendbox(e){var r,o;const{sendbox:t}=e,{task:s}=this,{status:n}=s;if(n==="cancel"||n==="closed")return null;if(n==="done"||n==="fail"){const a=[{icon:"",code:`teammate-${s.teammate.id}`,title:s.teammate.name},{icon:"",code:`agent-${s.agents}`,title:s.name}];return g(Wg,{key:s.id,chat:s,store:this.store,chatID:s.id,disabled:!!this.store.error,onSend:this._handleSend,llmProviders:e.store.chatModels,defaultModel:(r=s.settings)==null?void 0:r.model,currentModel:(o=s.custom_data)==null?void 0:o.model,contexts:a,placeholder:Se("taskVerifyTip"),extraBtns:[{key:"close",text:Se("taskVerifyPass"),icon:"",onClick:this._handleClose}],sendBtn:{text:Se("taskVerifyRefine"),icon:"",trailingIcon:"arrow-right"},...typeof t=="object"?t:{}})}return g("div",{className:"center m-4 p-2 rounded-xl text-gray surface-light"},Se(`taskStatusMessage.${n}`))}render(e){var w,x,D;const t=this.task,s=t.messages||[],{noAvatar:n,mode:r="full",embed:o=!1}=e,{hideUserMessage:a=r!=="full",hideHeader:l=r==="lite",sendbox:c=r==="full",noMessagesTip:h}=e,d=this.loading,f=!s.length,m=t.created_at||t.created_on||Date.now();let y=[...s].reverse();jn((w=t.custom_data.form)==null?void 0:w.summary)&&y.push({id:"form-summary",role:"assistant",content:(x=t.custom_data.form)==null?void 0:x.summary,created_at:m}),t.custom_data.welcome&&y.push({id:"welcome",role:"assistant",content:t.custom_data.welcome,created_at:m}),a&&(y=y.filter(I=>I.role!=="user")),(D=t.result)==null||D.forEach(I=>{y.unshift({id:I.callID,role:"assistant",content:"",result:I,created_at:t.updated_at||t.finishedDate||t.created_at})}),this._noAvatar=n??a;const b=a&&this._noAvatar&&!c;return g("div",{className:K(`ai-chat-view is-mode-${r}`,{"is-only-response":b,"is-embed":o,"is-no-message":f})},l?null:g("div",{className:"ai-chat-view-header"},g("div",{className:"ai-chat-view-title",title:t.title},t.$local.tempTitle??t.title,this._renderStatus(t.status))),g("div",{className:"ai-chat-view-body"},y.length?g($t,{className:"ai-chat-view-messages scrollbar-hover",itemKey:"id",items:y,itemRender:this._renderItem}):g("div",{className:"muted h-full center py-4 my-8"},d?g(fl,{text:Se("loading"),className:"animate-pulse col gap-2 items-center"}):g(fe,{content:h??Se("taskNoMessagesTip"),generatorArgs:[e],generatorThis:this}))),c&&this._renderSendbox(e))}}const Gg=class tb extends Ke{constructor(e){super(e),this._loaded=pe(!1),this._selectedChat=pe(),this._currentTab=pe(),this._currentChat=xe(()=>{const s=this._currentChatID.value;return this._store.chats.find(n=>n.id===s)||this._selectedChat.value}),this._handleSelectChat=(s,n)=>{this._selectedChat.value=s,this._currentTab.value=n,this.selectChat(s.id)},this._handleNewChat=()=>{this.createChat()},this._handleCreateChat=(s,n)=>{this._currentChatID.value===n&&(this._currentChatID.value=s)};const{store:t}=e;this._store=t instanceof ns||t.constructor.NAME===ns.NAME?t:new ns(t),this._currentChatID=pe(e.currentChatID??""),this._error=pe(this._store.error)}get currentChatID(){return this._currentChatID.value}get currentChat(){return this._currentChat.value}get store(){return this._store}selectChat(e){this._currentChatID.value!==e&&(this._currentChatID.value=e,this.store.reactions.selectChat(e))}_loadEndWithError(e){this._error.value=e,this._loaded.value=!0}async loadChats(e){var o;const{store:t}=this,s=async()=>{t.chats.length||await this.createChat({local:!0})};if(t.error){await s(),this._loadEndWithError(t.error);return}this._loaded.value=!1;try{e?await t.loadChats():await t.tryLoadChats()}catch(a){console.error("[ZUI] loadChats error",a),await s(),this._loadEndWithError(t.error||{message:Se("errors.loadDataFailed"),type:"load-chats-failed"});return}const n=this._currentChatID.value||((o=t.sortedChats[0])==null?void 0:o.id);n&&this.selectChat(n),this._loaded.value=!0;const{postMessage:r}=this.props;r?await t.postMessage(r,n):t.chats.length||await s()}async createChat(e){const{select:t=!0,local:s=!0,...n}=e||{};let r;return s?r=await this.store.createLocalChat(n):r=await this.store.createChat(n),r&&t&&this.selectChat(r),r}componentDidMount(){const{loadOnMount:e}=this.props;e&&this.loadChats(e==="force")}_getClassName(e){return[e.className,"ai-chats-panel ai-styled",e.popup?"ai-popup-style":""]}_getChildren(e){return[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}_renderSidebar(e){return e.sidebar?g(vx,{currentChatID:this.currentChatID,store:this.store,tabs:this.props.tabs||tb.defaultProps.tabs,disabled:!!this._error.value,onCreateChat:this._handleNewChat,onSelectChat:this._handleSelectChat}):null}_renderChat(){const e=this.currentChat;return e?Dg(e)?g(qg,{key:e.id,task:e,chatID:e.id,store:this.store}):g(Td,{key:e.id,chatID:e.id,store:this.store,onCreateChat:this._handleCreateChat}):g("div",{className:"ai-chats-panel-main-empty p-4"},Se("selectChatTip"))}_renderBody(e){return this._loaded.value?g(q0,{className:"ai-chats-panel-body"},this._renderSidebar(e),g("div",{className:"ai-chats-panel-main"},this._renderChat(),this._renderError(e),e.children)):g("div",{className:"ai-chats-panel-body center"},g(fl,{text:Se("loading")}))}_renderError(e){const t=this._error.value;if(!t)return null;const{getErrorContent:s}=e,n=s?s(t):t.message;return g("div",{key:"error",className:"ai-chats-panel-error"},g(fe,{className:"ai-chats-panel-error-content",content:n,generatorArgs:[e],generatorThis:this}))}_renderHeader(e){return g(fe,{key:"header",className:"ai-chats-panel-header",content:this.props.header,generatorArgs:[e],generatorThis:this})}_renderFooter(e){return g(fe,{key:"footer",className:"ai-chats-panel-footer",content:this.props.footer,generatorArgs:[e],generatorThis:this})}};Gg.defaultProps={loadOnMount:!0,sidebar:!0,popup:!0,tabs:[{key:"chats",chatTypes:["chat"],title:"Chats"}]};let $d=Gg;class _x extends ae{constructor(){super(...arguments),this._hasMoved=!1,this._elementRef=ye(),this._handleClick=e=>{var t,s;if(this._hasMoved){this._hasMoved=!1;return}(s=(t=this.props).onClick)==null||s.call(t,e)}}componentDidMount(){this._elementRef.current}componentWillUnmount(){var e;(e=this._moveable)==null||e.destroy()}render(e){return g("div",{className:"ai-mini-btn",ref:this._elementRef,onClick:this._handleClick},g(Gs,{background:"var(--ai-mini-btn-bg)",className:"shadow text-canvas state cursor-pointer ai-loading",circle:!0,displayText:"AI",size:40}),e.children)}}function bx(i,e){return new Promise(t=>{const{interval:s=100,timeout:n=6e4,timerRef:r,timeoutValue:o,abortSignal:a}=typeof e=="number"?{timeout:e}:e||{};let l=0,c=!1,h;const d=m=>{h=m},f=window.setInterval(async()=>{if(l++,c)return;if(a!=null&&a.aborted){clearInterval(f),t(void 0);return}if(c=!0,await i(d,l))clearInterval(f),t(h);else if(l*s>=n){const y=o?await o(l):void 0;clearInterval(f),t(y)}c=!1},s);r&&(r.current=f)})}let Zg=class extends Ke{constructor(e){super(e),this._panelRef=ye(),this._lastShowMode="normal",this._beforeEmbedMode="normal",this._lastMode="normal",this._neverShow=!0,this._handleClickSuggestion=(t,s)=>{var n,r;(r=(n=this.props).onAcceptSuggestion)==null||r.call(n,t,s)},this._handleMiniBtnClick=t=>{t.target.closest(".avatar")&&this.toggleShow(!0)},this._store=e.store instanceof ns?e.store:new ns(e.store),this._mode=pe(e.open?"normal":e.mode||"minimized"),this._modeEffect=Tt(()=>{var n,r;const{mode:t}=this;(t==="normal"||t==="maximized")&&(this._lastShowMode=t),t!=="embed"&&(this._beforeEmbedMode=t),t!=="minimized"&&(this._neverShow=!1);const s=this._lastMode;(r=(n=this.props).onModeChange)==null||r.call(n,t,s),this._lastMode=t})}componentDidMount(){super.componentDidMount()}componentWillUnmount(){var e;super.componentWillUnmount(),(e=this._moveable)==null||e.destroy()}get store(){return this._store}get panel(){return this._panelRef.current}get reactions(){return this.store.reactions}get mode(){return this._mode.value}get shown(){return this._mode.value!=="minimized"}get maximized(){return this._mode.value==="maximized"}get minimized(){return this._mode.value==="minimized"}get embed(){return this._mode.value==="embed"}setMode(e){this._mode.value=e}toggleShow(e){e=e??!this.shown,this.setMode(e?this._lastShowMode:"minimized")}resetPanelPosition(){$(this.element).find(".ai-chats-panel").css("transform","none")}reapplayPanelPosition(){}toggleMaximize(e){e=e??!this.maximized,this.setMode(e?"maximized":"normal"),this.resetPanelPosition()}toggleMinimize(e){e=e??!this.minimized,this.setMode(e?"minimized":this._lastShowMode)}toggleEmbed(e){e=e??!this.embed,this.setMode(e?"embed":"minimized")}selectChat(e){var t;return(t=this.panel)==null?void 0:t.selectChat(e)}createChat(e){var t;return(t=this.panel)==null?void 0:t.createChat(e)}postMessage(e,t){return this.store.postMessage(e,t)}async open(e,t){var o,a;await bx(()=>this.panel),typeof e=="string"&&(e={chat:e});let s=typeof e.postMessage=="string"?{content:e.postMessage}:e.postMessage;t&&(s=s||{content:""},typeof t=="string"?s.content=t:s={...s,...t}),(o=s==null?void 0:s.content)!=null&&o.length||(s=void 0);const n=e.chat??(s==null?void 0:s.chat);let r=typeof n=="string"?n:void 0;if(!r){if(!s&&!n)return;r="NEW"}r==="NEW"&&(r=await this.createChat({select:!0,local:!s,...typeof n=="object"?n:{}}),r&&((a=e.onCreateChat)==null||a.call(this,r))),r&&(s&&await this.postMessage(s,r),e.select&&this.selectChat(r))}_getClassName(e){const{mode:t}=this;return[e.className,"ai-panel ai-styled",{"is-shown":t!=="minimized","is-maximized":t==="maximized","is-minimized":t==="minimized","is-normal":t==="normal","is-embed":t==="embed"}]}_getProps(e){const{dock:t="bottom-right",position:s={},maximizedPosition:n,style:r={}}=e,o=(this.maximized?n:s)||s;return t.split("-").forEach(a=>{r[a]=o[a]||24}),["left","top","right","bottom"].forEach(a=>{const l=o[a];l!==void 0&&(r[`--ai-panel-pos-${a}`]=typeof l=="string"?l:`${l}px`)}),Le(super._getProps(e),{"z-dock":t,style:r})}_getChildren(e){return this.store.isDisabledAllPrivs?[]:[this._renderMiniBtn(),this._renderChatsPanel(e)]}_renderHeader(){const{maximized:e}=this;return g("div",{className:"ai-panel-header"},g(Be,{className:"ai-panel-toolbar",items:[{icon:e?"fullscreen-exit":"fullscreen",hint:Se(e||e?"minimize":"maximize"),onClick:()=>this.toggleMaximize()},{icon:"close",hint:Se("close"),onClick:()=>this.toggleMinimize(!0)}]}))}_renderChatsPanel(e){if(this._neverShow&&!this.shown)return null;const{size:t={width:"100%",height:"100%"},tabs:s,getErrorContent:n}=e;return g($d,{ref:this._panelRef,store:this.store,style:{width:t.width,height:t.height},loadOnMount:"force",header:this._renderHeader(),tabs:s,getErrorContent:n})}_renderSuggestions(){const{suggestions:e}=this.reactions;return g("div",{className:`ai-panel-suggestions${e.length?"":" is-empty"}`},e.map(t=>{const{type:s,title:n,hint:r,icon:o,command:a,action:l,btnProps:c={}}=t;return Le(c,{type:"ai-btn-style","z-type":s,text:n,size:"sm",icon:o,command:a,onClick:l?this._handleClickSuggestion.bind(this,t):null}),g("div",{className:"hint hint-left hint-primary","data-hint":r},g(we,{key:n,...c}))}))}_renderMiniBtn(){return g(_x,{onClick:this._handleMiniBtnClick},this._renderSuggestions())}};Zg.defaultProps={open:!1,dock:"bottom-right",size:{width:800,height:500}};let Yg=class extends Ke{constructor(e){super(e),this._headerRef=ye(),this._store=e.store instanceof ns?e.store:new ns(e.store)}get store(){return this._store}componentDidMount(){super.componentDidMount(),this._moveable=new Ni(this.element,{selector:".ai-popup-box",handle:".ai-popup-header,.ai-chat-view-header",move:"transform",edgeDetection:{container:"viewport",distance:24}})}componentWillUnmount(){var e;super.componentWillUnmount(),(e=this._moveable)==null||e.destroy()}_getClassName(e){return[e.className,"ai-popup"]}_getProps(e){return Le(super._getProps(e),{"z-placement":e.placement,style:{height:e.height,...e.style}})}_renderHeader(e){const{onClose:t}=e;return g("div",{className:"ai-popup-header",ref:this._headerRef},g(Be,{className:"ai-popup-toolbar",items:[t?{icon:"close",hint:Se("close"),onClick:t}:void 0].filter(Boolean)}))}_renderView(e){return e.viewType==="chats"?g($d,{store:this.store,postMessage:e.postMessage,currentChatID:e.chatID,sidebar:!1,popup:!1,...e.viewProps}):e.viewType==="task"?g(qg,{store:this.store,chatID:e.chatID,...e.viewProps}):g(Td,{store:this.store,postMessage:e.postMessage,chatID:e.chatID,creatingChat:e.creatingChat,...e.viewProps})}_getChildren(e){return[g("div",{className:"ai-styled ai-popup-box ai-popup-style",style:{width:e.width}},this._renderView(e),this._renderHeader(e))]}};Yg.defaultProps={placement:"top-right",width:500,viewType:"chats"};let Jg=class extends Gt{constructor(e){super(e),this._getModelItems=async()=>{var l;const{store:t,defaultModel:s="",foreLoadModels:n,noModelHint:r}=this.props;let o=s;typeof o=="string"&&(o={text:Se("defaultModel"),value:""});const a=[];if(t)try{const c=await t.getLlmModels(n);for(const h of c)(l=h.abilities)!=null&&l.includes("chat")&&a.push({text:h.name,value:h.id})}catch{}return a.length||a.push({text:r??Se("noChatModelHint"),value:"no-model",disabled:!0}),o&&a.unshift(o),a},this.props.items||(this.props.items=this._getModelItems)}_getPopProps(e,t){var o;const{menu:s,...n}=super._getPopProps(e,t),r=(o=e.store)==null?void 0:o.error;return{...n,items:this._getModelItems,menu:{footer:r?g("div",{className:"row items-center gap-2"},g(Ie,{icon:"alert",className:"text-warning"}),r.message):void 0,...s}}}};Jg.defaultProps={...Gt.defaultProps,emptyValue:!1};let Xg=class extends ae{constructor(e){super(e),this._model=xe(()=>{const{defaultModel:t,store:s,model:n}=this.props,r=s==null?void 0:s.chatModels.find(o=>o.id===n);if(r)return r.name;if(!n||String(n)===String(+n)){if(t===!0)return Se("defaultModel");if(typeof t=="string")return t}return n})}loadModels(){var e;(e=this.props.store)==null||e.getLlmModels(this.props.foreLoadModels)}componentDidMount(){this.loadModels()}render(e){return g("span",{className:K("ai-model-name",e.className),style:e.style,"z-model":e.model},this._model.value)}};Xg.defaultProps={defaultModel:!0};const Dd=class sb extends be{destroy(){const e=this.$element.parent();super.destroy(),e.is(".ai-chats-panel-root")&&e.remove()}static open(e,t){const s=v(t||"body");let n=s.find(".ai-chats-panel-root");if(n.length){const o=sb.query(n);if(o)return o.render(e),o}else n=v('<div class="ai-chats-panel-root" style="position: fixed; left: 0; top: 0; right: 0; bottom: 0; pointer-events: none; z-index: 1110"></div>'),s.append(n);return new this(n,e)}};Dd.NAME="AIChatsPanel",Dd.Component=$d;let Qg=Dd;Qg.register();class pl extends ns{constructor(e){const{baseUrl:t,host:s,port:n,assetBaseUrl:r,appID:o="",token:a,adminToken:l,userID:c="",agentID:h="zchat",globalMemory:d,defaultModel:f,getAvatar:m}=e;let y=t||(s?n?`///${s}:${n}`:`///${s}`:""),b=e.apiVersion;y.endsWith("/")&&(y=y.substring(-1)),y.endsWith("/v1")?(y=y.substring(0,y.length-3),b="v1"):y.endsWith("/v8")&&(y=y.substring(0,y.length-3),b="v8"),super({context:{baseUrl:y,assetBaseUrl:r?r.endsWith("/")?r.substring(-1):`${r}`:void 0,appID:o,token:typeof a=="string"?a:"",adminToken:typeof l=="string"?l:"",tokenExpiredTime:0,userID:c,agentID:h,apiVersion:b,globalMemory:d,defaultModel:f},getAvatar:m,fetchers:{},plugins:e.plugins,useISODate:!0,privs:e.privs}),this._isConfigOK=!0,this._tokenSetting=a,this._adminTokenSetting=l,this._teammateMap=e.teammateMap||{},this._fetchers=this._getFetchers()}get apiVersion(){return this.context.apiVersion}isConfigOK(){const e=["baseUrl","appID"].filter(t=>!this.context[t]);return this._tokenSetting||e.push("token"),this._isConfigOK=!e.length,e.length?(this.setError({message:Se("errors.zaiConfigNotValid")||"The zai config is not valid.",type:"configNotValid"}),!1):!0}async getInfo(e){if(this._info.value&&!e)return this._info.value;if(this._getInfoCallbacks)return new Promise(n=>{this._getInfoCallbacks.push(n)});this._getInfoCallbacks=[];let t,s=this.apiVersion;if(!s){try{const n=this._getFetchersV8().getInfo;t=await Ne(n,[{...this.context,apiVersion:"v8"}]),t&&(s="v8")}catch{s="v1"}this.setContext({apiVersion:s,tokenExpiredTime:0,adminTokenExpiredTime:0}),this._fetchers=this._getFetchers()}if(t||(t=await super.getInfo(e)),this._getInfoCallbacks){for(const n of this._getInfoCallbacks)n(t);this._getInfoCallbacks=void 0}return t}async getToken(){var r;if(!this._isConfigOK)throw new Error(((r=this._error.value)==null?void 0:r.message)??"The zai config is not valid.");const e=this._tokenSetting;if(typeof e=="string")return e;if(typeof e!="function")throw new Error("Token getter is required.");const t=this.context;if(t.token&&t.tokenExpiredTime&&Date.now()/1e3<t.tokenExpiredTime+60)return t.token;const s=await e.call(this,t.appID);if(typeof s=="string")return this.setContext({token:s,tokenExpiredTime:Date.now()+60}),s;const n={};return n.tokenExpiredTime=s.expiredTime,s.baseUrl&&(n.baseUrl=s.baseUrl),s.appID&&(n.appID=s.appID),s.agentID&&(n.agentID=s.agentID),s.userID&&(n.userID=s.userID),s.token?n.token=s.token:n.token=`${this.apiVersion==="v8"?"ek":"ex"}-${btoa(JSON.stringify({hash:s.hash,app_id:n.appID,user_id:n.userID,expired_time:n.tokenExpiredTime}))}`,this.setContext(n),n.token}async getAdminToken(){var r;if(!this._isConfigOK)throw new Error(((r=this._error.value)==null?void 0:r.message)??"The zai config is not valid.");const e=this._adminTokenSetting;if(!e)return await this.getToken();if(typeof e=="string")return e;const t=this.context,s=await e.call(this,t.appID);if(typeof s=="string")return this.setContext({adminToken:s,adminTokenExpiredTime:Date.now()+60}),s;const n={};return n.adminTokenExpiredTime=s.expiredTime,s.baseUrl&&(n.baseUrl=s.baseUrl),s.appID&&(n.appID=s.appID),s.userID&&(n.userID=s.userID),s.token?n.adminToken=s.token:n.adminToken=`ak-${btoa(JSON.stringify({hash:s.hash,app_id:n.appID,user_id:n.userID,expired_time:n.adminTokenExpiredTime}))}`,this.setContext(n),n.adminToken}async _readStream(e,t){var h,d,f;const s=new TextDecoder,n=()=>new Promise(m=>requestAnimationFrame(m)),r=new Map,o=new Map;let a,l="",c="";for(;;){await n();const{done:m,value:y}=await e.read();if(m)break;const w=s.decode(y).split(`
`).filter(Boolean);let x=!1;for(const D of w)if(D.startsWith("data: ")){if(D==="data: [DONE]"){x=!0;break}try{const I=JSON.parse(D.slice(6)),E=(d=(h=I==null?void 0:I.choices)==null?void 0:h[0])==null?void 0:d.delta;let P;if(E){const{content:O,tool_calls:W}=E;if(typeof O=="string"&&O.length&&(c+=O),Array.isArray(W)&&W.length)for(const J of W){J.id&&(l=J.id);const Y=r.get(l);Y?(f=J.function.arguments)!=null&&f.length&&(Y.function.arguments+=J.function.arguments):(typeof J.function.arguments!="string"&&(J.function.arguments=""),r.set(l,J),o.set(l,o.size))}P={type:"tool_calls",content:c},a=Array.from(r.values()).sort((J,Y)=>(o.get(J.id)??0)-(o.get(Y.id)??0))}else I.reasoning?P={type:"reason",reasonType:I.reasonType||"thinking",content:I.reasoning}:(typeof I.type=="number"&&(I.type=I.type===1?"reason":"chat"),P=I);a!=null&&a.length&&(P.tool_calls=a),I.model&&(P.model=I.model),t(P)}catch(I){console.error("[ZUI] AI: Failed to parse stream data:",I)}}if(x)break}}async fetch(e,t,s){var W,J;if(!this._isConfigOK)throw new Error(((W=this._error.value)==null?void 0:W.message)??"The zai config is not valid.");e.apiVersion||(await this.getInfo(),e.apiVersion=this.apiVersion);const{method:n,data:r,onStream:o,expectStatus:a,statusResult:l,params:c,convert:h,dataType:d="json",admin:f=!1}=typeof s=="string"?{method:s}:s||{},m=await(f?this.getAdminToken():this.getToken()),y={zh_cn:"zh-CN",zh_tw:"zh_TW",en:"en-US"},b=Pe.getCode(),w=typeof t=="function"?t(e):`${e.baseUrl}/${t.startsWith("/")?t.substring(1):t}`,x=c?new URLSearchParams(c).toString():"",D=x?`${w}?${x}`:w,I=r instanceof FormData,E=await fetch(D,{method:n||(I?"POST":"GET"),headers:{...I?{}:{"Content-Type":"application/json"},Authorization:`Bearer ${m}`,"Accept-Language":y[b]||b},body:!I&&typeof r!="string"?JSON.stringify(r):r});if(a&&!(Array.isArray(a)?a:[a]).includes(E.status))throw new Error(`Expected status ${a} but got ${E.status}`);if(l)return l[E.status]??l[0];if(E.status===401){const Y={type:"unauthorized",message:Se("errors.unauthorized")||"Unauthorized"};let ve="";try{ve=await E.text();try{const ee=JSON.parse(ve);let ne=ee.error||ee.message;ne&&(typeof ne=="string"&&(ne={message:ne}),ne.message&&(Y.message=Se(ne.code?`errors.code.${ne.code}`:`errors.${ne.message}`)||ne.message))}catch{}}catch{}return this.setError(Y),null}else this.setError();if(E.status===404)return null;if(E.status===500){const Y=await E.text();throw new Error(`Server error: ${Y}`)}if(o){const Y=(J=E.body)==null?void 0:J.getReader();if(Y)return await this._readStream(Y,o),{}}let P;const O=await E.text();if(d==="json")try{P=JSON.parse(O)}catch{throw new Error(O)}else P=O;return h&&(P=await h(P)),P}async fetchFromZentao(e,t){typeof t=="string"&&(t={method:t});const s=await v.ajax({url:typeof e=="string"?e:ut(...e),dataType:"json",...t});if(typeof s=="object"){if(s.result==="success"&&s.data!==void 0)return s.data;if(s.result==="fail")throw new Error(s.message)}return s}async getMemories(){const e=this._checkFetcher("getMemories");return await Ne(e,[this.context])}async getMemory(e){const t=this._checkFetcher("getMemory");return await Ne(t,[this.context,e])}async createMemory(e){const t=this._checkFetcher("createMemory");if(!e.embedding_model){const n=await this.getTextEmbeddingModel();n&&(e.embedding_model=n.id)}return await Ne(t,[this.context,e])}async deleteMemory(e){const t=this._checkFetcher("deleteMemory");return await Ne(t,[this.context,e])}async getMemoryContent(e,t){const s=this._checkFetcher("getMemoryContent");return await Ne(s,[this.context,e===tn?this.globalMemory:e,t])}async getMemoryContents(e,t){const s=this._checkFetcher("getMemoryContents");return await Ne(s,[this.context,e===tn?this.globalMemory:e,t])}async saveMemoryContent(e,t){var r,o;const s=this._checkFetcher("saveMemoryContent");return(r=t.title)!=null&&r.length&&!((o=t.content)!=null&&o.length)&&(t.content=t.title),await Ne(s,[this.context,e===tn?this.globalMemory:e,{content_type:"text",...t}])}async deleteMemoryContent(e,t){const s=this._checkFetcher("deleteMemoryContent");return await Ne(s,[this.context,e===tn?this.globalMemory:e,t])}async updateMemoryContent(e,t){const s=this._checkFetcher("updateMemoryContent");return await Ne(s,[this.context,e,t])}async filterMemoryContents(e,t){const s=this._checkFetcher("filterMemoryContents");return await Ne(s,[this.context,e===tn?this.globalMemory:e,t])}async getMemoryContentChunks(e,t){const s=this._checkFetcher("getMemoryContentChunks");return await Ne(s,[this.context,e===tn?this.globalMemory:e,t])}async searchMemoryChunks(e,t){const s=this._checkFetcher("searchMemoryChunks"),n=await Ne(s,[this.context,e===tn?this.globalMemory:e,t]);return n.sort((r,o)=>o.similarity-r.similarity),n}async searchMemoryContents(e,t){const s=this._checkFetcher("searchMemoryContents");return await Ne(s,[this.context,e===tn?this.globalMemory:e,t])}async getTasks(){const e=this._checkFetcher("getTasks");return(await Ne(e,[this.context])).map(this.formatTask.bind(this))}async getTaskMessages(e){const t=this._checkFetcher("getTaskMessages"),s=await Ne(t,[this.context,e]);return this.formatTask(s)}getTeammate(e){return this._teammateMap[e]}formatMessage(e){return typeof e.id=="number"&&(e.id=`zt-${e.id}`),!e.created_at&&typeof e.createdDate=="string"&&(e.created_at=Je(e.createdDate).getTime()),e}formatTask(e){if(e.type!=="task"&&e.taskType===void 0&&(e.taskType=e.type),e.$local=e.$local||{},e.custom_data=e.custom_data||{},e.type="task",e.title=e.name,typeof e.id=="number"&&(e.id=`task-${e.id}`),typeof e.result=="string"&&e.result.startsWith("["))try{e.result=JSON.parse(e.result)}catch(t){e.result=void 0,console.error("[ZUI] AI: Failed to parse task result:",t)}else Array.isArray(e.result)||(e.result=[]);return!e.created_at&&typeof e.createdDate=="string"&&(e.created_at=Je(e.createdDate).getTime()),e.llm&&(e.custom_data.model=e.llm),Array.isArray(e.messages)?e.messages=e.messages.map(this.formatMessage):Array.isArray(e.messages)||(e.messages=[]),(typeof e.teammate=="string"||typeof e.teammate=="number")&&(e.teammate=this.getTeammate(e.teammate)||{id:e.teammate,name:e.teammate,avatar:""}),e}_getFetchers(){return this._getFetchersV8()}_getFetchersV8(){return{getInfo:e=>this.fetch(e,"v8/_info",{convert:t=>({name:"zai",...t})}),getConversations:e=>this.fetch(e,"v8/chat/conversations"),getConversation:(e,t)=>this.fetch(e,`v8/chat/conversations/${t}`,{convert:s=>{if(!s||typeof s!="object"||s.error!==void 0){if(s&&typeof s=="object"&&s.error)throw new Error(s.error);return}}}),createConversation:(e,t)=>{const{title:s,settings:n={},prompt:r,memories:o,customData:a}=t,l=o?Q0(o,e):void 0;r!=null&&r.length&&(n.prompt=r);let c=n.model??t.model;return c!==void 0&&!this._llmModels.value.some(h=>h.id===c)&&(c=void 0),c!=null&&c.length?n.model=c:delete n.model,this.fetch(e,"v8/chat/conversations",{method:"POST",data:{...s?{title:s}:{},settings:{...n},custom_data:a,reference_settings:l!=null&&l.collections.length?l:void 0}})},updateConversation:(e,t)=>this.fetch(e,`v8/chat/conversations/${t.id}`,{method:"PUT",data:{...t.title?{title:t.title}:{},...t.custom_data?{custom_data:t.custom_data}:{}}}),deleteConversation:(e,t)=>this.fetch(e,`v8/chat/conversations/${t}`,{method:"DELETE",statusResult:{200:!0,0:!1}}),getMessages:(e,t)=>this.fetch(e,`v8/chat/conversations/${t}/messages`),deleteMessages:(e,t)=>this.fetch(e,`v8/chat/conversations/${t}/messages`,{method:"DELETE",statusResult:{200:!0,0:!1}}),postMessage:(e,t,s)=>{var n;return this.fetch(e,`v8/chat/conversations/${t.id}/messages`,{method:"POST",data:{content:t.content,stream:!!s,tools:(n=t.tools)==null?void 0:n.map(r=>({type:"function",function:{name:r.name,description:r.description,parameters:r.parameters}})),messages:t.messages,custom_data:t.custom_data},onStream:s})},postBatchMessages:(e,t,s)=>{var n;return this.fetch(e,"v8/chat/conversation",{method:"POST",data:{conversation_id:t.id,messages:t.messages,tools:(n=t.tools)==null?void 0:n.map(r=>({type:"function",function:{name:r.name,description:r.description,parameters:r.parameters}})),stream:!!s},onStream:s})},getConversationTitle:(e,t)=>this.fetch(e,`v8/chat/conversations/${t}/generate-title`,{method:"POST",data:{}}),getLlmModels:e=>this.fetch(e,"v8/models").then(t=>Array.isArray(t)?t.map(s=>{const n=s.name||s.id;return{name:n,abilities:n.includes("embed")||n.includes("bge")?["embedding"]:["chat"],...s}}):[]),getMemories:e=>this.fetch(e,"v8/memories",{admin:!0}),getMemory:(e,t)=>this.fetch(e,`v8/memories/${t}`,{admin:!0}),createMemory:(e,t)=>{const s=t,n=this.context.defaultEmbeddingModel;return n&&(s.embedding_model=n),this.fetch(e,"v8/memories",{method:"POST",data:t,admin:!0})},deleteMemory:(e,t)=>this.fetch(e,`v8/memories/${t}`,{method:"DELETE",statusResult:{200:!0,0:!1},admin:!0}),getMemoryContent:(e,t,s)=>this.fetch(e,`v8/memories/${t}/contents/${s}`,{admin:!0}),getMemoryContents:(e,t,s)=>{const n=[];return s&&(s.content_type!==void 0&&n.push(["type",s.content_type]),s.content_keywords!==void 0&&n.push(["keywords",s.content_keywords])),this.fetch(e,`v8/memories/${t}/contents`,{admin:!0,params:n})},deleteMemoryContent:(e,t,s)=>this.fetch(e,`v8/memories/${t}/contents/${s}`,{method:"DELETE",statusResult:{200:!0,0:!1},admin:!0}),saveMemoryContent:(e,t,s)=>this.fetch(e,`v8/memories/${t}/contents`,{method:"POST",data:s,admin:!0}),updateMemoryContent:(e,t,s)=>this.fetch(e,`v8/memories/${s.key}/contents/${t}`,{method:"PUT",data:s,admin:!0}),filterMemoryContents:(e,t,s)=>this.fetch(e,`v8/memories/${t}/contents-filter`,{method:"POST",data:s,admin:!0}),getMemoryContentChunks:(e,t,s)=>this.fetch(e,`v8/memories/${t}/contents/${s}/chunks`,{admin:!0}),searchMemoryChunks:(e,t,s)=>this.fetch(e,`v8/memories/${t}/embeddings-search-chunks`,{method:"POST",data:s,admin:!0}),searchMemoryContents:(e,t,s)=>this.fetch(e,`v8/memories/${t}/embeddings-search-contents`,{method:"POST",data:s,admin:!0}),extractFile:(e,t)=>this.fetch(e,"v8/files/extract",{method:"POST",data:gr({file:t}),admin:!0}),getTasks:()=>this.fetchFromZentao(["aitask","ajaxGetList"]),getTaskMessages:(e,t)=>this.fetchFromZentao(["aitask","ajaxGetMessages",`taskID=${t}`])}}static createFromZentao(e){const{appID:t,host:s}=e;return!t||!s?null:new pl({appID:t,host:s,agentID:e.agentID,port:e.port,token:async function(){const n=ut("zai","ajaxGetToken");return(await v.getJSON(n)).data},baseUrl:e.apiBaseUrl,assetBaseUrl:e.assetBaseUrl,plugins:e.plugins??"ALL",globalMemory:e.globalMemory,privs:e.privs,getAvatar:e.getAvatar,teammateMap:e.teammateMap})}}class wx extends pl{}const Id="ai-popup-root",ml=class $f extends be{constructor(){super(...arguments),this._closeTimer=0}close(){const e=this.$element.find(".ai-popup");e.find(".ai-popup-box").addClass("is-closing"),this._closeTimer=window.setTimeout(()=>{e.remove(),this.destroy()},500)}_getRenderProps(e){return{...super._getRenderProps(e),onClose:()=>{this.close()}}}destroy(){const e=this.$element;this._closeTimer&&window.clearTimeout(this._closeTimer),super.destroy(),e.hasClass(Id)&&e.remove()}static open(e,t){const s=v(t||"body"),n=e.id||e.chatID||"";let r=s.find(`.${Id}[z-id="${n}"]`);if(r.length){const a=$f.query(r);if(a)return a.render(e),a}else r=v(`<div class="${Id}" z-id="${n}"></div>`),s.append(r);return $f.ensure(r,{key:`ai-popup-${n}`,...e})}};ml.NAME="AIPopup",ml.Component=Yg,ml.MULTI_INSTANCE=!0;let ey=ml;const gl=class nb extends be{constructor(){super(...arguments),this._popups={},this._modeChangeTimer=0,this._handleModeChange=(e,t)=>{var s,n;(n=(s=this.options).onModeChange)==null||n.call(s,e,t),this.$element.attr("z-mode",e).attr("z-last-mode",t).addClass("is-mode-changing"),clearTimeout(this._modeChangeTimer),this._modeChangeTimer=window.setTimeout(()=>{this.$element.removeClass("is-mode-changing")},300)},this.acceptSuggestion=(e,t)=>{this.reactions.acceptSuggestion(e,t)}}get store(){return this._store}get reactions(){return this._store.reactions}get commandScope(){return this.options.commandScope||"ai"}get panel(){return this.$}afterInit(){let e=this.options.store;e instanceof ns||(e=new ns(e),this.options.store=e),this._store=e,this._store.reactions.setPanel(this),super.afterInit();const{commands:t,onCommand:s}=this.options;(t||s)&&$i(document.body,{commands:t,scope:this.commandScope,onCommand:this.executeCommand.bind(this)})}executeCommand(e,t=[]){const{onCommand:s,commands:n}=this.options;let r;typeof e=="string"&&(e={name:e});const{scope:o,name:a}=e,l=n?n[`${o}~${a}`]||n[a]:null;if(l)return l.call(this,e,t);if(!e.scope||e.scope===this.commandScope){const{name:c}=e;this.reactions.hasPluginMethod(c)?r=this.reactions.callPluginMethod(c,...t):r=ls(this,c,t)}return s&&(r=s.call(this,e,t)),r}_getRenderProps(e){const t=super._getRenderProps(e);return t.store=this._store,t.onAcceptSuggestion=this.acceptSuggestion,t.onModeChange=this._handleModeChange,delete t.commands,delete t.onCommand,t}destroy(){super.destroy(),Object.values(this._popups).forEach(e=>e.close()),this._popups={},clearTimeout(this._modeChangeTimer),xr(document.body,this.commandScope)}minimize(){var e;(e=this.$)==null||e.toggleMinimize(!0)}setMode(e){var t;(t=this.$)==null||t.setMode(e)}toggleEmbed(e){var t;(t=this.$)==null||t.toggleEmbed(e)}open(e,t){const s=this.$;if(s&&(s.mode!=="embed"&&s.toggleShow(!0),e))return s.open(e,t)}openPopup(e){e=e||{viewType:"chat"},typeof e=="string"&&(e==="chats"?e={viewType:"chats"}:e.startsWith("CHAT@")?e={viewType:"chat",chatID:e.substring(5)}:e={viewType:"chat",postMessage:e});const{id:t=e.chatID?`chat-${e.chatID}`:e.viewType==="chats"?"chats":`chat-${Xe()}`,onClose:s,...n}=e,r=ey.open({id:t,...n,store:this.store,onClose:()=>{delete this._popups[t],s==null||s()}},this.$element);return this._popups[t]=r,this.minimize(),r}closePopup(e){const t=this._popups[e];if(t)return t.close(),delete this._popups[e],!0}static get shared(){try{if(window.parent!==window&&window.parent.zui)return window.parent.zui.AIPanel.shared}catch{}return this._shared}static destroy(){this._shared&&(this._shared.destroy(),this._shared=void 0)}static minimize(){var e;(e=this.shared)==null||e.minimize()}static toggleEmbed(e){var t;(t=this.shared)==null||t.toggleEmbed(e)}static setMode(e){var t;(t=this.shared)==null||t.setMode(e)}static open(e,t){var s;return typeof e=="object"&&e.chatID&&(e.chat=e.chatID,delete e.chatID,console.warn("[ZUI] AIPanel: chatID is deprecated, use chat instead")),(s=this.shared)==null?void 0:s.open(e,t)}static openPopup(e){var t;return(t=this.shared)==null?void 0:t.openPopup(e)}static init(e,t){if(!this._shared){try{if(window.parent!==window&&window.parent.zui)return this._shared=window.parent.zui.AIPanel.init(e,t),this._shared}catch{}const s=v(t||"body");let n=s.find(".ai-panel-root");if(n.length){const r=nb.query(n);if(r)return this._shared=r,r}else n=v('<div class="ai-panel-root" style="position: fixed; left: 0; top: 0; right: 0; bottom: 0; pointer-events: none; z-index: 1110"></div>'),s.append(n);this._shared=new this(n,e)}return this._shared}};gl.NAME="AIPanel",gl.Component=Zg,gl.DEFAULT={commands:{}};let Qn=gl;Qn.register(),v(()=>{document.addEventListener("selectionchange",hh(()=>{var n;const i=(n=Qn.shared)==null?void 0:n.reactions;if(!i)return;const e=window.getSelection(),t=(e==null?void 0:e.toString())??"",s=i.state.lastSelectedText;s!==t&&i.trigger("selectText",{selectedText:t},{selectedText:t,lastSelectedText:t||s})},200))});class yl extends be{_getRenderProps(e){var o;const{store:t="shared",...s}=super._getRenderProps(e),n=Qn.shared,r=t==="shared"?(o=Qn.shared)==null?void 0:o.store:t;if(!r)throw new Error("store is required");return{embed:!0,store:r,...t==="shared"?{getErrorContent:n==null?void 0:n.options.getErrorContent}:{},...s}}}yl.NAME="AIChatView",yl.Component=Td,yl.register();class vl extends be{_getRenderProps(e){var r;const{store:t="shared",...s}=super._getRenderProps(e);return{store:t==="shared"?(r=Qn.shared)==null?void 0:r.store:t,...s}}}vl.NAME="AIModelPicker",vl.Component=Jg,vl.register();class _l extends be{init(){this.options.model===void 0&&(this.options.model=this.$element.text().trim(),this.$element.empty())}_getRenderProps(e){var r;const{store:t="shared",...s}=super._getRenderProps(e);return{store:t==="shared"?(r=Qn.shared)==null?void 0:r.store:t,...s}}}_l.NAME="AIModelName",_l.Component=Xg,_l.register();class bl extends be{}bl.NAME="ZentaoAgentResult",bl.Component=Sd,bl.register();const Ki=class extends Dt{_getFileIcon(e,t){if(!t)return null;const s=typeof t;return s==="string"?t:(t=t||this.props.fileIcon,s==="function"?t.call(this,e):t[e.extension]||"file")}_getItems(e){const t=super._getItems(e),{fileIcon:s,fileSizeFormat:n,itemProps:r,heading:o,fileUrl:a,fileActions:l}=e,c=t.map(h=>{let d=null;return typeof h.size=="number"&&(d=pt(h.size),n&&(d=$e(n,{size:d}))),{key:`${h.id}`,icon:this.constructor.getFileIcon(h,s),iconClass:"text-gray",title:h.title,subtitle:d,multiline:!1,url:typeof a=="function"?a.call(this,h):a?$e(a,h):void 0,actions:l?l.call(this,h):void 0,...r}});return o&&c.unshift({key:"heading",titleClass:"font-bold",type:"heading",...o}),c}_getRenderedItem(e,t){return t}static getFileIcon(e,t){if(!t)return null;const s=typeof t;return s==="string"?t:s==="function"?t.call(this,e):t[e.extension]||"file"}static getDefaultIconMap(){return[["file-image",["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]],["file-audio",["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac"]],["file-video",["mp4","avi","mkv","mov","flv","wmv","webm"]],["file-archive",["zip","rar","7z","tar","gz","bz2","xz"]],["file-code",["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown"]],["file-pdf",["pdf"]],["file-log",["log"]],["markdown",["md"]],["file-word",["doc","docx"]],["file-excel",["xls","xlsx"]],["file-powerpoint",["ppt","pptx"]],["file-text",["txt","csv"]]].reduce((t,[s,n])=>(n.forEach(r=>{t[r]=s}),t),{})}};Ki.NAME="file-list",Ki.defaultProps={...Dt.defaultProps,fileSizeFormat:"({size})",fileIcon:Ki.getDefaultIconMap()},Ki.TAG="div",Ki.defaultItemProps={component:"div"};let ei=Ki,wl=class extends be{};wl.NAME="FileList",wl.Component=ei;const _D="",Jr=`
`,Cn=Jr+Jr,vs={zh_cn:{translate:"翻译",checkCode:"代码检查",phpExpert:"PHP专家",calculator:"计算器",explain:"解释",explainMessage:`请解释如下内容：${Cn}{text}${Jr}`,translateHint:"翻译选中的内容",summarize:"总结",summarizeHint:"总结选中的内容",selectedText:"选中内容",currentPage:"当前页面",clipboardContent:"剪贴板",globalMemory:"全局知识库",generateTitle:"生成标题",file:"文件"},zh_tw:{translate:"翻譯",checkCode:"代碼檢查",phpExpert:"PHP專家",calculator:"計算器",explain:"解釋",explainMessage:`請解釋如下內容：${Cn}{text}${Jr}`,translateHint:"翻譯選中的內容",summarize:"總結",summarizeHint:"總結選中的內容",selectedText:"選中內容",currentPage:"當前頁面",clipboardContent:"剪貼板",globalMemory:"全局知識庫",generateTitle:"生成標題",file:"文件"},en:{translate:"Translate",checkCode:"Check Code",calculator:"Calculator",phpExpert:"PHP Expert",explain:"Explain",explainMessage:`Please explain the following content:${Cn}{text}${Jr}`,translateHint:"Translate the selected content",summarize:"Summarize",summarizeHint:"Summarize the selected content",selectedText:"Selected Text",currentPage:"Current Page",clipboardContent:"Clipboard",globalMemory:"Global Memory",generateTitle:"Generate Title",file:"File"}},_t=_d.define("common",{name:"{{common}}",icon:"magic",i18n:vs});_t.defineAgent("translate",{name:"{{translate}}",alias:[vs.en.translate,vs.zh_cn.translate],icon:"lang",prompt:'你是一个中英文翻译专家，将用户输入的中文翻译成英文，或将用户输入的英文翻译成中文。对于非中文内容，它将提供中文翻译结果。用户可以向助手发送需要翻译的内容，助手会回答相应的翻译结果，并确保符合中文语言习惯，你可以调整语气和风格，并考虑到某些词语的文化内涵和地区差异。同时作为翻译家，需将原文翻译成具有信达雅标准的译文。"信" 即忠实于原文的内容与意图；"达" 意味着译文应通顺易懂，表达清晰；"雅" 则追求译文的文化审美和语言的优美。目标是创作出既忠于原作精神，又符合目标语言文化和读者审美的翻译。直接返回译文，不要添加任何解释或说明。'}),_t.defineAgent("checkCode",{name:"{{checkCode}}",icon:"code",prompt:"I would like you to serve as a code interpreter, elucidate the syntax and the semantics of the code line-by-line. The entire conversation and instructions should be provided in Chinese."}),_t.defineAgent("phpExpert",{name:"{{phpExpert}}",icon:"php",prompt:["你是一个PHP专家，用户可能向你咨询PHP相关问题，请帮忙解答。","用户可能有如下类型的问题：","1. PHP 错误修复：用户可能给出错误信息，请帮忙分析原因，并给出修复建议、","2. 用户可能给出 PHP 代码，请帮忙分析代码中可能存在的问题","3. 用户可能给出前端 JS/HTML 代码，请帮忙分析代码中可能存在的问题，如果无法判断，请引导用户修改代码或操作浏览器获取更多的相关信息"].join(Cn)}),_t.defineAgent("summarize",{name:"{{summarize}}",alias:[vs.en.summarize,vs.zh_cn.summarize],icon:"summary",prompt:"Summarize the following text into 100 words, making it easy to read and comprehend. The summary should be concise, clear, and capture the main points of the text. Avoid using complex sentence structures or technical jargon. The entire conversation and instructions should be provided in Chinese. "}),_t.defineAgent("generateTitle",{name:"{{generateTitle}}",icon:"title",prompt:"Generate a title for the given text. The title should be concise, clear, and capture the main points of the text. Avoid using complex sentence structures or technical jargon. Only return the title in user original language, no other explanation or text, the title should not contain any markdown syntax and line breaks, limit in 10 words."}),_t.defineAgent("ai",{name:"AI",icon:"ai",prompt:"You are a helpful assistant. You can help me with my questions and tasks.",tools:[{name:"getConversations",displayName:"获取会话列表",description:"获取我的对话列表，每个列表项包括对话名称和时间戳，支持提供关键字进行搜索，如果提供关键字，则返回包含关键字的会话列表，多个关键字使用空格分隔",parameters:{type:"object",properties:{keyword:{type:"string",description:"The keyword to search for."}}},fn:function(i){const{keyword:e}=i;let t=this.chats;const s=e==null?void 0:e.trim().split(" ").filter(Boolean);s!=null&&s.length&&(t=t.filter(r=>s.every(o=>r.title.includes(o))));const n=t.map(r=>({id:r.id,title:r.title,timestamp:r.created_at}));return{result:n,info:{markdown:n.map(r=>`- ${r.title} (${rt(r.timestamp,"yyyy-MM-dd hh:mm")})`).join(`
`)}}}}]}),_t.defineAgent("zui",{name:"zui",icon:"zui",prompt:"You are a helpful assistant. You can help me with my questions and tasks.",tools:[{name:"dtable",displayName:"数据表格",description:"绘制一个数据表格，需要提供表格列名定义和每行的数据。",parameters:{type:"object",properties:{columns:{type:"array",description:"The columns of the table.",items:{type:"object",properties:{name:{type:"string",description:"The name of the column, also is the key of the row data."},title:{type:"string",description:"The title of the column."}}}},data:{type:"array",description:"The data rows of the table.",items:{type:"object",properties:{}}}}},fn:i=>{const{columns:e,data:t}=i;return{view:{style:{width:500},component:"DTable",props:{cols:e,data:t}}}}},{name:"formBuilder",displayName:"表单生成器",description:"生成一个表单，需要提供表单的 JSONSchema配置和数据。",parameters:{type:"object",properties:{schema:{type:"object",description:"The JSONSchema of the form.",properties:{}},data:{type:"object",description:"The data of the form.",properties:{}}}},fn:i=>{const{schema:e,data:t}=i;return{view:{component:"FormBuilder",props:{schema:e,data:t}}}}}]}),_t.defineAgent("calculator",{name:"{{calculator}}",alias:[vs.en.calculator,vs.zh_cn.calculator],icon:"calculator",prompt:"You are a calculator. You can help me calculate the result of the expression. Only return the result, no other explanation or text.",tools:[{name:"calc",displayName:vs.zh_cn.calculator,description:"Calculate the result of the expression, only supports directly executable JS expressions.",parameters:{type:"object",properties:{expression:{type:"string",description:"The expression to calculate."}},required:["expression"]},when:()=>!window.config||window.config.debug,fn:i=>{const{expression:e}=i,t=[...["window","document","navigator","location","history","sessionStorage","localStorage","alert","eval","prompt"].map(r=>`const ${r}={};`),`return (${e});`].join(`
`),s=v.runJS(t),n=e.replaceAll("Math.","");return{value:s,message:JSON.stringify({expression:e,result:s}),view:{markdown:["```js",`${n} = ${s}`,"```"].join(`
`)},actions:[{text:"复制表达式",onClick:()=>navigator.clipboard.writeText(String(n))},{text:"复制结果",onClick:()=>navigator.clipboard.writeText(String(s))}]}}}]}),_t.defineMethod("translate",({state:i,panel:e},t)=>e==null?void 0:e.openPopup({viewType:"chat",postMessage:{content:t??i.selectedText,chat:{agent:"translate"}},viewProps:{mode:"lite"}})),_t.defineMethod("summarize",({state:i,panel:e},t)=>e==null?void 0:e.openPopup({viewType:"chat",postMessage:{content:t??i.selectedText,chat:{agent:"summarize"}},viewProps:{mode:"lite"}})),_t.defineMethod("addFileToChat",async i=>{const e=i.state.selectedChatID;if(!e)return;const t=await ch({accept:".pdf,.docx,.doc,.xlsx,.xls,.csv,.ppt,.pptx,.html,.htm,.json,.yaml,.yml,.txt,.md",multiple:!1});t&&i.store.reactions.addChatContext(e,{code:`file:${t.name}:${t.size}:${t.lastModified}`,title:t.name,icon:wl.Component.getFileIcon({title:t.name,extension:t.name.split(".").pop()||""},"file-text"),plugin:"common",data:async()=>{const s=await i.store.extractFile(t);return{prompt:`文件《${t.name}》内容：
${Cn}${s.content}`}}})}),_t.defineSuggestion({title:"{{translate}}",hint:"{{translateHint}}",icon:"lang",priority:-1,command:".translate",when:({state:i})=>!!i.selectedText.length}),_t.defineSuggestion({title:"{{summarize}}",hint:"{{summarizeHint}}",icon:"summary",priority:-1,command:".summarize",when:({state:i})=>!!i.selectedText.length}),_t.defineContextProvider({code:"selectedText",title:"{{selectedText}}",icon:"rich-text",when:({state:i})=>!!i.lastSelectedText.length,data:({state:i})=>({prompt:`选中的文本：${Cn}${i.lastSelectedText}`}),generate:({userPrompt:i,plugin:e})=>{if(i!=null&&i.length&&new RegExp(`@(${(e==null?void 0:e.getLang("selectedText"))??vs.zh_cn.selectedText})`,"i").test(i))return{}}}),_t.defineContextProvider({code:"currentPage",title:"{{currentPage}}",icon:"globe",recommend:!0,when:()=>!0,data:()=>({prompt:[`当前页面标题：${document.title}`,"当前页面内容：",document.body.textContent].join(Cn)}),generate:({userPrompt:i,plugin:e})=>{if(i!=null&&i.length&&new RegExp(`@(${(e==null?void 0:e.getLang("currentPage"))??vs.zh_cn.currentPage})`,"i").test(i))return{}}}),_t.defineContextProvider({code:"clipboardContent",title:"{{clipboardContent}}",icon:"copy",recommend:!1,when:()=>!!navigator.clipboard,data:async()=>{const i=await navigator.clipboard.readText();return{prompt:`剪贴板内容：${Cn}${i}`}},generate:({userPrompt:i,plugin:e})=>{if(i!=null&&i.length&&new RegExp(`@(${(e==null?void 0:e.getLang("clipboardContent"))??vs.zh_cn.clipboardContent})`,"i").test(i))return{}}}),_t.defineContextProvider({code:"globalMemory",title:"{{globalMemory}}",icon:"book",when:i=>!!i.store.globalMemory,data:{memory:{collections:["$global"]}}}),_t.defineContextProvider({code:"file",title:"{{file}}",icon:"upload-file",command:".addFileToChat"});const bD="",wD="",CD="",xD="",kD="",SD="",TD="",$D="",DD="",ID="",Cl=Symbol("batch-form"),Md=class Df extends Ze{constructor(){super(...arguments),this._actions=null,this._cols=[],this._idSeed=0,this._rows=[]}afterInit(){var n;const e=v(this.element),t=e.find(".form-batch-table").addClass("borderless");let s=t.find("tbody");s.length||(s=v("<tbody/>").appendTo(t)),this.$tbody=s,this._template=(n=e.find(".form-batch-template").get(0))==null?void 0:n.innerHTML,this._cols=[],t.find("thead>tr>.form-batch-head").each((r,o)=>{const a=v(o),l=a.data();l&&(l.hidden=a.hasClass("hidden"),this._cols.push(l)),a.data("name")==="ACTIONS"&&a.addClass("form-batch-col-actions")}),this.options.fixedActions&&(e.addClass("has-fixed-actions"),this._sticky=new Qo(e,{side:"right",offset:0,scrollContainer:".form-batch-container",targets:'td[data-name="ACTIONS"],th[data-name="ACTIONS"]'})),e.on("click",r=>{var h;const o=v(r.target).closest(".form-batch-btn");if(!o.length)return;const a=o.dataset("type"),l=o.closest("tr"),c=l.dataset("index");((h=this.options.onClickAction)==null?void 0:h.call(this,a,l,c))!==!1&&(a==="add"?this.addRow(c):a==="delete"?this.deleteRow(c):a==="ditto"&&this.toggleDitto(o))}).on("change",".form-batch-input,.pick-value",r=>{const o=v(r.target);r.___td===Cl||o.hasClass("pick-value")&&!r.___td||this.syncDitto(o)}).on("change",'[type="radio"],[type="checkbox"]',r=>{Df.updateCheckValues(v(r.target))}),this.options.sortable&&(this._sortable=new Ca(s,{draggable:"tr",handle:'.form-batch-btn[data-type="sort"]',dataIdAttr:"data-gid",ghostClass:"bg-primary-50",filter:".disabled",onSort:()=>{this._rows=this._sortable.toArray().map(Number),this.render()},dragShadow:!1,...typeof this.options.sortable=="object"?this.options.sortable:{}})),this.render()}destroy(){var e;v(this.element).off("click change"),this.$tbody=void 0,this._template=void 0,this._cols.length=0,this._rows.length=0,(e=this._sticky)==null||e.destroy()}render(e,t){super.render(e,t),!t&&this._rows.length?this._renderRows():(this._actions=null,this._initRows())}addRow(e,t){return t=t??this._idSeed++,typeof e=="number"&&e>=0&&e<=this._rows.length?this._rows.splice(e+1,0,t):(e=this._rows.length,this._rows.push(t)),this._renderRows(void 0,e),t}deleteRow(e){var s;if(this._rows.length<=1||typeof e!="number"||e<0||e>=this._rows.length)return!1;const t=this._rows[e];this._rows.splice(e,1),(s=this.$tbody)==null||s.children(`[data-gid="${t}"]`).remove(),this._renderRows(void 0,e)}deleteRowByGid(e){return this.deleteRow(this._rows.indexOf(e))}toggleDitto(e,t){const s=e.closest("td");t=t??s.attr("data-ditto")!=="on",s.attr("data-ditto",t?"on":"off"),t&&s.closest("tr").prev("tr").find(`td[data-name="${s.data("name")}"]`).find(".form-batch-input,.pick-value").each((o,a)=>{this.syncDitto(v(a),!1)})}syncDitto(e,t=!0,s=!1){const n=e.closest("td");t&&n.attr("data-ditto","off");const r=n.data("name"),a=(e.hasClass("pick-value")?e.closest(".form-group-wrapper"):e).attr("data-name"),l=`td[data-name="${r}"][data-ditto="on"]`,c=e.val();let h=e.closest("tr").next("tr"),d=h.find(l);for(;d.length;){const f=d.find(`.form-batch-input[data-name="${a}"]`);if(f.length&&f.val()!==c)f.val(c).trigger("change",Cl);else{const m=d.find(".pick").parent().zui();m&&m.$&&m.$element.attr("data-name")===a&&m.$.value!==c&&m.$.setValue(c,!0).then(()=>{m.$element.find(".pick-value").trigger("change",Cl)})}if(s)break;h=h.next("tr"),d=h.find(l)}}toggleCols(e,t){const s=this.$element.find(".form-batch-table").find("th.form-batch-head,td.form-batch-control");s.length&&(typeof e=="string"&&(e=[e]),e.forEach(n=>{const r=this._cols.find(o=>o.name===n);r&&(r.hidden=!t,s.filter(`[data-name="${n}"]`).toggleClass("hidden",!t),t&&requestAnimationFrame(()=>{s.filter(".form-batch-ditto-control").each((o,a)=>{const l=v(a),c=l.find(".form-batch-ditto-btn");l.css("--form-batch-ditto-width",`${c.outerWidth()}px`)})}))}))}_initRows(){const e=this.$tbody;if(!this._template||!(e!=null&&e.length))return;const{data:t=[],minRows:s,maxRows:n,mode:r,rowsCount:o=r==="add"?Math.min(Math.max(1,n??100),Math.max(1,s??(r==="add"?10:1),t.length)):t.length}=this.options;this._rows=Array(o).fill(0).map((a,l)=>l),this._idSeed=this._rows.length,this._renderRows(t)}_renderRows(e=[],t=0){var n;const s=this._rows.length;for(let r=t;r<s;r++)this._renderRow(r,e[r]);(n=this.$tbody)==null||n.attr("data-count",`${s}`)}_renderActions(e){var s;let t=this._actions;if(!t){const{addRowIcon:n="icon-plus",deleteRowIcon:r="icon-trash",sortRowIcon:o="icon-move",sortable:a}=this.options;t=new DocumentFragment;const l='<button type="button" data-type="{type}" class="form-batch-btn btn square ghost size-sm" title="{text}"><i class="icon {icon}"></i></button>';let{actions:c}=this.options;c===void 0&&(c=[],o!==!1&&a&&c.push("sort"),n!==!1&&c.push("add"),r!==!1&&c.push("delete"));const h={sort:{type:"sort",icon:o||"",text:this.i18n("sort"),className:"cursor-move"},add:{type:"add",icon:n||"",text:this.i18n("add")},delete:{type:"delete",icon:r||"",text:this.i18n("delete")}};c.forEach(d=>{typeof d=="string"&&(d={type:d});const f=v.extend({},h[d.type],d),m=v($e(l,f));f.className&&m.addClass(f.className),t.append(m[0])}),(s=this.options.onRenderActions)==null||s.call(this,t),this._actions=t,this.$element.find('.form-batch-head[data-name="ACTIONS"]').attr("data-action-count",t.children.length+"")}e.empty().append(t.cloneNode(!0))}_renderRow(e,t){const s=this.$tbody,n=String(this._rows[e]),{idKey:r="id",mode:o,onRenderRowCol:a,onRenderRow:l}=this.options,c=o==="add",h=String(t&&t[r]!==void 0?t[r]:e+1);let d=s.children(`[data-gid="${n}"]`),f=!1;if(d.length){if(!t&&d.dataset("index")===e)return}else{f=!0;let w=this._template;if((w.includes(" zui-create ")||w.includes(" zui-create="))&&(w=w.replace(/(id|for)="([\\$a-z_]+)"/g,`$1="$2_${n}"`)),w.includes("<script>")&&w.includes('zui.create("')){const x=[];w=w.replace(/(zui\.create\("[a-zA-Z]+","#)(\w+)(",)/g,(D,I,E,P)=>(x.push(E),`${I}${E}_${n}${P}`)),x.forEach(D=>{const I=`${D}_${n}`;w=w.replace(`id="${D}"`,`id="${I}"`)})}w=w.replaceAll("{GID}",n),d=v(w.trim()).attr("data-gid",n).addClass("form-batch-row"),d.find('[type="radio"],[type="checkbox"]').each((x,D)=>{const I=v(D),E=I.attr("id"),P=`${E}_${n}`;I.attr("id",P),d.find(`label[for="${E}"]`).attr("for",P)}),d.zuiInit({onCreate:(x,D)=>(typeof D.name=="string"&&(D.name=`${D.name}[${h}]`,D._initFromBatchForm=!0),D)})}const m=this._rows[e-1],y=s.children(`[data-gid="${m}"]`);d.attr("data-index",`${e}`),d.find("textarea").autoHeight(),d.on("inited",(w,[x])=>{let D=x.options.name;if(D){const I=D.split("[");I.length>1&&I.pop(),D=I.join("[");const E=x.$element.closest("td");if(x.$element.attr("data-name",D),x.options._initFromBatchForm&&x.$ instanceof at&&x.render({name:`${D}[${h}]`}),y.length&&E.data("ditto")==="on"){const P=y.find(`td[data-name="${E.data("name")}"]`);this.syncDitto(P.find(`[data-name="${D}"] .pick-value`),!1,!0)}else t&&t[D]!==void 0&&x.$.setValue(t[D],!0)}}),t&&d.data("data",t),e?y.length?y.after(d):d.appendTo(s):d.prependTo(s),f&&d.find("script").remove();const b=t||d.data("data");this._cols.forEach(w=>{let x=d.find(`td[data-name="${w.name}"]`);if(x.length||(x=v(`<td data-name="${w.name}"></td>`).appendTo(d)),w.index){x.find(".form-control-static").text(h).attr("id",`${w.name}_${n}`),a==null||a.call(this,x,w,b,e);return}if(x.toggleClass("hidden",!!w.hidden),!x.data("init")||t){if(w.name==="ACTIONS"){if(x.addClass("form-batch-col-actions"),!c)return;this._renderActions(x);return}x.data("init",1).find("[name],.form-control-static").each((I,E)=>{const P=v(E);if(P.hasClass("form-control-static")){const O=P.attr("data-name");t&&P.text(String(t[O]??""))}else if(P.hasClass("pick-value")){if(t){const O=Vi.globalControls.picker(P,this.$element);if(O){const W=O.$element.attr("data-name")??O.instance.options.name??P.attr("data-name")??P.attr("name"),J=typeof W=="string"?t[W]:void 0;J!==void 0&&J!==O.getVal()&&O.instance.$.setValue(J,!0).then(()=>{O.$element.find(".pick-value").trigger("change",Cl)})}}}else{const O=P.attr("data-name")??P.attr("name"),W=`${O}[${h}]`;if(P.attr({name:W,"data-name":O}).addClass("form-batch-input"),t&&t[O]!==void 0){const J=String(t[O]??"");if(P.is('[type="radio"]'))P.prop("checked",J===P.val());else if(P.is('[type="checkbox"]')){const Y=new Set(J.split(","));P.prop("checked",Y.has(P.val()))}else P.val(J)}}}),x.find('[type="radio"],[type="checkbox"]').each((I,E)=>{const P=v(E);typeof P.attr("data-name")!="string"||P.attr("data-val")!==void 0||Df.updateCheckValues(P,x,h)})}else x.find("[name]").each((I,E)=>{const P=v(E),O=P.attr("data-name");if((P.attr("name")??"").startsWith(`${O}[`)){if(P.attr("name",`${O}[${h}]`),P.is('[type="radio"]'))P.prop("checked",P.val()===P.attr("data-val"));else if(P.is('[type="checkbox"]')){const W=new Set(P.attr("data-val").split(","));W.size>1&&P.attr("name",`${O}[${h}][]`),P.prop("checked",W.has(P.val()))}}}),x.find(".pick").each((I,E)=>{const P=v(E).parent(),O=P.zui();O&&O.render({name:`${P.data("name")}[${h}]`})});if(w.ditto){x.addClass("form-batch-ditto");let I=x.find(".form-batch-ditto-btn");if(e){const{defaultDitto:E="on"}=w;if(x.attr("data-ditto",E),!I.length){I=v(`<button type="button" class="btn ghost form-batch-btn form-batch-ditto-btn" data-type="ditto">${this.i18n("ditto")}</button>`);let P=x.children(".form-batch-ditto-wrapper");P.length||(P=v('<div class="form-batch-ditto-wrapper"></div>').append(x.children()).appendTo(x)),P.append(I)}requestAnimationFrame(()=>x.css("--form-batch-ditto-width",`${I.outerWidth()}px`)),E==="on"&&y.find(`td[data-name="${w.name}"]`).find(".form-batch-input").each((O,W)=>{this.syncDitto(v(W),!1,!0)})}else x.attr("data-ditto",""),I.remove()}const D=!!(w.ditto&&e);x.toggleClass("form-batch-ditto-control",D),x.find(".form-batch-ditto-btn").toggle(D),a==null||a.call(this,x,w,b,e)}),l==null||l.call(this,d,e,b)}static updateCheckValues(e,t,s){const n=e.attr("data-name");if(typeof n!="string")return;const r=e.attr("type");t=t||e.closest("td");const o=t.find(`[type="${r}"][data-name="${n}"]`);s!==void 0&&r==="checkbox"&&o.length>1&&o.attr("name",`${n}[${s}][]`);const a=[];o.filter(":checked").each((c,h)=>{a.push(v(h).val())});const l=r==="radio"?a[0]:a.join(",");o.attr("data-val",l)}};Md.NAME="BatchForm",Md.DEFAULT={mode:"add",idKey:"id",i18n:{zh_cn:{ditto:"同上",delete:"删除",add:"添加",sort:"排序"},zh_tw:{ditto:"同上",delete:"刪除",add:"添加",sort:"排序"},en:{ditto:"Ditto",delete:"Delete",add:"Add",sort:"Sort"}}};let ty=Md;const MD="";function Cx(i){return typeof i=="string"?i.split(",").map(e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t}):i}let Nd=class extends ae{constructor(){super(...arguments),this._canvas=ye(),this._timer=0,this._needDraw=!1}componentDidMount(){var t;this.tryDraw=this.tryDraw.bind(this),this.tryDraw();const e=(t=this._canvas.current)==null?void 0:t.parentElement;if(this.props.responsive!==!1){if(e&&typeof ResizeObserver<"u"){const s=new ResizeObserver(this.tryDraw);s.observe(e),this._rob=s}this._rob||window.addEventListener("resize",this.tryDraw)}if(e&&typeof IntersectionObserver<"u"){const s=new IntersectionObserver(n=>{this._needDraw&&n.some(r=>r.isIntersecting)&&this.tryDraw()});s.observe(e),this._iob=s}}componentDidUpdate(){this.tryDraw()}componentWillUnmount(){var e;(e=this._rob)==null||e.disconnect(),window.removeEventListener("resize",this.tryDraw)}tryDraw(){this._timer&&cancelAnimationFrame(this._timer),this._timer=requestAnimationFrame(()=>{this.draw(),this._timer=0})}draw(){const e=this._canvas.current;if(!e)return;const t=e.parentElement,{width:s,height:n,responsive:r=!0}=this.props;let o=s||t.clientWidth,a=n||t.clientHeight;if(s&&n&&r&&(o=t.clientWidth,a=Math.floor(n*o/s)),e.style.width=`${o}px`,e.style.height=`${a}px`,o=o*(window.devicePixelRatio||1),a=a*(window.devicePixelRatio||1),e.width=o,e.height=a,!v(t).isVisible()&&this._iob){this._needDraw=!0;return}const{lineSize:l=1,scaleLine:c=!1,scaleLineSize:h,scaleLineGap:d=1,scaleLineDash:f,referenceLine:m,referenceLineSize:y,referenceLineDash:b,color:w="#2c78f1",fillColor:x=["rgba(46, 127, 255, 0.3)","rgba(46, 127, 255, 0.05)"],lineDash:D=[],bezier:I}=this.props,E=Cx(this.props.data);if(!E.length)return;const P=Math.floor(o/(E.length-1)),O=Math.max(...E.filter(ve=>ve!==null)),W=E.map((ve,ee)=>{const ne=typeof ve!="number";return{x:ee*P,y:ne?a:Math.round((1-ve/O)*(a-l)),empty:ne}});let J=W[0];const Y=e.getContext("2d");if(c){const ve=typeof c=="string"?c:"rgba(100,100,100,.1)";Y.strokeStyle=ve,Y.lineWidth=h||l,f&&Y.setLineDash(f);for(let ee=0;ee<W.length;++ee){if(ee%d!==0)continue;const ne=W[ee];Y.moveTo(ne.x,0),Y.lineTo(ne.x,a)}Y.stroke()}if(m&&W.length>1){const ve=typeof m=="string"?m:"rgba(100,100,100,.2)",ee=W[W.length-1];Y.moveTo(ee.x,a),Y.strokeStyle=ve,Y.lineWidth=y||l,Y.lineTo(J.x,J.y),b&&Y.setLineDash(b),Y.stroke()}for(Y.setLineDash(D);W.length&&W[W.length-1].empty;)W.pop();if(x){const ve=W[W.length-1];if(Y.beginPath(),Y.moveTo(0,a),Y.lineTo(J.x,J.y),I){const ee=Math.round(P/2);for(let ne=1;ne<W.length;++ne){const Ce=W[ne],Me=Math.round((Ce.y-J.y)/5);Y.bezierCurveTo(J.x+ee,J.y+Me,Ce.x-ee,Ce.y-Me,Ce.x,Ce.y),J=Ce}}else for(let ee=1;ee<W.length;++ee)J=W[ee],Y.lineTo(J.x,J.y);if(Y.lineTo(ve.x,a),Array.isArray(x)){const ee=Y.createLinearGradient(0,0,0,a);for(let ne=0;ne<x.length;++ne)ee.addColorStop(ne/(x.length-1),x[ne]);Y.fillStyle=ee}else Y.fillStyle=x;Y.fill()}if(J=W[0],Y.beginPath(),Y.moveTo(J.x,J.y),I){const ve=Math.round(P/2);for(let ee=1;ee<W.length;++ee){const ne=W[ee],Ce=Math.round((ne.y-J.y)/5);Y.bezierCurveTo(J.x+ve,J.y+Ce,ne.x-ve,ne.y-Ce,ne.x,ne.y),J=ne}}else for(let ve=1;ve<W.length;++ve)J=W[ve],Y.lineTo(J.x,J.y);Y.strokeStyle=w,Y.lineWidth=l,Y.stroke()}render(){const{style:e,className:t,canvasClass:s}=this.props;return g("div",{class:"center burn-chart",className:t,style:e},g("canvas",{className:s,ref:this._canvas}))}};Nd.defaultProps={responsive:!0,lineSize:1,scaleLine:!1,scaleLineSize:1,bezier:!0};class Ed extends be{}Ed.NAME="Burn",Ed.Component=Nd;class sy extends Ke{_getClassName(e){return["datalist",e.className]}_getProps(e){return Le(super._getProps(e),e.labelWidth?{style:{"--datalist-label-width":je(e.labelWidth)}}:null)}_getChildren(){const{items:e=[]}=this.props;return e.map((t,s)=>{const{key:n=s,className:r,label:o,labelStyle:a,labelClass:l,labelAttrs:c,content:h,contentStyle:d,contentClass:f,contentAttrs:m,...y}=t;return g("div",{key:n,className:K("datalist-item",r),...y},g("div",{className:K("datalist-item-label",l),style:a,...c},g(fe,{content:o})),g("div",{className:K("datalist-item-content",f),style:d,...m},g(fe,{content:h})))})}}ot(Object.freeze(Object.defineProperty({__proto__:null,Datalist:sy},Symbol.toStringTag,{value:"Module"})));const ED="";let qi=class extends ae{render(e){const{avatar:t,account:s,realname:n,user:r,...o}=e,a={code:r?r.account:s,text:r?r.realname??r.account:n??s,src:r?r.avatar:t,...o};return g(Gs,{...a})}};qi.defaultProps={size:24,circle:!0};let Ad=class extends ca{constructor(){super(...arguments),this._categories=xe(()=>{const e=this.items,{categories:t=[],extraCategory:s}=this.props,n=new Map,r=t.reduce((l,c)=>(l.set(c.name,c),l),new Map),o=(l,c)=>typeof s=="string"?s===l||s===c:Array.isArray(s)?s.some(h=>h===l||h===c):!!s;let a=0;return e.forEach(l=>{let c=n.get(l.category);c||(c={id:l.id,name:l.category,items:[],order:n.size,required:l.required,...r.get(l.category)},r.delete(l.category)),c.id||(c.id=`new_${a++}`),c.extra=o(l.category,c.id),c.items.push(l),n.set(l.category,c)}),r.size&&r.forEach(l=>{n.set(l.name,{id:l.id,items:[],order:n.size,extra:o(l.name,l.id),...l})}),Array.from(n.values()).sort((l,c)=>l.order-c.order)}),this._handleConfirmRenameClick=e=>{const t=v(e.target).closest(".deliverable-item-rename").find(".form-control").val();this.renameItem(this.signals.renamingItem.value,t),this.cancelRenameItem()},this._handleSelectDoc=e=>{this.selectDoc(this.signals.renamingItem.value,e)}}get items(){return this.signals.items.value}get categories(){return this._categories.value}setFileToInput(e,t){const s=v(this.base).find(`.deliverable-item[z-gid="${e}"]`).find(".deliverable-file-value");if(s.length){const n=new DataTransfer;t&&n.items.add(t),s.prop("files",n.files)}}setFile(e,t){const s=this.items,n=typeof e=="number"?s.find(r=>r._gid===e):e;return n?(n.file=t?{name:t.name,size:t.size,type:t.type,extension:t.name.split(".").pop()||"",blob:t}:void 0,this.signals.items.value=[...s],this.setFileToInput(n._gid,t||null),!0):!1}selectFile(e){const{maxFileSize:t,acceptFileTypes:s,onExceededSize:n,exceededSizeTip:r}=this.props;ch({accept:s,multiple:!1}).then(o=>{const a=typeof t=="string"?ks(t):t;if(a&&o&&o.size>a){if(r){const l=typeof r=="string"?$e(r,{size:pt(a),name:o.name,maxFileSize:pt(a)}):r.message;Ve.alert(l)}n==null||n.call(this,a,o)}else this.setFile(e,o)})}selectDoc(e,t){const s=this.items,n=typeof e=="number"?s.find(r=>r._gid===e):e;return n?(n.doc=t,this.signals.items.value=[...s],this.setFileToInput(n._gid,null),!0):!1}getItem(e){return this.items.find(t=>t._gid===e)}deleteItem(e){const t=this.items,s=typeof e=="number"?t.find(n=>n._gid===e):e;return s?(s.file=void 0,s.doc=void 0,this.signals.items.value=[...t],this.setFileToInput(s._gid,null),!0):!1}removeItem(e){const t=this.items,s=typeof e=="number"?t.find(r=>r._gid===e):e;if(!s)return!1;const n=t.indexOf(s);return n===-1?!1:(t.splice(n,1),this.signals.items.value=[...t],this.setFileToInput(s._gid,null),!0)}startRenameItem(e){const t=typeof e=="number"?e:e._gid;this.signals.renamingItem.value=t,setTimeout(()=>{var n;const s=v(this.base).find(`.deliverable-item[z-gid="${t}"]`).find(".deliverable-item-rename input");s.length&&((n=s[0])==null||n.focus())},0)}addItems(e){const t=this.items;e.forEach(s=>{t.push(this._formatItem(s))}),this.signals.items.value=[...t]}addItem(e){return this.addItems([e])}cancelRenameItem(){this.signals.renamingItem.value=0}renameItem(e,t){const s=typeof e=="number"?e:e._gid,n=this.getItem(s);return n?(n.name=t,this.signals.items.value=[...this.items],!0):!1}getDefaultState(e){return{items:e.items.map(this._formatItem),renamingItem:0}}getItemName(e){var t,s;return typeof e.name=="string"&&e.name.length?e.name:((t=e.file)==null?void 0:t.name)??((s=e.doc)==null?void 0:s.title)??""}_formatItem(e){return{...e,_gid:Xe()}}_getClassName(e){return["deliverable-list",super._getClassName(e)]}_getFileIcon(e){return ei.getFileIcon(e,this.props.fileIcon)||"file"}_getItemActions(e,t){const{getFileActions:s,getDocActions:n}=this.props;return e.file&&s?s.call(this,e.file,e,t):e.doc&&n?n.call(this,e.doc,e,t):[]}_renderItem(e,t,s){var o,a,l,c,h;const n=[];if(this.signals.renamingItem.value===e._gid){const d=this.getItemName(e);n.push(g("div",{key:"file",className:"deliverable-item-rename"},g("input",{key:"name",className:"form-control",value:e.name,placeholder:d,defaultValue:d}),g(we,{icon:"check",type:"primary-pale",onClick:this._handleConfirmRenameClick}),g(we,{icon:"close",type:"gray-pale",onClick:()=>this.cancelRenameItem()})))}else if(e.file||e.doc){e.file?n.push(g("div",{key:"file",className:"deliverable-item-file"},g(Ie,{icon:this._getFileIcon(e.file),className:"text-gray"}),g("span",null,this.getItemName(e)),g("span",{className:"muted ml-1"},pt(e.file.size)))):e.doc&&n.push(g("div",{key:"doc",className:"deliverable-item-doc"},g(Ie,{icon:s.docIcon}),g("span",null,this.getItemName(e)),g("span",{className:"muted ml-1"},"#",e.doc.version)));const d=this._getItemActions(e,t).map(f=>(!f.onClick&&!f.url&&(f.key==="delete"?f.onClick=()=>this.deleteItem(e):f.key==="rename"&&(f.onClick=()=>this.startRenameItem(e))),f));n.push(g(Be,{key:"actions",className:"deliverable-item-actions",size:"sm",items:d})),e.createdBy&&n.push(g("div",{className:"deliverable-item-avatar",key:"avatar"},g(qi,{circle:!0,size:"xs",realname:e.createdBy}),g("span",{className:"deliverable-item-created-by"},e.createdBy))),s.getItemInfo&&n.push(g(fe,{key:"info",className:"deliverable-item-info",content:(o=s.getItemInfo)==null?void 0:o.call(this,e,t)}))}else{const d=s.docPicker||{},f=(a=s.getEmptyActions)==null?void 0:a.call(s,e,t).map(b=>(!b.onClick&&!b.url&&b.key==="selectFile"&&(b.onClick=()=>this.selectFile(e)),b.key==="selectTemplate"?{type:"dropdown",menu:{searchBox:!0,searchPlacement:"top",maxHeight:400,...typeof s.templateMenu=="function"?s.templateMenu.call(this,e,t):s.templateMenu},onClickItem:w=>{var x;(x=s.onSelectTemplate)==null||x.call(s,w.item.value,t.name)},...b}:b)),m=this,y=function(b){const w=this.state.selections[0];m.selectDoc(e,{id:b,title:w.text,version:w.docVersion})};n.push(g(Gt,{key:"docPicker",className:"deliverable-item-doc-picker",items:[],...d,onChange:y}),typeof f=="object"&&f.length>0&&[g(Be,{key:"actions",className:"deliverable-item-empty-actions",btnType:"default",items:f,gap:4})])}const{formName:r}=s;if(r){const d=t.id;n.push(g("div",{key:"form",className:"hidden"},g("input",{type:"hidden",name:`${r}[${d}][name][]`,value:e.name}),g("input",{type:"hidden",name:`${r}[${d}][doc][]`,value:((l=e.doc)==null?void 0:l.id)??""}),(c=e.doc)!=null&&c.version?g("input",{type:"hidden",name:`${r}[${d}][docVersion][]`,value:e.doc.version}):null,g("input",{type:"hidden",name:`${r}[${d}][fileID][]`,value:((h=e.file)==null?void 0:h.id)??""}),g("input",{type:"hidden",name:`${r}[${d}][itemID][]`,value:(e==null?void 0:e.itemID)??""}),g("input",{className:"hidden deliverable-file-value",type:"file",name:`${r}_${d}[]`})))}return e.category===this.props.extraCategory&&(e.file||e.doc)&&n.push(g("div",{className:"deliverable-item-extra-delete"},g(we,{text:Pe.getLang("delete"),type:"ghost text-primary",onClick:()=>this.removeItem(e)}))),g("div",{className:"deliverable-item form-group",key:e._gid,"z-gid":e._gid,"data-form-name":r?`${r}[${t.id}]`:void 0},g("div",{className:"deliverable-item-row"},n),g("div",{class:"form-tip"}))}_renderCategory(e,t){return g("div",{key:e.name,className:K("deliverable-category",e.required?"required":"")},t.isTemplate?null:g("div",{className:"deliverable-category-name"},g("span",{className:"text"},e.name)),g("div",{className:"deliverable-category-items"},e.items.map(s=>this._renderItem(s,e,t))))}_renderItems(e){return g("div",{key:"items",className:"deliverable-items",style:e.categoryWidth?{"--deliverable-category-width":je(e.categoryWidth)}:void 0},this.categories.map(t=>this._renderCategory(t,e)))}_renderHeader(e){return g(fe,{key:"header",content:e.header})}_renderFooter(e){return g(fe,{key:"footer",content:e.footer})}_getChildren(e){return[this._renderHeader(e),this._renderItems(e),this._renderFooter(e)]}componentDidMount(){this._autoAddExtra=Tt(()=>{const{categories:e}=this,t=[];e.forEach(s=>{(!s.maxCount||s.items.length<s.maxCount)&&s.extra&&!s.items.some(n=>!n.file&&!n.doc)&&t.push(s.name)}),t.length&&this.addItems(t.map(s=>({category:s})))})}componentWillUnmount(){var e;(e=this._autoAddExtra)==null||e.call(this)}};Ad.NAME="DeliverableList",Ad.defaultProps={fileIcon:ei.getDefaultIconMap(),docIcon:"doc",formName:"deliverable",isTemplate:!1,exceededSizeTip:Pe(mg,"exceededSizeTip")};class xl extends be{}xl.NAME="DeliverableList",xl.Component=Ad,xl.register();const AD="",PD="";class ny extends ae{constructor(t){super(t);Sf(this,$n,void 0);Sf(this,Dn,void 0);dr(this,$n,0),dr(this,Dn,null),this._handleWheel=s=>{const{wheelContainer:n}=this.props,r=s.target;if(!(!r||!n)&&(typeof n=="string"&&r.closest(n)||typeof n=="object")){const o=(this.props.type==="horz"?s.deltaX:s.deltaY)*(this.props.wheelSpeed??1);this.scrollOffset(o)&&s.preventDefault()}},this._handleMouseMove=s=>{const{dragStart:n}=this.state;n&&(hr(this,$n)&&cancelAnimationFrame(hr(this,$n)),dr(this,$n,requestAnimationFrame(()=>{const r=this.props.type==="horz"?s.clientX-n.x:s.clientY-n.y;this.scroll(n.offset+r*this.props.scrollSize/this.props.clientSize),dr(this,$n,0)})),s.preventDefault())},this._handleMouseUp=()=>{this.state.dragStart&&this.setState({dragStart:!1})},this._handleMouseDown=s=>{this.state.dragStart||this.setState({dragStart:{x:s.clientX,y:s.clientY,offset:this.scrollPos}}),s.preventDefault(),s.stopPropagation()},this._handleClick=s=>{const n=s.currentTarget;if(!n)return;const r=n.getBoundingClientRect(),{type:o,clientSize:a,scrollSize:l}=this.props,c=(o==="horz"?s.clientX-r.left:s.clientY-r.top)-this.barSize/2;this.scroll(c*l/a),s.preventDefault()},this.state={scrollPos:this.props.defaultScrollPos??0,dragStart:!1}}get scrollPos(){return this.props.scrollPos??this.state.scrollPos}get controlled(){return this.props.scrollPos!==void 0}get maxScrollPos(){const{scrollSize:t,clientSize:s}=this.props;return Math.max(0,t-s)}get barSize(){const{clientSize:t,scrollSize:s,size:n=12,minBarSize:r=3*n}=this.props;return Math.max(Math.round(t*t/s),r)}componentDidMount(){document.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp);const{wheelContainer:t}=this.props;t&&(dr(this,Dn,typeof t=="string"?document:t.current),hr(this,Dn).addEventListener("wheel",this._handleWheel,{passive:!1}))}componentWillUnmount(){document.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),hr(this,Dn)&&hr(this,Dn).removeEventListener("wheel",this._handleWheel)}scroll(t){return t=Math.max(0,Math.min(Math.round(t),this.maxScrollPos)),t===this.scrollPos?!1:(this.controlled?this._afterScroll(t):this.setState({scrollPos:t},this._afterScroll.bind(this,t)),!0)}scrollOffset(t){return this.scroll(this.scrollPos+t)}_afterScroll(t){const{onScroll:s}=this.props;s&&s(t,this.props.type??"vert")}render(){const{clientSize:t,type:s,size:n=12,className:r,style:o,left:a,top:l,bottom:c,right:h}=this.props,{maxScrollPos:d,scrollPos:f}=this,{dragStart:m}=this.state,y={left:a,top:l,bottom:c,right:h,...o},b={};return s==="horz"?(y.height=n,y.width=t,b.width=this.barSize,b.left=Math.round(Math.min(d,f)*(t-b.width)/d)):(y.width=n,y.height=t,b.height=this.barSize,b.top=Math.round(Math.min(d,f)*(t-b.height)/d)),k("div",{className:K("scrollbar",r,{"is-vert":s==="vert","is-horz":s==="horz","is-dragging":m}),style:y,onMouseDown:this._handleClick,children:k("div",{className:"scrollbar-bar",style:b,onMouseDown:this._handleMouseDown})})}}$n=new WeakMap,Dn=new WeakMap;const kl=new Map,Sl=[];function iy(i,e){const{name:t}=i;if(!(e!=null&&e.override)&&kl.has(t))throw new Error(`DTable: Plugin with name ${t} already exists`);kl.set(t,i),e!=null&&e.buildIn&&!Sl.includes(t)&&Sl.push(t)}function et(i,e){iy(i,e);const t=s=>{if(!s)return i;const{defaultOptions:n,...r}=i;return{...r,defaultOptions:{...n,...s}}};return t.plugin=i,t}function ry(i){return kl.delete(i)}function oy(i){if(typeof i=="string"){const e=kl.get(i);return e||console.warn(`DTable: Cannot found plugin "${i}"`),e}if(typeof i=="function"&&"plugin"in i)return i.plugin;if(typeof i=="object")return i;console.warn("DTable: Invalid plugin",i)}function ay(i,e,t){return e.forEach(s=>{var r;if(!s)return;const n=oy(s);n&&(t.has(n.name)||((r=n.plugins)!=null&&r.length&&ay(i,n.plugins,t),i.push(n),t.add(n.name)))}),i}function xx(i=[],e=!0){if(e&&Sl.length&&i.unshift(...Sl),!(i!=null&&i.length))return[];const t=ay([],i,new Set),s=[],n=t.reduce((r,o,a)=>{var l;return r.set(o.name,a*1e3),(l=o.requireAfter)!=null&&l.length&&s.push(o),r},new Map);return s.length&&(s.forEach(r=>{const o=r.requireAfter.reduce((a,l)=>(n.has(l)&&a.push(n.get(l)),a),[]);o.length&&n.set(r.name,Math.max(...o)+1)}),t.sort((r,o)=>n.get(r.name)-n.get(o.name))),t}function ly(){return{cols:[],data:[],rowKey:"id",width:"100%",height:"auto",rowHeight:35,defaultColWidth:80,minColWidth:24,maxColWidth:9999,header:!0,footer:void 0,headerHeight:0,footerHeight:0,rowHover:!0,colHover:!1,cellHover:!1,bordered:!1,striped:!0,responsive:!1,scrollbarHover:!0,horzScrollbarPos:"outside"}}function cy(i,e,t){return i&&(e&&(i=Math.max(e,i)),t&&(i=Math.min(t,i))),i}function hy(i,e){return typeof i=="string"&&(i=i.endsWith("%")?parseFloat(i)/100:parseFloat(i)),typeof e=="number"&&(typeof i!="number"||isNaN(i))&&(i=e),i}function Pd(i,e=!1,t=0){if(!i.list.length)return;if(e&&i.widthSetting&&(i.widthSetting=Math.min(i.widthSetting,i.width)),t&&(!i.widthSetting||i.widthSetting>t)&&i.width>t&&(i.widthSetting=t),i.widthSetting&&i.width!==i.widthSetting){i.width=i.widthSetting;const n=i.width-i.totalWidth;if(!e&&n>0||e&&n!==0){const r=i.flexList.length?i.flexList:i.list,o=r.reduce((a,l)=>a+(l.flex||1),0);r.forEach(a=>{const l=Math[n<0?"max":"min"](n,Math.ceil(n*((a.flex||1)/o)));a.realWidth=a.width+l})}}let s=0;i.list.forEach((n,r)=>{n.realWidth||(n.realWidth=n.width),n.left=s,n.sideIndex=r,s+=n.realWidth})}function dy(i){return i?i==="left"?"left":"right":"center"}function kx(i,e,t,s){const{defaultColWidth:n,minColWidth:r,maxColWidth:o,fixedLeftWidth:a=0,fixedRightWidth:l=0}=e,c=E=>(typeof E=="function"&&(E=E.call(i)),E=hy(E,0),E<1&&(E=Math.round(E*s)),E),h={width:0,list:[],flexList:[],widthSetting:0,totalWidth:0},d={...h,list:[],flexList:[],widthSetting:c(a)},f={...h,list:[],flexList:[],widthSetting:c(l)},m={left:d,center:h,right:f},y=[],b={};let w=!1;const x=[],D={};if(t.forEach(E=>{const{colTypes:P,onAddCol:O}=E;P&&Object.entries(P).forEach(([W,J])=>{D[W]||(D[W]=[]),D[W].push(J)}),O&&x.push(O)}),e.cols.forEach((E,P)=>{if(E.hidden)return;const{type:O="",name:W}=E,J={fixed:!1,flex:!1,width:n,minWidth:r,maxWidth:o,...E,type:O},Y={name:W,type:O,setting:J,flex:0,left:0,width:0,realWidth:0,visible:!0,index:P,side:dy(J.fixed),sideIndex:0,order:J.order,border:J.border},ve=D[O];if(ve&&ve.forEach(He=>{const te=typeof He=="function"?He.call(i,J):He;te&&Object.assign(J,te,E)}),J.hidden)return;const{flex:ee,minWidth:ne=r,maxWidth:Ce=o}=J,Me=hy(J.width||n,n);Y.flex=ee===!0?1:typeof ee=="number"?ee:0,Y.width=cy(Me<1?Math.round(Me*s):Me,ne,Ce),Y.side=dy(J.fixed),x.forEach(He=>He.call(i,Y)),y.push(Y),b[Y.name]=Y;const ze=m[Y.side];ze.list.push(Y),ze.totalWidth+=Y.width,ze.width=ze.totalWidth,Y.flex&&ze.flexList.push(Y),typeof Y.order=="number"&&(w=!0)}),w){const E=(P,O)=>(P.order??P.index)-(O.order??O.index);y.sort(E),d.list.sort(E),h.list.sort(E),f.list.sort(E)}Pd(f,!0);const I=s-f.width-Math.max(40,r);return Pd(d,!0,I),h.widthSetting=s-d.width-f.width,Pd(h),{list:y,map:b,...m}}function Sx(i){var te;const{col:e,className:t,height:s,row:n,onRenderCell:r,style:o,outerStyle:a,children:l,outerClass:c,width:h,left:d,top:f,...m}=i,y={left:d??e.left,top:f??n.top,width:h??e.realWidth,height:s,...a},{align:b,cellStyle:w,cellClass:x,className:D}=e.setting,I={justifyContent:b?b==="left"?"start":b==="right"?"end":b:void 0,...w,...o},{name:E,border:P}=e,O=["dtable-cell",c,t,D,{"has-border-left":P===!0||P==="left","has-border-right":P===!0||P==="right"}],W=["dtable-cell-content",x],J=(te=n.data)==null?void 0:te[E],Y=[l??J??""],ve=r?r(Y,{row:n,col:e,value:J},i,g):Y,ee=[],ne=[],Ce={},Me={};let ze="div";ve==null||ve.forEach(X=>{if(typeof X=="object"&&X&&!N.isValidElement(X)&&("html"in X||"className"in X||"style"in X||"attrs"in X||"children"in X||"tagName"in X)){const Ee=X.outer?ee:ne;X.html?Ee.push(k("div",{className:K("dtable-cell-html",X.className),style:X.style,dangerouslySetInnerHTML:{__html:X.html},...X.attrs??{}})):(X.style&&Object.assign(X.outer?y:I,X.style),X.className&&(X.outer?O:W).push(X.className),X.children&&Ee.push(X.children),X.attrs&&Object.assign(X.outer?Ce:Me,X.attrs)),X.tagName&&!X.outer&&(ze=X.tagName)}else(typeof X!="object"||N.isValidElement(X))&&ne.push(X)});const He=ze;return k("div",{className:K(O),style:y,"data-col":E,"data-row":n.id,"data-type":e.type||null,...m,...Ce,children:[ne.length>0&&k(He,{className:K(W),style:I,...Me,children:ne}),ee]})}function Ld({rows:i=[],cols:e,rowHeight:t,scrollLeft:s=0,scrollTop:n=0,left:r=0,top:o=0,width:a,height:l="100%",className:c,CellComponent:h=Sx,cellClass:d,onRenderCell:f}){var w;const m=Array.isArray(i)?i:[i],y=((w=m[0])==null?void 0:w.top)??0,b=m.length;return k("div",{className:K("dtable-cells",c),style:{top:o,left:r,width:a,height:l},children:k("div",{className:"dtable-cells-container",style:{left:-s,top:-n+y},children:m.reduce((x,D,I)=>{const E=e.length;return e.forEach((P,O)=>{x.push(k(h,{className:K(`is-${D.index%2?"odd":"even"}-row`,O?"":"is-first-in-row",O===E-1?"is-last-in-row":"",I?"":"is-first-row",I===b-1?"is-last-row":"",d),col:P,row:D,top:D.top-y,height:t,onRenderCell:f},`${D.index}:${P.name}`))}),x},[])})})}function uy({top:i,height:e,rowHeight:t,rows:s,cols:{left:n,center:r,right:o},scrollLeft:a,scrollTop:l,className:c,cellClass:h,style:d,onRenderCell:f,children:m}){let y=null;n.list.length&&(y=k(Ld,{className:"dtable-fixed-left",rows:s,scrollTop:l,cols:n.list,width:n.width,rowHeight:t,cellClass:h,onRenderCell:f},"left"));let b=null;r.list.length&&(b=k(Ld,{rows:s,className:"dtable-scroll-center",scrollLeft:a,scrollTop:l,cols:r.list,left:n.width,width:r.width,rowHeight:t,cellClass:h,onRenderCell:f},"center"));let w=null;return o.list.length&&(w=k(Ld,{className:"dtable-fixed-right",rows:s,scrollTop:l,cols:o.list,left:n.width+r.width,width:o.width,rowHeight:t,cellClass:h,onRenderCell:f},"right")),k("div",{className:K("dtable-block",c),style:{...d,top:i,height:e},children:[y,b,w,m]})}var fy=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},ft=(i,e,t)=>(fy(i,e,"read from private field"),t?t.call(i):e.get(i)),bt=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Zt=(i,e,t)=>(fy(i,e,"access private method"),t),xn,Xr,Qr,Rd,py,zd,my,Fd,gy,Od,yy,Tl,jd,$l,Dl,Bd,Hd,Ud,Vd,eo,Il,Ml,Wd,Kd,vy,qd,_y;let ti=class extends ae{constructor(e){super(e),bt(this,Rd),bt(this,zd),bt(this,Fd),bt(this,Od),bt(this,Tl),bt(this,eo),bt(this,Ml),bt(this,Kd),bt(this,qd),this.ref=ye(),this._rafId=0,this._needRender=!1,this._plugins=[],this._lastUsedPlugins=new Map,this._events=new Map,this._data={},this._i18nMaps=[],this._hover={in:!1},this._firstRender=!0,this.updateLayout=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const{element:t}=this;t&&!$s(t)&&this.update({dirtyType:"layout"}),this._rafId=0})},bt(this,xn,(t,s)=>{s=s||t.type;const n=this._events.get(s);if(n!=null&&n.length){for(const r of n)if(r.call(this,t)===!1){t.stopPropagation(),t.preventDefault();break}}}),bt(this,Xr,t=>{ft(this,xn).call(this,t,`window_${t.type}`)}),bt(this,Qr,t=>{ft(this,xn).call(this,t,`document_${t.type}`)}),bt(this,$l,(t,s,n,r)=>{const{row:o,col:a}=s;s.value=this.getCellValue(o,a),t[0]=s.value;const l=o.id==="HEADER"?"onRenderHeaderCell":"onRenderCell",c=(h,d)=>{try{t=h.call(this,t,s,n,r)}catch(f){console.error(`[ZUI] DTable render cell(${o.id}:${a.name}) by ${d} error:`,f)}};return a.setting[l]&&c(a.setting[l],"col"),this._plugins.forEach(h=>{h[l]&&c(h[l],`plugin (${h.name})`)}),this.options[l]&&c(this.options[l],"options"),t}),bt(this,Dl,(t,s)=>{s==="horz"?this.scroll({scrollLeft:t}):this.scroll({scrollTop:t})}),bt(this,Bd,t=>{var a,l,c;const s=this.getPointerInfo(t);if(!s)return;const{rowID:n,colName:r,cellElement:o}=s;if(n==="HEADER")o&&((a=this.options.onHeaderCellClick)==null||a.call(this,t,{colName:r,element:o}),this._plugins.forEach(h=>{var d;(d=h.onHeaderCellClick)==null||d.call(this,t,{colName:r,element:o})}));else{const h=this.layout.visibleRows.find(d=>d.id===n);if(o){if(((l=this.options.onCellClick)==null?void 0:l.call(this,t,{colName:r,rowID:n,rowInfo:h,element:o}))===!0)return;for(const d of this._plugins)if(((c=d.onCellClick)==null?void 0:c.call(this,t,{colName:r,rowID:n,rowInfo:h,element:o}))===!0)return}}}),bt(this,Hd,t=>{const s=t.key.toLowerCase();if(["pageup","pagedown","home","end"].includes(s))return!this.scroll({to:s.replace("page","")})}),bt(this,Ud,t=>{const s=v(t.target).closest(".dtable-cell");if(!s.length)return Zt(this,eo,Il).call(this,!1);Zt(this,eo,Il).call(this,[s.attr("data-row"),s.attr("data-col")])}),bt(this,Vd,()=>{Zt(this,eo,Il).call(this,!1)}),this._id=e.id??`dtable-${Xe()}`,this.state={scrollTop:0,scrollLeft:0,renderCount:0},this._allPlugins=Object.freeze(xx(e.plugins)),this._allPlugins.forEach(t=>{const{methods:s,data:n,state:r}=t;s&&Object.entries(s).forEach(([o,a])=>{typeof a=="function"&&Object.assign(this,{[o]:a.bind(this)})}),n&&Object.assign(this._data,n.call(this)),r&&Object.assign(this.state,r.call(this))}),Zt(this,Ml,Wd).call(this),this._plugins.forEach(t=>{var s;(s=t.onCreate)==null||s.call(this,t)})}get options(){var e;return((e=this._layout)==null?void 0:e.options)||this._options||ly()}get plugins(){return this._plugins}get layout(){return this._layout}get id(){return this._id}get data(){return this._data}get element(){return this.ref.current}get parent(){var e;return this.props.parent??((e=this.element)==null?void 0:e.parentElement)}get hoverInfo(){return this._hover}componentWillReceiveProps(){this._options=void 0}shouldComponentUpdate(){return!0}componentDidMount(){this._needRender?this.forceUpdate():Zt(this,Tl,jd).call(this),this.on("click",ft(this,Bd)),this.on("keydown",ft(this,Hd));const{options:e}=this;(e.rowHover||e.colHover)&&(this.on("mouseover",ft(this,Ud)),this.on("mouseleave",ft(this,Vd)));let{responsive:t}=e;if(t){t===!0&&(t="window,parent");const s=t.split(",");if(typeof ResizeObserver<"u"){const n=[],r=new ResizeObserver(this.updateLayout);this._rob=r;const{parent:o}=this;s.forEach(a=>{a!=="window"&&(a==="parent"?o&&r.observe(o):a[0]==="~"?n.push(a.slice(1)):v(a).each((l,c)=>r.observe(c)))}),n.length&&this.on(n.join(" "),this.updateLayout)}s.includes("window")&&this.on("window_resize",this.updateLayout)}this._checkPluginsState()}componentDidUpdate(){Zt(this,Tl,jd).call(this),this._checkPluginsState(),this._plugins.forEach(e=>{var t;(t=e.onUpdated)==null||t.call(this)})}componentWillUnmount(){var t;(t=this._rob)==null||t.disconnect();const{element:e}=this;if(e)for(const s of this._events.keys())s.startsWith("window_")?window.removeEventListener(s.replace("window_",""),ft(this,Xr)):s.startsWith("document_")?document.removeEventListener(s.replace("document_",""),ft(this,Qr)):e.removeEventListener(s,ft(this,xn));this._plugins.forEach(s=>{var n;(n=s.onUnmounted)==null||n.call(this)}),this._allPlugins.forEach(s=>{var n;(n=s.onDestory)==null||n.call(this)}),this._data={},this._events.clear(),this._noAnimation&&clearTimeout(this._noAnimation),this._rafId&&cancelAnimationFrame(this._rafId)}resetState(e,t){this._options=void 0,this._layout=void 0,e=e||this.props;const s={};this._plugins.forEach(n=>{const{resetState:r,state:o}=n;r&&(typeof r=="function"?Object.assign(s,r.call(this,e)):o&&Object.assign(s,o.call(this)))}),Object.keys(s).length&&this.setState(s)}on(e,t,s){var r;s&&(e=`${s}_${e}`);const n=this._events.get(e);n?n.push(t):(this._events.set(e,[t]),e.startsWith("window_")?window.addEventListener(e.replace("window_",""),ft(this,Xr)):e.startsWith("document_")?document.addEventListener(e.replace("document_",""),ft(this,Qr)):(r=this.element)==null||r.addEventListener(e,ft(this,xn)))}off(e,t,s){var o;s&&(e=`${s}_${e}`);const n=this._events.get(e);if(!n)return;const r=n.indexOf(t);r>=0&&n.splice(r,1),n.length||(this._events.delete(e),e.startsWith("window_")?window.removeEventListener(e.replace("window_",""),ft(this,Xr)):e.startsWith("document_")?document.removeEventListener(e.replace("document_",""),ft(this,Qr)):(o=this.element)==null||o.removeEventListener(e,ft(this,xn)))}emitCustomEvent(e,t){ft(this,xn).call(this,t instanceof Event?t:new CustomEvent(e,{detail:t}),e)}disableAnimation(e=200){var t;this._noAnimation&&clearTimeout(this._noAnimation),(t=this.element)==null||t.classList.add("no-animation"),this._noAnimation=window.setTimeout(()=>{var s;this._noAnimation=void 0,(s=this.element)==null||s.classList.remove("no-animation")},e)}scroll(e,t){const{scrollLeft:s,scrollTop:n,rowsHeightTotal:r,rowsHeight:o,rowHeight:a,cols:{center:{totalWidth:l,width:c}}}=this.layout,{to:h}=e;let{scrollLeft:d,scrollTop:f}=e;if(h==="up"||h==="down")f=n+(h==="down"?1:-1)*Math.floor(o/a)*a;else if(h==="left"||h==="right")d=s+(h==="right"?1:-1)*c;else if(h==="top")f=0;else if(h==="bottom")f=r-o;else if(h==="begin")d=0;else if(h==="end")d=l-c;else{const{offsetLeft:y,offsetTop:b}=e;typeof y=="number"&&(d=s+y),typeof b=="number"&&(f=n+b)}const m={};return typeof d=="number"&&(d=Math.max(0,Math.min(d,l-c)),d!==s&&(m.scrollLeft=d)),typeof f=="number"&&(f=Math.max(0,Math.min(f,r-o)),f!==n&&(m.scrollTop=f)),Object.keys(m).length?(this.setState(m,()=>{var y;(y=this.options.onScroll)==null||y.call(this,m),t==null||t.call(this,!0)}),!0):(t==null||t.call(this,!1),!1)}getColInfo(e){if(e===void 0)return;if(typeof e=="object")return e;const{cols:t}=this.layout;return typeof e=="number"?t.list[e]:t.map[e]}getRowInfo(e){if(e===void 0)return;if(typeof e=="object")return e;if(e===-1||e==="HEADER")return{id:"HEADER",index:-1,top:0};const{rows:t,rowsMap:s,allRows:n}=this.layout;return typeof e=="number"?t[e]:s[e]||n.find(r=>r.id===e)}getCellValue(e,t){var a;const s=typeof e=="object"?e:this.getRowInfo(e);if(!s)return;const n=typeof t=="object"?t:this.getColInfo(t);if(!n)return;let r=s.id==="HEADER"?n.setting.title:(a=s.data)==null?void 0:a[n.name];const{cellValueGetter:o}=this.options;return o&&(r=o.call(this,s,n,r)),r}getRowInfoByIndex(e){return this.layout.rows[e]}update(e={},t){if(!this._options)return;typeof e=="function"&&(t=e,e={});const{dirtyType:s,state:n}=e;if(s==="layout")this._layout=void 0;else if(s==="options"){if(this._options=void 0,!this._layout)return;this._layout=void 0}this.setState(n||(r=>({renderCount:r.renderCount+1})),t)}getPointerInfo(e){const t=e.target;if(!t||t.closest(".no-cell-event"))return;const s=v(t).closest(".dtable-cell");if(!s.length)return;const n=s.attr("data-row"),r=s.attr("data-col");if(!(typeof r!="string"||typeof n!="string"))return{cellElement:s[0],colName:r,rowID:n,target:t}}componentDidCatch(e,t){console.error(`[ZUI] DTable ${this.id} Error:`,e,t)}i18n(e,t,s){return Pe(this._i18nMaps,e,t,s,this.options.lang)??`{i18n:${e}}`}getPlugin(e){return this.plugins.find(t=>t.name===e)}_checkPluginsState(){const e=new Set(this._lastUsedPlugins.keys());this._plugins.forEach(t=>{var n;if(e.has(t.name)){e.delete(t.name);return}let{events:s}=t;s&&(typeof s=="function"&&(s=s.call(this)),Object.entries(s).forEach(([r,o])=>{o&&this.on(r,o)})),(n=t.onMounted)==null||n.call(this),this._lastUsedPlugins.set(t.name,t)}),e.size&&e.forEach(t=>{var n;const s=this._lastUsedPlugins.get(t);(n=s==null?void 0:s.onUnmounted)==null||n.call(this),this._lastUsedPlugins.delete(t)})}render(){let e=Zt(this,qd,_y).call(this);const{className:t,rowHover:s,colHover:n,cellHover:r,bordered:o,striped:a,scrollbarHover:l,beforeRender:c,emptyTip:h,style:d}=this.options,f={...d},m=["dtable",t,{"dtable-hover-row":s,"dtable-hover-col":n,"dtable-hover-cell":r,"dtable-bordered":o,"dtable-striped":a,"scrollbar-hover":l,"no-animation":this._noAnimation}],y=[];if(e){const b=!e.rows.length;if(c){const w=c.call(this,e);w&&(e=w)}this._plugins.forEach(w=>{var D;const x=(D=w.beforeRender)==null?void 0:D.call(this,e);x&&(e=x)}),f.width=e.width,f.height=e.height,f["--dtable-row-height"]=`${e.rowHeight}px`,f["--dtable-header-height"]=`${e.headerHeight}px`,m.push(e.className,b?"dtable-is-empty":"",{"dtable-has-scroll-y":e.rowsHeightTotal>e.rowsHeight,"dtable-scrolled-down":e.scrollTop>0,"dtable-scrolled-bottom":e.scrollTop>=e.rowsHeightTotal-e.rowsHeight,"dtable-scrolled-right":e.scrollLeft>0,"dtable-scrolled-end":e.scrollLeft>=e.cols.center.totalWidth-e.cols.center.width}),e.children&&y.push(...e.children),b&&h?(delete f.height,y.push(k("div",{className:"dtable-empty-tip",children:k(fe,{content:h,generatorThis:this,generatorArgs:[e]})},"empty-tip"))):(y.push(Zt(this,Rd,py).call(this,e),Zt(this,zd,my).call(this,e),Zt(this,Fd,gy).call(this,e)),e.scrollable&&y.push(Zt(this,Od,yy).call(this,e))),this._plugins.forEach(w=>{var D;const x=(D=w.onRender)==null?void 0:D.call(this,e);x&&(x.style&&Object.assign(f,x.style),x.className&&m.push(x.className),x.children&&y.push(x.children))})}return k("div",{id:this._id,className:K(m),style:f,ref:this.ref,tabIndex:-1,children:y})}};xn=new WeakMap,Xr=new WeakMap,Qr=new WeakMap,Rd=new WeakSet,py=function(i){const{header:e,cols:t,headerHeight:s,scrollLeft:n,headerChildren:r}=i;if(!e)return null;if(e===!0)return k(uy,{className:"dtable-header",cols:t,height:s,scrollLeft:n,rowHeight:s,scrollTop:0,cellClass:"dtable-header-cell",rows:{id:"HEADER",index:-1,top:0},top:0,onRenderCell:ft(this,$l),children:r},"header");const o=Array.isArray(e)?e:[e];return k(xh,{className:"dtable-header",style:{height:s},renders:o,generateArgs:[i],generatorThis:this,children:r},"header")},zd=new WeakSet,my=function(i){const{headerHeight:e,rowsHeight:t,visibleRows:s,rowHeight:n,cols:r,scrollLeft:o,scrollTop:a,bodyChildren:l}=i;return k(uy,{className:"dtable-body",top:e,height:t,rows:s,rowHeight:n,scrollLeft:o,scrollTop:a,cols:r,onRenderCell:ft(this,$l),children:l},"body")},Fd=new WeakSet,gy=function(i){let{footer:e}=i;if(typeof e=="function"&&(e=e.call(this,i)),!e)return null;const t=Array.isArray(e)?e:[e];return k(xh,{className:"dtable-footer",style:{height:i.footerHeight,top:i.rowsHeight+i.headerHeight},renders:t,generateArgs:[i],generatorThis:this,generators:i.footerGenerators,children:i.footerChildren},"footer")},Od=new WeakSet,yy=function(i){const e=[],{scrollLeft:t,cols:{left:{width:s},center:{width:n,totalWidth:r}},scrollTop:o,rowsHeight:a,rowsHeightTotal:l,footerHeight:c,headerHeight:h}=i,{scrollbarSize:d=12,horzScrollbarPos:f,vertScrollbarPos:m}=this.options;return r>n&&e.push(k(ny,{type:"horz",scrollPos:t,scrollSize:r,clientSize:n,onScroll:ft(this,Dl),left:s,bottom:(f==="inside"?0:-d)+c,size:d,wheelContainer:this.ref},"horz"),k("div",{className:"dtable-scroll-shadow is-left",style:{left:s,height:h+a}}),k("div",{className:"dtable-scroll-shadow is-right",style:{left:s+n,height:h+a}})),l>a&&e.push(k(ny,{type:"vert",scrollPos:o,scrollSize:l,clientSize:a,onScroll:ft(this,Dl),right:m==="outside"?-d:0,size:d,top:h,wheelContainer:this.ref},"vert")),e.length?e:null},Tl=new WeakSet,jd=function(){var i;this._needRender=!1,this._plugins.forEach(e=>{var t;return(t=e.afterRender)==null?void 0:t.call(this,this._firstRender)}),(i=this.options.afterRender)==null||i.call(this,this._firstRender),this._firstRender=!1},$l=new WeakMap,Dl=new WeakMap,Bd=new WeakMap,Hd=new WeakMap,Ud=new WeakMap,Vd=new WeakMap,eo=new WeakSet,Il=function(i){const{element:e,options:t}=this;if(!e)return;const s=v(e),n=i?{in:!0,row:i[0],col:i[1]}:{in:!1};t.colHover==="header"&&n.row!=="HEADER"&&(n.col=void 0);const r=this._hover;n.in!==r.in&&s.toggleClass("dtable-hover",n.in),n.row!==r.row&&(s.find(".is-hover-row").removeClass("is-hover-row"),n.row&&s.find(`.dtable-cell[data-row="${n.row}"]`).addClass("is-hover-row")),n.col!==r.col&&(s.find(".is-hover-col").removeClass("is-hover-col"),n.col&&s.find(`.dtable-cell[data-col="${n.col}"]`).addClass("is-hover-col")),this._hover=n},Ml=new WeakSet,Wd=function(){if(this._options)return!1;const e={...ly(),...this._allPlugins.reduce((t,s)=>{const{defaultOptions:n}=s;return n&&Object.assign(t,n),t},{}),...this.props};return this._options=e,this._plugins=this._allPlugins.reduce((t,s)=>{const{options:n}=s;let r=e;return n&&(r=Object.assign({...r},typeof n=="function"?n.call(this,e):n)),r!==e&&Object.assign(e,r),t.push(s),t},[]).filter(t=>{const{when:s}=t;return!s||s.call(this,e)}),this._i18nMaps=[this.options.i18n,...this.plugins.map(t=>t.i18n)].filter(Boolean),!0},Kd=new WeakSet,vy=function(){var Y,ve;const{plugins:i}=this;let e=this._options;const t={flex:k("div",{style:"flex:auto"}),divider:k("div",{style:"width:1px;margin:var(--space);background:var(--color-border);height:50%"})};i.forEach(ee=>{var Ce;const ne=(Ce=ee.beforeLayout)==null?void 0:Ce.call(this,e);ne&&(e={...e,...ne}),Object.assign(t,ee.footer)});let s=e.width,n=0;if(typeof s=="function"&&(s=s.call(this)),s==="100%"){const{parent:ee}=this;if(ee)n=ee.clientWidth;else{this._needRender=!0;return}}const r=kx(this,e,i,n),{data:o,rowKey:a="id",rowHeight:l=35,rowConverter:c}=e,h=[],d=(ee,ne,Ce)=>{var He,te;const Me=Ce??{[a]:ee},ze={data:c?c.call(this,Me,ne):Me,id:ee,index:h.length,top:0};if(Ce||(ze.lazy=!0),h.push(ze),((He=e.onAddRow)==null?void 0:He.call(this,ze,ne))!==!1){for(const X of i)if(((te=X.onAddRow)==null?void 0:te.call(this,ze,ne))===!1)return}};if(typeof o=="number")for(let ee=0;ee<o;ee++)d(`${ee}`,ee);else Array.isArray(o)&&o.forEach((ee,ne)=>{typeof ee=="object"?d(`${ee[a]??""}`,ne,ee):d(`${ee??""}`,ne)});let f=h;const m={};if(e.onAddRows){const ee=e.onAddRows.call(this,f,r);ee&&(f=ee)}for(const ee of i){const ne=(Y=ee.onAddRows)==null?void 0:Y.call(this,f,r);ne&&(f=ne)}f.forEach((ee,ne)=>{m[ee.id]=ee,ee.index=ne,ee.top=ee.index*l});const{header:y,footer:b}=e,w=y?e.headerHeight||l:0,x=b?e.footerHeight||l:0;let D=e.height,I=0;const E=f.length*l,P=w+x+E;if(typeof D=="function"&&(D=D.call(this,P)),D==="auto")I=P;else if(typeof D=="object")I=Math.min(D.max,Math.max(D.min,P));else if(D==="100%"){const{parent:ee}=this;if(ee)I=ee.clientHeight;else{I=0,this._needRender=!0;return}}else I=D;const O=I-w-x,W={options:e,allRows:h,width:n,height:I,rows:f,rowsMap:m,rowHeight:l,rowsHeight:O,rowsHeightTotal:E,header:y,footer:b,footerGenerators:t,headerHeight:w,footerHeight:x,cols:r},J=(ve=e.onLayout)==null?void 0:ve.call(this,W);J&&Object.assign(W,J),i.forEach(ee=>{if(ee.onLayout){const ne=ee.onLayout.call(this,W);ne&&Object.assign(W,ne)}}),this._layout=W},qd=new WeakSet,_y=function(){(Zt(this,Ml,Wd).call(this)||!this._layout)&&Zt(this,Kd,vy).call(this);const{layout:i}=this;if(!i)return;const{cols:{center:e}}=i;let{scrollLeft:t}=this.state;t=Math.min(Math.max(0,e.totalWidth-e.width),t);let s=0;e.list.forEach(b=>{b.left=s,s+=b.realWidth,b.visible=b.left+b.realWidth>=t&&b.left<=t+e.width});const{rowsHeightTotal:n,rowsHeight:r,rows:o,rowHeight:a}=i,{rowDataGetter:l,partialRender:c=!0}=this.options,h=Math.min(Math.max(0,n-r),this.state.scrollTop),d=c?Math.floor(h/a):0,f=h+r,m=c?Math.min(o.length,Math.ceil(f/a)):o.length,y=[];for(let b=d;b<m;b++){const w=o[b];w.lazy&&l&&(w.data=l([w.id])[0],w.lazy=!1),y.push(w)}return Object.assign(i,{visibleRows:y,scrollTop:h,scrollLeft:t,headerChildren:[],bodyChildren:[],footerChildren:[],children:[],className:"",scrollable:!0}),i},ti.addPlugin=iy,ti.removePlugin=ry;class Tx extends ae{constructor(){super(...arguments),this._dtablePlugins=["sort","zentao","resize","pager"],this._dtable=ye(),this._createActionItem=(e,t)=>{var s,n,r,o;return e.command=e.command.replace("{id}",String(t.row.data.id)),e.key==="move"&&((n=(s=this.props).canMoveDoc)==null?void 0:n.call(s,t.row.data))===!1&&(e.disabled=!0),e.key==="edit"&&((r=t.row.data.privs)==null?void 0:r.edit)===!1&&(e.disabled=!0),e.key==="delete"&&((o=t.row.data.privs)==null?void 0:o.delete)===!1&&(e.disabled=!0),e},this._getToolbar=e=>{const{getActions:t}=this.props,s=t==null?void 0:t("doc-table",{ui:"table-foot-toolbar",dtable:e});if(s)return{btnProps:{size:"sm",btnType:"secondary"},items:s}}}_getCols(){const e={edit:{hint:"编辑",icon:"edit",command:"startEditDoc/{id}",key:"edit"},move:{hint:"移动",icon:"folder-move",command:"moveDoc/{id}",key:"move"},delete:{hint:"删除",icon:"trash",command:"deleteDoc/{id}",key:"trash"}},{searchKeys:t=[],app:s}=this.props;return[{name:"rawID",title:"ID",type:"checkID",sort:"number"},{name:"title",title:"标题",type:"title",onRenderCell:(o,a)=>{const l=a.row.data,c=l.title;return o[0]=g("div",{className:"row items-center gap-1 cursor-pointer flex-auto min-w-0","zui-command":`selectDoc/${l.id}`},g(Ie,{icon:l.icon??s.getDocIcon(l),className:l.icon?"":"text-special"})," ",g("a",{title:c,className:"doc-list-item-title text-primary"},t.length?dt.underlineKeys(t,[c]):c)),l.status==="draft"&&o.push(g("div",{className:"label special-pale size-sm rounded-full ml-1 flex-none"},s.getLang("draft","草稿"))),o},sort:!0},{name:"collects",title:"收藏数",onRenderCell:(o,a)=>{const l=a.row.data;return l.api?[]:[g(we,{type:"ghost",size:"sm",text:l.collects||0,icon:l.isCollector?"star text-warning":"star-empty text-gray","zui-command":`collectDoc/${a.row.id}`})]},sort:"number",cellClass:"px-2",fixed:"left"},{name:"views",title:"浏览数",sort:"number",align:"center"},{name:"addedBy",title:"创建者",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"editedBy",title:"修改者",type:"user",sort:!0},{name:"editedDate",title:"修改日期",type:"date",sort:!0},{name:"actions",title:"操作",type:"actions",width:96,minWidth:96,actionsMap:e,actions:["edit","move","delete"],actionItemCreator:this._createActionItem}]}_getTableOptions(e){const{docs:t,userMap:s,getTableOptions:n,app:r}=e,o=[...t].sort((l,c)=>l.nestedOrder-c.nestedOrder).map(l=>l.data),a={width:"100%",height(l){var h;const c=(h=this.element)==null?void 0:h.parentElement;return c?Math.min(l,c.clientHeight):l},cols:this._getCols(),checkable:!0,sort:!0,plugins:this._dtablePlugins,data:o,userMap:s,colResize:!0,footToolbar:this._getToolbar,footer:["checkbox","toolbar","checkedInfo","flex","pager"],localPager:!0,loadPartial:!0,canRowCheckable:l=>+String(l)==+l?!0:"disabled",emptyTip:g("div",{className:"center gap-4"},g("div",{className:"text-gray"},r.getLang("noDocs","没有文档")),Be.render({items:r.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:r.getPagerItems()}};return(n==null?void 0:n(a,{type:"doc-list"}))??a}render(e){return g("div",{class:K("doc-list h-full col",e.className)},g(ti,{ref:this._dtable,...this._getTableOptions(e)}))}}const Gd=class fr extends ae{constructor(){super(...arguments),this._files=pe(),this._loadID="",this._timer=0,this._handleChangePager=e=>{this.props.app.resetPager("files",{...e})}}_filterFiles(e){if(!(e!=null&&e.length))return e;const{currentUser:t,onGetUser:s,searchKeys:n=[],filterType:r}=this.props,o=r&&r!=="all";if(!o&&!n.length)return e;const a=["title","extension","objectType","sourceName",l=>`.${l.extension}`,s?l=>s(l.addedBy).realname:null].filter(Boolean);return e.filter(l=>!(o&&!fr.isFileMatchFilter(l,r,t)||n.length&&!dt.isItemMatch(l,n,a)))}_getCols(){const{searchKeys:e=[],fileUrl:t,app:s}=this.props,n=l=>typeof t=="function"?t.call(this,l):t?$e(t,l):void 0;return[{name:"id",title:"ID",type:"id",sort:"number"},{name:"title",title:"附件名称",type:"title",width:300,onRenderCell:(l,c)=>{var y;const h=c.row.data,d=fr.getFilterTypeFromExt(h.extension),f=d?(y=fr.filterTypeConfig[d])==null?void 0:y.iconClass:void 0,m=h.title;return l[0]=g("a",{title:m,href:n(h),target:"_blank",className:"doc-list-item-title text-primary"},e.length?dt.underlineKeys(e,[m]):m),l.unshift(g(Ie,{icon:ei.getFileIcon(h,ei.getDefaultIconMap())||"file",className:f})),l},sort:!0},{name:"objectName",title:"来源",type:"text",sort:!0,width:400,flex:1,cellClass:"px-2",onRenderCell:(l,c)=>{const h=c.row.data,{objectType:d,objectID:f,sourceName:m}=h;if(!d||!f)return l;const y=ut(d,"view",`${d}ID=${f}`),b=`#${f} ${m}`,w=d==="doc";return l.push(g("a",{"data-toggle":w?void 0:"modal","data-size":w?void 0:"lg",href:y,title:`${h.objectName??""}${b}`},b)),l}},{name:"extension",title:"类型",sort:!0,align:"center"},{name:"size",title:"大小",format:pt,sort:"number"},{name:"addedBy",title:"由谁添加",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"actions",title:"操作",fixed:"right",width:64,minWidth:64,onRenderCell:(l,c)=>{const h=c.row.data;return l[0]=g(we,{type:"ghost",className:"text-primary",size:"sm",icon:"download",hint:s.getLang("downloadFile","下载文件"),target:"_blank",url:n(h)}),l}}]}async loadFiles(){const{filesFetcher:e,objectID:t,objectType:s}=this.props;this._files.value=void 0,this._loadID=[s,t].join();const n=await Ne(e,[{objectID:+t,objectType:s}]);[this.props.objectType,this.props.objectID].join()===this._loadID&&(this._files.value=n||[])}tryLoadFiles(){this._loadID!==[this.props.objectType,this.props.objectID].join()&&(this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this._timer=0,this._loadID!==[this.props.objectType,this.props.objectID].join()&&this.loadFiles()},100))}componentDidMount(){this.tryLoadFiles()}componentDidUpdate(){this.tryLoadFiles()}componentWillUnmount(){this._timer&&clearTimeout(this._timer)}_getTableOptions(e,t){const{app:s}=e,n={width:"100%",height(r){var a;const o=(a=this.element)==null?void 0:a.parentElement;return o?Math.min(r,o.clientHeight):r},cols:this._getCols(),checkable:!1,className:"h-full",sort:!0,sortBy:{name:"id",order:"asc"},plugins:["sort","zentao","resize","pager"],data:t||[],userMap:e.userMap,colResize:!0,localPager:!0,loadPartial:!0,emptyTip:t?g("div",{className:"center gap-4 text-gray"},s.getLang("noFiles","没有文件")):null,footPager:{items:s.getPagerItems(),onChangePageInfo:this._handleChangePager}};return s.getTableOptions(n,{type:"file-list"})??n}render(e){const t=this._filterFiles(this._files.value),s=this._getTableOptions(e,t);return g("div",{className:`doc-lib-files h-full col load-indicator${t?"":" loading"}`,"data-loading":e.app.getLang("loadingFilesTip","正在加载文件...")},g(ti,{...s}))}static getFilterTypeFromExt(e){const[t]=Object.entries(fr.filterExtensions).find(([,s])=>s.has(e))||[];return t}static isFileMatchFilter(e,t,s){if(t==="addedByMe")return e.addedBy===s;if(t==="bug"||t==="story"||t==="task")return e.objectType===t;const{filterExtensions:n}=fr,{extension:r}=e;if(t==="other")return Object.values(n).every(a=>!a.has(r));const o=n[t];return o==null?void 0:o.has(r)}};Gd.filterTypeConfig={all:{text:"全部",icon:"file-alt",iconClass:"text-gray"},story:{text:"需求",icon:"lightbulb",iconClass:"text-primary"},bug:{text:"Bug",icon:"bug",iconClass:"text-danger"},task:{text:"任务",icon:"checkbox",iconClass:"text-secondary"},office:{text:"Office",icon:"file-word",iconClass:"text-primary"},doc:{text:"文档",icon:"file-text",iconClass:"text-secondary"},image:{text:"图片",icon:"file-image",iconClass:"text-warning"},av:{text:"音视频",icon:"file-video",iconClass:"text-danger"},archive:{text:"压缩包",icon:"file-archive",iconClass:"text-important"},code:{text:"代码",icon:"file-code",iconClass:"text-success"},other:{text:"其他",icon:"file",iconClass:"text-gray"},addedByMe:{text:"由我添加",icon:"person",iconClass:"text-primary"}},Gd.filterExtensions={av:new Set(["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac","mp4","avi","mkv","mov","flv","wmv","webm"]),image:new Set(["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]),code:new Set(["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown","log"]),doc:new Set(["pdf","txt","md"]),office:new Set(["doc","docx","xls","xlsx","ppt","pptx"]),archive:new Set(["zip","rar","7z","tar","gz","bz2","xz","exe","dmg"])};let Zd=Gd;class $x extends ae{constructor(){super(...arguments),this.state={},this._menu=ye(),this._ref=ye(),this._isExpandAll=pe(!1),this._getTreeItem=e=>{var b;const t=e.data,s=t.id;if(e.type==="doc")return{className:"item tree-item",type:"item",key:e.key,icon:t.icon??this.props.app.getDocIcon(t),selected:s===this.props.docID,text:t.title,hint:t.title,items:(b=e.docs)!=null&&b.length?[...e.docs]:void 0,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions("doc",t,"sidebar"),_data:e};const{moduleIcon:n,moduleID:r,lib:o,docID:a,app:l}=this.props,c=l.props.libColors,{modules:h=[],docs:d=[]}=e,f=e.type==="lib";let m=t.icon;if(m===void 0)if(f){const w=t.type==="api"?this.props.apiLibIcon:this.props.libIcon;m=typeof w=="string"&&c?{icon:w,style:{color:c[s%c.length]}}:w}else m=n;const y={className:"item tree-item",type:"item",key:e.key,text:t.name,icon:m,items:f?void 0:[...h,...d],iconClass:f?"gray-pale w-5 h-5 center rounded-lg":"",selected:!1,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions(e.type,t,"sidebar"),hint:t.name,_data:e};if(!a){const w=o==null?void 0:o.data.id;f&&!r?y.selected=s===w:!f&&r&&(y.selected=s===r)}return y},this._toggleSearchBox=()=>{this.setState({search:!this.state.search})},this._handleToggleTree=()=>{var e;this._isExpandAll.value=!!((e=this._menu.current)!=null&&e.isAllExpanded())},this.toggleTree=()=>{var e;(e=this._menu.current)==null||e.toggleAll(!this._isExpandAll.value),this._isExpandAll.value=!this._isExpandAll.value},this._handleClickItem=e=>{var s,n,r,o,a,l,c,h;if(e.event.target.closest(".item-icon,.nested-toggle-icon"))return;const t=e.renderedItem._data;t&&(t.type==="doc"?(n=(s=this.props).onSelectDoc)==null||n.call(s,t.data):t.type==="lib"?(o=(r=this.props).onSelectLib)==null||o.call(r,t.data.id):t.type==="files"?(l=(a=this.props).onShowFiles)==null||l.call(a):(h=(c=this.props).onSelectLib)==null||h.call(c,t.data.lib,t.data.id))},this._handleClickFileFilter=e=>{this.props.app.setFilterType(e.item.key,"files")}}_renderFooterToolbar(e){var s,n;const t=((n=(s=this.props).getActions)==null?void 0:n.call(s,e,"current","sidebar-toolbar"))||[];return t.unshift({icon:this._isExpandAll.value?"list-collapse":"list-expand",onClick:this.toggleTree}),Be.render({items:t},[],{type:"ghost",size:"sm"})}_renderFooterHint(e){const t=this.props.app.renderCustom("sidebar-footer-hint",e);if(t!==void 0&&typeof t!="string")return t;let s="";if(typeof t=="string")s=t;else{const{space:n,spaceType:r,lib:o,showFiles:a,app:l}=this.props;if(n){const c=l.getLang("colon",": ");s=`${l.getLang(["spaceTypeNames",r],[],{custom:"空间",mine:"空间",product:"产品",project:"项目"}[r]||r)}${c}${n.name}`,o?s+=` ${l.getLang("libNamePrefix","库")}${c}${o.data.name}`:a&&(s+=` ${l.getLang("libNamePrefix","库")}${c}${l.getLang("filesLib","附件库")}`)}}return g("div",{className:"flex-auto text-gray text-clip overflow-hidden whitespace-nowrap",title:s},s)}_renderFooter(e){const t=this.props.app.renderCustom("sidebar-footer",e);return t!==void 0?t:g("div",{key:"actions",className:"doc-tree-actions row items-center flex-none surface-light h-9 border-t pl-2 pr-1"},this._renderFooterHint(e),this._renderFooterToolbar(e))}_getLibs(e){const{libs:t,app:s,onShowFiles:n,libTypes:r=[],libFilesIcon:o="annex-lib"}=e,a=[],l=n?{key:"project-files",text:s.getLang("filesLib","附件库"),icon:o,iconClass:"success-pale w-5 h-5 center rounded-lg",actions:!1,selected:e.showFiles,_data:{type:"files"}}:null;if(!(r!=null&&r.length))return a.push(...t.map(f=>this._getTreeItem(f))),l&&a.push(l),[a,!1];const[c,h]=Dx(t,r,s.spaceType),d=!!h.size;return r.forEach((f,m)=>{const y=c.get(f.type)||[];if(y.length)if(a.push({key:`lib-type-${f.type}`,type:"heading",text:f.name,content:g("span",{className:"label size-sm rounded-full gray-pale"},y.length+(l&&!m?1:0)),icon:f.icon,actions:!1,className:m&&a.length>1?"mt-1.5 pt-1 border-t":""}),d){const b=new Set,w=y.reduce((x,D)=>{const I=D.data.execution,E=I?h.get(I):null;if(E&&E.length>1){if(b.has(I))return x;b.add(I),x.push({className:"item tree-item",type:"item",key:`e${I}`,text:D.data.executionName??D.data.name,innerComponent:"div",icon:"run",iconClass:"text-gray",items:E.map(P=>({...this._getTreeItem(P),text:P.data.originName}))})}else x.push(this._getTreeItem(D));return x},[]);a.push(...w)}else a.push(...y.map(b=>this._getTreeItem(b)));!m&&l&&a.push(l)}),[a,d]}_renderLibList(e){const{libs:t,app:s,space:n,preserve:r}=e;if(!(t!=null&&t.length))return g("div",{key:"empty",className:"center gap-4 h-full"},g("div",{className:"text-gray"},s.getLang("noLibs","没有文档库")),Be.render({items:s.getActions("space",{ui:"sidebar-no-lib",data:n})},[]));const[o,a]=this._getLibs(e),l=e.app.getSortableOptions("lib");return g("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},a?g(l?Ei:zt,{ref:this._menu,preserve:r,wrapClass:"doc-lib-list doc-lib-tree px-1",className:"p-2",items:o,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...l}):g(l?Rr:Dt,{className:"doc-lib-list p-2",itemKey:"key",items:o,activeOnHover:!1,hoverItemActions:!0,onClickItem:this._handleClickItem,itemProps:{titleClass:"text-clip"},...l}))}_renderModuleTree(e){const{lib:t,app:s,preserve:n}=e,r=t?[...t.modules,...t.docs].filter(l=>!l.data.deleted):[];if(!r.length)return g("div",{key:"empty",className:"center gap-4 h-full"},g("div",{className:"text-gray"},s.getLang("noModules","没有目录")),Be.render({items:s.getActions("lib",{ui:"sidebar-no-module",data:t})},[]));const o=e.app.getSortableOptions("doc-module");return g("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},g(o?Ei:zt,{ref:this._menu,preserve:n,wrapClass:"doc-lib-list doc-lib-tree px-1",className:K("p-2",t?"":"pl-3"),items:r,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",getItem:this._getTreeItem,onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...o}))}_renderFileFilterList(e){const t=["all","story","bug","task","office","doc","image","av","archive","code","other"].map(n=>({key:n,...Zd.filterTypeConfig[n]}));e.currentUser&&t.push({key:"addedByMe",...Zd.filterTypeConfig.addedByMe});const s=e.app.filterType;return g(Dt,{className:"doc-file-filter-list py-2 px-3",itemKey:"key",items:t.map(n=>({...n,selected:n.key===s})),activeOnHover:!1,onClickItem:this._handleClickFileFilter})}_scrollToSelected(){const e=this._ref.current.querySelector(".item>.selected");e&&v(e).scrollIntoView({behavior:"smooth"})}componentDidMount(){this._sidebar=new qr(this._ref.current,{width:240,minWidth:64,maxWidth:400,parent:".doc-app",side:"left",preserve:this.props.preserve}),this._scrollToSelected(),this._handleToggleTree()}componentDidUpdate(e){(e.moduleID!==this.props.moduleID||e.docID!==this.props.docID)&&this._scrollToSelected()}componentWillUnmount(){var e;(e=this._sidebar)==null||e.destroy()}render(e){const{className:t,lib:s,showFiles:n,app:r}=e,o=!s||n;return g("div",{className:K("doc-sidebar sidebar border-r flex-none z-50 col",t),ref:this._ref},r.renderCustom("sidebar-before",this),o?this._renderLibList(e):this._renderModuleTree(e),r.renderCustom("sidebar-after",this),this._renderFooter(o?"space":"lib"))}}function Dx(i,e,t){const s=new Map,n=new Map;for(const{type:o}of e)n.set(o,[]);const r=n.get(t);for(const o of i){const{type:a=""}=o.data;if(n.has(a)?n.get(a).push(o):r&&r.push(o),a!=="execution")continue;const l=o.data.execution;s.has(l)?s.get(l).push(o):s.set(l,[o])}return[n,s]}const by=1e9;let Ix=by;function Mx(){return Ix++}function wy(i){return i>=by}function si(i){return typeof i=="string"&&String(+i)===i?+i:i}function Cy(i){return typeof i=="string"?+i.replace("api.",""):i}function Nx(i,e,t){const s=new Map,n=new Map,r=new Map,o=[];if(e){const{libs:c=[],docs:h=[],modules:d=[]}=e;for(const y of c){if(y.deleted||y.space!==i&&!t)continue;const w={type:"lib",key:`l${y.id}`,docs:[],modules:[],data:y,nestedOrder:y.order||0,nestedLevel:1};s.set(y.id,w),o.push(w)}const f=[],m=[...d].sort((y,b)=>(y.order||0)-(b.order||0));for(const y of m){if(y.deleted)continue;const b=`m${y.id}`,w=s.get(y.lib);if(!w||w.data.type==="api"&&y.type!=="api")continue;const x={type:"module",key:b,docs:[],modules:[],data:y,parent:w,nestedOrder:0,nestedLevel:w.nestedLevel+1};n.set(y.id,x),y.parent===y.id&&delete y.parent,y.parent||w.modules.push(x),y.parent!==void 0&&f.push(x)}if(f.length)for(const y of f){const b=n.get(y.data.parent);if(b){b.modules.push(y),y.parent=b,y.nestedLevel=b.nestedLevel+1;const w=s.get(y.data.lib),x=w==null?void 0:w.modules.findIndex(D=>D.data.id===y.data.id);typeof x=="number"&&x>=0&&w.modules.splice(x,1)}}for(const y of h){const b=`${y.id}`,w=s.get(y.lib);if(!w&&y.lib!==i)continue;const x={type:"doc",key:b,data:y,parent:w,docs:[],nestedOrder:0,nestedLevel:0};r.set(y.id,x)}for(const y of r.values()){if(y.data.parent){const x=r.get(y.data.parent);if(x){x.docs.push(y),y.parent=x,y.nestedLevel=x.nestedLevel+1;continue}}const b=n.get(y.data.module),w=s.get(y.data.lib);b?(b.docs.push(y),y.parent=b,y.nestedLevel=b.nestedLevel+1):w&&(y.nestedLevel=w.nestedLevel+1,w.docs.push(y))}}o.sort((c,h)=>(c.data.order||0)-(h.data.order||0));let a=1;const l=(c,h=!1)=>{for(const d of c){d.nestedOrder=a++;const f=d.modules;f&&f.length&&l(f,h),d.docs.length&&(d.docs.sort(h?(m,y)=>y.data.order-m.data.order:(m,y)=>m.data.order-y.data.order),l(d.docs,h))}};return o.forEach(c=>{var d;const h=(d=c.data.orderBy)==null?void 0:d.endsWith("desc");l([c],h)}),{libs:s,modules:n,docs:r,libList:o}}function to(i,e=[],t){if(e.push(...t?i.docs.map(s=>s.data):i.docs),i.modules)for(const s of i.modules)to(s,e,t);for(const s of i.docs)to(s,e,t);return e}const Ex=i=>{const{time:e=6e4,content:t,contentType:s="markdown",space:n=6,lib:r=2,module:o=1,title:a=""}=i||{};st.session.set("nextCreatingDoc",{expired:Date.now()+e,title:a,content:t,contentType:s,space:n,lib:r,module:o})},xy=i=>{const{space:e=0,lib:t=0,module:s=0}=i||{},n=st.session.get("nextCreatingDoc");if(n&&!(e&&n.space&&e!==n.space||t&&n.lib&&t!==n.lib||s&&n.module&&s!==n.module)&&(st.session.remove("nextCreatingDoc"),!(Date.now()>n.expired)))return n};function Ax(i){const{link:e,itemProps:t={},typeIconMap:s={},labelMap:n={},searchKeys:r,active:o,itemType:a="",checkIcon:l,hideDirIcon:c}=this,{id:h,keys:d,text:f,className:m,type:y,url:b,items:w,icon:x,label:D,...I}=i;let{type:E}=i;E=E==="item"?a:E||a;let P=w?D??(n[E]||E):null,O;typeof P=="string"&&P.length&&(O=P,P=g("span",{class:"label rounded-full gray-pale size-sm ml-1"},P));let W=b;W===void 0&&e&&(typeof e=="function"?W=e(i):typeof e=="object"?(W=e[E],W&&(W=$e(W,i))):w||(W=$e(e,i)));let J=x;J===void 0&&(!c||W)&&(J=s[E]),typeof J=="string"&&(J={icon:J},O&&v.extend(J,{"data-toggle":"tooltip","data-title":O}));let Y=f??(n[E]||E);r!=null&&r.length&&(Y=Kn.underlineKeys(r,[Y]));const ve=String(o)===String(h);return{type:"item",key:h,content:P,icon:J,trailingIcon:l&&ve?{icon:"check",className:"mx-1 text-primary"}:void 0,items:w,"data-url":W,"data-type":E,title:Y,selected:ve,hint:f,...t,...I,className:K("dropmenu-item tree-item",m,t.className,w?"is-dir":"is-item"),innerClass:W?"is-link open-url":"is-toggle",active:!1}}function ky(i){const{className:e,items:t,tree:s,onClickItem:n,defaultNestedShow:r}=i;return g(zt,{items:t,getItem:Ax.bind(i),className:K(e,"dropmenu-tree"),defaultNestedShow:r,onClickItem:n,...s})}const Px=(i,e)=>{const{keys:t="",text:s}=i;return!e.length||e.every(n=>t.toLowerCase().includes(n)||typeof s=="string"&&s.toLowerCase().includes(n))},Sy=(i,e,t=0)=>(i=i.reduce((s,n)=>{const{items:r}=n;if(r){if(r.length){const[o,a]=Sy(r,e);o.length&&(s.push({...n,items:o}),t+=a)}}else Px(n,e)&&(s.push(n),t++);return s},[]),[i,t]);class Ty extends ed{constructor(e){super(e),this._searchbox=ye(),this._list=ye(),this._handleSearch=t=>{this.setState({search:t})},this._handleExpandBtnClick=()=>{this.expand()},this._handleItemClick=({item:t,event:s})=>{const n=v(s.target);!n.closest(".tree-toggle").length&&n.closest(".is-link").length&&(this.props.togglePop(!1,{text:t.text??`${t.type}:${t.id}`}),this.props.changeState({text:t.text??`${t.type||""}:${t.id}`,value:t.id}))},this._scrollToActive=()=>{requestAnimationFrame(()=>{const t=this._list.current;t&&v(t).find(".tree-item-inner.active").scrollIntoView()})},this.activeTab=t=>{this.setState({active:t})},this.expand=t=>{this.setState({expanded:t??!this.state.expanded})},this.state={search:"",data:e.data,expanded:!1,loading:!!e.fetcher&&!e.data}}async load(){var s,n;let{fetcher:e}=this.props;if(!e)return this._scrollToActive();if(typeof e=="string"&&(e={url:e}),typeof e=="object"){const{url:r,...o}=e;e=()=>v.ajax({url:r,dataType:"json",jsonParser:Ho,...o})}this.setState({loading:!0});let t=await e();t.result&&(t=t.data),t={...this.props.data,...t},this.setState({data:t,loading:!1},this._scrollToActive),(n=(s=this.props).onCacheData)==null||n.call(s,t)}componentDidMount(){var e;super.componentDidMount(),this.props.data||this.load(),(e=this._searchbox.current)==null||e.focus(),this._scrollToActive()}_getTreeProps(e){const{data:{labelMap:t,link:s,typeIconMap:n,typeLabelMap:r,itemProps:o,tree:a,itemType:l,checkIcon:c,hideDirIcon:h=!0}={},search:d}=this.state,f=v.unique(d.toLowerCase().split(" ").filter(m=>m.length));return{items:f.length&&e.items.length>100?e.items.slice(0,100):e.items,labelMap:t,typeIconMap:{execution:"run",project:"project",product:"product",program:"cards-view",...n},hideDirIcon:h,typeLabelMap:r,itemProps:o,itemType:l,checkIcon:c,onClickItem:this._handleItemClick,tree:a,link:s,active:this.props.state.value,defaultNestedShow:!!((e.count||e.items.length)<100||f.length||e.index===0&&!e.expand),searchKeys:f}}_getData(){const{data:e={},search:t,active:s}=this.state,{tabs:n=[{name:"other"}],expandName:r}=e;let{data:o=[]}=e;Array.isArray(o)&&(o={other:o});const a={},l=v.unique(t.toLowerCase().split(" ").filter(f=>f.length));let c,h;Object.keys(o).forEach(f=>{const m=r===f,y=n.find(E=>E.name===f)||{name:f},b=o[f]||[],w=(s===f||y.active&&s===void 0)&&!m,[x,D]=Sy(b,l),I={name:f,items:x,text:y.text,active:w,count:D,index:0,expand:m};m?c=I:(a[f]=I,w&&(h=I))});const d=n.reduce((f,{name:m})=>{if(m!==r){const y=a[m]||{name:m,items:[]};y.index=f.length,f.push(y)}return f},[]);return!h&&d.length&&(h=d[0]),{tabs:d,expandData:c,activeTab:h}}_renderList(e,t,s){const n=t.name,{expanded:r,data:o={},search:a}=this.state;let{hideSingleTab:l=!0}=o;return l=e.length===1&&l,g(cn,null,l?null:g("div",{className:"dropmenu-nav"},g("ul",{key:"nav",className:"nav nav-secondary"},e.map(({name:c,text:h,count:d})=>g("li",{className:"nav-item"},g("a",{className:`${n===c?" active":""}`,onClick:this.activeTab.bind(this,c)},h||c,d?g("span",{className:"label gray-pale rounded-full size-sm font-normal"},d):null))))),g("div",{key:"tab",className:"flex-auto dropmenu-list scrollbar-hover"},g(ky,{key:`${n}${a!=null&&a.length?"-search":""}`,...this._getTreeProps(t)})),s?g("div",{key:"foot",className:"dropmenu-foot flex-none toolbar justify-between border-t"},o.footToolbar?Be.render(o.footToolbar,[]):g("div",{className:"flex-auto"}),g(we,{type:"ghost text-dark rounded gap-0.5 px-1.5",trailingIcon:`angle-${this.state.expanded?"left":"right"} opacity-60`,onClick:this._handleExpandBtnClick},s.text||s.name," ",s.count&&r?g("span",{className:"ml-1 label gray-pale rounded-full size-sm font-normal"},s.count):null)):null)}_renderExpand(e){const{search:t}=this.state;return g("div",{className:"col w-1/2 dropmenu-list scrollbar-hover"},g(ky,{key:`${e.name}${t!=null&&t.length?"-search":""}`,...this._getTreeProps(e)}))}_renderPop(){const{expanded:e,data:t={}}=this.state,{searchHint:s,search:n=!0,title:r}=t,{expandData:o,tabs:a,activeTab:l}=this._getData(),c=e&&o;return g(cn,null,n&&this.props.searchBox!==!1?g("div",{key:"search",className:"p-3 flex-none"},g(mn,{ref:this._searchbox,className:"size-md",placeholder:s,onChange:this._handleSearch})):null,r?g("div",{className:"dropmenu-title"},r):null,g("div",{class:"row flex-auto min-h-0",ref:this._list},g("div",{class:`col w-${c?"1/2":"full"}`},this._renderList(a,l,o)),c?g("div",{class:"w-px bg-gray opacity-10"}):null,e&&o&&this._renderExpand(o)))}_getClass(e){const{expanded:t,loading:s,data:n={}}=this.state;return K("dropmenu load-indicator col",super._getClass(e),t&&"is-expanded",s&&"loading",n.search!==!1&&"has-search",n.title?"has-title":"")}_getStyle(e={},t){e=super._getStyle(e,t);const{width:s=248}=this.props;return typeof s=="number"&&(e.width=s*(this.state.expanded?2:1)),e}_getProps(e){const{style:t,...s}=super._getProps(e),n=this.trigger,r=n==null?void 0:n.getBoundingClientRect();return{...s,style:{...t,...this._getStyle(),maxHeight:r?Math.max(r.top-8,window.innerHeight-r.bottom-8):t.maxHeight}}}}class $y extends Ia{_getProps(e){const t=super._getProps(e);return{type:"button","data-value":e.state.value,...t}}_renderTrigger(e){const{text:t,state:s,children:n,caret:r,leadingAngle:o,display:a}=e;let l=s.text??t??"";return a&&(l=typeof a=="function"?a.call(this,l,s):a),[o&&g(Ie,{icon:"angle-right",className:"is-leading"}),g("span",{key:"text",className:"text",title:typeof l=="string"?l:void 0},l??n),r&&g("div",{key:"caret",class:"is-caret"},g("span",{className:"caret"}))]}}let Gi=class extends at{constructor(){super(...arguments),this._setCacheData=e=>{const{cache:t}=this.props;t&&(this._cacheData=e,typeof t=="number"&&(this._cacheTimer&&clearTimeout(this._cacheTimer),this._cacheTimer=window.setTimeout(()=>{this._cacheData=void 0,this._cacheTimer=0},t)))}}getDefaultState(e){return{...super.getDefaultState(e),text:void 0}}componentWillUnmount(){super.componentWillUnmount(),this._cacheTimer&&clearTimeout(this._cacheTimer)}componentWillReceiveProps(e){(this.props.data!==e.data||this.props.fetcher!==e.fetcher)&&(this._cacheData=void 0)}_getTriggerProps(e,t){const{className:s,...n}=super._getTriggerProps(e,t),{value:r=""}=t;return{...n,className:K(s,{"has-value":r.length}),text:e.text,caret:e.caret,maxWidth:e.maxWidth,leadingAngle:e.leadingAngle,display:e.display}}_getPopProps(e,t){return{...super._getPopProps(e,t),data:this._cacheData||e.data,fetcher:e.fetcher,cache:!!e.cache,onCacheData:this._setCacheData,onClickItem:e.onClickItem}}};Gi.defaultProps={...at.defaultProps,popWidth:248,popMaxHeight:800,maxWidth:160,className:"dropmenu-btn btn ghost",tagName:"button",clickType:"toggle",leadingAngle:!0,caret:!0,cache:60*1e3*4},Gi.Pop=Ty,Gi.Trigger=$y;class Lx extends ae{constructor(){super(...arguments),this._handleClickItem=(e,t)=>{var s,n;e.target.closest(".dropmenu-nav")||e.target.closest(".dropmenu-foot")||(n=(s=this.props).onSelect)==null||n.call(s,+t,!0)},this._renderCurrent=()=>{const{space:e}=this.props;return g("div",{class:"row items-center relative gap-2"},g("div",{className:"text-md row items-center flex-auto min-w-0 overflow-hidden"},e==null?void 0:e.name),g(we,{icon:"exchange",type:"gray-pale",className:"doc-path-picker-toggle"}))},this._handleClick=e=>{var t,s,n;!this.props.noClickTrigger&&!e.target.closest(".doc-path-picker-toggle")&&((n=(s=this.props).onSelect)==null||n.call(s,((t=this.props.space)==null?void 0:t.id)||0,!0),e.preventDefault())}}render(e){const{space:t,fetcher:s,menuOptions:n,display:r}=e;return g(Gi,{text:t==null?void 0:t.name,defaultValue:t==null?void 0:t.id.toString(),onClickItem:this._handleClickItem,fetcher:s,leadingAngle:!1,caret:!1,display:r??this._renderCurrent,onClick:this._handleClick,...n})}}class Dy extends ae{constructor(){super(...arguments),this._picker=ye(),this._getItems=()=>{const{spaces:e=[],spaceIcon:t}=this.props;return e.map(s=>({id:s.id,icon:t,text:s.name,value:s.id,className:"group"}))},this._renderCurrent=()=>{const{space:e}=this.props;return g("div",{class:"row items-center relative gap-2"},g("div",{className:"text-md row items-center flex-auto min-w-0 overflow-hidden"},e==null?void 0:e.name),g(we,{icon:"exchange",type:"gray-pale",className:"doc-path-picker-toggle"}))},this._handleClick=e=>{var t,s,n;!this.props.noClickTrigger&&!e.target.closest(".doc-path-picker-toggle,.doc-space-picker-toggle")&&((n=(s=this.props).onSelect)==null||n.call(s,((t=this.props.space)==null?void 0:t.id)||0,!0),e.preventDefault())},this._handleItemClick=e=>{var n,r;const t=this._picker.current;if(!t)return;const s=e.item.value;(r=(n=this.props).onSelect)==null||r.call(n,s,!0),t.select(s),t.close()}}render(e){const{getSpaceFetcher:t,spaceID:s,space:n,spaceType:r,onSelect:o,menuOptions:a}=e;if(t){const f=t(r,s);if(f)return g(Lx,{fetcher:f,space:n,onSelect:o,menuOptions:a})}const{spaces:l=[],searchBox:c=!0}=e,h=n||l[0],d={searchBox:c,search:void 0,onClickItem:this._handleItemClick};return g(Gt,{ref:this._picker,className:"doc-space-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-space-picker-menu",style:{maxWidth:160},items:this._getItems,defaultValue:h?String(h.id):"",required:!0,search:!1,cache:!1,caretClass:"hidden",menu:d,popMinWidth:200,display:this._renderCurrent,onClick:this._handleClick})}}Dy.defaultProps={noClickTrigger:!1};class so extends ae{constructor(){super(...arguments),this._picker=ye(),this._getItems=()=>{const{items:e=[],icon:t,apiIcon:s,chapterIcon:n,current:r,getItems:o}=this.props,a=e.filter(l=>!l.data.deleted).map(l=>({id:l.data.id,icon:l.type==="lib"&&l.data.type==="api"?s:l.type==="doc"&&l.data.type==="chapter"?n:t,text:this._getItemText(l),value:l.data.id,selected:(r==null?void 0:r.key)===l.key}));return o?o(a):a},this._renderCurrent=()=>{const{current:e,placeholder:t,icon:s,showIcon:n,type:r,suffixIcon:o,children:a}=this.props,l=r==="lib";return g("div",{class:K("row items-center relative",l?"gap-2":"gap-1")},n?g(Ie,{icon:s,className:K("transition-opacity group-hover:opacity-0 w-5 h-5 center",l?"rounded-lg primary-pale flex-none":r==="doc"?"text-special":"text-warning","")}):null,g("div",{className:K("row items-center flex-auto min-w-0 overflow-hidden",l?"text-md":"",e?"":"text-gray")},e?this._getItemText(e):t),a,g(we,{icon:"exchange",type:"gray-pale",className:"doc-path-picker-toggle"}),o?g(Ie,{icon:o}):null)},this._handleClick=e=>{var t,s,n;!this.props.noClickTrigger&&!e.target.closest(".doc-path-picker-toggle")&&((n=(s=this.props).onSelect)==null||n.call(s,((t=this.props.current)==null?void 0:t.data.id)||0,this.props.type),e.preventDefault())},this._handleItemClick=e=>{var n,r;const t=this._picker.current;if(!t)return;const s=e.item.value;(r=(n=this.props).onSelect)==null||r.call(n,si(s),e.item.dataType),t.select(s),t.close()}}_getItemText(e){return e?e.type==="doc"?e.data.title:e.data.name:""}render(e){const{current:t,type:s,maxWidth:n,display:r,searchBox:o=!0}=e,a={searchBox:o,search:void 0,onClickItem:this._handleItemClick};return g(Gt,{ref:this._picker,className:"doc-path-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-path-picker-menu",style:{maxWidth:n},items:this._getItems,defaultValue:t?String(t.data.id):"",search:!1,cache:!1,caretClass:"hidden",menu:a,popMinWidth:200,required:s!=="lib",display:r??this._renderCurrent,onClick:this._handleClick})}}so.defaultProps={type:"module",maxWidth:160,noClickTrigger:!1,showIcon:!1};function Iy({pri:i="",text:e,className:t}){return i=`${i}`.trim(),e===void 0&&(e=i==="0"||i===""?"":i),g("span",{className:K(`pri-${i}`,t)},e)}let no=class extends at{constructor(){super(...arguments),this._handleClearBtnClick=e=>{this.setValue(""),e.preventDefault()}}getDefaultState(e){const t=super.getDefaultState(e);if(t.value===void 0&&(e||this.props).required){const s=this._getItems().shift();s&&(t.value=s.value)}return t}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return e.disabled&&(s.className=K(s.className,"disabled")),s}_renderTrigger(e,t){var l;const{value:s}=t,{placeholder:n,required:r}=e,o=s===void 0||s==="",a=!o&&!r;return[g("div",{className:"text"},o?g("span",{class:"placeholder"},n):this._renderItem(t.value,(l=this._getItems().find(({value:c})=>c===s))==null?void 0:l.text,"pri")),a?g(we,{type:"button",class:"btn square btn-close size-xs ghost rounded-full",onClick:this._handleClearBtnClick},g("span",{class:"close"})):null,a?null:g("span",{key:"caret",class:"caret"})]}_getItems(){let{items:e=["",1,2,3,4]}=this.props;return Array.isArray(e)?e=e.map((t,s)=>typeof t=="object"?t:t?{text:`${t}`,value:`${s}`}:{text:"",value:""}):typeof e=="object"&&(e=Object.keys(e).map(t=>({value:t,text:e[t]}))),e=e.filter(({value:t})=>t!==""),e.sort((t,s)=>+t.value-+s.value),e}_renderItem(e,t,s){return g(Iy,{key:s,pri:e,text:t})}_renderPop(){const{value:e}=this.state;return g("div",{className:"pick-pri-list"},this._getItems().map(({value:t,text:s})=>g("button",{key:t,type:"button",class:`btn w-full ${e===t?"primary-pale":"ghost"}`,"data-pick-value":t},this._renderItem(t,s))))}};no.defaultProps={...at.defaultProps,items:["",1,2,3,4],className:"pick-pri form-control",popClass:"pick-pri-pop popup",popWidth:"auto",popMinWidth:56};let Yd=class extends at{constructor(){super(...arguments),this.enterDiffMode=e=>{var t,s;e.stopPropagation(),(s=(t=this.props).onModeChange)==null||s.call(t,!0),this.setState({diffMode:!0,diffVersions:[]})},this.confirmToDiff=()=>{var s,n;const{diffVersions:e}=this.state,t=[...e];t.length===2&&(t.sort((r,o)=>r-o),this.setState({diffVersions:t}),(n=(s=this.props).onDiff)==null||n.call(s,[t[0],t[1]])),this.close()},this.switchDiff=e=>{e.preventDefault(),this.close(),this.setState(t=>{var r,o;const[s,n]=t.diffVersions;return!s||!n?null:((o=(r=this.props).onDiff)==null||o.call(r,[n,s]),{diffVersions:[n,s]})})},this.cancelDiff=e=>{e.stopPropagation(),e.preventDefault(),this.setState(t=>{var n,r,o,a;const{version:s}=t;return(r=(n=this.props).onCancelDiff)==null||r.call(n,s),(a=(o=this.props).onModeChange)==null||a.call(o,!1),{diffMode:!1,diffVersions:[]}})},this.itemOnClick=e=>{this.setState(t=>{var o,a;const{version:s,diffMode:n,diffVersions:r}=t;if(n){let l=[];if(r.includes(e))l=r.filter(c=>c!==e);else if(r.length<2)l=[...r,e];else return null;return{diffVersions:l}}else return s===e?null:((a=(o=this.props).onVersionChange)==null||a.call(o,e,s),this.close(),{version:e,diffVersions:[]})})},this.checkboxOnClick=(e,t)=>{e.stopPropagation(),this.itemOnClick(t)}}getDefaultState(e){const t=super.getDefaultState(e);t.diffMode=(e==null?void 0:e.diffMode)??!1,t.diffVersions=[];const s=(e==null?void 0:e.latestVersion)??1;t.version=(e==null?void 0:e.version)??(e==null?void 0:e.defaultVersion)??s;const n=[];for(let r=0;r<s;r++)n.unshift(r+1);return t.options=n,t}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return e.disabled&&(s.className=K(s.className,"disabled")),s}componentDidUpdate(){const{diffMode:e,version:t}=this.props;!e&&this.state.diffMode&&this.setState({diffMode:!1}),t!==this.state.version&&this.setState({version:t})}_renderTrigger(){const{version:e,diffMode:t,diffVersions:s}=this.state;return t?g("div",{className:"diff-picker-trigger"},g("button",{className:"btn gray-pale"},g("span",null,s[0]?`#${s[0]}`:""),g("i",{className:"icon icon-angle-down"})),g("button",{className:"btn ghost switch-diff",onClick:n=>this.switchDiff(n)},g("i",{className:"icon icon-exchange"})),g("button",{className:"btn gray-pale"},g("span",null,s[1]?`#${s[1]}`:""),g("i",{className:"icon icon-angle-down"}))):[g("button",{className:"btn gray-pale"},g("span",null,e?`#${e}`:""),g("i",{className:"icon icon-angle-down"}))]}_renderItem(e){const{version:t,diffMode:s,diffVersions:n}=this.state;return g("li",{className:"menu-item",key:e},g("a",{className:`listitem item-inner ${e===t&&!s?"selected checked":""} ${!n.includes(e)&&n.length>=2?"disabled":""}`,onClick:()=>this.itemOnClick(e)},s&&g("input",{type:"checkbox",checked:n.includes(e),onClick:r=>this.checkboxOnClick(r,e)}),g("div",{className:"item-content"},g("div",{className:"item-title"},"#",e))))}_renderPop(){const{labelAllVersions:e,labelDiff:t,labelConfirm:s,labelCancelDiff:n,diffEnabled:r}=this.props,{options:o,diffMode:a,diffVersions:l}=this.state,c=l.length===2&&l.every(h=>!!h);return g("div",{className:"diff-pop"},r&&g("div",{className:"diff-pop-header"},g("span",{class:"text-gray"},e),!a&&o.length>1&&g("button",{className:"btn text-primary size-sm ghost",onClick:h=>this.enterDiffMode(h)},g("i",{className:"icon icon-exchange"}),g("span",{className:"text"},t))),g("menu",{className:"menu"},o.map(h=>this._renderItem(h))),a&&g("div",{className:"diff-pop-footer"},g("button",{className:"btn primary size-sm",disabled:!c,onClick:()=>this.confirmToDiff()},s),g("button",{className:"btn size-sm",onClick:h=>this.cancelDiff(h)},n)))}};Yd.defaultProps={popContainer:"body",popClass:"pick-diff-pop popup",popWidth:"auto",popPlacement:"auto",popMinWidth:56,popMinHeight:32,popMaxHeight:300,limitPopInScreen:!0,clickType:"open",className:"pick-diff form-control",latestVersion:1,labelAllVersions:"全部版本",labelDiff:"对比",labelConfirm:"确定",labelCancelDiff:"取消对比",diffEnabled:!1};function My({severity:i="",text:e,className:t}){i=`${i}`.trim(),e===void 0&&(e=i==="0"||i===""?"":i);const s=`${+e}`!=`${i}`;return g("span",{className:K(`severity${s?" severity-label":""}`,t),"data-severity":i},s?e:"")}let Jd=class extends no{_renderItem(e,t,s){return g(My,{key:s,severity:e,text:t})}};Jd.defaultProps={...no.defaultProps,items:["",1,2,3,4]};let Ny=class extends at{constructor(){super(...arguments),this._handleClick=e=>{const t=v(e.target).closest(".pick-range-list-item").data("value");typeof t=="number"&&(this._clickedStart===void 0?(this._clickedStart=t,this.setRange(t)):(this.setRange(this._clickedStart,t),this._clickedStart=void 0,this.close()))},this._handleMouseMove=e=>{if(this._clickedStart===void 0)return;const t=v(e.target).closest(".pick-range-list-item").data("value");typeof t=="number"&&this.setRange(this._clickedStart,t)},this._handleClearBtnClick=e=>{this.setValue(""),e.preventDefault()}}get range(){const{value:e}=this.state;if(e===void 0||e==="")return;const[t,s]=e.split(this.props.valueSplitter??",");return[+t,+(s??t)]}setRange(e,t){return this.setValue([e,t??e].sort((s,n)=>s-n).join(this.props.valueSplitter))}_getTriggerProps(e,t){const s=super._getTriggerProps(e,t);return e.disabled&&(s.className=K(s.className,"disabled")),s}_renderTrigger(e,t){const{value:s}=t,{placeholder:n,display:r,name:o,fromName:a,toName:l}=e,{range:c}=this,h=!c,d=!h;let f=s;return c&&r&&(typeof r=="string"?f=$e(r,...c):f=r.call(this,c)),[g("div",{className:"text"},h?g("span",{class:"placeholder"},n):f),d?g(we,{type:"button",class:"btn square btn-close size-xs ghost rounded-full",onClick:this._handleClearBtnClick},g("span",{class:"close"})):null,d?null:g("span",{key:"caret",class:"caret"}),a?g("input",{type:"hidden",name:a,value:c?c[0]:""}):null,l?g("input",{type:"hidden",name:l,value:c?c[1]:""}):null,o?g("input",{type:"hidden",name:o,value:s}):null]}_renderPop(){const{range:e}=this,{start:t=1,end:s=100,formatText:n,colCount:r=2,colSize:o=5}=this.props,a=[],l=s-t+1,c=r*o,h=Math.ceil(l/c),[d,f]=e||[];for(let m=0;m<h;++m){const y=[];for(let b=0;b<c;++b){const w=t+m*c+b;let x=w+"";typeof n=="string"?x=$e(n,{from:d,to:f,current:w}):n&&(x=n.call(this,w,e)),y.push(g("div",{key:b,"data-value":w,className:K("pick-range-list-item state",{"is-col-end":b>0&&(b+1)%o===0&&b<c-1,"is-from":e&&w===d,"is-to":e&&w===f,"is-in":e&&w>d&&w<f,"has-small-text":w>=1e3})},g("div",{className:"text"},x)))}a.push(g("div",{key:m,className:"pick-range-list-row"},y))}return g("div",{className:"pick-range-list scrollbar-hover",onClick:this._handleClick,onMouseOver:this._handleMouseMove},a)}};Ny.defaultProps={...at.defaultProps,className:"pick-range form-control",popClass:"pick-range-pop popup",popWidth:"auto",popMinWidth:120,display:"{0} ~ {1}",valueSplitter:",",start:1,end:100,colCount:2,colSize:5};class Rx extends ae{constructor(){super(...arguments),this._handleSelectModule=e=>{var t,s;(s=(t=this.props).onSelectModule)==null||s.call(t,+e,!0)},this._handleSelectLib=(e,t)=>{var s,n;t==="files"?this.props.app.showFiles():(n=(s=this.props).onSelectLib)==null||n.call(s,+e,0)},this._unselectLib=()=>{var e,t;(t=(e=this.props).onSelectLib)==null||t.call(e,0,0)},this._handleSelectVersion=e=>{var t,s;(s=(t=this.props).onSelectDocVersion)==null||s.call(t,e)},this._handleDiffVersions=e=>{var t,s;(s=(t=this.props).onDiffDocVersions)==null||s.call(t,e)},this._handleDiffModeChange=e=>{var t,s;(s=(t=this.props).onDiffModeChange)==null||s.call(t,e)},this._handleRestoreDocVersion=async()=>{const{app:e,doc:t}=this.props,{version:s=1,id:n}=t==null?void 0:t.data,r=this.props.docVersion||s;await Ve.confirm({title:e.getLang("restoreVersionHint","恢复到版本")+` #${r}`,message:e.getLang("restoreVersionConfirm",[{version:r}],"这将使用文档版本 #{version} 的内容创建一个新的版本，确定要继续吗？")})&&e.restoreDoc(n,r)},this._getLibItems=e=>{const{app:t,libIcon:s,showFiles:n}=this.props;return t.canShowLibFiles?[...e,{text:t.getLang("filesLib","附件库"),icon:s,key:"files",dataType:"files",selected:!!n,disabled:!1}]:e}}_renderAngle(e){return g("div",{key:e,class:"doc-path-picker-angle chevron-right scale-75 opacity-75 flex-none"})}_renderModulePickers(e){const{module:t}=e;if(!t||!t.data.id)return[];let s=t;const n=[];for(;s;){const{parent:o}=s;if(n.push(s),o.type!=="module")break;s=o}const r=[];return n.reverse().forEach((o,a)=>{if(n.length>=2&&a>=0&&a<n.length-1){a===0&&r.push(["module-ellipsis",g("div",{key:"module-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},g("div",{className:"more"}))]);return}if(a===n.length-1){const{key:l}=o;r.push([`${l}-angle`,g(so,{key:l,icon:e.moduleIcon,current:o,items:o.parent.modules,searchBox:{placeholder:this.props.app.getLang("searchModulePlaceholder","searchModulePlaceholder")},onSelect:this._handleSelectModule})])}}),r}_renderParents(e){var c,h;const{doc:t,app:s,docIcon:n,onSelectDoc:r}=e;if(!t||((c=t.parent)==null?void 0:c.type)!=="doc")return[];let o=t.parent;const a=[];for(;o&&(a.push(o),((h=o.parent)==null?void 0:h.type)==="doc");)o=o.parent;const l=[];return a.reverse().forEach((d,f)=>{var y;if(a.length>=3&&f>0&&f<a.length-1){f===1&&l.push(["parent-ellipsis",g("div",{key:"parent-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},g("div",{className:"more"}))]);return}const{key:m}=d;l.push([`${m}-angle`,g(so,{key:m,type:"doc",icon:n,chapterIcon:s.props.chapterIcon,current:d,items:(y=d.parent)==null?void 0:y.docs,searchBox:{placeholder:s.getLang("searchPlaceholder","搜索")},onSelect:r,maxWidth:160})])}),l}_renderCurrent(e){var l,c;const{doc:t,docIcon:s,onSelectDoc:n,app:r}=e,[o,a]=r.viewInfo;if(a&&(o==="create"||o==="edit"))return g(we,{key:"doc",type:"ghost",icon:s,className:"mr-4 min-w-0 justify-start"},g("span",{className:"text-gray min-w-0 overflow-hidden"},a.title),g("span",{className:"label size-sm rounded-full primary-pale flex-none"},o==="create"?r.getLang("newDocLabel","新文档"):r.getLang("editingDocLabel","编辑中")));if(t){const{version:h=1,privs:d={},id:f}=t.data,m=r.signals.docVersion.value||h,y=e.docVersion||h,b=!t.data.deleted&&!t.data.api&&h>1&&y!==h&&(((l=r.props.privs)==null?void 0:l.restoreDoc)??d.edit!==!1),w=r.isLoadingDoc(f),{spaceID:x,libID:D,moduleID:I}=r.props,E=[x,D,I,f,h].join("-"),P=r.signals.diffMode.value||!1;return[e.noDocSwitcher?g("div",{className:"doc-app-nav-doc-title px-2"},t.data.title):g(so,{key:"doc",type:"doc",icon:s,chapterIcon:r.props.chapterIcon,current:t,items:(c=t.parent)==null?void 0:c.docs,onSelect:n,searchBox:{placeholder:r.getLang("searchPlaceholder","搜索")},maxWidth:160,suffixIcon:a&&o==="edit"?"draft-edit":void 0}),h>1?g("div",{key:"version",className:"hint mx-1","data-hint":r.getLang("currentDocVersionHint","当前版本，点击切换")},g(Yd,{key:E,labelAllVersions:r.getLang("labelAllVersions","全部版本"),labelDiff:r.getLang("labelDiff","对比"),labelConfirm:r.getLang("labelConfirm","确定"),labelCancelDiff:r.getLang("labelCancelDiff","取消对比"),latestVersion:h,version:m,diffEnabled:r.props.diffEnabled&&!t.data.api,diffMode:P,onVersionChange:O=>{this._handleSelectVersion(O)},onDiff:O=>{this._handleDiffVersions(O)},onCancelDiff:O=>{this._handleSelectVersion(O)},onModeChange:O=>{this._handleDiffModeChange(O)}})):null,b&&!P?g("div",{key:"restoreVersion","data-hint":`${r.getLang("restoreVersionHint","恢复到版本")} #${y}`,className:"hint ml-1"},g(we,{disabled:w,text:r.getLang("restoreVersion","恢复"),type:"ghost text-primary",size:"sm",rounded:"full",onClick:this._handleRestoreDocVersion})):null,t.data.status==="draft"?g("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},r.getLang("draft","草稿")):null]}return null}_renderLibPicker(e){const{lib:t,libs:s,libIcon:n,apiLibIcon:r,libPlaceholder:o,showFiles:a,app:l}=e;return(!t||!t.data.id)&&!a?null:g(so,{key:"lib",type:"lib",icon:n,apiIcon:r,current:t,items:s,getItems:this._getLibItems,display:a?()=>g("div",{class:"row items-center gap-2"},g("div",{class:"text-md"},l.getLang("filesLib","附件库")),g("span",{className:"caret"})):void 0,placeholder:o,searchBox:{placeholder:l.getLang("searchLibPlaceholder","搜索库")},onSelect:this._handleSelectLib})}render(e){const{spaceIcon:t,space:s,spaces:n,onSelectSpace:r,children:o,homeName:a,noSpace:l,getSpaceFetcher:c,spaceID:h,spaceType:d,app:f}=e;let m;if(l)m=l==="hidden"?null:g(we,{icon:s?t:"home",type:"ghost",iconClass:"w-4 h-4 center rounded-md primary flex-none",textClass:"text-md",text:s==null?void 0:s.name,onClick:this._unselectLib});else if(s){let E=f.props.spaceMenuOptions;typeof E=="function"&&(E=E.call(f,d,h)),m=g(Dy,{key:"space",spaceIcon:t,space:s,spaces:n,searchBox:{placeholder:f.getLang("searchSpacePlaceholder","搜索空间")},onSelect:r,getSpaceFetcher:c,spaceType:d,spaceID:h,menuOptions:E})}const y=this._renderLibPicker(e),b=this._renderModulePickers(e),w=this._renderParents(e),x=this._renderCurrent(e);let D=[];a!==!1&&D.push(["home",g(we,{key:"home-btn",icon:"home",size:"md",type:"ghost text-primary",hint:typeof a=="string"?a:void 0,command:"goHome",...typeof a=="object"?a:{}})]),D.push(["space",m]),y&&D.push(["lib",y]),b&&D.push(...b),w&&D.push(...w),x&&D.push(["current",x]);const I=f.getCustomRender("app-nav");return I&&(D=I.call(f,D,this)||D),g("div",{className:"doc-app-nav row items-center flex-auto min-w-0"},D.reduce((E,[P,O],W)=>(O==null||((Array.isArray(O)?O:[O]).forEach(Y=>{typeof Y=="object"&&Y&&"html"in Y?E.push(g(Ds,{html:Y.html})):E.push(Y)}),W<D.length-1&&E.push(this._renderAngle(P+"-angle"))),E),[]),o)}}function Xd(){var i;return(i=window.frameElement)==null?void 0:i.closest("affine-zui-iframe")}function Qd(){const i=Xd();if(!i)return;const e=i.getAttribute("data-block-id"),t=i.closest("editor-host");if(!(!t||!e))return t.std.doc.getBlock(e)}function zx(){const i=Qd();i&&i.doc.deleteBlock(i.model)}function Fx(i){const e=Qd();e&&e.doc.updateBlock(e.model,i)}function Ox(){var i;return(i=Xd())==null?void 0:i.adjustHeight()}const jx={getElement:Xd,get:Qd,delete:zx,update:Fx,adjustHeight:Ox};function Ey(i,e){return i.reduce((t,s,n)=>{var o;let r=s;return(o=r.children)!=null&&o.length&&(r={...s,children:Ey(s.children,e)}),e(t,r,n)},[])}let Ay=class extends ae{constructor(){super(...arguments),this._toolbarState={bold:!1,italic:!1,underline:!1,strikethrough:!1,bulleted:!1,numbered:!1,fontSize:"text",color:"",background:""},this.colorPickerRef=null,this.colorPicker=null,this.bgColorPickerRef=null,this.bgColorPicker=null,this.formatButtons=[{key:"bold",icon:"format-bold",command:"toggleBold",hint:"加粗"},{key:"italic",icon:"format-italic",command:"toggleItalic",hint:"斜体"},{key:"underline",icon:"format-underline",command:"toggleUnderline",hint:"下划线"},{key:"strikethrough",icon:"format-strike",command:"toggleStrike",hint:"删除线"}],this.listButtons=[{key:"bulleted",icon:"format-list-bulleted",slashName:"Bulleted List",hint:"无序列表"},{key:"numbered",icon:"format-list-numbers",slashName:"Numbered List",hint:"有序列表",iconClass:"text-lg"}],this.otherButtons=[{key:"todo",icon:"checkbox",slashName:"To-do List",hint:"待办事项"},{key:"link",icon:"text-link",command:"toggleLink",hint:"链接",iconClass:"text-lg"},{key:"image",icon:"image",slashName:"Image",hint:"插入图片"},{key:"file",icon:"file",slashName:"Attachment",hint:"上传附件"}],this.basicButtons=[{key:"code",icon:"code-block",slashName:"Code Block",hint:"代码块"},{key:"quote",icon:"icon-quote",slashName:"Quote",hint:"引用"},{key:"divider",icon:"add-divider",slashName:"Divider",hint:"分割线"},{key:"inLineEquation",icon:"sigma",slashName:"Inline equation",hint:"内嵌公式"},{key:"equation",icon:"sigma-box",slashName:"Equation",hint:"公式"},{key:"simpleTable",icon:"table",slashName:"简单表格",hint:"简单表格"}],this.databaseButtons=[{key:"table",icon:"data-table",slashName:"Table View",hint:"表格视图"},{key:"kanban",icon:"kanban-box",slashName:"Kanban View",hint:"看板视图"}],this.colorList=[{key:"default",value:"#30394A"},{key:"red",value:"#C62222"},{key:"orange",value:"#D34F0B"},{key:"yellow",value:"#B67C04"},{key:"green",value:"#149343"},{key:"teal",value:"#0782A0"},{key:"blue",value:"#2159D3"},{key:"purple",value:"#842ED3"},{key:"grey",value:"#7A7A7A"}],this.fontSizeItems=[{text:"文本",value:"text",slashName:"Text"},{text:"标题 1",value:"h1",slashName:"Heading 1"},{text:"标题 2",value:"h2",slashName:"Heading 2"},{text:"标题 3",value:"h3",slashName:"Heading 3"},{text:"标题 4",value:"h4",slashName:"Heading 4"},{text:"标题 5",value:"h5",slashName:"Heading 5"},{text:"标题 6",value:"h6",slashName:"Heading 6"}],this.fullscreen$=pe(!1),this.syncSelectionRange=()=>{var t;const e=this.checkEditor(!0);e&&e.selection.std.range.syncTextSelectionToRange((t=e.selection.value)==null?void 0:t[0])},this.checkEditor=e=>{var s;const{editor:t}=this.props;if(t)try{const n=t.editor;if(!n)return;const r=n.host;return!r||e&&!((s=r.selection.value)!=null&&s.length)?void 0:r}catch{return}},this.handleColorChange=e=>{var r;const t=this.checkEditor(!0);if(!t||(((r=this.getColor("color"))==null?void 0:r.value)||"")===e)return;const n=this.colorList.find(o=>o.value===e);t.selection.std.command.exec("formatText",{textSelection:t.selection.value[0],styles:{color:`var(--affine-text-highlight-foreground-${n==null?void 0:n.key})`}}),this.updateToolbarState()},this.handleBackgroundChange=e=>{var r;const t=this.checkEditor(!0);if(!t||(((r=this.getColor("background"))==null?void 0:r.value)||"")===e)return;const n=this.colorList.find(o=>o.value===e);t.selection.std.command.exec("formatText",{textSelection:t.selection.value[0],styles:{background:`var(--affine-text-highlight-${n==null?void 0:n.key})`}}),this.updateToolbarState()},this.handleFormat=e=>{var s,n;const t=this.checkEditor();if(t){if(e=="toggleLink"){(n=(s=t.selection.value[0])==null?void 0:s.from)!=null&&n.length?t.selection.std.command.exec(e):this.callSlashMenuAction("Link");return}t.selection.std.command.exec(e),this.updateToolbarState()}},this.callSlashMenuAction=e=>{var t;return(t=this.props.editor)==null?void 0:t.callSlashMenuAction(e)},this.renderButton=e=>{const{key:t,icon:s,command:n,hint:r,slashName:o,iconClass:a}=e,l=this._toolbarState[t];return g(we,{key:t,className:K("ghost",l?"text-primary":""),icon:s,iconClass:a,hint:r,onClick:()=>{o?this.callSlashMenuAction(o):n&&this.handleFormat(n)}})},this._toggleFullscreen=()=>{var e;Yo({target:this.props.fullscreenTarget||((e=this.props.editor)==null?void 0:e.element),afterEnter:()=>{v("body").addClass("is-editor-fullscreen"),this.fullscreen$.value=!0},afterExit:()=>{v("body").removeClass("is-editor-fullscreen"),this.fullscreen$.value=!1}})}}componentDidMount(){this.initColorPicker(),this.initSelectionListener()}componentDidUpdate(e){e.editor!==this.props.editor&&this.initSelectionListener()}componentWillUnmount(){this.colorPicker&&this.colorPicker.destroy(),this.bgColorPicker&&this.bgColorPicker.destroy(),this.removeSelectionListener()}async ensureEditor(){await Ss(500);const{editor:e}=this.props;return e?await e.ensureEditor():null}initColorPicker(){this.colorPickerRef&&(this.colorPicker=new _n(this.colorPickerRef,{className:"btn ghost px-2",icon:"icon-text-color",hint:"文字颜色",colors:["#30394A","#C62222","#D34F0B","#B67C04","#149343","#0782A0","#2159D3","#842ED3","#7A7A7A"],onChange:e=>this.handleColorChange(e),onClick:()=>this.syncSelectionRange()})),this.bgColorPickerRef&&(this.bgColorPicker=new _n(this.bgColorPickerRef,{className:"btn ghost px-2",icon:"pencil-alt",hint:"文字背景颜色",colors:["#C62222","#D34F0B","#B67C04","#149343","#0782A0","#2159D3","#842ED3","#7A7A7A"],onChange:e=>this.handleBackgroundChange(e),onClick:()=>this.syncSelectionRange()}))}initSelectionListener(){this.ensureEditor().then(e=>{if(!e)return;const t=e.host;t==null||t.selection.slots.changed.on(()=>{this.updateToolbarState()})})}getColor(e){const t=this._toolbarState[e],s=e=="color"?/var\(--affine-text-highlight-foreground-(.*?)\)/:/var\(--affine-text-highlight-(.*?)\)/,n=t==null?void 0:t.match(s),r=n?n[1]:"";return this.colorList.find(o=>o.key===r)}updataColorPicker(){var e,t;if(this.colorPicker){const s=this.getColor("color");(e=this.colorPicker.$)==null||e.changeState({value:(s==null?void 0:s.value)||""})}if(this.bgColorPicker){const s=this.getColor("background");(t=this.bgColorPicker.$)==null||t.changeState({value:(s==null?void 0:s.value)||""})}}removeSelectionListener(){const e=this.checkEditor();e==null||e.selection.slots.changed.dispose()}updateToolbarState(){const e=this.checkEditor();if(!e){this._toolbarState={bold:!1,italic:!1,underline:!1,strikethrough:!1,bulleted:!1,numbered:!1,fontSize:"text",color:"",background:""};return}const s=e.selection.std.command.exec("getTextStyle").textStyle,{selectedModels:n}=e.selection.std.command.exec("getSelectedModels"),r=n==null?void 0:n[0],o=(r==null?void 0:r.flavour)==="affine:list",a=o?r==null?void 0:r.type:null,c=(r==null?void 0:r.flavour)==="affine:paragraph"&&["h1","h2","h3","h4","h5","h6"].includes(r==null?void 0:r.type)?r==null?void 0:r.type:"text";this._toolbarState={bold:s.bold||!1,italic:s.italic||!1,underline:s.underline||!1,strikethrough:s.strike||!1,bulleted:o&&a==="bulleted",numbered:o&&a==="numbered",fontSize:c,color:(s==null?void 0:s.color)||"",background:(s==null?void 0:s.background)||""},this.forceUpdate(),this.updataColorPicker()}render(){this.fontSizeItems.forEach(r=>{r.onClick=this.callSlashMenuAction.bind(this,r.slashName)});const e=this._toolbarState.fontSize,t=this.fontSizeItems.filter(r=>r.value==e),{fullscreenTarget:s}=this.props,n=[{key:"two_equal",icon:"columns-2",text:"1:1",onClick:this.callSlashMenuAction.bind(this,"two_equal")},{key:"two_left_sidebar",icon:"columns-4",text:"1:2",onClick:this.callSlashMenuAction.bind(this,"two_left_sidebar")},{key:"two_right_sidebar",icon:"columns-4",text:"2:1",onClick:this.callSlashMenuAction.bind(this,"two_right_sidebar")},{key:"three_equal",icon:"columns-3",text:"1:1:1",onClick:this.callSlashMenuAction.bind(this,"three_equal")}];return g("div",{className:"doc-toolbar flex items-center flex-wrap gap-1 w-full bg-white border-b z-10 p-1",style:"min-height: 40px;"},g(ys,{className:"w-20",type:"ghost",text:t[0].text,trigger:"hover",items:this.fontSizeItems}),g("div",{className:"divider",style:"height: unset; margin-left: -4px;"}),this.formatButtons.map(this.renderButton),g("div",{className:"divider",style:"height: unset;"}),g("div",{ref:r=>this.colorPickerRef=r}),g("div",{ref:r=>this.bgColorPickerRef=r}),g("div",{className:"divider",style:"height: unset;"}),this.listButtons.map(this.renderButton),g("div",{className:"divider",style:"height: unset;"}),this.otherButtons.map(this.renderButton),g("div",{className:"divider",style:"height: unset;"}),this.basicButtons.map(this.renderButton),g(ys,{type:"ghost",icon:"columns-3",trigger:"hover",items:n}),g("div",{className:"divider",style:"height: unset;"}),this.databaseButtons.map(this.renderButton),s?g("div",{className:"flex-auto"}):null,s?g("button",{type:"button",className:"btn ghost square",onClick:this._toggleFullscreen},g("i",{class:`icon icon-${this.fullscreen$.value?"fullscreen-exit":"fullscreen"}`})):null)}};Ay.defaultProps={className:""};class eu extends be{}eu.NAME="EditorToolbar",eu.Component=Ay;const _s=class De extends Ze{constructor(){super(...arguments),this._inputs={},this._lastChangeContent="",this._assetsMap=new Map,this._isEmpty=!0,this._hocuspocusProvider=null,this._zentaoRelations=pe([]),this._blockRelationsMap=xe(()=>this._zentaoRelations.value.reduce((s,n)=>(n.blocks.forEach(r=>{const o=s.get(r);if(o){if(o.some(a=>a.objectID===n.objectID&&a.objectType===n.objectType))return;o.push(n)}else s.set(r,[n])}),s),new Map)),this.handleRenderBlockSide=(e,t,s)=>{const{onRenderBlockSide:n,pickActions:r}=this.options;if(n)return n.call(this,e,t,s);if(r&&t.picked){const o=document.createElement("div"),a=Be.render(r,[e,t],{className:"editor-block-pick-options p-px",size:"sm",btnType:"default"},this);return hn(a,o),{html:`<div onclick="event.stopPropagation()">${o.innerHTML}</div>`}}},this.handleRenderBlockFooter=(e,t,s)=>{const{onRenderBlockRelation:n,onRenderBlockFooter:r}=this.options;if(r)return r.call(this,e,t,s);const o=t.relations||[];if(o.length)return s.html`<div class="editor-zentao-relations pointer-events-auto pt-2 flex flex-wrap gap-2 pl-px">${o.map((a,l)=>{if(n){const c=n.call(this,a,l,e,t,s);if(c!==void 0)return typeof c=="object"&&c&&"html"in c?s.unsafeHTML(c.html):c}return s.html`<div class="editor-zentao-relation text-sm flex items-center gap-0.5 group"><a href="${a.url}" data-toggle="modal"><i class="icon icon-${a.objectType}"></i> #${a.objectID} ${a.name}</a><button class="btn size-xs square ghost opacity-0 group-hover:opacity-100" type="button" zui-command=".~removeZentaoRelation/${encodeURIComponent(a.id)}"><i class="icon icon-text-unlink"></i></button></div>`})}</div>`},this.handlePickBlock=(e,t)=>{var r;if(!this.options.onlyPickContinuous)return;const s=this.getBlocksLayout(),n=(r=s.get(e.blockId))==null?void 0:r.order;if(typeof n=="number"){this.setBlockState(e.blockId,{picked:t});const o=Array.from(s.values()),a=this.getAllBlockStates();let l=Number.MAX_SAFE_INTEGER,c=-1;o.forEach(({id:h,order:d})=>{var f,m;(m=(f=a[h])==null?void 0:f.value)!=null&&m.picked&&(l=Math.min(l,d),c=Math.max(c,d))}),(c>=0||l>=0&&l<Number.MAX_SAFE_INTEGER)&&(t?o.forEach(({id:h,order:d})=>{(d>l&&d<n||d>n&&d<c)&&this.setBlockState(h,{picked:t})}):o.forEach(({id:h,order:d})=>{d>n&&this.setBlockState(h,{picked:t})}))}return"canceled"}}get collection(){if(!this._collection)throw new Error("Editor._collection must be initialized!");return this._collection}get schema(){if(!this._schema)throw new Error("Editor._schema must be initialized!");return this._schema}get doc(){if(!this._doc)throw new Error("Editor._doc must be initialized!");return this._doc}get docID(){return this.doc.id}get editor(){if(!this._editor)throw new Error("Editor._editor must be initialized!");return this._editor}get host(){return this.editor.host}get title(){var e;return((e=this.doc.meta)==null?void 0:e.title)??this.options.title??"Untitled"}get tags(){var e;return((e=this.doc.meta)==null?void 0:e.tags)??this.options.tags??[]}get context(){var r,o;const e=(r=this.doc.root)==null?void 0:r.id;if(!e||!this.host)return;const t=this.host.view.getBlock(e);if(!t)return;const s=this.host.selection.find("text");if(!s)return;const n=(o=this.host.doc.getBlock(s.blockId))==null?void 0:o.model;if(n)return{rootComponent:t,model:n}}get isEmpty(){return De.Module.utils.isEmptyDoc(this.doc)}get rootService(){try{return this.editor.std.getService("affine:page")}catch{return null}}get zentaoRelations(){return this._zentaoRelations.value}get blockRelationsMap(){return this._blockRelationsMap.value}get content(){return this._lastChangeContent}ensureEditor(){return new Promise(e=>{this._editor?e(this._editor):this.one("inited",()=>{e(this._editor)})})}async readyToUseHocuspocus(e,t=!0){try{if(!e)return null;const s=typeof e=="string"?JSON.parse(e):e,{Y:n,utils:r}=De.Module,o=s.meta.id,{hocuspocusUrls:a,token:l}=this.options,c=a==null?void 0:a[0];if(!c||!l)return null;if(t&&(await(await fetch(`${c}/doc/${this.options.docID}@${o}/exists`)).json()).data)return o;const h=await r.convertSnapshotToYDoc(s,this.getBlockSources());if(!h)return null;const d=n.encodeStateAsUpdate(h);return(await(await fetch(`${c}/doc/${this.options.docID}@${o}/init`,{method:"POST",body:d,headers:{"Content-Type":"application/octet-stream",token:l}})).json()).result==="success"?o:null}catch(s){return console.error("Ready to use hocuspocus error:",s),null}}_initExtraStates(){const{extraStates:e,showPickCheck:t}=this.options;e&&Object.entries(e).forEach(([s,n])=>{De.setDocState(this.doc.id,s,n)}),this.clearDocStates(),this.setDocStates({...e,showPickCheck:t}),this.resetZentaoRelations(this.options.zentaoRelations||[]),this._zentaoRelationsEffect=Tt(()=>{if(!this._doc||this.options.zentaoRelations===!1)return;const s=this._blockRelationsMap.value,n=this.getAllBlockStates(),r=new Set(Object.keys(n));s.entries().forEach(([l,c])=>{this.setBlockState(l,{relations:c.filter(h=>h.blocks[h.blocks.length-1]===l),marked:!!c.length}),r.delete(l)}),r.forEach(l=>{this.setBlockState(l,{relations:[],marked:!1})});const{zentaoRelationsName:o,htmlName:a}=this.options;o&&this._setInput(o,JSON.stringify(this._zentaoRelations.value.reduce((l,c)=>{const h=c.blocks.filter(d=>this.doc.getBlock(d));return h.length&&l.push({objectType:c.objectType,objectID:c.objectID,name:c.name,blocks:h}),l},[]))),a&&this.getHtml().then(l=>{this._setInput(a,l)})})}getBlockView(e){var s,n;const t=(n=(s=this._editor)==null?void 0:s.host)==null?void 0:n.view;return t==null?void 0:t.getBlock(e)}async afterInit(){const{schema:e,collection:t,content:s,mode:n,contentType:r,title:o,tags:a,uid:l,onLoadingLibChange:c,useHocuspocus:h,height:d,minHeight:f,maxHeight:m,toolbar:y,readonly:b}=this.options,{store:w}=await De.loadModule(c);if(this.destroyed)return;const{DocCollection:x}=w;if(this._uid=l||Ft(13),h){const{checkExists:I=!0}=typeof h=="object"?h:{},E=await this.readyToUseHocuspocus(s,I);if(E){await this.initHocuspocusDoc({docId:E,mode:n});return}}if(this._schema=e||De.createSchema(),this._collection=t||new x({schema:this.schema,blobSources:this.getBlockSources()}),this._collection.meta.initialize(),this._editor=De.createEditor(n),await this.updateDoc(s,r,o,a),this.doc.history.clear(),this._initExtraStates(),await this.syncData(!0),d){const I=je(d);I&&v(this._editor).height(I)}if(f){const I=je(f);I&&v(this._editor).css("min-height",I)}if(m){const I=je(m);I&&v(this._editor).css("max-height",I).css("overflow-y","auto")}this.element.appendChild(this.editor),this.$element.addClass("affine-theme editor").on("syncData",()=>this.syncData()),this.$element.toggleClass("has-pick-checks",!!this.options.showPickCheck).toggleClass("only-pick-continuous",!!this.options.onlyPickContinuous),this.options.onClickHolder&&v(this.editor).on("zui-holder-node-click zui-holder-block-click",I=>{var E,P;(P=(E=this.options).onClickHolder)==null||P.call(E,{block:I.type==="zui-holder-block-click",holder:I.detail.holder,event:I,target:I.detail.target})});const{disableScrollOnSlashMenuShow:D}=this.options;if(D&&!v(D).data("zuiEditorSlashMenuObserver")){const I=new MutationObserver(E=>{for(const P of E){for(const O of Array.from(P.addedNodes))if(O.nodeType===1&&O.tagName==="AFFINE-SLASH-MENU"){Go(D,!0);break}for(const O of Array.from(P.removedNodes))if(O.nodeType===1&&O.tagName==="AFFINE-SLASH-MENU"){Go(D,!1);break}}});I.observe(document.body,{childList:!0,subtree:!1}),v(D).data("zuiEditorSlashMenuObserver",I)}if(!b&&y&&!this._toolbarElement){v('<div class="editor-toolbar" />').prependTo(this.$element);const I=this.$element.find(".editor-toolbar");this._toolbarElement=I[0],this._toolbar=new eu(I,{editor:this,...typeof y=="boolean"?{}:y})}}async initHocuspocusDoc({docId:e,mode:t}){const{store:s}=De.Module,{DocCollection:n}=s;this._schema=this.options.schema||De.createSchema(),this._collection=new n({schema:this.schema,blobSources:this.getBlockSources()}),this.collection.start(),this.collection.meta.initialize(),this._doc=this.collection.createDoc({id:e}),this.createHocuspocusProvider(),this.doc.load(),this._editor=De.createEditor(t),this.editor.doc=this.doc,this.element.appendChild(this.editor)}destroyHocuspocusProvider(){var e;(e=this._hocuspocusProvider)==null||e.destroy()}setDocReadonly(){this.options.readonly&&this.collection.awarenessStore.setReadonly(this.collection.getBlockCollection(this.doc.id),!0)}getBlockSources(){const{onDownload:e,downloadUrl:t,onUpload:s}=this.options;if(!e&&!s&&!t)return;const n=this._assetsMap;return{main:{name:this._uid,readonly:!1,get:async r=>{const o=n.get(r);if(o)return o;if(e)try{const a=await e.call(this,{key:r,editorID:this._uid}),l=a==null?void 0:a.blob;if(l)return n.set(r,l),l}catch(a){console.error("[ZUI] download file failed",a)}else if(t){let a=t;if(r.startsWith("data:"))a=r;else if(r.startsWith("file:"))a=ut("file","read",`fileID=${r.substring(5)}`);else if(/https?:\/\//.test(r)){const h=window.EDITOR_IMAGE_PROXY_ENDPOINT;a=h?`${h}?url=${encodeURIComponent(r)}`:r}else a=$e(t,{objectType:"doc",objectID:this.options.docID,gid:btoa(`g-${r}`),title:"",extra:"editor"});const c=await(await fetch(a)).blob();return n.set(r,c),c}return null},set:async(r,o)=>(n.set(r,o),s&&await s.call(this,{key:r,blob:o,editorID:this._uid}),r),delete:async r=>{n.delete(r)},list:async()=>Array.from(n.keys())}}}render(e,t){super.render(e,t),t&&this.updateDoc(this.options.content,void 0,this.options.title)}async getHtml(e){var l;const{store:t}=De.Module,s=this.doc,n=s.collection;if(e||(e=new t.Job({collection:n}).docToSnapshot(s)),!e)return"";const{onRenderBlockRelationHtml:r,downloadUrl:o}=this.options;return await De.convertToHtml(e,n,o,this.blockRelationsMap,(c,h)=>r?h.map((d,f)=>r.call(this,d,f)).join(" &nbsp; "):"",(l=this.options.onConvert)==null?void 0:l.bind(this))}async export(e="pdf",t){const{blocks:s}=De.Module,n=this.editor.std.get(s.ExportManager);return n?(v("body").addClass("editor-is-exporting"),e==="png"?await n.exportPng():e==="markdown"?await this.exportMarkdown():e==="json"?await this.exportSnapshot(t):e==="html"?await this.exportHtml():await n.exportPdf(),v("body").removeClass("editor-is-exporting"),!0):!1}exportMarkdown(){var t;const e=(t=this.rootService)==null?void 0:t.transformers.markdown;return e==null?void 0:e.exportDoc(this.doc)}exportHtml(){var t;const e=(t=this.rootService)==null?void 0:t.transformers.html;return e==null?void 0:e.exportDoc(this.doc)}async exportSnapshot(e){const t=await this.toSnapshot(),s=new Blob([JSON.stringify(t)],{type:"application/json"});Ks(s,`${e??(t==null?void 0:t.meta.title)??this.title}.json`)}exportPDF(){return this.export("pdf")}exportPNG(){return this.export("png")}getBlock(e){var t;if(e instanceof HTMLElement&&(e=((t=e.closest("[data-block-id]"))==null?void 0:t.getAttribute("data-block-id"))||""),typeof e=="string")return this.doc.getBlock(e)}deleteBlock(e){const t=this.getBlock(e);if(t)return this.doc.deleteBlock(t.model),!0}updateBlock(e,t){const s=this.getBlock(e);s&&this.doc.updateBlock(s.model,t)}_createEmptyDoc(){const e=De.createEmptyDoc(this.collection);return this._isEmpty=!0,e}async _importSnapshot(e){const{store:t}=De.Module;let s=e;const n=this.collection,r=new t.Job({collection:n});let o;try{const{onImportSnapshot:a}=this.options;if(a){const l=a(s);l&&(s=l)}o=await r.snapshotToDoc(s),o&&n.setDocMeta(o.id,{createDate:s.meta.createDate,tags:s.meta.tags})}catch(a){console.error("[ZUI] parse doc content error:",a)}return o||this._createEmptyDoc()}async importHTML(e){return await De.importHtml(e,this.collection)||this._createEmptyDoc()}async importConfluence(e){return await De.importConfluence(e,this.collection)||this._createEmptyDoc()}async importMarkdown(e){const{blocks:t}=De.Module,s=this.collection,n=await t.MarkdownTransformer.importMarkdownToDoc({collection:s,markdown:e});return n?s.getDoc(n)||this._createEmptyDoc():this._createEmptyDoc()}_migrateFrom(e){return e.$migrate==="html"?this.importHTML(e.$data):e.$migrate==="markdown"?this.importMarkdown(e.$data):e.$migrate==="confluence"?this.importConfluence(e.$data):this._createEmptyDoc()}_getInput(e){if(!this._inputs[e]){const t=document.createElement("input");t.type="hidden",t.name=e,t.value="",this.element.appendChild(t),this._inputs[e]=t}return this._inputs[e]}_setInput(e,t){const s=this._getInput(e);s.value!==t&&(s.value=t,v(s).trigger("change"))}async updateDoc(e="",t="snapshot",s,n){var c,h,d;if(this._doc&&this._doc.dispose(),e==="")this._doc=this._createEmptyDoc();else if(t==="doc"||t==="snapshot"||typeof e=="object")try{for(;typeof e=="string";)e=JSON.parse(e);e.$migrate?this._doc=await this._migrateFrom(e):this._doc=await this._importSnapshot(e),this._lastChangeContent=typeof e=="string"?e:JSON.stringify(e)}catch(f){this._doc=this._createEmptyDoc(),console.error("[ZUI] parse doc content error:",f)}else t==="html"?this._doc=await this.importHTML(e):t==="markdown"?this._doc=await this.importMarkdown(e):t==="confluence"?this._doc=await this.importConfluence(e):this._doc=this._createEmptyDoc();const{readonly:r,name:o,htmlName:a}=this.options;if(this.setDocReadonly(),o&&(this._setInput("uid",this._uid),this._setInput(o,JSON.stringify(e))),a){const f=await this.getHtml();this._setInput(a,f)}this.editor.doc=this._doc;const l=()=>{this._isEmpty=this.isEmpty,this.$element.toggleClass("is-editor-empty",!!this._isEmpty)};return this._doc.slots.blockUpdated.on(()=>{l(),this.trySyncData()}),l(),this.$element.toggleClass("is-readonly",!!r).toggleClass("is-editing",!r),s!==void 0&&s!==((c=this._doc.meta)==null?void 0:c.title)&&this.updateTitle(s),n!==void 0&&n.join(",")!==((d=(h=this._doc.meta)==null?void 0:h.tags)==null?void 0:d.join(","))&&this.updateTags(n),this._doc}async updateTags(e){const t=this.doc;t.collection.setDocMeta(t.id,{tags:e.map(s=>s.trim()).filter(Boolean)})}async updateTitle(e){var n;const t=this.doc,s=t.root.title;s&&(s.clear(),s.insert(e,0)),t.collection.setDocMeta(t.id,{title:(n=t.root)==null?void 0:n.title.toString()})}trySyncData(){this._updateTimer=window.setTimeout(()=>{this.syncData()},200)}async syncData(e){var n,r;const t=await this.toSnapshot();if(!t)return this._lastChangeContent="",!1;const s=JSON.stringify(t);if(this._lastChangeContent===s)return!1;if(this._lastChangeContent=s,this.options.name&&this._setInput(this.options.name,s),this.options.htmlName){const o=await this.getHtml();this._setInput(this.options.htmlName,o)}if(!e){const o={uid:this._uid,content:s,title:t.meta.title,contentType:"doc",isEmpty:this._isEmpty};(r=(n=this.options).onChange)==null||r.call(n,o,t)}}async getData(e){return e===void 0&&(e=await this.toSnapshot()),e?{content:JSON.stringify(e),title:e.meta.title,uid:this._uid}:{content:"",title:"",uid:this._uid}}async toSnapshot(){return De.toSnapshot(this.doc)}insertText(e,t,s){if(s=s||this.context,!s)return;const{rootComponent:n,model:r}=s;if(!r.text){console.error("Can't insert text! Text not found");return}De.Module.components.insertContent(n.host,r,e,t)}insertBlock(e,t,s,n=!1){var f;if(s=s||this.context,!s)return;const{rootComponent:r,model:o}=s,a=r.doc.getParent(o);if(!a)return;const l=a.children.indexOf(o),c=e.includes(":")?e:`affine:${e}`,h=(((f=o.text)==null?void 0:f.toString())??"").trim().length,d=r.doc.addBlock(c,t,r.doc.getParent(o),h&&!n?l+1:l);return n&&this.doc.deleteBlock(o),d}insertComponent(e,t,s){const n=typeof e=="string"?{name:e}:e;return this.insertBlock("affine:embed-zui-component",{options:t,...n},s)}insertIframe(e,t){const s=typeof e=="string"?{name:e}:e;return this.insertBlock("affine:embed-zui-iframe",s,t)}insertHtmlBlock(e,t){const s=typeof e=="string"?{html:e}:e;return this.insertBlock("affine:embed-zui-html",s,t)}insertLazyBlock(e,t,s){const{content:n,...r}=t||{};return this.insertCustom({content:n,fetcher:e},r,s)}insertCustom(e,t,s){return this.insertBlock("affine:embed-zui-custom",{content:e,...t},s)}insertHolderBlock(e,t,s,n){return this.insertBlock("affine:zui-holder",{name:e,text:t,data:s},n)}insertHolderText(e,t,s,n){return this.insertText(" ",{holder:{id:Ft(10),name:e,...typeof t!="object"?{text:String(t)}:t,data:s}},n)}updateHolderText(e,t){if(e.id===void 0&&e.name===void 0)return console.error("[ZUI] update holder text failed, id or name is required"),!1;const{id:s,name:n}=e,r=this.$element.find(`.affine-zui-holder${e.id!==void 0?`[data-holder-id="${s}"]`:`[data-holder-name="${n}"]`}`);return r.length?(r.each(function(){v(this).parent("affine-zui-holder-node")[0].updateHolder(e,t)}),!0):(console.warn("[ZUI] update holder text failed, holder not found"),!1)}callSlashMenuAction(e,t){if(t=t||this.context,!t){console.error(`[ZUI] call action slash menu "${e}" failed, context is undefined.`);return}const s=De.filterEnabledSlashMenuItems(De.Module.blocks.AffineSlashMenuWidget.DEFAULT_CONFIG.items,t);let n;for(const r of s){if((r.name===e||r.key===e)&&(n=r),r.subMenu){for(const o of r.subMenu)if(o.name===e||o.key===e){n=o;break}}if(n)break}return n==null?void 0:n.action(t)}async createHocuspocusProvider(){var c;const e=!!((c=window.config)!=null&&c.debug);e&&console.log("> connect to hocuspocus");const t=this._doc;if(!t)throw new Error("Hocuspocus provider needs a doc.");const{awarenessUser:s,hocuspocusUrls:n,token:r}=this.options;if(!s)throw new Error("Hocuspocus provider needs awarenessUser");if(!n||!n[1])throw new Error("Hocuspocus provider needs hocuspocusUrls");const o=t.awarenessStore.awareness,{hocuspocusProvider:a}=await De.loadModule(),l=new a.HocuspocusProvider({url:n[1],name:`${this.options.docID}@${t.id}`,document:t.spaceDoc,awareness:o,token:r,onAuthenticationFailed:h=>{var d,f,m;e&&console.log("> onAuthenticationFailed",h),(f=(d=this.options).onAuthenticationFailed)==null||f.call(d,h),(m=this._hocuspocusProvider)==null||m.destroy()},onAwarenessUpdate:h=>{var d,f;e&&console.log("> Hocuspocus awareness update",h),(f=(d=this.options).onAwarenessUpdate)==null||f.call(d,h)},onConnect:()=>{var h,d;e&&console.log("> Hocuspocus connect"),(d=(h=this.options).onConnect)==null||d.call(h)},onDisconnect:({event:h})=>{var d,f;e&&console.log("> Hocuspocus disconnect",h),(f=(d=this.options).onDisconnect)==null||f.call(d,h)},onClose:({event:h})=>{var d,f,m;e&&console.log(">>> Hocuspocus close",h),h.code===4205&&h.reason==="Reset Connection"&&((d=this._hocuspocusProvider)==null||d.destroy(),(m=(f=this.options).onClose)==null||m.call(f,h))},onMessage:h=>{e&&console.log("> Hocuspocus message",h)},onOutgoingMessage:h=>{e&&console.log("> Hocuspocus outgoing message",h)},onStateless:h=>{e&&console.log("> Hocuspocus stateless",h)},onSynced:h=>{e&&console.log(">>> Hocuspocus synced!",h),this._hocuspocusProvider=l,this.setDocReadonly()},onStatus:h=>{e&&console.log("> Hocuspocus status",h)},onDestroy:()=>{e&&console.log(">>> Hocuspocus destroy"),this._hocuspocusProvider=null}});l.setAwarenessField("user",s)}destroy(){var e,t,s;super.destroy(),(e=this._doc)==null||e.dispose(),this._editor&&(v(this._editor).off("zui-holder-node-click zui-holder-block-click"),this._editor.remove());for(const n of Object.values(this._inputs))n.remove();(t=this._hocuspocusProvider)==null||t.destroy(),(s=this._zentaoRelationsEffect)==null||s.call(this),this._updateTimer&&clearTimeout(this._updateTimer)}queryZentaoRelations(e){const t=this._zentaoRelations.value,{block:s,objectType:n,objectID:r}=e;return t.filter(o=>(s===void 0||o.blocks.includes(s))&&(n===void 0||o.objectType===n)&&(r===void 0||o.objectID===r))}getBlocksLayout(e){var o,a;e=e||Object.keys(this.doc.blocks.value);const t=(a=(o=this._editor)==null?void 0:o.host)==null?void 0:a.view,s=this._blockRelationsMap.value,n=[],r=e.reduce((l,c,h)=>{const d=t==null?void 0:t.getBlock(c);return l.set(c,{id:c,block:this.doc.getBlock(c),component:d,order:h,relations:s.get(c)||[]}),d&&n.push(d),l},new Map);return n.sort((l,c)=>{const h=l.getBoundingClientRect(),d=c.getBoundingClientRect(),f=l.closest("affine-zui-layout"),m=c.closest("affine-zui-layout");return f===m&&f?h.left-d.left||h.top-d.top:h.top-d.top||h.left-d.left}),n.forEach((l,c)=>{r.get(l.blockId).order=c}),r}resetZentaoRelations(e=[]){const t=this.getBlocksLayout(),s=e.map((n,r)=>({...n,index:r,id:Ft(10),blocks:[...n.blocks].sort((o,a)=>{const l=t.get(o),c=t.get(a);return((l==null?void 0:l.order)||Number.MAX_SAFE_INTEGER)-((c==null?void 0:c.order)||Number.MAX_SAFE_INTEGER)})}));this._zentaoRelations.value=s}setZentaoRelations(e){const t=this._zentaoRelations.value,s=t.reduce((n,r,o)=>(r.index=o,n.set(r.id,r),n),new Map);for(const n of e){let r="id"in n?n:{...n,id:Ft(10)};const o=s.get(r.id);o&&(r={...o,...r}),t.push(r)}this.resetZentaoRelations(t)}setZentaoRelationsToPickedBlocks(e,t){const s=this.getPickedBlocks(),n=e.map(o=>({...o,blocks:s}));this.setZentaoRelations(n);const{cancelPicked:r=!0}=t||{};r&&this.cancelPickedBlocks()}removeZentaoRelation(e){const t=this._zentaoRelations.value;this.resetZentaoRelations(t.filter(s=>s.id!==e))}getPickedBlocks(){return Object.entries(this.getAllBlockStates()).reduce((e,[t,s])=>(s.value.picked&&e.push(t),e),[])}cancelPickedBlocks(e){e=e||this.getPickedBlocks(),e.forEach(t=>this.setBlockState(t,{picked:!1}))}getDocStates(){return De.getDocStates(this.docID)}setDocStates(e){return De.setDocStates(this.docID,e)}clearDocStates(){return De.clearDocStates(this.docID)}getDocState(e,t){return De.getDocState(this.docID,e,t)}setDocState(e,t){return De.setDocState(this.docID,e,t)}setBlockState(e,t){return De.setBlockState(this.docID,e,t)}clearBlockState(e){return De.clearBlockState(this.docID,e)}getAllBlockStates(){return De.getAllBlockStates(this.docID)}static async loadModule(e){var t,s;if(!this.Module){if(e==null||e(!0),!this.Module){const n=await v.getLib("blocksuite");this.Module=n,(s=(t=n.zui).use)==null||s.call(t,{init:nh,create:Jo,runJS:kr}),this.slashMenuSettings.forEach(([r,o])=>{n.utils.setSlashMenu(this.formatSlashMenuItems(r),o)}),this.slashMenuSettings=[]}e==null||e(!1)}return this.Module}static formatSlashMenuItems(e){const t=this.Module,s=n=>r=>n.call(this.query(r.rootComponent),r);return e.map(n=>{if(typeof n=="object"&&n){if(typeof n.icon=="string"){let r=n.icon,o=t.icons[r];o===void 0&&(r.startsWith("icon-")||(r=`icon-${r}`),r.split(" ").includes("icon")||(r=`icon ${r}`),o=t.lit.html`<i class=${r}></i>`),n={...n,icon:o}}n.divider&&(n={groupName:"",...n}),n.action?n={...n,action:s(n.action)}:n.subMenu&&(n={...n,subMenu:this.formatSlashMenuItems(n.subMenu)})}return n})}static filterEnabledSlashMenuItems(e,t){return e.map(s=>typeof s=="function"?s(t):s).flat().filter(s=>s.showWhen?s.showWhen(t):!0).map(s=>"subMenu"in s?{...s,subMenu:this.filterEnabledSlashMenuItems(s.subMenu,t)}:{...s})}static setSlashMenu(e,t){this.Module?this.Module.utils.setSlashMenu(this.formatSlashMenuItems(e),t):this.slashMenuSettings.push([e,t])}static forEachBlock(e,t){t(e);for(const s of e.children)t(s),this.forEachBlock(s,t)}static createEditor(e){const{presets:t,blocks:s,utils:n}=De.Module;let r;const o=()=>n!=null&&n.patchPageRootSpec?n.patchPageRootSpec(s.PageEditorBlockSpecs):s.PageEditorBlockSpecs;return e==="full"?(r=new t.AffineEditorContainer,r.pageSpecs=o()):e==="edgeless"?r=new t.EdgelessEditor:(r=new t.PageEditor,r.specs=o()),r}static async convertToHtml(e,t,s,n,r,o){var D;const{store:a,blocks:l}=De.Module;let c;if(typeof e=="string")try{c=JSON.parse(e)}catch(I){console.error("[ZUI] parse doc content error:",I)}else c=e;if(!c)return"";t=t||new a.DocCollection({schema:new a.Schema().register(l.AffineSchemas)});const h=new a.Job({collection:t}),d=new l.HtmlAdapter(h),f=new Map;c.blocks.children=Ey(c.blocks.children,(I,E)=>{var P;if(E.flavour==="affine:bookmark"?I.push({...E,flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:E.props.title??E.props.url,attributes:{link:E.props.url}},E.props.description?{insert:` (${E.props.description})`}:null].filter(Boolean)}}}):I.push(E),r){const O=(P=n==null?void 0:n.get(E.id))==null?void 0:P.filter(W=>W.blocks[W.blocks.length-1]===E.id);O!=null&&O.length&&(I.push({id:Ft(10),flavour:"affine:paragraph",type:"block",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:`{{__ZENTAO_RELATIONS__${E.id}}}`}]}},children:[],version:1}),f.set(E.id,O))}return I});const m=await d.fromBlockSnapshot({snapshot:c.blocks,assets:h.assetsManager});let y=m.file;y=y.replace("<!--BlockSuiteDocTitlePlaceholder-->",(D=c.meta.tags)!=null&&D.length?`<p>${window.EDITOR_LANG.keywords||"Keywords"}: ${c.meta.tags.join(", ")}</p>`:""),r&&f.forEach((I,E)=>{y=y.replace(`{{__ZENTAO_RELATIONS__${E}}}`,r(E,I))});const b=document.createElement("template");b.innerHTML=y;const w=b.content;if(s&&m.assetsIds.length){const I=new Set(m.assetsIds),E=new Map;h.assets.entries().forEach(([P,O])=>{O.name&&E.set(O.name,{file:O,id:P})}),w.querySelectorAll("img").forEach(P=>{const O=P.getAttribute("alt")??"";let W=O.split(".").shift(),J;if(W&&I.has(W))J=h.assets.get(W);else{const Y=E.get(O);Y&&(W=Y.id,J=Y.file)}if(J){const Y=$e(s,{gid:btoa(`g-${W}`),title:btoa(W),extra:"editor"});P.src=Y.replaceAll("&","{{__AMP__}}")+"#g="+btoa(W)}})}return w.querySelectorAll("pre.shiki>code").forEach(I=>{I.textContent=I.textContent}),w.querySelectorAll(".affine-block-children-container").forEach(I=>{I.childNodes.length||I.remove()}),w.querySelectorAll("ul.todo-list li").forEach(I=>{const E=I.querySelectorAll("input[checked]").length?"☑︎":"☐",P=document.createElement("p");P.textContent=`${E} ${I.textContent}`,I.replaceWith(P)}),o&&await o(w),(y.startsWith("<!doctype html><html><head><style>")?w.children[w.childElementCount-1].innerHTML:Array.from(w.children).map(I=>I.tagName!=="STYLE"?I.innerHTML:"").join(`
`)).replaceAll("{{__AMP__}}","&")}static createEmptyDoc(e){const{store:t}=De.Module;e||(e=new t.DocCollection({schema:De.createSchema()}),e.start(),e.meta.initialize());const s=e.createDoc();s.load();const n=s.addBlock("affine:page",void 0),r=s.addBlock("affine:note",void 0,n);return s.addBlock("affine:paragraph",void 0,r),s}static toSnapshot(e){const{collection:t}=e;return new De.Module.store.Job({collection:t}).docToSnapshot(e)}static cleanHtml(e){const t=document.createElement("template");return t.innerHTML=e,t.content.querySelectorAll("img").forEach(n=>{const r=n.getAttribute("src");r!=null&&r.startsWith("/")&&n.setAttribute("src",`${location.origin}${r}`)}),t.innerHTML}static async importConfluence(e,t){const s=await De.loadModule(),{store:n}=s;try{t=t||new n.DocCollection({schema:De.createSchema()});const r=await s.blocks.ConfluenceTransformer.importConfluenceToDoc({collection:t,confluence:e});if(r)return t.getDoc(r)}catch(r){console.error("[ZUI] import confluence error:",r)}}static async importHtml(e,t){const{store:s,blocks:n}=await De.loadModule();try{t=t||new s.DocCollection({schema:De.createSchema()});const r=await n.HtmlTransformer.importHTMLToDoc({collection:t,html:this.cleanHtml(e)});if(r)return t.getDoc(r)}catch(r){console.error("[ZUI] import html error:",r)}}static async htmlToSnap(e,t){try{const{store:s,blocks:n}=await De.loadModule();t=t||new s.DocCollection({schema:De.createSchema()});const r=new s.Job({collection:t});return await new n.HtmlAdapter(r).toBlockSnapshot({file:this.cleanHtml(e)})}catch(s){console.error("[ZUI] html to snap error:",s)}}static async markdownToSnap(e,t){const{store:s,blocks:n}=await De.loadModule();t=t||new s.DocCollection({schema:De.createSchema()});const r=new s.Job({collection:t});return await new n.MarkdownAdapter(r).toBlockSnapshot({file:e})}static async markdownToHtml(e,t){typeof e=="string"&&(e={content:e,title:""});const s=await De.loadModule(),{store:n}=s;t=t||new n.DocCollection({schema:new n.Schema().register(s.blocks.AffineSchemas)});const r=await this.markdownToSnap(e.content,t);return this.convertToHtml({type:"page",meta:{id:Ft(),title:e.title,createDate:Date.now(),tags:[]},blocks:r},t)}static getDocStates(e){return De.Module.zui.getDocStates(e)}static setDocStates(e,t){return De.Module.zui.setDocStates(e,t)}static clearDocStates(e){return De.Module.zui.clearDocStates(e)}static getDocState(e,t,s){return De.Module.zui.getDocState(e,t,s)}static setDocState(e,t,s){return De.Module.zui.setDocState(e,t,s)}static setBlockState(e,t,s){return De.Module.zui.setBlockState(e,t,s)}static clearBlockState(e,t){return De.Module.zui.clearBlockState(e,t)}static getAllBlockStates(e){return De.Module.zui.getAllBlockStates(e)}static setGlobalConfig(e){window.EDITOR_CONFIG||(window.EDITOR_CONFIG={}),Object.assign(window.EDITOR_CONFIG,e)}static createSchema(){const{store:e,blocks:t}=De.Module,{AffineSchemas:s}=t,n=new e.Schema().register(s);return["affine:embed-linked-doc","affine:embed-youtube","affine:embed-figma","affine:embed-github","affine:embed-loom"].forEach(r=>n.flavourSchemaMap.delete(r)),n}static nanoid(){return Ft()}};_s.NAME="Editor",_s.DEFAULT={mode:"page",contentType:"snapshot",onlyPickContinuous:!0},_s.slashMenuSettings=[],_s.iframe=jx,_s.confluenceBlockMatcherMap={},_s.registerConfluenceBlockMatcher=(i,e)=>{if(_s.Module)_s.Module.blocks.ConfluenceAdapter.registerBlockMatcher(i,e);else if(typeof i=="object")for(const t in i)_s.confluenceBlockMatcherMap[t]=i[t];else _s.confluenceBlockMatcherMap[i]=e};let gt=_s;const Py=Pe.getCode();v.registerLib("blocksuite",{src:[`editor/blocksuite/editor${Py!=="zh_cn"?`.${Py}`:""}.umd.cjs`,"editor/blocksuite/editor.css"],check:"BlockSuite"}),gt.register();let{maxUploadSize:ni}=window.config||{};ni&&(ni=typeof ni=="string"?ks(ni):ni,gt.setGlobalConfig({maxFileSize:ni,maxImageSize:ni}));class Zi extends gt{}Zi.DEFAULT={...gt.DEFAULT,mode:"page"},Zi.register(),Object.assign(window,{Editor:gt});const Bx=ut("file","read","fileID={fileID}","{viewType}");gt.setGlobalConfig({imageSrcGetter:i=>{if(i.startsWith("{")&&i.endsWith("}")){const e=i.slice(1,-1),[t,s]=e.split(".");return Bx.replace("{fileID}",t).replace("{viewType}",s)}return i},onRenderBlockFooter:(i,e,t)=>(gt.query(i)||Zi.query(i)).handleRenderBlockFooter(i,e,t),onRenderBlockSide:(i,e,t)=>(gt.query(i)||Zi.query(i)).handleRenderBlockSide(i,e,t),onPickBlock:(i,e)=>(gt.query(i)||Zi.query(i)).handlePickBlock(i,e)}),v(document).on("scroll",i=>{i.preventDefault()});class ii extends ae{constructor(){super(...arguments),this._ref=ye()}get element(){return this._ref.current}get $(){return this._editor}init(e){var d,f,m;const{className:t,style:s,rootProps:n,ref:r,children:o,jsx:a,key:l,autoInit:c,...h}=this.props;return e={...h,...e},(d=this._editor)==null||d.destroy(),v(this.element).empty(),this._editor=new gt(this.element,e),(m=(f=this.props).onInit)==null||m.call(f,this._editor),this._editor}destroyHocuspocusProvider(){var e;(e=this._editor)==null||e.destroyHocuspocusProvider()}update(e){var t;(t=this._editor)==null||t.render(e)}getData(){var e;return(e=this._editor)==null?void 0:e.getData()}getHtml(){var e;return(e=this._editor)==null?void 0:e.getHtml()}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){var e;(e=this._editor)==null||e.destroy()}render(e){const{className:t,style:s,rootProps:n,children:r}=e;return g("div",{ref:this._ref,className:K("editor",t),style:s,...n},r)}}ii.defaultProps={autoInit:!0};const Ly=class ib extends ae{constructor(e){super(e),this._editorRoot=ye(),this._titleEle=ye(),this._handleChange=()=>{var t,s;(s=(t=this.props).onChange)==null||s.call(t,this.data)},this._uid=e.uid??Ft(13).replaceAll("-","_")}get data(){var t,s,n;const e=((s=(t=this._editorRoot.current)==null?void 0:t.querySelector("zen-editor"))==null?void 0:s.value)??"";return{title:((n=this._titleEle.current)==null?void 0:n.value)??"",content:e,html:e,uid:this._uid,contentType:this.props.contentType}}_loadLib(){if(!customElements.get("zen-editor"))return v.getLib("zeneditor",{type:"module"})}async init(e){var m,y,b,w;customElements.get("zen-editor")||((y=(m=this.props).onLoadingLibChange)==null||y.call(m,!0),await this._loadLib(),(w=(b=this.props).onLoadingLibChange)==null||w.call(b,!1));const{readonly:t,content:s,contentType:n,bordered:r,placeholder:o,resizable:a=!0,fullscreenable:l=!0,uploadUrl:c="",injectCssPath:h}={...this.props,...e},d=[],f={class:"p-0 w-full h-full","upload-url":$e(c,{uid:encodeURIComponent(this._uid),extra:"",field:"imgFile",gid:""}),readonly:!!t,"hide-ui":!!t,fullscreenable:!!l,resizable:!!a,"expose-editor":!0,markdown:n==="markdown",placeholder:o,css:ib.injectCSS(),"core-class":"editor_core","content-class":r?"bordered":"borderless","prose-class":"article","css-src":h,size:"sm"};d.push(`<zen-editor${Object.keys(f).reduce((x,D)=>{const I=f[D];return I===!0?x+=` ${D}`:I!==void 0&&I!==!1&&I!==null&&(x+=` ${D}="${I}"`),x},"")}>`,`  <article slot="content">${s}</article>`,"</zen-editor>",`<textarea rows="1" style="display: none">${s}</textarea>`,`<input type="hidden" name="uid" value="${this._uid}" />`),v(this._editorRoot.current).html(d.join(`
`))}async getData(){return Promise.resolve(this.data)}update(e){this.init(e)}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){const e=this._editorRoot.current;e&&(e.innerHTML="")}_renderTitle(e){const{readonly:t,title:s,mode:n}=e;return n!=="full"?null:t?g("h1",{class:"zen-editor-title",style:"font-size: 40px"},s):g("input",{ref:this._titleEle,class:"zen-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:s,onChange:this._handleChange})}render(e){const{className:t,readonly:s,height:n,children:r}=e;return g("div",{className:K("zen-editor-container relative",t),style:{height:n?je(n):"100%"}},this._renderTitle(e),g("div",{ref:this._editorRoot,className:K("zen-editor h-full p-px mt-px rounded relative",s?"is-readonly":""),onChange:this._handleChange}),r)}static injectCSS(){return[".editor {border: unset; border-radius: unset; color: var(--color-fore)}",".editor.size-auto {min-height: 0;}","zen-editor-menu-item {display: inline-flex; align-items: center;}","zen-editor-menu-item > .menu-item {color: #64758B!important; display: inline-flex; align-items: center;}","zen-editor-menu-item > .menu-item:hover {color: var(--color-primary-400)!important; background-color: var(--color-gray-100)!important;}","zen-editor-menu-item > .menu-item.is-active {color: var(--color-primary-400)!important; background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300);}","zen-editor-menu-item > .menu-item.is-active:hover {background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active:not(:hover) {background-color: transparent!important;}","zen-editor-menu-item > .menu-item:has(.color):hover, zen-editor-menu-item > .menu-item:has(.color).is-active {background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300)!important;}",".menubar {border-bottom: 1px solid #d8dbde!important; padding: 0.125rem;}",".menu-item-group {display: inline-flex; align-items: center}",".borderless.editor__content {padding: 0!important}",".tippy-content > div {border: 1px solid #d8dbde!important;}",".tippy-content zen-editor-menu-item {line-height: normal;}",".tippy-content zen-editor-menu-item .label {all: unset;}",".tiptap.ProseMirror {padding-top: 0.5rem;}",".tiptap.ProseMirror p {margin: 0;}"].join(`
`)}};Ly.defaultProps={autoInit:!0,injectCssPath:v.libRoot?`${v.libRoot}/zen-editor/zui-inject-style.css`:void 0};let Ry=Ly;v.registerLib("zeneditor",{src:"zen-editor/zen-editor.esm.js",type:"module"});function zy(i,e="yyyy年M月d日 hh:mm",t="M月d日 hh:mm"){const s=Je(i);return Cr(s,new Date)?rt(s,t):rt(s,e)}const Hx=(i,e)=>{if(!e)return;const t=[];for(const s of e)t.includes(s.account)||t.push(s.account);return t.map(s=>i.getUserInfo(s))},Ux=i=>i.map(t=>({account:t.account,realname:t.name,avatar:t.avatar})),Vx=(i,e=!0)=>i?i.length<=3?i:e?[i[0],"more",i[i.length-1]]:[i[0],i[1],"more"]:null;function Fy(i){const{createDate:e,app:t,editors:s,creator:n}=i,r=t.getUserInfo(n),o=xe(()=>{var h;const{editingUsers:c}=t.signals;return(h=c.value)!=null&&h.length?Ux(c.value):null}),a=o.value||Hx(t,s),l=Vx(a,!o.value);return g("div",{className:"doc-users-bar flex flex-nowrap gap-2"},g("div",{className:"flex flex-nowrap gap-1 items-center"},g("div",{title:e?t.getLang("createdByUserAt",[{name:r.realname,time:zy(e)}],"由 {name} 创建于 {time}"):r.realname},g(qi,{className:"flex-none",size:"xs",user:r})),g("span",null,r.realname),g("span",null,t.getLang("created"))),l!=null&&l.length?g("div",{className:"flex flex-nowrap gap-1 items-center"},g("div",{className:"avatar-group flex-none",title:a==null?void 0:a.map(c=>c.realname).join("、")},l.map(c=>typeof c=="string"?g(qi,{size:"xs",className:"rotate-90",icon:"ellipsis-v"}):g(qi,{size:"xs",user:c}))),g("span",null,t.getLang(o.value?"editing":"edited"))):null)}function Nl(){return g("span",{className:"inline-block w-px h-3 bg-gray-400"})}const Wx=()=>document.documentElement.lang.includes("zh"),tu=i=>{const e=Je(i);if(Wx())return zy(e,"yyyy年MM月dd日","MM月dd日");const[,t,s,n]=e.toDateString().split(" "),r=new Date().getFullYear();return e.getFullYear()===r?`${t} ${s} `:`${t} ${s} ${n} `};function Kx(i){var n;const{doc:e,app:t}=i;if(!e.status)return g("div",{className:"doc-editor-info flex text-gray gap-2 items-center py-2.5"},g(Fy,{app:t,createDate:e.addedDate,editors:e.editors,creator:e.addedBy}),g(Nl,null),g("span",null,t.getLang("notSaved")));const s=!!t.editingUsers.length;return g("div",{className:"doc-editor-info flex text-gray gap-2 items-center py-2.5"},t.renderCustom("editor-info-before",e),g(Fy,{app:t,createDate:e.addedDate,editors:e.editors,creator:e.addedBy}),g(Nl,null),g("span",null,t.getLang(e.status,t.getLang("released"))),g(Nl,null),g("span",{className:"hint","data-hint":Je(e.addedDate).toLocaleString()},tu(e.addedDate),t.getLang("created")),s?g("span",{className:"-px-2"},t.getLang("autoSaveHint","所有编辑内容都会自动保存")):null,s?g("span",null,tu(new Date),t.getLang("edited")):e.editedDate?g("span",{className:"hint","data-hint":Je(e.editedDate).toLocaleString()},tu(e.editedDate),t.getLang("edited")):null,g(Nl,null),g("div",{key:"views",className:"text-sm hint flex items-center gap-1","data-hint":t.getLang("viewsCount","阅读次数")},g(Ie,{icon:"eye"}),e.views||0),e.api||((n=t.props.privs)==null?void 0:n.collect)==="no"?null:g("div",{key:"star",className:`text-sm hint cursor-pointer ${e.isCollector?"text-warning":"text-gray"} flex items-center gap-1`,"data-hint":t.getLang(e.isCollector?"cancelCollection":"collect"),"zui-command":`collectDoc/${e.id}`},g(we,{size:"xs",type:"ghost",icon:e.isCollector?"star":"star-empty",text:e.collects||0})),t.renderCustom("editor-info-after",e))}class Oy extends ae{constructor(){super(...arguments),this._toolbarState={bold:!1,italic:!1,underline:!1,strikethrough:!1,bulleted:!1,numbered:!1,fontSize:"text",color:"",background:"",align:"left"},this.colorPickerRef=null,this.colorPicker=null,this.bgColorPickerRef=null,this.bgColorPicker=null,this.formatButtons=[{key:"bold",icon:"format-bold",command:"toggleBold",hint:"加粗"},{key:"italic",icon:"format-italic",command:"toggleItalic",hint:"斜体"},{key:"underline",icon:"format-underline",command:"toggleUnderline",hint:"下划线"},{key:"strikethrough",icon:"format-strike",command:"toggleStrike",hint:"删除线"}],this.listButtons=[{key:"bulleted",icon:"format-list-bulleted",slashName:"Bulleted List",hint:"无序列表"},{key:"numbered",icon:"format-list-numbers",slashName:"Numbered List",hint:"有序列表",iconClass:"text-lg"}],this.otherButtons=[{key:"todo",icon:"checkbox",slashName:"To-do List",hint:"待办事项"},{key:"link",icon:"text-link",command:"toggleLink",hint:"链接",iconClass:"text-lg"},{key:"image",icon:"image",slashName:"Image",hint:"插入图片"},{key:"file",icon:"file",slashName:"Attachment",hint:"上传附件"}],this.basicButtons=[{key:"code",icon:"code-block",slashName:"Code Block",hint:"代码块"},{key:"quote",icon:"icon-quote",slashName:"Quote",hint:"引用"},{key:"divider",icon:"add-divider",slashName:"Divider",hint:"分割线"},{key:"inLineEquation",icon:"sigma",slashName:"Inline equation",hint:"内嵌公式"},{key:"equation",icon:"sigma-box",slashName:"Equation",hint:"公式"},{key:"simpleTable",icon:"table",slashName:"简单表格",hint:"简单表格"}],this.databaseButtons=[{key:"table",icon:"data-table",slashName:"Table View",hint:"表格视图"},{key:"kanban",icon:"kanban-box",slashName:"Kanban View",hint:"看板视图"}],this.colorList=[{key:"default",value:"#30394A"},{key:"red",value:"#C62222"},{key:"orange",value:"#D34F0B"},{key:"yellow",value:"#B67C04"},{key:"green",value:"#149343"},{key:"teal",value:"#0782A0"},{key:"blue",value:"#2159D3"},{key:"purple",value:"#842ED3"},{key:"grey",value:"#7A7A7A"}],this.fontSizeItems=[{text:"文本",value:"text",slashName:"Text"},{text:"标题 1",value:"h1",slashName:"Heading 1"},{text:"标题 2",value:"h2",slashName:"Heading 2"},{text:"标题 3",value:"h3",slashName:"Heading 3"},{text:"标题 4",value:"h4",slashName:"Heading 4"},{text:"标题 5",value:"h5",slashName:"Heading 5"},{text:"标题 6",value:"h6",slashName:"Heading 6"}],this.syncSelectionRange=()=>{var t;const e=this.checkEditor(!0);e&&e.selection.std.range.syncTextSelectionToRange((t=e.selection.value)==null?void 0:t[0])},this.checkEditor=e=>{var s;const{editor:t}=this.props;if(t)try{const n=t.editor;if(!n)return;const r=n.host;return!r||e&&!((s=r.selection.value)!=null&&s.length)?void 0:r}catch{return}},this.handleColorChange=e=>{var r;const t=this.checkEditor(!0);if(!t||(((r=this.getColor("color"))==null?void 0:r.value)||"")===e)return;const n=this.colorList.find(o=>o.value===e);t.selection.std.command.exec("formatText",{textSelection:t.selection.value[0],styles:{color:`var(--affine-text-highlight-foreground-${n==null?void 0:n.key})`}}),this.updateToolbarState()},this.handleBackgroundChange=e=>{var r;const t=this.checkEditor(!0);if(!t||(((r=this.getColor("background"))==null?void 0:r.value)||"")===e)return;const n=this.colorList.find(o=>o.value===e);t.selection.std.command.exec("formatText",{textSelection:t.selection.value[0],styles:{background:`var(--affine-text-highlight-${n==null?void 0:n.key})`}}),this.updateToolbarState()},this.handleFormat=e=>{var s,n;const t=this.checkEditor();if(t){if(e=="toggleLink")if(!((n=(s=t.selection.value[0])==null?void 0:s.from)!=null&&n.length))this.callSlashMenuAction("Link");else{t.selection.std.command.exec(e);return}t.selection.std.command.exec(e),this.updateToolbarState()}},this.callSlashMenuAction=e=>{var t;return(t=this.props.editor)==null?void 0:t.callSlashMenuAction(e)},this.renderButton=e=>{const{key:t,icon:s,command:n,hint:r,slashName:o,iconClass:a}=e,l=this._toolbarState[t];return g(we,{key:t,className:K("ghost",l?"text-primary":""),icon:s,iconClass:a,hint:r,onClick:()=>{o?this.callSlashMenuAction(o):n&&this.handleFormat(n)}})}}componentDidMount(){this.initColorPicker(),this.initSelectionListener()}componentDidUpdate(e){e.editor!==this.props.editor&&this.initSelectionListener()}componentWillUnmount(){this.colorPicker&&this.colorPicker.destroy(),this.bgColorPicker&&this.bgColorPicker.destroy(),this.removeSelectionListener()}async ensureEditor(){await Ss(500);const{editor:e}=this.props;return e?await e.ensureEditor():null}initColorPicker(){this.colorPickerRef&&(this.colorPicker=new _n(this.colorPickerRef,{className:"btn ghost px-2",icon:"icon-text-color",hint:"文字颜色",colors:["#30394A","#C62222","#D34F0B","#B67C04","#149343","#0782A0","#2159D3","#842ED3","#7A7A7A"],onChange:e=>this.handleColorChange(e),onClick:()=>this.syncSelectionRange()})),this.bgColorPickerRef&&(this.bgColorPicker=new _n(this.bgColorPickerRef,{className:"btn ghost px-2",icon:"pencil-alt",hint:"文字背景颜色",colors:["#C62222","#D34F0B","#B67C04","#149343","#0782A0","#2159D3","#842ED3","#7A7A7A"],onChange:e=>this.handleBackgroundChange(e),onClick:()=>this.syncSelectionRange()}))}initSelectionListener(){this.ensureEditor().then(e=>{if(!e)return;const t=e.host;t==null||t.selection.slots.changed.on(()=>{this.updateToolbarState()})})}getColor(e){const t=this._toolbarState[e],s=e=="color"?/var\(--affine-text-highlight-foreground-(.*?)\)/:/var\(--affine-text-highlight-(.*?)\)/,n=t.match(s),r=n?n[1]:"";return this.colorList.find(o=>o.key===r)}updataColorPicker(){var e,t;if(this.colorPicker){const s=this.getColor("color");(e=this.colorPicker.$)==null||e.changeState({value:(s==null?void 0:s.value)||""})}if(this.bgColorPicker){const s=this.getColor("background");(t=this.bgColorPicker.$)==null||t.changeState({value:(s==null?void 0:s.value)||""})}}removeSelectionListener(){const e=this.checkEditor();e==null||e.selection.slots.changed.dispose()}updateToolbarState(){const e=this.checkEditor();if(!e){this._toolbarState={bold:!1,italic:!1,underline:!1,strikethrough:!1,bulleted:!1,numbered:!1,fontSize:"text",color:"",background:""};return}const s=e.selection.std.command.exec("getTextStyle").textStyle,{selectedModels:n=[]}=e.selection.std.command.exec("getSelectedModels"),r=n[0],o=(r==null?void 0:r.flavour)==="affine:list",a=o?r==null?void 0:r.type:null,c=(r==null?void 0:r.flavour)==="affine:paragraph"&&["h1","h2","h3","h4","h5","h6"].includes(r==null?void 0:r.type)?r==null?void 0:r.type:"text",h={left:0,center:0,right:0,justify:0};let d=0;n.forEach(m=>{m.flavour==="affine:paragraph"&&(d++,h[m.align||"left"]++)});const f=Object.keys(h).find(m=>h[m]===d)||"";this._toolbarState={bold:s.bold||!1,italic:s.italic||!1,underline:s.underline||!1,strikethrough:s.strike||!1,bulleted:o&&a==="bulleted",numbered:o&&a==="numbered",fontSize:c,color:(s==null?void 0:s.color)||"",background:(s==null?void 0:s.background)||"",align:f},this.forceUpdate(),this.updataColorPicker()}setParagraphAlign(e){const t=this.checkEditor();if(!t)return;const{selectedModels:s=[]}=t.selection.std.command.exec("getSelectedModels"),n=s==null?void 0:s.filter(r=>(r==null?void 0:r.flavour)==="affine:paragraph");!n||!n.length||t.doc.transact(()=>{n.forEach(r=>{r.align=e})})}render(){var c,h;const{app:e}=this.props;this.fontSizeItems.forEach(d=>{d.onClick=this.callSlashMenuAction.bind(this,d.slashName)});const t=this._toolbarState.fontSize,s=this._toolbarState.align,n=this.fontSizeItems.filter(d=>d.value==t),r=((c=e.props)==null?void 0:c.moreMenu)||[],o=((h=e.props)==null?void 0:h.moreMenuAction)||(()=>{});o&&r.forEach(d=>{d.items?d.items.forEach(f=>{f.onClick=o.bind(this,f)}):d.onClick=o.bind(this,d)});const a=[{key:"two_equal",icon:"columns-2",text:"1:1",onClick:this.callSlashMenuAction.bind(this,"two_equal")},{key:"two_left_sidebar",icon:"columns-4",text:"1:2",onClick:this.callSlashMenuAction.bind(this,"two_left_sidebar")},{key:"two_right_sidebar",icon:"columns-4",text:"2:1",onClick:this.callSlashMenuAction.bind(this,"two_right_sidebar")},{key:"three_equal",icon:"columns-3",text:"1:1:1",onClick:this.callSlashMenuAction.bind(this,"three_equal")}],l=["left","center","right","justify"].map(d=>({key:d,icon:`text-${d}`,selected:d===s,onClick:this.setParagraphAlign.bind(this,d)}));return g("div",{className:"doc-toolbar flex items-center flex-wrap gap-1 absolute top-0 left-0 w-full bg-white border-b z-10",style:"min-height: 40px;"},g(ys,{className:"w-20",type:"ghost",text:n[0].text,trigger:"hover",items:this.fontSizeItems}),g("div",{className:"divider",style:"height: unset; margin-left: -4px;"}),this.formatButtons.map(this.renderButton),g("div",{className:"divider",style:"height: unset;"}),g("div",{ref:d=>this.colorPickerRef=d}),g("div",{ref:d=>this.bgColorPickerRef=d}),g("div",{className:"divider",style:"height: unset;"}),g(ys,{type:"ghost",icon:`text-${s||"left"}`,active:!s,trigger:"hover",items:l,menu:{className:"doc-toolbar-align-menu"}}),this.listButtons.map(this.renderButton),g("div",{className:"divider",style:"height: unset;"}),this.otherButtons.map(this.renderButton),g("div",{className:"divider",style:"height: unset;"}),this.basicButtons.map(this.renderButton),g(ys,{type:"ghost",icon:"columns-3",trigger:"hover",items:a}),g("div",{className:"divider",style:"height: unset;"}),this.databaseButtons.map(this.renderButton),r&&r.length>0&&g(ys,{type:"ghost",icon:"plus",trigger:"hover",items:r}))}}Oy.defaultProps={className:""};class qx extends ae{constructor(e){super(e),this._editor=ye(),this._titleEle=ye(),this._isLoadingLib=pe(!1),this._convertedToNewDoc=pe(0),this._gid=Ft(),this._saveTimer=0,this._dataTime=0,this._cacheDataTime=0,this._isLoadingFile=pe(!1),this._vanillaEditor=pe(),this._loadFileTimer=0,this._handleChange=t=>{const s=t.content;(s!==this._data.content||t.html!==this._data.html)&&(this._data.content=s,this._data.contentType=t.contentType,this._data.html=t.html,this._dataTime=Date.now(),this._callChange()),this.trySaveCache()},this._handleKeywordsChange=t=>{var r;const n=t.target.value.split(/,|，/).map(o=>o.trim()).filter(Boolean).join(", ");if(n!==this._data.keywords){this._data.keywords=n;const{editor:o}=this;o instanceof ii&&((r=o.$)==null||r.updateTags(n.split(", "))),this._callChange()}},this._handleTitleChange=t=>{var n;const s=t.target.value;if(s!==this._data.title){this._data.title=s;const{editor:r}=this;r instanceof ii&&((n=r.$)==null||n.updateTitle(s)),this._callChange()}},this._handleConvertDoc=async()=>{const{app:t}=this.props;await Ve.confirm({title:t.getLang("convertToNewDoc","转换文档"),content:t.getLang("convertToNewDocConfirm","确定要将此文档转换为新文档格式吗？")})&&await this._switchDoc(!0)},this._switchDoc=async t=>{const{doc:s}=this.props,n=s.$html;n&&this.triggerChange({content:n,contentType:"html",html:n}),await Ss(100),this._convertedToNewDoc.value=t?s.id:0},this._switchToOldDoc=()=>{this._switchDoc(!1)},this._handleLoadingLibChange=t=>{this._isLoadingLib.value=t},this._toggleFileLoading=t=>{this._loadFileTimer&&clearTimeout(this._loadFileTimer),t?(this._isLoadingFile.value=!0,this._loadFileTimer=0):this._loadFileTimer=window.setTimeout(()=>{this._isLoadingFile.value=!1,this._loadFileTimer=0},1500)},this._handleAwarenessUpdate=t=>{const{states:s}=t,{app:n}=this.props,r=Array.from(new Map(s.map(o=>o.user).map(o=>[o.id,o])).values());n.changeState({editingUsers:r})},this._handleDownload=async t=>{const{downloadUrl:s}=this.props,n=this.props.app.getDownloadUrl(t.key,s);this._toggleFileLoading(!0);let r=null;try{r=await(await fetch(n)).blob()}catch(o){console.error("[ZUI - DocEditor] download file failed",o)}return this._toggleFileLoading(!1),{blob:r}},this._handleUpload=async t=>{const{uploadUrl:s}=this.props,{key:n,blob:r,editorID:o}=t,a=await v.post($e(s,{uid:encodeURIComponent(o),extra:"editor",field:"imgFile",gid:btoa(n)}),{imgFile:r,"labels[]":[r.name]},"json");if(a&&typeof a=="object"&&a.result==="fail")throw a.message&&Ve.alert({title:a.message,content:r.name}),new Error(a.message||"Upload file failed")},this._handleEditorInit=t=>{this._vanillaEditor.value=t},this._data={title:e.doc.title,content:e.doc.content??""}}get gid(){return this._gid}get editor(){return this._editor.current}get cacheID(){return`doc-${this.props.mode==="edit"?this.props.doc.id:"new"}-${this._gid}`}async getData(e){const t=this._editor.current;if(t instanceof ii){const r={...await t.getData(),contentType:"doc"};return e!=null&&e.getHtml&&(r.html=await t.getHtml()),r}return await(t==null?void 0:t.getData())}focusTitle(){var e;(e=this._titleEle.current)==null||e.focus()}setTitle(e){this._data.title=e;const t=this._titleEle.current;t&&(t.value=e,this.triggerChange())}async triggerChange(e,t){var n;const s=await this.getData(t);!s&&!e||((n=this._handleChange)==null||n.call(this,{...s,...e}),this.saveCache())}saveCache(){this._cacheDataTime!==this._dataTime&&(v.db.setCacheData(this.cacheID,this._data,0,"docAppCache"),this._cacheDataTime=this._dataTime)}trySaveCache(){this._saveTimer&&clearTimeout(this._saveTimer),this._saveTimer=window.setTimeout(()=>{this.saveCache(),this._saveTimer=0},1e3)}removeCache(){v.db.deleteCacheData(this.cacheID,"docAppCache")}_callChange(){var t,s;const{doc:e}=this.props;(s=(t=this.props).onChange)==null||s.call(t,{id:e.id,...this._data})}_renderTitle(e){const{doc:{title:t,deleted:s},mode:n,app:r}=e;return n==="view"?s?g("div",{class:"flex gap-2 items-center"},g("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t),g("span",{class:"label danger"},r.getLang("deleted","已删除"))):g("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t):g("input",{key:"title",ref:this._titleEle,type:"text",class:"doc-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:t,onChange:this._handleTitleChange,placeholder:r.getLang("docTitlePlaceholder","请输入文档标题")})}_renderInfo(e){return g(Kx,{...e})}_renderKeywords(e){const{doc:{keywords:t},mode:s,app:n}=e,r=(t==null?void 0:t.split(/,|，/).map(a=>a.trim()).filter(Boolean))??[];if(s==="view")return g("div",{key:"kw",title:n.getLang("keywords","关键字"),class:`doc-editor-keywords row gap-2 px-1 my-2${r.length?"":" hidden"}`},r.map(a=>g("span",{className:"label label-sm secondary-outline"},a.trim())));const o=`doc-app-kw-${this._gid}`;return g("div",{key:"kw",className:"input-control has-prefix-icon my-2 doc-editor-keywords"},g("input",{key:"kw",type:"text",id:o,class:"form-control ring-0 shadow-none",defaultValue:r.join(", "),onChange:this._handleKeywordsChange,placeholder:n.getLang("keywordsPlaceholder","关键字，使用逗号分隔")}),g("label",{for:o,class:"input-control-prefix"},g("i",{className:"icon icon-tag"})))}componentDidMount(){this.props.mode==="edit"&&this.focusTitle()}render(e){var ne,Ce,Me,ze,He,te,X;const{className:t,doc:s,belowTitle:n,mode:r,uploadUrl:o,downloadUrl:a,app:l}=e,c=s.contentType==="doc"?"doc":s.contentType==="markdown"?"markdown":"html",h=c==="doc"&&!s.$convert,d=c==="markdown",f=r==="view",m=r==="edit",y=l.props.autoConvertDoc||s.status==="draft",b=this._convertedToNewDoc.value,w=m&&(s.contentType==="html"||s.contentType==="attachment"||s.$convert),x=!(s.content??"").trim().length,D=x&&r==="view",I=m&&w&&b===s.id,E=d||h||I||x,P=E?ii:Ry,O=s.content===void 0||s.content===null,W=this._isLoadingLib.value,J=O||W;let{useHocuspocus:Y}=l.props;Y=typeof Y=="function"?Y(l):Y;const ve=l.mode==="edit"&&Y,ee=typeof l.props.editorProps=="function"?l.props.editorProps(s,l):l.props.editorProps;return g("div",{class:K("doc-editor col",t,f?"is-readonly":"is-editing",D?"is-empty":"flex-auto")},(ne=l.props)!=null&&ne.showToolbar&&l.mode!="view"?g(Oy,{app:l,editor:this._vanillaEditor.value||((Ce=this._editor.current)==null?void 0:Ce.$)}):null,this._renderTitle(e),this._renderInfo(e),this._renderKeywords(e),y&&I&&E&&m?g("div",{className:"center mb-3"},g("div",{class:"row gap-2 items-center primary-pale pl-2 rounded-full"},g("p",{className:"text-gray"},l.getLang("oldDocEditingTip","此文档为旧版本编辑器创建，已启用新版编辑器编辑，保存后将转换为新版文档")),g(we,{text:l.getLang("switchToOldEditor","切换回旧编辑器"),size:"sm",type:"ghost",rounded:"full",className:"underline",onClick:this._switchToOldDoc}))):null,n,J?g("div",{className:"load-indicator loading relative h-48","data-loading":O?l.getLang("loadingDocTip","正在加载文档内容..."):W?l.getLang("loadingEditorTip","正在加载编辑器..."):""}):null,!J&&!D&&g(P,{ref:this._editor,key:`editor-${s.id}-${r}-${s.currentVersion||s.version}`,className:"doc-editor-control flex-auto",mode:h?"full":"page",autoInit:!0,onInit:this._handleEditorInit,readonly:f,downloadUrl:a,uploadUrl:o,onDownload:a?this._handleDownload:void 0,onUpload:this._handleUpload,uid:s.uid??`doc${s.id}`,content:s.content??"",title:s.title,tags:(Me=s.keywords)==null?void 0:Me.split(", "),contentType:c,placeholder:o?l.getLang("pasteImageTip","可以在编辑器直接贴图。"):"",onChange:this._handleChange,onLoadingLibChange:this._handleLoadingLibChange,token:l.props.token,docID:Gx(l.docID),useHocuspocus:ve,hocuspocusUrls:l.props.hocuspocusUrls,awarenessUser:l.props.awarenessUser,onAwarenessUpdate:this._handleAwarenessUpdate,onAuthenticationFailed:(ze=l.props.onAuthenticationFailed)==null?void 0:ze.bind(null,l),onConnect:(He=l.props.onHocuspocusConnect)==null?void 0:He.bind(null,l),onDisconnect:(te=l.props.onHocuspocusDisconnect)==null?void 0:te.bind(null,l),onClose:(X=l.props.onHocuspocusClose)==null?void 0:X.bind(null,l),...ee},y&&w&&!I?g("div",{className:"absolute right-0 top-1"},g(we,{type:"primary-pale",size:"md",onClick:this._handleConvertDoc},l.getLang("convertToNewDoc","转换为新文档格式"))):null))}}function Gx(i){if(typeof i=="number")return i;const e=i.match(/\d+/);return e?+e:0}const LD="",RD="",Zx=ut("file","ajaxQuery","fileID={gid}&objectType={objectType}&objectID={objectID}&title={title}&extra={extra}");async function jy(i){if(i.html)return i.html;switch(i.contentType){case"doc":return await gt.convertToHtml(i.content,void 0,Zx);case"markdown":return await gt.markdownToHtml(i.content);case"html":return i.content;default:return""}}async function Yx(i,e){if(!i||!e[0]||!e[1])return{oldHtml:"",newHtml:""};const t=ut("doc","ajaxGetDoc","docID={docID}&version={version}"),s=await Ne(t,[{docID:i,version:e[0]}]),n=await jy(s),r=await Ne(t,[{docID:i,version:e[1]}]),o=await jy(r);return{oldHtml:n,newHtml:o}}class By extends Ke{_loadAndDiff(){const{docID:e,versions:t}=this.props;Yx(e,t).then(async({oldHtml:s,newHtml:n})=>{const r=await kd.diff(s,n);this.changeState({html:r})})}componentDidMount(){super.componentDidMount(),this._loadAndDiff()}componentDidUpdate(e){(e.docID!==this.props.docID||e.versions!==this.props.versions)&&this._loadAndDiff()}render(){return g("div",{class:"doc-diff",dangerouslySetInnerHTML:{__html:this.state.html||""}})}}By.defaultProps={docID:0,versions:[0,0]};let su=class extends Ke{get actions(){return this.state.actions||this.props.actions||[]}getDefaultState(e){e=e||this.props;let{preserve:t,defaultReversed:s}=e;return t===!0&&(t=""),s===void 0&&typeof t=="string"&&(this._preserveID=`HistoryPanel.reversed${t.length?`:${t}`:""}`,s=st.get(this._preserveID)),e.actions&&(this._currentLoadID=[e.objectType,e.objectID].join()),{actions:e.actions,expandMap:{},reversed:s}}resetState(e,t){const s=this.getDefaultState(e);t?this.state=s:this.changeState(s)}componentDidMount(){v.on(`load.HistoryPanel.${this.gid}.zt`,(e,{objectType:t,objectID:s})=>{t===this.props.objectType&&String(s)===String(this.props.objectID)&&this.load()}),this.state.actions||this.load()}componentWillUnmount(){v.off(`.HistoryPanel.${this.gid}.zt`)}componentDidUpdate(){(!this.state.actions||this._currentLoadID!==[this.props.objectType,this.props.objectID].join())&&!this.state.loading&&this.load()}async load(){const{objectType:e,objectID:t}=this.props;let s=this.props.fetcher;s||(s=ut("action","ajaxGetList",`objectType=${e}&objectID=${t}`));const n=[e,t].join();if(this.state.loading)return;await this.changeState({loading:!0});const o={actions:await Ne(s,[{objectType:e,objectID:t}])||[],loading:!1},a=[this.props.objectType,this.props.objectID].join();a!==n?delete o.actions:this._currentLoadID=a,await this.changeState(o)}reverse(e){return e===void 0&&(e=!this.state.reversed),this.changeState({reversed:e},()=>{typeof this._preserveID=="string"&&st.set(this._preserveID,e)})}toggle(e,t){return this.changeState(s=>{const{expandMap:n}=s;return t===void 0&&(t=!n[e]),{expandMap:{...n,[e]:t}}})}isAllExpanded(){const{expandMap:e}=this.state;return this.actions.every(t=>{const{history:s,historyChanges:n}=t;return!(s&&s.length||typeof n=="string"&&n.length)||e[t.id]})}toggleAll(e){return e===void 0&&(e=!this.isAllExpanded()),this.changeState({expandMap:e?this.actions.reduce((t,s)=>({...t,[s.id]:e}),{}):{}})}_getClassName(e){return[super._getClassName(e),"history-panel",e.panel?"panel":""]}_getChildren(e){const t=this._buildHeader(e),s=this._buildBody(e);return e.panel?[t?g("div",{key:"heading",className:"panel-heading"},t):null,g("div",{key:"body",className:"panel-body"},s)]:[t,s]}_buildFiles(e){let t=e.files;return Array.isArray(t)&&(t={items:t}),!t||!t.items?null:g(ei,{key:"files",className:"bg-primary-50 py-1 px-1.5",...this.props.fileListProps,...t})}_buildAction(e,t,s,n){const{history:r,historyChanges:o}=e,a=r&&r.length||typeof o=="string"&&o.length,l=typeof e.comment=="string"&&e.comment.length,c=`${t+1}`,h={component:"li",key:String(e.id),"data-id":e.id,"data-action":e.action,className:["history-panel-action list-item item",a?s?"is-expanded":"is-collapsed":""],innerClass:"item-inner list-item-inner",avatar:{className:"text-gray ring canvas",background:"",size:16,circle:!0,...e.action==="finished"?{icon:{icon:"check",className:"text-success"}}:{children:g("span",{style:c.length>1?{transform:`scale(${1-c.length*.1})`}:void 0},c)}},title:{html:e.content},text:a?g(we,{icon:s?"minus":"plus",type:"ghost",size:"xs",className:"history-panel-action-toggle ring text-gray scale-75",onClick:this.toggle.bind(this,e.id,void 0)}):null,children:a&&s||l?g("div",{className:"history-panel-action-content pl-6 col gap-1 mb-1"},a&&s?typeof o=="string"&&o.length?g("div",{key:"history",className:"history-panel-action-history pl-1",dangerouslySetInnerHTML:{__html:o}}):g("ul",{key:"history",className:"history-panel-action-history col pl-1"},r.map(d=>g("li",{key:d.id,className:"history-panel-history-item",dangerouslySetInnerHTML:{__html:d.content}}))):null,e.comment?g("div",{key:"comment",className:`history-panel-action-comment py-2 surface relative ${e.commentEditable?"pl-3 pr-6":"px-3"}`},e.commentEditable?g(we,{key:"btn",type:"ghost",icon:"pencil",size:"sm",className:"comment-btn hover:text-primary absolute top-1 right-1","data-toggle":"comment","data-action-ID":e.id,url:n.editCommentUrl?n.editCommentUrl.replace("{actionID}",String(e.id)):void 0}):null,g("div",{className:"article",key:"comment",dangerouslySetInnerHTML:{__html:e.comment}})):null,this._buildFiles(e)):null};return g(Is,{...h})}_buildBody(e){const{actions:t}=this,{loading:s,expandMap:n,reversed:r}=this.state;return g("ul",{key:"actions",className:K("list history-panel-body load-indicator",{loading:s},r?"col-reverse":"col",e.bodyClass)},t.map((o,a)=>this._buildAction(o,a,n[o.id],e)))}_buildHeader(e){let{header:t}=e;if(!t)return null;const{title:s="History",toolbar:n=!0,commentBtn:r=!0}=e,o=[];if(n){const{reversed:a}=this.state,l=this.isAllExpanded(),{actions:c}=this,h={key:"toolbar",className:"history-panel-toolbar",gap:1,items:[c.length>1?{icon:a?"arrow-down":"arrow-up",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.reverse.bind(this,void 0)}:null,c.some(d=>{const{history:f,historyChanges:m}=d;return f&&f.length||typeof m=="string"&&m.length})?{icon:l?"minus":"plus",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.toggleAll.bind(this,void 0)}:null].filter(Boolean)};typeof n=="object"&&Object.assign(h,n),h.items&&(!Array.isArray(h.items)||h.items.length)&&o.push(g(Be,{...h}))}if(r){const a={key:"commentBtn",type:"ghost",className:"comment-btn text-gray",size:"sm",url:e.commentUrl,icon:{icon:"message",className:"icon-sm text-primary"},"data-toggle":"comment","data-object-ID":e.objectID,"data-object-type":e.objectType};typeof r=="object"?Object.assign(a,r):typeof r=="string"&&(a.text=r),o.push(g(we,{...a}))}return t={key:"header",className:"history-panel-header",title:s,titleClass:"font-bold mr-1",content:o,contentClass:"flex items-center flex-auto gap-2",...typeof t=="object"?t:{}},g(Is,{...t})}};su.defaultProps={header:!0,panel:!0,preserve:!0};class io extends ae{constructor(){super(...arguments),this._ref=ye(),this._timer=0,this._editorSelector="page-editor,affine-page-root,zen-editor,.doc-editor-content",this.state={},this._getItem=e=>{var t;return e.innerClass=(t=e.text)!=null&&t.length?"":"hidden",e},this._handleClickItem=e=>{var t;(t=e.event.target)!=null&&t.closest(".tree-toggle")||this.scrollIntoDoc(e.item)}}update(){var l,c;const e=this.props.container||((l=this._ref.current)==null?void 0:l.closest(".doc-view"));if(!e)return;this._container!==e&&(this._container&&v(this._container).off(".doc-outline"),this._container=e,v(e).on("docChange.doc-outline",()=>{this.tryUpdate()}));const s=v(e).find(this._editorSelector)[0];if(!s)return;const n=s.tagName.toLowerCase(),r=n==="zen-editor"?"zen":n==="page-editor"||n==="affine-page-root"?"blocksuite":"html";this._editorType=r;const o=r==="blocksuite"?io.getBlocksuiteHeadings(s):io.getEditorHeadings(s),a=io.formHeadings(o);this._lastDocID=(c=this.props.doc)==null?void 0:c.id,this.setState({items:a})}tryUpdate(){var e;this._timer&&clearTimeout(this._timer),this._lastDocID!==((e=this.props.doc)==null?void 0:e.id)&&this.setState({items:void 0}),this._timer=window.setTimeout(()=>{this.update(),this._timer=0},1e3)}scrollIntoDoc(e){var n,r,o,a;const t=this._container;if(!t)return;const s=v(t).find(this._editorSelector)[0];if(s)if(this._editorType==="blocksuite")(n=s.querySelector(`affine-paragraph[data-block-id="${e.id}"]`))==null||n.scrollIntoView({behavior:"smooth",block:"start"});else{const c=(((a=(o=(r=s.shadowRoot)==null?void 0:r.querySelector("zen-editor-core"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector("zen-editor-content"))||s).querySelectorAll("h1,h2,h3,h4,h5,h6");if(!c)return;const{text:h,level:d}=e;let f=e.index!==void 0?c[e.index]:void 0;(!f||f.textContent!==h||f.tagName!==`H${d}`)&&(f=Array.from(c).find(m=>m.textContent===h&&m.tagName===`H${d}`)),f&&f.scrollIntoView({behavior:"smooth",block:"start"})}}componentDidMount(){this.tryUpdate()}componentDidUpdate(e){this.props.doc!==e.doc&&this.tryUpdate()}componentWillUnmount(){this._container&&v(this._container).off(".doc-outline"),this._timer&&clearTimeout(this._timer)}render(e,t){const{items:s}=t,n=e.app.props.docOutlineTreeProps;return g("div",{className:"doc-outline",ref:this._ref},s?s.length?g(zt,{items:s,defaultNestedShow:!0,getItem:this._getItem,nestedToggle:".tree-toggle",onClickItem:this._handleClickItem,...n?typeof n=="function"?n.call(this,e.doc,s):n:{}}):g("div",{className:"text-gray p-2"},e.app.getLang("noOutline","没有大纲")):g("div",{className:"text-gray p-1"},e.app.getLang("loading","加载中...")))}static formHeadings(e){let t,s=e.reduce((n,r)=>{r.text=r.text.trim();const{level:o}=r;if(!r.text.length&&(o===1||t&&t.level===o))return n;if(o>1){t||(t={level:1,text:"",id:""},n.push(t));let a;if(t.level===o-1)a=t;else if(t.level>=o){for(;t.level>=o;)t.parent&&(t=t.parent);a=t}else{for(;t.level<o-1;){const l={level:t.level+1,text:"",id:"",parent:t};t.items||(t.items=[]),t.items.push(l),t=l}a=t}r.parent=a,a.items||(a.items=[]),a.items.push(r)}else n.push(r);return t=r,n},[]);return s.length===1&&s[0].text===""&&(s=s[0].items||[]),s}static getBlocksuiteHeadings(e){const t=[],s=(n,r)=>{var a;const o=((a=n.querySelector("v-text"))==null?void 0:a.textContent)??"";t.push({id:n.closest("affine-paragraph").dataset.blockId??`${r}_${o}`,text:o,level:r})};return e.querySelectorAll(".affine-paragraph-rich-text-wrapper").forEach(n=>{const r=n.classList;let o=0;r.contains("h1")?o=1:r.contains("h2")?o=2:r.contains("h3")?o=3:r.contains("h4")?o=4:r.contains("h5")?o=5:r.contains("h6")&&(o=6),o&&s(n,o)}),t}static getEditorHeadings(e){var n,r,o;const t=[],s=((o=(r=(n=e.shadowRoot)==null?void 0:n.querySelector("zen-editor-core"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector("zen-editor-content"))||e;return s&&s.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(a=>{const l=a.textContent||"",c=a.id,h=parseInt(a.tagName[1]);l.length&&h<7&&t.push({index:t.length,level:h,text:l,id:c})}),t}}const Hy=class If extends ae{constructor(e){super(e),this._ref=ye();const{defaultStatus:t=If.defaultProps.defaultStatus}=e;this._status=e.status||pe(t)}toggleTab(e){e===void 0?this._status.value=this._status.value?!1:If.defaultProps.defaultStatus:this._status.value=e===!1||this._status.value===e?!1:e}_renderContent(e,t,s){var o;if(!e||!s)return null;const{doc:n,app:r}=t;if(s.render)return g(fe,{content:s.render(n)});if(e==="info"){const{creator:a,modifier:l}=t,c=[{label:r.getLang("docStatus","状态"),content:n.status==="draft"?g("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},r.getLang("draft","草稿")):n.status==="pause"?r.getLang("pause","已暂停"):r.getLang("released","已发布")},{label:r.getLang("creator","创建者"),content:a.realname},{label:r.getLang("createDate","创建时间"),content:rt(n.addedDate)},{label:r.getLang("modifier","修改者"),content:l==null?void 0:l.realname},n.editedDate?{label:r.getLang("editDate","修改时间"),content:rt(n.editedDate)}:null,{label:r.getLang("viewsCount","阅读次数"),content:n.views},{label:r.getLang("collectCount","收藏次数"),content:[n.collects,n.isCollector?g("span",{className:"label side-sm rounded-full warning-pale"},r.getLang("collected","已收藏")):null]}].filter(Boolean);return g("div",{className:"col gap-2"},g("div",{className:"font-bold px-1"},r.getLang("docInfo","文档信息")),g(sy,{items:c}))}if(e==="outline")return g("div",{className:"col gap-2"},g("div",{className:"font-bold px-1"},s.title??r.getLang("docOutline","文档大纲")),g(io,{app:r,container:(o=this._ref.current)==null?void 0:o.closest(".doc-view"),doc:n}));if(e==="history")return wy(n.rawID)?null:g("div",{style:"margin-top: -6px"},g(su,{panel:!1,title:s.title??r.getLang("history","历史记录"),objectType:n.api?"api":"doc",objectID:n.rawID,fetcher:t.historyFetcher,...t.historyPanel}))}_renderNav(e,t,s){const{app:n}=t;return g("menu",{key:"nav",className:"doc-view-sidebar-nav nav nav-stacked gap-1 p-1 flex-none rounded-lg"},s.map(({icon:r,title:o,key:a})=>g("li",{class:"nav-item item hint-left","data-hint":o,key:a},g("a",{className:`rounded-lg${e===a?" active":""}`,"zui-command":`toggleViewSideTab/${a}`},g(Ie,{icon:r})))),s.length?g("li",{key:"divider",class:"nav-divider divider"}):null,g("li",{class:"nav-item item hint-left","data-hint":n.fullscreen?n.getLang("exitFullscreen","退出全屏"):n.getLang("enterFullscreen","进入全屏")},g("a",{className:"rounded-lg","zui-command":"toggleFullscreen"},g(Ie,{icon:n.fullscreen?"fullscreen-exit":"fullscreen"}))),e?g("li",{class:"nav-item item hint-left","data-hint":n.getLang("collapse","收起")},g("a",{className:"rounded-lg","zui-command":"toggleViewSideTab/false"},g(Ie,{icon:"icon-menu-arrow-right"}))):null)}render(e){var h;const{className:t,app:s,doc:n,showTabsNav:r}=e;let o=this._status.value;const a=wy(+n.id);o&&a&&(o="outline");const l=((h=s.props.getDocViewSidebarTabs)==null?void 0:h.call(s,n,{isNewDoc:a,mode:s.mode}))||[{icon:"list-box",title:s.getLang("docOutline","文档大纲"),key:"outline"}],c=l==null?void 0:l.find(d=>d.key===o);return c||(o=""),!r&&!o?null:g("div",{className:K("doc-view-sidebar flex-none z-50 sticky top-3 right-1 mx-2 mt-2 self-start",t,`is-${o?"opened":"closed"}`,`is-${o}`,r?`has-tabs-nav-${r}`:""),ref:this._ref},g("div",{className:"doc-view-sidebar-container border shadow rounded-lg row items-stretch"},g("div",{key:"content",className:"doc-view-sidebar-content p-2 border-r flex-auto overflow-y-auto scrollbar-hover"},this._renderContent(o,e,c)),r?this._renderNav(o,e,l):g(we,{type:"ghost",size:"sm",icon:"close text-gray",className:"absolute top-1.5 right-1.5 z-10",command:"toggleViewSideTab/false"})))}};Hy.defaultProps={defaultStatus:"outline",showTabsNav:"right"};let Jx=Hy;class Xx extends ae{constructor(e){super(e),this._editorRef=ye(),this._ref=ye(),this._sidebarRef=ye(),this._currentDocID=pe(""),this._modeChangeEffect=Tt(()=>{this.props.app.mode!=="view"&&(this._currentDocID.value="")}),this.tryLoadDoc=hh(()=>{if(this.props.mode!=="view")return;const r=this._currentDocID.value;if(r){const[o,a]=r.split(",").map(si);this.props.app.loadDoc(o,a)}},100),this._docChangeEffect=Tt(()=>{const{docID:r,docVersion:o}=this.props.app.signals,a=[r,o].join();a!==this._currentDocID.value&&(this._currentDocID.value=a,this.props.mode==="view"&&this.tryLoadDoc())}),this._handleChange=r=>{const{doc:o,mode:a="view",onChange:l}=this.props;l==null||l(r,a,o),v(this.element).trigger("docChange",[r,a,o])};const{preserve:t,app:s}=e,n=t?`${t}-expanded`:null;s.props.openViewSidebar!==void 0?this._status=pe(s.props.openViewSidebar):this._status=pe(n?st.get(n,!1):!1),n&&this._status.subscribe(r=>{st.set(n,r)})}get editor(){return this._editorRef.current}get element(){return this._ref.current}get sidebar(){return this._sidebarRef.current}componentWillUnmount(){this._modeChangeEffect(),this._docChangeEffect(),this.tryLoadDoc.cancel()}_renderEditor(e){const{doc:t,mode:s="view",uploadUrl:n,downloadUrl:r,app:o}=e,a=o.renderCustom("editor");return a!==void 0?a:g(qx,{app:o,ref:this._editorRef,mode:s,doc:t,uploadUrl:n?$e(n,{objectID:s==="create"?0:t.id,objectType:"doc",api:t.contentType==="doc"?"true":"",extra:t.contentType==="doc"?"editor":""}):void 0,downloadUrl:r?$e(r,{id:t.id,objectID:t.id,objectType:"doc"}):void 0,onChange:this._handleChange})}_renderDiff({doc:e}){const{diffVersions:t}=this.props.app.signals;return g(By,{docID:e.id,versions:t.value})}render(e){var b,w;const{doc:t,fileActions:s,fileIcon:n,fileUrl:r,creator:o,modifier:a,onGetUser:l,historyFetcher:c,highlight:h,app:d,mode:f}=e,m=this._status.value,y=(b=d.props)!=null&&b.showToolbar&&d.mode!="view"?"pt-10":"";return g("div",{className:K("doc-view absolute inset-0 canvas z-10 row",y,`is-sidebar-${m?"opened":"closed"}`,h?"highlight":""),ref:this._ref},g("div",{class:"doc-view-content col gap-4 flex-auto overflow-auto scrollbar-hover"},f==="diff"?this._renderDiff(e):this._renderEditor(e),(w=t.files)!=null&&w.length?g(ei,{className:"doc-files my-4 px-3 py-2 surface rounded-lg",heading:{icon:"paper-clip",title:d.getLang("attachment","附件")},items:t.files,fileActions:s,fileIcon:n,fileUrl:r,itemProps:{target:"_blank"},hoverItemActions:!0}):null),g(Jx,{ref:this._sidebarRef,app:d,doc:t,creator:o,modifier:a,status:this._status,historyFetcher:c,historyPanel:d.props.historyPanel,onGetUser:l,showTabsNav:!1}))}}function Uy(i,e){const{page:t,recPerPage:s}={page:1,recTotal:i.length,pageTotal:Math.ceil(i.length/20),recPerPage:20,...e},n=(t-1)*s,r=t*s;return i.slice(n,r)}class Qx extends ae{constructor(e){var s;super(e),this._libsMap=pe({}),this._filterType=pe(),this._loading=pe(!1),this._currentFilterType=xe(()=>{const{app:n}=this.props,r=this._filterType.value,o=n.spaceType;return r||(o==="product"||o==="project"?"mine":"all")}),this._spaceList=xe(()=>{const{app:n}=this.props;let r=n.signals.spaces.value;const o=this._currentFilterType.value,a=n.spaceType,l=n.props.isMatchFilter;return o&&l&&(r=r.filter(c=>l.call(n,a,o,c))),r.sort((c,h)=>c.order-h.order)}),this._pagedSpaceList=xe(()=>{const n=this._spaceList.value;return Uy(n,this.props.app.signals.pager.value)}),this._autoLoadLibs=Tt(()=>{const n=this._spaceList.value;this.loadLibs(n.map(r=>r.id))}),this._handleFilterTypeClick=n=>{const o=n.target.getAttribute("data-type");o&&(this._filterType.value=o)},this._handleLibClick=n=>{const r=v(n.target);if(r.closest(".toolbar").length)return;const o=r.closest("[z-lib]").z("lib"),a=r.closest("[z-space]").z("space");!o||!a||this.props.app.selectSpace(a,+o)},this._handleChangePager=n=>{this.props.app.resetPager("home",{...n})};const t=e.app.getFilterTypes("home")||[];this._filterType.value=(s=t[0])==null?void 0:s[0]}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const s=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0;this._loading.value=!0;const n=await Ne(t,[{spaceList:e,spaceType:this.app.spaceType}],s);fn(()=>{this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...n},this._loading.value=!1})}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,n=this._spaceList.value.length,r=t.getFilterTypes("home")||[],o=this._currentFilterType.value;return g("div",{key:"header",class:"doc-app-header flex-none surface-light row items-center border-b py-2 pl-1 pr-2 flex-none"},g("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},r.map(([a,l])=>g("li",{key:a,className:"nav-item item"},g("a",{className:a===o?"active rounded":"rounded","data-type":a},l,a===o&&n?g("span",{className:"label size-sm canvas ring-0 rounded-md"},n):null)))),g("div",{className:"flex-auto"}),g(Be,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,n=this._libsMap.value[e];if(n)return n;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const h of o){const d=h.lib,f=c.get(d)||0;c.set(d,f+1)}for(const h of a)if(!(h.deleted||h.space!==e)&&(r.push({id:h.id,name:h.name,docs:c.get(h.id)||0}),l&&r.length>=l))break;return r}_renderSpace(e,t){var c;const{app:s}=t,n=s.getItemActions("space",e,"space-card"),r=[{text:s.getLang("enterSpace","进入空间"),textClass:"text-primary",command:`selectSpace/${e.id}/true`},...n];let o=this._getSpaceLibs(e.id);const a=s.props.libColors;let l;return o?o.length?(o.length>5&&(o=o.slice(0,5)),l=g("div",{class:"row flex-wrap"},o.map(h=>{const d=s.getItemActions("lib",h,"space-card");return g("div",{className:"doc-space-card-lib p-1.5 w-1/5 group"},g("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleLibClick,"z-lib":h.id,"z-space":e.id},g(Ie,{icon:"doclib text-2xl",style:a?{color:a[h.id%a.length]}:null}),g("div",{class:"font-bold text-clip",title:h.name},h.name),g("div",{class:"text-gray text-sm"},h.docs?s.getLang("docsTotalInfo",[h.docs],"共 {0} 个文档"):s.getLang("noDocs","没有文档")),d!=null&&d.length?Be.render({items:d},[],{size:"sm",type:"ghost",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100"}):null))}))):l=g("div",{className:"center gap-4 py-3"},g("div",{className:"text-gray"},s.getLang("noLibs","没有文档库")),(c=s.props.privs)!=null&&c.createLib?g(we,{type:"primary-pale",icon:"plus",command:`createLib/${e.id}`},s.getLang("createLib","创建文档库")):null):l=g("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),g("div",{class:"doc-space-card ring rounded surface-light",key:e.id},g("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},g("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},g(Ie,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),g("div",{className:"min-w-0 flex-auto"},g("strong",null,e.name))),g(Be,{size:"md",items:r})),g("div",{class:"doc-space-card-libs p-1.5",style:"min-height: 118px"},l))}_renderBody(e){const t=this._pagedSpaceList.value;return g("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(s=>this._renderSpace(s,e)),t.length===0?g("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._spaceList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return g("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},g("div",{class:"flex-auto"}),g(Kr,{...t}))}componentDidMount(){this.props.app.resetPager("home",{recTotal:this._spaceList.value.length})}componentWillUnmount(){this._autoLoadLibs()}render(e){return this._loading.value?g("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":e.app.getLang("loadingDocsData","正在加载文档数据...")}):[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}const ek=i=>{var t,s;i=JSON.parse(JSON.stringify(i));const e=new Map;for(const n of i){const r=String(n.id);e.has(r)?n.items&&((s=(t=e.get(r))==null?void 0:t.items)==null||s.push(...n.items)):e.set(r,n)}return Array.from(e.values())};class tk extends ae{constructor(e){super(e),this._libsMap=pe({}),this._filterType=pe(),this._programData=pe(),this._hasDocsOnly=pe(!1),this._showClosed=pe(!1),this._otherPrograms=xe(()=>{var s;if(!this._programData.value)return[];const t=[];if(t.push(...this._programData.value.data.other),this._showClosed.value){const n=this._programData.value.data.closed;for(const r of n){const o={...r,items:(s=r.items)==null?void 0:s.filter(a=>!a.isPO&&!a.involved)};t.push(o)}}return t}),this._myPrograms=xe(()=>{var s;if(!this._programData.value)return[];const t=[];if(t.push(...this._programData.value.data.my),this._showClosed.value){const n=this._programData.value.data.closed;for(const r of n){const o={...r,items:(s=r.items)==null?void 0:s.filter(a=>a.isPO||a.involved)};t.push(o)}}return t}),this._currentFilterType=xe(()=>{const t=this._filterType.value;return t||"mine"}),this._programList=xe(()=>{const s=this._currentFilterType.value==="mine"?this._myPrograms.value:this._otherPrograms.value;return ek(s)}),this._pagedProgramList=xe(()=>{const t=this._programList.value;return Uy(t,this.app.signals.pager.value)}),this._spaceList=xe(()=>{const{app:t}=this.props;let s=t.signals.spaces.value;const n=this._currentFilterType.value,r=t.spaceType,o=t.props.isMatchFilter;return n&&o&&(s=s.filter(a=>o.call(t,r,n,a))),s.sort((a,l)=>a.order-l.order)}),this._autoLoadLibs=Tt(()=>{const t=this._spaceList.value;this.loadLibs(t.map(s=>s.id))}),this._handleFilterTypeClick=t=>{const n=t.target.getAttribute("data-type");n&&(this._filterType.value=n)},this._handleSpaceClick=t=>{const s=v(t.target);if(s.closest(".toolbar").length)return;const n=s.closest("[z-space]").z("space");n!=null&&this.props.app.selectSpace(n,!0)},this._handleChangePager=t=>{this.props.app.resetPager("home",{...t})},this._filterType.value="mine"}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const s=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0,n=await Ne(t,[{spaceList:e,spaceType:this.app.spaceType}],s);this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...n}}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,s=this._programList.value.length,n=t.spaceType==="product"?[["mine",t.getLang("productMine")],["other",t.getLang("productOther")]]:[["mine",t.getLang("projectMine")],["other",t.getLang("projectOther")]],r=this._currentFilterType.value;return g("div",{key:"header",class:"doc-app-header flex-none surface-light row gap-2 items-center border-b py-2 pl-1 pr-2 flex-none"},g("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},n.map(([o,a])=>g("li",{key:o,className:"nav-item item"},g("a",{className:o===r?"active rounded":"rounded","data-type":o},a,o===r&&s?g("span",{className:"label size-sm canvas ring-0 rounded-md"},s):null)))),g(qs,{id:"show-no-doc",name:"show-no-doc",defaultChecked:this._hasDocsOnly.value,label:t.getLang(t.spaceType==="product"?"showHasDocsOnlyProduct":"showHasDocsOnlyProject"),onChange:(o,a)=>{typeof a=="boolean"&&(this._hasDocsOnly.value=a)}}),g(qs,{id:"show-closed",name:"show-closed",defaultChecked:this._showClosed.value,label:t.getLang(t.spaceType==="product"?"showClosedProduct":"showClosedProject"),onChange:(o,a)=>{typeof a=="boolean"&&(this._showClosed.value=a)}}),g("div",{className:"flex-auto"}),g(Be,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,n=this._libsMap.value[e];if(n)return n;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const h of o){const d=h.lib,f=c.get(d)||0;c.set(d,f+1)}for(const h of a)if(!(h.deleted||h.space!==e)&&(r.push({id:h.id,name:h.name,docs:c.get(h.id)||0}),l&&r.length>=l))break;return r}_getSpaceDocSum(e){var t;return((t=this._getSpaceLibs(e))==null?void 0:t.map(s=>s.docs).reduce((s,n)=>s+n,0))||0}_renderProgram(e,t){var a;const{app:s}=t,n=this._hasDocsOnly.value?(a=e.items)==null?void 0:a.filter(l=>this._getSpaceDocSum(Number(l.id))>0):e.items,r=s.props.libColors;let o;return e?n!=null&&n.length?o=g("div",{class:"row flex-wrap"},n.map(l=>{const c=this._getSpaceDocSum(l.id);return g("div",{className:"doc-space-card-lib p-1.5 w-1/5 group",key:l.id},g("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleSpaceClick,"z-space":l.id},g(Ie,{icon:"doclib text-2xl",style:r?{color:r[Number(l.id)%r.length]}:null}),g("div",{class:"font-bold text-clip",title:l.text},l.text),g("div",{class:"text-gray text-sm"},c?s.getLang("docsTotalInfo",[c],"共 {0} 个文档"):s.getLang("noDocs","没有文档"))))})):o=g("div",{className:"center gap-4 py-3"},g("div",{className:"text-gray"},s.getLang(s.spaceType==="product"?"noProducts":"noProjects"))):o=g("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),g("div",{class:"doc-space-card ring rounded surface-light",key:e.id},g("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},g("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},g(Ie,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),g("div",{className:"min-w-0 flex-auto"},g("strong",null,e.text)))),g("div",{class:"doc-space-card-libs p-1.5",style:"min-height: 118px"},o))}_renderBody(e){const t=this._pagedProgramList.value;return g("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(s=>this._renderProgram(s,e)),t.length===0?g("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._programList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return g("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},g("div",{class:"flex-auto"}),g(Kr,{...t}))}componentDidMount(){var t,s;this.props.app.resetPager("home",{recTotal:this._programList.value.length,recPerPage:5});const e=(s=(t=this.props.app.props).getSpaceFetcher)==null?void 0:s.call(t,this.props.app.spaceType);e&&Ne(e).then(n=>void(this._programData.value=n))}componentWillUnmount(){this._autoLoadLibs()}render(e){return[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}class sk extends ae{constructor(){super(...arguments),this._dtable=ye(),this._handleCellClick=(e,t)=>{var n;const s=(n=t.rowInfo)==null?void 0:n.data;this.props.app.selectDoc(s)}}_getCols(){return[{name:"title",onRenderCell:function(e,t){const s=t.row.data;return[{className:`api-list-item row items-center my-0.5 mx-1 gap-2 flex-auto is-${s.method} cursor-pointer rounded`,html:[`<div class="font-mono w-14 text-center api-method py-1 rounded rounded-r-none">${s.method}</div>`,`<div class="font-mono api-path">${s.path}</div>`,`<div class="flex-auto text-right api-title pr-2">${s.originTitle}</div>`].join("")}]}}]}_getTableOptions(e){var h;const{app:t,docs:s}=e,n=t.lib,r=n==null?void 0:n.data.orderBy;let o="",a="";typeof r=="string"&&r&&([o,a]=r.split("_"));const l=s.map(d=>d.data);["order","id"].includes(o)&&a&&(a==="asc"?l.sort(o==="order"?(d,f)=>d.order-f.order:(d,f)=>(d.rawID??+d.id)-(f.rawID??+f.id)):l.sort(o==="order"?(d,f)=>f.order-d.order:(d,f)=>(f.rawID??+f.id)-(d.rawID??+d.id)));const c={width:"100%",height(d){var m;const f=(m=this.element)==null?void 0:m.parentElement;return f?Math.min(d,f.clientHeight):d},cols:this._getCols(),data:l,header:!1,checkable:!1,footer:["flex","pager"],localPager:!0,emptyTip:g("div",{className:"center gap-4"},g("div",{className:"text-gray"},t.getLang("noApi","没有 API")),Be.render({items:t.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:t.getPagerItems()},onCellClick:this._handleCellClick};return((h=t.getTableOptions)==null?void 0:h.call(t,c,{type:"api-list"}))??c}render(e){return g("div",{class:K("doc-list doc-api-list h-full col",e.className)},g(ti,{ref:this._dtable,...this._getTableOptions(e)}))}}class Yi extends be{static update(e){v.trigger("load.HistoryPanel",e)}}Yi.NAME="HistoryPanel",Yi.Component=su,Yi.replace=!0,Yi.register();function nu(i){const{objectType:e,objectID:t,actionID:s,url:n,...r}=i;let o=n;return!o&&(s||e&&t)&&(o=ut("action",s?"editComment":"comment",s?`actionID=${s}`:`objectType=${e}&objectID=${t}`)),Ve.open({id:`modal-comment-${s?`edit-${s}`:`${e}-${t}`}`,url:o,hideOthers:!1,...r})}v(document).on("click.zt",'[data-toggle="comment"]',i=>{i.preventDefault();const e=v(i.currentTarget);if(e.is(".disabled,:disabled"))return;const t=e.data();if(e.is("a")){const s=e.attr("href");s&&(t.url=s)}t.objectId?(t.objectID=+t.objectId,delete t.objectId):t.actionId&&(t.actionID=+t.actionId,delete t.actionId),delete t.toggle,nu(t)}),Object.assign(Ve,{comment:nu});const zD="",iu=class rb extends ca{constructor(e){var t;super(e),this._loadingDocs=new Map,this._viewRef=ye(),this._homeRef=ye(),this._treeMap=xe(()=>{const{spaceID:s,libs:n,modules:r,docs:o}=this.signals;return Nx(s.value,{libs:n.value,modules:r.value,docs:o.value},!!this.props.noSpace)}),this._space=xe(()=>{const{spaces:s,spaceID:n}=this.signals,r=n.value;return s.value.find(o=>o.id===r)}),this._spaceList=xe(()=>{const{spaces:s,spaceType:n}=this.signals,r=n.value;return s.value.filter(o=>!o.deleted&&o.type===r)}),this._libList=xe(()=>this._treeMap.value.libList),this._docList=xe(()=>{const{lib:s,module:n,doc:r}=this;return(r==null?void 0:r.data.type)==="chapter"?this._filterDocs(to(r,[],!0),{api:(s==null?void 0:s.data.type)==="api"}):n||s?this._filterDocs(to(n||s,[],!0),{api:(s==null?void 0:s.data.type)==="api"}):this._filterDocs(void 0,{api:!1})}),this._doc=xe(()=>this._treeMap.value.docs.get(this.signals.docID.value)),this._viewingDoc=xe(()=>{const s=this._doc.value,n=this.signals.docVersion.value;return!s||!n||n===s.data.version||!s.data.versions?s:{...s,data:{...s.data,...s.data.versions[n]||{content:null},currentVersion:n}}}),this._module=xe(()=>{var n;const s=((n=this._doc.value)==null?void 0:n.data.module)||this.signals.moduleID.value;return this._treeMap.value.modules.get(s)}),this._lib=xe(()=>{var n;const s=((n=this._module.value)==null?void 0:n.data.lib)||this.signals.libID.value;return this._treeMap.value.libs.get(s)}),this._viewType=xe(()=>this._viewInfo.value[0]),this._viewInfo=xe(()=>{var a;const s=this.signals.mode.value;let n;const r=this.signals.creatingDoc.value,o=this.signals.editingDoc.value;if(s==="create")n=r;else if(s==="edit"){const l=this.getDoc(o==null?void 0:o.id);n=o,l&&n&&(n={...n,collects:l.collects,isCollector:l.isCollector,views:l.views,files:l.files})}else(s==="view"||s==="diff")&&(n=((a=this._viewingDoc.value)==null?void 0:a.data)||this._getLocalDoc(this.signals.docID.value));return[s,n]}),this._docUsers=xe(()=>{const s=this._doc.value;if(!s)return[];const{addedBy:n,editedBy:r}=s.data;return[this.getUserInfo(n),r?this.getUserInfo(r):void 0]}),this._hasEditingDoc=xe(()=>!!this._editingDoc.value),this._editingDoc=xe(()=>{const[s,n]=this._viewInfo.value;return s==="edit"||s==="create"?n:void 0}),this._canShowLibFiles=xe(()=>{const s=this.signals.spaceType.value;let{showLibFiles:n}=this.props;return typeof n=="function"?n=n.call(this,s):Array.isArray(n)&&(n=n.includes(s)),n}),this._location=xe(()=>{var m;const{spaceType:s,spaceID:n,libID:r,moduleID:o,docID:a,pager:l,searchKeys:c,docVersion:h,mode:d,params:f}=this.signals;return{mode:d.value,spaceType:s.value,spaceID:n.value,libID:r.value,moduleID:o.value,docID:a.value,docVersion:h.value,search:(m=c.value)==null?void 0:m.join(" "),filterType:this.filterType,pager:l.value,noSpace:this.props.noSpace,orderBy:"",params:f.value}}),this._filterType=xe(()=>this.signals.filterType.value[this.signals.mode.value]??"all"),this._modeEffect=Tt(()=>{var o,a;const{mode:s}=this.signals;let{useHocuspocus:n}=this.props;const{onModeChange:r}=this.props;n=typeof n=="function"?n(this):n,n&&((a=(o=this.editor)==null?void 0:o.destroyHocuspocusProvider)==null||a.call(o)),r==null||r(this,s.value)}),this._handleDocChange=(s,n)=>{if(n==="create"){const r=this.signals.creatingDoc.value;r&&(r.title!==s.title||r.content!==s.content||r.keywords!==s.keywords||r.html!==s.html)&&(this.signals.creatingDoc.value={...r,...s,changed:!0,contentType:s.contentType||r.contentType})}else if(n==="edit"){const r=this.signals.editingDoc.value;r&&(r.title!==s.title||r.content!==s.content||r.keywords!==s.keywords||r.html!==s.html)&&(this.signals.editingDoc.value={...r,...s,changed:!0,contentType:s.contentType||r.contentType})}},this._getFileActions=s=>{var n;return this.getActions("file",{ui:"doc-view",data:s,doc:(n=this.doc)==null?void 0:n.data})},this._handleSearch=s=>{this.signals.searchKeys.value=dt.getSearchKeys(s)},this._handleFilterTypeClick=s=>{const n=s.target,r=n.getAttribute("data-type");if(r){const o=n.getAttribute("data-view");this.setFilterType(r,o)}},this._preserve=e.preserve??((t=this.element)==null?void 0:t.closest(".modal"))?"":`docapp_${window.config.currentModule}_${window.config.currentMethod}`,this.selectSpace=this.selectSpace.bind(this),this.selectDoc=this.selectDoc.bind(this),this.selectLib=this.selectLib.bind(this),this.selectModule=this.selectModule.bind(this),this.getUserInfo=this.getUserInfo.bind(this),this.selectDocVersion=this.selectDocVersion.bind(this),this.diffDocVersions=this.diffDocVersions.bind(this),this.onDiffModeChange=this.onDiffModeChange.bind(this),this.showFiles=this.showFiles.bind(this),this.getActions=this.getActions.bind(this),this.getItemActions=this.getItemActions.bind(this),this.executeCommand=this.executeCommand.bind(this),this.getTableOptions=this.getTableOptions.bind(this),this.toggleFullscreen=this.toggleFullscreen.bind(this)}get preserve(){return this._preserve}get spaceType(){return this.signals.spaceType.value}get spaceID(){return this.signals.spaceID.value}get libID(){return this.signals.libID.value}get moduleID(){return this.signals.moduleID.value}get docID(){return this.signals.docID.value}get docVersion(){return this.signals.docVersion.value}get diffMode(){return this.signals.diffMode.value}get space(){return this._space.value}get lib(){return this._lib.value}get module(){return this._module.value}get doc(){return this._doc.value}get treeMap(){return this._treeMap.value}get docList(){return this._docList.value}get docUsers(){return this._docUsers.value}get viewInfo(){return this._viewInfo.value}get libList(){return this._libList.value}get spaceList(){return this._spaceList.value}get mode(){return this.signals.mode.value}get canShowLibFiles(){return this._canShowLibFiles.value}get hasEditingDoc(){return this._hasEditingDoc.value}get location(){return this._location.value}get filterType(){return this._filterType.value}get editor(){var e,t;return(t=(e=this._viewRef.current)==null?void 0:e.editor)==null?void 0:t.editor}get editor$(){var e,t,s;return(s=(t=(e=this._viewRef.current)==null?void 0:e.editor)==null?void 0:t.editor)==null?void 0:s.$}get fullscreen(){return this.signals.fullscreen.value}get editingDoc(){return this._editingDoc.value}get editingUsers(){var e;return((e=this.signals.editingUsers)==null?void 0:e.value)||[]}_filterDocs(e,t){var s;if(e=e||this.signals.docs.value,e.length){const{api:n,chapter:r}=t||{},o=this.signals.searchKeys.value||[],a=this.filterType,l="key"in e[0],{currentUser:c,isMatchFilter:h,noSpace:d}=this.props,f=h?h.bind(this,"doc",a):w=>a==="createdByMe"?w.addedBy===c:a==="editedByMe"?w.editedBy===c:a==="draft"?w.status==="draft":a==="collected"?w.isCollector:!0;if(l&&!o.length)return a!=="all"&&a?e.filter(w=>f(w.data)):e;const m=this.signals.spaceID.value,y=this._treeMap.value,b=((s=this.props.docFilterProps)==null?void 0:s.map(w=>typeof w=="function"?w.bind(this):w))||["id","title","keywords","addedBy","editedBy",w=>this.getUserInfo(w.addedBy).realname,w=>{const x=w.editedBy;return x?this.getUserInfo(x).realname:void 0}];return e.reduce((w,x)=>{const D=l?x.data:x;if(D.deleted||!r&&D.type==="chapter"||n!==void 0&&!!D.api!==n||a&&!f(D)||o.length&&!dt.isItemMatch(D,o,b))return w;const I=y.libs.get(D.lib);return(d||D.lib===m||I&&I.data.space===m)&&w.push(l?x:y.docs.get(D.id)),w},[])}return[]}_getLocalDoc(e){if(e)return{id:e,type:"text",rawID:Cy(e),parent:0,contentType:"doc",content:"",title:"",addedBy:"",lib:this.libID,module:this.moduleID,addedDate:rt(new Date),order:0,local:!0}}loadHomeLibs(){var e;(e=this._homeRef.current)==null||e.loadLibs()}toggleFullscreen(){v.toggleFullscreen({target:document.body,afterEnter:()=>{this.signals.fullscreen.value=!0,v("body").addClass("has-doc-app-fullscreen")},afterExit:()=>{v("body").removeClass("has-doc-app-fullscreen"),this.signals.fullscreen.value=!1}})}toggleViewSideTab(e){var t,s,n;return(n=(s=(t=this._viewRef)==null?void 0:t.current)==null?void 0:s.sidebar)==null?void 0:n.toggleTab(e)}getDefaultState(e){e=e||this.props;const{data:t,fetcher:s,mode:n="home",filterType:r="all",pager:o,search:a,docVersion:l=0,defaultState:c,params:h}=e,d=this.formatData({libTypes:e.libTypes||[],...t},e);return{loading:!!(!t&&s),editingDoc:void 0,creatingDoc:void 0,searchKeys:dt.getSearchKeys(a),fullscreen:!1,filterType:{[n]:r},docVersion:l,diffMode:!1,mode:n,highlightView:!1,editingUsers:[],pager:o,params:h,diffVersions:[],...c,...d}}resetState(e){super.resetState(e),requestAnimationFrame(()=>this.reload())}getDataSignal(e){const{signals:t}=this;return e==="doc"?t.docs:e==="module"?t.modules:e==="lib"?t.libs:t.spaces}getCurrentItem(e){var t,s,n;return e==="doc"?(t=this._doc.value)==null?void 0:t.data:e==="module"?(s=this._module.value)==null?void 0:s.data:e==="lib"?(n=this._lib.value)==null?void 0:n.data:this._space.value}getSpace(e){return e?this.signals.spaces.value.find(t=>t.id===e):this._space.value}getLib(e){return e?this.treeMap.libs.get(e):this._lib.value}getDoc(e){var t,s;return e=e||((t=this._doc.value)==null?void 0:t.data),typeof e!="object"&&(e=e?(s=this._treeMap.value.docs.get(e))==null?void 0:s.data:void 0),e}getUserInfo(e){const{userMap:t={}}=this.props,s=t[e];return s?typeof s=="string"?{account:e,realname:s}:{...s,account:e}:{account:e,realname:e}}getDownloadUrl(e,t){if(t=t||this.props.downloadUrl,!t)return;let s="";if(e.startsWith("data:"))s=e;else if(/https?:\/\//.test(e)){const n=window.EDITOR_IMAGE_PROXY_ENDPOINT;s=n?`${n}?url=${encodeURIComponent(e)}`:e}else if(e.startsWith("attachment:")){const n=e.substring(11).split("/")[0];s=$e(t,{objectType:"doc",objectID:this.docID,gid:"",title:btoa(n),extra:""})}else s=$e(t,{objectType:"doc",objectID:this.docID,gid:btoa(`g-${e}`),title:"",extra:"editor"});return s}downloadFile(e,t){const s=this.getDownloadUrl(e);if(s)return!t&&e.startsWith("attachment:")&&(t=decodeURIComponent(e.substring(11).split("/")[0])),Ks(s,t)}async switchView(e,t){if(!await this.checkEditingDoc())return;t=t||this.mode;const{spaceType:s,spaceID:n,libID:r,moduleID:o,docID:a,params:l,filterType:c,pager:h}=e,{fetchOnChangeSpace:d,fetcher:f}=this.props,m=s&&this.signals.spaceType.value!==s||n!==void 0&&this.signals.spaceID.value!==n,y=d&&f&&m,b={...s?{spaceType:s}:null,...n!==void 0?{spaceID:n}:null,...r!==void 0?{libID:r}:null,...o!==void 0?{moduleID:o}:null,...a!==void 0?{docID:a}:null,...l!==void 0?{params:l}:null,...c!==void 0?{filterType:{...this.signals.filterType.value,[t]:c}}:null,...h!==void 0?{pager:{...this.signals.pager.value,...h}}:null,mode:t};return this.changeState(b,async()=>{y&&await this.load(f,this.signals.spaceType.value,n),a&&t==="edit"?this.startEditDoc(a):t==="create"?this.startCreateDoc():t==="files"?this.showFiles():t==="home"&&this.goHome()})}setFilterType(e,t){this.signals.filterType.value={...this.signals.filterType.value,[t||this.mode]:e}}exportDoc(e="pdf",t){var n;const s=this.editor;if(s instanceof ii)return(n=s.$)==null?void 0:n.export(e,t)}importDoc(e,t,s){var r,o,a;const n=this.editor;n instanceof ii&&((r=n.$)==null||r.updateDoc(e,t==="json"?"snapshot":t,s),typeof s=="string"&&((a=(o=this._viewRef.current)==null?void 0:o.editor)==null||a.setTitle(s)))}getLang(e,t=[],s){const{langData:n}=this.props;let r;if(typeof t=="string"?(s=t,r=[]):r=Array.isArray(t)?t:[t],!n)return s??(Array.isArray(e)?e.join("."):e);const o=Array.isArray(e)?mr(n,e):n[e]??s;return typeof o=="function"?o.call(this,...r):typeof o=="string"&&r.length?$e(o,...r):o}getActions(e,t){const{getActions:s}=this.props,n=s?s.call(this,e,t):[];return n!=null&&n.length&&t.ui?n.filter(r=>r&&(!r.ui||r.ui.split(",").includes(t.ui))):n||[]}getFilterTypes(e){const{getFilterTypes:t}=this.props;return t?t.call(this,e)||[]:[["all","All"]]}getTableOptions(e,t){const{getTableOptions:s}=this.props;return s?s.call(this,e,t):e}getDocIcon(e){if(e.icon)return e.icon;const{getDocIcon:t,docIcon:s,attachmentIcon:n,chapterIcon:r}=this.props;let o;return t?o=t.call(this,e):e.contentType==="attachment"?o=n:e.type==="chapter"?o=r:o=s,o||rb.defaultProps.docIcon}getPagerItems(){return[{type:"info",text:this.getLang("recTotalFormat","共 {recTotal} 项")},{type:"size-menu",text:this.getLang("recPerPageFormat","每页 {recPerPage} 项"),placement:"top",caret:"up"},{type:"link",page:"first",hint:this.getLang("firstPage","第一页"),icon:"icon-first-page"},{type:"link",page:"prev",hint:this.getLang("prevPage","上一页"),icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",hint:this.getLang("nextPage","icon-angle-right"),icon:"icon-angle-right"},{type:"link",page:"last",hint:this.getLang("lastPage","最后一页"),icon:"icon-last-page"}]}getPagerOptions(e,t){const{getPagerOptions:s}=this.props,n=s?s.call(this,e,t):e;return n.items||(n.items=this.getPagerItems()),n}getSortableOptions(e){const{getSortableOptions:t}=this.props;return t==null?void 0:t.call(this,e)}getItemActions(e,t,s){const n=t==="current"?this.getCurrentItem(e):typeof t=="number"?this.getDataSignal(e).value.find(r=>r.id===t):t;return n?this.getActions(e,{ui:s,data:n}):(console.warn(`[ZUI] getItemActions: ${e} data with ID "${t}" not found.`),[])}async selectSpace(e,t,s){var a,l;if(!await this.checkEditingDoc())return;e==="_first"&&(e=((a=this.spaceList[0])==null?void 0:a.id)??0);const{fetchOnChangeSpace:n,fetcher:r,autoSelectLib:o}=this.props;if(s===void 0&&(s=!!(n&&r&&(this.signals.spaceID.value!==e||typeof t=="number"&&t!==this.signals.libID.value))),!(this.signals.spaceID.value===e&&!t))return this.changeState({spaceID:e,mode:"list",...t?{libID:typeof t=="number"?t:o&&!s?((l=this.libList[0])==null?void 0:l.data.id)??0:0,moduleID:0,docID:0}:null,...s?{data:void 0,loading:!0}:null},()=>{s&&this.load(r,this.signals.spaceType.value,e)})}async selectDoc(e,t){if(!await this.checkEditingDoc())return;typeof e!="object"&&(e=this.getDoc(e));const s=e?e.id:0;return this.changeState({mode:!s||(e==null?void 0:e.type)==="chapter"?"list":"view",diffMode:!1,docID:s,...s!==this.signals.docID.value?{docVersion:0}:null,...e?{libID:e.lib,moduleID:e.module}:null,...t!==void 0?{docVersion:+t}:null})}async goHome(){if(await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"home"})}getDefaultPager(e){const{getDefaultPager:t}=this.props,s=this._preserve?st.get(`${this._preserve}:pager:${e}`):null;return t?t.call(this,e):{page:1,recTotal:0,recPerPage:typeof s=="number"?s:20,pageTotal:0}}resetPager(e,t){const s={...this.getDefaultPager(e),...this.signals.pager.value,...t};this.signals.pager.value=s;const{preserve:n}=this;n&&st.set(`${n}:pager:${e}`,s.recPerPage)}async showFiles(){if(this.canShowLibFiles&&await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"files",pager:this.getDefaultPager("files")})}async selectLib(e,t){if(!await this.checkEditingDoc())return;const s=this._module.value;s&&t===void 0&&s.data.lib!==e&&(t=0),t===void 0&&(t=this.signals.moduleID.value);const n=e?this.treeMap.libs.get(e):null;if(!(e&&!n||t&&!this.treeMap.modules.get(t)))return this.changeState({libID:e,moduleID:t,mode:"list",docID:0})}selectDocVersion(e,t){const s=this.signals.docID.value;t=t||s;const n=this.getDoc(t);n&&(e=Math.max(0,Math.min(+e,n.version??0)),this.changeState({mode:"view",docID:t,docVersion:e}))}diffDocVersions(e){this.changeState({mode:"diff",diffVersions:e})}onDiffModeChange(e){this.changeState({diffMode:e})}async selectModule(e,t){if(!await this.checkEditingDoc())return;const s=this._doc.value;return this.changeState({moduleID:e,...t||s&&e!==s.data.id?{docID:0,mode:"list"}:null})}setData(e,t){var r;const{signals:s}=this,n=this.formatData(e,{spaceType:s.spaceType.value,spaceID:s.spaceID.value,libID:s.libID.value,moduleID:s.moduleID.value,docID:s.docID.value});return this.changeState({...n,...t,libTypes:(r=n.libTypes)!=null&&r.length?n.libTypes:s.libTypes.value})}async checkEditingDoc(){if(this._hasEditingDoc.value){const[,e]=this._viewInfo.value;if(e!=null&&e.changed){this.signals.highlightView.value=!0;const t=await Ve.confirm(this.getLang("leaveEditingConfirm","文档编辑中，确定要离开吗？"));if(this.signals.highlightView.value=!1,!t)return!1}await this.changeState({editingDoc:void 0,creatingDoc:void 0,docVersion:0})}return!0}async load(e,t,s,n){var r,o;if(e=e||this.props.fetcher,e){const{signals:a}=this;t=t||a.spaceType.value,s=s||a.spaceID.value;const{noLoading:l=!1,picks:c=[]}=n||{},h=typeof c=="string"?[c]:c;await this.changeState({loading:!l,spaceType:t,spaceID:s});const d=await Ne(e,[{spaceType:t,spaceID:s,picks:h,noSpace:!!this.props.noSpace}],void 0,this);await this.setData(h?{spaces:a.spaces.value,libs:a.libs.value,modules:a.modules.value,docs:a.docs.value,spaceID:a.spaceID.value,libTypes:a.libTypes.value,...this.props.autoSelectLib?{libID:((o=(r=d.libs)==null?void 0:r[0])==null?void 0:o.id)??0}:{},...d}:d,l?void 0:{loading:!1})}}isLoadingDoc(e){return this._loadingDocs.has(e)}async loadTemplate(e,t){const s=this.props.templateFetcher||this.props.docFetcher;if(!s)throw new Error("[ZUI] DocApp: templateFetcher or docFetcher is not set.");return await Ne(s,[{docID:e,version:t}],void 0,this)}async fetchDoc(e,t=0,s,n){if(s=s||this.props.docFetcher,!s)return;const r=await Ne(s,[{docID:e,version:t}],void 0,this),o=this.formatDataItem("doc",{...n,...r,id:e,local:!1});if(o&&(this.props.autoConvertDoc||o.status==="draft"))if(o.contentType==="html"&&o.content&&o.$convert===void 0){const a=await gt.htmlToSnap(o.content);o.$convert=!!a}else o.$convert=!1;return o}async loadDoc(e,t,s){var l;let n=this.getDoc(e)||this._getLocalDoc(e);if(!n||((l=this.props.privs)==null?void 0:l.view)===!1)return;if(s=s||this.props.docFetcher,!s){if(n.api)return;s=()=>t?{id:e,content:"",version:t}:{id:e,content:""}}const r=this._loadingDocs;if(r.has(e))return new Promise(c=>{r.get(e).push(c)});r.set(e,[]),t=t||n.version||0;const o=!t||t===n.version||!n.version,a=await this.fetchDoc(e,t,s,n);if(a){const c=o?this.formatDataItem("doc",{...n,...a,id:e,local:!1}):{...n,...a.version?{version:a.version}:null,...a.privs?{privs:a.privs}:null,...a.editable!==void 0?{editable:a.editable}:null,versions:{...n.versions,[t]:this.formatDataItem("doc",a)},contentType:a.contentType||n.contentType,local:!1};n=this.update("doc",c,{keepDeleted:!0})}return r.get(e).forEach(c=>c(n)),r.delete(e),n}formatDataItem(e,t,s,n){if(e==="module")t.lib=+(t.lib??t.root),t.parent=+(t.parent??0);else if(e==="lib"){const o=t;o.space=o.space??s,o.space=String(+o.space)===String(o.space)?+o.space:o.space}else e==="space"&&(t.type=t.type??n);if(t.id=si(t.id),t.deleted=typeof t.deleted=="string"?!!JSON.parse(t.deleted):t.deleted,e==="doc"){const o=t;if(o.files){!Array.isArray(o.files)&&typeof o.files=="object"&&(o.files=Object.values(o.files));for(const a of o.files)a.id=+a.id,a.size=+a.size,a.downloads=a.downloads?+a.downloads:0,a.deleted=typeof a.deleted=="string"?!!JSON.parse(a.deleted):a.deleted}o.api===void 0&&(o.api=typeof t.id=="string"&&t.id.startsWith("api.")),o.rawID=Cy(t.id),o.product=+(o.product??0),o.project=+(o.project??0),o.execution=+(o.execution??0),o.version=+(o.version??0),o.views=+(o.views??0),o.module=+(o.module??0),o.lib=+(o.lib??0),o.collects=+(o.collects??0),o.contentVersion&&(o.contentVersion=+o.contentVersion,Number.isNaN(o.contentVersion)||(o.currentVersion=o.contentVersion)),o.editable!==void 0&&(o.privs={...o.privs,edit:o.editable}),o.contentType==="attachment"&&(o.contentType="html"),o.parent&&(o.parent=si(o.parent)),o.draft&&(typeof o.draft=="string"?o.draft=o.status==="draft"?{id:0,doc:o.id,content:o.content,contentType:o.contentType,title:o.title,version:0,addedBy:o.addedBy,addedDate:o.addedDate}:null:(o.draft.type&&(o.draft.contentType=o.draft.type),o.draft.rawContent&&(o.draft.content=o.draft.rawContent,delete o.draft.rawContent),o.status==="draft"&&(o.contentType=o.draft.contentType,o.content=o.draft.content))),o.rawContent&&(o.content=o.rawContent,delete o.rawContent),!o.collects&&o.isCollector&&(o.collects=1),o.editedBy===o.addedBy&&o.editedDate===o.addedDate&&(delete o.editedBy,delete o.editedDate)}typeof t.order!="number"&&typeof t.id=="number"&&(t.order=t.id);const{formatDataItem:r}=this.props;return r?r.call(this,e,t,s,n):t}formatData(e,t){let{libID:s=0,moduleID:n=0,docID:r,spaceID:o=0}=t;s&&(s=+s),n&&(n=+n),r&&(r=si(r));const{spaceType:a}=t,{libs:l=[],modules:c=[],docs:h=[],spaces:d=[],spaceID:f,libTypes:m=[]}=e||{};let y,b,w,x;return f&&(o=f),o=si(o),l.forEach(D=>{this.formatDataItem("lib",D,f)}),l.sort((D,I)=>(D.order??D.id)-(I.order??I.id)),d.forEach(D=>{this.formatDataItem("space",D,f,a)}),c.forEach(D=>{this.formatDataItem("module",D,f)}),h.forEach(D=>{this.formatDataItem("doc",D,f)}),r?y=h.find(D=>D.id===r):r=0,y&&!n&&(n=y.module??0),n&&(b=c.find(D=>D.id===n)),s=b?b.lib:s,!s&&this.props.autoSelectLib&&(w=l[0],s=w?w.id:0),s&&(!w||w.id!==s)&&(w=l.find(D=>D.id===s)),o=w?w.space:o,!this.props.noSpace&&d.length&&(x=d.find(D=>D.id===o)),o||(x=d[0],o=x?x.id:o),!o&&l.length&&(o=l[0].space),{spaceType:(x?x.type:a)||"mine",libs:l,modules:c,docs:h,spaces:d,spaceID:o,libID:s,moduleID:n,docID:r,libTypes:m}}batchUpdate(e,t){fn(()=>{Object.keys(e).forEach(s=>{const n=e[s];this.update(s,n)}),t&&this.changeState(t)})}update(e,t,s){const n=!Array.isArray(t),r=n?[t]:t,o=this.getDataSignal(e),a=[],l=o.value,c=this.signals.spaceID.value,h=s==null?void 0:s.keepDeleted;return r.forEach(d=>{const f=si(d.id),m=l.findIndex(b=>b.id===f),y=m>=0?{...l[m],...d}:d;if(this.formatDataItem(e,y,c),y.deleted&&!h)m>=0&&(l[m]=y);else if(m>=0){if(e==="doc"){const b=l[m],w=y,x=w.contentVersion??w.version;b.version!==x&&Object.assign(y,{version:Math.max(b.version,x),versions:{...b.versions,[b.version]:b,[x]:y}}),Yi.update({objectType:"doc",objectID:+y.id})}l[m]=y}else l.push(y);a.push(y)}),o.value=[...l],n?a[0]:a}delete(e,t){Array.isArray(t)||(t=[t]);const s=new Set(t);if(!s.size)return!1;const n=this.getDataSignal(e),r=n.value;return!r||!Array.isArray(r)||!r.length?!1:(fn(()=>{const o=new Set;e==="module"||e==="lib"?t.forEach(l=>{const c=e==="module"?this.treeMap.modules.get(l):this.treeMap.libs.get(l);c&&c.docs.forEach(h=>o.add(h.data.id))}):e==="doc"&&t.forEach(l=>{const c=this.treeMap.docs.get(l);c!=null&&c.docs.length&&to(c,[],!0).forEach(h=>o.add(h.id))}),n.value=r.filter(l=>!s.has(l.id)),o.size&&this.delete("doc",[...o]);const a=this.docID;(e==="doc"&&t.includes(a)||o.has(a))&&this.selectDoc(0)}),!0)}async startCreateDoc(e,t,s){e=e??this.signals.libID.value,t=t??this.signals.moduleID.value;let n=this.signals.creatingDoc.value;if(!(n&&n.lib===e&&n.module===t))return n=await this._getCreatingDoc(s),this.changeState({libID:e,moduleID:t,creatingDoc:n,mode:"create"})}cancelCreateDoc(){return this.changeState({creatingDoc:void 0,mode:"list"})}async saveNewDoc(e){var c,h,d,f,m,y,b;await((h=(c=this._viewRef.current)==null?void 0:c.editor)==null?void 0:h.triggerChange(void 0,{getHtml:!0}));const{signals:t}=this,s=t.creatingDoc.value;if(!s)return;if(s.title.trim()===""){await Ve.alert(this.getLang("docTitleRequired","文档标题不能为空。")),(f=(d=this._viewRef.current)==null?void 0:d.editor)==null||f.focusTitle();return}const n=t.spaceID.value,r=t.libID.value,o=t.moduleID.value,a=await((m=this.props.onCreateDoc)==null?void 0:m.call(this,{...s,status:e||"normal",lib:t.libID.value,module:t.moduleID.value},n,r,o));if(!a)return Ve.alert(this.getLang("saveDocFailed","文档保存失败，请稍后重试"));const l=+a.space.split(".")[1];return l!==n&&l===l?(await this.changeState({creatingDoc:void 0}),await this.selectSpace(l,a.lib),this.selectDoc(a)):(a.rawContent&&(a.content=a.rawContent),(b=(y=this._viewRef.current)==null?void 0:y.editor)==null||b.removeCache(),this.changeState({docs:[...t.docs.value,a],docID:a.id,libID:a.lib,moduleID:a.module,creatingDoc:void 0,mode:"view"}))}async startEditDoc(e,t){var c,h;if(e=e||((c=this._doc.value)==null?void 0:c.data),typeof e!="object"&&(e=this.getDoc(e)),!e)return;const s=t==null?void 0:t.loadDoc,n=e.version||0;if((s===!0||s!==!1&&!e.api&&(e.content===void 0||e.content===null)||s===void 0&&!e.api&&this.docVersion!==n)&&(e=await this.fetchDoc(e.id,n),!e))return;if(e.editable===!1||((h=e.privs)==null?void 0:h.edit)===!1)return Ve.alert(this.getLang("needEditable","您没有当前文档的编辑权限。"));const r=!!((t==null?void 0:t.convert)??e.$convert),{content:o,contentType:a,title:l=""}=e.draft||e;await this.changeState({docID:e.id,libID:e.lib,moduleID:e.module,editingDoc:{...e,title:l,contentType:a,content:o,...t==null?void 0:t.template,changed:!1,$convert:r,$html:r?e.content:void 0},mode:"edit"})}async restoreDoc(e,t){var c,h,d;let s=this.getDoc(e);if(!s)return;t=+t;const n=await this.loadDoc(e,t);if(s={...s,...n},((c=s.privs)==null?void 0:c.edit)===!1||s.editable===!1)return Ve.alert(this.getLang("needEditable","您没有当前文档的编辑权限。"));const r=(h=s.versions)==null?void 0:h[t];if(!r)return;let o=r.html;o===void 0&&r.content&&(o=await gt.convertToHtml(r.content));const a=await((d=this.props.onSaveDoc)==null?void 0:d.call(this,{...s,content:r.content,contentType:r.contentType,html:o,title:r.title,fromVersion:t,files:r.files}));if(a===!1)return;const l=typeof a=="object"?a.version:s.version+1;if(typeof a=="object"){const f={...s,version:l,contentVersion:l,...a};this.update("doc",f)}this.selectDoc(e,l),this.selectDocVersion(l)}cancelEditDoc(e){return this.changeState({mode:"view",editingDoc:void 0,docVersion:0,...e})}async saveDoc(e){var o,a,l,c,h;await((a=(o=this._viewRef.current)==null?void 0:o.editor)==null?void 0:a.triggerChange(void 0,{getHtml:!0}));const t=this.signals.editingDoc.value;if(!t)return this.cancelEditDoc();const s=this.getDoc(t.id);let n={...s,...t,status:e||"normal"};n.contentType==="doc"&&(n.$convert=!1);const r=await((l=this.props.onSaveDoc)==null?void 0:l.call(this,n));if(r!==!1){if((h=(c=this._viewRef.current)==null?void 0:c.editor)==null||h.removeCache(),r&&(r!==!0&&Object.assign(n,r),n=this.update("doc",n),n.lib!==(s==null?void 0:s.lib))){this.cancelEditDoc(),this.selectDoc(n);return}this.cancelEditDoc()}}reload(e=!1){const{fetcher:t,data:s,mode:n,docID:r,libID:o,moduleID:a}=this.props,l=()=>{n==="edit"&&r?this.startEditDoc(r):n==="create"?this.startCreateDoc(o,a,{templateID:r}):n==="files"?this.showFiles():n==="view"&&r===this.docID&&this.loadDoc(r,this.docVersion||this.doc.data.version)};e||t&&!s?this.load().then(l):l()}componentDidMount(){var e;super.componentDidMount(),this.reload(),this._viewEffect=Tt(()=>{var c,h,d,f;const{libID:t,moduleID:s,docID:n,diffVersions:r}=this.signals,o=n.value?"doc":s.value?"module":t.value?"lib":"space",a=n.value?(c=this._doc.value)==null?void 0:c.data:s.value?(h=this._module.value)==null?void 0:h.data:t.value?(d=this._lib.value)==null?void 0:d.data:this._space.value,l=this.signals.mode.value;(f=this.props.onSwitchView)==null||f.call(this,l,this._location.value,{type:o,title:a?o==="doc"?a.title:a.name:"",data:a,diffVersions:r.value})}),(e=this.props.onMounted)==null||e.call(this)}componentDidUpdate(e){var o;const{fetcher:t,data:s,spaceID:n,spaceType:r}=this.props;t&&!s&&(e.spaceType!==r||e.spaceID!==n)&&this.load(),(o=this.props.onUpdated)==null||o.call(this)}componentWillUnmount(){var e,t;(e=this._viewEffect)==null||e.call(this),this._modeEffect(),(t=this.props.onUnmounted)==null||t.call(this)}async _getCreatingDoc(e="doc"){const t=Mx();if(typeof e!="object"&&(e={contentType:e||"doc"}),e.templateID){const s=await this.loadTemplate(e.templateID);s&&Object.assign(e,{contentType:s.contentType,content:s.content,title:s.title})}else{const s=xy({space:this.signals.spaceID.value,lib:this.signals.libID.value,module:this.signals.moduleID.value});s&&Object.assign(e,{contentType:s.contentType??e.contentType,content:s.content,title:s.title??e.title})}return{id:t,rawID:t,type:"text",parent:0,lib:this.signals.libID.value,module:this.signals.moduleID.value,title:"",content:"",addedBy:this.props.currentUser||"",addedDate:rt(new Date,"yyyy-MM-dd hh:mm:ss"),uid:Ft(13).replaceAll("-","_"),order:0,...e}}_getClassName(e){return["doc-app",e.className,this._viewType.value!=="list"?"has-show-view":"",this.signals.fullscreen.value?"is-enter-fullscreen":"",`doc-app-mode-${this.mode}`]}_getProps(e){var t;return{...super._getProps(e),style:{width:je(e.width),height:je(e.height)},"data-view":this._viewType.value,"data-lib-type":(t=this._lib.value)==null?void 0:t.data.type,"data-space-type":this.spaceType}}_renderSidebar(e){var a,l;if(e.noSidebar)return null;const{libIcon:t,apiLibIcon:s,moduleIcon:n,currentUser:r}=e,o=this.spaceType;return g($x,{key:"sidebar",app:this,className:"surface-light",preserve:this._preserve?`${this._preserve}-sidebar`:void 0,currentUser:r,libIcon:t,apiLibIcon:s,moduleIcon:n,spaceType:o,space:this._space.value,libs:this._libList.value,lib:this._lib.value,libTypes:this.signals.libTypes.value,showFiles:this.signals.mode.value==="files",moduleID:((a=this._module.value)==null?void 0:a.data.id)||0,docID:((l=this._doc.value)==null?void 0:l.data.id)||0,getActions:this.getItemActions,onSelectDoc:this.selectDoc,onSelectLib:this.selectLib,onShowFiles:this.canShowLibFiles?this.showFiles:void 0})}_renderFiles(){const e=this.renderCustom("files");if(e!==void 0)return e;const{currentUser:t,fileUrl:s,filesFetcher:n,userMap:r}=this.props;return g(Zd,{key:"files",app:this,userMap:r,objectType:this.spaceType,objectID:this.spaceID,filterType:this.filterType,currentUser:t,onGetUser:this.getUserInfo,fileUrl:s,searchKeys:this.signals.searchKeys.value,filesFetcher:n})}_renderList(e){var l,c;if(this.signals.mode.value==="files")return this._renderFiles();const t=this.renderCustom("list");if(t!==void 0)return t;if(((l=this.lib)==null?void 0:l.data.type)==="api")return g(sk,{app:this,docs:this._docList.value});const{libIcon:s,moduleIcon:n,userMap:r,canMoveDoc:o}=e,a=this.signals.searchKeys.value;return g(Tx,{key:"list",app:this,libIcon:s,moduleIcon:n,userMap:r,searchKeys:a,docs:this._docList.value,canMoveDoc:o,getActions:this.getActions,getTableOptions:this.getTableOptions,orderBy:(c=this._lib.value)==null?void 0:c.data.orderBy})}_renderView(e){const t=this.renderCustom("view");if(t!==void 0)return t;const[s,n]=this._viewInfo.value;if(!n||n.type==="chapter")return null;const{fileIcon:r,fileUrl:o,historyFetcher:a,uploadUrl:l,downloadUrl:c}=e,[h,d]=this._docUsers.value;return g(Xx,{ref:this._viewRef,app:this,key:s,doc:n,mode:s,onChange:this._handleDocChange,fileIcon:r,fileActions:this._getFileActions,fileUrl:o,creator:h,modifier:d,uploadUrl:l,downloadUrl:c,preserve:this._preserve?`${this._preserve}-view`:void 0,onGetUser:this.getUserInfo,historyFetcher:a,highlight:this.signals.highlightView.value})}_renderMain(e){const t=this._renderView(e);return g("div",{key:"main",className:`doc-main flex-auto relative min-w-0${t?" show-view":""}`},e.singleDoc?null:this._renderList(e),t)}_renderSearchBox(e){let t={rootClass:"doc-app-search w-40 ml-1 mr-3",defaultValue:(this.signals.searchKeys.value||[]).join(" "),onChange:this._handleSearch,placeholder:this.getLang("searchPlaceholder","搜索")};const{getSearchBoxOptions:s}=this.props;return s&&(t=s.call(this,t,{type:e})),g(mn,{...t})}_renderFilters(){var a;const e=this.renderCustom("filters");if(e!==void 0)return e;const t=this._viewType.value;if(t!=="list"&&t!=="files")return null;const s=this.getFilterTypes(t),n=t==="list",r=this.filterType,o=n?(a=this._docList.value)==null?void 0:a.length:0;return g("div",{className:"row items-center flex-auto justify-end"},s.length?g("menu",{className:"nav nav-compact",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},s.map(([l,c])=>g("li",{key:l,className:"nav-item item"},g("a",{className:l===r?"active rounded-full":"rounded-full","data-type":l,"data-view":t},c,l===r&&o?g("span",{className:"label size-sm canvas ring-0 rounded-full"},o):null)))):null,this._renderSearchBox(t))}_renderToolbar(){var r;const e=this.renderCustom("toolbar");if(e!==void 0)return e;const t=this._viewType.value,s=[],n="toolbar";if(t==="list")s.push(...this.getActions("doc-list",{ui:n}));else if(t==="files")s.push(...this.getActions("file-list",{ui:n}));else if(t==="view"){const o=(r=this._doc.value)==null?void 0:r.data;o&&(o.deleted||s.push(...this.getActions("doc",{ui:n,data:o})))}else t==="edit"?s.push(...this.getActions("doc-edit",{ui:n,data:this.signals.editingDoc.value})):t==="create"&&s.push(...this.getActions("doc-create",{ui:n,data:this.signals.creatingDoc.value}));return g(Be,{className:"doc-app-toolbar",gap:2,size:"md",items:s})}_renderHeader(e){const t=this.renderCustom("header");if(t!==void 0)return t;const s=this._doc.value;return g("div",{key:"header",class:"doc-app-header surface-light row items-center border-b py-1.5 pl-1 pr-2"},g(Rx,{app:this,spaceIcon:e.spaceIcon,libIcon:e.libIcon,apiLibIcon:e.apiLibIcon,moduleIcon:e.moduleIcon,libFilesIcon:e.libFilesIcon,noSpace:e.noSpace,docIcon:s?this.getDocIcon(s.data):void 0,spaces:this._spaceList.value,space:this._space.value,libs:this._libList.value,lib:this._lib.value,doc:s,docVersion:this.signals.docVersion.value,showFiles:this.signals.mode.value==="files",module:this._module.value,libPlaceholder:"所有库",onSelectDocVersion:this.selectDocVersion,onDiffDocVersions:this.diffDocVersions,onDiffModeChange:this.onDiffModeChange,onSelectLib:this.selectLib,onSelectSpace:this.selectSpace,onSelectModule:this.selectModule,onSelectDoc:this.selectDoc,homeName:e.homeName,noDocSwitcher:e.noDocSwitcher,getSpaceFetcher:e.getSpaceFetcher,spaceType:this.spaceType,spaceID:this.spaceID},this._renderFilters()),this._renderToolbar())}_renderBody(e){return g("div",{key:"body",class:"doc-app-body flex-auto min-h-0 row items-stretch"},this._renderSidebar(e),this._renderMain(e))}_renderHome(){const e=this.renderCustom("home");return e!==void 0?e:this.spaceType==="product"||this.spaceType==="project"&&window.config.vision!=="lite"?g(tk,{ref:this._homeRef,app:this}):g(Qx,{ref:this._homeRef,app:this})}_getChildren(e){return this.signals.mode.value==="home"?this._renderHome():this.signals.loading.value?g("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":this.getLang("loadingDocsData","正在加载文档数据...")}):this._space.value?[this._renderHeader(e),this._renderBody(e)]:g("div",{key:"empty-tip",class:"doc-empty-tip center h-full gap-8"},g("div",{className:"relative text-primary"},g(Ie,{icon:"file-alt",className:"opacity-10",style:"font-size: 72px; transform: rotate(-30deg); transform-origin: 0 72px;"}),g(Ie,{icon:"file-alt",className:"opacity-30 absolute left-0 top-0",style:"font-size: 72px; transform: rotate(-15deg); transform-origin: 0 72px;"}),g(Ie,{icon:"file-text",className:"absolute left-0 top-0",style:"font-size: 72px; transform: rotate(0deg); transform-origin: 0 72px;"})),g("div",{className:"text-gray text-lg"},this.getLang("noSpaceTip","这里什么也没有，先创建一个空间再使用吧！")),Be.render({size:"lg",items:this.getActions("home",{ui:"home-no-space"})},[]))}getCustomRender(e){var t;return(t=this.props.customRenders)==null?void 0:t[e]}renderCustom(e,...t){const s=this.getCustomRender(e);let n;if(typeof s=="function"&&(n=s.call(this,...t)),n!==void 0)return typeof n=="string"?n:g(fe,{key:e,content:n,generatorArgs:t,generatorThis:this})}};iu.NAME="DocApp",iu.defaultProps={spaceIcon:"docspace",libIcon:"doclib",apiLibIcon:"interface-lib",moduleIcon:"folder-o",docIcon:"doc",diffEnabled:!1,libFilesIcon:"annex-lib",chapterIcon:"list-box",attachmentIcon:"file",fetchOnChangeSpace:!0,autoConvertDoc:!0,commands:{},showLibFiles:["product","project","execution"],libColors:["secondary","primary","warning","success","special"].map(i=>`var(--color-${i}-500)`),showToolbar:!1};let nk=iu;async function Vy(i,e){const t=await Ne(e.docFetcher,[{docID:i,version:0}]);if(!(t!=null&&t.content))return!1;let s="";if(e.type==="html"){if(!await gt.htmlToSnap(t.content))return!1}else try{s=await gt.convertToHtml(t.content,void 0,e.downloadUrl)}catch(o){console.warn("[ZUI] Convert doc to html failed:",o)}const n={content:s};let r;return await v.post($e(e.migrateUrl,{docID:i}),n,o=>{const a=o;r=a.result==="success"?!0:a.message},"json"),r}async function Wy(i){try{i=i||ut("doc","ajaxGetMigrateDocs");const e=await Ne(i);return Array.isArray(e)?{doc:e,html:[]}:e}catch{return{}}}async function Ky(i,e){await gt.loadModule();const{onProgress:t,migrateUrl:s=ut("doc","ajaxMigrateDoc","docID={docID}"),docFetcher:n=ut("doc","ajaxGetDoc","docID={docID}"),downloadUrl:r=ut("file","ajaxQuery","fileID={gid}")}=e||{},o={migrateUrl:s,docFetcher:n,downloadUrl:r};let a=0;const l=i.doc.length+i.html.length,c=["doc","html"];for(const h of c)for(const d of i[h])t==null||t(a,l),await Vy(d,{...o,type:h}),await Ss(50),a++;return t==null||t(a,l),i}class ru extends ae{constructor(){super(...arguments),this._current=pe(0)}migrate(){const{idList:e,docFetcher:t,downloadUrl:s,migrateUrl:n}=this.props;return Ky(e,{docFetcher:t,downloadUrl:s,migrateUrl:n,onProgress:r=>{this._current.value=r}})}componentDidMount(){this.migrate()}render(e){var o;const t=this._current.value,s=e.idList,n=s.doc.length+s.html.length,r=t===n;return g("div",{className:"col gap-4 p-6"},g("div",{class:"row gap-2 items-center"},g("div",{class:`progress progress-striped flex-auto ${r?"":"active"}`},g("div",{class:"progress-bar",style:`width: ${Math.floor(t*100/n)}%`})),g("div",{class:"text-gray"},Math.floor(t*100/n),"%")),r?g("div",{className:"text-center mt-2"},g("button",{type:"button",class:"btn primary",onClick:(o=e.onFinish)==null?void 0:o.bind(this,s)},e.finishText)):g("div",null,$e(e.progressTip,{current:t,total:n})))}static async open(e){let t;const s=ye();return await Ve.open({type:"custom",ref:s,size:400,content:g(ru,{...e,onFinish:n=>{var r;t=n,(r=s.current)==null||r.hide()}}),custom:{closeBtn:!1}}),t}}async function ik(i){const{preserve:e="DocApp:migratedDocs:v2"}=i||{};if(st.get(e))return;const{doc:t=[],html:s=[]}=await Wy(i==null?void 0:i.migrateUrl),n=t.length+s.length;if(!n)return;const r={zh_cn:{confirm:"检查到有 {0} 个文档数据需要迁移，是否进行迁移操作？你也可以下次进入文档应用时再进行迁移。",progressTip:"正在迁移文档数据...（{current}/{total}）",finish:"迁移完成"},zh_tw:{confirm:"檢查到有 {0} 个文檔數據需要遷移，是否進行遷移操作？你也可以下次進入文檔應用時再進行遷移。",progressTip:"正在遷移文檔數據...（{current}/{total}）",finish:"遷移完成"},en:{confirm:"There are {0} documents need to be migrated, do you want to migrate them now? You can also migrate them next time when you enter the document application.",progressTip:"Migrating documents...({current}/{total})",finish:"Migrate finished"}},o=r[op()]||r.en,a=(i==null?void 0:i.confirm)||o.confirm;if(a&&!await Ve.confirm($e(a,n)))return;const l=(i==null?void 0:i.progressTip)||o.progressTip,c=(i==null?void 0:i.finishText)||o.finish,h=await ru.open({idList:{doc:t,html:s},...i,progressTip:l,finishText:c});return h&&st.set(e,Date.now()),h}const rk=Object.freeze(Object.defineProperty({__proto__:null,getMigrateDocs:Wy,migrateDoc:Vy,migrateDocs:Ky,tryMigrateDocs:ik},Symbol.toStringTag,{value:"Module"}));class Ps extends be{afterInit(){super.afterInit(),this.$element.on("skipMorph",()=>{var e;(e=this.$)==null||e.reload(!0)})}destroy(){this.$element.off("skipMorph"),super.destroy()}}Ps.NAME="DocApp",Ps.Component=nk,Ps.storeNextCreatingDoc=Ex,Ps.fetchNextCreatingDoc=xy,Object.assign(Ps,rk),Ps.register();class ro extends Ps{_getRenderProps(e){const{doc:t,className:s,...n}=super._getRenderProps(e),o={lib:0,module:0,title:"",addedBy:"",contentType:"doc",...typeof t=="object"?t:{id:t}},a={spaces:[{id:1,order:1,name:"",type:"custom"}],libs:[{id:o.lib,space:1,name:""}],modules:[{id:o.module,lib:o.lib,name:"",order:1}],docs:[o],spaceID:1};return{className:K(s,"doc-viewer"),data:a,doc:t,docID:o.id,...n}}}ro.NAME="DocViewer",ro.DEFAULT={...Ps.DEFAULT,mode:"view",noSidebar:!0,noSpace:"hidden",homeName:!1,noDocSwitcher:!0,singleDoc:!0},ro.register(),gt.setGlobalConfig({attachmentUrlGetter:i=>{var t;const e=Ps.query()||ro.query();if(e){let s=((t=e.$)==null?void 0:t.getDownloadUrl(i))||"";return s!=null&&s.length&&/^https?:\/\//.test(s)&&(s=`${window.location.origin}${s.startsWith("/")?"":"/"}${s}`),s}return""}});const FD="",OD="",jD="",BD="",HD="",UD="",VD="",WD="",KD="",qD="";ot(Object.freeze(Object.defineProperty({__proto__:null,Dropmenu:Gi,DropmenuBtn:$y,DropmenuPop:Ty},Symbol.toStringTag,{value:"Module"})));class ou extends be{}ou.NAME="Dropmenu",ou.Component=Gi;const au=class Ao extends Ze{render(e){super.render(e);let t=this.chart;const{responsive:s=!0,theme:n,...r}=this.options;t||(t=Ao.Module.init(this.element,n),s&&v(window).on(`resize.${this.gid}.ECharts.zt`,t.resize),this.chart=t),t.setOption(r)}async afterInit(){if(!await Ao.loadModule()){console.warn("ZUI: ECharts is not loaded.");return}let{plugins:t}=this.options;if(t===void 0){t=[];let s=this.options.series||[];s=Array.isArray(s)?s:[s];const n=new Set(s.map(r=>r==null?void 0:r.type).filter(Boolean));n.has("liquidFill")&&t.push("liquidfill"),n.has("timeline")&&t.push("timeline")}for(const s of t)await Ao.loadPlugin(s);this.render()}destroy(){var t;if(!Ao.Module){super.destroy();return}const{responsive:e=!0}=this.options;e&&v(window).off(`resize.${this.gid}.ECharts.zt`),(t=this.chart)==null||t.dispose(),super.destroy()}static async loadPlugin(e){if(this.pluginLoaded.has(e))return;const t=`echarts-${e}`;await v.getLib(t),this.pluginLoaded.add(e)}static async loadModule(){return this.Module||(this.Module=window.echarts),this.Module||(this.Module=await v.getLib("echarts")),this.Module}};au.NAME="ECharts",au.pluginLoaded=new Set;let ok=au;const lu=((l_=window.config)==null?void 0:l_.version)?`${window.config.webRoot}js/`:void 0;v.registerLib("echarts",{src:"echarts/echarts.common.min.js",root:lu,check:"echarts"}),v.registerLib("echarts-liquidfill",{src:"echarts/echarts-liquidfill.min.js",root:lu,check:!1}),v.registerLib("echarts-timeline",{src:"echarts/timeline.min.js",root:lu,check:!1});const qy=i=>i.replace(/([[\]])/g,"\\$1");class El extends Ze{constructor(){super(...arguments),this._disabled=!1,this._timer=0}init(){if(this.$element.on("submit",this.onSubmit.bind(this)).on("input mousedown change",this.onInput.bind(this)),this.options.checkOnCloseModal){const e=Ve.query(this.$element);if(!e||e.options.onHide)return;e.setOptions({onHide:this._handleModalHide.bind(this,e)})}}_handleModalHide(e){const{checkOnCloseModal:t}=this.options;if(t&&typeof t=="function"){const s=t.call(this,e);return typeof s=="string"?(Ve.alert(s),!1):s}}enable(e=!0,t=0){if(this._resetTimer(),t){this._timer=window.setTimeout(()=>{this.enable(e),this._timer=0},t);return}this.$element.toggleClass("loading",!e),this.$element.find('.btn-submit,button[type="submit"]').toggleClass("disabled",!e).prop("disabled",!e),this._disabled=!e}disable(){this.enable(!1)}onInput(e){const t=v(e.target).closest(".has-error");if(!t.length)return;let s=t.attr("name");s||(s=t.find(".pick-value").attr("name"));const n=s?`#${s.split("[")[0]}Tip,#${qy(s)}Tip`:".form-tip";t.removeClass("has-error"),t.closest(".form-group,.form-batch-control").find(n).remove()}onSubmit(e){var o;if(e.preventDefault(),this._disabled)return;const{element:t}=this,s=v.extend({},this.options);this.emit("before",e,t,s);const n=()=>{this.$element.find(".ajax-form-tip").each(function(){const c=v(this);c.closest(".form-group,.form-batch-control").find(".has-error").removeClass("has-error"),c.remove()}),this.disable();let a=this.getFormData();const{beforeSend:l}=s;if(l){const c=l(a);c instanceof FormData&&(a=c)}this.emit("send",a),this._send(a)},r=(o=s.beforeSubmit)==null?void 0:o.call(s,e,t,s);if(r!==!1){if(r instanceof Promise){r.then(a=>a&&n());return}n()}}submit(){this.element.submit()}reset(){this.element.reset()}destroy(){this._resetTimer()}_resetTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=0)}getFormData(){const{$element:e,options:t}=this,s=new FormData(this.element);let{submitEmptySelectValue:n="",submitNoValueChecks:r}=t;const{submitDisabledValue:o=!0,cleanEmptyFiles:a}=t;return n!==!1&&(typeof n!="boolean"&&(n=""),e.find("select").each((l,c)=>{const h=v(c),d=h.attr("name");h.is("[disabled]")&&!o||s.has(d)||s.append(d,typeof n=="object"?n[d]:n)})),a&&s.forEach((l,c)=>{var h;l instanceof File&&(!((h=l.name)!=null&&h.length)||!l.size)&&(a==="delete"?s.delete(c):s.set(c,""))}),o&&e.find("[disabled][name]").each((l,c)=>{const h=v(c);if(h.hasClass("not-submit-disabled-value"))return;const d=h.attr("name");s.has(d)||s.append(d,h.val())}),r&&(r=typeof r=="string"?r:"",e.find('[type="checkbox"],[type="radio"]').not(":checked").each((l,c)=>{const h=v(c),d=h.attr("name");s.has(d)||h.is("[disabled]")&&!o||s.append(d,h.data("notCheckedValue")??r)})),s}_send(e){const{$element:t,options:s}=this;let n,r;const o=s.url||t.attr("action"),a={method:t.attr("method")||"POST",data:e,headers:t.closest(".modal").length?{"X-ZUI-Modal":"true"}:void 0,dataType:"json",jsonParser:JSON.parse},{optionsModifiers:l}=this.constructor;l.length&&l.forEach(h=>{const d=h.call(this,a);d&&d!==a&&v.extend(!0,a,d)});const c=v.ajax(o,a).success((h,d,f)=>{var m,y,b;h instanceof Blob?(Ks(h,(b=(y=(m=f.headers.get("Content-Disposition"))==null?void 0:m.split(";")[1])==null?void 0:y.split("=")[1])==null?void 0:b.replace(/"/g,"")),r={result:"success"}):(r=h,(!r||typeof r!="object")&&(n=new Error("Invalid json format")))}).fail(h=>{n=h}).complete(()=>{var h,d;if(n)this.emit("error",n),console.warn("ZUI: send ajax form failed",n),s.onError?s.onError(n):Ve.showError({size:"lg",error:[`<b>POST:</b> ${o}`,`<b>Error:</b> ${Us(n.message)}`,`<b>Response:</b> ${c.data}`].join("<br>")});else{const f=(h=s.onResult)==null?void 0:h.call(this,r);if(f===!1)return;f&&(r=v.extend(r,f)),this._handleResult(r)}this.emit("complete",r,n),(d=s.onComplete)==null||d.call(s,r,n),this.enable(!0,n||(r==null?void 0:r.result)!=="success"?0:5e3)})}_showValidateMessage(e){var s;let t;Object.entries(e).forEach(([n,r])=>{Array.isArray(r)&&(r=r.join(""));const o=qy(n),{$element:a}=this;let l=a.find(`#${o}`);if(l.length||(l=a.find(`[data-form-name="${o}"]`)),l.length||(l=a.find(`[name="${o}"]`)),!l.length&&!n.includes("[")&&(l=a.find(`[name="${o}[]"]`)),!l.length){Ve.alert(r);return}l.hasClass("pick-value")&&(l=l.closest(".pick")),l.addClass("has-error");const c=l.closest(".form-group,.form-batch-control,td");if(c.length){let h=c.find(`#${o}Tip`);h.length||(h=c.find(".form-tip")),h.length||(h=v(`<div class="form-tip ajax-form-tip text-danger pre-line" id="${n}Tip"></div>`).appendTo(c)),h.removeClass("hidden").text(r)}else Ve.alert(r);t||(t=l)}),t&&((s=t[0])==null||s.focus())}_handleResult(e){var l,c;const{options:t}=this;let{message:s}=e;const n=e.result==="success";if(n){if(this.emit("success",e),((l=t.onSuccess)==null?void 0:l.call(t,e))===!1)return;typeof s=="string"&&s.length&&Ms.show({content:s,type:"success"})}else{if(this.emit("fail",e),((c=t.onFail)==null?void 0:c.call(t,e))===!1)return;s&&(Array.isArray(s)&&(s=s.join(`
`)),typeof s=="string"&&s.length?Ve.alert(s):typeof s=="object"&&this._showValidateMessage(s))}const r=t.closeModal??e.closeModal;r&&(r!=="onlySuccess"||n)&&Ve.hide(typeof r=="string"&&r!=="onlySuccess"?r:void 0);const o=t.callback??e.callback;if(o){const h=[["options",t],["result",e]];if(typeof o=="string"){const d=v.runJS(o,...h);typeof d=="function"&&!o.endsWith(";")&&d(e)}else if(typeof o=="object"){const d=v.runJS(o.name,...h);typeof d=="function"&&d.apply(this,Array.isArray(o.params)?o.params:[o.params])}}const a=t.load??e.load??e.locate;a&&this.$element.trigger("locate.zt",a)}}El.NAME="AjaxForm",El.optionsModifiers=[];function cu(i,e){var a,l;const t=i.result==="success";if(t){if(((a=e.onSuccess)==null?void 0:a.call(e,i))===!1)return}else if(((l=e.onFail)==null?void 0:l.call(e,i))===!1)return;const{message:s}=i;s&&(e.onMessage?e.onMessage(s,i):typeof s=="string"&&s.length&&(t?Ms.show({content:s,type:"success"}):Ve.alert(s)));const n=e.closeModal??i.closeModal;n&&Ve.hide(typeof n=="string"?n:void 0);const r=e.callback??i.callback;if(r){const c=[["options",e],["result",i]];if(typeof r=="string"){const h=v.runJS(r,...c);typeof h=="function"&&!r.endsWith(";")&&h(i)}else if(typeof r=="object"){const h=v.runJS(r.name,...c);typeof h=="function"&&h.apply(null,Array.isArray(r.params)?r.params:[r.params])}}const o=e.load??i.load??i.locate;o&&v(e.element||document).trigger("locate.zt",o)}function Gy(i){return typeof i=="string"&&(i=i.split(",").reduce((e,t)=>{const[s,n]=t.trim().split(":");return e[s.trim()]=n.trim(),e},{})),Object.keys(i).reduce((e,t)=>{const s=t.endsWith("?"),n=s?t.substring(0):t;let r=i[n];if(typeof r=="string"){const[o,a]=r.split("~"),l=v(o);if(!l.length)return e;a==="checkedIDList"?r=l.closest("[data-zui-dtable]").dtable("getChecks"):l[0].hasAttribute("data-map-value")?r=l.dataset("mapValue"):l.closest(".pick").length?r=l.closest(".pick").find(".pick-value").val():l.is("input,select,textarea")?r=l.val():r=l.text()}return(s||r!=null&&r!==""&&(!Array.isArray(r)||r.length))&&(e[n]=r),e},{})}async function ri(i){if(i.confirm)return await Ve.confirm(i.confirm)?ri({...i,confirm:void 0}):[void 0,new Error("canceled")];if(i={...El.DEFAULT,...i},i.beforeSubmit&&await i.beforeSubmit(i)===!1)return[void 0,new Error("canceled")];const{loadingClass:e,element:t}=i;t&&e&&v(t).addClass(e);const{data:s,dataMap:n}=i;let r;s&&(r=gr(s)),n&&(r=gr(Gy(n),r));const{beforeSend:o}=i;if(o){const h=o(r);h instanceof FormData&&(r=h)}let a,l;return await new Sr({url:i.url,method:i.method||"POST",body:r,headers:i.inModal?{"X-ZUI-Modal":"true",...i.headers}:i.headers,dataType:"json"}).success((h,d,f)=>{var m,y,b;h instanceof Blob?(Ks(h,(b=(y=(m=f.headers.get("Content-Disposition"))==null?void 0:m.split(";")[1])==null?void 0:y.split("=")[1])==null?void 0:b.replace(/"/g,"")),l={result:"success"}):(l=h,(!l||typeof l!="object")&&(a=new Error("Invalid json format")))}).fail(h=>{a=h,console.warn("ZUI: cannot submit ajax form",h)}).complete(()=>{var h,d,f;if(a)(h=i.onError)==null||h.call(i,a);else{const m=(d=i.onResult)==null?void 0:d.call(null,l);if(m===!1)return;m&&(l=v.extend(l,m)),cu(l,i)}(f=i.onComplete)==null||f.call(i,l,a),t&&e&&v(t).removeClass(e)}).send(),[l,a]}v.extend(v,{ajaxSubmit:ri}),v(document).on("click.ajaxSubmit.zui",".ajax-submit",function(i){i.preventDefault();const e=v(this);if(e.is("[disabled],.disabled"))return;const t=e.data();!t.url&&e.is("a")&&(t.url=e.attr("href")||""),t.inModal=t.inModal??!!e.closest(".modal").length,t.url&&(t.element=this[0],ri(t))});class ak extends ae{constructor(e){super(e),this.state={pinnedList:e.pinnedList||[]}}_handlePinnedChange(e){const{pinnedList:t}=this.state;t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),this.setState({pinnedList:t})}_handleSave(){var e,t;(t=(e=this.props).onSave)==null||t.call(e,this.state.pinnedList)}render(e,t){const{tip:s,items:n,saveText:r=Pe.getLang("save"),resetText:o=Pe.getLang("reset"),cancelText:a=Pe.getLang("cancel"),pinnedIcon:l="pinned",unpinnedIcon:c="unpinned"}=e,{pinnedList:h}=t,d=new Set(h);return g("form",{className:"form-setting-form w-80 col gap-3"},g("div",{className:"text-gray mt-2"},s),g("div",{className:"divider opacity-5"}),g("div",{className:"row flex-wrap"},n.map(({text:f,value:m})=>{const y=d.has(m);return g("label",{className:"state size-sm ghost w-1/2 pl-1 pr-2 py-1 flex flex-nowrap gap-2 items-center rounded",onClick:this._handlePinnedChange.bind(this,m)},g(Ie,{icon:y?l:c,className:y?"text-primary":"text-gray-400"}),g("div",{className:`flex-auto text-clip${y?"":" text-gray"}`},f))})),g("div",{className:"row flex-nowrap gap-4 mt-2"},g(we,{size:"md",className:"btn-wide",type:"primary",onClick:this._handleSave.bind(this)},r),g(we,{size:"md",className:"btn-wide","data-dismiss":"popover"},a),g(we,{size:"md",type:"primary-ghost",disabled:!h.length,onClick:()=>this.setState({pinnedList:[]})},o)))}}class Zy extends qt{_getFormItems(){const e=this.$element.closest("form"),t=[],s=[];return e.find(".form-group.is-foldable[data-name]").each((n,r)=>{if(v(r).hasClass("hidden"))return;const o=v(r),a=o.data("name"),l=o.find(".form-label").first();let c=o.data("label");if(c===void 0){const h=l.find(".text");h.length&&(c=h.text())}c===void 0&&(c=l.text().trim()),t.push({value:a,text:c||a}),o.hasClass("is-pinned")&&s.push(a)}),{items:t,pinnedList:s}}_handleSave(e){const{customUrl:t,onSave:s}=this.options,n=()=>{(s==null?void 0:s(e))!==!1&&this.hide();const r=this.$element.closest("form");r.find(".form-group.is-foldable[data-name]").each((o,a)=>{const l=v(a),c=l.data("name");l.toggleClass("is-pinned",e.includes(c))}),r.toggleClass("no-foldable-items",!r.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)};t?ri({url:t,data:{"fields[]":e},onSuccess:r=>{delete r.callback,n()}}):n()}_getRenderOptions(){const{title:e,tip:t,className:s,saveText:n,resetText:r,cancelText:o}=this.options,{items:a,pinnedList:l}=this._getFormItems();return{...super._getRenderOptions(),title:e,headingClass:"popover-heading transparent px-4 pt-4",contentClass:"px-4 pb-4",titleClass:"text-lg font-bold",content:g(ak,{tip:t,saveText:n,resetText:r,cancelText:o,items:a,pinnedList:l,onSave:this._handleSave.bind(this),onCancel:this.hide.bind(this)}),className:K("form-setting-popover",s)}}}Zy.NAME="FormSetting";class Yy extends Ze{constructor(){super(...arguments),this._loadFormTimer=0}get mode(){return this.$container.hasClass("is-full")?"full":"lite"}get shownFoldItems(){return this.$container.hasClass("show-fold-items")}get $container(){let e=this._$container;if(!e){const{$element:t}=this;e=t.closest(".panel-form,.page-form"),e.length||(e=t),this._$container=e}return e}afterInit(){super.afterInit();const e=[],{$element:t}=this;t.children(".form-group[data-name]").each((a,l)=>{e.push(v(l).attr("data-name"))}),this._fields=e;const{fullModeOrders:s}=this.options;this._fullModefields=typeof s=="string"?[s]:s;let{preserve:n}=this.options;(n===!0||n===void 0)&&(n=t.attr("id")),this._preserveID=n||!1;const r=this.options.mode||(this._preserveID?st.get(`FormGrid:${this._preserveID}:mode`,this.mode):this.mode);this.toggleMode(r,!1,!0);const{namespace:o}=this;this.$container.on(`click${o}`,".btn-full-form",()=>this.toggleMode("full")).on(`click${o}`,".btn-lite-form",()=>this.toggleMode("lite")).on(`click${o}`,".btn-toggle-fold",()=>this.toggleFold()),t.on(`change${o}`,"[name]",this._handleChange.bind(this)),t.toggleClass("no-foldable-items",!t.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)}getField(e){const{$element:t}=this;let s=t.children(`.form-group[data-name="${e}"]`);if(!s.length)return;const n=t.children(`[data-wrap-before="${e}"]`),r=t.children(`[data-wrap-after="${e}"]`);let o=v();return n.length&&(o=o.add(n)),s.find("script").remove(),s=t.children(`.form-group[data-name="${e}"]`),o=o.add(s),r.length&&(o=o.add(r)),{name:e,wrapBefore:!!n.length,wrapAfter:!!r.length,foldable:s.hasClass("is-foldable"),$ele:s,$group:o}}destroy(){super.destroy(),this.$container.off(this.namespace)}toggleFold(e){e=e??!this.shownFoldItems,this.$container.toggleClass("show-fold-items",e)}openSetting(){this.$container.find(".btn-custom-form").trigger("click")}toggleMode(e,t,s){const n=this.mode;e=e||(n==="full"?"lite":"full"),!(n===e&&!t)&&(this.$container.toggleClass("is-full",e==="full").toggleClass("is-lite",e==="lite"),!s&&this._preserveID&&st.set(`FormGrid:${this._preserveID}:mode`,e),this.updateOrders())}updateOrders(e,t){e&&(this._fields=e),t&&(this._fullModefields=typeof t=="string"?[t]:t);const{mode:s}=this;s==="full"?(t=this._fullModefields,Array.isArray(t)&&t.forEach(n=>{this.sortFields(n)})):this.sortFields()}sortFields(e){e=e||this._fields,typeof e=="string"&&(e=e.split(","));let t;e.forEach(r=>{const o=this.getField(r);if(o){if(t){const a=t.$group.last();if(o.$group.first()[0]===a[0])return;o.$group.insertAfter(a)}t=o}});const s=this.$element.children(".form-group.is-foldable").first(),n=this.$element.children(`[data-wrap-before="${s.attr("data-name")}"]`);this.$element.children(".panel-form-divider").insertBefore(n.length?n:s)}tryLoadForm(e,t=300){this._loadFormTimer&&clearTimeout(this._loadFormTimer),this._loadFormTimer=window.setTimeout(()=>{this._loadFormTimer=0,window.loadForm(e)},t)}_handleChange(e){const{autoLoad:t,loadUrl:s}=this.options;if(!t)return;const n=v(e.target).closest("[name]");Object.keys(t).forEach(r=>{const o=t[r];".[#".includes(r[0])||(r=`[name="${r}"]`),n.closest(r).length&&this.tryLoadForm(v.extend({url:s,target:n},typeof o=="string"?{items:o}:o))})}}Yy.NAME="FormGrid";class Al extends Vi{constructor(e,t){super(e,t),this._batchForm=ty.query(this.$element)}get batchForm(){return this._batchForm}setFormData(e){return this._batchForm?this.setBatchFormData(e):super.setFormData(Array.isArray(e)?e[0]:e)}setBatchFormData(e){if(!Array.isArray(e)){const r=Object.keys(e);r.length===1&&Array.isArray(e[r[0]])&&(e=e[r[0]])}const t=Array.isArray(e)?e:[e],s=this._batchForm.options.idKey??"id",n=t.map((r,o)=>{const a=r[s]??String(o+1);return{...r,[s]:a}});this._batchForm.render({data:n},!0)}}function lk(i,e){return new Al(i,e)}Al.registerControl("zenEditor",(i,e)=>{const t=i.closest("zen-editor");if(!t.length||!t.closest(e).length)return;const s=t[0];return{type:"zenEditor",$element:t,instance:s,getVal:()=>s.value,setVal:n=>(s.setHTML(n),!0)}}),Al.registerControl("editor",(i,e)=>{const t=i.closest("[z-use-editor]");if(!t.length||!t.closest(e).length)return;const s=t.zui("editor");return{type:"editor",$element:t,instance:s,getVal:()=>s.content,setVal:n=>{let r="doc";if(typeof n=="string")try{n=JSON.parse(n)}catch{r="html"}return s.updateDoc(n,r),!0}}});const YD="",ck=Object.freeze(Object.defineProperty({__proto__:null,zentao:{name:"zentao",plugins:{marker:!0,critical_path:!0,tooltip:!0},config(i){const t=this.options.showFields,s=new Set(t),n=[{name:"text",tree:!0,resize:!0,min_width:120,width:200},s.has("PM")?{name:"owner_id",align:"left",resize:!0,width:80,template:function(o){const l=i.serverList("userList").find(c=>c.key===o.owner_id);return(l==null?void 0:l.label)??o.owner_id}}:null,s.has("status")?{name:"status",align:"center",resize:!0,width:80}:null,{name:"begin",align:"center",resize:!0,width:80},{name:"duration",align:"center",resize:!0,width:60},s.has("estimate")?{name:"estimate",align:"center",resize:!0,width:60}:null,s.has("progress")?{name:"percent",align:"center",resize:!0,width:70,template:function(o){if(o.percent)return Math.round(o.percent)+"%"}}:null,s.has("taskProgress")?{name:"taskProgress",align:"center",resize:!0,width:60}:null,s.has("realBegan")?{name:"realBegan",align:"center",resize:!0,width:80}:null,s.has("realEnd")?{name:"realEnd",align:"center",resize:!0,width:80}:null,s.has("consumed")?{name:"consumed",align:"center",resize:!0,width:60}:null,s.has("delay")?{name:"delay",align:"center",resize:!0,width:60,template:function(o){return o.delayDays>0?"<div class='delayed'>"+o.delay+"</div>":o.delay}}:null,s.has("delayDays")?{name:"delayDays",align:"center",resize:!1,width:60}:null].filter(Boolean);n[n.length-1].resize=!1;const r=[{unit:"year",step:1,format:"%Y"},{unit:"day",step:1,format:"%m-%d"}];return{columns:n,readonly:!0,details_on_dblclick:!1,order_branch:!1,drag_progress:!1,drag_links:!1,drag_move:!1,drag_resize:!1,smart_rendering:!0,smart_scales:!0,static_background:!0,show_task_cells:!1,row_height:32,details_on_create:!1,duration_unit:"day",show_chart:!0,scales:r,min_column_width:70,scale_height:22*r.length}},serverListMap(){return{userList:this.options.userList}},templates(i){return{grid_date_format:function(e,t){const s=i.date.date_to_str("%Y-%m-%d");return s(t==="end_date"?new Date(e.valueOf()-1):e)}}},onInit(i){i.locale.labels={...i.locale.labels,...this.options.ganttFields},this.options.showDate=new Date}}},Symbol.toStringTag,{value:"Module"})),Pl=class Mf extends Ze{get gantt(){return this._gantt}setOptions(e,t){const s=super.setOptions(e,t);return this._exts=s.exts?(typeof s.exts=="string"?s.exts.split(","):s.exts).map(n=>typeof n=="string"?Mf.extensions[n]:n).filter(Boolean):[],s}async afterInit(){const{getGanttInstance:e}=await Mf.loadModule();this._gantt=e(),this._exts.forEach(t=>{var s;(s=t.onCreate)==null||s.call(this,this._gantt)}),this._initGantt(),this.render()}_initGantt(){const{templates:e={},events:t={},plugins:s={},serverListMap:n={},markers:r=[],config:o={},onInit:a}=this.options;this.$element.addClass("gantt-container"),this._gantt.init(this.element),this.setTemplates(e),this.attachEvents(t),this.setPlugins(s),this.setServerListMap(n),this.addMarkers(r),this.setConfig(o),this._exts.forEach(l=>{var c;l.config&&this.setConfig(l.config),l.templates&&this.setTemplates(l.templates),l.events&&this.attachEvents(l.events),l.plugins&&this.setPlugins(l.plugins),l.markers&&this.addMarkers(l.markers),l.serverListMap&&this.setServerListMap(l.serverListMap),(c=l.onInit)==null||c.call(this,this._gantt)}),a==null||a.call(this,this._gantt)}setPlugins(e){this._gantt.plugins(typeof e=="function"?e.call(this,this._gantt):e)}setTemplate(e,t){this._gantt.templates[e]=t}setTemplates(e){v.extend(this._gantt.templates,typeof e=="function"?e.call(this,this._gantt):e)}setServerListMap(e){Object.entries(typeof e=="function"?e.call(this,this._gantt):e).forEach(([t,s])=>{this._gantt.serverList(t,s)})}setServerList(e,t){this._gantt.serverList(e,t)}setConfig(e,t){e=typeof e=="function"?e.call(this,this._gantt):e,typeof e=="string"?this._gantt.config[e]=t:v.extend(this._gantt.config,e)}addMarker(e){this._gantt.addMarker(e)}addMarkers(e){typeof e=="function"&&(e=e.call(this,this._gantt)),Array.isArray(e)?e.forEach(t=>{this.addMarker(t)}):Object.entries(e).forEach(([t,s])=>{this.addMarker({id:t,...s})})}attachEvent(e,t){this._gantt.attachEvent(e,t)}attachEvents(e){Object.entries(typeof e=="function"?e.call(this,this._gantt):e).forEach(([t,s])=>{this._gantt.attachEvent(t,s)})}async render(e,t){super.render(e,t);const{data:s=[],links:n=[],resources:r=[],assignments:o=[],collections:a={},showDate:l,width:c,height:h,onRender:d,beforeRender:f,fetcher:m}=this.options;let y={data:s,links:n,resources:r,assignments:o,collections:a};m&&(this.$element.addClass("loading"),y=await Ne(m,[],{},this),this.$element.removeClass("loading")),f==null||f.call(this,this._gantt,y),c&&this.$element.css("width",je(c)),h&&this.$element.css("height",je(h)),this._gantt.clearAll(),this._gantt.parse(y),l&&this._gantt.showDate(l),this._gantt.render(),d==null||d.call(this,this._gantt)}destroy(){var e;super.destroy(),(e=this._gantt)==null||e.destructor()}static async loadModule(){if(!this.Module&&!this.Module){const e=await v.getLib("dhxgantt");this.Module=e}return this.Module}static registerExtension(e){this.extensions[e.name]=e}};Pl.NAME="Gantt",Pl.DEFAULT={width:"100%",height:400},Pl.extensions=ck;let Jy=Pl;Jy.register();const Xy=(c_=window.config)==null?void 0:c_.version;v.registerLib("dhxgantt",{src:Xy?["dhtmlxgantt/min.js","dhtmlxgantt/min.css",`dhtmlxgantt/lang/${Pe.getCode().replace("_","-")}.js`]:["gantt/dhtmlxgantt/min.js","gantt/dhtmlxgantt/min.css",`gantt/dhtmlxgantt/lang/${Pe.getCode().replace("_","-")}.js`],root:Xy?`${window.config.webRoot}js/`:void 0,check:"Gantt"});const XD="",QD="";ot(V0);const eI="";let Qy=class extends at{constructor(){super(...arguments),this._searchBox=ye(),this._menu=ye(),this._handleChange=e=>{this.setState({value:e.trim()})},this._handleFocus=()=>{this.toggle(!0)},this._handleEenter=()=>{var t;const e=(t=this._menu.current)==null?void 0:t.getActiveKey();e&&this.search(e)},this._handleClickItem=e=>{this.search(e.item.key)}}search(e){var t,s;(t=this.props.onSearch)==null||t.call(this,e,this.state.value),this.toggle(!1,{value:""}),(s=this._searchBox.current)==null||s.blur()}componentDidUpdate(e,t){var n;super.componentDidUpdate(e,t);const s=this._menu.current;this.state.open&&s&&!((n=this._types)!=null&&n.has(s.getActiveKey()))&&s.activeNext()}_getHotkeys(){return this._hotkeys||(this._hotkeys={activeNext:{keys:"ArrowDown",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activeNext()}},activePrev:{keys:"ArrowUp",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activePrev()}},enter:!0}),this._hotkeys}_renderTrigger(e){return g(mn,{delay:0,ref:this._searchBox,placeholder:e.searchHint,onChange:this._handleChange,onFocus:this._handleFocus,hotkeys:this._getHotkeys(),onEnter:this._handleEenter,...e.searchBox})}_getItems(e,t){const{items:s,getObjectID:n,getSearchType:r}=e,{value:o}=t;let a=r==null?void 0:r.call(this,o);const l=a&&a[0]==="!";l&&(a=a.slice(1));const c=n?n.call(this,o):Number.isInteger(+o)?+o:!1,h=Number.isInteger(c),d=[],f=s.reduce((b,w)=>(b.set(w.key,w),b),new Map),m="search",y=b=>{var w;return{html:((w=b.text)==null?void 0:w.replace("{0}",o))??o}};if(a&&h){const b=f.get(a);b&&d.push({...b,className:K(b.className,"w-full"),text:y(b)})}if(!l){const b=f.get(m);d.push({...b,className:K(b==null?void 0:b.className,"w-full"),text:b?y(b):o})}return h&&s.forEach(b=>{b.key===m||b.key===a||l||d.push({...b,className:K(b.className,"w-1/2"),text:y(b)})}),this._types=new Set(d.map(b=>b.key)),d}_renderPop(e,t){return g(Rt,{className:"row flex-wrap overflow-auto scrollbar-hover",items:this._getItems(e,t),onClickItem:this._handleClickItem,ref:this._menu,activeOnHover:!0,...e.menu})}};Qy.defaultProps={...at.defaultProps,pickerName:"global-search",hidePopWhenEmpty:!0};class Ll extends be{}Ll.NAME="GlobalSearch",Ll.Component=Qy,Ll.replace=!0;function hk(i,e=1e3){let t=null;return(...s)=>{t&&clearTimeout(t),t=setTimeout(()=>{i(...s),t=null},e)}}const ev=class ob extends Ze{static async loadModule(){return this.Module||(this.Module=await v.getLib("g6")),this.Module}async afterInit(){const e=await ob.loadModule();if(this.destroyed)return;const{type:t="TreeGraph",width:s=this.$element.width(),height:n=this.$element.height()||500,responsive:r=!1,data:o,nodeFn:a,edgeFn:l,comboFn:c,...h}=this.options,d=new e[t]({container:this.element,width:s,height:n,...h});a&&d.node(a),l&&d.edge(l),c&&d.combo(c),d.data(o),d.render(),this.instance=d,r&&this.initResizeObserver()}initResizeObserver(){const e=hk(()=>{this.instance.changeSize(this.$element.width(),this.$element.height()),this.instance.render()},500);this.resizeObserver=new ResizeObserver(()=>{e()}),this.resizeObserver.observe(this.element)}destroy(){var e;this.options.responsive&&((e=this.resizeObserver)==null||e.disconnect()),this.instance.destroy(),super.destroy()}};ev.NAME="Graph";let tv=ev;v.registerLib("g6",{src:"graph/g6.min.js",check:"G6"}),tv.register();const tI="";class hu extends Ze{init(){this.clipWidth=this.options.defaultWidth,this.clipHeight=this.options.defaultHeight,this.initDom(),this.initSize(),this.bindEvents()}initDom(){this.$canvas=this.$element.find(".canvas"),this.$img=this.$canvas.find("img"),this.$btn=this.$element.find("button");const e=this.$img.prop("src"),{coverColor:t,coverOpacity:s}=this.options;this.$canvas.append([`<div class="cover" style="background: ${t}; opacity: ${s};"></div>`,`<div class="controller" style="width: ${this.clipWidth}px; height: ${this.clipHeight}px">`,["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"].map(n=>`<div class="control" data-type="${n}"></div>`).join(""),"</div>",'<div class="cliper">',`<img src="${e}"/>`,"</div>"].join("")),this.$controller=this.$canvas.find(".controller"),this.$cliper=this.$canvas.find(".cliper"),this.$chipImg=this.$cliper.find("img")}resetImage(e){this.$img.prop("src",e),this.$chipImg.prop("src",e),this.imgWidth=0,this.left=-1,this.initSize()}initSize(){const{minWidth:e,minHeight:t,ready:s,onSizeError:n}=this.options;if(this.imgWidth)return;const r=a=>{this.imgWidth=a.width,this.imgHeight=a.height,(a.width<e||a.height<t)&&(n==null||n({width:a.width,height:a.height}),this.options.minWidth=Math.min(a.width,e),this.options.minHeight=Math.min(a.height,t)),s==null||s(),this.width=Math.min(this.imgWidth,this.$element.width()),this.$canvas.css("width",this.width),this.height=this.$canvas.height(),(this.left===void 0||this.left<0)&&(this.left=Math.floor((this.width-this.$controller.width())/2),this.top=Math.floor((this.height-this.$controller.height())/2)),this.refreshSize()},o=this.$img[0];o.complete?r(o):o.onload=()=>{r(o)}}refreshSize(e){const{minWidth:t,minHeight:s,fixedRatio:n,defaultWidth:r,defaultHeight:o}=this.options;this.clipWidth=Math.max(t,Math.min(this.width,this.clipWidth)),this.clipHeight=Math.max(s,Math.min(this.height,this.clipHeight)),n&&(e&&e==="height"?(this.clipWidth=Math.max(t,Math.min(this.width,this.clipHeight*r/o)),this.clipHeight=this.clipWidth*o/r):(this.clipHeight=Math.max(s,Math.min(this.height,this.clipWidth*o/r)),this.clipWidth=this.clipHeight*r/o)),this.left=Math.min(this.width-this.clipWidth,Math.max(0,this.left)),this.top=Math.min(this.height-this.clipHeight,Math.max(0,this.top)),this.right=this.left+this.clipWidth,this.bottom=this.top+this.clipHeight,this.$controller.css({left:this.left,top:this.top,width:this.clipWidth,height:this.clipHeight}),this.$cliper.css("clip",`rect(${this.top}px, ${this.left+this.clipWidth}px, ${this.top+this.clipHeight}px, ${this.left}px)`)}getData(){return{originWidth:this.imgWidth,originHeight:this.imgHeight,scaleWidth:this.width,scaleHeight:this.height,width:this.right-this.left,height:this.bottom-this.top,left:this.left,top:this.top,right:this.right,bottom:this.bottom,scaled:this.imgWidth!==this.width||this.imgHeight!==this.height}}bindEvents(){this.$element.on("resize",this.initSize.bind(this)),this.$btn.on("click",e=>{var t,s;(s=(t=this.options).handleBtnClick)==null||s.call(t,e,this.getData())}),this.moveable=new Ni(this.$controller,{selector:".control,.controller",move:!1,onMoveStart:()=>{this.startLeft=this.left,this.startTop=this.top,this.startClipWidth=this.clipWidth,this.startClipHeight=this.clipHeight},onMove:(e,t)=>{const s=v(t.target);if(s.is(".controller"))this.left=this.startLeft+t.deltaX,this.top=this.startTop+t.deltaY,this.refreshSize();else{const n=s.data("type");let r=!1;const{minWidth:o,minHeight:a}=this.options;switch(n){case"left":case"top-left":case"bottom-left":this.left=Math.min(this.right-o,Math.max(0,this.startLeft+t.deltaX)),this.clipWidth=this.right-this.left;break;case"right":case"top-right":case"bottom-right":this.clipWidth=Math.min(this.width-this.left,Math.max(o,this.startClipWidth+t.deltaX));break}switch(n){case"top":case"top-left":case"top-right":this.top=Math.min(this.bottom-a,Math.max(0,this.startTop+t.deltaY)),this.clipHeight=this.bottom-this.top,r=!0;break;case"bottom":case"bottom-left":case"bottom-right":this.clipHeight=Math.min(this.height-this.top,Math.max(a,this.startClipHeight+t.deltaY)),r=!0;break}this.refreshSize(r)}}})}destroy(){var e;(e=this.moveable)==null||e.destroy(),super.destroy()}}hu.NAME="ImgCutter",hu.DEFAULT={coverColor:"#000",coverOpacity:.6,defaultWidth:128,defaultHeight:128,minWidth:48,minHeight:48,fixedRatio:!0};const oi=class{static get images(){var e;return(e=this.Module)==null?void 0:e.images}static async loadModule(){return this.Module||(this.Module=await v.getLib("mammoth")),this.Module}};oi.convertToHtml=async function(i,e){const{convertToHtml:t}=await oi.loadModule();return t(i,e)},oi.extractRawText=async function(i){const{extractRawText:e}=await oi.loadModule();return e(i)},oi.embedStyleMap=async function(i,e){const{embedStyleMap:t}=await oi.loadModule();return t(i,e)};let dk=oi;v.registerLib("mammoth",{src:["mammoth/mammoth.browser.min.js"],check:"mammoth",type:"module"}),ot(fx);const sI="",nI="",du=new na("mermaid",{src:["mermaid/mermaid.min.js"],check:"mermaid"}),uk={parseFailed:"绘图解析失败",copyError:"复制错误",rendering:"正在绘制图形..."},fk={parseFailed:"绘图解析失敗",copyError:"複製錯誤",rendering:"正在繪製圖形..."},pk={parseFailed:"Parse graph failed",copyError:"Copy error",rendering:"Rendering graph..."};Pe.addLang({zh_cn:{mermaid:uk},zh_tw:{mermaid:fk},en:{mermaid:pk}});function uu(i,e,t){return Pe.getLang(`mermaid.${i}`,e,t)}let sv=class extends ae{constructor(){super(...arguments),this._id=`_mermaid-${Xe()}`,this._svg=pe(""),this._error=pe(""),this._rendering=pe(!1),this._timer=0,this.copyError=async()=>{navigator.clipboard&&await navigator.clipboard.writeText(this._error.value)}}componentDidMount(){this.tryUpdate()}componentDidUpdate(e){e.text!==this.props.text&&this.tryUpdate()}async update(){const e=this.props.text,t=await du.load();if(!t)return;const{id:s=this._id}=this.props,{svg:n,bindFunctions:r}=await t.render(s,e);if(e===this.props.text)return this._svg.value=n,r==null||r(this.base),!0}async tryUpdate(){this._timer&&clearTimeout(this._timer),this._rendering.value=!0,this._timer=window.setTimeout(async()=>{try{this._error.value="",await this.update()}catch(e){console.error("[ZUI] Mermaid: tryUpdate failed",e),this._error.value=String(e)}this._rendering.value=!1},this.props.delay||0)}render(e){const{className:t,style:s,id:n}=e,r=this._error.value,o=this._rendering.value;return r||o?g("div",{id:n,className:K("mermaid-view",t),style:s},o?g("div",{class:"primary-pale text-sm p-1 flex items-center gap-1"},g("i",{class:"icon icon-spinner-indicator spin"}),g("div",{class:"flex-auto"},uu("rendering"))):g("div",{class:"danger-pale text-sm p-1 flex items-center gap-1",title:r},g("i",{class:"icon icon-alert"}),g("div",{class:"flex-auto"},uu("parseFailed")),navigator.clipboard?g("button",{type:"button",class:"btn ghost size-xs",onClick:this.copyError,title:uu("copyError")},g("i",{class:"icon icon-copy"})):null),g("pre",{class:"markdown-code-block code-highlight github-light",style:"margin-top:0;border-top-left-radius: 0;border-top-right-radius: 0;"},e.text)):g("div",{id:n,className:K("mermaid-view",t),style:s,dangerouslySetInnerHTML:{__html:this._svg.value}})}};sv.defaultProps={delay:200};const fu=class ab extends be{init(){const{text:e}=this.options;e===void 0&&(this.options.text=this.$element.text(),this.$element.empty())}static async render(e,t,s){const n=await ab.loadModule();if(n)return n.render(e,t,s)}static get Module(){return du.Module}static loadModule(){return du.load()}};fu.NAME="Mermaid",fu.Component=sv;let nv=fu;nv.register();const iI="",rI="";Object.assign(Ms.TypeOptions,{success:{key:"zt-messager-success",icon:"check-circle",type:"success",close:!1},danger:{icon:"exclamation-sign",type:"danger",close:!1}}),Object.assign(Ms,{success(i){return Ms.show(i,"success")},fail(i){return Ms.show(i,"danger")}}),Object.assign(Ms.DEFAULT,{time:3e3,className:"messager-lite"});const oI="";function mk(i){return Ve.confirm({iconClass:"warning rounded-full center w-8 h-8 flex-none",type:"custom",custom:{className:"modal-reconfirm",closeBtn:!1},...i})}async function gk(i){const{sortable:e={},onSort:t,items:s,itemProps:n={icon:"move muted",innerClass:"border rounded px-2 canvas cursor-move hover:shadow"},list:r,header:o,message:a,footer:l,...c}=i;let h;const d=(m,y)=>{h=y,t==null||t(m,y)};if(await Ve.confirm({type:"custom",content:g("div",{className:"modal-body sort-view col gap-2"},g(fe,{className:"sort-view-header",content:o}),g(fe,{className:"sort-view-message muted",content:a}),g(Rr,{className:"space-y-2",sortable:e,items:s,itemProps:n,onSort:d,...r}),g(fe,{className:"sort-view-footer",content:l})),...c}))return h}Pe.addLang({zh_cn:{occurredError:"发生了错误"},zh_tw:{occurredError:"發生了錯誤"},en:{occurredError:"An error occurred"}});async function yk(i){const{title:e,mono:t,html:s=!0,copyBtn:n=!0,basePath:r,contentClass:o,error:a,...l}=i;let c=typeof a=="string"?a:(a==null?void 0:a.message)??"",h=t,d=e;s&&(r&&(c=c.split(r).join('<i class="icon icon-file-text opacity-50"></i>/')),c.startsWith(`<br />
`)&&(c=c.replace(`<br />
`,"")),c.startsWith("<!DOCTYPE html")&&(h===void 0&&(h=!1),d===void 0&&(d=v(c).filter("title").text())));const f=ye();return await Ve.confirm({title:d??Pe.getLang("occurredError"),message:"",type:"custom",custom:{className:"backdrop-blur border-2 border-canvas bg-opacity-80 rounded-xl",headerClass:"text-danger"},content:g("div",{ref:f,className:K("modal-body",h!==!1?" font-mono":"",o),style:{whiteSpace:h!==!1?"pre-line":"normal"},dangerouslySetInnerHTML:s?{__html:c}:void 0},s?void 0:c),actions:[n?{key:"confirm",text:typeof n=="string"?n:Pe.getLang("copy"),icon:"copy",onClick:()=>{const y=f.current;if(navigator.clipboard)navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([y.innerText],{type:"text/plain"}),"text/html":new Blob([y.innerHTML],{type:"text/html"})})]);else{const b=document.createRange();b.selectNode(y),window.getSelection().removeAllRanges(),window.getSelection().addRange(b),document.execCommand("copy"),window.getSelection().removeAllRanges()}}}:null,{key:"cancel",text:Pe.getLang("close")}].filter(Boolean),...l})}Object.assign(Ve,{reconfirm:mk,sortView:gk,showError:yk}),Ve.DEFAULT.backdrop="static",Ve.DEFAULT.request={dataFilter:i=>{if(i[0]==="{")try{const e=JSON.parse(i);if(e.result)return cu(e,{closeModal:!0}),setTimeout(()=>{v(".modal").each(function(){const t=v(this);t.text().trim().length||t.modal("hide")})},200),""}catch{}return i}},nd.defaultProps.iframeBodyClass="body-modal";class Rl extends be{}Rl.NAME="PriPicker",Rl.Component=no,Rl.register();class zl extends be{}zl.NAME="DiffPicker",zl.Component=Yd,zl.register();class Fl extends be{}Fl.NAME="SeverityPicker",Fl.Component=Jd,Fl.register();class Ol extends be{}Ol.NAME="RangePicker",Ol.Component=Ny,Ol.register();const aI="",lI="",cI="",hI="",dI="";class jl extends we{constructor(){super(...arguments),this._handleClick=()=>{var e;(e=this._copyBtn)==null||e.copy()}}get coyBtn(){return this._copyBtn}componentDidMount(){super.componentDidMount(),this._copyBtn=new Yn(this.base,this.props)}componentWillUnmount(){var e;super.componentWillUnmount(),(e=this._copyBtn)==null||e.destroy()}_getProps(e){return{...super._getProps(e),onClick:this._handleClick}}}jl.NAME="CopyBtn",jl.DEFAULT={...Yn.DEFAULT};class iv extends ae{constructor(){super(...arguments),this._ref=ye()}get highlighter(){return this._highlighter}componentDidMount(){this._highlighter=new Yr(this._ref.current,this.props)}componentDidUpdate(e){(e.code!==this.props.code||e.lang!==this.props.lang)&&this.update()}componentWillUnmount(){var e;(e=this._highlighter)==null||e.destroy()}update(){var e;return(e=this._highlighter)==null?void 0:e.update()}render(e){const{className:t,style:s}=e;return g("div",{ref:this._ref,className:K("code-highlight",t),style:s})}}const vk={preview:"预览",source:"源码",downloadSource:"下载",copySource:"复制",openInNewTab:"在新标签页中打开"},_k={preview:"預覽",source:"源碼",downloadSource:"下載",copySource:"復制",openInNewTab:"在新標籤頁中打開"},bk={preview:"Preview",source:"Source",downloadSource:"Download",copySource:"Copy",openInNewTab:"Open in New Tab"};Pe.addLang({zh_cn:{htmlSandbox:vk},zh_tw:{htmlSandbox:_k},en:{htmlSandbox:bk}});function Ls(i,e,t){return Pe.getLang(`htmlSandbox.${i}`,e,t)}let rv=class extends ae{constructor(){super(...arguments),this._iframeRef=ye(),this._viewSource$=pe(!1),this.showPreview=()=>{this._viewSource$.value=!1},this.showSource=()=>{this._viewSource$.value=!0},this.downloadSource=()=>{const e=new Blob([this.props.html],{type:"text/html"});Ks(e,`${this.getTitleFromHtml()}.html`)},this.openInNewTab=()=>{this._blobUrl&&URL.revokeObjectURL(this._blobUrl);const e=new Blob([this.props.html],{type:"text/html"});this._blobUrl=URL.createObjectURL(e),window.open(this._blobUrl,"_blank")}}getTitleFromHtml(){const e=this.props.html.match(/<title>(.*?)<\/title>/);return e?e[1]:"Sandbox"}componentWillUnmount(){this._blobUrl&&URL.revokeObjectURL(this._blobUrl)}render(e){const{className:t,html:s,height:n=400}=e,r=this._viewSource$.value,o=this.getTitleFromHtml(),a=je(n);return g("div",{className:K("html-sandbox position-relative surface border shadow rounded-md overflow-hidden",t)},g("menu",{class:"sanbox-header toolbar px-2 py-1 gap-4 relative"},g("div",{class:"flex-auto font-bold flex items-center gap-1"},g("i",{class:"icon icon-file-text"}),o),g("div",{class:"inset-0 absolute center"},g("div",{class:"btn-group size-sm"},g("button",{type:"button",class:`btn ${r?"":"active text-primary ring-primary bg-primary-50"}`,onClick:this.showPreview},g("i",{class:"icon icon-eye"}),Ls("preview")),g("button",{type:"button",class:`btn ${r?"active text-primary ring-primary bg-primary-50":""}`,onClick:this.showSource},g("i",{class:"icon icon-code"}),Ls("source")))),g("div",{class:"toolbar size-sm"},g(jl,{type:"ghost",square:!0,icon:"copy",copy:s,hint:Ls("copySource")}),g("button",{type:"button",class:"btn ghost square",onClick:this.openInNewTab,title:Ls("openInNewTab")},g("i",{class:"icon icon-panel"})),g("button",{type:"button",class:"btn ghost square",onClick:this.downloadSource,title:Ls("downloadSource")},g("i",{class:"icon icon-download"})))),g("div",{class:K("sanbox-iframe canvas",r?"hidden":"")},g("iframe",{ref:this._iframeRef,sandbox:"allow-scripts allow-forms",srcdoc:s,style:{height:a,width:"100%"}})),r?g("div",{class:"sanbox-source border-t overflow-auto",style:{maxHeight:a}},g(iv,{code:s,lang:"html"})):null)}},ov=class extends ae{constructor(){super(...arguments),this._viewSource$=pe(!1),this.showPreview=()=>{this._viewSource$.value=!1},this.showSource=()=>{this._viewSource$.value=!0},this.downloadSource=()=>{const e=new Blob([this.props.svg],{type:"image/svg+xml"});Ks(e,`${this.getTitleFromSvg()}.svg`)},this.openInNewTab=()=>{this._blobUrl&&URL.revokeObjectURL(this._blobUrl);const e=new Blob([this.props.svg],{type:"image/svg+xml"});this._blobUrl=URL.createObjectURL(e),window.open(this._blobUrl,"_blank")}}getTitleFromSvg(){const e=this.props.svg.match(/<title>(.*?)<\/title>/);return e?e[1]:"SVG"}componentWillUnmount(){this._blobUrl&&URL.revokeObjectURL(this._blobUrl)}render(e){const{className:t,svg:s}=e,n=this._viewSource$.value,r=this.getTitleFromSvg();return g("div",{className:K("svg-box position-relative surface border shadow rounded-md overflow-hidden",t)},g("menu",{class:"svg-box-header toolbar px-2 py-1 gap-4 relative"},g("div",{class:"flex-auto font-bold flex items-center gap-1"},g("i",{class:"icon icon-file-image"}),r),g("div",{class:"inset-0 absolute center"},g("div",{class:"btn-group size-sm"},g("button",{type:"button",class:`btn ${n?"":"active text-primary ring-primary bg-primary-50"}`,onClick:this.showPreview},g("i",{class:"icon icon-eye"}),Ls("preview")),g("button",{type:"button",class:`btn ${n?"active text-primary ring-primary bg-primary-50":""}`,onClick:this.showSource},g("i",{class:"icon icon-code"}),Ls("source")))),g("div",{class:"toolbar size-sm"},g(jl,{type:"ghost",square:!0,icon:"copy",copy:s,hint:Ls("copySource")}),g("button",{type:"button",class:"btn ghost square",onClick:this.openInNewTab,title:Ls("openInNewTab")},g("i",{class:"icon icon-panel"})),g("button",{type:"button",class:"btn ghost square",onClick:this.downloadSource,title:Ls("downloadSource")},g("i",{class:"icon icon-download"})))),g("div",{class:K("svg-box-preview canvas flex justify-center items-center",n?"hidden":"")},g("div",{dangerouslySetInnerHTML:{__html:s}})),n?g("div",{class:"svg-box-source border-t overflow-auto"},g(iv,{code:s,lang:"html"})):null)}};const wk=Object.freeze(Object.defineProperty({__proto__:null,HtmlSandbox:rv,SvgBox:ov},Symbol.toStringTag,{value:"Module"}));class Bl extends be{init(){const{html:e}=this.options;e===void 0&&(this.options.html=this.$element.text(),this.$element.empty())}}Bl.NAME="HtmlSandbox",Bl.Component=rv,Bl.register();class Hl extends be{init(){const{svg:e}=this.options;e===void 0&&(this.options.svg=this.$element.text(),this.$element.empty())}}Hl.NAME="SvgBox",Hl.Component=ov,Hl.register(),ot(wk);const uI="";let pu=class extends Ke{constructor(e){super(e),this._syncPickerData=()=>{const o=this.getFormData();v(this.element).find(".pick-value[name]").each((a,l)=>{const c=v(l),h=c.attr("name").split("[")[0],d=o[h];c.trigger("syncValue",{setValue:d})})},this._handleDeleteQueryClick=(o,a)=>{a.stopPropagation(),this.deleteQuery(o)},this._handleChange=o=>{const a=v(o.target);let l=a.attr("name");if(!l)return;l.endsWith("]")&&(l=l.split("[")[0]);let c=a.val();Array.isArray(c)&&(c=c.join(",")),this.changeData(l,c)},this._handleSubmit=o=>{o.preventDefault(),this.submit()};const{setting:t,preserve:s,module:n}=e;let r;s&&(r=`SearchForm:${typeof s=="string"?s:n}:more`,this._preserveKey=r),this.state={showQueryPanel:!1,setting:t&&t.conditions?t:void 0,more:r?st.get(r):void 0},this.submit=this.submit.bind(this),this.reset=this.reset.bind(this)}get showMore(){var e;return this.state.more??((e=this.state.setting)==null?void 0:e.more)}get isShow(){return this.state.show??this.props.show}get loaded(){return!!this.state.setting}get groupItemCount(){var e;return((e=this.state.setting)==null?void 0:e.groupItemCount)||3}componentDidMount(){this.props.show&&this.show(),v.on("update.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.load(t.reset??!0)}),v.on("addQuery.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.addQuery(t.id,t.text)})}componentDidUpdate(e,t){const{container:s}=this.props;if(s){const n=v(s),{show:r,more:o}=this.state,a=r!==t.show,l=o!==t.more;a&&n.toggleClass("show-search-form",r),(a||l)&&n.trigger("layout.SearchForm.zt",this),l&&this._preserveKey&&st.set(this._preserveKey,o)}}componentWillUnmount(){v.off(".SearchForm.zt")}async load(e){if(this.state.loading)return;await this.changeState({loading:!0,...e?{data:void 0}:null});const t=this.props.url||ut("search","buildForm",`module=${this.props.module}`);try{const s=await Ne(t);await this.changeState({setting:s,loading:!1,clickedReset:!1})}catch{await this.changeState({loading:!1,clickedReset:!1})}e&&this._syncPickerData()}async show(){await this.changeState({show:!0}),this.loaded||await this.load()}toggleQueryPanel(e){return e===void 0&&(e=!this.state.showQueryPanel),this.changeState({showQueryPanel:e})}toggle(e){return e===void 0&&(e=!this.isShow),e?this.show():this.hide()}toggleMore(e){return e===void 0&&(e=!this.showMore),this.changeState({more:e})}hide(){return this.changeState({show:!1})}getFormData(e){var n;e=e||this.state.setting;const t={groupAndOr:"or"},s=this.groupItemCount*2;for(let r=1;r<=s;r++)t[`field${r}`]=((n=this._conditionList[r-1])==null?void 0:n.value)??"",t[`operator${r}`]="=",t[`value${r}`]="",t[`andOr${r}`]="and";return{...t,...e.defaultData,...this.state.data}}getSubmitData(){const e=this._data;return{module:this.props.module,actionURL:this.state.setting.actionURL,groupItems:this.groupItemCount,formType:this.showMore?"more":"lite",...e}}submit(){var s;let e=this.getSubmitData();if(!e)return;const t=(s=this.props.beforeSearch)==null?void 0:s.call(this,e);t!==!1&&(t&&(e=t),ri({url:this.props.searchUrl||ut("search","buildQuery"),data:e,onSuccess:n=>{var r;return((r=this.props.onSearch)==null?void 0:r.call(this,n))===!1||this._handleSearch(v.extend({success:()=>this.load()},typeof n.load=="string"?{url:n.load}:n.load)),!1}}))}reset(){return this.changeState(e=>{const t=new Array(this.groupItemCount*2).fill(0).reduce((s,n,r)=>(s[`value${r+1}`]="",s),{});return{clickedReset:!0,data:{...e.data,...t}}},this._syncPickerData)}applyQuery(e){var n;const{actionURL:t}=this.state.setting,s=t.replace("myQueryID",String(e));((n=this.props.onSearch)==null?void 0:n.call(this,{result:"success",load:s}))!==!1&&this._handleSearch({url:s,success:()=>this.load(!0)})}deleteQuery(e,t){const{deleteQueryConfirm:s,canDeleteQuery:n}=this.state.setting;if(!t&&s){Ve.confirm(s).then(o=>{o&&this.deleteQuery(e,!0)});return}const r=typeof n=="string"?n.replace("{id}",`${e}`):ut("search","deleteQuery",`queryID=${e}`);ri({url:r,onSuccess:()=>{const o=this.state.setting,{savedQueryList:a=[]}=o;return this.changeState({setting:{...o,savedQueryList:a.filter(l=>l.id!==e)}}),!1}})}addQuery(e,t){const s=this.state.setting,{savedQueryList:n=[]}=s;n.some(r=>r.id===e)||this.changeState({showQueryPanel:!0,setting:{...s,savedQueryList:[{id:e,text:t},...n]}})}changeData(e,t){const s={[e]:t};if(e.startsWith("field")){const n=t,r=+e.substring(5),{defaultOperator:o,defaultValue:a=""}=this._conditionMap[n];o&&(s[`operator${r}`]=o),s[`value${r}`]=a}else if(e.startsWith("value")){const n=this.getFormData(),r=+e.substring(5),o=n[`field${r}`],{control:a}=this._conditionMap[o];if(a==="date"){const l=t.startsWith("$"),c=n[`operator${r}`];l&&c!=="between"?s[`operator${r}`]="between":!l&&c==="between"&&(s[`operator${r}`]="<=")}}this.changeState(n=>({data:{...n.data,...s}}),this._syncPickerData)}_handleSearch(e){const t=this.element.closest(".modal");let{searchLoader:s=t?{load:"modal",target:t}:"table"}=this.props;const n=v(this.element);let r=n.closest(".tab-pane");typeof s=="string"?(s={load:s},r.length||(r=n.closest("#main"))):t&&(r.length||(r=v(t)));const o=r.find("[data-zui-dtable]");return o.length&&!this.props.searchLoader&&(s.load="table",s.target=o.children(".dtable").attr("id")),typeof e=="string"?s.url=e:typeof e=="object"&&(s={...s,...e}),v.trigger("locate.zt",s),!1}_renderOperators(e,t){var n;const s=this._operatorList;return g(Gt,{name:e,items:s,required:!0,defaultValue:t??((n=s[0])==null?void 0:n.value),search:!1,maxItemsCount:0})}_renderControl(e,t,s,n){const r=this._conditionMap[e]||{},{control:o="text"}=r,{controlRenders:a}=this.constructor,l=a[o]||a.text;return o==="date"&&r.datePeriods===void 0&&n.datePeriods&&(r.datePeriods=n.datePeriods),l.call(this,r,t,s??"")}_renderField(e,t,s,n,r){var h;const{conditions:o}=n,a=t*s+e+1,l=!e;this._conditionList||(this._conditionList=o.map(({text:d,name:f})=>({text:d??f,value:f})));const c=r[`field${a}`]??((h=o[a])==null?void 0:h.name);return g("tr",{key:a,className:"search-form-field"},g("td",{className:K("is-andOr",l?"font-bold text-right nowrap":void 0)},l?(n.groupTitles||[])[t]:this._renderAndOrSelect(`andOr${a}`,r[`andOr${a}`],n)),g("td",{className:"is-condition"},g(Gt,{name:`field${a}`,items:this._conditionList,required:!0,defaultValue:c,popMinWidth:"100%",popWidth:"auto",maxItemsCount:0})),g("td",{className:"is-operator"},this._renderOperators(`operator${a}`,r[`operator${a}`])),g("td",{className:"is-control",key:`${c}:${a}`},this._renderControl(c,`value${a}`,r[`value${a}`],n)))}_renderGroup(e,t,s){const{groupItemCount:n}=this,{showMore:r}=this,o=[],a=r?n:1;for(let l=0;l<a;l++)o.push(this._renderField(l,e,n,t,s));return g("div",{className:"search-form-group flex-1",key:e},g("table",{className:"table-fixed w-full"},g("tbody",null,o)))}_renderAndOrSelect(e,t,s){const{andText:n="And",orText:r="Or"}=s;return g(Gt,{name:e,items:[{value:"and",text:n},{value:"or",text:r}],defaultValue:t,required:!0,search:!1})}_renderForm(e,t){this._conditionMap={},this._conditionList=e.conditions.map(d=>{const{name:f,text:m}=d;return this._conditionMap[f]=d,{text:m??f,value:f}});const{showMore:s}=this;this._operatorList=(e.operators||"=,!=,>,>=,<,<=".split(",")).map(d=>typeof d=="string"?{text:d,value:d}:d);const n=this.getFormData(e);this._data=n;const{searchBtnText:r="Search",resetBtnText:o="Reset",saveQueryBtnText:a="Save",canSaveQuery:l}=e,{simple:c,noMore:h}=t;return g("form",{key:"form",className:"search-form-wrapper flex-auto py-3 px-2",onSubmit:this._handleSubmit},g("div",{className:"row items-center",onChange:this._handleChange},this._renderGroup(0,e,n),g("div",{className:"col flex-none items-center justify-center px-4 w-24"},this._renderAndOrSelect("groupAndOr",n.groupAndOr,e)),this._renderGroup(1,e,n)),g("div",{className:`toolbar gap-4 justify-center flex-nowrap ${c?"ml-4":"mt-3"}`},g(we,{key:"submit",type:"primary",btnType:"submit"},r),c?null:g(we,{key:"reset",onClick:this.reset},o),c&&h?null:g("div",{className:c?"":"absolute top-0 right-0"},c?null:g(we,{key:"saveQuery",type:"ghost",className:"text-primary","data-toggle":"modal",disabled:!l||this.state.clickedReset,url:l?typeof l=="string"?l:ut("search","saveQuery",`module=${t.module}`):void 0,"data-title":a},a),h?null:g(we,{key:"toggle",type:"ghost",className:"text-primary",icon:s?"chevron-double-up":"chevron-double-down",onClick:this.toggleMore.bind(this,void 0)}))))}_renderQueryPanel(e,t){const{savedQueryList:s=[],saveQueryPanelWidth:n=200,saveQueryPanelTitle:r="Saved queries",canDeleteQuery:o}=t;return g("div",{key:"panel",className:K("search-form-query sidebar sidebar-right pt-3 transition-none",e?"is-expanded":"is-collapsed"),style:{minHeight:100,width:e?je(n):0,transition:"none"}},g("div",{class:"sidebar-gutter gutter gutter-border gutter-horz border-default",onClick:this.toggleQueryPanel.bind(this,void 0)},g("button",{class:"gutter-toggle",type:"button"},g("span",{class:"chevron-right"}))),e?g("div",{className:"search-form-query-panel pl-3 h-full col"},g("div",{className:"search-form-query-title font-bold mb-1.5 flex-none"},r),g("ul",{className:"search-form-query-list col items-start gap-1 overflow-auto scrollbar-hover pr-3 pb-2 pt-px pl-0"},s.map(({id:a,text:l,noDelete:c})=>g("li",{key:a,className:`search-form-query-item label gray-pale rounded-full state pl-2 hover:text-primary hover:primary-pale inline-flex gap-1 max-w-full ${o&&!c?"pr-0":"pr-2"}`,onClick:this.applyQuery.bind(this,a)},g("span",{className:"min-w-0 flex-auto overflow-hidden nowrap"},l),o&&!c?g(we,{type:"ghost",className:"size-xs rounded-full flex-none"},g("i",{className:"close",onClick:this._handleDeleteQueryClick.bind(this,a)})):null)))):null)}_getProps(e){return{...super._getProps(e),"data-module":e.module}}_getClassName(e){const t=super._getClassName(e);if(!this.isShow)return[t,"search-form","hidden"];const{setting:s,showQueryPanel:n}=this.state,{showMore:r}=this,o=s==null?void 0:s.savedQueryList;return[t,"search-form",s?"is-loaded":"is-empty",{"is-lite":!r,"is-more":r,"is-simple":e.simple,"show-save-query":o&&n}]}_getChildren(e){if(!this.isShow)return null;const{setting:t,showQueryPanel:s,loading:n}=this.state,r=!e.simple&&t&&t.savedQueryList;return g("div",{className:K(`search-form-container row gap-3 load-indicator${n?" loading":""}`,e.innerClass),style:`max-height: ${76+44*(this.showMore?this.groupItemCount:1)}px`},t?this._renderForm(t,e):null,r?this._renderQueryPanel(s,t):null)}};pu.controlRenders={text:(i,e,t)=>g("input",{className:"form-control",type:"text",name:e,value:t,placeholder:i.placeholder,...i.controlProps}),select:(i,e,t)=>{const{items:s=[]}=i;return g(Gt,{name:e,items:s,defaultValue:t,placeholder:i.placeholder,popMinWidth:"100%",popWidth:"auto",maxItemsCount:0,...i.controlProps})},date:(i,e,t)=>{const{datePeriods:s}=i,n={};return s&&(n.menu=[...s],n.allowInvalid=!0,n.display=r=>{const o=s.find(a=>a.value===r);return o?o.text:r}),g(Oi,{name:e,defaultValue:t,placeholder:i.placeholder,...n,...i.controlProps})},time:(i,e,t)=>g(Oa,{name:e,defaultValue:t,placeholder:i.placeholder,...i.controlProps}),datetime:(i,e,t)=>g(td,{name:e,defaultValue:t,placeholder:i.placeholder,...i.controlProps})},pu.defaultProps={preserve:!0};class is extends be{}is.NAME="SearchForm",is.Component=pu,is.replace=!0,is.toggleForm=mu,is.update=av,is.addQuery=lv,is.toggle={convertHref:!0,getOptions(i,e){const t=v(i);if(t.is("a")){const s=t.attr("href");s&&(!e.target&&"#.".includes(s[0])?e.target=s:e.url||(e.url=s))}return e},handler(i,e){mu({container:v(i).closest(e.container||".modal,#main"),...e})}},is.register();function mu(i){typeof i=="string"?i={module:i}:i||(i={module:window.config.currentModule});const e=v(i.container||".modal,#main").first();if(!e.length)return;i.module||(i.module=window.config.currentModule);let t;if(i.target?t=v(i.target,e):(t=e.find(`[${is.DATA_KEY}],.search-form`),i.module&&(t=t.filter(`[data-module="${i.module}"]`))),!t.length&&!i.target){let n=e.closest(".modal").find(".modal-body");n.length||(n=e.find(".main-content-cell")),n.length||(n=e.find("#mainContent")),t=v("<div/>").attr({"zui-key":"searchForm","data-module":i.module}).prependTo(n.length?n.first():e)}let s=t.zui(is.NAME);return s?s.$.toggle(i.show):s=new is(t,{container:e,show:!0,...i}),s}function av(i,e){v.trigger("update.SearchForm.zt",{module:i,reset:e})}function lv(i){v.trigger("addQuery.SearchForm.zt",i)}const fI="";class oo extends ss{constructor(){super(...arguments),this._menuRef=ye(),this._handClickItem=e=>{var t,s;(s=(t=this.options).onSelect)==null||s.call(t,e.item)},this._handlePanelInited=()=>{var e;this.layout(),(e=this.menu)==null||e.activeFirst()}}get triggerRect(){return this._triggerRect}get menu(){return this._menuRef.current}_getMenuOptions(){var e;return{...super._getMenuOptions(),items:(e=this._suggestions)==null?void 0:e.map(t=>({...t,key:t.value})),ref:this._menuRef,onClickItem:this._handClickItem}}init(){super.init();const{suggestions:e,triggerRect:t}=this.options;this._triggerRect=t,this._suggestions=e}getTriggerElement(){if(!this._triggerElement){let e=this.options.element;e||(e={getBoundingClientRect:()=>this._triggerRect||new DOMRect}),this._triggerElement=e,this._virtual=!(e instanceof HTMLElement)}return this._triggerElement}update({rect:e,suggestions:t}){var s;t&&(v(this.target).toggleClass(this.options.animation?"fade":"hidden",!t.length),this._suggestions=t,this.render()),e&&((s=this._suggestions)!=null&&s.length)&&(this._triggerRect=e,this.shown||this.show(),this.updatePosition())}handleKeyDown(e){var s,n;if(e.key==="Escape")return this.hide(),!0;const{menu:t}=this;if(t){if(e.key==="ArrowUp")return t.activePrev(),!0;if(e.key==="ArrowDown")return t.activeNext(),!0;if(e.key==="Enter"){const r=t.getActiveKey(),o=t.getItem(r);return o&&((n=(s=this.options).onSelect)==null||n.call(s,o)),!0}}return!1}}oo.NAME="SuggestionMenu",oo.DEFAULT={...ss.DEFAULT,name:"suggestion-menu",trigger:"manual",show:!0,animation:!1},oo.register();const pI="",mI="",ao=new na("tiptap",{src:["teditor/tiptap.js"],check:"tiptap"}),cv=new Map;function hv(i,e){const t=typeof e=="object"?{name:i,...e}:e;cv.set(i,t)}function Ck(i){return cv.get(i)}function Ul(i,e){const{Extension:t}=ao.Module,s=Ck(i);if(!s)throw new Error(`Extension ${i} not found`);let n=t.create(s);return e&&(n=n.configure(e)),n}const gu=class Nf extends Ze{constructor(){super(...arguments),this._handTransaction=e=>{var n,r,o,a;(r=(n=this.options.tiptap)==null?void 0:n.onTransaction)==null||r.call(n,e);const t=this.getContent(),s=typeof t=="string"?t:JSON.stringify(t);s!==this._lastContent&&(this._lastContent=s,(a=(o=this.options).onChange)==null||a.call(o,s,this._lastContent)),this.$element.trigger("change",{value:s,content:t,transaction:e})},this._handleFocus=e=>{var t,s;(s=(t=this.options.tiptap)==null?void 0:t.onFocus)==null||s.call(t,e),this.$element.addClass("focus").trigger("focus",e)},this._handleBlur=e=>{var t,s;(s=(t=this.options.tiptap)==null?void 0:t.onBlur)==null||s.call(t,e),this.$element.removeClass("focus").trigger("blur",e)}}get value(){return this._lastContent}init(){const{mode:e,contentType:t}=this.options;t||(this.options.contentType=e==="plain"?"text":"html");let{content:s}=this.options;s===void 0&&(s=t==="text"?this.$element.text():this.$element.html(),this.$element.empty(),this.options.content=s),this._lastContent=typeof s=="string"?s:JSON.stringify(s)}async afterInit(){await Nf.loadModule(),this.$element.addClass("teditor form-control"),this.render()}render(e){super.render(e);const{Editor:t}=Nf.Module;if(this._editor){const s=this.options.content;s&&this._editor.commands.setContent(s)}else this._editor=new t(this._getEditorOptions())}getText(e){var t;return(t=this._editor)==null?void 0:t.getText(e)}getHtml(){var e;return(e=this._editor)==null?void 0:e.getHTML()}getData(){var e;return(e=this._editor)==null?void 0:e.getJSON()}getContent(e){return e=e||this.options.contentType,e==="text"?this.getText():e==="html"?this.getHtml():this.getData()}setContent(e){var t;(t=this._editor)==null||t.commands.setContent(e)}_getEditorOptions(){const{element:e,options:t}=this,{content:s="",editorProps:n,readonly:r,tiptap:o}=t;return{element:e,content:s,editorProps:n,extensions:this._getEditorExtensions(),editable:!r,...o,onFocus:this._handleFocus,onBlur:this._handleBlur,onTransaction:this._handTransaction}}_getEditorExtensions(){const{extensions:e,suggestions:t,suggestionsOptions:s,mode:n}=this.options,r=[];return n==="plain"&&r.push(Ul("plainText")),t&&r.push(Ul("suggestions",{suggestions:t,...s})),e&&e.forEach(o=>{typeof o=="string"?r.push(Ul(o)):Array.isArray(o)?r.push(Ul(o[0],o[1])):r.push(o)}),r}static get Module(){return ao.Module}static loadModule(){return ao.load()}};gu.NAME="TEditor",gu.DEFAULT={mode:"plain"};let dv=gu;dv.register(),hv("plainText",{addExtensions(){const{Node:i}=ao.Module,e=i.create({name:"doc",topNode:!0,content:"paragraph+"}),t=i.create({name:"paragraph",group:"block",content:"(text | mention)*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",n,0]}}),s=i.create({name:"text",group:"inline",inline:!0});return[e,t,s]}});function xk(i,e,t){const s={char:i};return typeof e=="function"?s.items=n=>e(n.query):Array.isArray(e)?(t=t||((n,r)=>dt.isItemMatch(n,[r])),s.items=n=>e.filter(r=>t(r,n.query))):Object.assign(s,e),s.render=s.render||(()=>{let n;return{onStart:({items:r,clientRect:o,command:a})=>{n=oo.create({suggestions:r,triggerRect:o==null?void 0:o(),onSelect:l=>{a==null||a({id:l.key??l.value,label:l.value??l.text})}})},onUpdate:({clientRect:r,items:o})=>{!n||!r||n.update({rect:r(),suggestions:o})},onKeyDown:({event:r})=>n?n.handleKeyDown(r):!0,onExit:()=>{n==null||n.destroy(),n=void 0}}}),s}hv("suggestions",()=>({name:"suggestions",addOptions(){return{suggestions:{}}},addExtensions(){const{extensions:i}=ao.Module,{suggestions:e,isItemMatch:t,...s}=this.options,n=Object.entries(e).map(([r,o])=>xk(r,o,t));return[i.Mention.configure({HTMLAttributes:{class:"mention-label"},...s,...n.length===1?{suggestion:n[0]}:{suggestions:n}})]}}));const gI="";class Vl extends be{}Vl.NAME="UserAvatar",Vl.Component=qi,Vl.register();class yu extends be{}yu.NAME="ZenEditor",yu.Component=Ry;const yI="",kk={1:"error",2:"warning",4:"parse",8:"notice",16:"core-error",32:"core-warning",64:"compile-error",128:"compile-warning",256:"user-error",512:"user-warning",1024:"user-notice",2048:"strict",4096:"recoverable-error",8192:"deprecated",16384:"user-deprecated",32767:"all"};function vu(i){return typeof i=="number"&&(i=kk[i]),i}function uv(i){return i=vu(i),i.includes("error")?"error":i.includes("warning")?"warning":"info"}function Sk({errors:i,...e}){const t=i.reduce((s,n)=>(s[uv(n.level)]++,s),{error:0,warning:0,info:0});return g("div",{class:"row items-stretch text-sm","data-hint":"PHP errors",...e},t.error?g("button",{type:"button",class:"state font-bold px-0.5 danger"},g("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"ERR"),t.error):null,t.warning?g("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-90"},g("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"WAR"),t.warning):null,t.info?g("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-80"},g("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"INF"),t.info):null)}function Yt(i,e,t,s){console.groupCollapsed(`%c${i} %c${e}`,"color: #fff; background-color: #9333ea; padding: 0 0.1em 0 0.25em; border-radius: 0.25em 0 0 0.25em;","color: #9333ea; background-color: #e9d5ff; padding: 0 0.5em; border-radius: 0 0.25em 0.25em 0;",s),console.table(t),console.groupEnd()}function kn(i,e=400,t=100){return i<t?"success":i<e?"warning":"danger"}function bs(i){return i<1e3?`${i.toFixed(0)}ms`:`${(i/1e3).toFixed(2)}s`}function fv({perf:i,guardState:e,guardData:t}){var l;const s=i.id==="page"?"页面":i.id==="#dtable"?"表格":"部分",n=[],{trace:r,xhprof:o}=i,a=r==null?void 0:r.request;if(e){const c=e==="sending"?"发送中":e==="error"?"发送失败，点击查看":"已发送",h=e==="sending"?"text-warning":e==="error"?"text-danger":"text-success",d=t?`${t.request.module}-${t.request.method}#${t.requestId}`:"",f=Yt.bind(null,"Perf Guard Data",e===!0?"sended":e||"null",t,t==null?void 0:t.requestId);n.push(g("div",{onClick:f,class:`px-0.5 state ${h}`,"data-hint":`性能门禁数据${t?`（${d}）`:""}：${c}`},g("i",{class:e==="sending"?"icon icon-spinner-indicator spin":e===!0?"icon-shield-check":"icon-shield"})),g("div",{class:"muted"},"/"))}if(i.requestEnd){i.clientCache&&n.push(g("div",{class:"px-0.5 state text-success","data-hint":`使用本地缓存渲染：${i.clientCache}`},g("i",{class:"icon-check-circle"})),g("div",{class:"muted"},"/"));const c=i.requestEnd-i.requestBegin;if(n.push(g("div",{class:`px-0.5 state text-${kn(c,500,300)}`,"data-hint":"总加载时间 (好<300ms≤正常<500ms≤差)",onClick:Yt.bind(null,"Trace","Perf",i,i.id)},g("i",{class:"icon-history"})," ",bs(c))),a){const d=a.timeUsed;n.push(g("div",{class:"muted"},"/"),g("div",{class:`px-0.5 state text-${kn(d)}`,"data-hint":"服务器耗时 (好<300≤正常<500≤差)",onClick:Yt.bind(null,"Trace","Request",a,i.id)},g("span",{class:"scale-95 font-bold inline-block"},"S"),bs(d)))}if(i.dataSize){if(a){const d=c-a.timeUsed;n.push(g("div",{class:"muted"},"/"),g("div",{class:`px-0.5 state text-${kn(d,600,200)}`,"data-hint":"网络用时 (好<200≤正常<600≤差)",onClick:Yt.bind(null,"Trace","Request",a,i.id)},g("span",{class:"scale-95 font-bold inline-block"},"N"),bs(d)))}if(n.push(g("div",{class:"px-0.5 state","data-hint":"下载大小",onClick:Yt.bind(null,"Trace","Perf",i,i.id)},g("span",{class:"muted"},g("i",{class:"icon icon-cube"})," ",pt(i.dataSize,1)))),a){const d=c-a.timeUsed,f=1e3*i.dataSize/d;n.push(g("div",{class:"muted"},"/"),g("div",{class:`px-0.5 state text-${f<102400?"danger":f<1024e3?"warning":"success"}`,"data-hint":"下载速度(B<100KB≤正常<1MB≤G)",onClick:Yt.bind(null,"Trace","Request",a,i.id)},g("i",{class:"icon icon-arrow-down"}),pt(f,1),"/s"))}}if(i.renderEnd&&i.renderBegin){const d=i.renderEnd-i.renderBegin,f=kn(d,200,50);n.push(g("div",{class:"muted"},"/"),g("div",{class:`px-0.5 state text-${f}`,"data-hint":"浏览器渲染用时 (好<50≤正常<200≤差)",onClick:Yt.bind(null,"Trace","Perf",i,i.id)},g("i",{class:`icon-${f==="danger"?"frown":f==="warning"?"meh":"smile"}`}),bs(d)))}if(a){const{memory:d,querys:f}=a;typeof d=="number"&&n.push(g("div",{class:"muted"},"/"),g("div",{class:`px-0.5 state text-${kn(d*1024,1024e3,102400)}`,"data-hint":"服务器内存占用 (好<10KB≤正常<100KB≤差)",onClick:Yt.bind(null,"Trace","Request",a,i.id)},g("span",{class:"scale-95 font-bold inline-block"},"M"),pt(d*1024))),typeof f=="number"&&n.push(g("div",{class:"muted"},"/"),g("div",{class:`px-0.5 state text-${kn(f,100,60)}`,"data-hint":"SQL执行次数 (好<60≤正常<100≤差)",onClick:Yt.bind(null,"SQL Query",`${((l=r.sqlQuery)==null?void 0:l.length)??0} queries`,r.sqlQuery,i.id)},g("span",{class:"scale-95 font-bold inline-block"},"Q"),f))}r!=null&&r.files&&n.push(g("div",{class:"muted"},"/"),g("div",{class:"px-0.5 state","data-hint":"服务器加载PHP文件数目",onClick:Yt.bind(null,"Trace",`${r.files.length} php files`,r.files,i.id)},g("span",{class:"muted"},g("i",{class:"icon-file icon-sm scale-75"}),r.files.length)));const h=r==null?void 0:r.profiles;if(h!=null&&h.length){let d=0,f={Duration:0};if(h.forEach(m=>{m.Duration>.3&&d++,m.Duration>f.Duration&&(f=m)}),n.push(g("div",{class:`px-0.5 state text-${kn(d,3,1)}`,"data-hint":"服务器最慢SQL数 (好<1≤正常<3≤差)",onClick:Yt.bind(null,"SQL Query",`${h.length} SQL profiles`,h,i.id)},g("span",{class:"scale-95 font-bold inline-block"},"LQ"),d)),f.Duration){const m=f.Duration*1e3;n.push(g("div",{class:`px-0.5 state text-${kn(m,600,300)}`,"data-hint":"服务器最慢SQL耗时 (好<300≤正常<600≤差)",onClick:Yt.bind(null,"SQL Query",`Slowest SQL query: ${m}ms`,f,i.id)},g("span",{class:"scale-95 font-bold inline-block"},"MLQ"),bs(m)))}}}else n.push(g("div",{class:"muted px-0.5"},"loading..."));return g("div",{class:"zin-perf-btn-list row items-center bg-black text-sm"},g("div",{class:"px-1 bg-canvas bg-opacity-20 self-stretch flex items-center","data-hint":`请求 ${i.id} URL: ${i.url}`},g("span",{class:"muted"},s)),n,o?g("a",{class:"state text-secondary px-0.5",href:o,target:"_blank","data-hint":"打开 xhprof 报告"},"XHP"):null)}function Tk(i,e,t){var s,n;if(t.target.closest(".ask-ai")){(n=(s=window.zui)==null?void 0:s.AIPanel)==null||n.shared.openPopup({viewType:"chat",postMessage:[`/phpExpert PHP error message: ${i.message}`,`File: ${i.file}`,`Line: ${i.line}`,`Level: ${vu(i.level)} ${i.level}`,`Trace:

\`\`\`
${i.trace}
\`\`\``,e!=null&&e.url?`Request: ${e.method||"GET"} ${e.url}`:"",e!=null&&e.php?`PHP Version: ${e.php}`:""].filter(Boolean).join(`
`),props:{mode:"full"}});return}Yt("Trace","Error",i,i.message),navigator.clipboard.writeText(`vim +${i.line} ${i.file}`)}function $k({errors:i=[],show:e,basePath:t,request:s}){var o,a;i.length||(e=!1);const n=(a=(o=window.zui)==null?void 0:o.AIPanel)==null?void 0:a.shared,r=i.map(l=>{const c=vu(l.level),h=uv(c),d=h==="error"?"danger":h==="info"?"important":"warning";return g("div",{class:`zin-error-item state ${d}-pale text-fore px-2 py-1 ring ring-darker`,onClick:Tk.bind(null,l,s)},g("div",{class:"zin-error-msg font-bold text-base"},g("strong",{class:`text-${d}`,style:"text-transform: uppercase;"},c)," ",l.message),g("div",{class:"zin-error-info text-sm break-all mt-0.5"},n?g("button",{type:"button",class:"btn ai-styled size-xs mr-2 ask-ai"},"Ask AI"):null,g("strong",{className:"opacity-60"},"vim +",l.line)," ",g("span",{className:"underline opacity-70"},t?l.file.substring(t.length):l.file)))});return g("div",{class:`zin-errors-panel canvas absolute bottom-full left-0 mono shadow-xl ring rounded fade-from-bottom ${e?"in":"events-none"}`},r)}const vI="";function Dk(){const i=navigator.userAgent;let e="Unknown",t="Unknown";return i.indexOf("Chrome")>-1?(e="Chrome",t=i.substring(i.indexOf("Chrome")+7)):i.indexOf("Firefox")>-1?(e="Firefox",t=i.substring(i.indexOf("Firefox")+8)):i.indexOf("Safari")>-1?(e="Safari",t=i.substring(i.indexOf("Safari")+7),i.indexOf("Version")>-1&&(t=i.substring(i.indexOf("Version")+8))):window.StyleMedia&&(e="Edge",t=i.substring(i.indexOf("Edge")+5)),t=t.split(" ")[0],t=t.split(";")[0],t=t.split(")")[0],{name:e,version:t}}let Ik=class extends ae{constructor(e){var t,s;super(e),this._timer=0,this._browser=Dk(),this._guardData={},this.state={showPanel:e.defaultShow??!0,showZinbar:!!((s=(t=e.defaultData)==null?void 0:t.errors)!=null&&s.length||!st.get("Zinbar:hidden")),...e.defaultData},this.togglePanel=this.togglePanel.bind(this),this.sendGuardData=this.sendGuardData.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this)}componentDidMount(){document.addEventListener("click",this.handleClickOutside)}componentDidUpdate(){var o,a,l,c;const{pagePerf:e}=this.state;let t="",s="";const n=(a=(o=e==null?void 0:e.trace)==null?void 0:o.sqlQuery)==null?void 0:a.length,r=(c=(l=e==null?void 0:e.trace)==null?void 0:l.request)==null?void 0:c.timeUsed;if(r&&e.renderEnd){const h=e.renderEnd-e.renderBegin,d=r+h,f=[];let m="",y="";d>=500?(m="danger",f.push(`处理时间${bs(d)}超过500ms（后端${bs(r)}，前端${bs(h)}）`)):d>=300&&(m="warning",f.push(`处理时间${bs(d)}超过300ms（后端${bs(r)}，前端${bs(h)}）`)),n&&(n>=60?(y="danger",f.push(`SQL查询超过60次（实际${n}）`)):n>=40&&(y="warning",f.push(`SQL查询超过40次（实际${n}）`))),(m||y)&&(t=m==="danger"||y==="danger"?"danger":"warning",s=[t==="danger"?"页面有性能问题":"页面有优化空间",...f].join("，"))}v("body").z({perf:t,perfMessage:s})}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}handleClickOutside(e){const t=e.target;this.state.showPanel&&!t.closest(".zinbar")&&this.setState({showPanel:!1})}async sendGuardData(e=180){var m,y,b;const{guardApi:t}=this.props;if(!t)return;this._timer&&clearTimeout(this._timer);const{pagePerf:s}=this.state;if(!(s!=null&&s.renderEnd))return;if(e){this._timer=window.setTimeout(()=>{this.sendGuardData(0)},e);return}const n=Ug(s.url);if(!(n!=null&&n.moduleName))return;this.setState({guardState:"sending"});const{author:r="anonymous",email:o,host:a=location.origin}=this.props,{profiles:l=[],sqlQuery:c=[],request:h}=s.trace||{};l.forEach(w=>{w.DurationOriginal||(w.DurationOriginal=w.Duration,w.Duration=1e3*w.Duration)});const d=c.findIndex(w=>w.includes("SET profiling = ")),f=d>=0?c.length-d-1:c.length;this._guardData={timestamp:Date.now(),identifier:r,email:o,requestId:Ft(),dataVer:3,request:{host:a,url:/https?:/.test(s.url)?s.url:`${a}${s.url}`,module:n.moduleName,method:n.methodName,xhprof:s.xhprof?/https?:/.test(s.xhprof)?s.xhprof:`${a}${s.xhprof}`:null,php:h==null?void 0:h.php,errorCount:((m=this.state.errors)==null?void 0:m.length)||0,errors:this.state.errors??[]},userEnv:{system:navigator.userAgentData?navigator.userAgentData.platform:navigator.platform,userAgent:navigator.userAgent,browser:[this._browser.name,this._browser.version].join(" ")},metrics:{frontend:{renderTime:Math.round(s.renderEnd-s.renderBegin),downloadSize:s.dataSize},backend:{totalTime:h==null?void 0:h.timeUsed,sqlTime:l.reduce((w,x)=>w+x.Duration,0),sqlCount:Math.max(l.length||0,f),sqlDetails:l,phpFileLoaded:((y=s.trace)==null?void 0:y.files.length)||0,phpFiles:(b=s.trace)==null?void 0:b.files,requestMemory:h==null?void 0:h.memory}}};try{const w=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._guardData),mode:"no-cors"});this._guardData.$response=await w.text(),this.setState({guardState:!0})}catch(w){this._guardData.$error=w,console.error("[ZUI] Send guard data failed:",w,this),this.setState({guardState:"error"})}}update(e,t,s){this.setState(n=>{const r=!(e!=null&&e.id)||e.id==="page",o={};return r?(e&&(o.pagePerf={...n.pagePerf,...e}),t&&(o.errors=t),e!=null&&e.requestEnd||(o.guardState=!1)):(e&&(o.partPerf={...n.partPerf,...e}),t&&(o.errors=[...n.errors??[],...t??[]])),s&&(o.basePath=s),o},this.props.guardApi?this.sendGuardData:void 0)}togglePanel(){this.setState({showPanel:!this.state.showPanel})}toggleZinbar(){const e=!this.state.showZinbar;this.setState({showZinbar:e},()=>{st.set("Zinbar:hidden",!e)})}render(){var c;const{errors:e,pagePerf:t,partPerf:s,showZinbar:n,basePath:r,guardState:o}=this.state,{fixed:a}=this.props,l=e==null?void 0:e.length;return g("div",{className:K("zinbar row h-5 items-stretch gap-px inverse bg-opacity-50",a?"relative":"fixed right-0 bottom-0",{collapse:!n}),style:{zIndex:9999}},g("button",{type:"button","data-hint":n?"折叠":"展开",className:`w-4 ${l&&!n?"danger":"bg-inverse"} flex items-center justify-center`,style:{marginLeft:-15},onClick:this.toggleZinbar.bind(this)},g("span",{class:n?"caret-right":"caret-left"})),l?g(Sk,{errors:e,onClick:this.togglePanel}):null,t?g(fv,{perf:t,guardState:o,guardData:this._guardData}):null,s?g(fv,{perf:s}):null,g("div",{class:"zin-perf-btn-list row items-center bg-black text-sm"},g("div",{"data-hint":`ZUI ${kc} (${rt(1768967850625)})`},g("a",{href:"#!~showZuiInfo",class:"font-mono primary font-bold italic p-0.5 text-sm"},"ZUI"))),g($k,{show:this.state.showPanel,basePath:r,errors:e,request:(c=t==null?void 0:t.trace)==null?void 0:c.request}))}};class _u extends be{}_u.NAME="Zinbar",_u.Component=Ik;function pv(){const i=[`ZUI: ${kc} (${rt(1768967850625)}, ${Af.substring(0,8)})`],e=v("#zuiJS").attr("src");e&&i.push(`Src: ${e}`);const t=window.BlockSuite;t&&i.push(`BlockSuite ${t.zui.VERSION} (${rt(t.zui.BUILD)})`),Ve.alert({title:"ZUI Versions",message:i.join(`
`),custom:{contentClass:"zui-info primary",bodyClass:"font-mono"},actions:[navigator.clipboard?{text:"Copy",btnType:"light-outline",icon:"copy",onClick:()=>{navigator.clipboard.writeText(i.join(`
`))}}:null,{key:"close",text:"Close",btnType:"primary",className:"light-outline"}]})}Fp("showZuiInfo",pv);let mv=class extends Ke{_renderContent(e){const{subtitle:t,subtitleClass:s,content:n,contentClass:r}=e;if(!(!t&&!n))return[k("div",{className:K("card-content",r),children:[t?k("div",{className:K("card-subtitle",s),children:k(fe,{content:t})},"subtitle"):null,n?k(fe,{content:n},"extraContent"):null]},"content")]}_renderHeading(e){const{icon:t,prefix:s,prefixClass:n,title:r,titleClass:o,titleUrl:a,titleAttrs:l,suffix:c,suffixClass:h,heading:d,headingClass:f}=e;if(!t&&!s&&!r&&!c&&!d)return;const m=a?"a":"span";return k("div",{className:K("card-heading",f),children:[t?k(Ie,{className:"card-icon",icon:t},"icon"):null,s?k(fe,{className:K("card-prefix",n),content:s},"prefix"):null,r?k(m,{className:K("card-title",o),href:a,...l,children:k(fe,{content:r})},"title"):null,c?k(fe,{className:K("card-suffix",h),content:c},"suffix"):null,d?k(fe,{content:d},"extraHeading"):null]})}_renderHeader(e){const{header:t,headerClass:s}=e;if(t)return k("div",{className:K("card-header",s),children:k(fe,{content:t},"header")})}_renderFooter(e){const{footer:t,footerClass:s,footActions:n}=e;if(t||n)return k("div",{className:K("card-footer",s),children:[k(fe,{content:t},"footer"),Be.render(n,[e],{key:"foot-actions",relativeTarget:e,className:"card-foot-actions",size:"sm"},this)]})}_renderActions(e){return Be.render(e.actions,[e],{key:"actions",relativeTarget:e,className:"card-actions",size:"sm"},this)}_renderList(e){const{items:t}=e;if(!t)return;const s=Le({key:"list",className:"card-list"},typeof t=="object"?t:{items:t});return k(Dt,{...s})}_renderAvatar(e){const{avatar:t}=e;if(t){const s=typeof t=="function"?t.call(this,e):t;if(s)return s.className=K("item-avatar",s.className),k(Gs,{...s},"avatar")}}_getClassName(e){return["card",e.className,e.selected?"selected":""]}_getChildren(e){return[this._renderActions(e),this._renderHeader(e),this._renderAvatar(e),this._renderHeading(e),this._renderContent(e),this._renderList(e),this._renderFooter(e),e.children]}};class gv extends mv{_getClassName(e){return e.className}_getChildren(e){const{innerAttrs:t,innerClass:s,selected:n,innerComponent:r="div"}=e,o=Le({className:K("card",s,n?"selected":"")},t);return k(r,{...o,children:super._getChildren(e)})}}let Ji=class extends Dt{_getClassName(e){return[super._getClassName(e),e.countPerRow?"card-grid":""]}_getProps(e){const{gap:t,countPerRow:s}=e;return Le({style:{"--list-gap":t?je(t):void 0,"--list-count-per-row":s}},super._getProps(e))}_getRenderedItem(e,t){return t}};Ji.NAME="card-list",Ji.TAG="div",Ji.ItemComponents={...Dt.ItemComponents,default:gv,item:gv},Ji.defaultItemProps={component:"div"};class Wl extends be{}Wl.NAME="Card",Wl.Component=mv,Wl.replace=!0;class bu extends be{}bu.NAME="CardList",bu.Component=Ji;const _I="",bI="";class Xi extends ss{_getLayoutOptions(){const e=super._getLayoutOptions();return this.options.element||(e[0]={getBoundingClientRect:this._getClickBounding}),e}}Xi.NAME="ContextMenu",Xi.DEFAULT={...ss.DEFAULT,name:"contextmenu",trigger:"contextmenu"},Xi.register();const wI="",CI="";function Mk(i){const{left:e,className:t,top:s,id:n,onMenuBtnClick:r,title:o,width:a,height:l,content:c,loading:h,draggable:d=!0}=i;return k("div",{class:"dashboard-block-cell",style:{left:e,top:s,width:a,height:l},children:k("div",{className:K("dashboard-block load-indicator",h&&!c?"loading":"",r?"has-more-menu":"",t),draggable:d,"data-id":n,children:[k("div",{class:"dashboard-block-header",children:[k("div",{class:"dashboard-block-title",children:o}),r?k("div",{class:"dashboard-block-actions toolbar",children:k("button",{class:"toolbar-item dashboard-block-action btn square ghost rounded size-sm","data-type":"more",onClick:r,children:k("div",{class:"more-vert"})})}):null]}),v.isPlainObject(c)&&c.html?k(Ds,{className:"dashboard-block-body",executeScript:!0,...c}):k("div",{class:"dashboard-block-body",children:c})]})})}const xI="",kI="",wu=([i,e,t,s],[n,r,o,a])=>!(i+t<=n||n+o<=i||e+s<=r||r+a<=e),yv=(i,e)=>i[1]===e[1]?i[0]-e[0]:i[1]-e[1],Kl="Dashboard:Block.cache:";let vv=class extends ae{constructor(e){super(e),this._ref=ye(),this._loadTimer=0,this._map=new Map,this._oldMap=new Map,this.tryLoadNext=()=>{clearTimeout(this._loadTimer),this._loadTimer=window.setTimeout(()=>this.loadNext(),50)},this._checkLayout=()=>{const{onLayoutChange:t}=this.props;if(!t)return;const{blocks:s}=this.state,n={};let r=!1;s.forEach(o=>{const[a,l,c,h]=this._map.get(o.id),d=this._oldMap.get(o.id);(!d||d[0]!==a||d[1]!==l||d[2]!==c||d[3]!==h)&&(r=!0,n[o.id]={left:a,top:l,width:c,height:h},this._oldMap.set(o.id,[a,l,c,h]))}),r&&t(n)},this._handleMenuClick=t=>{const s=t.target.closest(".dashboard-block");if(!s)return;const n=s.dataset.id;if(!n)return;const r=this.getBlock(n);if(!r||!r.menu)return;const{menu:o}=r,{onClickMenu:a}=this.props;Xi.show({triggerEvent:t,element:t.currentTarget,placement:"bottom-end",menu:{onClickItem:l=>{var c;((c=l.item.data)==null?void 0:c.type)==="refresh"&&this.load(n),a&&a.call(this,l,r)},...o}})},this.state={blocks:this._initBlocks(e.blocks)}}getBlock(e){return this.state.blocks.find(t=>t.id===e)}update(e,t){const{id:s}=e,{blocks:n}=this.state,r=n.findIndex(a=>a.id===s);if(r<0)return;const o=n[r];e.fetch&&e.fetch!==o.fetch&&e.needLoad===void 0&&(e.needLoad=!0),n[r]={...o,...e},this.setState({blocks:n},t)}delete(e){const{blocks:t}=this.state,s=t.findIndex(n=>n.id===e);s<0||(t.splice(s,1),this.setState({blocks:t}))}add(e){e=Array.isArray(e)?e:[e],this.setState({blocks:[...this.state.blocks,...this._initBlocks(e)]})}load(e,t){const s=this.getBlock(e);!s||s.loading||(t=t||s.fetch,t&&this.update({id:e,loading:!0,needLoad:!1},async()=>{try{const n=await v.fetch(t,[e,s],({url:r})=>({url:$e(r,s),dataType:"html"}));this.update({id:e,loading:!1,content:{html:n}},()=>{var r;this._setCache(e,n),(r=this.props.onLoad)==null||r.call(this,s)})}catch(n){const r=k("div",{class:"panel center text-danger p-5",children:["Error:",n.message]});this.update({id:e,loading:!1,content:r},()=>{var o;(o=this.props.onLoadFail)==null||o.call(this,n,s)})}}))}reset(e){this.setState({blocks:this._initBlocks(e)})}loadNext(){const{blocks:e}=this.state;let t="";for(const s of e){if(s.loading)return;if(!s.visible&&this._isVisible(s.id))return this.update({id:s.id,visible:!0});if(s.needLoad&&s.visible){t=s.id;break}}t.length&&requestAnimationFrame(()=>this.load(t))}_isVisible(e){return!this.props.onlyLoadVisible||!!v(this._ref.current).find(`.dashboard-block[data-id="${e}"]`).isVisible()}_setCache(e,t){const{cache:s}=this.props;if(s)try{typeof s=="string"?st.set(`${Kl}${s}:${e}`,t):st.session.set(`${Kl}${e}`,t)}catch(n){console.warn("ZUI: Failed to cache block content.",{id:e,html:t,error:n})}}_getCache(e){const{cache:t}=this.props;if(!t)return;const s=typeof t=="string"?st.get(`${Kl}${t}:${e}`):st.session.get(`${Kl}${e}`);if(s)return{html:s}}_initBlocks(e){const{blockFetch:t,blockMenu:s,grid:n}=this.props;return e.map(o=>{const{id:a,size:l,width:c,height:h,left:d=-1,top:f=-1,fetch:m=t,menu:y=s,content:b,...w}=o,[x,D]=this._getBlockSize(c&&h?{width:c,height:h}:l);return{id:`${a}`,width:x,height:D,left:Math.min(d,n-x),top:f,fetch:m,menu:y,content:b??this._getCache(`${a}`),loading:!1,needLoad:!!m,...w}})}_getBlockSize(e){const{blockDefaultSize:t,blockSizeMap:s}=this.props;return e=e??t,typeof e=="string"&&(e=s[e]),e=e||t,Array.isArray(e)||(e=[e.width,e.height]),e}_layout(){const{blocks:e,dragging:t,dropping:s}=this.state,n=this._map;if(n.size){const a=[0,0,0,0];e.sort((l,c)=>yv(n.get(l.id)||a,n.get(c.id)||a))}n.clear(),t&&s&&n.set(t,s),e.forEach(a=>{a.id!==t&&this._layoutBlock(a)});const r=Array.from(n.entries());r.sort((a,l)=>yv(a[1],l[1]));let o=0;return r.forEach(([a,l])=>{let c=l[1]-1;for(;c>=0&&this._canMove([l[0],c,l[2],l[3]],a);)c--;c++,l[1]=c,o=Math.max(o,c+l[3])}),s&&(o=Math.max(o,s[1]+s[3])),{blocks:e,height:o}}_initDraggable(){const e=this._ref.current;this._draggable=new Lr(e,{selector:".dashboard-block",target:()=>e,beforeDrag:(t,s)=>{const n=s.getBoundingClientRect();if(t.clientY-n.top>48)return t.preventDefault(),!1;this._dragOffset=[t.clientX-n.left,t.clientY-n.top]},onDragStart:(t,s)=>{const n=s.dataset.id;n!==void 0&&(this._dragging=this._map.get(n),this.setState({dragging:n}))},onDragOver:t=>{const{cellHeight:s,grid:n}=this.props,r=e.getBoundingClientRect(),[,,o,a]=this._dragging,[l,c]=this._dragOffset,h=Math.min(n-o,Math.max(0,Math.round((t.clientX-r.left-l)/(r.width/n)))),d=Math.max(0,Math.round((t.clientY-r.top-c)/s)),f=this.state.dropping;f&&f[0]===h&&f[1]===d||this.setState({dropping:[h,d,o,a]})},onDragEnd:()=>{const{dragging:t,dropping:s}=this.state,n={dragging:void 0,dropping:void 0},r={};if(t&&s){const{blocks:o}=this.state;o.forEach((a,l)=>{const[c,h]=t===a.id?s:this._map.get(a.id);(a.left!==c||a.top!==h)&&(o[l]={...a,left:c,top:h},r[a.id]={left:c,top:h})}),n.blocks=o}this.setState(n,this._checkLayout),this._dragging=void 0,this._dragOffset=void 0}})}_layoutBlock(e){const{id:t,left:s,top:n,width:r,height:o}=e,a=[s,n,r,o];s<0||n<0?this._appendBlock(t,a):this._insertBlock(t,a)}_canMove(e,t){const{dropping:s}=this.state;if(s&&wu(e,s))return!1;for(const[n,r]of this._map.entries())if(n!==t&&wu(r,e))return!1;return!0}_canPlace(e){const{dragging:t}=this.state;return this._canMove(e,t)}_insertBlock(e,t){const{dropping:s}=this.state;for(s&&wu(t,s)&&(t[1]=s[1]+s[3]);!this._canPlace(t);)t[1]=t[1]+1;this._map.set(e,t)}_appendBlock(e,t){const[s,n,r,o]=t;let a=n;if(s>=0&&n>=0){if(this._canPlace(t)){this._map.set(e,[s,n,r,o]);return}a=-1}let l=s<0?0:s,c=a<0?0:a,h=!1;const d=this.props.grid;for(;!h;){if(this._canPlace([l,c,r,o])){h=!0;break}s<0?(l+=1,l+r>d&&(l=0,c+=1)):c+=1}this._map.set(e,[l,c,r,o])}componentDidMount(){this.loadNext(),v(window).on("scroll",this.tryLoadNext),this._initDraggable();for(const[e,t]of this._map.entries())this._oldMap.set(e,[...t])}componentDidUpdate(e){e.blocks!==this.props.blocks?this.setState({blocks:this._initBlocks(this.props.blocks)}):this.loadNext()}componentWillUnmount(){var e;clearTimeout(this._loadTimer),v(window).off("scroll",this.tryLoadNext),(e=this._draggable)==null||e.destroy()}render(){const{blocks:e,height:t}=this._layout(),{cellHeight:s,grid:n,emptyBlockContent:r}=this.props,{dropping:o,dragging:a}=this.state,l=this._map;return k("div",{class:"dashboard",children:k("div",{class:"dashboard-blocks",style:{height:t*s},ref:this._ref,children:[o?k("div",{className:"dashboard-drop-shadow",style:{left:`${100*o[0]/n}%`,top:s*o[1],width:`${100*o[2]/n}%`,height:s*o[3]}},"dropping"):null,e.map((c,h)=>{const{id:d,menu:f,content:m,title:y}=c,[b,w,x,D]=d===a&&o?o:l.get(d)||[0,0,c.width,c.height];return k(Mk,{id:d,index:h,left:`${100*b/n}%`,top:s*w,width:`${100*x/n}%`,height:s*D,content:m??r,title:y,className:K(c.needLoad?"need-load":"",m?"has-content":""),onMenuBtnClick:f?this._handleMenuClick:void 0},c.id)})]})})}};vv.defaultProps={responsive:!1,cache:!0,blocks:[],grid:3,gap:16,cellHeight:64,blockDefaultSize:[1,3],blockMenu:{items:[{text:"Refresh",data:{type:"refresh"}}]},onlyLoadVisible:!0,blockSizeMap:{xs:[1,3],sm:[1,4],md:[1,5],lg:[1,6],xl:[1,8],xsWide:[2,3],smWide:[2,4],mdWide:[2,5],lgWide:[2,6],xlWide:[2,8],xsLong:[3,3],smLong:[3,4],mdLong:[3,5],lgLong:[3,6],xlLong:[3,8]}};class Cu extends be{}Cu.NAME="Dashboard",Cu.Component=vv;function xu(i,e,t,s){if(typeof i=="function"&&(i=i.call(this,e)),typeof i=="string"&&i.length&&(i={url:i}),!i)return Array.isArray(t)?k(cn,{children:t}):t;const{url:n,...r}=i,{setting:o}=e.col,a={};return o&&Object.keys(o).forEach(l=>{l.startsWith("data-")&&(a[l]=o[l])}),k("a",{href:$e(n,e.row.data),...s,...r,...a,children:t})}function ku(i,e,t){if(i==null)return;const s=e.row.data;return t=t??(s==null?void 0:s[e.col.name]),typeof i=="function"?i.call(this,t,e):$e(i,{...s,0:t})}function _v(i,e,t,s){var n;return t?(t=t??((n=e.row.data)==null?void 0:n[e.col.name]),t==="0000-00-00 00:00:00"||t==="0000-00-00"?s??"":i===!1?t:(i===!0&&(i="[yyyy-]MM-dd hh:mm"),typeof i=="function"&&(i=i.call(this,t,e)),rt(t,i,s??t))):s??t}function bv(i,e){const{link:t}=e.col.setting,s=xu.call(this,t,e,i[0]);return s&&(i[0]=s),i}function wv(i,e){const{format:t,digits:s}=e.col.setting;let n=i[0];return typeof s=="number"&&!Number.isNaN(Number(n))&&(n=Number(n),s>=0&&(n=n.toFixed(s))),t&&(n=ku.call(this,t,e,n)),i[0]=n,i}function Cv(i,e){const{map:t,mapSplitter:s=",",mapJoiner:n}=e.col.setting;if(t){let r=i[0];typeof r=="string"&&s&&(r=r.split(s)),typeof t=="function"?i[0]=t.call(this,r,e):typeof t=="object"&&(Array.isArray(r)||(r=[r]),i[0]=r.map(o=>t[o]??o).join(n??s))}return i}function xv(i,e,t){const s={};return typeof i=="function"?Object.assign(s,i.call(this,t)):Object.keys(i).forEach(n=>{var o;const r=(o=t.row.data)==null?void 0:o[i[n]];r!==void 0&&(s[n]=r)}),Object.keys(s).length&&e.push({style:s}),e}function kv(i,e,t="[yyyy-]MM-dd hh:mm"){const{formatDate:s=t,invalidDate:n}=e.col.setting;return i[0]=_v.call(this,s,e,i[0],n),i}function Su(i,e,t=!1){const{html:s=t}=e.col.setting;if(s===!1)return i;const n=i[0],r=s===!0?n:ku.call(this,s,e,n);return i[0]={html:r},i}const Nk=et({name:"rich",colTypes:{html:{onRenderCell(i,e){return Su.call(this,i,e,!0)}},progress:{align:"center",onRenderCell(i,{col:e}){const{progressType:t,barColor:s,barBgColor:n,barHeight:r=6,barWidth:o=64,circleSize:a=24,circleBorderSize:l=1,circleBgColor:c="var(--color-border)",circleColor:h="var(--color-success-500)"}=e.setting,d=i[0];return i[0]=t==="bar"?k(_a,{className:"rounded-full",width:o,height:r,color:s||h,background:n,percent:d}):k(ba,{percent:d,size:a,circleWidth:l,circleBg:c,circleColor:h,text:!0}),i}},datetime:{formatDate:"[yyyy-]MM-dd hh:mm"},date:{formatDate:"yyyy-MM-dd"},time:{formatDate:"hh:mm"}},onRenderCell(i,e){const{formatDate:t,html:s,hint:n,styleMap:r}=e.col.setting;if(t&&(i=kv.call(this,i,e,t)),i=Cv.call(this,i,e),i=wv.call(this,i,e),s?i=Su.call(this,i,e):i=bv.call(this,i,e),n){let o=e.value;typeof n=="function"?o=n.call(this,e):typeof n=="string"?o=$e(n,e.row.data):typeof i[0]=="string"&&(o=i[0]),i.push({attrs:{title:o}})}return r&&(i=xv.call(this,r,i,e)),i}},{buildIn:!0}),Ek={default:(i,e,t)=>{var r,o;const s=(r=i.data)==null?void 0:r[t.name],n=(o=e.data)==null?void 0:o[t.name];return s===n?0:s==null?1:String(s).localeCompare(String(n))},date:(i,e,t)=>{var r,o;const s=Je(((r=i.data)==null?void 0:r[t.name])??0),n=Je(((o=e.data)==null?void 0:o[t.name])??0);return s.getTime()-n.getTime()},number:(i,e,t)=>{var r,o;const s=(r=i.data)==null?void 0:r[t.name],n=(o=e.data)==null?void 0:o[t.name];return Number.parseFloat(s)-Number.parseFloat(n)}},Ak=et({name:"sort",defaultOptions:{sort:!1},when:i=>!!i.sort,onCreate(){const{sortBy:i}=this.options;i&&(this.state.sortBy=Array.isArray(i)?i:[i])},onAddRows(i,e){const{sortBy:t}=this.state;if(!t||!t.length)return;const{sort:s}=this.options,n={...Ek,...typeof s=="function"?{default:s}:typeof s=="object"?s:{}};return[...i].sort((r,o)=>{for(const{name:a,order:l}of t){const c=e.map[a];if(!c)continue;let h=c.setting.sort;if(h===!0?h=n.default:typeof h=="string"&&(h=n[h]),!h)continue;const d=h.call(this,r,o,c);if(d)return l==="asc"?d:-d}return 0})},onHeaderCellClick(i,e){if(!i.target.closest(".dtable-sort-link"))return;const t=this.getColInfo(e.colName);if(!t||!t.setting.sort)return;const{sortBy:s=[]}=this.state,n=s.findIndex(a=>a.name===t.name),{multiSort:r}=this.options;let o="asc";if(n>=0){const a=s[n].order;a==="asc"?o="desc":a==="desc"&&(o="none"),r&&s.splice(n,1)}r||(s.length=0),this.update({dirtyType:"layout",state:{sortBy:[{name:e.colName,order:o},...s].filter(a=>a.order!=="none")}})},onRenderHeaderCell(i,e){var l;const{col:t}=e,{sortBy:s}=this.state;if(!t.setting.sort)return i;const o=((l=s==null?void 0:s.find(c=>c.name===t.name))==null?void 0:l.order)||"none",a=k("div",{className:`dtable-sort dtable-sort-${o}`});return i[0]=k("a",{className:"dtable-sort-link",href:"javascript:;",children:[i[0],a]}),i.push({outer:!0,attrs:{"data-sort":o}}),i}},{buildIn:!0}),Pk={html:{component:Ds}},Sv=et({name:"custom",onRenderCell(i,e){const{col:t}=e;let{custom:s}=t.setting;if(typeof s=="function"&&(s=s.call(this,e)),!s)return i;const n=Array.isArray(s)?s:[s],{customMap:r}=this.options;return n.forEach(o=>{let a;typeof o=="string"?a=o.startsWith("<")?{component:Ds,props:{html:$e(o,{value:e.value,...e.row.data,$value:e.value})}}:{component:o}:a=o;let{component:l}=a;const c=[a];typeof l=="string"&&c.unshift(Pk[l],r==null?void 0:r[l]);const h={};c.forEach(f=>{if(f){const{props:m}=f;m&&v.extend(h,typeof m=="function"?m.call(this,e):m),l=f.component||l}},{props:{}});const d=l;i[0]={outer:!0,className:"dtable-custom-cell",children:k(d,{...h})}}),i}}),DI="";function Lk(i,e){var a,l;typeof i=="boolean"&&(e=i,i=void 0);const t=this.state.checkedRows,s={},{canRowCheckable:n,allowCheckDisabled:r}=this.options,o=(c,h)=>{const d=n?n.call(this,c):!0;!d||!r&&d==="disabled"||!!t[c]===h||(h?t[c]=!0:delete t[c],s[c]=h)};if(i===void 0?(e===void 0&&(e=!Tv.call(this)),(a=this.layout)==null||a.allRows.forEach(({id:c})=>{o(c,!!e)})):(Array.isArray(i)||(i=[i]),i.forEach(c=>{o(c,e??!t[c])})),Object.keys(s).length){const c=(l=this.options.beforeCheckRows)==null?void 0:l.call(this,i,s,t);c&&Object.keys(c).forEach(h=>{const d=n?n.call(this,h):!0;!d||!r&&d==="disabled"||(c[h]?t[h]=!0:delete t[h])}),this.setState({checkedRows:{...t}},()=>{var h;(h=this.options.onCheckChange)==null||h.call(this,s)})}return s}function Rk(i){return this.state.checkedRows[i]??!1}function Tv(){var n,r;const i=(n=this.layout)==null?void 0:n.allRows.length;if(!i)return!1;const e=this.getChecks().length,{canRowCheckable:t,allowCheckDisabled:s}=this.options;return t?e===((r=this.layout)==null?void 0:r.allRows.reduce((o,a)=>{const l=t?t.call(this,a.id):!0;return o+(!l||!s&&l==="disabled"?0:1)},0)):e===i}function zk(){var e;const i=new Set((e=this.layout)==null?void 0:e.allRows.map(t=>t.id));return Object.keys(this.state.checkedRows).filter(t=>i.has(t))}function Fk(i){const{checkable:e}=this.options;i===void 0&&(i=!e),e!==i&&this.setState({forceCheckable:i})}function $v(i,e,t=!1,s=void 0){return k(qs,{className:"dtable-checkbox",checked:i,disabled:t,label:s})}const Dv='input[type="checkbox"],.dtable-checkbox',Ok=et({name:"checkable",defaultOptions:{checkable:"auto",checkboxRender:$v},when:i=>!!i.checkable,options(i){const{forceCheckable:e}=this.state;return e!==void 0?i.checkable=e:i.checkable==="auto"&&(i.checkable=!!i.cols.some(t=>t.checkbox)),i},state(){return{checkedRows:{}}},methods:{toggleCheckRows:Lk,isRowChecked:Rk,isAllRowChecked:Tv,getChecks:zk,toggleCheckable:Fk},i18n:{zh_cn:{checkedCountInfo:"已选择 {selected} 项",totalCountInfo:"共 {total} 项"},zh_tw:{checkedCountInfo:"已選擇 {selected} 項",totalCountInfo:"共 {total} 項"},en:{checkedCountInfo:"Selected {selected} items",totalCountInfo:"Total {total} items"}},footer:{checkbox(){const i=this.isAllRowChecked();return[k("div",{style:{paddingRight:"calc(3*var(--space))",display:"flex",alignItems:"center"},onClick:()=>this.toggleCheckRows(),children:$v(i,void 0,!1,this.options.checkboxLabel)})]},checkedInfo(i,e){const t=this.getChecks(),{checkInfo:s}=this.options;if(s)return[k(fe,{className:"dtable-check-info",content:s.call(this,t)})];const n=t.length,r=[];return n&&r.push(this.i18n("checkedCountInfo",{selected:n})),r.push(this.i18n("totalCountInfo",{total:e.allRows.length})),[k("div",{className:"dtable-check-info",children:r.join(", ")})]}},onCreate(){const{checkedRows:i}=this.options;i&&this.setState(e=>({checkedRows:{...e.checkedRows,...i.reduce((t,s)=>(t[s]=!0,t),{})}}))},onRenderCell(i,{row:e,col:t}){var c;const{id:s}=e,{canRowCheckable:n}=this.options,r=n?n.call(this,s):!0;if(!r)return i;const{checkbox:o}=t.setting,a=typeof o=="function"?o.call(this,s):o,l=this.isRowChecked(s);if(a){const h=(c=this.options.checkboxRender)==null?void 0:c.call(this,l,s,r==="disabled");i.push(h,{outer:!0,className:"has-checkbox"})}return l&&i.push({outer:!0,className:"is-checked"}),i},onRenderHeaderCell(i,{row:e,col:t}){var o;const{id:s}=e,{checkbox:n}=t.setting;if(typeof n=="function"?n.call(this,s):n){const a=this.isAllRowChecked(),l=(o=this.options.checkboxRender)==null?void 0:o.call(this,a,s);i.push(l,{outer:!0,className:"has-checkbox"})}return i},onHeaderCellClick(i){if(this.data.disableCheckable)return;const e=i.target;if(!e)return;const t=e.closest(Dv);t&&this.toggleCheckRows(t.checked)},onCellClick(i,{rowID:e}){if(this.data.disableCheckable)return;const t=v(i.target);if(!t.length||t.closest("btn,a,button.not-checkable,.form-control,.btn").length)return;(t.closest(Dv).not(".disabled").length||this.options.checkOnClickRow)&&this.toggleCheckRows(e)}}),Iv=et({name:"store",defaultOptions:{store:!0},when:i=>!!i.store,data(){return{store:new Mr(`DTable:${this.id}`)}}}),NI="",EI="";var Mv=(i=>(i.unknown="",i.collapsed="collapsed",i.expanded="expanded",i.hidden="hidden",i.normal="normal",i))(Mv||{});function ql(i){const e=this.data.nestedMap.get(i);if(!e||e.state!=="")return e??{state:"normal",level:-1};if(!e.parent&&!e.children)return e.state="normal",e;const t=e.children&&this.state.nestedState[i];let s=!1,{parent:n}=e;for(;n;){const r=ql.call(this,n);if(r.state!=="expanded"){s=!0;break}n=r.parent}return e.state=s?"hidden":t?"collapsed":e.children?"expanded":"normal",e.level=e.parent?ql.call(this,e.parent).level+1:0,e}function jk(i){return i!==void 0?ql.call(this,i):this.data.nestedMap}function Bk(i,e){let{nestedState:t}=this.state;const{nestedMap:s}=this.data;if(i==="HEADER")if(e===void 0&&(e=!Nv.call(this)),e){const n=s.entries();for(const[r,o]of n)o.state==="expanded"&&(t[r]=!0)}else t={};else{const n=Array.isArray(i)?i:[i];e===void 0&&(e=!t[n[0]]),n.forEach(r=>{const o=s.get(r);e&&(o!=null&&o.children)?t[r]=!0:delete t[r]})}this.update({dirtyType:"layout",state:{nestedState:{...t}}},()=>{const{onNestedChange:n,preserveNested:r}=this.options;n==null||n.call(this),r&&this.data.store.set("nestedState",t)})}function Nv(){const i=this.data.nestedMap.values();for(const e of i)if(e.state==="expanded")return!1;return!0}function Ev(i,e=1,t,s=0){var n;t||(t=[...i.keys()]);for(const r of t){const o=i.get(r);o&&(o.level===s&&(o.order=e++),(n=o.children)!=null&&n.length&&(e=Ev(i,e,o.children,s+1)))}return e}function Av(i,e,t,s){const n=i.getNestedRowInfo(e);return!n||n.state===""||!n.children||n.children.forEach(r=>{s[r]=t,Av(i,r,t,s)}),n}function Pv(i,e,t,s,n){var a;const r=i.getNestedRowInfo(e);if(!r||r.state==="")return;((a=r.children)==null?void 0:a.every(l=>{const c=!!(s[l]!==void 0?s[l]:n[l]);return t===c}))&&(s[e]=t),r.parent&&Pv(i,r.parent,t,s,n)}const Gl="dtable-nested-toggle",Hk=et({name:"nested",plugins:[Iv],requireAfter:["sortable"],defaultOptions:{nested:"auto",nestedParentKey:"parent",asParentKey:"asParent",nestedIndent:20,canSortTo(i,e){const{nestedMap:t}=this.data,s=t.get(i.id),n=t.get(e.id);return(s==null?void 0:s.parent)===(n==null?void 0:n.parent)},beforeCheckRows(i,e,t){if(!this.options.checkable||!(i!=null&&i.length)||this.options.noNestedCheck)return;const s={};return Object.entries(e).forEach(([n,r])=>{const o=Av(this,n,r,s);o!=null&&o.parent&&Pv(this,o.parent,r,s,t)}),s}},options(i){return i.nested==="auto"&&(i.nested=!!i.cols.some(e=>e.nestedToggle)),i},when:i=>!!i.nested,data(){return{nestedMap:new Map,nestedRowMap:new Map}},state(){return{nestedState:{}}},methods:{getNestedInfo:jk,toggleRow:Bk,isAllCollapsed:Nv,getNestedRowInfo:ql},onCreate(){let{defaultNestedState:i}=this.options;if(this.options.preserveNested){const e=this.data.store.get("nestedState");e&&(i=e)}if(i===!0){const{data:e,rowKey:t="id"}=this.options;Array.isArray(e)&&(i=e.reduce((s,n)=>(s[typeof n=="string"?n:n[t]]=!0,s),{}))}this.state.nestedState=i||{}},onMounted(){this.options.defaultNestedState===!0&&!this.options.preserveNested&&this.toggleRow("HEADER",!0)},beforeLayout(){this.data.nestedMap.clear(),this.data.nestedRowMap.clear()},onAddRow(i){this.data.nestedRowMap.set(i.id,i)},onAddRows(i){const{nestedMap:e,nestedRowMap:t}=this.data;i.forEach(r=>{var c,h;const o=e.get(r.id)??{state:"",level:0};let a=((c=r.data)==null?void 0:c[this.options.nestedParentKey??"parent"])??[];Array.isArray(a)||(a=[a]);let l;for(a=[...a];a.length;){let d=a.pop();if(d===void 0)continue;if(d=String(d),t.get(d)){l=d;break}}if(o.parent=l==="0"?void 0:l,(h=r.data)!=null&&h[this.options.asParentKey??"asParent"]&&(o.children=[]),e.set(r.id,o),l){let d=e.get(l);d||(d={state:"",level:0},e.set(l,d)),d.children||(d.children=[]),d.children.push(r.id)}});const s=new Map,n=i.length*100;return i=i.filter(r=>{const o=this.getNestedRowInfo(r.id);return s.set(r.id,o),o.state!=="hidden"}),Ev(s),i.sort((r,o)=>{const a=s.get(r.id),l=s.get(o.id);return((a==null?void 0:a.order)??n+r.index)-((l==null?void 0:l.order)??n+o.index)}),i},onRenderCell(i,e){var c;const{row:t,col:s}=e,{id:n,data:r}=t,{nestedToggle:o,childLabel:a}=s.setting,l=this.getNestedRowInfo(n);if(a){const h=Number(r[this.options.nestedParentKey||"parent"]);if(!Number.isNaN(h)&&h>0){let d;typeof a=="string"?d=k("span",{className:"dtable-child-label label rounded-full size-sm gray-pale",children:$e(a,r)}):d=k(fe,{className:"dtable-child-label",content:a,generatorThis:e}),i.unshift(d)}}if(o&&(l.children||l.parent)&&i.push(((c=this.options.onRenderNestedToggle)==null?void 0:c.call(this,l,n,s,r))??k("a",{className:`${Gl} state${l.children?"":" is-no-child"}`,children:k("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${l.state}`}),l.level){let{nestedIndent:h=o}=s.setting;h&&(h===!0&&(h=this.options.nestedIndent??12),i.push(k("div",{className:"dtable-nested-indent",style:{width:h*l.level+"px"}})))}return i},onRenderHeaderCell(i,{row:e,col:t}){var n;const{id:s}=e;return t.setting.nestedToggle&&i.push(((n=this.options.onRenderNestedToggle)==null?void 0:n.call(this,void 0,s,t,void 0))??k("a",{className:`${Gl} state`,children:k("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${this.isAllCollapsed()?"collapsed":"expanded"}`}),i},onHeaderCellClick(i){const e=i.target;if(!(!e||!e.closest(`.${Gl}`)))return this.toggleRow("HEADER"),!0},onCellClick(i,{rowID:e}){const t=i.target;if(!(!t||!this.getNestedRowInfo(e).children||!t.closest(`.${Gl}`)))return this.toggleRow(e),!0}});function Tu(i,{row:e,col:t}){const{data:s}=e,n=s?s[t.name]:void 0;if(!(n!=null&&n.length))return i;const{avatarClass:r="rounded-full",avatarKey:o=`${t.name}Avatar`,avatarCodeKey:a,avatarNameKey:l=`${t.name}Name`}=t.setting;let{avatarProps:c={}}=t.setting;typeof c=="function"&&(c=c(t,e));const h=(s?s[l]:n)||i[0],d={size:"xs",src:s?s[o]:void 0,text:h,code:a?s?s[a]:void 0:n,...c,className:K(r,c.className,"flex-none")};if(i[0]=k(Gs,{...d}),t.type==="avatarBtn"){const{avatarBtnProps:f}=t.setting,m=typeof f=="function"?f(t,e):f;i[0]=k("button",{type:"button",className:"btn btn-avatar",...m,children:[i[0],k("div",{children:h})]})}else t.type==="avatarName"&&(i[0]=k("div",{className:"flex items-center gap-1",children:[i[0],k("span",{children:h})]}));return i}const Uk=et({name:"avatar",colTypes:{avatar:{onRenderCell:Tu},avatarBtn:{onRenderCell:Tu},avatarName:{onRenderCell:Tu}}},{buildIn:!0}),Vk=et({name:"sort-type",defaultOptions:{sortType:!0},when:i=>!!i.sortType&&!i.sort,onRenderHeaderCell(i,e){const{col:t}=e,{setting:s}=t;let{sortType:n}=s;if(t.setting.sort!==void 0||n===!1)return i;const{sortLink:r,orderBy:o}=this.options;if(o&&o[t.name]!==void 0&&(n=o[t.name]),n){const a=n===!0?"none":n,l=k("div",{className:`dtable-sort dtable-sort-${a}`});i.push({outer:!0,attrs:{"data-sort":a}});let{sortLink:c=r}=s;if(c){const h=a==="asc"?"desc":"asc";typeof c=="function"&&(c=c.call(this,t,h,a)),typeof c=="string"&&(c={url:c});const{url:d,...f}=c;i[0]=k("a",{className:"dtable-sort-link",href:$e(d,{...s,sortType:h}),...f,children:[typeof i[0]!="object"||N.isValidElement(i[0])?i[0]:t.name,l]})}else i.push(l)}return i}},{buildIn:!0}),$u=i=>{i.length!==1&&i.forEach((e,t)=>{!t||e.border!==void 0||e.setting.group===i[t-1].setting.group||(e.border="left")})},Wk=et({name:"group",defaultOptions:{groupDivider:!0},when:i=>!!i.groupDivider,onLayout(i){if(!this.options.groupDivider)return;const{cols:e}=i;$u(e.left.list),$u(e.center.list),$u(e.right.list)}}),zI="",Kk=et({name:"header-group",defaultOptions:{headerGroup:!0},data(){return{headerGroups:new Map}},when:i=>!!i.headerGroup,beforeLayout(i){const{headerGroups:e}=this.data;e.clear();const{cols:t}=i;if(!(t!=null&&t.length))return;const s={};return t.forEach((n,r)=>{const{headerGroup:o}=n;if(!o){s[n.name]=r;return}let a=e.get(o);a?a.cols.push(n.name):(a={cols:[n.name],index:r},e.set(o,a)),s[n.name]=a.index+a.cols.length/t.length}),t.sort((n,r)=>s[n.name]-s[r.name]),{headerHeight:!i.headerHeight&&i.rowHeight?i.rowHeight*2:void 0,cols:t}},onRenderHeaderCell(i,{col:e}){const{headerGroup:t}=e.setting;if(t){const s=this.data.headerGroups.get(t),n=this.layout.headerHeight/2;if(e.name===s.cols[0]){const r=s.cols.reduce((a,l)=>{var c;return a+(((c=this.getColInfo(l))==null?void 0:c.realWidth)??0)},0),o={height:n-1,width:r-1};i.push(k("div",{class:"dtable-header-group",style:o,children:t}))}i.push({className:"dtable-header-as-group",style:{paddingTop:n}})}return i}}),qk=et({name:"cellspan",when:i=>!!i.getCellSpan,data(){return{cellSpanMap:new Map,overlayCellSet:new Set}},onLayout(i){const{getCellSpan:e}=this.options;if(!e)return;const{cellSpanMap:t,overlayCellSet:s}=this.data,{rows:n,cols:r,rowHeight:o}=i;t.clear(),s.clear();const a=(l,c,h)=>{const{index:d}=c;l.forEach((f,m)=>{const{index:y}=f,b=`C${y}R${d}`;if(s.has(b))return;const w=e.call(this,{row:c,col:f});if(!w)return;const x=Math.min(w.colSpan||1,l.length-m),D=Math.min(w.rowSpan||1,n.length-h);if(x<=1&&D<=1)return;let I=0;for(let E=0;E<x;E++){I+=l[m+E].realWidth;for(let P=0;P<D;P++){const O=`C${y+E}R${d+P}`;O!==b&&s.add(O)}}t.set(b,{colSpan:x,rowSpan:D,width:I,height:o*D})})};n.forEach((l,c)=>{["left","center","right"].forEach(h=>{a(r[h].list,l,c)})})},onRenderCell(i,{row:e,col:t}){const s=`C${t.index}R${e.index}`;if(this.data.overlayCellSet.has(s))i.push({outer:!0,style:{display:"none",className:"cellspan-overlayed-cell"}});else{const n=this.data.cellSpanMap.get(s);n&&i.push({outer:!0,style:{width:n.width,height:n.height}})}return i}}),lo=et({name:"mousemove",events:{click(i){this.data.ignoreNextClick&&(i.preventDefault(),this.data.ignoreNextClick=void 0)},mousedown(){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick)},mousemove(i){this.data.mmRafID&&cancelAnimationFrame(this.data.mmRafID),this.data.mmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("mousemovesmooth",i),this.data.mmRafID=0}),i.preventDefault()},document_mousemove(i){this.data.dmmRafID&&cancelAnimationFrame(this.data.dmmRafID),this.data.dmmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("document_mousemovesmooth",i),this.data.mmRafID=0})}},methods:{ignoreNextClick(i=10){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick),this.data.ignoreNextClick=window.setTimeout(()=>{this.data.ignoreNextClick=void 0},i)}}});function Gk(){var I,E,P,O;const{scrollToMouse:i}=this.data;if(!i)return this.stopScrollToMouse();const{position:e,startTime:t,delay:s}=i;if(!e||Date.now()-t<s)return;const n=(E=(I=this.ref.current)==null?void 0:I.querySelector(".dtable-body"))==null?void 0:E.getBoundingClientRect();if(!n)return;const r=(O=(P=this.ref.current)==null?void 0:P.querySelector(".dtable-scroll-center"))==null?void 0:O.getBoundingClientRect(),{maxStep:o,detectPadding:a,speed:l,side:c}=i,{x:h,y:d}=e,{top:f,bottom:m}=n,{left:y,right:b}=r||n;let w=0;h<y-a?w=-Math.max(o,y-a-h):h>b-a&&(w=Math.max(o,h-(b-a)));let x=0;if(d<f-a?x=-Math.max(o,f-a-d):d>m-a&&(x=Math.max(o,d-(m-a))),c){const W=new Set((Array.isArray(c)?c:[c]).reduce((J,Y)=>(Y==="x"?J.push("left","right"):Y==="y"?J.push("top","bottom"):J.push(Y),J),[]));(!W.has("left")&&w<0||!W.has("right")&&w>0)&&(w=0),(!W.has("top")&&x<0||!W.has("bottom")&&x>0)&&(x=0)}const D={};w!==0&&(D.scrollLeft=this.layout.scrollLeft+l*w),x!==0&&(D.scrollTop=this.layout.scrollTop+l*x),this.scroll(D)}const Du=et({name:"autoscroll",plugins:[lo],events:{document_mousemovesmooth(i){if(!this.data.scrollToMouse)return;const{clientX:e,clientY:t}=i;this.data.scrollToMouse.position={x:e,y:t}}},methods:{scrollTo({col:i,row:e,extra:t=2}){const s=this.getColInfo(i),n=this.getRowInfo(e);if(!s&&!n)return!1;const r={},{layout:o}=this;if(s){const{scrollLeft:a,cols:l}=o,c=s.left+s.realWidth;s.left<a?r.scrollLeft=s.left-t:c>l.center.width+a&&(r.scrollLeft=c-l.center.width+t)}if(n){const{scrollTop:a,rowHeight:l,rowsHeight:c}=o,h=n.top+l;n.top<a?r.scrollTop=n.top-t:h>c+a&&(r.scrollTop=h-c+t)}return this.scroll(r),!0},startScrollToMouse(i){const e={interval:60,speed:.5,delay:200,maxStep:this.options.rowHeight,onlyInside:!1,detectPadding:30,startTime:Date.now(),...i};this.data.scrollToMouse=e,clearInterval(this.data.scrollToTimer),this.data.scrollToTimer=window.setInterval(Gk.bind(this),e.interval)},stopScrollToMouse(){clearInterval(this.data.scrollToTimer),this.data.scrollToMouse=void 0}},onUnmounted(){clearInterval(this.data.scrollToTimer)}}),HI="",Zk=et({name:"sortable",defaultOptions:{sortable:!0},when:i=>!!i.sortable,plugins:[lo,Du],resetState:!0,state(){return{rowOrders:void 0,sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0}},events:{click(i){i.target.closest(".dtable-sort-link")&&(this.state.rowOrders=void 0)},mousedown(i){var a;if(this.data.disableSortable)return;const{sortHandler:e=".dtable-cell"}=this.options;if(!v(i.target).closest(e).length)return;const n=this.getPointerInfo(i);if(!n||n.rowID==="HEADER")return;const r=this.getRowInfo(n.rowID);if(!r||((a=this.options.onSortStart)==null?void 0:a.call(this,r,i))===!1)return;i.preventDefault();const o=i.clientY;this.data.sortableInfo={from:r,offset:o-n.cellElement.getBoundingClientRect().top,startMouseY:o,lastMouseY:o}},document_mouseup(i){var s;const{sortableInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingState(i);if(t){let n,r;const{sortingFrom:o,sortingTo:a,sortingSide:l}=t;if(a&&l){const c=this.layout.rows.map(m=>m.id),h=[...c],d=o.index,f=a.index;if(!(d===f+1&&l==="after")&&!(d===f-1&&l==="before")){const m=c.splice(d,1);c.splice(f,0,m[0]),n={},r=[],c.forEach((y,b)=>{n[y]=b,r.push(y)}),(h.join()===r.join()||((s=this.options.onSort)==null?void 0:s.call(this,o,a,l,r))===!1)&&(n=void 0,r=void 0)}}(a||Math.abs(e.lastMouseY-e.startMouseY)>4)&&this.ignoreNextClick(),this.disableAnimation(),this.update({dirtyType:"layout",state:c=>v.extend({sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0},n?{rowOrders:{...c.rowOrders,...n}}:null)},()=>{var c;(c=this.options.onSortEnd)==null||c.call(this,o,a,l,r),setTimeout(()=>{this.data.disableCheckable=void 0},50)})}this.data.sortableInfo=void 0},document_mousemovesmooth(i){const{sortableInfo:e}=this.data;if(!e)return;const t=this.getSortingState(i);t&&(e.state||(this.startScrollToMouse({side:"y"}),this.data.disableCheckable=!0),e.lastMouseY=i.clientY,e.state=t,this.setState(t))}},methods:{getSortingState(i){var O;const{disableSortable:e,sortableInfo:t}=this.data;if(e||!t)return;const{headerHeight:s,footerHeight:n,visibleRows:r,scrollTop:o,rowHeight:a}=this.layout,l=this.element.getBoundingClientRect(),c=l.width,h=l.height-s-n,d=i.clientX-l.left,f=i.clientY-l.top-s;if(d<0||d>c||f<0||f>h)return t.state;const m=f+o,y=r.find(W=>W.top<=m&&W.top+a>m);if(!y)return t.state;const b=t.from,w=y.id!==b.id?y.id:void 0,x=w?this.getRowInfo(w):void 0,D=f,I=m<y.top+a/2?"before":"after";return x&&((O=this.options.canSortTo)==null?void 0:O.call(this,b,x,I))!==!1?{sortingFrom:b,sortingPos:D,sortingTo:x,sortingSide:I}:{sortingFrom:b,sortingPos:D,sortingTo:void 0,sortingSide:void 0}}},onAddRows(i){const{rowOrders:e}=this.state;if(!e)return;const t=i.length*100;return i=i.sort((s,n)=>{const r=e[s.id]??t+s.index,o=e[n.id]??t+n.index;return r-o}),i},beforeRender(i){const{sortingFrom:e}=this.state,{visibleRows:t}=i;e&&(t.some(s=>s.id===e.id)||(i.visibleRows=[...t,e]),i.className=K(i.className,"dtable-sorting"))},onRenderCell(i,e,t){const{sortingFrom:s,sortingPos:n,sortingTo:r,sortingSide:o}=this.state;if(!s)return i;const a=e.row,l={},c=[];if(s.id===a.id)l.top=n-this.data.sortableInfo.offset+((t.top??a.top)-(a.top-this.layout.scrollTop)),c.push("is-sorting-from");else if(r){const h=r.id===a.id;h&&c.push(`text-primary is-sorting-to is-sorting-to-${o}`),s.index>a.index&&(h&&o==="before"||a.index>r.index)?c.push("is-sorting-before"):s.index<a.index&&(h&&o==="after"||a.index<r.index)&&c.push("is-sorting-after")}return c.length&&i.push({outer:!0,style:l,className:c}),i}}),Lv=et({name:"pager",state(){const i=this.props.localPager;if(i){const{page:e=1,recTotal:t=0,recPerPage:s=20,pageTotal:n=1}=this.props.footPager||{};return{pager:{page:e,recTotal:t,recPerPage:s,pageTotal:n,...typeof i=="object"?i:null}}}return{}},footer:{pager(){let{footPager:i}=this.options;const{localPager:e}=this.options;return i?(i={items:[{type:"link",page:"first",icon:"icon-first-page"},{type:"link",page:"prev",icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",icon:"icon-angle-right"},{type:"link",page:"last",icon:"icon-last-page"}],...i},Array.isArray(i.items)&&i.items.forEach(t=>{t.type==="size-menu"&&t.caret===void 0&&(t.caret="up")}),this.options.localPager&&(Object.assign(i,{...typeof e=="object"?e:null,...this.state.pager,recTotal:this.layout.allRows.length,useState:!0}),i.onChangePageInfo=t=>{this.update({dirtyType:"layout",state:s=>({pager:{...s.pager,...t}})})}),[k(Kr,{...i})]):[]}},onAddRows(i){const{localPager:e}=this.options;if(e){const{page:t=1,recPerPage:s=20}={...typeof e=="object"?e:null,...this.state.pager},n=Math.max(0,Math.min(t,Math.ceil(i.length/s))),r=(n-1)*s,o=Math.min(n*s,i.length);return i.slice(r,o)}}}),Yk=Object.freeze(Object.defineProperty({__proto__:null,NestedRowState:Mv,avatar:Uk,cellspan:qk,checkable:Ok,custom:Sv,group:Wk,headerGroup:Kk,nested:Hk,pager:Lv,renderDatetime:_v,renderDatetimeCell:kv,renderFormat:ku,renderFormatCell:wv,renderHtmlCell:Su,renderLink:xu,renderLinkCell:bv,renderMapCell:Cv,renderStyleMapCell:xv,rich:Nk,sort:Ak,sortType:Vk,sortable:Zk},Symbol.toStringTag,{value:"Module"}));class Sn extends be{get commandScope(){return this.options.commandScope||"dtable"}afterInit(){super.afterInit();const{commands:e,onCommand:t}=this.options;(e||t)&&$i(this.element,{commands:e,scope:this.commandScope,onCommand:this.executeCommand.bind(this)})}executeCommand(e,t=[]){const{onCommand:s,commands:n}=this.options;let r;typeof e=="string"&&(e={name:e});const{scope:o,name:a}=e,l=n?n[`${o}~${a}`]||n[a]:null;if(l)return l.call(this,e,t);if(!e.scope||e.scope===this.commandScope){const{name:c}=e;r=ls(this.$,c,t)}return s&&(r=s.call(this,e,t)),r}setOptions(e,t){return e=super.setOptions(e,t),e.parent||(e.parent=this.element),e}}Sn.NAME="DTable",Sn.Component=ti,Sn.definePlugin=et,Sn.removePlugin=ry,Sn.getPlugin=oy,Sn.plugins=Yk,Sn.register(),ot({DTable:ti});const WI="",KI="",qI="",GI="",ZI="",YI="",JI="";class Iu extends Ke{_getClassName(e){return["kanban-header-col",e.className,e.subCols?"has-subs":"",e.parentName!==void 0?"is-sub":""]}_getProps(e){const{width:t,color:s,name:n,gapLeft:r,gapRight:o}=e;return Le(super._getProps(e),{style:{"--kanban-col-color":s,"--kanban-col-width":je(t),"--kanban-col-gap-left":je(r),"--kanban-col-gap-right":je(o)},"z-col":n})}_getChildren(e){const{prefix:t,prefixClass:s,title:n,titleClass:r,titleAlign:o="center",subtitle:a,subtitleClass:l,icon:c,trailingIcon:h,actions:d,subCols:f}=e;return[k("div",{className:`kanban-header-col-wrapper is-align-${o}`,children:[k("div",{className:"kanban-header-title",children:[c?k(Ie,{className:"as-leading-icon",icon:c},"icon"):null,t?k("span",{className:K("as-prefix",s),children:k(fe,{content:t})},"prefix"):null,n?k("span",{className:K("as-title",r),title:typeof n=="string"?n:void 0,children:k(fe,{content:n})},"title"):null,a?k("span",{className:K("as-subtitle",l),children:k(fe,{content:a})},"subtitle"):null,h?k(Ie,{className:"as-trailing-icon",icon:h},"trailingIcon"):null]},"title"),Be.render(d,[e],{key:"actions",className:"kanban-header-col-actions",size:"sm"},this)]},"wrapper"),f?k("div",{className:"kanban-header-sub-cols",children:f.map((m,y)=>k(Iu,{index:y,...m},m.name))},"subs"):null]}}class Jk extends ae{constructor(){super(...arguments),this._ref=ye()}componentDidMount(){this._ref.current&&(this._sticky=Qo.ensure(this._ref.current,{scrollContainer:".kanban-list"}))}componentWillUnmount(){var e;(e=this._sticky)==null||e.destroy()}render(e){return k("div",{className:"kanban-header",ref:this._ref,children:[k("div",{className:"kanban-header-lane-name"},"name"),k("div",{className:"kanban-header-cols",children:e.cols.map((t,s)=>k(Iu,{index:s,...t},t.name))},"cols")]})}}class Rv extends ae{constructor(){super(...arguments),this._listRef=ye(),this._renderItem=e=>{const{itemRender:t,lane:s,name:n}=this.props;return t.call(this,{item:e,lane:s,col:n})},this._handleScroll=e=>{const{current:t}=this._listRef;t&&v(t).trigger("laneColScroll",e)}}componentDidMount(){const{current:e}=this._listRef;e&&(this._ob=new ResizeObserver(t=>{v(this._listRef.current).trigger("laneColResize",t[0])}),this._ob.observe(e))}componentWillUnmount(){var e;(e=this._ob)==null||e.disconnect()}render(e){const{items:t}=e,{width:s,color:n,content:r,contentClass:o,itemRender:a,itemGap:l,watchSize:c,name:h,lane:d,itemCountPerRow:f,gapLeft:m,gapRight:y,laneColClass:b}=e,w={"--kanban-col-color":n,"--kanban-col-width":je(s),"--kanban-col-gap-left":je(m),"--kanban-col-gap-right":je(y)};return k("div",{className:K("kanban-lane-col",b),style:w,"z-lane":d,"z-col":h,children:[r?k("div",{className:K("kanban-col-content",o),children:k(fe,{content:r,generatorThis:this,generatorArgs:[e]})}):null,k("div",{className:"kanban-items scrollbar-thin scrollbar-hover",onScroll:this._handleScroll,children:k(Ji,{forwardRef:c?this._listRef:void 0,itemProps:{className:"kanban-item card-list-item"},items:t,itemRender:a?this._renderItem:void 0,countPerRow:f,gap:l},"list")})]})}}Rv.defaultProps={watchSize:!0};class Xk extends Ke{_getClassName(e){const{className:t,index:s,maxHeight:n,height:r}=e;return["kanban-lane",t,{"is-first":!s,"is-auto-height":!n&&(!r||r==="auto")}]}_getProps(e){const{height:t,minHeight:s,maxHeight:n,color:r,name:o,gapTop:a,gapBottom:l}=e;return Le(super._getProps(e),{style:{"--kanban-lane-color":r,height:je(t),minHeight:je(s),maxHeight:je(n),"--kanban-col-gap-top":je(a),"--kanban-col-gap-bottom":je(l)},"z-lane":o})}_renderCol(e,t,s,n,r){if(r){const o=r(e,t);o&&(t={...t,...o})}return k(Rv,{itemRender:s,lane:e.name,items:n[t.name],...t},t.name)}_getChildren(e){const{title:t,titleClass:s,actions:n,cols:r,items:o={},hideName:a,itemRender:l,getLaneCol:c}=e;return[a?null:k("div",{className:"kanban-lane-name",children:[Be.render(n,[e],{key:"actions",className:"kanban-lane-actions",size:"sm"},this),k("div",{className:K("kanban-lane-title",s),title:typeof t=="string"?t:void 0,children:k(fe,{content:t})},"title")]},"name"),k("div",{className:"kanban-lane-cols",children:r.reduce((h,d)=>(d.subCols?d.subCols.forEach(f=>{h.push(this._renderCol(e,f,l,o,c))}):h.push(this._renderCol(e,d,l,o,c)),h),[])},"cols")]}}function Qk(i){const{lanes:e,cols:t,items:s={},itemRender:n,hideLaneName:r,getLaneCol:o}=i;return k("div",{className:"kanban-body",children:e.map((a,l)=>k(Xk,{index:l,cols:t,items:s[a.name],hideName:r,itemRender:n,getLaneCol:o,...a},a.name))})}const Jt=12,eS={left:"right",right:"left",top:"bottom",bottom:"top","":""},Tn=({from:i,to:e,fromKanban:t,toKanban:s})=>`${t?`${t}_`:""}${i}-${s?`${s}_`:""}${e}`;function zv(i,e){return e==="top"?{x:i.x+i.width/2,y:i.y}:e==="left"?{x:i.x,y:i.y+i.height/2}:e==="right"?{x:i.x+i.width,y:i.y+i.height/2}:{x:i.x+i.width/2,y:i.y+i.height}}function tS(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function sS(i,e,t,s){const n=t?[t]:["left","right","top","bottom"],r=s?[s]:["left","right","top","bottom"];let o=Number.MAX_SAFE_INTEGER,a={x:0,y:0},l={x:0,y:0};return n.forEach(c=>{r.forEach(h=>{const d=zv(i,c),f=zv(e,h),m=tS(d,f)*(eS[c]===h?1:2);m<o&&(o=m,t=c,s=h,a=d,l=f)})}),{fromSide:t,toSide:s,fromPos:a,toPos:l}}function nS(i,e){return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}function Fv(i,e){return{x:Math.min(i.x,e.x),y:Math.min(i.y,e.y),width:Math.abs(i.x-e.x),height:Math.abs(i.y-e.y)}}function Ov(i,e,t){const s={id:`marker-${e}-${t}-${i}`,orient:"auto",markerUnits:"strokeWidth",refX:e==="start"?0:6,refY:3,markerWidth:6,markerHeight:6,path:{d:"",fill:"currentColor"}};return i==="arrow"?e==="start"?s.path.d="M6,0 L6,6 L0,3 z":s.path.d="M0,0 L0,6 L6,3 z":i==="dot"?s.path.d="M3,3 m-3,0 a 3,3 0 1,1 6,0 a 3,3 0 1,1 -6,0":i==="square"?s.path.d="M0,0 L0,6 L6,6 L6,0 z":i==="diamond"&&(s.path.d="M3,0 L6,3 L3,6 L0,3 z"),s}function iS(i,e,t,s,n="curve",r=2,o=1){const{x:a,y:l,width:c,height:h}=Fv(i,e),d=Jt-a,f=Jt-l;if(n==="curve"){const m=c*(1+Math.max(-.3,Math.min(.3,1-c/50)))*o,y=h*(1+Math.max(-.3,Math.min(.3,1-h/50)))*o,b=r*5,w={a1x:i.x+(t==="left"?-b:t==="right"?b:0),a1y:i.y+(t==="top"?-b:t==="bottom"?b:0),ax:i.x+(t==="left"?-m:t==="right"?m:0),ay:i.y+(t==="top"?-y:t==="bottom"?y:0),bx:e.x+(s==="left"?-(m-b):s==="right"?m-b:0),by:e.y+(s==="top"?-(y-b):s==="bottom"?y-b:0),b1x:e.x+(s==="left"?-b:s==="right"?b:0),b1y:e.y+(s==="top"?-b:s==="bottom"?b:0)};return`M ${i.x+d} ${i.y+f} L ${w.a1x+d} ${w.a1y+f} C ${w.ax+d} ${w.ay+f} ${w.bx+d} ${w.by+f} ${w.b1x+d} ${w.b1y+f} L ${e.x+d} ${e.y+f}`}if(n==="fold"){const m=nS(i,e),y=c/2,b=h/2,w={ax:i.x+(t==="left"?-y:t==="right"?y:0),ay:i.y+(t==="top"?-b:t==="bottom"?b:0),bx:e.x+(s==="left"?-y:s==="right"?y:0),by:e.y+(s==="top"?-b:s==="bottom"?b:0)};return`M ${i.x+d} ${i.y+f} L ${w.ax+d} ${w.ay+f} L ${m.x+d} ${m.y+f} L ${w.bx+d} ${w.by+f} L ${e.x+d} ${e.y+f}`}return`M ${i.x+d} ${i.y+f} L ${e.x+d} ${e.y+f}`}function rS(i){const{fromRect:e,toRect:t}=i,s=Tn(i),n={x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top},r={x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top},{fromSide:o,toSide:a,fromPos:l,toPos:c}=sS(n,r),h=Fv(l,c),{x:d,y:f,width:m,height:y}=h;l.x+=Jt-d,l.y+=Jt-f,c.x+=Jt-d,c.y+=Jt-f;const{weight:b=1.5,fromPoint:w,toPoint:x="arrow"}=i,D={left:`${0-Jt}px`,top:`${0-Jt}px`,width:`${m+2*Jt}px`,height:`${y+2*Jt}px`},I={"stroke-width":b,fill:"transparent",stroke:"currentColor","stroke-linejoin":"round","marker-start":w&&w!=="none"?`url(#marker-start-${s}-${w})`:void 0,"marker-end":x&&x!=="none"?`url(#marker-end-${s}-${x})`:void 0,d:iS(l,c,o,a,i.shape,b)},E={"stroke-width":b+5,"stroke-linejoin":"round",fill:"transparent",stroke:"currentColor",d:I.d,class:"opacity-0"},P={width:m+2*Jt,height:y+2*Jt},O=[];return i.lineStyle==="dashed"?I["stroke-dasharray"]=`${b*3} ${b*3}`:i.lineStyle==="dotted"&&(I["stroke-dasharray"]=`${b} ${b}`),w&&w!=="none"&&O.push(Ov(w,"start",s)),x&&x!=="none"&&O.push(Ov(x,"end",s)),{x:d,y:f,width:m,height:y,fromSide:o,toSide:a,fromPos:l,toPos:c,nodeStyle:D,svgPathProps:I,svgPathBackProps:E,svgProps:P,markers:O,padding:Jt}}class jv extends ae{constructor(){super(...arguments),this.state={},this._handleMouseHover=e=>{this.setState({hover:e.type==="mouseenter"})},this._onDelete=()=>{var e;(e=this.props.onDelete)==null||e.call(this,this.props)}}render(e,t){const{text:s,textSize:n,color:r,onDelete:o,weight:a=1.5,from:l,to:c}=e,{hover:h}=t,{x:d,y:f,padding:m,width:y,height:b,svgProps:w,markers:x,svgPathProps:D,svgPathBackProps:I,fromPos:E}=rS(e);return k("div",{className:K("kanban-link",h?"is-hover":""),style:{left:d,top:f,width:y,height:b,color:r,"--kanban-link-weight":a},"z-from":l,"z-to":c,onMouseEnter:o?this._handleMouseHover:void 0,onMouseLeave:o?this._handleMouseHover:void 0,children:[k("svg",{...w,xmlns:"http://www.w3.org/2000/svg",version:"1.1",children:[x.length?k("defs",{children:x.map(({path:P,id:O,...W})=>k("marker",{...W,id:O,children:k("path",{...P})},O))}):null,k("path",{...I}),k("path",{...D})]}),k("div",{className:"kanban-link-start-point",style:{left:E.x-m,top:E.y-m}}),o?k("div",{className:"kanban-link-delete-btn",children:k("button",{type:"button",className:"btn rounded-full size-sm square primary",onClick:this._onDelete,children:k("i",{className:"close"})})}):null,s?k("div",{className:"kanban-link-text",style:{fontSize:`${n||12}px`},children:s}):null]})}}const co=".kanban";class oS extends ae{constructor(){super(...arguments),this._ref=ye(),this.state={}}componentDidMount(){const e=this._ref.current,{container:t=".kanban"}=this.props,s=e.closest(t),n=v(s);this._container=s,this._multiKanban=n.find(".kanban").length>1;const r=".kanban-item,.kanban-link-editor-from";n.on(`mouseenter${co}`,r,o=>{if(this.state.dragPos)return;clearTimeout(this._leaveTimer);const a=v(o.target).closest(r),l=a.z("key");this.state.from===l||a.hasClass("is-dragging")||this.setState({from:l,fromKanban:this._multiKanban?a.closest(".kanban").z("key"):void 0,to:void 0,fromRect:this._getRect(a.children()[0]),dragPos:void 0})}).on(`mouseleave${co}`,r,()=>{this.state.dragPos||(clearTimeout(this._leaveTimer),this._leaveTimer=window.setTimeout(()=>{this._cancelHover(),this._leaveTimer=0},200))}).on(`dragstart${co}`,".kanban-item",()=>{this.state.dragPos||this._cancelHover()}).on(`laneColScroll${co}`,o=>{const{from:a}=this.state;a&&this.setState({fromRect:this._getRect(v(o.target).find(`.kanban-item[z-key="${a}"]`).children()[0])})}),this._moveable=new Ni(e,{selector:".kanban-link-editor-point",move:"none",onMoveStart:()=>{if(!this.state.from)return!1;n.addClass("is-adding-link")},onMove:o=>{const{top:a,left:l}=s.getBoundingClientRect(),c={left:o.clientX-l+s.scrollLeft,top:o.clientY-a+s.scrollTop};let h,d,f;const m=v(o.target).closest(r);m.length&&h!==this.state.from&&(h=m.attr("z-key"),f=this._multiKanban?m.closest(".kanban").z("key"):void 0,d=this._getRect(m.children()[0])),this.setState({dragPos:c,to:h,toKanban:f,toRect:d})},onMoveEnd:()=>{const{from:o,fromKanban:a,to:l,toKanban:c}=this.state,{onAddLink:h}=this.props;(o!==l||a!==c)&&h&&o!==void 0&&l!==void 0&&(h==null||h.call(this,{from:o,fromKanban:a,to:l,toKanban:c})),this._cancelHover(),n.removeClass("is-adding-link")}})}componentWillUnmount(){var t;const e=(t=this._ref.current)==null?void 0:t.closest(".kanban");e&&v(e).off(co),this._raf&&cancelAnimationFrame(this._raf)}_getRect(e){const t=e.getBoundingClientRect(),s=this._container,{top:n,left:r}=s.getBoundingClientRect();return{left:t.left-r+s.scrollLeft,top:t.top-n+s.scrollTop,width:t.width,height:t.height}}_cancelHover(){this.setState({from:void 0,to:void 0,fromRect:void 0,dragPos:void 0})}_renderLink(e){const{fromRect:t,toRect:s,from:n,to:r="",dragPos:o}=e;if(!t||!n||!o)return null;const a=s?{left:s.left,top:s.top,right:s.left+s.width,bottom:s.top+s.height}:{left:o.left,top:o.top,right:o.left,bottom:o.top};return k(jv,{from:n,to:r,lineStyle:"dotted",color:"var(--color-primary-500)",fromRect:{left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+t.height},toRect:a},"link")}render(e,t){const{from:s,fromRect:n,to:r,toRect:o}=t;let a,l;return s&&n&&(a=k("div",{className:"kanban-link-editor-from not-moveable","z-key":s,style:n,children:[k("div",{className:"kanban-link-editor-point is-left"}),k("div",{className:"kanban-link-editor-point is-top"}),k("div",{className:"kanban-link-editor-point is-right"}),k("div",{className:"kanban-link-editor-point is-bottom"})]})),r&&o&&(l=k("div",{className:"kanban-link-editor-to","z-key":r,style:o})),k("div",{className:K("kanban-link-editor"),ref:this._ref,children:[a,l,this._renderLink(t)]})}}const Mu=".kanban";class Bv extends ae{constructor(){super(...arguments),this._ref=ye(),this._watchSet=new Set,this.state={layout:{},scrollTop:0,scrollLeft:0}}componentDidMount(){var n;const{container:e=".kanban"}=this.props,t=(n=this._ref.current)==null?void 0:n.closest(e),s=v(t);this._multiKanban=s.find(".kanban").length>1,s.on(`laneColResize${Mu} laneColScroll${Mu}`,()=>{this._tryUpdateLayout()}),this._container=t,this._tryUpdateLayout()}componentWillUnmount(){const e=this._container;e&&v(e).off(Mu),this._raf&&cancelAnimationFrame(this._raf)}componentDidUpdate(e){(e.links!==this.props.links||e.filters!==this.props.filters)&&this._tryUpdateLayout()}_tryUpdateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._updateLayout(),this._raf=0})}_updateLayout(){const e=[...this._watchSet],t=this._container,s=v(t),{top:n,left:r}=t.getBoundingClientRect(),o=t.scrollTop-n,a=t.scrollLeft-r,l={};e.forEach(c=>{const[h,d]=c.split("_"),f=s.find(`${this._multiKanban?`.kanban[z-key="${h}"] `:""}.kanban-item[z-key="${d}"]`).children()[0];if(f&&Tr(f,{container:".kanban-lane-col"})){const{top:m,left:y,bottom:b,right:w}=f.getBoundingClientRect();l[c]={top:m+o,left:y+a,bottom:b+o,right:w+a}}}),this.setState({layout:l})}_renderLink(e){const{layout:t}=this.state,{from:s,fromKanban:n="",to:r,toKanban:o=""}=e,a=`${n}_${s}`,l=`${o}_${r}`,c=t[a],h=t[l];return this._watchSet.add(a),this._watchSet.add(l),!c||!h?null:k(jv,{...e,fromRect:c,toRect:h,onDelete:this.props.onDeleteLink},`${s}-${r}`)}_renderLinks(e){const{links:t,filters:s}=e,n=new Set(s),r=o=>{const{from:a,to:l,fromKanban:c="",toKanban:h=""}=o;return this._multiKanban?n.has(`${c}_${a}`)||n.has(`${h}_${l}`)||n.has(c)||n.has(h)||n.has(Tn(o)):n.has(a)||n.has(l)||n.has(`${a}-${l}`)};return t.reduce((o,a)=>{if(!s||r(a)){const l=this._renderLink(a);l&&o.push(l)}return o},[])}_renderEditor(e){const{editLinks:t,onAddLink:s,container:n}=e;return t?k(oS,{container:n,onAddLink:s},"editor"):null}render(e){return this._watchSet.clear(),k("div",{className:"kanban-links",ref:this._ref,children:[this._renderLinks(e),this._renderEditor(e)]})}}function aS(i,e,t){if(!i||!i.length)return[];const{getCol:s,colProps:n,itemCountPerRow:r,itemGap:o}=e;let a=!1;const l=[],c=new Map;return i=i.reduce((h,d,f)=>{if(d=Le({itemGap:o,itemCountPerRow:r},n,d),s){const m=s.call(this,d);m!==!1&&(d=m||d)}return d.deleted||(typeof d.order=="number"?a=!0:d.order=f,typeof d.name!="string"&&(d.name=String(d.name)),t==null||t.call(this,d),d.parentName!==void 0?(d.parentName=String(d.parentName),l.push(d)):(c.set(d.name,d),h.push(d))),h},[]),l.forEach(h=>{const d=c.get(h.parentName);d&&(d.subCols=sn(d.subCols,[h],"name"))}),a&&(i.sort(ho),[...c.values()].forEach(h=>{h.subCols&&h.subCols.sort(ho)})),i}function lS(i,e,t){if(!i||!i.length)return[];const{getLane:s,laneProps:n}=e;let r=!1;return i=i.reduce((o,a,l)=>{if(n&&(a=Le({},n,a)),s){const c=s.call(this,a);c!==!1&&(a=c||a)}return a.deleted||(typeof a.order=="number"?r=!0:a.order=l,a.color===void 0&&(a.color=`hsl(${43*rh(a.name)%360}deg 40% 50%)`),typeof a.name!="string"&&(a.name=String(a.name)),t==null||t.call(this,a),o.push(a)),o},[]),r&&i.sort(ho),i}function Hv(i,e,t,s,n){if(!(i!=null&&i.length))return[];const{itemProps:r,getItem:o}=s;let a=!1;return i=i.reduce((l,c)=>{r&&(c=Le({},r,c));const h=(o==null?void 0:o.call(this,{col:t.name,lane:e.name,item:c,laneInfo:e,colInfo:t}))??c;return h!==!1&&!h.deleted&&(typeof h.order=="number"?a=!0:h.order=l.length-1,l.push(h),n==null||n.call(this,h)),l},[]),a&&i.sort(ho),i}function ho(i,e){return i.order-e.order}function sn(i,e,t="key"){if(!i)return e?[...e]:[];const s=[...i];if(e){let n=0;const r=s.reduce((o,a,l)=>(o.set(String(a[t]??l),l),n=Math.max(a.order??l,n),o),new Map);e.forEach(o=>{const a=String(o[t]);r.has(a)?s[r.get(a)]={...s[r.get(a)],...o}:s.push({order:n++,...o})})}return s}function Uv(i,e){return Array.isArray(i)?i.map(t=>({...t,[e]:String(t[e])})):Object.keys(i).reduce((t,s)=>{const n=i[s];return Object.keys(n).forEach(r=>{t.push(...(n[r]||[]).map(o=>({...o,lane:s,col:r,[e]:String(o[e])})))}),t},[])}function Vv(i,e){const{items:t=[],...s}=i;return{items:Uv(t,e),...s}}function Nu(i,e,t){var a;const s=sn(i.lanes,e.lanes,"name"),n=sn(i.cols,e.cols,"name"),r=sn(i.links,(a=e.links)==null?void 0:a.map(l=>(l[t]===void 0&&(l[t]=Tn(l)),l)),t),o=sn(i.items,Uv(e.items||[],t),t);return{lanes:s,cols:n,items:o,links:r}}let uo=class extends Ke{constructor(){super(...arguments),this._ref=ye(),this._raf=0,this._data=new Hn(this._getData.bind(this),()=>{const{getCol:e,colProps:t,itemCountPerRow:s,itemGap:n,getLane:r,laneProps:o,itemProps:a,getItem:l,getLink:c,linkProps:h,responsive:d}=this.props;return[this._kanbanData,e,t,s,n,r,o,a,l,h,c,d]}),this._kanbanData=new Hn(()=>{const{itemKey:e,props:t}=this,{data:s}=t,{data:n,changes:r}=this.state,o=(n||ph(s)?n:Vv(s,e))||{};return r?Nu(o,r,e):o},()=>{const{data:e,changes:t,selected:s}=this.state;return[e,t,s,this.props.data]}),this._handleGlobalClick=e=>{v(e.target).closest(".kanban-item").length||this.select([])},this._onAddLink=async e=>{const{onAddLink:t}=this.props;e[this.itemKey]=Tn(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)},this._handleMouseMove=e=>{this._hoverTimer&&clearTimeout(this._hoverTimer);const t=this._getElementInfo(e.target),s=(t==null?void 0:t.type)==="item"?t.key:void 0;this._hoverTimer=window.setTimeout(()=>{s!==this.state.hover&&this.setState({hover:s},()=>{v(this._ref.current).trigger("kanbanItemHover",{kanban:this.props.key,hover:s})}),this._hoverTimer=0},!s&&this.state.hover?0:20)},this._handleClick=e=>{if(e.target.closest("a,button"))return;const{onClickItem:t,selectable:s}=this.props,n=this._getElementInfo(e.target);t&&(n==null?void 0:n.type)==="item"&&t.call(this,e,n)===!1||s&&(n==null?void 0:n.type)==="item"&&this.select(n.key,!0)}}get data(){return this._data.cache}get itemKey(){return this.props.itemKey||"id"}componentDidMount(){this._afterRender(!0),this.tryLoad(),this._initDraggable();const{responsive:e,selectable:t}=this.props,s=this._ref.current;if(s&&e){const n=new ResizeObserver(this.updateLayout.bind(this));v(typeof e!="boolean"?e:s.closest(".kanban-list")||s.parentElement).each((o,a)=>{n.observe(a)}),this._rob=n,this.state.containerWidth||this.updateLayout()}t&&v(document).on("click.kanban",this._handleGlobalClick)}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e,t,s;(e=this.props.beforeDestroy)==null||e.call(this),(t=this._draggable)==null||t.destroy(),(s=this._rob)==null||s.disconnect(),this.props.selectable&&v(document).off("click.kanban",this._handleGlobalClick)}getDefaultState(e){return{loading:!1,selected:(e||this.props).defaultSelected,data:void 0,changes:void 0,loadFailed:void 0}}load(){const{data:e,onLoad:t,onLoadFail:s}=this.props;this._loadedSetting=e,this.setState({loading:!0},async()=>{const n={loading:!1};try{const r=Vv(await Ne(e,[this],{throws:!0}),this.itemKey);n.data=(t==null?void 0:t.call(this,r))||r}catch(r){n.loadFailed=(typeof s=="function"?s.call(this,r):s)||String(r)}this.setState(n)})}updateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0;const e=this._ref.current;if(e){const{responsive:t,laneNameWidth:s=20}=this.props,n=v(typeof t!="boolean"?t:e.closest(".kanban-list")||e.parentElement),r=n[0];let o=n.width()-s-(r.offsetWidth-r.clientWidth);const a=e.closest(".kanban-region");a&&(o-=a.clientWidth-v(a).width()),this.setState({containerWidth:o})}})}tryLoad(){const{loading:e}=this.state,{data:t}=this.props;e||!t||!ph(t)||t===this._loadedSetting||this.load()}getCol(e){return this.data.colMap.get(String(e))}getLane(e){return e=String(e),this.data.lanes.find(t=>t.name===e)}getItem(e){return this.data.map.get(String(e))}update(e){return this.changeState(t=>({changes:Nu({...t.changes},e,this.itemKey)}))}createSnap(){return{date:Date.now(),kanban:this,data:v.extend(!0,{},this._data),restore(){this.kanban.changeState({changes:this.data})}}}addItem(e,t,s){return this.updateItem(e,t,s)}updateItem(e,t,s){const n=Array.isArray(e)?e:[e];return this.update({items:t||s?n.map(r=>({...r,lane:t??r.lane,col:s??r.col})):n})}deleteItem(e){return this.updateItem(Array.isArray(e)?e.map(t=>({[this.props.itemKey||"id"]:t,deleted:!0})):{[this.itemKey]:e,deleted:!0})}updateLane(e){return this.update({lanes:Array.isArray(e)?e:[e]})}addLane(e){return this.updateLane(e)}deleteLane(e){return this.updateLane(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateCol(e){return this.update({cols:Array.isArray(e)?e:[e]})}addCol(e){return this.updateCol(e)}deleteCol(e){return this.updateCol(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateLink(e,t){return this.update({links:(Array.isArray(e)?e:[e]).map(s=>({deleted:!1,...s,...t,[this.itemKey]:Tn(s)}))})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}select(e,t){let s=Array.isArray(e)?e:e?[e]:[],n=this.state.selected||[];const{onSelect:r}=this.props;return this.changeState(o=>{if(n=o.selected||[],t){const a=new Set(n),l=new Set;return s.forEach(c=>{a.has(c)?a.delete(c):l.add(c)}),s=[...a,...l],{selected:s}}return{selected:s}},()=>{r==null||r(s,n),v(this._ref.current).trigger("kanbanItemSelected",{kanban:this.props.key,selected:s,oldSelected:n})})}_getElementInfo(e){const t=v(e),s=t.closest(".kanban-item");if(s.length){const a=s.attr("z-key");if(a){const l=this.getItem(a);if(l)return{type:"item",key:a,element:e,item:l,lane:l.lane,col:l.col}}}if(t.closest(".kanban-new-item").length)return{type:"newItem",element:e};const r=t.closest(".kanban-header-col,.kanban-lane-col");if(r.length)return{type:"col",element:e,col:r.attr("z-col"),lane:r.attr("z-lane")};const o=t.closest(".kanban-lane").attr("z-lane");if(o!==void 0)return{type:"lane",element:e,lane:o}}_getDropInfo(e,t,s){const n=this._getElementInfo(t);if(!n)return;const r=this._getElementInfo(s);if(!r||r.element.closest(".kanban")!==this.element)return;let o;if(n.type==="item"&&r.type==="col")o="inside";else{const a=s.getBoundingClientRect();n.type==="col"?o=e.clientX<a.left+a.width/2?"before":"after":o=e.clientY<a.top+a.height/2?"before":"after"}return{side:o,event:e,drag:n,drop:r}}_getDropChanges(e){const{drag:t,drop:s}=e,n=this.data,r={},{itemKey:o}=this,a={list:[],lane:s.lane,col:s.col};if(t.type==="item"){const l=t.item,c=n.items[s.lane][s.col],h=[...c],d={[o]:l[o],order:l.order},f=s.col===l.col,m=s.lane===l.lane;if(f&&m&&l[o]===s.item[o])return{changes:r,data:a};f||(d.col=s.col),m||(d.lane=s.lane);let y=!1;if(s.type==="col"&&(!m||!f))h.push(d),y=!0;else if(s.type==="item"){const b=s.item,w=s.col!==l.col||s.lane!==l.lane?-1:h.findIndex(D=>D[o]===l[o]);w>=0&&h.splice(w,1);const x=h.findIndex(D=>D[o]===b[o]);h.splice(e.side==="before"?x:x+1,0,d),y=!0}if(y){r.items=[];let b=-1;h.forEach((w,x)=>{const D=Math.max(0,b+1,w.order??x),I=c[x];b=D,(I!==w||D!==I.order)&&(w={...w,order:D}),w!==I&&r.items.push(w),a.list.push(w[o])})}}else if(t.type==="newItem"){const{onDropNewItem:l}=this.props;let c;if(l?c=l.call(this,e):(c=v(t.element).data(),c!=null&&c.item&&(c=c.item)),c={lane:s.lane,col:s.col,...c},c!=null&&c[o]){const d=[...n.items[s.lane][s.col]];d.push(c),r.items=d,a.list.push(c[o])}}return{changes:r,data:a}}_initDraggable(){const{draggable:e}=this.props,t=this._ref.current;if(!e||!t)return;const{dragTypes:s=["item","newItem"],onDragStart:n,onDrop:r,canDrop:o,dropRules:a}=this.props,l=typeof s=="string"?s.split(","):s,c={item:".kanban-item",lane:".kanban-lane-name",col:".kanban-header-col",newItem:".kanban-new-item"},h=typeof e=="object"?e:{},d=(m,y)=>{v(m).attr({"z-drag-type":y?y.drag.type:null,"z-drop-type":y?y.drop.type:null,"z-drop-side":y?y.side:null})},f={...h,selector:h.selector||l.map(m=>c[m]||"").filter(Boolean).join(","),target:h.target||(m=>{const y=this._getElementInfo(m);if(!y)return;const b={lane:".kanban-lane",col:".kanban-header-col",item:".kanban-item,.kanban-items",newItem:".kanban-item,.kanban-items"}[y.type];return v(t).find(b)}),canDrop:h.canDrop||o||a?(m,y,b)=>{const w=this._getElementInfo(y);if(!w)return!1;const x=this._getElementInfo(b);if(!x||x.element.closest(".kanban")!==this.element)return!1;if(w.type==="item"&&a){const D=w.col,I=x.col,E=w.lane,P=x.lane,O=a[`${E}:${D}`]??a[D];return typeof O=="boolean"?O:!O||O.includes(I)||O.includes(`${P}:${I}`)||O.includes(`${P}:`)}if(o)return o.call(this,w,x)}:void 0,onDragStart:(m,y)=>{var w;const b=this._getElementInfo(y);return b?n?n.call(this,{event:m,drag:b}):(w=h.onDragStart)==null?void 0:w.call(this,m,y):!1},onDragOver:(m,y,b)=>{const w=this._getDropInfo(m,y,b);w&&d(b,w)},onDragLeave:(m,y,b)=>{d(b)},onDrop:(m,y,b)=>{var x;d(b);const w=this._getDropInfo(m,y,b);if(!w)return!1;if(r){const{changes:D,data:I}=this._getDropChanges(w);if(Object.keys(D).length){w.data=I;const E=this.createSnap();r.call(this,D,w,E.restore)!==!1&&this.update(D)}}return(x=h.onDrop)==null?void 0:x.call(this,m,y,b)}};this._draggable=new Lr(t,f)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_getData(){const{itemKey:e,props:t}=this,s=this._kanbanData.value;let n=!1;const{items:r=[]}=s,o={},a=new Map,l=aS.call(this,s.cols,t,w=>{w.parentName!==void 0&&(n=!0),a.set(w.name,w)}),c=lS.call(this,s.lanes,t,w=>{o[w.name]=l.reduce((x,D)=>(D.subCols?D.subCols.forEach(I=>{x[I.name]=[]}):x[D.name]=[],x),{})}),h=new Set,d=r.reduce((w,x)=>{if(x.deleted)return h.add(x[e]),w;w.set(x[e],x);const D=o[x.lane];if(D){const I=D[x.col];I&&I.push(x)}return w},new Map),{selected:f=[]}=this.state,m=new Set(f),y=w=>{w.selected=m.has(w[e])};c.forEach(w=>{const x=o[w.name];x&&l.forEach(D=>{var I;x[D.name]=Hv.call(this,x[D.name],w,D,t,y),(I=D.subCols)==null||I.forEach(E=>{x[E.name]=Hv.call(this,x[E.name],w,E,t,y)})})});let{links:b=[]}=s;return b=b.reduce((w,x)=>{var D;if(!x.deleted&&d.has(x.from)&&d.has(x.to)&&!h.has(x.from)&&!h.has(x.to)){x[e]===void 0&&(x[e]=Tn(x));const I=((D=t.getLink)==null?void 0:D.call(this,x))??x;I!==!1&&!I.deleted&&w.push(I)}return w},[]),{cols:l,lanes:c,items:o,map:d,colMap:a,links:b,hasSubCols:n}}_layoutCols(e,t){const{containerWidth:s=0}=this.state,{colsGap:n=8,minColWidth:r=150,maxColWidth:o=600,colWidth:a=200}=t,l=[];let c=0;const h=d=>{const{minWidth:f=r,maxWidth:m=o}=d;let{width:y=a}=d;typeof y=="function"&&(y=y.call(this,d));const b=y==="auto";if(b)y=f;else{const[w,x]=dn(y);x==="%"?y=s*w/100:y=w}return y=Math.min(m,Math.max(f,y)),c+=y+(c?n:0),d={...d,width:y,maxWidth:m,minWidth:f},b&&l.push(d),d};if(e=e.map(d=>d.subCols?{...d,subCols:d.subCols.map(h)}:h(d)),l.length&&c<s){const d=Math.floor((s-c)/l.length);l.forEach(f=>{f.width=Math.min(f.maxWidth,Math.max(f.minWidth,f.width+d))})}return e}_layoutLanes(e,t){const{laneHeight:s,maxLaneHeight:n,minLaneHeight:r}=t;return!s&&!n&&!r?e:e.map(o=>({height:typeof s=="function"?s.call(this,o):s,maxHeight:n,minHeight:r,...o}))}_getClassName(e){return["kanban",e.className,e.sticky?"kanban-sticky":"",this.data.hasSubCols?"has-sub-cols":""]}_getProps(e){const{laneNameWidth:t,colsGap:s,lanesGap:n,selectable:r,onClickItem:o,showLinkOnHover:a}=e;return Le(super._getProps(e),{ref:this._ref,style:{"--kanban-lane-name-width":t,"--kanban-cols-gap":je(s),"--kanban-lanes-gap":je(n)},onClick:o||r?this._handleClick:void 0,onMouseMove:a?this._handleMouseMove:void 0})}_renderLinks(e){const{links:t=[]}=this.data,{editLinks:s}=e;if(!s&&!t.length)return;const{showLinkOnHover:n,showLinkOnSelected:r}=e;let o;if(r||n){o=[];const{selected:a,hover:l}=this.state;r&&a&&o.push(...a),n&&l&&o.push(l),o=[...new Set(o)]}return k(Bv,{links:t,filters:o,editLinks:s,onDeleteLink:s?this._onDeleteLink:void 0,onAddLink:s?this._onAddLink:void 0},"links")}_getChildren(e){const t=this._data.value,{cols:s,lanes:n,items:r}=t,{laneNameWidth:o}=e,a=this._layoutCols(s,e),l=this._layoutLanes(n,e);return[k(Jk,{cols:a},"header"),k(Qk,{itemRender:e.itemRender,getLaneCol:e.getLaneCol,cols:a,lanes:l,items:r,hideLaneName:o===0},"body"),this._renderLinks(e),e.children]}};uo.defaultProps={draggable:!0,sticky:!0,responsive:!0,itemKey:"id",colWidth:200,colsGap:8},uo.customProps=["onDrop","onDragStart"];class Wv extends Ke{constructor(){super(...arguments),this._kanbanRefs=new Map,this._needUpdateData=new Map,this._handleClickHeading=e=>{v(e.target).closest("a,.btn,button").not(".kanban-region-toggle").length||this.setState(t=>({collapsed:!t.collapsed}))}}componentDidUpdate(){if(this.state.collapsed)return;const e=this._needUpdateData;[...e.keys()].forEach(t=>{const s=this.getKanban(t);s&&(s.update(e.get(t)),e.delete(t))})}getDefaultState(e){return{collapsed:(e||this.props).collapsed,heading:void 0,items:void 0}}resetState(e,t){this._kanbanRefs.forEach(s=>{var n;return(n=s.current)==null?void 0:n.resetState()}),super.resetState(e,t)}getKanban(e){var t;return(t=this._kanbanRefs.get(String(e)))==null?void 0:t.current}toggle(e){this.setState(t=>({collapsed:e===void 0?!t.collapsed:!e}))}update(e){const{items:t}=e;return t&&(e={...e},e.items=t.map((s,n)=>{const r=String(s.key||n);return s.deleted?{key:r,deleted:!0}:(s.data&&typeof s.data=="object"&&this.getKanban(r)&&(this._needUpdateKanban(r,s.data),s={...s},delete s.data),s)})),new Promise(s=>{this.setState(e.items?n=>({...e,items:sn(n.items,e.items)}):e,s)})}_needUpdateKanban(e,t){const s=this._needUpdateData,n=s.get(e),{kanbanItemKey:r="key"}=this.props;s.set(e,Nu(n||{},t,r))}_buildItems(e){const{items:t=[],kanbanProps:s,kanbanItemKey:n="key"}=e;let{items:r}=this.state;r?(r=sn(t,r,n).filter(c=>!c.deleted),r.sort(ho)):r=t;const o=this._kanbanRefs,a=new Set(o.keys()),l=r.map((c,h)=>{if(c.deleted)return null;const d=Le({className:"kanban-region-item",key:h},typeof s=="function"?s.call(this,c,h):s,c),f=String(d.key);let m=o.get(f);return m||(m=ye(),o.set(f,m)),d.ref=m,a.delete(f),k(uo,{"z-key":f,...d})});return a.forEach(c=>{o.delete(c)}),l}_getClassName(e){return["kanban-region",e.className,this.state.collapsed?"is-collapsed":"is-expanded",e.heading?"has-heading":""]}_getChildren(e){const{heading:t,toggleFromHeading:s}=e,{collapsed:n,heading:r}=this.state,o=Le({className:"kanban-heading",onClick:s?this._handleClickHeading:void 0},typeof t=="function"?t.call(this):t,r);return[t&&k(Is,{...o},"heading"),n?null:this._buildItems(e)]}}const Eu=".kanban";let Kv=class extends Ke{constructor(){super(...arguments),this.state={},this._ref=ye(),this._kanbanRefs=new Map,this._onAddLink=async e=>{const{onAddLink:t,linkItemKey:s}=this.props;e[s]=Tn(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)}}componentDidMount(){const e=this._ref.current;if(e){const{moveable:t,responsive:s,showLinkOnSelected:n,showLinkOnHover:r}=this.props;if(t&&(this._moveable=new Ni(e,v.extend({selector:"self",move:"scroll",onMoveStart:(o,a)=>{const{bottom:l,right:c}=a.getBoundingClientRect();return o.clientY<l&&o.clientY>l-20||o.clientX<c&&o.clientX>c-20?!1:!v(o.target).closest("a,input,.btn,.state,.kanban-item,.not-moveable").length}},typeof t=="object"?t:null))),n&&v(e).on(`kanbanItemSelected${Eu}`,(o,a)=>{this.setState(l=>({selected:{...l.selected,[a.kanban]:a.selected}}))}),r&&v(e).on(`kanbanItemHover${Eu}`,(o,{kanban:a,hover:l})=>{this.setState({hover:l===void 0?l:`${a}_${l}`})}),s){const o=new ResizeObserver(this._tryUpdateLayout.bind(this));(typeof s!="boolean"?v(s):v(e).parent()).each((l,c)=>{o.observe(c)}),this._rob=o}}}componentWillUnmount(){var t,s;(t=this._moveable)==null||t.destroy(),(s=this._rob)==null||s.disconnect();const e=this._ref.current;e&&v(e).off(Eu)}getDefaultState(e){return{linkChanges:void 0}}resetState(e,t){this._kanbanRefs.forEach(s=>{var n;(n=s.current)==null||n.resetState()}),super.resetState(e,t)}getKanban(e){const t=String(e),s=this._kanbanRefs;if(s.has(t))return s.get(t).current;let n=null;const r=Array.from(s.values());for(const o of r){const a=o.current;if(a instanceof Wv&&(n=a.getKanban(e),n))break}return n||null}updateKanban(e,t){const s=this.getKanban(e);return s?s.update(t):Promise.reject(new Error(`[ZUI] Kanban not found: ${e}`))}updateLayout(){const e=this._ref.current;if(!e)return;const t=v(e),s=t.width(),n=t.height();this.setState({width:s,height:n})}updateLink(e,t){return this.changeState(s=>{let n=Array.isArray(e)?e:[e];return t&&(n=n.map(r=>({...r,...t}))),{linkChanges:sn(s.linkChanges,n,this.props.linkItemKey)}})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}_tryUpdateLayout(){this._layoutTimer&&cancelAnimationFrame(this._layoutTimer),this._layoutTimer=requestAnimationFrame(()=>{this.updateLayout(),this._layoutTimer=0})}_getClassName(e){return["kanban-list",e.className,e.sticky?"has-sticky":"",e.moveable?"is-moveable":"",e.scrollbarHover?"scrollbar-hover":""]}_getProps(e){const{width:t,height:s}=e,n=typeof t=="function"?t.call(this):t,r=typeof s=="function"?s.call(this):s,{width:o,height:a}=this.state??{};return Le(super._getProps(e),{ref:this._ref,style:{width:n,height:r,"--kanban-list-width":`${o||t}px`,"--kanban-list-height":`${a||s}px`}})}_getLinks(e){const{linkChanges:t=[]}=this.state,{links:s=[],getLink:n,linkItemKey:r}=e;return sn(s,t,this.props.linkItemKey).reduce((o,a)=>{const l=n==null?void 0:n.call(this,a);return l!==!1&&(a=l||a,a.deleted||(a[r]||(a[r]=Tn(a)),o.push(a))),o},[])}_renderLinks(e){const t=this._getLinks(e),{editLinks:s}=e;if(!s&&!t.length)return;const{showLinkOnHover:n,showLinkOnSelected:r}=e;let o;if(t.length&&(r||n)){o=[];const{selected:a={},hover:l}=this.state;r&&a&&Object.keys(a).forEach(c=>{const h=a[c];h.length&&o.push(...h.map(d=>`${c}_${d}`))}),n&&l&&o.push(l),o=[...new Set(o)]}return k(Bv,{container:".kanban-list",links:t,filters:o,editLinks:s,onDeleteLink:s?this._onDeleteLink:void 0,onAddLink:s?this._onAddLink:void 0},"links")}_getChildren(e){const{items:t=[],kanbanProps:s,showLinkOnSelected:n,showLinkOnHover:r,selectable:o,editLinks:a}=e,l=this._kanbanRefs,c=new Set(l.keys()),h=[...t.map((f,m)=>{s&&(f=typeof s=="function"?s.call(this,f,m):v.extend({},s,f));const y=String(f.key??m);let b=l.get(y);b||(b=ye(),l.set(y,b)),c.delete(y);const w=f.heading!==void 0||f.items;return(n||r||o)&&(w?f.kanbanProps={showLinkOnSelected:n,showLinkOnHover:r,selectable:o,...f.kanbanProps}:f={showLinkOnSelected:n,showLinkOnHover:r,selectable:o,...f}),a&&(w?f.items=(f.items||[]).map(D=>({...D,editLinks:!1})):f={...f,editLinks:!1}),k(w?Wv:uo,{ref:b,sticky:e.sticky,...f,"z-key":y},y)}),e.children];c.forEach(f=>{l.delete(f)});const d=this._renderLinks(e);return d&&h.push(d),h}};Kv.defaultProps={moveable:!0,sticky:!0,responsive:!0,scrollbarHover:!0,linkItemKey:"id"};class fo extends be{}fo.NAME="Kanban",fo.replace=!0,fo.Component=uo,fo.register();class po extends be{update(e,t){if(e=Array.isArray(e)?e:[e],t)return this.render({items:e});const s=this.options.items||[],n=new Map(s.map((o,a)=>[o.key,a])),r=[...s];return e.forEach(o=>{if(n.has(o.key)){const a=n.get(o.key);r[a]={...s[a],...o}}else r.push(o)}),this.render({items:r.filter(o=>!o.deleted)})}}po.NAME="KanbanList",po.replace=!0,po.Component=Kv,po.register();const XI="",QI="",eM="",tM="",sM="",nM="",iM="",rM="",oM="",aM="",cS="nav",Au='[data-toggle="tab"],[zui-toggle="tab"]',hS="active";class mo extends Ze{constructor(){super(...arguments),this._timer=0}active(e){const t=this.$element,s=t.find(Au);let n=e?v(e).closest(Au):s.filter(`.${hS}`);if(!n.length&&(n=t.find(Au).first(),!n.length))return;s.removeClass("active"),n.addClass("active");let r=n.attr("href")||n.data("target");if(!r){const c=n.attr("zui-toggle-tab");r=ln(c).target}const o=n.data("name")||r,a=t.closest(".tabs"),l=a.length?a.find(r):v(r);l.length&&(l.parent().children(".tab-pane").removeClass("active in"),l.addClass("active").trigger("show",[o]),this.emit("show",o),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{l.addClass("in").trigger("shown",[o]),this.emit("shown",o),this._timer=0},10))}}mo.NAME="Tabs",mo.toggle={name:"tab",handler(i,e){const t=v(i),s=t.closest(`.${cS}`);s.length&&mo.ensure(s,e).active(t)}},mo.register();function dS(i){const[e,t]=i.split(":"),s=e[0]==="-"?{name:e.substring(1),disabled:!0}:{name:e};return t!=null&&t.length&&(s.type="dropdown",s.items=t.split(",").reduce((n,r)=>(r=r.trim(),r.length&&n.push(r[0]==="-"?{name:r.substring(1),disabled:!0}:{name:r}),n),[])),s}const uS=(i,e)=>{var n;i.url&&(i.url=$e(i.url,e.row.data));const t={row:e.row.id,col:e.col.name},s=((n=i.dropdown)==null?void 0:n.items)||i.items;return s&&s.forEach(r=>(r.url&&(r.url=$e(r.url,e.row.data)),r.data=t,r)),i.data=t,i},qv=i=>i?(typeof i=="string"&&(i=i.split("|")),i.map(e=>typeof e=="string"?dS(e):e).filter(Boolean)):[],fS=et({name:"actions",colTypes:{actions:{onRenderCell(i,e){var h;const{row:t,col:s}=e,n=qv(((h=t.data)==null?void 0:h[s.name])||s.setting.actions);if(!n.length)return i;const{actionsSetting:r,actionsMap:o,actionsCreator:a=this.options.actionsCreator,actionItemCreator:l=this.options.actionItemCreator||uS}=s.setting,c={items:(a==null?void 0:a(e))??n.map(d=>{const{name:f,...m}=d;if(o&&f){Object.assign(m,o[f],{...m});const{buildProps:b}=m;typeof b=="function"&&(delete m.buildProps,Object.assign(m,b(i,e)))}const{items:y}=m;if(m.disabled&&(delete m.url,delete m["data-toggle"]),y&&m.type==="dropdown"){const{dropdown:b={placement:"bottom-end"}}=m;b.menu={className:"menu-dtable-actions"},b.items=y.map(w=>{const x=typeof w=="string"?{name:w}:{...w};return x.name&&o&&o[x.name]&&Object.assign(x,o[x.name],{...x}),x.disabled?(delete x.url,delete x["data-toggle"]):x.url&&(x.url=$e(x.url,t.data)),x}),m.dropdown=b,delete m.items}return l?l(m,e):m}),btnProps:{btnType:"ghost",size:"sm",className:"text-primary"},...r};return i[0]=k(Be,{...c}),i}}},beforeLayout(i){!Array.isArray(i.data)||!i.data.length||i.cols.forEach((e,t)=>{if(e.type!=="actions"||e.width)return;const{actionsMap:s={}}=e,r=qv(i.data[0][e.name]).reduce((o,a)=>{const l=a.name?s[a.name]:null;return l&&l.type==="dropdown"&&l.caret&&!l.text?o+16:o+24},24);i.cols[t]={...e,width:r}})}}),pS=et({name:"toolbar",footer:{toolbar(){const{footToolbar:i,showToolbarOnChecked:e}=this.options;return e&&!this.getChecks().length?[]:[i?Be.render(i,[this],{gap:2}):null]}}}),hM="",Gv=function(i,e){var n,r;const{col:t}=e,{sortColFrom:s}=this.state;if(s){s.name===t.name&&i.push({outer:!0,className:"is-sorting-from-col"});const o=(r=(n=this.data.sortColInfo)==null?void 0:n.colOffsetMap)==null?void 0:r[t.name];typeof o=="number"&&i.push({outer:!0,className:"is-sorting-col-move",style:{left:t.left+o}})}return i},mS=et({name:"sort-col",when:i=>!!i.sortCol,plugins:[lo,Du],resetState:!0,state(){return{colOrders:{},sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0}},events:{mousedown(i){var r;if(this.data.disableSortCol)return;const e=this.getPointerInfo(i);if(!e||e.rowID!=="HEADER")return;const t=this.getColInfo(e.colName);if(!t||((r=this.options.onSortColStart)==null?void 0:r.call(this,t,i))===!1)return;v(i.target).closest("a,button,img").attr("draggable","false").length&&i.preventDefault(),i.preventDefault();const s=i.clientX,{cellElement:n}=e;this.data.sortColInfo={from:t,element:n,offset:s-n.getBoundingClientRect().left,startMouseX:s,lastMouseX:s},v(n).zuiCall("ContextMenu.hide")},document_mouseup(i){var s;const{sortColInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingColState(i);if(t){let n,r;const{from:o,to:a,side:l}=t;if(a){if(o.name===a.name)n={};else if(l){const c=this.layout.cols[o.side].list,h=o.sideIndex,d=a.sideIndex,f=c.splice(h,1);c.splice(d+(l==="after"?1:0),0,f[0]),n={},r=[],c.forEach(({name:m},y)=>{n[m]=y+1,r.push(m)}),((s=this.options.onSortCol)==null?void 0:s.call(this,o,a,l,r))===!1&&(n=void 0,r=void 0)}Math.abs(e.lastMouseX-e.startMouseX)>4&&this.ignoreNextClick()}this.disableAnimation(),this.update({dirtyType:"layout",state:v.extend({sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0},n?{colOrders:{...this.state.colOrders,...n}}:null)},()=>{var c;(c=this.options.onSortColEnd)==null||c.call(this,o,a,l,r)})}this.data.sortColInfo=void 0},document_mousemovesmooth(i){const{sortColInfo:e}=this.data;if(!e)return;const t=this.getSortingColState(i);t&&(e.state||this.startScrollToMouse({side:"x"}),e.lastMouseX=i.clientX,e.state=t,this.setState({sortColFrom:t.from,sortingColPos:t.pos,sortingColTo:t.to,sortingColSide:t.side}))}},methods:{getSortingColState(i){var w;const{disableSortCol:e,sortColInfo:t}=this.data;if(e||!t)return;const{from:s,element:n}=t,o=v(n).closest(".dtable-cells")[0].getBoundingClientRect(),a=i.clientX-o.left,{cols:l,scrollLeft:c}=this.layout,h=l[s.side].list;if(h.length<=1)return t.state;const d=c+a,f=h.find(x=>x.visible&&x.left<=d&&x.left+x.width>d);if(!f)return t.state;const m=d<f.left+f.width/2?"before":"after";return s.side===f.side&&((w=this.options.canSortColTo)==null?void 0:w.call(this,s,f,m))!==!1?{from:s,pos:a+c,to:f,side:s.name!==f.name?m:void 0}:{from:s,pos:a,to:void 0,side:void 0}}},onAddCol(i){const{colOrders:e={}}=this.state,t=e[i.name];t!==void 0&&(i.order=t)},beforeRender(i){const{sortColFrom:e,sortingColTo:t,sortingColSide:s}=this.state;if(e&&t){i.className=K(i.className,"has-sorting-col");const n=[...i.cols[e.side].list],r=e.sideIndex,o=t.sideIndex,a=n.splice(r,1);n.splice(o+(s==="after"?1:0),0,a[0]);let l=0;const c={};n.forEach(h=>{const d=l-h.left;d&&(c[h.name]=d),l+=h.realWidth}),this.data.sortColInfo.colOffsetMap=c}},onRenderHeaderCell(i,e,t,s){const{sortCol:n}=this.options;return n&&(this.layout.cols[e.col.side].list.length>1&&(n===!0||Array.isArray(n)&&n.includes(e.col.name)||typeof n=="function"&&n.call(this,e.col))&&i.push({outer:!0,className:"is-sortable-col"}),i=Gv.call(this,i,e,t,s)),i},onRenderCell:Gv}),uM="";function Zv(i,e,t){const{colResizing:s}=i.state;if(!s)return;const n=Math.round(e.clientX-s.startX);if(!n&&!t)return;const r={};t&&(r.colResizing=void 0);const{colName:o}=s;let a=i.getColInfo(o);if(!a)return i.update({dirtyType:"layout",state:r});r.colsSizes={...i.state.colsSizes,[o]:s.startSize+n},i.update({dirtyType:"layout",state:r},t?()=>{var l;if(a=i.getColInfo(o),a){const c=i.data.colOriginSize.get(o);(l=i.options.onColResize)==null||l.call(i,o,a.width-c,a)}}:void 0),e.stopPropagation(),e.preventDefault()}const Yv=et({name:"resize",when:i=>!!i.colResize,plugins:[lo],resetState(i){var e;return{colsSizes:((e=i.cols)==null?void 0:e.reduce((t,s)=>(s.extraWidth!==void 0&&(t[s.name]=s.extraWidth),t),{}))||{}}},state(){var i;return{colsSizes:((i=this.props.cols)==null?void 0:i.reduce((e,t)=>(t.extraWidth!==void 0&&(e[t.name]=t.extraWidth),e),{}))||{}}},data(){return{colOriginSize:new Map}},events:{mousedown(i){const e=i.target.closest(".dtable-col-splitter");if(!e)return;const t=e.closest(".dtable-cell"),s=t==null?void 0:t.dataset.col;if(s)return this.setState({colResizing:{colName:s,startSize:this.state.colsSizes[s]??0,startX:i.clientX}},()=>{v(t).zuiCall("ContextMenu.hide")}),!1},dblclick(i){var n;const e=i.target.closest(".dtable-col-splitter");if(!e)return;const t=(n=e.closest(".dtable-cell"))==null?void 0:n.dataset.col;if(!t)return;const{colsSizes:s}=this.state;s[t]&&(delete s[t],this.update({dirtyType:"layout",state:{colResizing:void 0,colsSizes:{...s}}},()=>{var r;(r=this.options.onColResize)==null||r.call(this,t,0,this.getColInfo(t))}))},document_mouseup(i){if(this.state.colResizing)return Zv(this,i,!0),!1},document_mousemovesmooth(i){if(this.state.colResizing)return Zv(this,i),!1}},methods:{isColResizable(i){if(typeof i=="string"&&(i=this.getColInfo(i)),!i||i.side!=="left"&&i.sideIndex===this.layout.cols[i.side].list.length-1)return;let e=i.setting.colResize??this.options.colResize;return typeof e=="function"&&(e=e.call(this,i.name)),!!e}},onRenderHeaderCell(i,{col:e}){var t;return this.isColResizable(e)&&(i.push({className:"has-col-splitter",children:k("div",{className:"dtable-col-splitter no-cell-event"}),outer:!0}),((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&i.push({className:"has-col-resizing",outer:!0})),i},onRenderCell(i,{col:e}){var t;return((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&i.push({className:"is-col-resizing",outer:!0}),i},onAddCol(i){const e=this.state.colsSizes[i.name]??i.setting.extraWidth;typeof e=="number"&&(this.data.colOriginSize.set(i.name,i.width),i.width=cy(i.width+e,i.setting.minWidth,i.setting.maxWidth))},onRender(){if(this.state.colResizing)return{className:"has-col-resizing"}}}),pM="",gS=et({name:"contextmenu",when:i=>!!i.contextmenu,events:{contextmenu(i){const e=this.getPointerInfo(i);if(!e)return;const t=this.getContextMenuItems(i,e);if(!t||!t.length)return;i.preventDefault();const s=v(e.cellElement).addClass("has-contextmenu-show");e.cellElement.classList.add("active"),Xi.show({items:t,key:`dtable-ctx-${this.id}`,triggerEvent:i,hideOthers:!0,onHide(){s.removeClass("has-contextmenu-show")}})}},methods:{getContextMenuItems(i,e){const{contextmenu:t}=this.options;if(typeof t=="function")return t.call(this,i,e);if(!t||Array.isArray(t))return t;const{header:s,cell:n}=t;return e.rowID==="HEADER"?typeof s=="function"?s.call(this,i,e):s:typeof n=="function"?n.call(this,i,e):n}}});function Jv(i,e){if(typeof e=="string"&&(e=i.getColInfo.call(i,e)),!e)return{};const{colBorders:t}=i.state,{side:s,sideIndex:n}=e,r=i.layout.cols[s].list,o=n>0?r[n-1]:null,a=r[n+1];return{prevName:o==null?void 0:o.name,nextName:a==null?void 0:a.name,prev:o?t[o.name]??o.setting.border:void 0,next:a?t[a.name]??a.setting.border:void 0}}function Qi(i,e){return i===e||i===!0}const yS=et({name:"custom-col",when:i=>!!i.customCol,plugins:[gS],resetState:!0,options(i){return i.customCol&&!i.contextmenu&&(i.contextmenu={header:(e,t)=>{var o,a;const s=this.getColBorder(t.colName),n=l=>{const c={width:"12px",margin:"0 2px",height:"12px",border:"1px dotted var(--color-border-strong)"},h="2px solid var(--color-border-strong)";return l==="left"?c.borderLeft=h:l==="right"?c.borderRight=h:l===!0&&(c.borderLeft=h,c.borderRight=h),k("span",{style:c})},r=((o=this.getColInfo(t.colName))==null?void 0:o.setting.required)||!((a=this.options.canSetColVisibility)!=null&&a.call(this,t.colName,!1));return[{icon:n(s),text:this.i18n("setDivider"),items:[{text:this.i18n("leftDivider"),icon:n("left"),selected:s==="left",onClick:()=>this.setColBorder(t.colName,"left")},{text:this.i18n("rightDivider"),icon:n("right"),selected:s==="right",onClick:()=>this.setColBorder(t.colName,"right")},{text:this.i18n("allDivider"),icon:n(!0),selected:s===!0,onClick:()=>this.setColBorder(t.colName,!0)},{text:this.i18n("noDivider"),icon:n(!1),selected:!s,onClick:()=>this.setColBorder(t.colName,!1)}]},{text:this.i18n("hideCol"),icon:"eye-off",disabled:r,onClick:r?void 0:()=>this.setColVisibility(t.colName,!1)}]}}),i},state(){return{colBorders:{},colVisibility:{}}},methods:{getColBorder(i,e=!0){const t=this.getColInfo(i);if(!t)return!1;const{colBorders:s}=this.state,n=s[i]??t.setting.border;if(n===!0||!e)return n;const{prev:r,next:o}=Jv(this,t),a=n==="left"||Qi(r,"right"),l=n==="right"||Qi(o,"left");return a&&l?!0:a?"left":l?"right":!1},setColBorder(i,e){if(this.getColBorder(i,!1)===e)return;const{onSetColBorder:s}=this.options,{prev:n,next:r,prevName:o,nextName:a}=Jv(this,i);this.update({dirtyType:"layout",state:l=>{const c={...l.colBorders,[i]:e};return!Qi(e,"left")&&Qi(n,"right")&&(c[o]=!1),!Qi(e,"right")&&Qi(r,"left")&&(c[a]=!1),{colBorders:c}}},s?()=>{s.call(this,i,e,this.state.colBorders)}:void 0)},setColVisibility(i,e){const{onSetColVisibility:t}=this.options;this.update({dirtyType:"options",state:s=>({colVisibility:{...s.colVisibility,[i]:e}})},t?()=>{t.call(this,i,e)}:void 0)}},onAddCol(i){const{colBorders:e}=this.state;e[i.name]!==void 0&&(i.border=e[i.name])},beforeLayout(i){const{colVisibility:e}=this.state;Object.keys(e).length&&i.cols&&(i.cols=i.cols.map(t=>(e[t.name]!==void 0&&(t={...t,hidden:!e[t.name]}),t)))},i18n:{zh_cn:{setDivider:"设置分割线",leftDivider:"左侧",rightDivider:"右侧",allDivider:"两侧",noDivider:"无",hideCol:"隐藏此列"},zh_tw:{setDivider:"設置分割線",leftDivider:"左側",rightDivider:"右側",allDivider:"兩側",noDivider:"無",hideCol:"隱藏此列"},en:{setDivider:"Set divider",leftDivider:"Left Side",rightDivider:"Right Side",allDivider:"Both Sides",noDivider:"No Divider",hideCol:"Hide this column"}}}),yM="";function Pu(i,e,t){if(t){if(typeof t=="object"){const s=t[i];return typeof s=="string"?s:typeof s=="object"&&s?s.realname:void 0}if(typeof t=="function")return t(i,e)}}function Xv(i,e,t){let s;if(typeof i=="function"?s=i(e,t):typeof i=="object"&&(s=i[e]),s)return g(Ie,{className:"dtable-cell-icon",icon:s})}et({name:"zentao",plugins:["group","checkable","nested",fS,pS,Lv,mS,Yv,yS],defaultOptions:{colHover:"header",rowHeight:36,striped:!1,responsive:"window,parent,.search-form,~document_layout",checkable:"auto",nested:"auto",width:"100%",footer:void 0,showToolbarOnChecked:!0,checkOnClickRow:!0,groupDivider:!0,preserveNested:!0,extraHeight:"+",height(i){var r;const e=(r=this.element)==null?void 0:r.closest(".modal-dialog"),t=v(e||"body");let s=this.options.extraHeight;typeof s=="string"&&(s[0]==="+"&&(s=(e?".modal-header,.modal-footer,.search-form,36,#featureBar,":"#header,#mainMenu,#mainNavbar,.search-form,")+s.slice(1)),s=s.split(",")),Array.isArray(s)||(s=[s]);const n=s.reduce((o,a)=>a?typeof a=="number"||/^\d+$/.test(a)?o+Number(a):o+(t.find(a).outerHeight()||0):o,0);return Math.min(i,window.innerHeight-(e?64:1)-n)}},options(i){var l;const{checkable:e,footToolbar:t,footPager:s,footer:n}=i;if(n===void 0){const c=[];if(e&&c.push("checkbox"),t){const h=Array.isArray(t)?{items:t}:t;c.push("toolbar"),h.btnProps=v.extend({btnType:"primary",size:"sm"},h.btnProps),typeof h=="object"&&(typeof h.items=="function"&&(h.items=h.items.call(this)),Array.isArray(h.items)&&h.items.forEach(d=>{if((d==null?void 0:d.type)==="dropdown"){const f=d.menu||d["data-menu"];f&&f.searchBox&&(f.searchPlacement===void 0&&(f.searchPlacement="bottom"),f.maxHeight||(f.maxHeight=480))}})),i.footToolbar=h}e&&c.push("checkedInfo"),s&&c.push("flex","pager"),c.length&&(i.footer=c)}const r={"data-load":"table","data-selector":"dtable","data-target":i.id,...i.loadOptions},o=i.loadPartial||((l=this.parent||this.element)==null?void 0:l.closest(".modal"));o&&(r["data-partial"]=!0),s&&(s.btnProps=v.extend({type:"ghost",size:"sm"},s.btnProps),s.items&&!i.localPager&&s.items.forEach(c=>{c.type==="size-menu"?v.extend(!0,c,{itemProps:o?{...r,...c.itemProps}:{"data-app":"current",...c.itemProps},placement:"top"}):c.type==="link"&&v.extend(c,r)}));let{sortLink:a}=i;if(a&&(typeof a=="string"&&(a={url:a}),typeof a=="object"&&(a=v.extend(r,a)),i.sortLink=a),i.customCols){i.colResize===void 0&&(i.colResize=!0),i.sortCol===void 0&&(i.sortCol=!0);const c=()=>{this.trySaveColsSetting()};i.sortCol&&!i.onSortColEnd&&(i.onSortColEnd=c),i.colResize&&!i.on&&(i.onColResize=c),i.customCol===void 0&&(i.customCol=!0),i.customCol&&(i.onSetColBorder||(i.onSetColBorder=c),i.onSetColVisibility||(i.onSetColVisibility=c),i.canSetColVisibility||(i.canSetColVisibility=h=>{const d=this.getColInfo(h);return!d||d.side!=="center"?!1:this.layout.cols[d.side].list.length>1}))}return i},i18n:{zh_cn:{unassigned:"未指派"},zh_tw:{unassigned:"未指派"},en:{unassigned:"Unassigned"}},colTypes:{id:{width:60,fixed:"left",align:"center",sortType:!0,maxWidth:120},checkID:{width:80,fixed:"left",align:"left",sortType:!0,checkbox:!0,maxWidth:160},title:{width:.44,fixed:"left",align:"left",sortType:!0,flex:1,hint:!0,maxWidth:600},shortTitle:{width:.2,align:"left",sortType:!0,fixed:"left",checkbox:!0,flex:1,hint:!0,maxWidth:250},nestedTitle:{width:.5,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:650},shortNestedTitle:{width:.33,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:300},status:{width:80,align:"center",sortType:!0,onRenderCell(i,{col:e,row:t}){var o,a;const s=(o=t.data)==null?void 0:o[e.name];let n,r;return typeof s=="string"?(n=s,r=(a=e.setting.statusMap)==null?void 0:a[s]):typeof s=="object"&&s&&({name:n,label:r}=s),i[0]=g("span",{class:`${e.setting.statusClassPrefix??"status-"}${n}`},r??n),i}},user:{width:80,align:"center",sortType:!0,onRenderCell(i,{col:e,row:t,value:s}){const{userMap:n=this.options.userMap,userJoiner:r=" "}=e.setting;if(Array.isArray(s))i[0]=s.map(o=>Pu(o,t,n)).filter(Boolean).join(r);else{const o=Pu(s,t,n);o!==void 0&&(i[0]=o)}return i}},assign:{width:108,align:"left",sortType:!0,cellClass:"px-1.5",onRenderCell(i,e){const{col:t,row:s,value:n}=e,{options:r}=this,{userMap:o=r.userMap,currentUser:a=r.currentUser,assignLink:l,unassignedText:c=r.unassignedText||this.i18n("unassigned")}=t.setting,h=!n,d=n==="closed",f=h?c:Pu(n,s,o)??n;return i[0]=l?xu.call(this,l,e,[g("i",{className:"icon icon-hand-right"}),g("span",null,f)],{"data-toggle":d?void 0:"modal",className:`dtable-assign-btn${a===n?" is-me":""}${h?" is-unassigned":""}${d?" disabled":""}`}):f,i}},avatar:{width:44,align:"center",sortType:!0},avatarName:{width:108,align:"left",sortType:!0},avatarBtn:{width:108,align:"left",sortType:!0},category:{width:80,align:"center",flex:1,hint:!0},desc:{width:160,align:"left",flex:1,hint:!0},text:{width:136,align:"left",flex:1,hint:!0},icon:{width:52,align:"center",cellClass:"px-1",onRenderCell(i,{row:e,col:t,value:s}){const{iconRender:n}=t.setting,r=Xv(n,s,e);return r&&(i[0]=r),i}},pri:{width:68,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(i,{col:e,value:t}){const{priList:s=this.options.priList||{}}=e.setting,n=s[t]??t;return i[0]=g(Iy,{pri:t,text:n}),i}},severity:{width:92,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(i,{col:e,value:t}){const{severityList:s=this.options.severityList||{}}=e.setting,n=s[t]??t;return i[0]=g(My,{severity:t,text:n}),i}},burn:{width:88,align:"center",onRenderCell(i,{col:e}){const t=i[0];if(!t)return i;const{burn:s}=e.setting,n={data:t,className:"border-b",width:64,height:24,responsive:!1,...s};return i[0]=g(Nd,{...n}),i}},date:{width:96,align:"center",sortType:!0},time:{width:64,align:"center",sortType:!0},datetime:{width:128,align:"center",sortType:!0},progress:{width:64,align:"center",sortType:!0},money:{width:96,align:"right",sortType:!0},count:{width:92,align:"right",sortType:!0},number:{width:64,align:"center",sortType:!0,digits:-1},percent:{width:64,align:"center",sortType:!0,format(i){return typeof i=="string"&&i.endsWith("%")?i:`${i}%`}},actions:{minWidth:120,align:"left",fixed:"right"}},methods:{trySaveColsSetting(){this.data.saveColsSettingTimer&&clearTimeout(this.data.saveColsSettingTimer),this.data.saveColsSettingTimer=window.setTimeout(()=>{this.saveColsSetting(),this.data.saveColsSettingTimer=0},200)},getColsSetting(){const{colOrders:i,colsSizes:e,colBorders:t,colVisibility:s}=this.state,n={},r=(o,a)=>{const l=n[o];l?Object.assign(l,a):n[o]={id:o,...a}};return i&&Object.keys(i).forEach(o=>{r(o,{order:i[o]})}),e&&Object.keys(e).forEach(o=>{r(o,{extraWidth:e[o]})}),t&&Object.keys(t).forEach(o=>{r(o,{border:t[o]})}),s&&Object.keys(s).forEach(o=>{r(o,{show:s[o]})}),Object.values(n)},async saveColsSetting(){const i=this.getColsSetting();if(!i.length)return;const{saveFieldsUrl:e}=this.options.customCols||{};if(!e)return;const t=JSON.stringify(i);t!==this.data.lastSavedColsSetting&&(this.data.lastSavedColsSetting=t,await v.post(e,{fields:t}))}},onRenderCell(i,{row:e,col:t,value:s}){const{iconRender:n}=t.setting;if(n&&t.type!=="icon"){const r=Xv(n,s,e);r&&i.push(r)}return i},onRender(){const{customCols:i}=this.options;if(!i)return;const{custom:e,setGlobal:t,reset:s,resetGlobal:n}=i;return{children:g("div",{className:"absolute gap-1.5 pr-1.5 top-0 right-0 z-20 row items-center",style:"background:var(--dtable-header-bg);height: calc(var(--dtable-header-height) - 2px)"},g("div",{className:"w-px border-l h-5"}),g("a",{className:"btn ghost square size-sm rounded","data-toggle":"dropdown","data-placement":"bottom-end"},g("i",{class:"icon icon-cog-outline"})),g("menu",{class:"dropdown-menu menu"},e&&g("li",{class:"menu-item"},g("a",{href:e.url,"data-toggle":"modal"},e.text)),t&&g("li",{class:"menu-item"},g("a",{class:"ajax-submit",href:t.url},t.text)),s&&g("li",{class:"menu-item"},g("a",{class:"ajax-submit",href:s.url},s.text)),n&&g("li",{class:"menu-item"},g("a",{class:"ajax-submit",href:n.url},n.text))))}},onUpdated(){const{updateCheckedRows:i}=this.options;i&&i!==this.data.updateCheckedRows&&(this.data.updateCheckedRows=i,this.toggleCheckRows(i,!0))}},{buildIn:!0});const _M="",go=i=>`${i.col.name}[${i.row.id}]`,yo=(i,e,t,s="value")=>{const n=go(e),r=i.data.formData[n]??e.value;return{[s]:r,className:"form-control",onChange:o=>i.setFormData(n,o instanceof Event?o.currentTarget.value:o),...t}};function Lu(i){const e=go(i);let t=this.data.pickRefs.get(e);return t||(t=ye(),this.data.pickRefs.set(e,t)),yo(this,i,{ref:t},"defaultValue")}const vS={input:{component:"input",props(i){return yo(this,i,{type:"text"})}},select:{component:function(i){const{items:e,defaultValue:t,...s}=i;return g("select",{...s},e.map(n=>g("option",{key:n.value,value:n.value},n.text)))},props(i){return yo(this,i)}},picker:{component:Gt,props:Lu},datePicker:{component:Oi,props(i){return yo(this,i,{className:"flex-auto",icon:"calendar"},"defaultValue")}},timePicker:{component:Oa,props(i){return yo(this,i,{className:"flex-auto",icon:"time"},"defaultValue")}},priPicker:{component:no,props:Lu},severityPicker:{component:Jd,props:Lu}};et({name:"form",plugins:[Sv],data(){return{formData:{},pickRefs:new Map}},colTypes:{control:{custom(i){let{control:e}=i.col.setting;if(typeof e=="function"&&(e=e.call(this,i)),!e)return;typeof e=="string"&&(e={type:e});const{controlMap:t}=this.options,{type:s}=e,n={name:go(i)};let r;if([vS[s],t==null?void 0:t[s],e].forEach(o=>{if(o){const{props:a}=o;a&&v.extend(n,typeof a=="function"?a.call(this,i):a),r=o.component||r}}),!!r)return{component:r,props:n}}}},methods:{setFormData(i,e,t){var r,o;const{formData:s}=this.data;s[i]=e,t||(r=this.options.onFormChange)==null||r.call(this,i,e,s);const n=this.data.pickRefs.get(i);n&&((o=n.current)==null||o.setValue(e))},getFormData(i=!0){let{formData:e}=this.data;if(!i)return e;const{rows:t,cols:s}=this.layout,n=t.reduce((r,o)=>(s.list.forEach(a=>{var l;a.setting.control&&(r[go({col:a,row:o})]=(l=o.data)==null?void 0:l[a.name])}),r),{});return e=v.extend(n,e),i===!0?e:e[i]},resetFormData(){this.data.formData={};const{rows:i,cols:e}=this.layout;i.forEach(t=>{e.list.forEach(s=>{var r,o;if(!s.setting.control)return;const n=this.data.pickRefs.get(go({col:s,row:t}));n&&((o=n.current)==null||o.setValue(((r=t.data)==null?void 0:r[s.name])??""))})})}}});function Ru(i,e){return Object.entries(e).reduce((t,[s,n])=>{const r=t[s];return r?n===void 0?delete t[s]:Object.keys(n).forEach(o=>{const a=n[o];a===void 0?delete r[o]:r[o]=a}):n!==void 0&&(t[s]=n),t},i)}function vo(i){return Object.entries(i).reduce((e,[t,s])=>(e&&typeof s=="object"&&(e[t]={...s}),e),{})}const Qv=et({name:"draft",defaultOptions:{draft:!0,selectAllOnFocus:!0,history:20},when:i=>!!i.draft,state(){return{stagingDraft:{},appliedDraft:{}}},methods:{getCellDraftValue(i,e){const t=this.getRowInfo(i);if(!t)return;const s=this.getColInfo(e);if(!s)return;const{id:n}=t,{name:r}=s,o=this.state.stagingDraft[n];if(o&&r in o)return o[r];const a=this.state.appliedDraft[n];return a&&r in a?a[r]:this.getCellValue(t,s)},getRowDraftData(i,e){const t=this.getRowInfo(i);return t?this.layout.cols.list.reduce((s,n)=>{if(!(e!=null&&e.includeIndexCol)&&n.name==="INDEX")return s;const r=this.getCellDraftValue(t,n);return s[n.name]=r===void 0?e==null?void 0:e.emptyCellValue:r,s},{}):{}},getColDraftData(i,e){const t=this.getColInfo(i);return t?this.layout.rows.reduce((s,n)=>{const r=this.getCellDraftValue(n,t);return s[n.id]=r===void 0?e==null?void 0:e.emptyCellValue:r,s},e!=null&&e.includeHeaderRow?{HEADER:this.getCellDraftValue("HEADER",t)}:{}):{}},stageDraft(i,e){var r;const{stagingDraft:t}=this.state;if(((r=this.options.onStageDraft)==null?void 0:r.call(this,i,t))===!1)return;const s=vo(t);Ru(t,i);const n=()=>{var o,a;(o=e==null?void 0:e.callback)==null||o.call(e,i),(a=this.options.afterStageDraft)==null||a.call(this,i,this.state.stagingDraft,s,{skipUpdate:!!(e!=null&&e.skipUpdate)})};e!=null&&e.skipUpdate?n():this.update(n)},applyDraft(i,e){const{stagingDraft:t,appliedDraft:s}=this.state,n=vo(s);Object.entries(i).forEach(([o,a])=>{const l=t[o];l&&typeof a=="object"&&(a===null?delete t[o]:Object.keys(a).forEach(h=>{l[h]===a[h]&&delete l[h]}),Object.keys(l).length||delete t[o]);const c=s[o];c?a===null?delete s[o]:Object.assign(c,a):a!==null&&(s[o]=a)});const r=()=>{var o,a;(o=e==null?void 0:e.callback)==null||o.call(e,i),(a=this.options.afterApplyDraft)==null||a.call(this,i,this.state.appliedDraft,n)};e!=null&&e.skipUpdate?r():this.forceUpdate(r)},renderDraftCell(i,{col:e,row:t}){let s=this.getCellDraftValue(t,e)??"";return typeof s=="string"&&!s.length&&t.id==="HEADER"&&(s=e.name),i[0]={children:s,attrs:{title:s}},i}},onRenderCell(i,...e){return this.options.skipRenderDraftCell?i:this.renderDraftCell(i,...e)},onRenderHeaderCell(i,...e){return this.options.skipRenderDraftCell?i:this.renderDraftCell(i,...e)}}),CM="";function e_(i,e,t){return i.every(s=>e[s]===t[s])}const _S=et({name:"editable",plugins:[Qv],defaultOptions:{editable:!0,selectAllOnFocus:!0,history:20,skipRenderDraftCell:!0,emptyCellValue:""},when:i=>!!i.editable,events:{dblclick(i){this.editCell(this.getPointerInfo(i))},click(i){const e=this.getPointerInfo(i);e&&e.cellElement.classList.contains("is-selected")&&this.editCell(e)}},data(){return{editingInputRef:ye()}},methods:{isCellEditing(i,e){const{editingCell:t}=this.state;return!!t&&t.rowID===i&&t.colName===e},editCell(i){const{editable:e,headerEditable:t}=this.options;i&&(typeof e=="function"&&!e(i.rowID,i.colName)||!t&&i.rowID==="HEADER")&&(i=void 0),this.data.editingInputRef.current=null,this.data.needAutoFocus=!0,this.setState({editingCell:i?{colName:i.colName,rowID:i.rowID}:void 0})},deleteCells(i){const e={},{emptyCellValue:t}=this.options;return i.forEach(s=>{const n=e[s.rowID];n?n[s.colName]=t:e[s.rowID]={[s.colName]:t}}),Object.keys(e).length?(this.stageDraft(e),!0):!1},deleteRows(i,e){Array.isArray(i)||(i=[i]);const t=this.layout.cols.list.reduce((d,f)=>(f.name!=="HEADER"&&d.push(f.name),d),[]),s=i.reduce((d,f)=>{const m=this.getRowInfo(f);return m&&m.id!=="HEADER"&&d.push(m),d},[]).sort((d,f)=>d.index-f.index);if(!s.length)return;const n=new Set(s.map(d=>d.index)),r=new Map,o=this.layout.rows,a=o.length,{emptyCellValue:l}=this.options;let c=s[0].index;for(let d=c+1;d<a;d++){if(n.has(d))continue;const f=o[d];r.set(c,this.getRowDraftData(f,{emptyCellValue:l})),c++}const h={};c=s[0].index;for(let d=c;d<a;d++){const f=o[d],m=this.getRowDraftData(f,{emptyCellValue:l}),y=r.get(d)||{};e_(t,m,y)||(h[f.id]=y)}Object.keys(h).length&&this.stageDraft(h,{skipUpdate:e==null?void 0:e.skipUpdate})},deleteCols(i,e){Array.isArray(i)||(i=[i]);const t=i.reduce((d,f)=>{const m=this.getColInfo(f);return m&&m.name!=="INDEX"&&d.push(m),d},[]).sort((d,f)=>d.index-f.index);if(!t.length)return;const s=new Set(t.map(d=>d.index)),n=new Map,{cols:{list:r}}=this.layout,o=r.length,a=this.layout.rows.reduce((d,f)=>(d.push(f.id),d),["HEADER"]),{emptyCellValue:l}=this.options;let c=t[0].index;for(let d=c+1;d<o;d++){if(s.has(d))continue;const f=r[d];n.set(c,this.getColDraftData(f,{emptyCellValue:l,includeHeaderRow:!0})),c++}const h={};c=t[0].index;for(let d=c;d<o;d++){const f=r[d],m=this.getColDraftData(f,{emptyCellValue:l,includeHeaderRow:!0}),y=n.get(d)||{};if(!e_(a,m,y))for(const b of a)h[b]||(h[b]={}),h[b][f.name]=y[b]??l}Object.keys(h).length&&this.stageDraft(h,{skipUpdate:e==null?void 0:e.skipUpdate})},handleEditingInputChange(i){var o,a;const e=(o=i.target)==null?void 0:o.value,{editingCell:t}=this.state;if(typeof e!="string"||!t)return;const{rowID:s,colName:n}=t,r=this.getCellDraftValue(s,n);r!==e&&((a=this.options.onEditCell)==null?void 0:a.call(this,{rowID:s,colName:n,value:e,oldValue:r}))!==!1&&this.stageDraft({[s]:{[n]:e}})},handleEditingInputBlur(){this.editCell()},handleEditingKeyDown(i){var e;i.key==="Enter"?(e=this.data.editingInputRef.current)==null||e.blur():i.key==="Esc"&&this.editCell()},renderEditableCell(i,e,t,s){const{col:n,row:r}=e,{id:o}=r;if(this.isCellEditing(o,n.name)){const a=`${this.getCellDraftValue(o,n.name)??""}`;return[{outer:!0,className:"is-editing",children:k("input",{ref:this.data.editingInputRef,class:"dtable-editing-input",type:"text",defaultValue:a,style:{textAlign:n.setting.align},onChange:this.handleEditingInputChange,onBlur:this.handleEditingInputBlur,onKeyDown:this.handleEditingKeyDown,onPaste:this.options.onPasteToCell})}]}return this.renderDraftCell(i,e,t,s)}},onUpdated(){const i=this.data.editingInputRef.current;i&&this.data.needAutoFocus&&(this.data.needAutoFocus=!1,i.focus({preventScroll:!0}),this.options.selectAllOnFocus&&i.select())},onRender(){return{className:{"dtable-editable":this.options.editable,"dtable-editing":this.state.editingCell}}},onRenderCell(...i){return this.renderEditableCell(...i)},onRenderHeaderCell(...i){return this.renderEditableCell(...i)}}),kM="",bS=/C(\d+)R(\d+)/i,wS=/(?:C(\d+))?(?:R(\d+))?/i;function t_(i){const e=bS.exec(i);if(!e||e.length<3)return;const[,t,s]=e;return{col:+t,row:+s}}function zu(i){const e=wS.exec(i);if(!e)return;const[,t=-1,s=-1]=e,n=+t,r=+s;return{col:n,row:r}}function Fu(i){const e=[],t=zu(i);if(!t)return e;const{col:s,row:n}=t;if(s>=0)if(n>=0)e.push({col:s,row:n});else{const r=this.layout.rows.length;for(let o=0;o<r;o++)e.push({col:s,row:o})}else if(n>=0){const{cols:r}=this.layout,o=r.list.length;for(let a=0;a<o;a++)e.push({col:a,row:n})}return e}function s_(i){const[e,t]=i.split(":");if(e){if(!t)return Fu.call(this,e)}else return t?Fu.call(this,t):[];const s=zu(e),n=zu(t);if(!s||!n)return[];const r=Math.min(s.col,n.col),o=Math.max(s.col,n.col),a=Math.min(s.row,n.row),l=Math.max(s.row,n.row),c=[],h=Object.keys(this.layout.cols.map).length;for(let d=r;d<=o;d++)if(a<0||l<0){const f=this.layout.rows.length;for(let m=0;m<f;m++)c.push({col:d,row:m})}else for(let f=a;f<=l;f++)if(d<0)for(let m=0;m<h;m++)c.push({col:m,row:f});else c.push({col:d,row:f});return c}function CS(i){return i.reduce((e,t)=>(typeof t=="object"?e.push(t):t.includes(":")?e.push(...s_.call(this,t)):e.push(...Fu.call(this,t)),e),[])}function Ou(i,e){const{col:t,row:s}=i,n=[];if(t>=0&&n.push(`C${t}`),s>=0&&n.push(`R${s}`),e){const r=Ou(e);r&&n.push(":",r)}return n.join("")}function ju(i,e){const{selectable:t}=i.options;return typeof t=="function"?t.call(i,e):!!t}function Bu(i,e={}){var f;Array.isArray(i)||(i=[i]);let t=CS.call(this,i);const s=(f=this.options.beforeSelectCells)==null?void 0:f.call(this,t);s&&(t=s);const{clearBefore:n=!0,deselect:r,selecting:o,callback:a}=e,{selectingMap:l,selectedMap:c}=this.state,h=o?l:c;l.clear(),n&&c.clear();let d=!1;return r?t.forEach(m=>{if(!ju(this,m))return;const{col:y,row:b}=m,w=h.get(y);w&&(w.delete(b),w.size||h.delete(y)),d=!0}):t.forEach(m=>{if(!ju(this,m))return;const{col:y,row:b}=m,w=h.get(y);w?w.add(b):h.set(y,new Set([b])),d=!0}),d?(this.update({},()=>{var m;a==null||a.call(this,t),(m=this.options.onSelectCells)==null||m.call(this,t)}),t):[]}function xS(i){const{selectedMap:e}=this.state;let t=-1,s=-1;for(const[n,r]of e.entries()){s=s<0?n:Math.min(n,s);const o=Math.min(...r);t=t<0?o:Math.min(o,t)}if(!(t<0||s<0)&&(i==="down"?t++:i==="up"?t--:i==="left"?s--:s++,t>=0&&s>=0&&t<this.layout.rows.length&&s<this.layout.cols.list.length)){const n={col:s,row:t};if(ju(this,n))return this.scrollTo(n),this.selectCells([n]),n}}function kS(i,e){return Bu.call(this,i,{...e,selecting:!0})}function SS(i,e){return Bu.call(this,i,{...e,deselect:!0})}function TS(){const{cols:i}=this.layout,e=i.list.length,t=this.layout.rows.length,{selectedMap:s}=this.state,n=typeof this.options.selectable=="function"?this.options.selectable:!1;for(let r=0;r<e;r++){let o=s.get(r);o||(o=new Set,s.set(r,o));for(let a=0;a<t;a++)n&&!n({row:a,col:r})||o.add(a)}this.forceUpdate()}function $S(){const{selectedMap:i}=this.state;return i.size?(i.clear(),this.forceUpdate(),!0):!1}function DS(i){var t;const e=typeof i=="string"?t_(i):i;return e?((t=this.state.selectedMap.get(e.col))==null?void 0:t.has(e.row))??!1:!1}function n_(i,e){for(const[,t]of i.state.selectedMap.entries())if(t.has(e))return!0;for(const[,t]of i.state.selectingMap.entries())if(t.has(e))return!0;return!1}function IS(i){var t;const e=(t=this.getRowInfo(i))==null?void 0:t.index;return typeof e!="number"?!1:this.layout.cols.list.every(s=>s.name==="INDEX"||this.isCellSelected({col:s.index,row:e}))}function MS(i){var s;const e=(s=this.getColInfo(i))==null?void 0:s.index;if(typeof e!="number")return!1;const{rows:t}=this.layout;return t.every(n=>this.isCellSelected({col:e,row:n.index}))}function i_(i,e){var t,s;return!!((t=i.state.selectedMap.get(e))!=null&&t.size||(s=i.state.selectingMap.get(e))!=null&&s.size)}function NS(i){var t;const e=typeof i=="string"?t_(i):i;return e?((t=this.state.selectingMap.get(e.col))==null?void 0:t.has(e.row))??!1:!1}function ES(){const i=[];for(const[e,t]of this.state.selectedMap.entries())for(const s of t)i.push({col:e,row:s});return i}function AS(){const i=[];for(const[t,s]of this.state.selectedMap.entries())s.size&&i.push(t);return[...new Set(i)].map(t=>this.getColInfo(t)).filter(t=>t&&this.isColSelected(t)).sort((t,s)=>t.index-s.index)}function PS(){const i=[];for(const[,t]of this.state.selectedMap.entries())i.push(...t);return[...new Set(i)].map(t=>this.getRowInfo(t)).filter(t=>t&&this.isRowSelected(t)).sort((t,s)=>t.index-s.index)}function LS(){let i=0;for(const e of this.state.selectedMap.values())i+=e.size;return i}function Hu(i,e,t){var c,h;const s=i.getPointerInfo(e);if(!s||s.target.closest("input,textarea,[contenteditable]"))return;const{rowID:n,colName:r}=s,o=((c=i.getColInfo(r))==null?void 0:c.index)??-1;if(o<0)return;const a=n==="HEADER";if(a&&(t!=null&&t.ignoreHeaderCell))return;const l=a?-1:((h=i.getRowInfo(n))==null?void 0:h.index)??-1;return{col:o,row:l}}const RS=et({name:"selectable",defaultOptions:{selectable:!0,markSelectRange:!0},when:i=>!!i.selectable,plugins:[lo],state(){return{selectedMap:new Map,selectingMap:new Map}},methods:{selectCells:Bu,selectNextCell:xS,selectingCells:kS,deselectCells:SS,isCellSelected:DS,isCellSelecting:NS,isRowSelected:IS,isColSelected:MS,hasCellSelectInRow:n_,hasCellSelectInCol:i_,getSelectedCols:AS,getSelectedRows:PS,getSelectedCells:ES,selectAllCells:TS,deselectAllCells:$S,getSelectedCellsSize:LS},events:{mousedown(i){if(this.data.disableSelectable)return;const e=Hu(this,i);i.button!==0&&(!e||this.isCellSelected(e)||e.row<0&&this.isColSelected(e.col)||e.col<1&&this.isRowSelected(e.row))||(this.data.selectingStart=e,this.startScrollToMouse(),e&&i.stopPropagation())},document_mouseup(i){const{selectingStart:e}=this.data;if(this.stopScrollToMouse(),!e)return;this.data.selectingStart=void 0;const t=Hu(this,i);if(t){const s=Ou(e,t);s&&(requestAnimationFrame(()=>this.selectCells(s)),i.stopPropagation())}},document_click(i){const e=i.target;if(!e)return;const{ignoreDeselectOn:t}=this.options;e.closest(`#${this.id}${t?`,${t}`:""}`)||this.deselectAllCells()},mousemovesmooth(i){const e=this,{selectingStart:t}=e.data;if(!t)return;const s=Hu(e,i);if(!s)return;const n=Ou(t,s);n&&(e.selectingCells(n),i.preventDefault(),i.stopPropagation())}},onRender(){if(this.options.selectable)return{className:"dtable-selectable"}},onRenderCell(i,{row:e,col:t}){const s=this.getRowInfo(e.id);if(!s)return i;const n={col:t.index,row:s.index};return this.isCellSelecting(n)?i.push({outer:!0,className:"is-select is-selecting"}):this.isCellSelected(n)&&i.push({outer:!0,className:"is-select is-selected"}),this.options.markSelectRange&&t.name==="INDEX"&&(this.isRowSelected(s)?i.push({outer:!0,className:"is-row-selected has-cell-selected"}):n_(this,s.index)&&i.push({outer:!0,className:"has-cell-selected"})),i},onRenderHeaderCell(i,{col:e}){return this.options.markSelectRange&&e.name!=="INDEX"&&i_(this,e.index)&&(i.push({outer:!0,className:"has-cell-selected"}),this.isColSelected(e)&&i.push({outer:!0,className:"is-col-selected"})),i}}),zS=et({name:"hotkey",when:i=>!!i.hotkeys,onMounted(){const{hotkeys:i}=this.options;if(!i)return;const e={};if(Object.keys(i).forEach(s=>{const n=i[s];s.split(",").forEach(r=>{r=r.trim(),r.length&&(e[r]=n)})}),!Object.keys(e).length)return;const t=`dtable_${this.id}`;v(this.element).hotkeys(e,{scope:t}),this.data.hotkeysScope=t},onUnmounted(){this.data.hotkeysScope&&v(this.element).unbindHotkeys(this.data.hotkeysScope)}});function Zl(i,e){const t=new Set([...Object.keys(i),...Object.keys(e)]);return Array.from(t).reduce((s,n)=>{const r=i[n]||{},o=e[n]||{};if(r===o)return s;const a=new Set([...Object.keys(r),...Object.keys(o)]),l={};let c=!1;return a.forEach(h=>{const d=r[h],f=o[h];d!==f&&(l[h]=d,c=!0)}),c&&(s[n]=l),s},{})}const FS=et({name:"history",plugins:[Iv,Qv],defaultOptions:{history:!0,historyTarget:"staging",historyThreshold:10},when:i=>!!i.history,options(i){const{afterApplyDraft:e,afterStageDraft:t,historyTarget:s,history:n}=i;return{afterApplyDraft:n&&s==="applied"?(r,o,a)=>{e&&e.call(this,r,o,a),this.addHistory({after:Zl(o,a),before:Zl(a,o)})}:e,afterStageDraft:n&&s!=="applied"?(r,o,a,l)=>{t&&t.call(this,r,o,a,l),this.addHistory({after:Zl(o,a),before:Zl(a,o)})}:t}},data(){return{historyIdx:1}},state(){return{historyCursor:0,historyItems:[]}},methods:{addHistory(i){let{historyCursor:e,historyItems:t}=this.state;e>0&&(t.splice(0,e).forEach(r=>{typeof r=="number"&&this.data.store.session.remove(`HISTORY:${this.id}:${r}`)}),e=0),t=[i,...t];const{historyThreshold:s}=this.options;if(s&&t.length>s)for(let n=s;n<t.length;n++){const r=t[n];if(typeof r=="number")break;const o=this.data.historyIdx++;this.data.store.session.set(`HISTORY:${this.id}:${o}`,r),t[n]=o}this.setState({historyCursor:e,historyItems:t})},getHistory(i){if(typeof i=="object")return i;const{historyCursor:e,historyItems:t}=this.state;i===void 0&&(i=e);const s=t[i];return typeof s=="number"?this.data.store.session.get(`HISTORY:${this.id}:${s}`):s},applyHistory(i,e,t){const s={historyCursor:i},n=this.options.historyTarget==="applied",{appliedDraft:r,stagingDraft:o}=this.state,a=vo((n?r:o)??{});n?s.appliedDraft=Ru(r,e):s.stagingDraft=Ru(o,e),this.setState(s,()=>{var c;t==null||t();const l=Object.entries(e).reduce((h,[d,f])=>{if(f){const m={};Object.entries(f).forEach(([y,b])=>{m[y]=b===void 0?this.getCellDraftValue(d,y):b}),h[d]=m}return h},{});(c=this.options.onHistoryApplied)==null||c.call(this,l,n?r:o??{},a)})},undoHistory(i){if(!this.canUndoHistory())return!1;const{historyCursor:e}=this.state,t=this.getHistory(e);return t?(this.applyHistory(e+1,vo(t.before),i),!0):!1},redoHistory(i){if(!this.canRedoHistory())return!1;const{historyCursor:e}=this.state,t=this.getHistory(e-1);return t?(this.applyHistory(e-1,vo(t.after),i),!0):!1},canUndoHistory(){const{historyCursor:i,historyItems:e}=this.state;return e.length>0&&i<e.length},canRedoHistory(){return this.state.historyCursor>0}}}),DM="";function OS(i,e){const{colsCount:t,rowsCount:s}=i.getGridSize(),{cols:n=[]}=e,{showRowIndex:r,defaultColWidth:o}=i.options,a=[];r!==!1&&a.push({width:`${s+1}`.length*8+24,name:"INDEX",fixed:"left",align:"right",title:"#",...n.find(l=>l.name==="INDEX")});for(let l=0;l<t;++l){const c=`C${l+1}`,h={name:c,width:o,...n.find(d=>d.name===c)};a.push(h)}return{cols:a,data:s}}function jS(i,e,t){var s,n;return e.name==="INDEX"?i.id==="HEADER"?t:i.index+1:i.id!=="HEADER"?(n=(s=this.options.datasource.data)==null?void 0:s[+i.id])==null?void 0:n[+e.name.replace("C","")-1]:t}function Yl(i,e,t){i.selectNextCell(t)&&(e.preventDefault(),e.stopPropagation())}const BS={delete(i){v(i.target).is("input,textarea")||this.deleteSelections()},cut(){this.cutSelections()},selectAll(i){this.state.editingCell||(this.selectAllCells(),i.preventDefault())},paste(){this.pasteToSelection()},copy(i){this.copySelections(),i.preventDefault()},focus(){const i=this.getSelectedCells()[0];if(!i)return;const e=this.getColInfo(i.col),t=this.getRowInfo(i.row);!e||!t||this.editCell({rowID:t.id,colName:e.name})},cancel(){this.deselectAllCells()},undo(){this.undoHistory()},redo(){this.redoHistory()},selectRight(i){Yl(this,i,"right")},selectLeft(i){Yl(this,i,"left")},selectDown(i){Yl(this,i,"down")},selectUp(i){Yl(this,i,"up")}};function r_(i,e){Array.isArray(i)||(i=[i]);let t=0,s=0;const n=e==null?void 0:e.ignoreEmptyCell;return i.forEach(r=>{Object.entries(r).forEach(([o,a])=>{o!=="HEADER"&&(t=Math.max(t,+o+1),s=Math.max(s,...Object.keys(a).map(l=>n&&o_(a[l])||l[0]!=="C"?0:+l.replace("C",""))))})}),{maxRow:t,maxCol:s}}function HS(){const{minRows:i=1,minCols:e=1,extraRows:t=0,extraCols:s=0,datasource:n}=this.options,{data:r=[],cols:o=[]}=n,{stagingDraft:a,appliedDraft:l}=this.state,{maxRow:c,maxCol:h}=r_([a,l]);return{rowsCount:Math.max(c,r.length+t,i,this.data.rowsCount??0),colsCount:Math.max(h,e,o.length,r.reduce((d,f)=>Math.max(d,f.length),0)+s,this.data.colsCount??0)}}function US(i=1,e){const{rowsCount:t}=this.getGridSize();let s=t;return typeof i=="number"?s=t+Math.max(i,0):Array.isArray(i)&&(s=t+Math.max(i.length,0),this.stageDraft(i.reduce((n,r,o)=>(Array.isArray(r)&&(r=r.reduce((a,l,c)=>(a[`C${c+1}`]=l,a),{})),n[t+o]=r,n),{}),{skipUpdate:!0})),s>t?(this.data.rowsCount=s,e!=null&&e.skipUpdate||this.update({dirtyType:"options"},()=>{(e==null?void 0:e.select)!==!1&&this.selectCells(`R${t}:R${s-1}`),(e==null?void 0:e.autoScroll)!==!1&&this.scrollTo({row:s-1,col:0})}),!0):!1}function VS(i=1,e){const{colsCount:t}=this.getGridSize();let s=t;const{showRowIndex:n}=this.options;return typeof i=="number"?s=t+Math.max(i,0):Array.isArray(i)&&(s=t+Math.max(i.length,0),this.stageDraft(i.reduce((r,o,a)=>(o.forEach((l,c)=>{const h=r[c],d=`C${t+a+(n?1:0)}`;h?h[d]=l:r[c]={[d]:l}}),r),{}),{skipUpdate:!0})),s>t?(this.data.colsCount=s,e!=null&&e.skipUpdate||this.update({dirtyType:"options"},()=>{(e==null?void 0:e.select)!==!1&&this.selectCells(`C${t+(n?1:0)}:C${s-1+(n?1:0)}`),(e==null?void 0:e.autoScroll)!==!1&&this.scrollTo({col:s-(n?0:1),row:0})}),!0):!1}function WS(i,e){const t=this.getGridSize(),s=Math.max(0,(i.rowsCount??0)-t.rowsCount),n=Math.max(0,(i.colsCount??0)-t.colsCount);return s&&this.appendRows(s,{skipUpdate:!0,select:!1}),n&&this.appendCols(n,{skipUpdate:!0,select:!1}),s||n?(e!=null&&e.skipUpdate||this.update({dirtyType:"options"}),!0):!1}function o_(i){return i==null||typeof i=="string"&&!i.length}function a_(i){let e=0,t=0;return i.forEach((s,n)=>{s.forEach((r,o)=>{o_(r)||(e=Math.max(e,o),t=Math.max(t,n))})}),i.slice(0,t+1).map(s=>s.slice(0,e+1))}et({name:"datagrid",plugins:[_S,RS,zS,Yv,FS,Du],defaultOptions:{defaultColWidth:80,headerEditable:!0,minRows:20,minCols:10,extraRows:5,extraCols:5,showRowIndex:!0,rowHover:!1,colHover:!1,cellHover:!0,bordered:!0,striped:!1,datagridHotkeys:{},cellValueSplitter:"	",cellValueGetter:jS,hotkeys:{},autoExpandGrid:!0},options(i){const{datagridHotkeys:e,datasource:t,hotkeys:s,editable:n,selectable:r,beforeSelectCells:o,showRowIndex:a,colResize:l,onPasteToCell:c,afterStageDraft:h}=i,d={delete:"Delete,Backspace",selectAll:"$mod+a",paste:"$mod+v",copy:"$mod+c",focus:"Enter",cancel:"Escape",cut:"$mod+x",redo:"$mod+Shift+z",undo:"$mod+z",selectRight:"Tab,ArrowRight",selectLeft:"ArrowLeft",selectDown:"ArrowDown",selectUp:"ArrowUp"};return{hotkeys:{...s,...Object.entries({...d,...e}).reduce((m,[y,b])=>{var w;return b&&(m[b===!0?d[y]:b]=(w=BS[y])==null?void 0:w.bind(this)),m},{})},colResize:l?m=>(typeof l!="function"||l.call(this,m))&&m!=="INDEX":!1,editable:n?(m,y)=>typeof n=="function"&&!n(m,y)?!1:y!=="INDEX":!1,selectable:r?m=>typeof r=="function"&&!r(m)?!1:m.col>=(a?1:0):!1,beforeSelectCells:a?m=>(m.every(y=>y.col===0)&&(m=s_.call(this,`R${Math.min(...m.map(y=>y.row))}:R${Math.max(...m.map(y=>y.row))}`)),o?o.call(this,m):m):o,...OS(this,t),onPasteToCell:m=>{var b;const y=(b=m.clipboardData)==null?void 0:b.getData("text");typeof y=="string"&&(y.includes("	")||y.includes(`
`))&&this.state.editingCell&&(this.pasteCells(this.state.editingCell,{data:y}),m.preventDefault()),c==null||c.call(this,m)},afterStageDraft:(m,y,b,w)=>{h==null||h.call(this,m,y,b,w);const{autoExpandGrid:x}=this.options;if(!x)return;const{maxCol:D,maxRow:I}=r_(y,{ignoreEmptyCell:!0}),{extraCols:E=1,extraRows:P=1}=this.options;this.expandGridSize({rowsCount:I+(typeof x=="number"?x:P),colsCount:D+(typeof x=="number"?x:E)},w)}}},methods:{deleteSelections(){const i=[];for(const[e,t]of this.state.selectedMap.entries()){const s=this.getColInfo(e);if(s)for(const n of t){const r=this.getRowInfo(n);r&&i.push({colName:s.name,rowID:r.id})}}return this.deleteCells(i)},deleteSelectedRows(){const i=this.getSelectedRows();return i.length?(this.deleteRows(i),this.deselectAllCells(),!0):!1},deleteSelectedCols(){const i=this.getSelectedCols();return i.length?(this.deleteCols(i),this.deselectAllCells(),!0):!1},copySelectedCols(){const i=this.getSelectedCols();if(!i.length)return!1;const e=this.layout.rows.length,t=[];for(let n=-1;n<e;++n)t.push(i.map(r=>{const o=this.getCellDraftValue(n,r);return n===-1&&o===r.name?"":o}));const s=a_(t).map(n=>n.join("	")).join(`
`);return navigator.clipboard.writeText(s),!0},clearSelectedCols(){const i=this.getSelectedCols();if(!i.length)return!1;const e={},{emptyCellValue:t}=this.options;return[this.getRowInfo("HEADER"),...this.layout.rows].forEach(s=>{const n={};i.forEach(r=>{const o=this.getCellDraftValue(s,r);o!=null&&o!==t&&(n[r.name]=t)}),Object.keys(n).length&&(e[s.id]=n)}),Object.keys(e).length?(this.stageDraft(e),!0):!1},async pasteToSelectedCol(){const i=this.getSelectedCols();return i.length?await this.pasteCells({colName:i[0].name,rowID:"HEADER"}):!1},cutSelectedCols(){return this.copySelectedCols(),this.clearSelectedCols()},copySelections(){const i=this.getSelectedCells();if(!i.length)return!1;let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER;i.forEach(r=>{e=Math.min(r.col,e),t=Math.min(r.row,t)});const s=[];i.forEach(r=>{const o=this.getCellDraftValue(r.row,r.col);let a=s[r.row-t];a||(a=[],s[r.row-t]=a),a[r.col-e]=o});const n=a_(s).map(r=>r.join("	")).join(`
`);return navigator.clipboard.writeText(n),!0},cutSelections(){return this.copySelections(),this.deleteSelections()},async pasteCells(i,e){var f,m;let t=-1,s=-1;if("colName"in i){const y=this.getColInfo(i.colName),b=this.getRowInfo(i.rowID);if(!y||!b)return!1;t=y.index,s=b.index}else t=i.col,s=i.row;let n=e==null?void 0:e.data;if(n===void 0)try{const y="clipboard-read";if((await navigator.permissions.query({name:y})).state==="denied")return(f=this.options.onReadClipboardFail)==null||f.call(this),!1;n=await navigator.clipboard.readText()}catch{return(m=this.options.onReadClipboardFail)==null||m.call(this),!1}if(!n.length)return!1;const r={},o=[],a=(e==null?void 0:e.expandCells)!==!1;let l=!1,c=0,h=0;const d=n.split(/\r?\n/);return d.forEach((y,b)=>{var I;if(!y.trim().length&&b===d.length-1)return;const w=b+s;let x=(I=this.getRowInfo(w))==null?void 0:I.id;if(x===void 0){if(!a)return;l=!0,x=`${w}`}let D=r[x];D||(D={},r[x]=D),y.split("	").forEach((E,P)=>{var J;const O=P+t;let W=(J=this.getColInfo(O))==null?void 0:J.name;if(W===void 0){if(!a)return;l=!0,W=`C${O}`}D[W]=E,o.push({col:O,row:w}),c=Math.max(c,w),h=Math.max(h,O)})}),this.stageDraft(r,{skipUpdate:!0}),(e==null?void 0:e.select)!==!1&&this.selectCells(o),this.update({dirtyType:l?"options":void 0},()=>{e!=null&&e.autoscroll&&this.scrollTo({col:h,row:c})}),!0},pasteToSelection(){const i=this.getSelectedCells();if(!i.length)return Promise.resolve(!1);const e=i[0];return this.pasteCells(e)},getGridSize:HS,appendRows:US,appendCols:VS,expandGridSize:WS},onRender(){return{className:"dtable-datagrid"}}});const MM="",NM="",EM="",AM="",PM="",LM="",RM="",zM="",FM="",OM="",jM="",BM="",HM="",UM="",VM="";N.$=v,N.AIAgent=Gr,N.AIChatView=yl,N.AIChatsPanel=Qg,N.AIModelName=_l,N.AIModelPicker=vl,N.AIPanel=Qn,N.AIPlugin=_d,N.AIPopup=ey,N.AIReactions=Mg,N.AIStore=ns,N.Ajax=Sr,N.AjaxForm=El,N.Avatar=Fh,N.BUILD=1768967850625,N.BUILD_HASH=Af,N.BUILD_MODE=Ef,N.BatchForm=ty,N.BtnGroup=Oh,N.Burn=Ed,N.Bus=Sp,N.Card=Wl,N.CardList=bu,N.Checkbox=pa,N.Collapsible=ga,N.ColorPicker=_n,N.CommonList=Ir,N.Component=Ze,N.ComponentFromReact=be,N.Computed=Hn,N.ContextMenu=Xi,N.CopyBtn=Yn,N.Custom=fa,N.CustomContent=fe,N.CustomContentClass=gm,N.CustomRender=xh,N.DTable=Sn,N.Dashboard=Cu,N.DataHub=zm,N.DatePicker=Ba,N.DatetimePicker=Ha,N.DeliverableList=xl,N.Dexie=TC,N.DiffPicker=zl,N.DocApp=Ps,N.DocViewer=ro,N.Draggable=Lr,N.Dropdown=ss,N.Dropmenu=ou,N.ECharts=ok,N.Editor=gt,N.FileList=wl,N.FileSelector=qa,N.FormBuilder=Xa,N.FormGrid=Yy,N.FormHelper=Vi,N.FormSetting=Zy,N.Gantt=Jy,N.GlobalSearch=Ll,N.Graph=tv,N.HElement=Ke,N.HElementSignals=ca,N.HTMLDiff=kd,N.Highlight=Yr,N.HistoryPanel=Yi,N.HtmlContent=Ds,N.HtmlSandbox=Bl,N.Icon=Ie,N.ImageSelector=Ga,N.ImgCutter=hu,N.Kanban=fo,N.KanbanList=po,N.LibLoader=na,N.List=Nr,N.Mammoth=dk,N.Markdown=xd,N.Menu=ya,N.Mermaid=nv,N.Messager=Ms,N.Modal=Ve,N.ModalBase=Bi,N.ModalTrigger=Ui,N.Moveable=Ni,N.Nav=ud,N.NestedList=Er,N.PageEditor=Zi,N.Pager=fd,N.Pick=tl,N.Picker=sl,N.Popover=qt,N.PopoverPanel=Fa,N.Portal=kh,N.PriPicker=Rl,N.ProgressCircle=wa,N.RangePicker=Ol,N.ReactComponent=ae,N.SearchBox=nl,N.SearchForm=is,N.SearchMenu=va,N.SearchTree=yd,N.SeverityPicker=Fl,N.Sidebar=qr,N.Signal=vt,N.Sortable=Ca,N.SortableList=xa,N.SortableTree=ka,N.Split=$a,N.Sticky=Qo,N.SuggestionMenu=oo,N.SvgBox=Hl,N.TEditor=dv,N.TIME_DAY=ki,N.Tabs=mo,N.TimePicker=ja,N.Toolbar=gd,N.Tooltip=Zn,N.Tree=rl,N.Upload=ol,N.UploadImgs=vd,N.UserAvatar=Vl,N.VERSION=kc,N.ZAIStore=pl,N.ZUI=ua,N.ZenEditor=yu,N.ZentaoAIStore=wx,N.ZentaoAgentResult=bl,N.ZentaoFormHelper=Al,N.Zinbar=_u,N.addDate=Ap,N.addQueryToSearchForm=lv,N.ajaxSubmit=ri,N.batch=fn,N.bindCommands=$i,N.bindHotkeys=eh,N.bus=Ts,N.cash=v,N.classes=K,N.clearData=Jb,N.computed=xe,N.convertBytes=ks,N.cookie=Em,N.copy=fh,N.copyText=Wp,N.create=Jo,N.createDate=Je,N.createFormData=gr,N.createPortal=vm,N.createRef=ye,N.debounce=hh,N.deepCall=ls,N.deepGet=mr,N.deepGetPath=rp,N.defineFn=uw,N.delay=Ss,N.dexie=xC,N.disableScroll=Go,N.dom=kw,N.downloadFile=Ks,N.effect=Tt,N.enterFullscreen=Ip,N.escapeHtml=Us,N.evalValue=ln,N.executeCommand=oh,N.executeCommands=ah,N.fetchData=Ne,N.formHelper=B0,N.formatBytes=pt,N.formatDate=rt,N.formatDateSpan=_w,N.formatString=$e,N.getClassList=Bc,N.getComponent=wr,N.getFullscreenElement=Zo,N.getHotkeysMap=Qc,N.getLib=uh,N.getReactComponent=pm,N.getUniqueCode=rh,N.getZData=Ci,N.getZentaoPageType=Rg,N.h=g,N.hotkeys=dw,N.htm=Sh,N.html=Fw,N.i18n=Pe,N.init=nh,N.initGlobalComponents=sh,N.isDiff=yr,N.isFetchSetting=ph,N.isNotEmptyString=jn,N.isSameDay=un,N.isSameMonth=ea,N.isSameWeek=yw,N.isSameYear=Cr,N.isToday=Pp,N.isTomorrow=vw,N.isValidDate=ih,N.isYesterday=Lp,N.jsRaw=Xb,N.jsx=zw,N.loadCSS=Bp,N.loadJS=Hp,N.loadModule=Up,N.mapFormData=Gy,N.mergeProps=Le,N.morph=Cd,N.nextGid=Xe,N.parseCommand=ta,N.parseCommands=Rp,N.parseRawData=Ho,N.parseSize=dn,N.processSubmitResult=cu,N.reactComponentMap=Ch,N.reactComponents=fm,N.readFile=ww,N.registerComponent=Np,N.registerGlobalCommand=Fp,N.registerGlobalListener=kp,N.registerLib=dh,N.registerReactComponent=ot,N.removeUndefinedProps=Yc,N.render=hn,N.renderCustomContent=da,N.renderCustomResult=mm,N.runJS=kr,N.selectFile=ch,N.setFormDataValue=Bn,N.setLibRoot=jp,N.setZData=Hc,N.shareData=lp,N.showCommentModal=nu,N.showInfo=pv,N.signal=pe,N.store=st,N.storeData=Bo,N.takeData=vr,N.toCssSize=je,N.toggleFullscreen=Yo,N.toggleSearchForm=mu,N.tryExec=Vp,N.uid=Ft,N.unbindCommands=xr,N.unbindHotkeys=th,N.untracked=vh,N.updateSearchForm=av,N.vhtml=xm,N.zentaoFormHelper=lk,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
