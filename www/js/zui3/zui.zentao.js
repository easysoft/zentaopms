var xd=($,st,Ot)=>{if(!st.has($))throw TypeError("Cannot "+Ot)};var Rt=($,st,Ot)=>(xd($,st,"read from private field"),Ot?Ot.call($):st.get($)),qt=($,st,Ot)=>{if(st.has($))throw TypeError("Cannot add the same private member more than once");st instanceof WeakSet?st.add($):st.set($,Ot)},Xt=($,st,Ot,Al)=>(xd($,st,"write to private field"),Al?Al.call($,Ot):st.set($,Ot),Ot);var Sd=($,st,Ot)=>(xd($,st,"access private method"),Ot);(function($,st){typeof exports=="object"&&typeof module<"u"?st(exports):typeof define=="function"&&define.amd?define(["exports"],st):($=typeof globalThis<"u"?globalThis:$||self,st($.zui={}))})(this,function($){var Za,el,Ur,Wr,Vr,Kr,qr,Gr,tl,Pv,nl,Lv,ii,si;"use strict";const st="",Ot="",Al="",vT="",_T="",bT="",wT="",CT="",xT="",ST="",kT="",TT="",jv="3.0.0",Bv="production",wn=document,uo=window,Id=wn.documentElement,pi=wn.createElement.bind(wn),$d=pi("div"),El=pi("table"),Hv=pi("tbody"),Ad=pi("tr"),{isArray:ho,prototype:Ed}=Array,{concat:Uv,filter:Nl,indexOf:Nd,map:Md,push:Wv,slice:Pd,some:Ml,splice:Vv}=Ed,Kv=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,qv=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,Gv=/<.+>/,Yv=/^\w+$/;function Pl(n,e){const t=Xv(e);return!n||!t&&!mi(e)&&!at(e)?[]:!t&&qv.test(n)?e.getElementsByClassName(n.slice(1).replace(/\\/g,"")):!t&&Yv.test(n)?e.getElementsByTagName(n):e.querySelectorAll(n)}class fo{constructor(e,t){if(!e)return;if(Ll(e))return e;let i=e;if(kt(e)){const s=t||wn;if(i=Kv.test(e)&&mi(s)?s.getElementById(e.slice(1).replace(/\\/g,"")):Gv.test(e)?jd(e):Ll(s)?s.find(e):kt(s)?y(s).find(e):Pl(e,s),!i)return}else if(gi(e))return this.ready(e);(i.nodeType||i===uo)&&(i=[i]),this.length=i.length;for(let s=0,r=this.length;s<r;s++)this[s]=i[s]}init(e,t){return new fo(e,t)}}const ie=fo.prototype,y=ie.init;y.fn=y.prototype=ie,ie.length=0,ie.splice=Vv,typeof Symbol=="function"&&(ie[Symbol.iterator]=Ed[Symbol.iterator]);function Ll(n){return n instanceof fo}function Gi(n){return!!n&&n===n.window}function mi(n){return!!n&&n.nodeType===9}function Xv(n){return!!n&&n.nodeType===11}function at(n){return!!n&&n.nodeType===1}function Qv(n){return!!n&&n.nodeType===3}function Jv(n){return typeof n=="boolean"}function gi(n){return typeof n=="function"}function kt(n){return typeof n=="string"}function Ft(n){return n===void 0}function js(n){return n===null}function Ld(n){return!isNaN(parseFloat(n))&&isFinite(n)}function Rl(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}y.isWindow=Gi,y.isFunction=gi,y.isArray=ho,y.isNumeric=Ld,y.isPlainObject=Rl;function mt(n,e,t){if(t){let i=n.length;for(;i--;)if(e.call(n[i],i,n[i])===!1)return n}else if(Rl(n)){const i=Object.keys(n);for(let s=0,r=i.length;s<r;s++){const o=i[s];if(e.call(n[o],o,n[o])===!1)return n}}else for(let i=0,s=n.length;i<s;i++)if(e.call(n[i],i,n[i])===!1)return n;return n}y.each=mt,ie.each=function(n){return mt(this,n)},ie.empty=function(){return this.each((n,e)=>{for(;e.firstChild;)e.removeChild(e.firstChild)})};function po(...n){const e=Jv(n[0])?n.shift():!1,t=n.shift(),i=n.length;if(!t)return{};if(!i)return po(e,y,t);for(let s=0;s<i;s++){const r=n[s];for(const o in r)e&&(ho(r[o])||Rl(r[o]))?((!t[o]||t[o].constructor!==r[o].constructor)&&(t[o]=new r[o].constructor),po(e,t[o],r[o])):t[o]=r[o]}return t}y.extend=po,ie.extend=function(n){return po(ie,n)};const Zv=/\S+/g;function mo(n){return kt(n)?n.match(Zv)||[]:[]}ie.toggleClass=function(n,e){const t=mo(n),i=!Ft(e);return this.each((s,r)=>{at(r)&&mt(t,(o,a)=>{i?e?r.classList.add(a):r.classList.remove(a):r.classList.toggle(a)})})},ie.addClass=function(n){return this.toggleClass(n,!0)},ie.removeAttr=function(n){const e=mo(n);return this.each((t,i)=>{at(i)&&mt(e,(s,r)=>{i.removeAttribute(r)})})};function e_(n,e){if(n){if(kt(n)){if(arguments.length<2){if(!this[0]||!at(this[0]))return;const t=this[0].getAttribute(n);return js(t)?void 0:t}return Ft(e)?this:js(e)?this.removeAttr(n):this.each((t,i)=>{at(i)&&i.setAttribute(n,e)})}for(const t in n)this.attr(t,n[t]);return this}}ie.attr=e_,ie.removeClass=function(n){return arguments.length?this.toggleClass(n,!1):this.attr("class","")},ie.hasClass=function(n){return!!n&&Ml.call(this,e=>at(e)&&e.classList.contains(n))},ie.get=function(n){return Ft(n)?Pd.call(this):(n=Number(n),this[n<0?n+this.length:n])},ie.eq=function(n){return y(this.get(n))},ie.first=function(){return this.eq(0)},ie.last=function(){return this.eq(-1)};function t_(n){return Ft(n)?this.get().map(e=>at(e)||Qv(e)?e.textContent:"").join(""):this.each((e,t)=>{at(t)&&(t.textContent=n)})}ie.text=t_;function Cn(n,e,t){if(!at(n))return;const i=uo.getComputedStyle(n,null);return t?i.getPropertyValue(e)||void 0:i[e]||n.style[e]}function ln(n,e){return parseInt(Cn(n,e),10)||0}function Rd(n,e){return ln(n,`border${e?"Left":"Top"}Width`)+ln(n,`padding${e?"Left":"Top"}`)+ln(n,`padding${e?"Right":"Bottom"}`)+ln(n,`border${e?"Right":"Bottom"}Width`)}const Ol={};function n_(n){if(Ol[n])return Ol[n];const e=pi(n);wn.body.insertBefore(e,null);const t=Cn(e,"display");return wn.body.removeChild(e),Ol[n]=t!=="none"?t:"block"}function Od(n){return Cn(n,"display")==="none"}function Fd(n,e){const t=n&&(n.matches||n.webkitMatchesSelector||n.msMatchesSelector);return!!t&&!!e&&t.call(n,e)}function go(n){return kt(n)?(e,t)=>Fd(t,n):gi(n)?n:Ll(n)?(e,t)=>n.is(t):n?(e,t)=>t===n:()=>!1}ie.filter=function(n){const e=go(n);return y(Nl.call(this,(t,i)=>e.call(t,i,t)))};function zn(n,e){return e?n.filter(e):n}ie.detach=function(n){return zn(this,n).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),this};const i_=/^\s*<(\w+)[^>]*>/,s_=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,zd={"*":$d,tr:Hv,td:Ad,th:Ad,thead:El,tbody:El,tfoot:El};function jd(n){if(!kt(n))return[];if(s_.test(n))return[pi(RegExp.$1)];const e=i_.test(n)&&RegExp.$1,t=zd[e]||zd["*"];return t.innerHTML=n,y(t.childNodes).detach().get()}y.parseHTML=jd,ie.has=function(n){const e=kt(n)?(t,i)=>Pl(n,i).length:(t,i)=>i.contains(n);return this.filter(e)},ie.not=function(n){const e=go(n);return this.filter((t,i)=>(!kt(n)||at(i))&&!e.call(i,t,i))};function xn(n,e,t,i){const s=[],r=gi(e),o=i&&go(i);for(let a=0,l=n.length;a<l;a++)if(r){const c=e(n[a]);c.length&&Wv.apply(s,c)}else{let c=n[a][e];for(;c!=null&&!(i&&o(-1,c));)s.push(c),c=t?c[e]:null}return s}function Bd(n){return n.multiple&&n.options?xn(Nl.call(n.options,e=>e.selected&&!e.disabled&&!e.parentNode.disabled),"value"):n.value||""}function r_(n){return arguments.length?this.each((e,t)=>{const i=t.multiple&&t.options;if(i||Jd.test(t.type)){const s=ho(n)?Md.call(n,String):js(n)?[]:[String(n)];i?mt(t.options,(r,o)=>{o.selected=s.indexOf(o.value)>=0},!0):t.checked=s.indexOf(t.value)>=0}else t.value=Ft(n)||js(n)?"":n}):this[0]&&Bd(this[0])}ie.val=r_,ie.is=function(n){const e=go(n);return Ml.call(this,(t,i)=>e.call(t,i,t))},y.guid=1;function cn(n){return n.length>1?Nl.call(n,(e,t,i)=>Nd.call(i,e)===t):n}y.unique=cn,ie.add=function(n,e){return y(cn(this.get().concat(y(n,e).get())))},ie.children=function(n){return zn(y(cn(xn(this,e=>e.children))),n)},ie.parent=function(n){return zn(y(cn(xn(this,"parentNode"))),n)},ie.index=function(n){const e=n?y(n)[0]:this[0],t=n?this:y(e).parent().children();return Nd.call(t,e)},ie.closest=function(n){const e=this.filter(n);if(e.length)return e;const t=this.parent();return t.length?t.closest(n):e},ie.siblings=function(n){return zn(y(cn(xn(this,e=>y(e).parent().children().not(e)))),n)},ie.find=function(n){return y(cn(xn(this,e=>Pl(n,e))))};const o_=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,a_=/^$|^module$|\/(java|ecma)script/i,l_=["type","src","nonce","noModule"];function c_(n,e){const t=y(n);t.filter("script").add(t.find("script")).each((i,s)=>{if(a_.test(s.type)&&Id.contains(s)){const r=pi("script");r.text=s.textContent.replace(o_,""),mt(l_,(o,a)=>{s[a]&&(r[a]=s[a])}),e.head.insertBefore(r,null),e.head.removeChild(r)}})}function u_(n,e,t,i,s){i?n.insertBefore(e,t?n.firstChild:null):n.nodeName==="HTML"?n.parentNode.replaceChild(e,n):n.parentNode.insertBefore(e,t?n:n.nextSibling),s&&c_(e,n.ownerDocument)}function jn(n,e,t,i,s,r,o,a){return mt(n,(l,c)=>{mt(y(c),(h,u)=>{mt(y(e),(p,m)=>{const v=t?u:m,b=t?m:u,C=t?h:p;u_(v,C?b.cloneNode(!0):b,i,s,!C)},a)},o)},r),e}ie.after=function(){return jn(arguments,this,!1,!1,!1,!0,!0)},ie.append=function(){return jn(arguments,this,!1,!1,!0)};function h_(n){if(!arguments.length)return this[0]&&this[0].innerHTML;if(Ft(n))return this;const e=/<script[\s>]/.test(n);return this.each((t,i)=>{at(i)&&(e?y(i).empty().append(n):i.innerHTML=n)})}ie.html=h_,ie.appendTo=function(n){return jn(arguments,this,!0,!1,!0)},ie.wrapInner=function(n){return this.each((e,t)=>{const i=y(t),s=i.contents();s.length?s.wrapAll(n):i.append(n)})},ie.before=function(){return jn(arguments,this,!1,!0)},ie.wrapAll=function(n){let e=y(n),t=e[0];for(;t.children.length;)t=t.firstElementChild;return this.first().before(e),this.appendTo(t)},ie.wrap=function(n){return this.each((e,t)=>{const i=y(n)[0];y(t).wrapAll(e?i.cloneNode(!0):i)})},ie.insertAfter=function(n){return jn(arguments,this,!0,!1,!1,!1,!1,!0)},ie.insertBefore=function(n){return jn(arguments,this,!0,!0)},ie.prepend=function(){return jn(arguments,this,!1,!0,!0,!0,!0)},ie.prependTo=function(n){return jn(arguments,this,!0,!0,!0,!1,!1,!0)},ie.contents=function(){return y(cn(xn(this,n=>n.tagName==="IFRAME"?[n.contentDocument]:n.tagName==="TEMPLATE"?n.content.childNodes:n.childNodes)))},ie.next=function(n,e,t){return zn(y(cn(xn(this,"nextElementSibling",e,t))),n)},ie.nextAll=function(n){return this.next(n,!0)},ie.nextUntil=function(n,e){return this.next(e,!0,n)},ie.parents=function(n,e){return zn(y(cn(xn(this,"parentElement",!0,e))),n)},ie.parentsUntil=function(n,e){return this.parents(e,n)},ie.prev=function(n,e,t){return zn(y(cn(xn(this,"previousElementSibling",e,t))),n)},ie.prevAll=function(n){return this.prev(n,!0)},ie.prevUntil=function(n,e){return this.prev(e,!0,n)},ie.map=function(n){return y(Uv.apply([],Md.call(this,(e,t)=>n.call(e,t,e))))},ie.clone=function(){return this.map((n,e)=>e.cloneNode(!0))},ie.offsetParent=function(){return this.map((n,e)=>{let t=e.offsetParent;for(;t&&Cn(t,"position")==="static";)t=t.offsetParent;return t||Id})},ie.slice=function(n,e){return y(Pd.call(this,n,e))};const d_=/-([a-z])/g;function Fl(n){return n.replace(d_,(e,t)=>t.toUpperCase())}ie.ready=function(n){const e=()=>setTimeout(n,0,y);return wn.readyState!=="loading"?e():wn.addEventListener("DOMContentLoaded",e),this},ie.unwrap=function(){return this.parent().each((n,e)=>{if(e.tagName==="BODY")return;const t=y(e);t.replaceWith(t.children())}),this},ie.offset=function(){const n=this[0];if(!n)return;const e=n.getBoundingClientRect();return{top:e.top+uo.pageYOffset,left:e.left+uo.pageXOffset}},ie.position=function(){const n=this[0];if(!n)return;const e=Cn(n,"position")==="fixed",t=e?n.getBoundingClientRect():this.offset();if(!e){const i=n.ownerDocument;let s=n.offsetParent||i.documentElement;for(;(s===i.body||s===i.documentElement)&&Cn(s,"position")==="static";)s=s.parentNode;if(s!==n&&at(s)){const r=y(s).offset();t.top-=r.top+ln(s,"borderTopWidth"),t.left-=r.left+ln(s,"borderLeftWidth")}}return{top:t.top-ln(n,"marginTop"),left:t.left-ln(n,"marginLeft")}};const Hd={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};ie.prop=function(n,e){if(n){if(kt(n))return n=Hd[n]||n,arguments.length<2?this[0]&&this[0][n]:this.each((t,i)=>{i[n]=e});for(const t in n)this.prop(t,n[t]);return this}},ie.removeProp=function(n){return this.each((e,t)=>{delete t[Hd[n]||n]})};const f_=/^--/;function zl(n){return f_.test(n)}const jl={},{style:p_}=$d,m_=["webkit","moz","ms"];function g_(n,e=zl(n)){if(e)return n;if(!jl[n]){const t=Fl(n),i=`${t[0].toUpperCase()}${t.slice(1)}`,s=`${t} ${m_.join(`${i} `)}${i}`.split(" ");mt(s,(r,o)=>{if(o in p_)return jl[n]=o,!1})}return jl[n]}const y_={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function Ud(n,e,t=zl(n)){return!t&&!y_[n]&&Ld(e)?`${e}px`:e}function v_(n,e){if(kt(n)){const t=zl(n);return n=g_(n,t),arguments.length<2?this[0]&&Cn(this[0],n,t):n?(e=Ud(n,e,t),this.each((i,s)=>{at(s)&&(t?s.style.setProperty(n,e):s.style[n]=e)})):this}for(const t in n)this.css(t,n[t]);return this}ie.css=v_;function Wd(n,e){try{return n(e)}catch{return e}}const __=/^\s+|\s+$/;function Vd(n,e){const t=n.dataset[e]||n.dataset[Fl(e)];return __.test(t)?t:Wd(JSON.parse,t)}function b_(n,e,t){t=Wd(JSON.stringify,t),n.dataset[Fl(e)]=t}function w_(n,e){if(!n){if(!this[0])return;const t={};for(const i in this[0].dataset)t[i]=Vd(this[0],i);return t}if(kt(n))return arguments.length<2?this[0]&&Vd(this[0],n):Ft(e)?this:this.each((t,i)=>{b_(i,n,e)});for(const t in n)this.data(t,n[t]);return this}ie.data=w_;function Kd(n,e){const t=n.documentElement;return Math.max(n.body[`scroll${e}`],t[`scroll${e}`],n.body[`offset${e}`],t[`offset${e}`],t[`client${e}`])}mt([!0,!1],(n,e)=>{mt(["Width","Height"],(t,i)=>{const s=`${e?"outer":"inner"}${i}`;ie[s]=function(r){if(this[0])return Gi(this[0])?e?this[0][`inner${i}`]:this[0].document.documentElement[`client${i}`]:mi(this[0])?Kd(this[0],i):this[0][`${e?"offset":"client"}${i}`]+(r&&e?ln(this[0],`margin${t?"Top":"Left"}`)+ln(this[0],`margin${t?"Bottom":"Right"}`):0)}})}),mt(["Width","Height"],(n,e)=>{const t=e.toLowerCase();ie[t]=function(i){if(!this[0])return Ft(i)?void 0:this;if(!arguments.length)return Gi(this[0])?this[0].document.documentElement[`client${e}`]:mi(this[0])?Kd(this[0],e):this[0].getBoundingClientRect()[t]-Rd(this[0],!n);const s=parseInt(i,10);return this.each((r,o)=>{if(!at(o))return;const a=Cn(o,"boxSizing");o.style[t]=Ud(t,s+(a==="border-box"?Rd(o,!n):0))})}});const qd="___cd";ie.toggle=function(n){return this.each((e,t)=>{if(!at(t))return;const i=Od(t);(Ft(n)?i:n)?(t.style.display=t[qd]||"",Od(t)&&(t.style.display=n_(t.tagName))):i||(t[qd]=Cn(t,"display"),t.style.display="none")})},ie.hide=function(){return this.toggle(!1)},ie.show=function(){return this.toggle(!0)};const Gd="___ce",Bl=".",Hl={focus:"focusin",blur:"focusout"},Yd={mouseenter:"mouseover",mouseleave:"mouseout"},C_=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function Ul(n){return Yd[n]||Hl[n]||n}function Wl(n){const e=n.split(Bl);return[e[0],e.slice(1).sort()]}ie.trigger=function(n,e){if(kt(n)){const[i,s]=Wl(n),r=Ul(i);if(!r)return this;const o=C_.test(r)?"MouseEvents":"HTMLEvents";n=wn.createEvent(o),n.initEvent(r,!0,!0),n.namespace=s.join(Bl),n.___ot=i}n.___td=e;const t=n.___ot in Hl;return this.each((i,s)=>{t&&gi(s[n.___ot])&&(s[`___i${n.type}`]=!0,s[n.___ot](),s[`___i${n.type}`]=!1),s.dispatchEvent(n)})};function Xd(n){return n[Gd]=n[Gd]||{}}function x_(n,e,t,i,s){const r=Xd(n);r[e]=r[e]||[],r[e].push([t,i,s]),n.addEventListener(e,s)}function Qd(n,e){return!e||!Ml.call(e,t=>n.indexOf(t)<0)}function yo(n,e,t,i,s){const r=Xd(n);if(e)r[e]&&(r[e]=r[e].filter(([o,a,l])=>{if(s&&l.guid!==s.guid||!Qd(o,t)||i&&i!==a)return!0;n.removeEventListener(e,l)}));else for(e in r)yo(n,e,t,i,s)}ie.off=function(n,e,t){if(Ft(n))this.each((i,s)=>{!at(s)&&!mi(s)&&!Gi(s)||yo(s)});else if(kt(n))gi(e)&&(t=e,e=""),mt(mo(n),(i,s)=>{const[r,o]=Wl(s),a=Ul(r);this.each((l,c)=>{!at(c)&&!mi(c)&&!Gi(c)||yo(c,a,o,e,t)})});else for(const i in n)this.off(i,n[i]);return this},ie.remove=function(n){return zn(this,n).detach().off(),this},ie.replaceWith=function(n){return this.before(n).remove()},ie.replaceAll=function(n){return y(n).replaceWith(this),this};function S_(n,e,t,i,s){if(!kt(n)){for(const r in n)this.on(r,e,t,n[r],s);return this}return kt(e)||(Ft(e)||js(e)?e="":Ft(t)?(t=e,e=""):(i=t,t=e,e="")),gi(i)||(i=t,t=void 0),i?(mt(mo(n),(r,o)=>{const[a,l]=Wl(o),c=Ul(a),h=a in Yd,u=a in Hl;c&&this.each((p,m)=>{if(!at(m)&&!mi(m)&&!Gi(m))return;const v=function(b){if(b.target[`___i${b.type}`])return b.stopImmediatePropagation();if(b.namespace&&!Qd(l,b.namespace.split(Bl))||!e&&(u&&(b.target!==m||b.___ot===c)||h&&b.relatedTarget&&m.contains(b.relatedTarget)))return;let C=m;if(e){let D=b.target;for(;!Fd(D,e);)if(D===m||(D=D.parentNode,!D))return;C=D}Object.defineProperty(b,"currentTarget",{configurable:!0,get(){return C}}),Object.defineProperty(b,"delegateTarget",{configurable:!0,get(){return m}}),Object.defineProperty(b,"data",{configurable:!0,get(){return t}});const S=i.call(C,b,b.___td);s&&yo(m,c,l,e,v),S===!1&&(b.preventDefault(),b.stopPropagation())};v.guid=i.guid=i.guid||y.guid++,x_(m,c,l,e,v)})}),this):this}ie.on=S_;function k_(n,e,t,i){return this.on(n,e,t,i,!0)}ie.one=k_;const T_=/\r?\n/g;function D_(n,e){return`&${encodeURIComponent(n)}=${encodeURIComponent(e.replace(T_,`\r
`))}`}const I_=/file|reset|submit|button|image/i,Jd=/radio|checkbox/i;ie.serialize=function(){let n="";return this.each((e,t)=>{mt(t.elements||[t],(i,s)=>{if(s.disabled||!s.name||s.tagName==="FIELDSET"||I_.test(s.type)||Jd.test(s.type)&&!s.checked)return;const r=Bd(s);if(!Ft(r)){const o=ho(r)?r:[r];mt(o,(a,l)=>{n+=D_(s.name,l)})}})}),n.slice(1)},window.$=y;function Zd(n,e){if(n==null)return[n,void 0];typeof e=="string"&&(e=e.split("."));const t=e.join(".");let i=n;const s=[i];for(;typeof i=="object"&&i!==null&&e.length;){let r=e.shift(),o;const a=r.indexOf("[");if(a>0&&a<r.length-1&&r.endsWith("]")&&(o=r.substring(a+1,r.length-1),r=r.substring(0,a)),i=i[r],s.push(i),o!==void 0)if(typeof i=="object"&&i!==null)i instanceof Map?i=i.get(o):i=i[o],s.push(i);else throw new Error(`Cannot access property "${r}[${o}]", the full path is "${t}".`)}if(e.length)throw new Error(`Cannot access property with rest path "${e.join(".")}", the full path is "${t}".`);return s}function Bs(n,e,t){try{const i=Zd(n,e),s=i[i.length-1];return s===void 0?t:s}catch{return t}}function Bn(n,e,t,i){const s=Bs(n,e);return typeof s=="function"?s.apply(i||n,t):s}function $_(n){return typeof n=="string"&&n!==""}function we(n,...e){if(e.length===0)return n;if(e.length===1&&typeof e[0]=="object"&&e[0]){const t=e[0];return Object.keys(t).forEach(i=>{const s=t[i]??"";n=n.replace(new RegExp(`\\{${i}\\}`,"g"),`${s}`)}),n}for(let t=0;t<e.length;t++){const i=e[t]??"";n=n.replace(new RegExp(`\\{${t}\\}`,"g"),`${i}`)}return n}var Vl=(n=>(n[n.B=1]="B",n[n.KB=1024]="KB",n[n.MB=1048576]="MB",n[n.GB=1073741824]="GB",n[n.TB=1099511627776]="TB",n))(Vl||{});function vt(n,e=2,t){return Number.isNaN(n)?"?KB":(t||(n<1024?t="B":n<1048576?t="KB":n<1073741824?t="MB":n<1099511627776?t="GB":t="TB"),(n/Vl[t]).toFixed(e)+t)}const Sn=n=>{const e=/^[0-9]*(B|KB|MB|GB|TB)$/;n=n.toUpperCase(),n.endsWith("B")||(n+="B");const t=n.match(e);if(!t)return 0;const i=t[1];return n=n.replace(i,""),Number.parseInt(n,10)*Vl[i]};let Kl=(document.documentElement.getAttribute("lang")||"zh_cn").toLowerCase().replace("-","_"),kn;function ef(){return Kl}function A_(n){Kl=n.toLowerCase().replace("-","_")}function tf(n,e){kn||(kn={}),typeof n=="string"&&(n={[n]:e??{}}),y.extend(!0,kn,n)}function Ne(n,e,t,i,s,r){Array.isArray(n)?kn&&n.unshift(kn):n=kn?[kn,n]:[n],typeof t=="string"&&(r=s,s=i,i=t,t=void 0);const o=s||Kl;let a;for(const l of n){if(!l)continue;const c=l[o]||l.default;if(!c)continue;const h=r&&l===kn?`${r}.${e}`:e;if(a=Bs(c,h),a!==void 0)break}return a===void 0?i:t?we(a,...Array.isArray(t)?t:[t]):a}function E_(n,e,t,i){return Ne(void 0,n,e,t,i)}Ne.addLang=tf,Ne.getLang=E_,Ne.getCode=ef,Ne.setCode=A_,Ne.map=kn,tf({zh_cn:{confirm:"确定",save:"保存",cancel:"取消",delete:"删除",reset:"重置",add:"添加",copy:"复制",close:"关闭"},zh_tw:{confirm:"確定",save:"儲存",cancel:"取消",delete:"刪除",reset:"重置",add:"添加",Copy:"複製",close:"關閉"},en:{confirm:"Confirm",save:"Save",cancel:"Cancel",delete:"Delete",reset:"Reset",add:"Add",copy:"Copy",close:"Close"}});function yi(n,e,t){t!=null&&(Array.isArray(t)?t.forEach(i=>yi(n,e,i)):!(t instanceof Blob)&&y.isPlainObject(t)?Object.entries(t).forEach(([i,s])=>{yi(n,`${e}[${i}]`,s)}):n.append(e,t instanceof Blob?t:String(t)))}function vo(n,e){const t=e||new FormData;return n&&(typeof n=="string"&&(n=new URLSearchParams(n)),n instanceof URLSearchParams?n.forEach((i,s)=>{yi(t,s,i)}):Array.isArray(n)?n.forEach(([i,s])=>{yi(t,i,s)}):n instanceof FormData?n.forEach((i,s)=>{yi(t,s,i)}):typeof n=="object"&&n&&Object.entries(n).forEach(([i,s])=>{yi(t,i,s)})),t}function nf(n,e,t){n instanceof Headers?n.set(e,t):Array.isArray(n)?n.push([e,t]):n[e]=t}function N_(n,e){if(n){const t={text:"text/plain",html:"text/html",json:"application/json",...e};for(const[i,s]of Object.entries(t))if(s.split(",").map(r=>r.trim()).includes(n))return i}return"text"}class Hs{get completed(){return this.data!==void 0||this.error!==void 0}get[Symbol.toStringTag](){return"Ajax"}constructor(e){this.setting=e,this._controller=new AbortController,this._callbacks={success:[],error:[],complete:[]}}on(e,t){return this._callbacks[e].push(t),this}success(e){return this.on("success",e)}done(e){return this.success(e)}fail(e){return this.on("error",e)}complete(e){return this.on("complete",e)}always(e){return this.complete(e)}then(e,t){return this.completed?t&&this.error?t(this.error):e(this.data):(this.success(i=>e(i)),t&&this.fail(t)),this}catch(e){return this.error?(e(this.error),this):this.on("error",t=>e(t))}finally(e){return this.completed?(e(),this):this.complete(()=>e())}abort(e){return this.completed?!1:(this._abortError=e,this._controller.abort(),!0)}getResponseHeader(e){var t;return(t=this.response)==null?void 0:t.headers.get(e)}_init(){if(this.completed)return;const{url:e,type:t,data:i,processData:s=!0,contentType:r,crossDomain:o,accepts:a,dataType:l,timeout:c,dataFilter:h,beforeSend:u,success:p,error:m,complete:v,...b}=this.setting;t&&(b.method=t);let C=i;C&&(s&&(C=vo(C)),b.body=C),o&&(b.mode="cors");const S=b.headers||{};nf(S,"X-Requested-With","XMLHttpRequest"),r&&nf(S,"Content-Type",r),b.headers=S,b.signal&&b.signal.addEventListener("abort",()=>{this.abort()});const D=[...this.constructor.globalBeforeSends,u];for(const N of D){if(!N)continue;const P=N.call(this,b);if(P===!1)return;P&&Object.assign(b,P)}p&&this.success(p),m&&this.fail(m),v&&this.complete(v),b.signal=this._controller.signal,this.url=e,this.request=b}_emit(e,...t){this._callbacks[e].forEach(i=>{i.call(this,...t)})}async send(){var h;if(this.completed)return[];this._init();const{timeout:e,dataType:t,accepts:i,dataFilter:s,throws:r,jsonParser:o}=this.setting;e&&(this._timeoutID=window.setTimeout(()=>{this.abort(new Error("timeout"))},e));let a,l,c;try{a=await fetch(this.url,this.request),this.response=a;const{statusText:u}=a;if(a.ok){const p=(h=a.headers.get("Content-Disposition"))==null?void 0:h.startsWith("attachment"),m=p?"blob":t||N_(a.headers.get("Content-Type"),i);p||m==="blob"||m==="file"?c=await a.blob():m==="json"?typeof o=="function"?(c=await a.text(),c=o(c)):c=await a.json():c=await a.text(),this.data=c;const v=(s==null?void 0:s(c,m))??c;this._emit("success",v,u,a)}else throw this.data=await a.text(),new Error(u)}catch(u){this.data===void 0&&c!==void 0&&(this.data=c),l=u;let p=!1;l.name==="AbortError"&&(this._abortError?l=this._abortError:p=!0),this.error=l,p||this._emit("error",l,a==null?void 0:a.statusText,l.message)}if(this._timeoutID&&clearTimeout(this._timeoutID),this._emit("complete",a,a==null?void 0:a.statusText),l&&r)throw l;return[c,l,a]}}Hs.globalBeforeSends=[],y.ajax=(n,e)=>{e=e||{},typeof n=="string"?e.url=n:y.extend(e,n);const t=new Hs(e);return t.send(),t},y.getJSON=(n,e,t)=>(typeof e=="function"&&(t=e,e=void 0),y.ajax({url:n,data:e,success:t,dataType:"json"})),y.get=(n,e,t,i,s="GET")=>{let r,o;return typeof e=="function"?(r=e,o=void 0):o=e,typeof t=="function"?(r=t,i=void 0):i=t,y.ajax({method:s,url:n,data:o,success:r,dataType:i})},y.post=(n,e,t,i)=>y.get(n,e,t,i,"POST"),y.fn.load=function(n,e,t){typeof e=="function"&&(t=e,e=void 0);const[i,s]=n.split(" ");return y.get(i,e,(r,o,a)=>{s&&(r=y(r).find(s).html()),y(this).html(r).zuiInit(),t==null||t.call(this,r,o,a)},"html"),this};async function _t(n,e=[],t,i,s){const r={throws:!0,dataType:"json"};if(typeof n=="string")r.url=n;else if(typeof n=="object")y.extend(r,n);else if(typeof n=="function"){const l=n.call(i,...e);return l instanceof Promise?await l:l}t&&y.extend(r,typeof t=="function"?t(r):t),r.url&&(r.url=we(r.url,...e));const o=new Hs(r);s==null||s(o);const[a]=await o.send();return a}function ql(n){return!!(n&&(typeof n=="string"||typeof n=="object"&&n.url||typeof n=="function"))}y.fetch=_t;function Tt(){return y.guid++}function _o(n,e){if(n===e)return!1;if(n&&e){const t=typeof n,i=typeof e;if(t!==i)return!0;if(t==="object"&&i==="object"){const s=Array.isArray(n),r=Array.isArray(e);if(s!==r)return!0;if(s&&r){if(n.length!==e.length)return!0;for(let l=0;l<n.length;l++)if(_o(n[l],e[l]))return!0;return!1}const o=Object.keys(n),a=Object.keys(e);if(o.length!==a.length)return!0;for(const l of o)if(_o(n[l],e[l]))return!0;return!1}if(t==="function"&&i==="function")return n.toString()!==e.toString()}return n!==e}class vi{constructor(e,t){this._compute=e,this._dependencies=t}get value(){return this.compute()}get cache(){return this._lastDependencies?this._value:this.compute()}depends(e){return this._dependencies=e,this}forceCompute(e){return this._lastDependencies=void 0,this.compute(e)}compute(e){e!==void 0&&(this._dependencies=e),e=this._dependencies,typeof e=="function"&&(e=e());const t=this._lastDependencies;return(!t||e.some((i,s)=>i instanceof vi?i.value!==t[s]:_o(i,t[s])))&&(this._value=this._compute(),this._lastDependencies=e.map(i=>i instanceof vi?i.cache:i)),this._value}}function Gl(...n){const e=[],t=new Map,i=(s,r)=>{if(Array.isArray(s)&&(r=s[1],s=s[0]),!s.length)return;const o=t.get(s);typeof o=="number"?e[o][1]=!!r:(t.set(s,e.length),e.push([s,!!r]))};return n.forEach(s=>{typeof s=="function"&&(s=s()),Array.isArray(s)?Gl(...s).forEach(i):s&&typeof s=="object"?Object.entries(s).forEach(i):typeof s=="string"&&s.split(" ").forEach(r=>i(r,!0))}),e.sort((s,r)=>(t.get(s[0])||0)-(t.get(r[0])||0))}const V=(...n)=>Gl(...n).reduce((e,[t,i])=>(i&&e.push(t),e),[]).join(" ");y.classes=V,y.fn.setClass=function(n,...e){return this.each((t,i)=>{const s=y(i);n===!0?s.attr("class",V(s.attr("class"),...e)):s.addClass(V(n,...e))})};const Yi=new WeakMap;function bo(n,e,t){const i=Yi.has(n),s=i?Yi.get(n):{};typeof e=="string"?s[e]=t:e===null?Object.keys(s).forEach(r=>{delete s[r]}):Object.assign(s,e),Object.keys(s).forEach(r=>{s[r]===void 0&&delete s[r]}),Object.keys(s).length?(!i&&n instanceof Element&&Object.assign(s,y(n).dataset(),s),Yi.set(n,s)):Yi.delete(n)}function Us(n,e,t){let i=Yi.get(n)||{};return t&&n instanceof Element&&(i=Object.assign({},y(n).dataset(),i)),e===void 0?i:i[e]}function M_(n){Yi.delete(n)}y.fn.dataset=y.fn.data,y.fn.data=function(...n){const[e,t]=n;return!n.length||n.length===1&&typeof e=="string"?this.length?Us(this[0],e,!0):void 0:this.each((i,s)=>bo(s,e,t))},y.fn.removeData=function(n=null){return this.each((e,t)=>bo(t,n))};function _i(n,...e){return n.includes("RAWJS")&&(n=n.split('"RAWJS<').join("").split('>RAWJS"').join("").split("<RAWJS_QUOTE>").join('"').split("<RAWJS_LINE>").join(`
`)),new Function(`return ${n}`)(...e)}function Yl(n,...e){return n.includes("RAWJS")?_i(n,...e):JSON.parse(n)}function P_(n){return JSON.stringify(n,(e,t)=>{if(typeof t=="function")return`RAWJS<${t.toString().split('"').join("<RAWJS_QUOTE>").split(`
`).join("<RAWJS_LINE>")}>RAWJS`})}function Xi(n,e){const t=y(n)[0];if(!t)return;const{prefix:i,getter:s,evalValue:r,json:o=!0,evalArgs:a=[]}={prefix:"z-",...typeof e=="string"?{prefix:e}:e},l=Array.isArray(r)?new Set(r):void 0;return Array.from(t.attributes).reduce((c,h)=>{let{name:u}=h;const{value:p}=h;let m=p;if(u.startsWith(i)){if(u=u.slice(i.length).replace(/-([a-z])/g,v=>v[1].toUpperCase()),s)m=s(u,p);else try{r&&(!l||l.has(u))||r===void 0&&p.includes("RAWJS")?m=_i(p,...a):o&&(m=JSON.parse(p))}catch{}c[u]=m}return c},{})}function Xl(n,e,t="z-"){const i=y(n);Object.keys(e).forEach(s=>{let r=e[s];typeof r=="function"&&(r=`RAWJS<${r}>RAWJS`),typeof r!="string"&&(r=JSON.stringify(r)),s=s.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`),i.attr(`${t}${s}`,r)})}function L_(...n){var t;const e=n.length;if(!e)return Xi(this);if(e===1){const[i]=n;return typeof i=="string"?(t=Xi(this))==null?void 0:t[i]:(y.isPlainObject(i)&&Xl(this,i),this)}return Xl(this,{[n[0]]:n[1]}),this}y.fn.z=L_,y.fn._attr=y.fn.attr,y.fn.extend({attr(...n){const[e,t]=n;return!n.length||n.length===1&&typeof e=="string"?this._attr.apply(this,n):typeof e=="object"?(e&&Object.keys(e).forEach(i=>{const s=e[i];s===null?this.removeAttr(i):this._attr(i,s)}),this):t===null?this.removeAttr(e):this._attr(e,t)}}),y.Event||(y.Event=(n,e)=>{const[t,...i]=n.split("."),s=new Event(t,{bubbles:!0,cancelable:!0});return s.namespace=i.join("."),s.___ot=t,s.___td=e,s});const bi=(n,e)=>new Promise(t=>{const i=window.setTimeout(t,n);e&&e(i)}),sf={};y.share=sf;var wo,Ue,rf;$.isValidElement=void 0;var wi,of,af,Ql,Jl,Zl,ec,Ws={},lf=[],R_=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Co=Array.isArray;function Hn(n,e){for(var t in e)n[t]=e[t];return n}function cf(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function w(n,e,t){var i,s,r,o={};for(r in e)r=="key"?i=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?wo.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)o[r]===void 0&&(o[r]=n.defaultProps[r]);return xo(n,o,i,s,null)}function xo(n,e,t,i,s){var r={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++rf,__i:-1,__u:0};return s==null&&Ue.vnode!=null&&Ue.vnode(r),r}function he(){return{current:null}}function Tn(n){return n.children}function me(n,e){this.props=n,this.context=e}function Qi(n,e){if(e==null)return n.__?Qi(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?Qi(n):null}function uf(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return uf(n)}}function hf(n){(!n.__d&&(n.__d=!0)&&wi.push(n)&&!So.__r++||of!==Ue.debounceRendering)&&((of=Ue.debounceRendering)||af)(So)}function So(){var n,e,t,i,s,r,o,a;for(wi.sort(Ql);n=wi.shift();)n.__d&&(e=wi.length,i=void 0,r=(s=(t=n).__v).__e,o=[],a=[],t.__P&&((i=Hn({},s)).__v=s.__v+1,Ue.vnode&&Ue.vnode(i),tc(t.__P,i,s,t.__n,t.__P.namespaceURI,32&s.__u?[r]:null,o,r??Qi(s),!!(32&s.__u),a),i.__v=s.__v,i.__.__k[i.__i]=i,gf(o,i,a),i.__e!=r&&uf(i)),wi.length>e&&wi.sort(Ql));So.__r=0}function df(n,e,t,i,s,r,o,a,l,c,h){var u,p,m,v,b,C=i&&i.__k||lf,S=e.length;for(t.__d=l,O_(t,e,C),l=t.__d,u=0;u<S;u++)(m=t.__k[u])!=null&&(p=m.__i===-1?Ws:C[m.__i]||Ws,m.__i=u,tc(n,m,p,s,r,o,a,l,c,h),v=m.__e,m.ref&&p.ref!=m.ref&&(p.ref&&nc(p.ref,null,m),h.push(m.ref,m.__c||v,m)),b==null&&v!=null&&(b=v),65536&m.__u||p.__k===m.__k?l=ff(m,l,n):typeof m.type=="function"&&m.__d!==void 0?l=m.__d:v&&(l=v.nextSibling),m.__d=void 0,m.__u&=-196609);t.__d=l,t.__e=b}function O_(n,e,t){var i,s,r,o,a,l=e.length,c=t.length,h=c,u=0;for(n.__k=[],i=0;i<l;i++)(s=e[i])!=null&&typeof s!="boolean"&&typeof s!="function"?(o=i+u,(s=n.__k[i]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?xo(null,s,null,null,null):Co(s)?xo(Tn,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?xo(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=n,s.__b=n.__b+1,r=null,(a=s.__i=F_(s,t,o,h))!==-1&&(h--,(r=t[a])&&(r.__u|=131072)),r==null||r.__v===null?(a==-1&&u--,typeof s.type!="function"&&(s.__u|=65536)):a!==o&&(a==o-1?u--:a==o+1?u++:(a>o?u--:u++,s.__u|=65536))):s=n.__k[i]=null;if(h)for(i=0;i<c;i++)(r=t[i])!=null&&!(131072&r.__u)&&(r.__e==n.__d&&(n.__d=Qi(r)),yf(r,r))}function ff(n,e,t){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=ff(i[s],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=Qi(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function ko(n,e){return e=e||[],n==null||typeof n=="boolean"||(Co(n)?n.some(function(t){ko(t,e)}):e.push(n)),e}function F_(n,e,t,i){var s=n.key,r=n.type,o=t-1,a=t+1,l=e[t];if(l===null||l&&s==l.key&&r===l.type&&!(131072&l.__u))return t;if(i>(l!=null&&!(131072&l.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((l=e[o])&&!(131072&l.__u)&&s==l.key&&r===l.type)return o;o--}if(a<e.length){if((l=e[a])&&!(131072&l.__u)&&s==l.key&&r===l.type)return a;a++}}return-1}function pf(n,e,t){e[0]==="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||R_.test(e)?t:t+"px"}function To(n,e,t,i,s){var r;e:if(e==="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||pf(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||pf(n.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in n||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?i?t.u=i.u:(t.u=Jl,n.addEventListener(e,r?ec:Zl,r)):n.removeEventListener(e,r?ec:Zl,r);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!=="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function mf(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Jl++;else if(e.t<t.u)return;return t(Ue.event?Ue.event(e):e)}}}function tc(n,e,t,i,s,r,o,a,l,c){var h,u,p,m,v,b,C,S,D,N,P,H,q,Y,Q,Z,ue=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(h=Ue.__b)&&h(e);e:if(typeof ue=="function")try{if(S=e.props,D="prototype"in ue&&ue.prototype.render,N=(h=ue.contextType)&&i[h.__c],P=h?N?N.props.value:h.__:i,t.__c?C=(u=e.__c=t.__c).__=u.__E:(D?e.__c=u=new ue(S,P):(e.__c=u=new me(S,P),u.constructor=ue,u.render=j_),N&&N.sub(u),u.props=S,u.state||(u.state={}),u.context=P,u.__n=i,p=u.__d=!0,u.__h=[],u._sb=[]),D&&u.__s==null&&(u.__s=u.state),D&&ue.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Hn({},u.__s)),Hn(u.__s,ue.getDerivedStateFromProps(S,u.__s))),m=u.props,v=u.state,u.__v=e,p)D&&ue.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),D&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(D&&ue.getDerivedStateFromProps==null&&S!==m&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(S,P),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(S,u.__s,P)===!1||e.__v===t.__v)){for(e.__v!==t.__v&&(u.props=S,u.state=u.__s,u.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(J){J&&(J.__=e)}),H=0;H<u._sb.length;H++)u.__h.push(u._sb[H]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(S,u.__s,P),D&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(m,v,b)})}if(u.context=P,u.props=S,u.__P=n,u.__e=!1,q=Ue.__r,Y=0,D){for(u.state=u.__s,u.__d=!1,q&&q(e),h=u.render(u.props,u.state,u.context),Q=0;Q<u._sb.length;Q++)u.__h.push(u._sb[Q]);u._sb=[]}else do u.__d=!1,q&&q(e),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++Y<25);u.state=u.__s,u.getChildContext!=null&&(i=Hn(Hn({},i),u.getChildContext())),D&&!p&&u.getSnapshotBeforeUpdate!=null&&(b=u.getSnapshotBeforeUpdate(m,v)),df(n,Co(Z=h!=null&&h.type===Tn&&h.key==null?h.props.children:h)?Z:[Z],e,t,i,s,r,o,a,l,c),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),C&&(u.__E=u.__=null)}catch(J){if(e.__v=null,l||r!=null){for(e.__u|=l?160:128;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else e.__e=t.__e,e.__k=t.__k;Ue.__e(J,e,t)}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=z_(t.__e,e,t,i,s,r,o,l,c);(h=Ue.diffed)&&h(e)}function gf(n,e,t){e.__d=void 0;for(var i=0;i<t.length;i++)nc(t[i],t[++i],t[++i]);Ue.__c&&Ue.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(r){r.call(s)})}catch(r){Ue.__e(r,s.__v)}})}function z_(n,e,t,i,s,r,o,a,l){var c,h,u,p,m,v,b,C=t.props,S=e.props,D=e.type;if(D==="svg"?s="http://www.w3.org/2000/svg":D==="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((m=r[c])&&"setAttribute"in m==!!D&&(D?m.localName===D:m.nodeType===3)){n=m,r[c]=null;break}}if(n==null){if(D===null)return document.createTextNode(S);n=document.createElementNS(s,D,S.is&&S),a&&(Ue.__m&&Ue.__m(e,r),a=!1),r=null}if(D===null)C===S||a&&n.data===S||(n.data=S);else{if(r=r&&wo.call(n.childNodes),C=t.props||Ws,!a&&r!=null)for(C={},c=0;c<n.attributes.length;c++)C[(m=n.attributes[c]).name]=m.value;for(c in C)if(m=C[c],c!="children"){if(c=="dangerouslySetInnerHTML")u=m;else if(!(c in S)){if(c=="value"&&"defaultValue"in S||c=="checked"&&"defaultChecked"in S)continue;To(n,c,null,m,s)}}for(c in S)m=S[c],c=="children"?p=m:c=="dangerouslySetInnerHTML"?h=m:c=="value"?v=m:c=="checked"?b=m:a&&typeof m!="function"||C[c]===m||To(n,c,m,C[c],s);if(h)a||u&&(h.__html===u.__html||h.__html===n.innerHTML)||(n.innerHTML=h.__html),e.__k=[];else if(u&&(n.innerHTML=""),df(n,Co(p)?p:[p],e,t,i,D==="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,o,r?r[0]:t.__k&&Qi(t,0),a,l),r!=null)for(c=r.length;c--;)cf(r[c]);a||(c="value",D==="progress"&&v==null?n.removeAttribute("value"):v!==void 0&&(v!==n[c]||D==="progress"&&!v||D==="option"&&v!==C[c])&&To(n,c,v,C[c],s),c="checked",b!==void 0&&b!==n[c]&&To(n,c,b,C[c],s))}return n}function nc(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(s){Ue.__e(s,t)}}function yf(n,e,t){var i,s;if(Ue.unmount&&Ue.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||nc(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){Ue.__e(r,e)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&yf(i[s],e,t||typeof n.type!="function");t||cf(n.__e),n.__c=n.__=n.__e=n.__d=void 0}function j_(n,e,t){return this.constructor(n,t)}function Ci(n,e,t){var i,s,r,o;Ue.__&&Ue.__(n,e),s=(i=typeof t=="function")?null:t&&t.__k||e.__k,r=[],o=[],tc(e,n=(!i&&t||e).__k=w(Tn,null,[n]),s||Ws,Ws,e.namespaceURI,!i&&t?[t]:s?null:e.firstChild?wo.call(e.childNodes):null,r,!i&&t?t:s?s.__e:e.firstChild,i,o),gf(r,n,o)}wo=lf.slice,Ue={__e:function(n,e,t,i){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(n)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),o=s.__d),o)return s.__E=s}catch(a){n=a}throw n}},rf=0,$.isValidElement=function(n){return n!=null&&n.constructor==null},me.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Hn({},this.state),typeof n=="function"&&(n=n(Hn({},t),this.props)),n&&Hn(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),hf(this))},me.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),hf(this))},me.prototype.render=Tn,wi=[],af=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ql=function(n,e){return n.__v.__b-e.__v.__b},So.__r=0,Jl=0,Zl=mf(!1),ec=mf(!0);function ke(n,...e){return e.forEach(t=>{!t||typeof t!="object"||Object.keys(t).forEach(i=>{let s=t[i];const r=n[i];s!==r&&(r!==void 0&&(i==="className"||i.endsWith("Class")?s=[r,s]:i==="children"?s=[...ko(r),...ko(s)]:typeof r=="object"&&(i==="style"||i.endsWith("Style")||i==="attrs"||i.endsWith("Attrs")||i==="props")&&(s=y.extend(r,s))),n[i]=s)})}),n}function ic(n){return Object.keys(n).forEach(e=>{n[e]===void 0&&delete n[e]}),n}function vf(n,e=!0){const t=y(n),i=t[0],s="zui-disable-scroll";if(e){if(t.data(s))return;if((t.css("scrollbar-gutter")||"").includes("stable")){t.data(s,{overflow:t.css("overflow")}).css("overflow","hidden");return}const r=i===document.body||t.is("html")?window.innerWidth-document.body.clientWidth:i.offsetWidth-i.clientWidth;if(!r)return;const o=t.css("paddingRight")||"0";t.data(s,{paddingRight:o,overflow:t.css("overflow")}).css({paddingRight:`${r+Number.parseInt(o,10)}px`,overflow:"hidden"})}else{const r=t.data(s);if(!r)return;t.css(r).removeData(s)}}y.fn.disableScroll=function(n=!0){return this.each((e,t)=>{vf(t,n)})},y.fn.enableScroll=function(n=!0){return this.disableScroll(!n)};function sc(n,e,t){if(!(t.on||"click").split(" ").includes(e.type))return;const i=t.selector?y(e.target).closest(t.selector):n;if(!i.length)return;const s=c=>c===""?!0:c,r=c=>{if(typeof c=="string")try{c=JSON.parse(c)}catch{}return c};if(s(t.once)){if(t.onceCalled)return;n.dataset("once-called",!0)}if(s(t.prevent)&&e.preventDefault(),s(t.stop)&&e.stopPropagation(),s(t.self)&&e.currentTarget!==e.target)return;const o=[["$element",n],["event",e],["options",t],["$target",i]],a=c=>typeof c=="function"?c(...o):y.runJS(c,...o);if(t.if!==void 0&&!a(t.if))return;const l=t.call;if(l){let c;if(typeof l=="string"?c=/^[$A-Z_][0-9A-Z_$.]*$/i.test(l)?Bs(window,l):a(l):c=l,typeof c=="function"){const h=[],u=t.params;t.params=h,typeof u=="string"&&u.length?u[0]==="["?h.push(...r(u)):h.push(...u.split(", ").map(p=>(p=p.trim(),p==="$element"?n:p==="event"?e:p==="options"?t:p.startsWith("$element.")||p.startsWith("event.")||p.startsWith("options.")?a(p):r(p)))):Array.isArray(u)?h.push(...u):h.push(u),c(...h)}}t.do&&a(t.do)}function B_(n){const e=y(this),t=n.type,i=e.attr("zui-on");if(i){const[o,a]=i.split("~").map(l=>l.trim());o&&o.split(" ").includes(t)&&sc(e,n,y.extend({on:o},a?a.startsWith("{")?_i(a):{do:a}:Xi(e,{prefix:"data-",evalValue:["call","if","do"]})))}const s=e.attr(`zui-on-${t}`);s&&sc(e,n,y.extend({on:t},s.startsWith("{")?_i(s):{do:s}));const r=e.attr("data-on");r&&r.split(" ").includes(t)&&sc(e,n,Xi(e,{prefix:"data-",evalValue:["call","if","do"]}))}function _f(n){y(document).off(".zui.global").on(n.map(e=>`${e}.zui.global`).join(" "),`[zui-on],${n.map(e=>`[zui-on-${e}]`)},[data-on]`,B_)}y(()=>{_f(["click","change","inited"])});function xi(n,e){if(typeof n=="function")return xi(n(...e||[]));if(typeof n=="number")return[n];let t=n.match(/(\d+)(%|px)?/);return t?[parseInt(t[1]),t[2]]:(t=n.match(/(\d+)\/(\d+)/),t?[100*parseInt(t[1])/parseInt(t[2]),"%"]:[NaN])}function Ge(n,e){if(n==null)return null;const[t,i="px"]=xi(n,e);return Number.isNaN(t)?typeof n=="string"?n:null:`${t}${i}`}async function Ji(n,e){var i,s,r;if(n instanceof Blob){const o=document.createElement("a");return o.href=window.URL.createObjectURL(n),e&&(o.download=decodeURIComponent(e)),o.click(),o.remove(),n}if(n instanceof Response){const o=await n.blob();return e=e||((r=(s=(i=n.headers.get("Content-Disposition"))==null?void 0:i.split(";")[1])==null?void 0:s.split("=")[1])==null?void 0:r.replace(/"/g,"")),Ji(o,e)}const t=await fetch(n);return Ji(t)}class bf{constructor(e){this._$target=y(e)}on(...e){return this._$target.on(...e),this}one(...e){return this._$target.one(...e),this}off(...e){return this._$target.off(...e),this}trigger(...e){return this._$target.trigger(...e),this}}const un=new bf(document);y.bus=un,y.on=un.on.bind(un),y.one=un.one.bind(un),y.off=un.off.bind(un),y.trigger=un.trigger.bind(un);var H_=["Shift","Meta","Alt","Control"],wf=typeof navigator=="object"?navigator.platform:"",Cf=/Mac|iPod|iPhone|iPad/.test(wf),U_=Cf?"Meta":"Control",W_=wf==="Win32"?["Control","Alt"]:Cf?["Alt"]:[];function rc(n,e){return typeof n.getModifierState=="function"&&(n.getModifierState(e)||W_.includes(e)&&n.getModifierState("AltGraph"))}function V_(n){return n.trim().split(" ").map(function(e){var t=e.split(/\b\+/),i=t.pop();return[t=t.map(function(s){return s==="$mod"?U_:s}),i]})}function xf(n,e){var t;e===void 0&&(e={});var i=(t=e.timeout)!=null?t:1e3,s=Object.keys(n).map(function(a){return[V_(a),n[a]]}),r=new Map,o=null;return function(a){a instanceof KeyboardEvent&&(s.forEach(function(l){var c=l[0],h=l[1],u=r.get(c)||c;(function(p,m){return!(m[1].toUpperCase()!==p.key.toUpperCase()&&m[1]!==p.code||m[0].find(function(v){return!rc(p,v)})||H_.find(function(v){return!m[0].includes(v)&&m[1]!==v&&rc(p,v)}))})(a,u[0])?u.length>1?r.set(c,u.slice(1)):(r.delete(c),h(a)):rc(a,a.key)||r.delete(c)}),o&&clearTimeout(o),o=setTimeout(r.clear.bind(r),i))}}function K_(n,e,t){var i;t===void 0&&(t={});var s=(i=t.event)!=null?i:"keydown",r=xf(e,t);return n.addEventListener(s,r),function(){n.removeEventListener(s,r)}}function oc(n,e={}){if(!n)return;const t=Object.keys(e).reduce((i,s)=>(e[s].optional||(i[s]={...e[s]}),i),{});return Object.keys(n).forEach(i=>{const s=n[i];s?s===!0?e[i]&&(t[i]={...e[i]}):t[i]=s:delete t[i]}),Object.keys(t).reduce((i,s)=>{const{keys:r,handler:o}=t[s];return typeof r=="string"?i[r]=o:r.forEach(a=>{i[a]=o}),i},{})}function ac(n,e,t){const{timeout:i,event:s="keydown",scope:r,when:o}=t||{},a=xf(e,{timeout:i}),l=`.zui.hotkeys${r?`.${r}`:""}`,c="zui-hotkeys-composing";return y(n).on(`${s}${l}`,function(h){o&&o(h)===!1||y(h.target).data(c)||a(h)}).on(`compositionstart${l}`,h=>{y(h.target).data(c,!0)}).on(`compositionend${l}`,h=>{y(h.target).removeData(c)})}function lc(n,e){return y(n).off(`.zui.hotkeys${e?`.${e}`:""}`)}const q_=K_;y.fn.hotkeys=function(n,e){return ac(this,n,e)},y.fn.unbindHotkeys=function(n){return lc(this,n)},y.hotkeys=function(n,e){ac(window,n,e)},y.unbindHotkeys=function(n){lc(window,n)};function Do(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}async function Sf(n){(typeof n=="string"||n instanceof Element||n instanceof y)&&(n={target:n});const{target:e,onError:t,onSuccess:i,afterExit:s,afterEnter:r}=n,o=y(e),a=o[0];if(!a)return;const l=a.requestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen;if(!l){t==null||t.call(a,new Error("[ZUI] The browser does not support full screen feature."));return}try{await l.call(a),i==null||i.call(a),y(a).off(".zui.fullscreen"),s&&o.on("exitFullscreen.zui.fullscreen",s),r&&o.on("enterFullscreen.zui.fullscreen",r)}catch(c){t==null||t.call(a,c)}document.zuiBindFullscreenChange||(document.zuiBindFullscreenChange=!0,y(document).on("fullscreenchange.zui webkitfullscreenchange.zui mozfullscreenchange.zui",c=>{const h=Do();let u=h;h?y(h).addClass("is-in-fullscreen"):(u=y(document).find(".is-in-fullscreen")[0]||document,y(u).removeClass("is-in-fullscreen")),y("body").toggleClass("has-in-fullscreen",!!h);const p={event:c,target:u,fullscreenElement:h};y(u).trigger(h?"enterFullscreen":"exitFullscreen",p).trigger("toggleFullscreen",p)}))}async function cc(n){const e=Do();return n===!1&&!!e===n?n:e?(document.exitFullscreen(),!1):(await Sf(n),!0)}y.fn.fullscreen=function(n){return cc({target:this,...n})},y.getFullscreenElement=Do,y.toggleFullscreen=cc;function Un(n){return!n||n.parentNode===document?!1:n.parentNode?Un(n.parentNode):!0}y.isDetached=Un,y.fn.isDetached=function(){const n=this[0];return!n||Un(n)};const Si=class Iv{constructor(e,t){var v;this._inited=!1,this._autoDestory=0,this._destroyed=!1;const{KEY:i,DATA_KEY:s,MULTI_INSTANCE:r,NAME:o,ATTR_KEY:a,ALL:l,TYPED_ALL:c}=this.constructor;if(!o)throw new Error('[ZUI] The component must have a "NAME" static property.');const h=y(e);if(h.data(i)&&!r)throw new Error(`[ZUI] The component "${o}" has been initialized on element.`);const u=h[0];if(!u)throw new Error(`[ZUI] Invalid selector "${e}" for component "${o}", can not find the element matched.`);const p=Tt();this._gid=p,this._element=u,this.resetOptions(t),this._key=this.options.key??`__${p}`;let m=l.get(u);if(m?m.add(this):(m=new Set([this]),l.set(u,m)),c.has(o)?c.get(o).add(this):c.set(o,new Set([this])),h.data(i,this).attr(a,"").attr(s,`${p}`).attr("z-use",[...new Set([...m].map(b=>b.constructor.NAME))].join(",")),r){const b=`${i}:ALL`;let C=h.data(b);C||(C=new Map,h.data(b,C)),C.set(this._key,this)}this.init(),(v=this.options.$onCreate)==null||v.call(this),requestAnimationFrame(async()=>{var b;this._inited=!0,await this.afterInit(),this.emit("inited",this.options),(b=this.options.$onInited)==null||b.call(this)})}static get ZUI(){return this.NAME.replace(/(^[A-Z]+)/,e=>e.toLowerCase())}static get KEY(){return`zui.${this.NAME}`}static get NAMESPACE(){return`.zui.${this.ZUI}`}static get DATA_KEY(){return`data-zui-${this.NAME}`}static get ATTR_KEY(){return`z-use-${this.NAME}`}static get SELECTOR(){return`[${this.DATA_KEY}]`}get inited(){return this._inited}get destroyed(){return this._destroyed}get element(){return this._element}get key(){return this._key}get options(){return this._options}get gid(){return this._gid}get $element(){return y(this.element)}get $emitter(){return this.$element}get i18nData(){return[this.options.i18n,this.constructor.i18n]}init(){}afterInit(){}render(e,t){this.setOptions(e,t)}destroy(){var m;const{KEY:e,DATA_KEY:t,ALL:i,TYPED_ALL:s,NAME:r,MULTI_INSTANCE:o,ATTR_KEY:a}=this.constructor,{$element:l,element:c}=this;if(this.emit("destroyed"),this._destroyed=!0,l.off(this.namespace).removeData(e).removeAttr(a).removeAttr(t),o){const v=this.$element.data(`${e}:ALL`);if(v)if(v.delete(this._key),v.size===0)this.$element.removeData(`${e}:ALL`);else{const b=v.values().next().value;l.data(e,b).attr(t,String(b==null?void 0:b.gid))}}const h=i.get(c);h&&(h.delete(this),h.size===0&&i.delete(c));const u=s.get(r);u&&(u.delete(this),u.size===0&&s.delete(r));const p=i.get(c);p!=null&&p.size?l.attr("z-use",[...new Set([...p].map(v=>v.constructor.NAME))].join(",")):l.removeAttr("z-use"),(m=this.options.$onDestroy)==null||m.call(this)}autoDestroy(e=100){this._autoDestory&&clearTimeout(this._autoDestory),this._autoDestory=window.setTimeout(()=>{this._autoDestory=0,Un(this.element)&&this.destroy()},e)}setOptions(e,t){if(t){const i={...this.constructor.DEFAULT,...(e==null?void 0:e.$optionsFromDataset)!==!1?this.$element.dataset():{},...e},{$options:s}=i;if(s){const r=typeof s=="function"?s.call(this,this.element,i):s;r&&y.extend(i,r),delete i.$options}this._options=i}else e&&y.extend(this._options,e);return this._options}resetOptions(e){return this.setOptions(e,!0)}emit(e,...t){const i=y.Event(e);return i.__src=this,this.$emitter.trigger(i,[this,...t]),i}on(e,t,i){const s=this;this.$element[i!=null&&i.once?"one":"on"](this._wrapEvent(e),function(r,o){(!r.__src||r.__src===s)&&t.call(this,r,o)})}one(e,t){this.on(e,t,{once:!0})}off(e){this.$element.off(this._wrapEvent(e))}i18n(e,t,i){const{i18nData:s}=this;return Ne(s,e,t,i,this.options.lang,this.constructor.NAME)??Ne(s,e,t,i,this.options.lang)??`{i18n:${e}}`}get namespace(){return`${this.constructor.NAMESPACE}.${this._key}`}_wrapEvent(e){return e.split(" ").map(t=>t.includes(".")?t:`${t}${this.namespace}`).join(" ")}static get(e,t){const i=y(e);if(this.MULTI_INSTANCE&&t!==void 0){const s=i.data(`${this.KEY}:ALL`);return s?s.get(t):void 0}return i.data(this.KEY)}static isValid(e){return!0}static ensure(e,t){const i=this.get(e,t==null?void 0:t.key);if(i){if(this.isValid(i))return t&&i.setOptions(t),i;i.destroy()}return new this(e,t)}static getAll(e,t){var l;const{SELECTOR:i,ALL:s,TYPED_ALL:r}=this,o=[],a=c=>{c instanceof this&&(!t||t(c)!==!1)&&o.push(c)};return e?y(e).find(i).each((c,h)=>{var u;(u=s.get(h))==null||u.forEach(a)}):this!==Iv?(l=r.get(this.NAME))==null||l.forEach(a):s.forEach(c=>{c.forEach(a)}),o.sort((c,h)=>c.gid-h.gid)}static query(e,t,i){return e===void 0?this.getAll(void 0,i).pop():this.get(y(e).closest(this.SELECTOR),t)}static defineFn(e){let t=e||this.ZUI;y.fn[t]&&(t=`zui${this.NAME}`);const i=this;y.fn.extend({[t](s,...r){const o=typeof s=="object"?s:void 0,a=typeof s=="string"?s:void 0;let l;return this.each((c,h)=>{let u=i.get(h);if(u)o&&u.render(o);else{if(a)return;u=new i(h,o)}if(a){let p=u[a],m=u;p===void 0&&(m=u.$,p=m[a]),typeof p=="function"?l=p.call(m,...r):l=p}}),l!==void 0?l:this}})}static register(e,t){var s,r;e=e||this,t=(t??e.NAME).toLowerCase(),this.map.set(t,e);const i=(r=(s=e.toggle)==null?void 0:s.name)==null?void 0:r.toLowerCase();i&&i!==t&&this.toggleMap.set(i,e)}};Si.DEFAULT={},Si.MULTI_INSTANCE=!1,Si.ALL=new Map,Si.TYPED_ALL=new Map,Si.map=new Map,Si.toggleMap=new Map;let We=Si;function Vs(n){return We.map.get(n.toLowerCase())}function Io(n,e,t={}){let i=Vs(n);if(i||(i=uc(n)),!i)return null;const{$update:s,...r}=t;if(!i.MULTI_INSTANCE){const o=i.get(e);if(o)return s&&o.render(r,s==="reset"),o}return new i(e,r)}function G_(n,e,t={}){requestAnimationFrame(()=>Io(n,e,t))}function kf(n,e){We.register(n,e)}function uc(n){const{zui:e}=window;if(e){n=n==null?void 0:n.toLowerCase();for(const t in e){const i=t.toLowerCase()===n;if(n&&!i)continue;const s=e[t];if(!(typeof s!="function"||!s.NAME||!s.ZUI)&&(We.map.has(t.toLowerCase())||kf(s),i))return s}}}function Y_(n){var e;n?(e=Vs(n))==null||e.defineFn():window._zuiDefined||(uc(),We.map.forEach(t=>{t.defineFn()}),Object.assign(window,{_zuiDefined:!0}))}function X_(n,e={}){const t=y(n);let i=t.attr("zui-create");const{update:s,onCreate:r}=e,o=(a,l)=>{if(l={$update:s,$optionsFromDataset:!1,...l},r){const h=r(a,l);if(h===!1)return;h&&(l=h)}const c=l.$lib;if(c){delete l.$lib,y.getLib(c).then(()=>Io(a,n,l));return}G_(a,n,l)};if(typeof i=="string"){i=i.trim();const a=i.length?i.split(",").map(h=>h.trim()):[],l=Xi(n,{prefix:"zui-create-",evalValue:!0}),c=Object.keys(l);if(!c.length&&a.length===1)o(a[0],t.dataset());else{const h=new Set;[...a,...c].forEach(u=>{if(h.has(u))return;const p=l[u];o(u,p),delete l[u],h.add(u)})}}else{const a=t.dataset(),l=a==null?void 0:a.zui;if(!l)return;console.warn("[ZUI] create component instance with [data-zui] is deprecated, use [zui-create] instead.",{element:n,options:e}),delete a.zui,o(l,a)}}function Q_(){y(document).on("click.zui.toggle mouseenter.zui.toggle","[data-toggle],[zui-toggle]",function(n){const e=y(this),t=e.dataset("toggle")||e.attr("zui-toggle");if(!t)return;const i=We.toggleMap.get(t)||Vs(t),s=i==null?void 0:i.toggle;if(!s)return;const{trigger:r="click",skip:o="[disabled],.disabled",check:a}=s,l=n.type==="mouseover"?"hover":"click";if(!r.includes(l)||a&&!a.call(i,this,l,n)||o&&e.is(o))return;const{onGet:c,onCreate:h,setOptions:u=!0,getOptions:p,prevent:m=!0,handler:v,onToggle:b,convertHref:C}=s;let S=e.dataset();const D=e.attr(`zui-toggle-${t}`);if(D&&(S=y.extend(S,_i(D))),C&&e.is("a")){const P=e.attr("href");if(P){const H=C===!0?{selector:"target",url:"url"}:C;"#.".includes(P[0])?H.selector&&S[H.selector]===void 0&&(S[H.selector]=P):H.url&&S[H.url]===void 0&&(S[H.url]=P)}}if(p&&(S=p.call(i,this,S,n)),v){v.call(i,this,S,l,n),m&&n.preventDefault();return}let N=c?c.call(i,this):i.get(this);if(N)u&&N.setOptions(S);else{const P=h?h.call(i,this,n,S):new i(this,S);if(!P)return;N=P}if(b){if(b.call(i,N,this,n)===!1)return}else{const{shown:P,show:H,hide:q,toggle:Y}=N;let Q;if(Y?Q=Y:H&&q?P?Q=q:Q=H:H&&(Q=H),Q)Q.call(N);else return}m&&n.preventDefault()})}function J_(n,e){const t=Us(n),i=[];return Object.keys(t).forEach(s=>{if(!s.startsWith("zui."))return;const r=t[s];(e==null?void 0:e(r,s))!==!1&&i.push(t[s])}),i}let $o=0;function Tf(n=100){if($o&&clearTimeout($o),n){$o=window.setTimeout(()=>Tf(0),n);return}$o=0,We.ALL.forEach(e=>{e.forEach(t=>t.autoDestroy())})}function Z_(){if(!document.body||Us(document.body,"_autoDestoryMob"))return;const n=new MutationObserver(e=>{let t=!1;for(const i of e)if(i.removedNodes.length){t=!0;break}t&&Tf()});n.observe(document.body,{childList:!0,subtree:!0}),bo(document.body,"_autoDestoryMob",n)}function hc(n,e){const t=y(n);t.find("[zui-create],[data-zui]").each(function(){var i;((i=e==null?void 0:e.beforeCreate)==null?void 0:i.call(e,this))!==!1&&X_(this,e)}),t.find("[zui-init]").each(function(){this.hasAttribute("z-zui-inited")||(this.setAttribute("z-zui-inited",""),y.runJS(this.getAttribute("zui-init"),["$element",y(this)]))}),t.find(".hide-before-init").removeClass("invisible hidden opacity-0"),t.find(".scroll-into-view").scrollIntoView(),t.find('[data-on="inited"],[zui-on-inited]').each((i,s)=>{const r=y(s);r.zui()||r.trigger("inited")}),e!=null&&e.runJS&&t.runJS()}y.fn.zuiInit=function(n){return hc(this,n),this},y.fn.zui=function(n,e){const t=this[0];if(!t)return;if(typeof n!="string"){const s={};let r;return J_(t,(o,a)=>{s[a]=o,(!r||r.gid<o.gid)&&(r=s[a])}),n===!0?s:r}const i=Vs(n);return i?e===!0?i.getAll(t):i.query(t,e):y(t).data(`zui.${n}`)},y.fn.zuiCall=function(n,e=[]){return this.each(function(){const t=n.split("."),i=t.length>1?t[0]:void 0,s=t[t.length>1?1:0],r=y(this).zui(i),o=r==null?void 0:r[s];typeof o=="function"&&o.apply(r,e)}),this},y(()=>{y("body").zuiInit({update:!0}),Q_(),Z_()});class Ao extends We{get $targets(){const{$element:e}=this,{targets:t}=this.options;return t?e.find(t):e}_handleScroll(e,t,i){const{offset:s=1}=this.options,r=this.$targets,o=e.getBoundingClientRect(),{scrollTop:a,scrollLeft:l}=e;r.each((c,h)=>{const u=h.getBoundingClientRect(),p=t==="top"&&a>0&&u.top<=o.top+s||t==="bottom"&&u.bottom>=o.bottom-s||t==="left"&&l>0&&u.left<=o.left+s||t==="right"&&l<e.scrollWidth-e.clientWidth;h.classList.toggle(i,p)})}init(){const{offset:e=1,side:t="top",zIndex:i,pinnedClass:s="is-pinned",scrollContainer:r}=this.options,{$element:o,$targets:a}=this;if(a.css({position:"sticky",zIndex:i,[t]:0}),r){const l=o.closest(r)[0]||o.find(r)[0];if(l){const c=()=>{this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this._handleScroll(l,t,s)})};this._scrollListener=c,l.addEventListener("scroll",c)}this._container=l,requestAnimationFrame(()=>{this._handleScroll(l,t,s)})}else this._ob=new IntersectionObserver(l=>{l.forEach(c=>{c.target.classList.toggle(s,c.intersectionRatio<e)})},{threshold:[1]}),a.css("side",-e).each((l,c)=>this._ob.observe(c))}destroy(){var e;(e=this._ob)==null||e.disconnect(),this._container&&(this._container.removeEventListener("scroll",this._scrollListener),this._raf&&cancelAnimationFrame(this._raf))}}Ao.NAME="Sticky";const Zi=24*60*60*1e3,Ve=n=>n===void 0?new Date:(n instanceof Date||(typeof n=="string"&&(n=n.trim(),/^\d+$/.test(n)&&(n=Number.parseInt(n,10))),typeof n=="number"&&n<1e10&&(n*=1e3),n=new Date(n)),n),Df=(n,e,t="day")=>{if(typeof e=="string"){const i=Number.parseInt(e,10);t=e.replace(i.toString(),""),e=i}return n=new Date(Ve(n).getTime()),t==="month"?n.setMonth(n.getMonth()+e):t==="year"?n.setFullYear(n.getFullYear()+e):t==="week"?n.setDate(n.getDate()+e*7):t==="hour"?n.setHours(n.getHours()+e):t==="minute"?n.setMinutes(n.getMinutes()+e):t==="second"?n.setSeconds(n.getSeconds()+e):n.setDate(n.getDate()+e),n},Wn=(n,e=new Date)=>Ve(n).toDateString()===Ve(e).toDateString(),Ks=(n,e=new Date)=>Ve(n).getFullYear()===Ve(e).getFullYear(),dc=(n,e=new Date)=>(n=Ve(n),e=Ve(e),n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()),eb=(n,e=new Date)=>{n=Ve(n),e=Ve(e);const t=1e3*60*60*24,i=Math.floor(n.getTime()/t),s=Math.floor(e.getTime()/t);return Math.floor((i+4)/7)===Math.floor((s+4)/7)},tb=(n,e)=>Wn(Ve(e),n),nb=(n,e)=>Wn(Ve(e).getTime()-Zi,n),ib=(n,e)=>Wn(Ve(e).getTime()+Zi,n),fc=n=>n!=null&&!isNaN(Ve(n).getTime()),lt=(n,e="yyyy-MM-dd hh:mm",t="")=>{if(n=Ve(n),!fc(n))return t;if(typeof e=="function")return e(n);const i={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"H+":n.getHours()%12,"m+":n.getMinutes(),"s+":n.getSeconds(),"S+":n.getMilliseconds()};return/(y+)/i.test(e)&&(e.includes("[yyyy-]")&&(e=e.replace("[yyyy-]",Ks(n)?"":"yyyy-")),e=e.replace(RegExp.$1,`${n.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(i).forEach(s=>{if(new RegExp(`(${s})`).test(e)){const r=`${i[s]}`;e=e.replace(RegExp.$1,RegExp.$1.length===1?r:`00${r}`.substring(r.length))}}),e},sb=(n,e,t)=>{const i={full:"yyyy-M-d",month:"M-d",day:"d",str:"{0} ~ {1}",...t},s=lt(n,Ks(n)?i.month:i.full);if(Wn(n,e))return s;const r=lt(e,Ks(n,e)?dc(n,e)?i.day:i.month:i.full);return i.str.replace("{0}",s).replace("{1}",r)};function pc(n){let e=0;if(typeof n!="string"&&(n=String(n)),n&&n.length)for(let t=0;t<n.length;++t)e+=(t+1)*n.charCodeAt(t);return e}function Eo(n){if(!n)return;if(typeof n=="object")return n;if(n=n.replace(/^#/,""),!n.length)return;n.startsWith("/")||(n=`/${n}`);const e=new URL(window.location.origin+n),[,t="",...i]=e.pathname.split("/");let s=t.trim();if(!s.length)return;let r="";return s.includes("~")&&([r,s]=s.split("~")),{name:s,scope:r,options:Object.fromEntries([...e.searchParams.entries()].map(([o,a])=>{try{a.includes("%")&&(a=decodeURIComponent(a)),a=JSON.parse(a)}catch{}return[o,a]})),params:i.map(o=>{if(o!=="undefined"){if(o==="null")return null;try{return o.includes("%")&&(o=decodeURIComponent(o)),JSON.parse(o)}catch{return o}}})}}function If(n){if(Array.isArray(n))return{commands:n.map(Eo).filter(Boolean)};if(typeof n=="object")return n;n=n.replace(/^#!?/,"");const e=n.includes(">"),t=n.split(e?">":"|").map(Eo);return{async:e,commands:t.filter(Boolean)}}function mc(n,e,t){if(typeof n=="string"&&(n=Eo(n)),!n)return;const{execute:i,event:s,scope:r}=e;if(!(r&&n.scope&&n.scope!==r))return i({name:n.name,options:{...e.options,...n.options},event:s,scope:n.scope,prevResult:t},n.params)}async function $f(n,e){const{async:t,commands:i}=If(n);if(!i.length)return[];const{signal:s}=e;if(t){const o=[];let a;for(const l of i){if(!(s!=null&&s.aborted))break;a=await mc(l,e,a),s!=null&&s.aborted&&(a=void 0),o.push(a)}return o}return await Promise.all(i.map(o=>{if(!(s!=null&&s.aborted))return mc(o,e)}))}const es="zui.commands",ts="z-commands",gc="zui-commands-proxy",Af="zui-command";function No(n,e){typeof e=="string"?e={scope:e}:typeof e=="function"&&(e={onCommand:e});const{scope:t="",events:i="click"}=e??{},s=y(n),r=(s.attr(ts)||"").split(",");t&&!r.includes(t)&&r.push(t),s.attr(ts,r.join(",")).data(es,{[t]:{...e,scope:t,events:i,gid:Tt()},...s.data(es)})}function Mo(n,e=!0){const t=y(n);if(e===!0)t.removeAttr(ts),t.removeData(es);else if(e.length){const i=t.data(es)||{};e.split(",").forEach(r=>{delete i[r]});const s=Object.keys(i);s.length?t.attr(ts,s.join(",")).data(es,No):Mo(t,!0)}}function Ef(n,e){let t=n.closest(`[${ts}],[${gc}]`).first();if(t.attr(gc)!==void 0&&(t=y(t.data("zui.commandProxy")||t.attr(gc)).closest(`[${ts}]`)),!t.length)return;const i=t.data(es)||{},s=Object.values(i).sort((o,a)=>a.gid-o.gid);let r;return e!=null&&e.length?(r=s.find(o=>o.scope===e),r||(r=s.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped})),r):(r=s.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped}),r||(r=s.find(o=>!o.scoped)),r?r.element=t[0]:r=Ef(n.parent(),e),r)}function rb(n){if(!n.currentTarget)return;const e=y(n.currentTarget);if(e.closest(".disabled,[disabled]").length)return;const t=e.attr(Af)||(e.is('a[href^="#!"]')?e.attr("href"):"");if(!t)return;const i=new AbortController,s=()=>i.abort();$f(t,{signal:i.signal,execute:(r,o)=>{const{scope:a,name:l}=r,c={...r,abort:s};let h;const u=Ef(e,a);if(u){c.element=u.element;const m=(u.commands?u.commands[`${a}~${l}`]||u.commands[l]:null)||u.onCommand;if(m&&(h=m(c,o),n.commandHandled))return h}const p=[c,o];if(e.trigger("command",p).trigger(`command:${a?`${l}.${a}`:l}`,p),a&&e.trigger(`command:.${a}`,p),n.commandHandled)return h;if(a==="event"){l==="stop"?n.stopPropagation():l==="prevent"?n.preventDefault():Bn(n,l,o);return}return a==="window"?Bn(window,l,o):a==="zui"?Bn(window.zui,l,o):a==="target"?Bn(e[0],l,o):a==="$target"?Bn(e,l,o):a==="$"?Bn(y,l,o):h},event:n})}y.fn.command=function(n,e){return this.on(`command:${n}`,e)},y.fn.offCommand=function(n,e){return this.off(`command:${n}`,e)},y.fn.commands=function(n){return this.each((e,t)=>No(t,n)),this},y.fn.unbindCommands=function(n){return this.each((e,t)=>Mo(t,n)),this},y(()=>{y(document).on("click.zui.command",`[${Af}],a[href^="#!"]`,rb)});function qs(n,e,t=!1){var s;const i=y(n);if(e!==void 0){if(typeof e=="string"&&e.length){const r=`zui-runjs-${Tt()}`;i.append(`<script id="${r}">${e}<\/script>`),t&&i.find(`#${r}`).remove()}return}if(i.is("script")){const r=(s=i[0])==null?void 0:s.textContent;r&&qs(i.parent(),r);return}i.find("script").each((r,o)=>{qs(i,o.textContent),o.remove()})}y.runJS=(n,...e)=>(n=n.trim(),!n.startsWith("return ")&&!n.endsWith(";")&&(n=`return ${n}`),new Function(...e.map(([i])=>i),n)(...e.map(([,i])=>i))),y.fn.runJS=function(n){return this.each((e,t)=>{qs(t,n)})};function ob(n){return new Promise(e=>{typeof n=="string"&&(n={accept:n});const t=document.createElement("input");t.type="file",t.accept=(n==null?void 0:n.accept)||"*/*",t.multiple=(n==null?void 0:n.multiple)||!1,t.onchange=()=>{t.files?e(t.multiple?t.files:t.files[0]):e(null),t.remove()},t.click()})}function ab(n){return new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=s=>{t(s)},i.readAsText(n)})}function Gs(n,e={}){const t=y(n)[0];if(!t)return!1;let{viewport:i}=e;const{left:s,top:r,width:o,height:a}=t.getBoundingClientRect();if(e.checkZeroSize&&!(o*a))return!1;if(!i)if(e.container)i=y(t).closest(e.container)[0].getBoundingClientRect();else{const{innerHeight:v,innerWidth:b}=window,{clientHeight:C,clientWidth:S}=document.documentElement;i={left:0,top:0,width:b||S,height:v||C}}const{left:l,top:c,width:h,height:u}=i;if(e.fullyCheck)return s>=l&&r>=c&&s+o<=h+l&&r+a<=u+c;const p=s<=l+h&&s+o>=l;return r<=c+u&&r+a>=c&&p}y.fn.isVisible=function(n){return Gs(this,n)};function lb(n,e="both"){return(e==="vert"||e==="both")&&n.clientHeight<n.scrollHeight||(e==="horz"||e==="both")&&n.clientWidth<n.scrollWidth}function Nf(n,e){const t=y(n),{ifNeeded:i=!0,container:s,...r}=e||{};return t.each((o,a)=>{if(s){const l=y(a).closest(s);if(!l.length||!lb(l[0]))return}if(i){if(a.scrollIntoViewIfNeeded)return a.scrollIntoViewIfNeeded(r);if(Gs(a,{viewport:a.getBoundingClientRect()}))return}a.scrollIntoView(r)}),t}y.fn.scrollIntoView=function(n){return this.each((e,t)=>{Nf(t,n)})},y.setLibRoot=function(n,e){y.libRoot=n,e&&(y.libVersion=e)},y.registerLib=function(n,e){y.libMap||(y.libMap={}),!e.name&&e.id&&(e.id=`zui-lib-${n}`),y.libMap[n]=e},y.libVersion=1746683036080 .toString(36);function Mf(n){return new Promise((e,t)=>{typeof n=="string"&&(n={src:n});const{src:i,id:s,version:r}=n;if(y(s?`#${s}`:`link[href^="${i}"]`).length){e();return}const a=document.createElement("link");a.onload=()=>{e()},a.onerror=()=>{t(new Error(`[ZUI] Failed to load CSS from: ${i}`))},a.rel="stylesheet",a.href=`${i}${r?`${i.includes("?")?"&":"?"}v=${r}`:""}`,s&&(a.id=s),y("head").append(a)})}function Pf(n){return new Promise((e,t)=>{typeof n=="string"&&(n={src:n});const{src:i,id:s,version:r}=n,o=y(s?`#${s}`:`script[src^="${i}"]`);if(o.length){if(o.dataset("loaded"))e();else{const m=o.data("loadCalls")||[];m.push(e),o.data("loadCalls",m)}return}const{async:a=!0,defer:l=!1,noModule:c=!1,type:h,integrity:u}=n,p=document.createElement("script");p.async=a,p.defer=l,p.noModule=c,h&&(p.type=h),u&&(p.integrity=u),p.onload=()=>{e(),(y(p).dataset("loaded",!0).data("loadCalls")||[]).forEach(v=>v()),y(p).removeData("loadCalls")},p.onerror=()=>{t(new Error(`[ZUI] Failed to load JS from: ${i}`))},y("head").append(p),p.src=`${i}${r?`${i.includes("?")?"&":"?"}v=${r}`:""}`})}function Lf(n){return new Promise(e=>{typeof n=="string"&&(n={type:"module",src:n});const{src:t,imports:i,srcList:s=[],id:r}=n;t&&s.unshift({src:t,imports:i});const o=s.map(S=>S.src).join(","),a=y(r?`#${r}`:`script[data-src-list="${o}"]`);if(a.length){const S=a.data("module");if(S)e(S);else{const D=a.data("resolves")||[];D.push(e),a.data("resolves",D)}return}const{async:l=!0,defer:c=!1,integrity:h,globalVar:u,resolve:p}=n,m=document.createElement("script"),v=`zui-module-resolve-${y.guid++}`,b=y(m);Object.assign(window,{[v]:S=>{(b.data("module",S).data("resolves")||[]).forEach(N=>N(S)),b.removeData("resolves"),p==null||p(S),e(S),delete window[v]}}),m.async=l,m.defer=c,m.type="module",b.attr("data-src-list",o).attr("data-resolve-id",v);const C=[];m.text=[...s.map(({src:S,imports:D})=>{if(i){if(typeof D=="string")return C.push(D),`import * as ${D} from '${S}';`;if(D)return C.push(...Object.values(D)),`import {${Object.entries(D).map(([N,P])=>`${N} as ${P}`).join(",")}} from '${S}';`}return`import '${S}';`}),`const zuiImportResult = {${C.map(S=>`${S}: ${S},`)}};`,u?`Object.assign(window, ${u===!0?"zuiImportResult":`{${u}: zuiImportResult}`});`:"",`if(window['${v}']) window['${v}'](zuiImportResult);`].join(`
`),h&&(m.integrity=h),y("head").append(m)})}y.getLib=async function(n,e,t){var b;typeof n=="string"&&(n=((b=y.libMap)==null?void 0:b[n])||{src:n});let i=Array.isArray(n)?{src:n}:y.extend({},n);typeof e=="function"?i.success=e:e&&y.extend(i,e),t&&(i.success=t);let{src:s}=i;const{name:r,success:o}=i,a=y.libMap&&r?y.libMap[r]:null;if(a&&(i=y.extend({},a,i),s=a.src||i.src),typeof s=="string"&&(s=[s]),!s||!s.length)throw new Error("[ZUI] No src provided for $.getLib.");let{check:l=!0}=i;l===!0&&r&&(l=r);const c=typeof l=="string"?l:r;let h;const u=()=>c?window[c]||h:void 0;typeof l=="string"&&(l=()=>!!u());const p=()=>(o==null||o(),u());if(typeof l=="function"&&await l())return p();const{root:m=y.libRoot,version:v=y.libVersion}=i;for(let C of s){typeof C=="string"&&(C={src:C});let{src:S}=C;m&&!/https?:\/\//.test(S)&&(S=`${m}${m.endsWith("/")||S.startsWith("/")?"":"/"}${S}`);const D={...i,...C,version:v,src:S};if(C.type==="css"||!C.type&&S.endsWith(".css")){await Mf(D);continue}if(D.type==="module"){h=await Lf(D);continue}await Pf(D)}return p()},y.getScript=y.getLib;function Rf(n,e){const t=y(n),i=new ResizeObserver(e);return t.each((s,r)=>{i.observe(r)}),i}y.fn.resize=function(n){return Rf(this,n)};const cb=Object.freeze(Object.defineProperty({__proto__:null,isElementDetached:Un,isVisible:Gs,listenResize:Rf,loadCSS:Mf,loadJS:Pf,loadModule:Lf,scrollIntoView:Nf},Symbol.toStringTag,{value:"Module"}));var yc,zt,vc,Of,Ff=0,zf=[],rt=Ue,jf=rt.__b,Bf=rt.__r,Hf=rt.diffed,Uf=rt.__c,Wf=rt.unmount,Vf=rt.__;function ub(n,e){rt.__h&&rt.__h(zt,n,Ff||e),Ff=0;var t=zt.__H||(zt.__H={__:[],__h:[]});return n>=t.__.length&&t.__.push({}),t.__[n]}function Kf(n,e){var t=ub(yc++,7);return fb(t.__H,e)&&(t.__=n(),t.__H=e,t.__h=n),t.__}function hb(){for(var n;n=zf.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(Po),n.__H.__h.forEach(_c),n.__H.__h=[]}catch(e){n.__H.__h=[],rt.__e(e,n.__v)}}rt.__b=function(n){zt=null,jf&&jf(n)},rt.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),Vf&&Vf(n,e)},rt.__r=function(n){Bf&&Bf(n),yc=0;var e=(zt=n.__c).__H;e&&(vc===zt?(e.__h=[],zt.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(Po),e.__h.forEach(_c),e.__h=[],yc=0)),vc=zt},rt.diffed=function(n){Hf&&Hf(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(zf.push(e)!==1&&Of===rt.requestAnimationFrame||((Of=rt.requestAnimationFrame)||db)(hb)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),vc=zt=null},rt.__c=function(n,e){e.some(function(t){try{t.__h.forEach(Po),t.__h=t.__h.filter(function(i){return!i.__||_c(i)})}catch(i){e.some(function(s){s.__h&&(s.__h=[])}),e=[],rt.__e(i,t.__v)}}),Uf&&Uf(n,e)},rt.unmount=function(n){Wf&&Wf(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(i){try{Po(i)}catch(s){e=s}}),t.__H=void 0,e&&rt.__e(e,t.__v))};var qf=typeof requestAnimationFrame=="function";function db(n){var e,t=function(){clearTimeout(i),qf&&cancelAnimationFrame(e),setTimeout(n)},i=setTimeout(t,100);qf&&(e=requestAnimationFrame(t))}function Po(n){var e=zt,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),zt=e}function _c(n){var e=zt;n.__c=n.__(),zt=e}function fb(n,e){return!n||n.length!==e.length||e.some(function(t,i){return t!==n[i]})}var pb=Symbol.for("preact-signals");function Lo(){if(Vn>1)Vn--;else{for(var n,e=!1;Xs!==void 0;){var t=Xs;for(Xs=void 0,bc++;t!==void 0;){var i=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&Yf(t))try{t.c()}catch(s){e||(n=s,e=!0)}t=i}}if(bc=0,Vn--,e)throw n}}function Ys(n){if(Vn>0)return n();Vn++;try{return n()}finally{Lo()}}var ze=void 0;function mb(n){var e=ze;ze=void 0;try{return n()}finally{ze=e}}var Xs=void 0,Vn=0,bc=0,Ro=0;function Gf(n){if(ze!==void 0){var e=n.n;if(e===void 0||e.t!==ze)return e={i:0,S:n,p:ze.s,n:void 0,t:ze,e:void 0,x:void 0,r:e},ze.s!==void 0&&(ze.s.n=e),ze.s=e,n.n=e,32&ze.f&&n.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=ze.s,e.n=void 0,ze.s.n=e,ze.s=e),e}}function ct(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}ct.prototype.brand=pb,ct.prototype.h=function(){return!0},ct.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)},ct.prototype.U=function(n){if(this.t!==void 0){var e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t)}},ct.prototype.subscribe=function(n){var e=this;return Qt(function(){var t=e.value,i=ze;ze=void 0;try{n(t)}finally{ze=i}})},ct.prototype.valueOf=function(){return this.value},ct.prototype.toString=function(){return this.value+""},ct.prototype.toJSON=function(){return this.value},ct.prototype.peek=function(){var n=ze;ze=void 0;try{return this.value}finally{ze=n}},Object.defineProperty(ct.prototype,"value",{get:function(){var n=Gf(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(bc>100)throw new Error("Cycle detected");this.v=n,this.i++,Ro++,Vn++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Lo()}}}});function Je(n){return new ct(n)}function Yf(n){for(var e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Xf(n){for(var e=n.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function Qf(n){for(var e=n.s,t=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}n.s=t}function ns(n){ct.call(this,void 0),this.x=n,this.s=void 0,this.g=Ro-1,this.f=4}(ns.prototype=new ct).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Ro))return!0;if(this.g=Ro,this.f|=1,this.i>0&&!Yf(this))return this.f&=-2,!0;var n=ze;try{Xf(this),ze=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return ze=n,Qf(this),this.f&=-2,!0},ns.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}ct.prototype.S.call(this,n)},ns.prototype.U=function(n){if(this.t!==void 0&&(ct.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},ns.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}},Object.defineProperty(ns.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=Gf(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function je(n){return new ns(n)}function Jf(n){var e=n.u;if(n.u=void 0,typeof e=="function"){Vn++;var t=ze;ze=void 0;try{e()}catch(i){throw n.f&=-2,n.f|=8,wc(n),i}finally{ze=t,Lo()}}}function wc(n){for(var e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,Jf(n)}function gb(n){if(ze!==this)throw new Error("Out-of-order effect");Qf(this),ze=n,this.f&=-2,8&this.f&&wc(this),Lo()}function Qs(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Qs.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}},Qs.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Jf(this),Xf(this),Vn++;var n=ze;return ze=this,gb.bind(this,n)},Qs.prototype.N=function(){2&this.f||(this.f|=2,this.o=Xs,Xs=this)},Qs.prototype.d=function(){this.f|=8,1&this.f||wc(this)};function Qt(n){var e=new Qs(n);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}var Cc;function is(n,e){Ue[n]=e.bind(null,Ue[n]||function(){})}function Oo(n){Cc&&Cc(),Cc=n&&n.S()}function Zf(n){var e=this,t=n.data,i=vb(t);i.value=t;var s=Kf(function(){for(var r=e.__v;r=r.__;)if(r.__c){r.__c.__$f|=4;break}return e.__$u.c=function(){var o;!$.isValidElement(s.peek())&&((o=e.base)==null?void 0:o.nodeType)===3?e.base.data=s.peek():(e.__$f|=1,e.setState({}))},je(function(){var o=i.value.value;return o===0?0:o===!0?"":o||""})},[]);return s.value}Zf.displayName="_st",Object.defineProperties(ct.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Zf},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),is("__b",function(n,e){if(typeof e.type=="string"){var t,i=e.props;for(var s in i)if(s!=="children"){var r=i[s];r instanceof ct&&(t||(e.__np=t={}),t[s]=r,i[s]=r.peek())}}n(e)}),is("__r",function(n,e){Oo();var t,i=e.__c;i&&(i.__$f&=-2,(t=i.__$u)===void 0&&(i.__$u=t=function(s){var r;return Qt(function(){r=this}),r.c=function(){i.__$f|=1,i.setState({})},r}())),Oo(t),n(e)}),is("__e",function(n,e,t,i){Oo(),n(e,t,i)}),is("diffed",function(n,e){Oo();var t;if(typeof e.type=="string"&&(t=e.__e)){var i=e.__np,s=e.props;if(i){var r=t.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in i)&&(a.d(),r[o]=void 0)}else t.U=r={};for(var l in i){var c=r[l],h=i[l];c===void 0?(c=yb(t,l,h,s),r[l]=c):c.o(h,s)}}}n(e)});function yb(n,e,t,i){var s=e in n&&n.ownerSVGElement===void 0,r=Je(t);return{o:function(o,a){r.value=o,i=a},d:Qt(function(){var o=r.value.value;i[e]!==o&&(i[e]=o,s?n[e]=o:o?n.setAttribute(e,o):n.removeAttribute(e))})}}is("unmount",function(n,e){if(typeof e.type=="string"){var t=e.__e;if(t){var i=t.U;if(i){t.U=void 0;for(var s in i){var r=i[s];r&&r.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}n(e)}),is("__h",function(n,e,t,i){(i<3||i===9)&&(e.__$f|=2),n(e,t,i)}),me.prototype.shouldComponentUpdate=function(n,e){var t=this.__$u;if(!(t&&t.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var i in e)return!0;for(var s in n)if(s!=="__source"&&n[s]!==this.props[s])return!0;for(var r in this.props)if(!(r in n))return!0;return!1};function vb(n){return Kf(function(){return Je(n)},[])}const xc={};function tt(n,e){typeof n=="object"?Object.keys(n).forEach(t=>{tt(t,n[t])}):e&&(xc[n.toLowerCase()]=e)}function ep(n){return xc[n.toLowerCase()]}class Ke extends me{constructor(e){super(e),this._gid=Tt(),this.state=this.getDefaultState(e)}get gid(){return this._gid}get element(){return document.querySelector(`[z-gid-${this._gid}]`)}get i18nData(){return[this.props.i18n,this.constructor.i18n]}get commandScope(){return this.constructor.NAME}getDefaultState(e){return{}}resetState(e,t){const i=this.getDefaultState(e);t?this.state=i:this.changeState(i)}i18n(e,t,i){const{i18nData:s}=this;return Ne(s,e,t,i,this.props.lang,this.constructor.NAME)??Ne(s,e,t,i,this.props.lang)??`{i18n:${e}}`}changeState(e,t){return new Promise(i=>{this.setState(e,()=>{t==null||t(),i(this.state)})})}executeCommand(e,t=[]){const{onCommand:i,commands:s}=this.props;let r;typeof e=="string"&&(e={name:e});const{scope:o,name:a}=e,l=s?s[`${o}~${a}`]||s[a]:null;return l?l.call(this,e,t):((!e.scope||e.scope===this.commandScope)&&(r=Bn(this,e.name,t)),i&&(r=i.call(this,e,t)),r)}_getClassName(e){return e.className}_getProps(e){const{className:t,attrs:i,props:s,data:r,forwardRef:o,children:a,component:l,style:c,class:h,commands:u,onCommand:p,...m}=e,v=new Set(this.constructor.customProps),b="dangerouslySetInnerHTML",C=Object.keys(m).reduce((S,D)=>{if(!v.has(D)&&(D===b||/^(on[A-Z]|data-|zui-|z-)[a-zA-Z-]+/.test(D))){const N=m[D];S[D]=D!==b&&N&&typeof N=="object"?JSON.stringify(N):N}return S},{});return{ref:o,className:V(this._getClassName(e),h)||void 0,style:c,[`z-gid-${this._gid}`]:"",...C,...i,...s}}_getComponent(e){const{component:t="div"}=e;return(typeof t=="string"?ep(t):t)||t}_getChildren(e){return e.children}_beforeRender(e){return e}_onRender(e,t,i,s){return[e,t,i]}componentDidMount(){const{commands:e,onCommand:t}=this.props;(e||t)&&No(this.element,{commands:e,scope:this.commandScope,onCommand:this.executeCommand.bind(this)})}componentWillUnmount(){const{commands:e,onCommand:t}=this.props;(e||t)&&Mo(this.element,this.commandScope)}render(e){e=this._beforeRender(e)||e;let t=this._getComponent(e),i=this._getChildren(e),s=this._getProps(e);const r=this._onRender(t,s,i,e);return r&&([t,s,i]=r),w(t,s,i)}}Ke.HElement=!0,Ke.customProps=[];class Sc extends Ke{constructor(e){super(e),this.signals={};const{state:t}=this;this.changeState(t),this.state={}}changeState(e,t){return new Promise(i=>{Ys(()=>{typeof e=="function"&&(e=e(this.state));for(const s in e){const r=this.signals[s];r?r.value=e[s]:this.signals[s]=Je(e[s])}i(this.state),t==null||t()})})}resetState(e){this.changeState(this.getDefaultState(e))}}Sc.HElementSignals=!0;var _b=0;function k(n,e,t,i,s,r){e||(e={});var o,a,l=e;"ref"in e&&(o=e.ref,delete e.ref);var c={type:n,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--_b,__i:-1,__u:0,__source:s,__self:r};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return Ue.vnode&&Ue.vnode(c),c}class Dn extends me{constructor(){super(...arguments),this._ref=he()}_runJS(){this.props.executeScript&&y(this._ref.current).runJS().zuiInit()}componentDidMount(){this._runJS()}componentDidUpdate(e){this.props.html!==e.html&&this._runJS()}render(e){const{executeScript:t,html:i,...s}=e;return k(Ke,{forwardRef:this._ref,dangerouslySetInnerHTML:{__html:i},...s})}}function tp(n){const{tag:e,className:t,style:i,renders:s,generateArgs:r=[],generatorThis:o,generators:a,onGenerate:l,onRenderItem:c,...h}=n,u=[t],p={...i},m=[],v=[];return s.forEach(b=>{const C=[];if(typeof b=="string"&&a&&a[b]&&(b=a[b]),typeof b=="function")if(l)C.push(...l.call(o,b,m,...r));else{const S=b.call(o,m,...r);S&&(Array.isArray(S)?C.push(...S):C.push(S))}else C.push(b);C.forEach(S=>{S!=null&&(typeof S=="object"&&!$.isValidElement(S)&&("html"in S||"__html"in S||"className"in S||"style"in S||"attrs"in S||"children"in S)?S.html?m.push(k("div",{className:V(S.className),style:S.style,dangerouslySetInnerHTML:{__html:S.html},...S.attrs??{}})):S.__html?v.push(S.__html):(S.style&&Object.assign(p,S.style),S.className&&u.push(S.className),S.children&&m.push(S.children),S.attrs&&Object.assign(h,S.attrs)):m.push(S))})}),v.length&&Object.assign(h,{dangerouslySetInnerHTML:{__html:v}}),[{className:V(u),style:p,...h},m]}function kc({tag:n="div",...e}){const[t,i]=tp(e);return w(n,t,...i)}class Fo extends me{constructor(){super(...arguments),this.state={},this._ref=he()}async load(e){const{props:t}=this,{fetcher:i,type:s,fetcherArgs:r,fetcherThis:o=this,clearBeforeLoad:a}=t;this.setState({loading:!0,error:void 0,...a?{content:void 0}:{}});try{const l=await _t(e||i,r,{throws:!0,dataType:s==="custom"?"json":"text"},o,c=>{this._ajax=c});this.setState({content:l,loading:!1})}catch(l){this.setState({error:l,loading:!1})}this._ajax=void 0}componentDidMount(){this.load(),y(this._ref.current).on("loadContent.zui",(e,t)=>{e.stopPropagation(),this.load(t)})}componentDidUpdate(e){(this.props.fetcher!==e.fetcher||this.props.fetcherArgs!==e.fetcherArgs||this.props.fetcherThis!==e.fetcherThis)&&this.load()}componentWillUnmount(){var e;(e=this._ajax)==null||e.abort(),y(this._ref.current).off(".zui")}_renderContent(e,t){const{loading:i,error:s,content:r=""}=this.state,{loadingContent:o,errorText:a,type:l,clearBeforeLoad:c,...h}=t;return i&&c?o:s?a??s.message:l==="html"?k(Dn,{html:r,executeScript:!0,...h}):l==="text"?r:k(ge,{content:r,...h})}render(e){const{loading:t}=this.state,{id:i,loadingClass:s,loadingIndicator:r,className:o,style:a,attrs:l,loadingText:c,...h}=e;return k("div",{id:i,ref:this._ref,className:V("lazy-content",o,t?s:"",r?"load-indicator":""),"data-loading":c,style:a,...l,children:this._renderContent(e,h)})}}Fo.defaultProps={type:"html",loadingIndicator:!0,loadingClass:"loading",clearBeforeLoad:!0};function zo(n){const{content:e,generatorArgs:t,generatorThis:i,...s}=n;let r=e;if(typeof r=="function"&&(r=r.call(i,...t||[])),Array.isArray(r))return r.map(o=>zo({...s,content:o,generatorThis:i,generatorArgs:t}));if(typeof r=="string"||typeof r=="number")return Object.keys(s).length?k("div",{...s,children:r}):r;if(r&&typeof r=="object"&&(typeof r.html=="string"||r.component||r.fetcher)){if(r.fetcher)return k(Fo,{...ke(s,r)});if(r.html)return k(Dn,{...ke(s,r)});const{children:o,...a}=r;return o&&(r=ke({children:(Array.isArray(o)?o:[o]).map(l=>zo({...s,content:l,generatorThis:i,generatorArgs:t}))},a)),k(Ke,{...ke(s,r)})}return $.isValidElement(r)?r:(r&&(console.groupCollapsed("[ZUI] CustomContent format error"),console.trace("content:",r),console.log("props:",n),console.groupEnd()),null)}function ge(n){const e=zo(n);return e==null||typeof e=="boolean"?null:$.isValidElement(e)?e:k(Tn,{children:e})}class np extends me{render(e){return ge(e)}}const ip=n=>n.startsWith("icon-")?n:`icon-${n}`;function $e(n){const{icon:e,className:t,...i}=n;if(!e)return null;if($.isValidElement(e))return e;const s=["icon",t];if(typeof e=="string")s.push(ip(e));else if(typeof e=="object"){const{className:r,icon:o,...a}=e;s.push(r,o?ip(o):""),Object.assign(i,a)}return k("i",{className:V(s),...i})}function bb(n){return this.getChildContext=()=>n.context,n.children}function Tc(n){const e=this,t=n._container;e.componentWillUnmount=function(){Ci(null,e._temp),e._temp=null,e._container=null},e._container&&e._container!==t&&e.componentWillUnmount(),n._vnode?(e._temp||(e._container=t,e._temp={nodeType:1,parentNode:t,childNodes:[],appendChild(i){this.childNodes.push(i),e._container.appendChild(i)},insertBefore(i,s){this.childNodes.push(i),e._container.appendChild(i)},removeChild(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e._container.removeChild(i)}}),Ci(w(bb,{context:e.context},n._vnode),e._temp)):e._temp&&e.componentWillUnmount()}function sp(n,e){const t=w(Tc,{_vnode:n,_container:e});return t.containerInfo=e,t}tt({HElement:Ke,element:Ke,HtmlContent:Dn,html:Dn,CustomContent:ge,LazyContent:Fo,custom:ge,lazy:Fo,Icon:$e,Portal:Tc});class ve extends We{constructor(){super(...arguments),this._ref=he()}get $(){return this._ref.current}get i18nData(){const{i18n:e,i18nData:t}=this.constructor.Component;return t?[...t,this.constructor.i18n]:[e,...super.i18nData]}afterInit(){this.render()}destroy(){var e,t;(t=(e=this.$)==null?void 0:e.componentWillUnmount)==null||t.call(e),this.element&&(this.element.innerHTML=""),super.destroy()}_getRenderProps(e){return{ref:this._ref,...e}}render(e,t){var u;const{element:i,$:s}=this,{Component:r,replace:o}=this.constructor,{$replace:a=o,$optionsFromDataset:l,...c}=this.setOptions(e,t),h=this._getRenderProps(c);if(t&&((u=s==null?void 0:s.resetState)==null||u.call(s,c)),a&&r.HElement&&(i.tagName.toLowerCase()===a||a===!0)){const p=Array.from(i.attributes).reduce((m,v)=>{const{name:b,value:C}=v;return m[b==="class"?"className":b]=C,m},{});Ci(w(r,ke({component:i.tagName.toLowerCase(),attrs:p},h)),i.parentElement,i)}else Ci(w(r,h),i)}static renderHTML(e){const t=document.createElement("div");return Ci(w(this.Component,e),t),t.innerHTML}}ve.replace=!1;class jo extends ve{}jo.NAME="Custom",jo.Component=np,jo.register();class xe extends Ke{_beforeRender(e){const{text:t,loading:i,loadingText:s,caret:r,icon:o,trailingIcon:a,children:l}=e;this._isEmptyText=t==null||typeof t=="string"&&!t.length||i&&!s,this._onlyCaret=r&&this._isEmptyText&&!o&&!a&&!l&&!i}_getChildren(e){const{loading:t,loadingIcon:i,loadingText:s,icon:r,iconClass:o,text:a,textClass:l,children:c,trailingIcon:h,trailingIconClass:u,caret:p}=e;return[t?k($e,{icon:i||"icon-spinner-snake",className:"spin"}):k($e,{icon:r,className:o}),this._isEmptyText?null:k("span",{className:V("text",l),children:t?s:a}),t?null:c,t?null:k($e,{icon:h,className:u}),t?null:p?k("span",{className:typeof p=="string"?`caret-${p}`:"caret"}):null]}_getClassName(e){const{type:t,className:i,disabled:s,loading:r,active:o,children:a,square:l,size:c,rounded:h}=e;return["btn",t,i,{"btn-caret":this._onlyCaret,disabled:s||r,active:o,loading:r,square:l===void 0?!this._onlyCaret&&!a&&this._isEmptyText:l},c?`size-${c}`:"",typeof h=="string"?`rounded-${h}`:{rounded:h}]}_getComponent(e){return e.component||(e.url?"a":"button")}_getProps(e){const t=this._getComponent(e),{url:i,target:s,disabled:r,btnType:o="button",hint:a,command:l}=e,c=t==="a",h={...super._getProps(e),type:c?void 0:"button",disabled:!c&&r?"":void 0,title:a};return o&&(["button","reset","submit"].includes(o)?t==="button"&&(h.type=o):h.className=V([h.className,o])),r||(i!==void 0&&(h[c?"href":"data-url"]=i),s!==void 0&&(h[c?"target":"data-target"]=s),l&&(h["zui-command"]=l)),h}}tt(Object.freeze(Object.defineProperty({__proto__:null,Button:xe},Symbol.toStringTag,{value:"Module"})));const $T="",AT="",ET="",NT="",MT="";let Dt=class extends Ke{constructor(e){super(e),this._handleClick=this._handleClick.bind(this)}get name(){return this.props.name||this.constructor.NAME}get itemName(){return this.props.itemName||this.constructor.ITEM_NAME}getItems(){return this._items}getRenderedItem(e){return this._renderedItems.find(t=>t.key===e)}getItem(e){return this._items[this.getItemIndex(e)]}getItemIndex(e){return this._renderedItems.findIndex(t=>t.key===e)}getItemByIndex(e){return this._items[e]}getKey(e){var t,i;return(i=(t=this._renderedItems)==null?void 0:t[e])==null?void 0:i.key}_getItemFromEvent(e,t){var l;const i=(t||e.target).closest("[z-item]");if(!i||!((l=i.parentElement)!=null&&l.hasAttribute(`z-gid-${this._gid}`)))return;const s=+i.getAttribute("z-item"),r=this._items[s];if(!r)return;const o=this.getKey(s);if(o===void 0)return;const a=this._renderedItems[s];return{index:s,item:r,element:i,event:e,key:o,renderedItem:a,relativeTarget:this.props.relativeTarget}}_handleClick(e){var i,s;const t=this._getItemFromEvent(e);if(t)return(i=this.props.onClickItem)==null||i.call(this,t),(s=t.item.onClick)==null||s.call(this,e,t),t}_renderItem(e,t,i){const{beforeRenderItem:s}=e;if(s){const c=s.call(this,t,i);c!==void 0&&(t=c)}const{type:r}=t;let{itemRender:o}=e;if(o&&typeof o=="object"&&(o=o[r]),o){const c=o.call(this,t,i);if(c!==void 0)return k(ge,{"z-key":t.key,"z-item":i,"z-type":r,content:c})}const{ItemComponents:a}=this.constructor;let l=a[r];if(!l&&t.component)return k(ge,{"z-key":t.key,"z-item":i,"z-type":r,content:{...t}});if(l=l||a.default||Ke,Array.isArray(l)){let c=l[1];typeof c=="function"&&(c=c.call(this,t,e)),t=ke({},c,t),l=l[0]}return k(l,{"z-key":t.key,"z-item":i,"z-type":r,...t})}_getItem(e,t,i){if(!t)return!1;const{itemProps:s,itemPropsMap:r={},getItem:o,itemKey:a}=e,{type:l=this.constructor.defaultItemType}=t,{name:c,itemName:h}=this,{defaultItemProps:u={},defaultItemPropsMap:p={}}=this.constructor;if(t=ke({type:l},u,p[l],s,r[l],{className:[c?`${c}-${l}`:"",h]},t,{_item:t,_index:i,key:String((a?t[a]:t.key)??t.key??i),onClick:void 0}),o){const m=o.call(this,t,i);if(m!==void 0)return m}return t}_getProps(e){const t=super._getProps(e);return{onClick:this._handleClick,...t}}_getClassName(e){return[this.name,e.className]}_getItems(e){let{items:t=[]}=e;typeof t=="function"?t=t.call(this):Array.isArray(t)||(t=[]);const{getItems:i}=e;if(i){const s=i.call(this,t);if(s!==void 0)return s}return t}_renderItems(e,t){return this._renderedItems=t.map((i,s)=>{const r=this._getItem(e,i,s);return r||void 0}),this._renderedItems.reduce((i,s,r)=>(s&&i.push(this._renderItem(e,s,r)),i),[])}_getChildren(e){const t=this._getItems(e);this._items=t;const i=this._renderItems(e,t);return e.children&&i.push(e.children),i}_getComponent(e){return e.component||this.constructor.TAG}};Dt.NAME="",Dt.ITEM_NAME="item",Dt.TAG="ul",Dt.ItemComponents={default:Ke,divider:[Ke,{className:"divider"}],space:[Ke,n=>{const{space:e,flex:t,style:i}=n;return{style:{width:e,height:e,flex:t,...i}}}]},Dt.defaultItemProps={component:"li"},Dt.defaultItemPropsMap={},Dt.defaultItemType="item",Dt.defaultProps={itemKey:"id"};const wb=Object.freeze(Object.defineProperty({__proto__:null,CommonList:Dt},Symbol.toStringTag,{value:"Module"}));class Js extends ve{}Js.NAME="CommonList",Js.Component=Dt,Js.replace=Dt.TAG,Js.register(),tt(wb);const PT="",LT="",RT="",OT="",FT="",zT="";function Cb(n){if(n.indexOf("#")===0&&(n=n.slice(1)),n.length===3&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),n.length!==6)throw new Error(`Invalid HEX color "${n}".`);return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}function xb(n){const[e,t,i]=typeof n=="string"?Cb(n):n;return e*.299+t*.587+i*.114>186}function rp(n,e){return xb(n)?(e==null?void 0:e.dark)??"#333333":(e==null?void 0:e.light)??"#ffffff"}function op(n,e=255){return Math.min(Math.max(n,0),e)}function Sb(n,e,t){n=n%360/360,e=op(e),t=op(t);const i=t<=.5?t*(e+1):t+e-t*e,s=t*2-i,r=o=>(o=o<0?o+1:o>1?o-1:o,o*6<1?s+(i-s)*o*6:o*2<1?i:o*3<2?s+(i-s)*(2/3-o)*6:s);return[r(n+1/3)*255,r(n)*255,r(n-1/3)*255]}function kb(n,e){return/^[\u4e00-\u9fa5\s]+$/.test(n)?n.length<=e?n:n.substring(n.length-e):/^[A-Za-z\d\s]+$/.test(n)?n[0].toUpperCase():n.length<=e?n:n.substring(0,e)}let ss=class extends me{render(){const{className:e,style:t,size:i="",circle:s,rounded:r,background:o,foreColor:a,icon:l,text:c,code:h,displayText:u,maxTextLength:p=2,src:m,hueDistance:v=43,saturation:b=.4,lightness:C=.6,children:S,...D}=this.props,N=["avatar",e],P={...t,background:o,color:a};let H=32;i&&(typeof i=="number"?(P.width=`${i}px`,P.height=`${i}px`,P.fontSize=`${Math.max(12,Math.round(i/2))}px`,H=i):(N.push(`size-${i}`),H={xs:20,sm:24,lg:48,xl:80}[i])),s?N.push("circle"):r&&(typeof r=="number"?P.borderRadius=`${r}px`:N.push(`rounded-${r}`));let q;if(m)N.push("has-img"),q=k("img",{className:"avatar-img",src:m,alt:c});else if(l)N.push("has-icon"),q=k($e,{icon:l});else if(c!=null&&c.length||u!=null&&u.length){const Y=u??kb(c,p),Q=Y.length;N.push("has-text",`has-text-${Q}`);let Z;H&&H<16*Q&&(Z={transform:`scale(${H/(16*Q)})`,whiteSpace:"nowrap"}),q=k("div",{"data-actualSize":H,className:"avatar-text",style:Z,children:Y})}if(!m)if(o===void 0){const Y=h??c??u,Q=(typeof Y=="number"?Y:pc(Y))*v%360;if(P.background=`hsl(${Q},${b*100}%,${C*100}%)`,!a){const Z=Sb(Q,b,C);P.color=rp(Z)}}else!a&&o&&/#?[0-9a-fA-F]{6}/.test(o)&&(P.color=rp(o));return k("div",{className:V(N),style:P,...D,children:[q,S]})}};const Tb=Object.freeze(Object.defineProperty({__proto__:null,Avatar:ss},Symbol.toStringTag,{value:"Module"}));let Jt=class extends Dt{_isBtnType({type:e}){return e==="item"||e==="dropdown"}_getItem(e,t,i){if(!t)return!1;t.type||(t=y.extend({type:t.dropdown||t.items?"dropdown":"item"},t));let s=super._getItem(e,t,i);return s&&(this._isBtnType(s)&&(s=ke({},this._shareBtnProps,s)),s)}_beforeRender(e){const{btnProps:t,btnType:i,size:s}=e;this._shareBtnProps=ke({},t,ic({btnType:i,size:s}))}};Jt.NAME="btn-group",Jt.TAG="nav",Jt.ItemComponents={...Dt.ItemComponents,default:xe},Jt.defaultItemProps={component:void 0};const Bo=class $v extends Jt{_getProps(e){const{gap:t}=e,i=super._getProps(e);return t&&(typeof t=="number"?i.className=V(i.className,`gap-${t}`):i.style=y.extend(i.style||{},{gap:t})),i}_getItem(e,t,i){const s=super._getItem(e,t,i);if(!s)return s;const{type:r}=s,o=r==="btn-group"||r==="btnGroup";return o&&(s.btnProps=ke({},this._shareBtnProps,s.btnProps)),(o||r==="dropdown")&&!s.relativeTarget&&(s.relativeTarget=e.relativeTarget),s}static render(e,t,i,s){let r=typeof e=="function"?e.call(s??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),i&&(r=ke(i,r)),k($v,{...r})}};Bo.NAME="toolbar",Bo.defaultProps={btnProps:{btnType:"ghost"}},Bo.ItemComponents={...Jt.ItemComponents,btnGroup:Jt,"btn-group":Jt};let Be=Bo;const Db=Object.freeze(Object.defineProperty({__proto__:null,Toolbar:Be},Symbol.toStringTag,{value:"Module"}));class rs extends Ke{constructor(e){super(e),this._handleChange=t=>{const{onChange:i}=this.props,s=t.target.indeterminate?"indeterminate":t.target.checked;i&&i.call(this,t,s),this._controlled||this.setState({checked:s})},this.state={checked:e.checked??e.defaultChecked??!1},this._controlled=e.checked!==void 0}get checked(){return this._controlled?this.props.checked:this.state.checked}_getClassName(e){const{disabled:t,type:i="checkbox"}=e,{checked:s}=this;return[e.className,i==="switch"?i:`${i}-primary`,{disabled:t,checked:s===!0,indeterminate:s==="indeterminate"}]}_getChildren(e){const{name:t,type:i,value:s,id:r,label:o}=e,{checked:a}=this;return[t?k("input",{type:i==="radio"?i:"checkbox",name:t,id:r,value:s,onChange:this._handleChange,indeterminate:a==="indeterminate",checked:typeof a=="boolean"?a:void 0},"input"):null,k("label",{htmlFor:r,children:k(ge,{content:o})},"label")]}}class Ib extends rs{}Ib.defaultProps={type:"radio"};class $b extends rs{}$b.defaultProps={type:"switch"};class hn extends Ke{_renderLeading(e){const{icon:t,iconClass:i,avatar:s,toggleIcon:r,leading:o,leadingClass:a,checked:l,checkbox:c,multiline:h}=e,u=[];if(r&&u.push(k(ge,{content:r},"toggleIcon")),l!==void 0&&u.push(k(rs,{className:"item-checkbox",checked:l,...c},"checkbox")),t&&u.push(k($e,{className:V("item-icon",i),icon:t},"icon")),s){const m=typeof s=="function"?s.call(this,e):s;m&&(m.className=V("item-avatar",m.className),u.push(k(ss,{...m},"avatar")))}const p=o?k(ge,{content:o},"leading"):null;return p&&u.push(p),h?u.length?[k("div",{className:V("item-leading",a),children:u},"leading")]:[]:u}_renderContent(e,t){const{textClass:i,titleClass:s,titleAttrs:r,subtitle:o,subtitleClass:a,url:l,target:c,content:h,contentClass:u,contentAttrs:p}=e,m=l&&!t,v=m?"a":"div";let{title:b,text:C}=e;return b===void 0&&(b=C,C=null),[k("div",{className:V("item-content",u),...p,children:[b?k(v,{className:V("item-title",s),href:m?l:void 0,target:m?c:void 0,...r,children:k(ge,{content:b})},"title"):null,o?k("div",{className:V("item-subtitle",a),children:k(ge,{content:o})},"subtitle"):null,C?k("div",{className:V("item-text text",i),children:C},"text"):null,h?k(ge,{content:h},"extraContent"):null]},"content")]}_renderTrailing(e){const{multiline:t,trailing:i,trailingClass:s,trailingIcon:r,trailingIconClass:o,actions:a}=e,l=[];r&&l.push(k($e,{className:V("item-trailing-icon",o),icon:r},"trailing-icon")),a&&l.push(Be.render(a,[e],{key:"actions",className:"item-actions",relativeTarget:e,size:"sm"},this));const c=i?k(ge,{content:i},"trailing"):null;return c&&l.push(c),t?l.length?[k("div",{className:V("item-trailing",s),children:[l,c]},"trailing")]:[]:l}_render(e,t){const{innerComponent:i,innerClass:s,innerAttrs:r,url:o,actions:a,target:l,active:c,disabled:h,divider:u,checked:p,multiline:m,title:v,subtitle:b,hint:C,selected:S,command:D,hover:N}=e,P=i||(o&&!a?"a":"div"),H=P==="a",q=ke({key:"item",title:C,className:V("listitem",s,{active:c,disabled:h,"has-divider":u,"no-hover":N===!1,selected:S,checked:p,multiline:m??!!(v&&b),state:H&&!h})},D?{"zui-command":D}:null,H?{href:o||"javascript:;",target:l}:null,t,r);return k(P,{...q,children:[this._renderLeading(e),this._renderContent(e,H),this._renderTrailing(e)]})}_onRender(e,t,i,s){const r=Object.keys(t).reduce((o,a)=>(a.startsWith("data-")&&(o[a]=t[a],delete t[a]),o),{});return[e,t,[this._render(s,r),...ko(i)]]}}let gt=class extends Dt{constructor(e){super(e),this._activeSet=new vi(()=>{const t=new Set,{active:i}=this.props;Array.isArray(i)?i.forEach(r=>t.add(r)):typeof i=="string"?t.add(i):i&&Object.keys(i).forEach(r=>i[r]&&t.add(r));const{activeMap:s}=this.state;return Object.keys(s).forEach(r=>s[r]?t.add(r):t.delete(r)),t},()=>[this.state.activeMap,this.props.active]),this.state={checked:{},activeMap:{}}}get namespace(){return`.zui.${this.constructor.NAME}.list_${this.gid}`}get isLazyItems(){const{items:e}=this.props;return e&&!Array.isArray(e)}componentDidMount(){this._afterRender(!0),this.tryLoad(),this.props.activeOnHover&&!this.props.multipleActive&&y(this.element).on(`mouseenter${this.namespace}`,"[z-item]",e=>{const t=this._getItemFromEvent(e);t&&t.renderedItem.type==="item"&&!t.renderedItem.disabled&&t.renderedItem.hover!==!1&&!this.isActive(t.key)&&this.toggleActive(t.key,!0)})}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e;y(this.element).off(this.namespace),(e=this.props.beforeDestroy)==null||e.call(this)}setItems(e,t){const{onLoadFail:i}=this.props;return this.changeState({loading:!1,items:e||[],loadFailed:t?(typeof i=="function"?i.call(this,t):i)||String(t):void 0})}load(){const{items:e,onLoad:t}=this.props;this._loadedSetting=e,this.setState({loading:!0,items:[]},async()=>{try{const i=await _t(e,[this],{throws:!0});this.setItems((t==null?void 0:t.call(this,i))||i)}catch(i){this.setItems(void 0,i)}})}tryLoad(){const{loading:e}=this.state,{items:t}=this.props;return e||!t||Array.isArray(t)||t===this._loadedSetting?!1:(this.load(),!0)}isChecked(e,t,i=!1){const s=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.state.checked[e]??s.checked??i}isAllChecked(){return this._renderedItems.every(({key:e},t)=>this.isChecked(e,t)===!0)}toggleAllChecked(e){return e===void 0&&(e=!this.isAllChecked()),this.toggleChecked(this._renderedItems.map(t=>t.key),e)}async toggleChecked(e,t){let i;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),i=e.reduce((s,r)=>(s[r]=t,s),{})}else if(typeof e=="object")i=e;else{const s=this.isChecked(e);t===void 0&&(t=!s),i={[e]:t}}Object.keys(i).length&&await this.changeState(s=>({checked:{...s.checked,...i}}),()=>{var r;const s=this.state.checked;(r=this.props.onCheck)==null||r.call(this,i,Object.keys(s).filter(o=>s[o]===!0))})}getChecks(){return this._renderedItems.reduce((e,{key:t},i)=>(t!==void 0&&this.isChecked(t,i)===!0&&e.push(t),e),[])}isActive(e){return typeof e=="object"&&(e=e.key),this._activeSet.cache.has(e)}getActiveKeys(){return[...this._activeSet.value]}getActiveKey(){return this.getActiveKeys()[0]}async toggleActive(e,t){typeof e=="string"&&(e=[e]),e.length&&(t=t??!this.isActive(e[0]),await this.changeState(i=>({activeMap:this.props.multipleActive?e.reduce((r,o)=>(r[o]=t,r),{...i.activeMap}):{[e[0]]:t}}),()=>{var i;(i=this.props.onActive)==null||i.call(this,e,t)}))}getNextItem(e,t,i=1,s=void 0){s=s||this._renderedItems,t=t||(l=>l.type==="item"&&!l.disabled);const r=s.length;let o=e===void 0?r-1:s.findIndex(l=>l.key===e),a=0;for(;a<r;){o=(o+i+r)%r;const l=s[o];if(l&&!l.hidden&&t.call(this,l,o))return l;a++}}getPrevItem(e,t){return this.getNextItem(e,t,-1)}activeNext(e,t=1){const i=this.getNextItem(this.getActiveKey(),e,t);i&&this.toggleActive(i.key)}activePrev(e){this.activeNext(e,-1)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_beforeRender(e){var t;return(t=this.props.beforeRender)==null?void 0:t.call(this,e)}_getItems(e){const{items:t}=e,{items:i}=this.state;return i||(Array.isArray(t)?t:[])}_getRenderedItem(e,t,i){const{divider:s,multiline:r}=e;t=ke({},ic({divider:s,multiline:r}),t);const{itemName:o,name:a}=this;if(t.innerClass=[o?`${o}-inner${a?` ${a}-${t.type}-inner`:""}`:"",t.innerClass],t.type==="item"){const{checkbox:l}=e;t.checkbox===!1?t.checked=void 0:(l||t.checkbox)&&(t.checked=this.isChecked(t.key,i,t.checked),typeof l=="object"&&t.checkbox!==!1&&(t.checkbox=t.checkbox?y.extend({},l,t.checkbox):l),e.selectOnChecked&&t.checked===!0&&(t.selected=!0)),t.active===void 0&&this.isActive(t)&&(t.active=!0)}return t.icon&&(this._hasIcons=!0),t.checked!==void 0&&(this._hasCheckbox=!0),t}_getItem(e,t,i){const s=super._getItem(e,t,i);return s&&this._getRenderedItem(e,s,i)}_renderItem(e,t,i){return t.type==="item"&&this._hasIcons&&t.icon===void 0&&(t.icon="EMPTY"),super._renderItem(e,t,i)}_handleClick(e){const t=super._handleClick(e);let{checkOnClick:i}=this.props;if(i==="any"?i=".item-checkbox,.item-content,.item-icon":i===!0&&(i=".item-checkbox"),!i||!t||!t.renderedItem)return t;const s=t.renderedItem,r=s.checkbox;if(r!==!1&&(this.props.checkbox||r||s.checked!==void 0)&&!s.disabled&&t&&e.target.closest(i)){this.toggleChecked(t.key),e.stopPropagation();return}return t}_getClassName(e){const{loading:t,loadFailed:i}=this.state;return[super._getClassName(e),t?"loading":i?"is-load-failed":"",e.hoverItemActions?"with-hover-actions":""]}_getProps(e){const{className:t,...i}=super._getProps(e);return{...i,className:V(t,this._hasIcons?"has-icons":"",this._hasCheckbox?"has-checkbox":"")}}_getChildren(e){this._hasIcons=!1,this._hasCheckbox=!1,this._activeSet.compute();const t=super._getChildren(e),{loadFailed:i}=this.state;return i&&t.push(i),t}};gt.ItemComponents={...Dt.ItemComponents,default:Ke,item:hn,heading:hn},gt.NAME="list";const Dc="```ZUI_STR\n";class Zs{constructor(e="",t="local"){this._cache=new Map,this._type=t,this._id=e,this._name=`ZUI_STORE:${this._id}`,this._storage=t==="local"?localStorage:sessionStorage}get type(){return this._type}get session(){return this.type==="session"?this:(this._altStorage||(this._altStorage=new Zs(this._id,"session")),this._altStorage)}_getKey(e){return`${this._name}:${e}`}switch(e){this._id=e,this._name=`ZUI_STORE:${this._id}`,this._cache.clear()}get(e,t){if(this._cache.has(e))return this._cache.get(e);const i=this._storage.getItem(this._getKey(e));if(typeof i=="string"){if(i.startsWith(Dc))return i.substring(Dc.length);try{return JSON.parse(i)}catch{}}return i??t}setCache(e,t){this._cache.set(e,t)}set(e,t){if(t==null)return this.remove(e);try{this._storage.setItem(this._getKey(e),typeof t=="string"?`${Dc}${t}`:JSON.stringify(t))}catch(i){this.setCache(e,t),console.warn(`[ZUI] Failed to set value to ${this._type} store: ${this._getKey(e)}, use cache instead.`,i)}}remove(e){this._cache.delete(e),this._storage.removeItem(this._getKey(e))}each(e){const t=[];for(let i=0;i<this._storage.length;i++){const s=this._storage.key(i);if(s!=null&&s.startsWith(this._name)){const r=this._storage.getItem(s),o=s.substring(this._name.length+1);typeof r=="string"&&e(o,JSON.parse(r)),t.push(o)}}for(const i of this._cache.keys())t.includes(i)||e(i,this._cache.get(i))}getAll(){const e={};this.each((t,i)=>{e[t]=i});for(const t of this._cache.keys())e[t]=this._cache.get(t);return e}}const Xe=new Zs("DEFAULT");function Ab(n,e="local"){return new Zs(n,e)}Object.assign(Xe,{create:Ab});const jT="";function ap(n,e){const{children:t}=n;t.length&&t.forEach(i=>{e(i),ap(i,e)})}function Eb(n,e){let t=n.parent;for(;t;)e(t),t=t.parent}function lp(n){return n.split(":").reduce((e,t,i)=>(e.push(i?e[i-1]+":"+t:t),e),[])}function Ic(n,e,t,i,s=0,r){return n.reduce((o,a,l)=>{if(!a)return o;const c=String((e?a[e]:a.key)??a.key??l),h=r?`${r.keyPath}:${c}`:c,u={key:c,level:s,keyPath:h,parentKey:r==null?void 0:r.keyPath,parent:r,data:a,children:[]};return r&&r.children.push(u),o=t(o,u),Array.isArray(a.items)?Ic(a.items,e,t,o,s+1,u):o},i)}let In=class extends gt{constructor(e){super(e);const{defaultNestedShow:t,preserve:i,nestedShow:s}=e;if(y.extend(this.state,typeof t=="boolean"?{defaultShow:t,nestedShow:{}}:{nestedShow:t||{}},s!==void 0?{nestedShow:s}:null),i&&s===void 0){this._storeID=`${this.constructor.NAME}:${i}:state`;const r=Xe.get(this._storeID);r&&(this.state.nestedShow=r.nestedShow)}if(!e.level){const r=this.state.nestedShow;r&&Object.keys(r).forEach(o=>{r[o]&&lp(o).forEach(a=>{r[a]=!0})}),this._needInitChecks=!0}this._renderedItemMap=new Map,this._handleClick=this._handleClick.bind(this),this._beforeRenderNestedItem=this._beforeRenderNestedItem.bind(this),this._handleNestedToggle=this._handleNestedToggle.bind(this),this._handleNestedCheck=this._handleNestedCheck.bind(this),this._preserveState=this._preserveState.bind(this)}get isRoot(){return!this.props.level}get nestedShow(){return this.props.nestedShow??this.state.nestedShow??!1}async setItems(e,t){var s;this.isRoot&&(this._needInitChecks=!0);const i=await super.setItems(e,t);return e&&((s=this.props.parent)==null?void 0:s.checked)===!0?this.toggleChecked(this._renderedItems.map(r=>r.key),!0):e!=null&&e.some(r=>r.checked)&&(this._needInitChecks=!0,this.forceUpdate()),i}getItemMap(e){if(e&&(this._itemMap||this._itemMapCache))return this._itemMap||this._itemMapCache;if(!this._itemMap){let t=!1;const i=Ic(this._items,this.props.itemKey,(s,r)=>(s.set(r.keyPath,r),r.data.items&&!Array.isArray(r.data.items)&&(t=!0),s),new Map);if(t)return this._renderedItemMap.forEach((s,r)=>{i.has(r)||i.set(r,{key:s.key,level:s._level,keyPath:r,parentKey:`${r.split(":").slice(0,-1).join(":")}`,children:[],data:s})}),i.forEach(s=>{const{parentKey:r}=s;if(!r)return;const o=i.get(r);o&&(o.children.push(s),s.parent=o)}),this._itemMapCache=i,i;this._itemMap=i}return this._itemMap}getRenderedItem(e){return this._renderedItemMap.get(e)}getItem(e){var s;const t=this._itemMap||this._itemMapCache;if(t)return(s=t.get(e))==null?void 0:s.data;const i=this.getRenderedItem(e);return i?i._item:super.getItem(e)}isExpanded(e){const{nestedShow:t}=this;return typeof t=="boolean"?t:!!(t[e]??this.state.defaultShow)}async toggle(e,t,i){const s=this.isExpanded(e);if(!i&&t===s)return;t===void 0&&(t=!s);const{nestedShow:r,onToggle:o,accordion:a}=this.props;o&&o.call(this,e,t,i)===!1||r===void 0&&await this.changeState(l=>{let c={...i?{}:l.nestedShow,[e]:t};if(t&&a){let h=`${e.split(":").slice(0,-1).join(":")}`;h.length&&(h+=":"),Object.keys(c).forEach(u=>{u!==e&&u.startsWith(h)&&(c[u]=!1)})}return c=t?lp(e).reduce((h,u)=>(h[u]=t,h),c):c,{nestedShow:c}},this._preserveState)}toggleAll(e){if(this.props.nestedShow===void 0)return this.setState({nestedShow:{},defaultShow:e},this._preserveState)}getChecks(){return Array.from(this.getItemMap(!0).values()).reduce((e,{keyPath:t,data:i})=>{const s=this.state.checked[t];return(s===!0||i.checked&&s!==!1)===!0&&e.push(t),e},[])}isChecked(e,t,i=!1){const s=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.isRoot?this.state.checked[e]??s.checked??i:this.props.checkedState[`${this.props.parentKey}:${e}`]??s.checked??i}async toggleChecked(e,t){let i;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),i=e.reduce((a,l)=>(a[l]=t,a),{})}else typeof e=="object"?i=e:(t===void 0&&(t=!this.isChecked(e)),i={[e]:t});if(!Object.keys(i).length)return;if(this.isRoot){await this.changeState(({checked:a,nestedShow:l})=>{const c=m=>i[m.keyPath]??a[m.keyPath]??m.data.checked??!1,h=this.getItemMap(),u={},{expandChildrenOnCheck:p}=this.props;return Object.keys(i).forEach(m=>{t=i[m];const v=h.get(m);v&&(ap(v,b=>{c(b)!==t&&(i[b.keyPath]=t)}),Eb(v,b=>{const{children:C}=b,S=C.reduce((D,N)=>(c(N)&&D++,D),0);i[b.keyPath]=S===C.length?!0:S?"indeterminate":!1}),p&&t&&v.data.items&&(u[m]=!0))}),{checked:{...a,...i},nestedShow:{...l,...u}}},()=>{var l;const a=this.state.checked;(l=this.props.onCheck)==null||l.call(this,i,Object.keys(a).filter(c=>a[c]===!0))});return}const{parentKey:s,onCheck:r}=this.props,o=Object.keys(i).reduce((a,l)=>(a[`${s!==void 0?`${s}:`:""}${l}`]=i[l],a),{});r.call(this,o,[])}getKeyPath(e){if(this.isRoot)return e;const t=this.props.parentKey;return e.startsWith(t+":")?e:`${t}:${e}`}isActive(e){if(typeof e=="object"){const t=e._keyPath??e.key;if(t===void 0)return!1;e=t}return this._activeSet.cache.has(this.getKeyPath(e))}async toggleActive(e,t){if(typeof e=="string"&&(e=[e]),e=e.map(i=>this.getKeyPath(i)),this.isRoot){await super.toggleActive(e,t),this.props.toggleOnActive&&e.forEach(i=>{this.isActive(i)&&!this.isExpanded(i)&&this.toggle(i,!0)});return}this.props.onActive.call(this,e,t??!this.isActive(e[0]))}activeNext(e,t=1){const i=this.getNextItem(this.getActiveKey(),e,t);i&&this.toggleActive(i._keyPath)}getNextItem(e,t,i=1,s=void 0){return s=s||Ic(this._items,this.props.itemKey,(r,o)=>(o.data.disabled||r.push({_keyPath:o.keyPath,type:"item",...o.data,...this._renderedItemMap.get(o.keyPath),key:o.keyPath}),r),[]),super.getNextItem(e,t,i,s)}_afterRender(e){if(super._afterRender(e),this._needInitChecks){const t={};this.getItemMap().forEach(s=>{s.data.checked!==void 0&&(t[s.keyPath]=s.data.checked)}),this.toggleChecked(t),this._needInitChecks=!1}}_preserveState(){this._storeID&&Xe.set(this._storeID,{nestedShow:this.state.nestedShow})}_getClassName(e){return[super._getClassName(e),"is-nested",e.level?"is-nested-sub":"is-nested-root"]}_getNestedProps(e,t,i,s){const{parentKey:r,level:o=0}=e,{isRoot:a}=this;return ke(this.constructor.inheritNestedProps.reduce((l,c)=>(l[c]=e[c],l),{}),{key:i.key,level:o+1,className:`is-nested-${s?"expanded":"collapsed"}`,items:t,parent:i,parentKey:r?`${r}:${i.key}`:i.key,nestedShow:this.nestedShow,defaultNestedShow:this.state.defaultShow,checkedState:e.checkedState||this.state.checked,onCheck:a?this._handleNestedCheck:e.onCheck,onToggle:a?this._handleNestedToggle:e.onToggle,beforeRenderItem:a?this._beforeRenderNestedItem:e.beforeRenderItem,active:a?this.getActiveKeys():e.active,onActive:a?this.toggleActive.bind(this):e.onActive},i.listProps)}_renderNestedList(e,t,i,s){if(!s&&!e.renderCollapsedList)return;const r=this._getNestedProps(e,t,i,s),o=this.constructor;return k(o,{...r},`nested:${i.key}`)}_renderNestedToggle(e,t){let i,s="";const{toggleIcons:r={}}=e;return typeof t=="boolean"?(i=t?r.expanded||k("span",{className:"caret-down"}):r.collapsed||k("span",{className:"caret-right"}),s=`state is-${t?"expanded":"collapsed"}`,$.isValidElement(i)||(i=k($e,{icon:i}))):(i=k($e,{icon:r.normal}),s="is-empty"),k("span",{className:V(`${this.name}-toggle nested-toggle-icon`,s),children:i})}_getItems(e){const t=super._getItems(e);return this.isRoot&&t!==this._items&&(this._itemMap=void 0),t}_getItem(e,t,i){const s=super._getItem(e,t,i)??t;if(!s)return s;const{parentKey:r}=e,o=s.key,a=`${r!==void 0?`${r}:`:""}${o}`;if(s.items){const l=s.expanded??this.isExpanded(a);ke(s,{expanded:l,className:["is-nested",`is-nested-${l?"show":"hide"}`]}),this._hasNestedItems=!0}return ke(s,{_level:e.level,_keyPath:a,parentKey:r})}_beforeRenderNestedItem(e,t){const{beforeRenderItem:i}=this.props;if(i){const s=i.call(this,e,t);s!==void 0&&(e=s)}return this._renderedItemMap.set(e._keyPath,e),e}_renderItem(e,t,i){(this._hasNestedItems||!this.isRoot)&&t.type==="item"&&t.toggleIcon===void 0&&(t.toggleIcon=this._renderNestedToggle(e,t.expanded));const s=t.items?this._renderNestedList(e,t.items,t,t.expanded):null;return t=ke(t,{"z-parent":t.parentKey,"z-key-path":t._keyPath},s?{children:s}:null),this._renderedItemMap.set(t._keyPath,t),super._renderItem(e,t,i)}_getItemFromEvent(e,t){t=t||e.target;let i=super._getItemFromEvent(e,t);if(!i){const r=t.closest("[z-list]");if(r){const o=r.getAttribute("z-list"),a=this.getItem(o),l=this.getRenderedItem(o);if(!a||!l)return;i={target:t,index:l._index,item:a,element:r,event:e,key:o,keyPath:o,renderedItem:l}}return}(e.type==="mouseenter"||e.type==="mouseleave"||e.type==="mouseover")&&(i.hover=e.type!=="mouseleave");const{parentKey:s}=this.props;return{...i,parentKey:s,keyPath:`${s!==void 0?`${s}:`:""}${i.key}`,target:t}}_handleNestedToggle(e,t,i){this.toggle(e,t,i)}_handleClick(e){const t=super._handleClick(e);if(t){const{renderedItem:i,keyPath:s,target:r}=t,{nestedToggle:o}=this.props;if(!i.items||e.defaultPrevented||r.closest(".not-nested-toggle")||o&&!i.disabled&&!r.closest(o)||!o&&!i.disabled&&r.closest("a,.btn,.item-checkbox,.open-url,input,select,textarea")&&!r.closest(".nested-toggle-icon,.item-icon"))return t;this.toggle(s),e.preventDefault()}return t}_handleNestedCheck(e){this.toggleChecked(e)}_getProps(e){const{level:t=0,indent:i=20,parentKey:s}=e,r=ke(super._getProps(e),{"z-level":t,"z-list":s,style:{"--list-nested-indent":`${t*i}px`,"--list-indent":`${i}px`},className:this._hasNestedItems?"has-nested-items":"no-nested-items"});return r.className=V(r.className),r}_beforeRender(e){return this._renderedItemMap.clear(),this._hasIcons=!1,this._hasNestedItems=!1,super._beforeRender(e)}};In.defaultProps={...gt.defaultProps,defaultNestedShow:!1,level:0,indent:20},In.inheritNestedProps=["component","name","itemName","itemKey","indent","hover","divider","multiline","toggleIcons","nestedToggle","accordion","itemRender","itemProps","onToggle","checkbox","getItem","getItems","checkOnClick","selectOnChecked","checkedState","onClickItem","activeOnHover","multipleActive","onActive","hoverItemActions"];const Nb=Object.freeze(Object.defineProperty({__proto__:null,List:gt,Listitem:hn,NestedList:In},Symbol.toStringTag,{value:"Module"}));class er extends ve{}er.NAME="List",er.Component=gt,er.replace=gt.TAG,er.register();class tr extends ve{}tr.NAME="NestedList",tr.Component=In,tr.replace=In.TAG,tr.register(),tt(Nb);const BT="",HT="",UT="",os=class Av extends In{constructor(e){super(e),this._handleHover=this._handleHover.bind(this)}get isHoverTrigger(){return this.props.nestedTrigger==="hover"}_getClassName(e){return[super._getClassName(e),this._hasNestedItems?"menu-nested":"",e.className,e.wrap?{"scrollbar-thin":e.scrollbarThin,"scrollbar-hover":e.scrollbarHover}:{popup:e.popup,compact:e.compact}]}_getWrapClass(e){return["menu-wrapper",e.wrapClass,{popup:e.popup,compact:e.compact}]}_getWrapperProps(e){const{wrapAttrs:t,height:i,maxHeight:s,parentKey:r}=e,o=ke({"z-list-wrapper":r},t,i||s?{style:{height:i,maxHeight:s}}:null,this.isRoot&&this.isHoverTrigger?{onMouseEnter:this._handleHover,onMouseLeave:this._handleHover,onMouseOver:this._handleHover}:null);return o.className=V(this._getWrapClass(e),o.className),o}_renderWrapperHeader(e){return k(ge,{content:e.header,generatorThis:this},"header")}_renderWrapperFooter(e){return k(ge,{content:e.footer,generatorThis:this},"footer")}_handleHover(e){const t=e.target;if(!(t instanceof HTMLElement)||!this.isHoverTrigger)return;let i;if(e.type!=="mouseleave"){const c=t.closest("[z-item]");if(c)i=c.getAttribute("z-key-path"),c.classList.contains("is-nested")||(i=c.getAttribute("z-parent"));else{const h=t.closest("[z-list-wrapper]");i=h==null?void 0:h.getAttribute("z-list-wrapper")}}const s=this._hoverInfo,r=s==null?void 0:s.keyPath;if(r===i)return;s!=null&&s.timer&&clearTimeout(s.timer);const o=typeof i=="string",l=o?typeof r=="string"&&(s!=null&&s.shown)?50:200:s!=null&&s.shown?100:200;this._hoverInfo={keyPath:i,timer:window.setTimeout(()=>{o?(this.toggle(i,!0,!0),this._hoverInfo.shown=!0):(this.toggleAll(!1),this._hoverInfo=void 0)},l)}}componentWillUnmount(){var t;super.componentWillUnmount();const e=(t=this._hoverInfo)==null?void 0:t.timer;e&&clearTimeout(e)}render(e){const t=super.render(e);return e.wrap?k("menu",{...this._getWrapperProps(e),children:[this._renderWrapperHeader(e),t,this._renderWrapperFooter(e)]}):t}static render(e,t,i,s){let r=typeof e=="function"?e.call(s??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),i&&(r=ke(i,r)),k(Av,{...r})}};os.NAME="menu",os.TAG="menu",os.inheritNestedProps=[...In.inheritNestedProps,"compact"],os.ItemComponents={...In.ItemComponents,item:[hn,{innerComponent:"a"}]},os.defaultProps={...In.defaultProps,scrollbarHover:!0};let Nt=os;const WT="",VT="",KT="";let ki=class extends me{constructor(e){super(e),this._input=he(),this._timer=0,this._handleClearBtnClick=t=>{t.stopPropagation(),this.clear(t)},this._handleChange=t=>{const i=this.state.value,s=t.target.value,{onChange:r,delay:o}=this.props;this.setState({value:s},()=>{!r||i===s||(o?(this._clearTimer(),this._timer=window.setTimeout(()=>{r(s,t),this._timer=0},o)):r(s,t))})},this._handleFocus=t=>{const i=t.type==="focus";this.setState({focus:i},()=>{const s=i?this.props.onFocus:this.props.onBlur;s==null||s(t)})},this.state={focus:!1,value:e.defaultValue||""},this._gid=e.id||`search-box-${Tt()}`}componentDidMount(){const{hotkeys:e}=this.props;if(e){const t=oc(e,{clear:{keys:"Escape",handler:i=>{this.clear(i)}},enter:{keys:"Enter",handler:i=>{var s,r;(r=(s=this.props).onEnter)==null||r.call(s,this.state.value,i)}}});t&&(this._hotkeysScope=`SearchBox_${this._gid}`,y(this.input).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}}componentWillUnmount(){this._hotkeysScope&&y(this.input).unbindHotkeys(this._hotkeysScope)}get id(){return this._gid}get input(){return this._input.current}focus(){var e;(e=this.input)==null||e.focus()}blur(){var e;(e=this.input)==null||e.blur()}clear(e){const t=this.state.value;this.setState({value:""},()=>{const{onChange:i,onClear:s}=this.props;s==null||s(e),this.focus(),t.trim()!==""&&(i==null||i("",e))})}_clearTimer(){this._timer&&clearTimeout(this._timer),this._timer=0}render(e,t){const{style:i,className:s,rootClass:r,rootStyle:o,readonly:a,disabled:l,circle:c,placeholder:h,mergeIcon:u,searchIcon:p,clearIcon:m,value:v,compact:b,prefixClass:C,suffixClass:S}=e,{focus:D,value:N}=t,{id:P}=this,H=v??N,q=typeof H!="string"||!H.trim().length;let Y,Q,Z;return p&&(Z=p===!0?k("span",{class:"magnifier"}):k($e,{icon:p})),!u&&p&&(Y=k("label",{for:P,class:V("input-control-prefix",C),children:Z},"prefix")),m&&!q?Q=k("button",{type:"button",class:"btn ghost size-sm square rounded-full",onClick:this._handleClearBtnClick,children:m===!0?k("span",{class:"close"}):k($e,{icon:m})}):u&&p&&(Q=Z),Q&&(Q=k("label",{for:P,class:V("input-control-suffix",S),children:Q},"suffix")),k("div",{class:V("search-box input-control",r,{focus:D,empty:q,compact:b,"has-prefix-icon":Y,"has-suffix-icon":Q}),style:o,children:[Y,k("input",{ref:this._input,id:P,type:"text",class:V("form-control",{"rounded-full":c,"size-sm":b},s),style:i,placeholder:h,disabled:l,readonly:a,value:H,onInput:this._handleChange,onChange:this._handleChange,onFocus:this._handleFocus,onBlur:this._handleFocus},"input"),Q]})}};ki.defaultProps={clearIcon:!0,searchIcon:!0,delay:500,hotkeys:!0};const Mb=Object.freeze(Object.defineProperty({__proto__:null,SearchBox:ki},Symbol.toStringTag,{value:"Module"}));let ut=class extends Nt{constructor(e){super(e),this._handleSearchChange=t=>{const i=this.constructor.getSearchKeys(t);this._searchKeys=i,this.setState({search:i.join(" ")})},this.state.search=e.search??e.defaultSearch,this._searchKeys=this.constructor.getSearchKeys(this.state.search),this._isNestedItemMatch=this._isNestedItemMatch.bind(this)}componentWillUpdate(e){this.isRoot&&e.search!==void 0&&e.search!==this.props.search&&(this._searchKeys=this.constructor.getSearchKeys(e.search))}componentDidMount(){super.componentDidMount(),this._updateMatchedParents()}componentDidUpdate(){super.componentDidUpdate(),this._updateMatchedParents()}isExpanded(e){return this.props.expandOnSearch&&this._searchKeys.length?!0:super.isExpanded(e)}_updateMatchedParents(){var i;if(!this.isRoot)return;const e=y(this.element),t=e.find(".item.is-nested.is-not-match").filter((s,r)=>this._matchedParents.has(r.getAttribute("z-key-path")||"")).addClass("has-match-child");e.parent().toggleClass("no-match-child",!!((i=this._searchKeys)!=null&&i.length)&&!t.length&&!e.children(".item").not(".is-not-match").length)}_isItemMatch(e,t,i,s){const{isItemMatch:r,nestedSearch:o}=e,a=r?r.call(this,t,this._searchKeys,i,s):this.constructor.isItemMatch(t,this._searchKeys,e.searchProps);if(o&&this.isRoot&&a&&s!==void 0){let l="";String(s).split(":").forEach(c=>{l+=`${l.length?":":""}${c}`,this._matchedParents.add(l)})}return a}_isNestedItemMatch(e,t,i,s){return this._isItemMatch(this.props,e,i,s)}_getNestedProps(e,t,i,s){const r=super._getNestedProps(e,t,i,s);return this.isRoot&&e.nestedSearch?(r.isItemMatch=this._isNestedItemMatch,r.search=this._searchKeys.join(" ")):e.nestedSearch||ke(r,{search:void 0,defaultSearch:void 0},i.listProps),r}_getItem(e,t,i){const s=super._getItem(e,t,i);return s&&(this.isRoot&&this.props.limit&&this._showCount>=this.props.limit?!1:(s.hidden=!this._isItemMatch(e,t,i,e.parentKey),s.hidden||this._showCount++,s))}_renderItem(e,t,i){return t.hidden&&!this._hasNestedItems?null:(t.className=[t.className,t.hidden?"is-not-match":""],!t.hidden&&e.underlineKeys&&this._searchKeys.length&&["text","title","subtitle","content"].forEach(s=>{typeof t[s]=="string"&&(t[s]=this.constructor.underlineKeys(this._searchKeys,[t[s]]))}),super._renderItem(e,t,i))}_getWrapClass(e){const t=this.isRoot&&this._searchKeys.length;return V(super._getWrapClass(e),"search-menu",e.searchBox?`search-menu-on-${e.searchPlacement||"top"}`:"",t?"is-search-mode":"",t&&e.expandOnSearch?"no-toggle-on-search":"")}_getSearchBoxProps(e){const{searchBox:t}=e,i={compact:!0,className:"not-nested-toggle",onChange:this._handleSearchChange};return typeof t=="object"&&ke(i,t),e.search!==void 0&&(i.value=this._searchKeys.join(" "),i.disabled=!0),i}_renderSearchBox(e){const t=this._getSearchBoxProps(e);return k(ki,{...t},"search")}_renderWrapperHeader(e){const t=e.header,{noMatchHint:i,searchBox:s,searchPlacement:r,nestedSearch:o,headerClass:a}=e,l=(!o||this.isRoot)&&s&&r!=="bottom";return!t&&!l&&!i?null:[i?k("div",{className:"search-menu-no-match-hint",children:i},"noMatchHint"):null,t||l?k("header",{className:V("search-menu-header",a),children:[t?super._renderWrapperHeader(e):null,l?this._renderSearchBox(e):null]},"header"):null]}_renderWrapperFooter(e){const t=e.footer,{searchBox:i,searchPlacement:s,nestedSearch:r,footerClass:o,exceedLimitHint:a,limit:l}=e,c=(!r||this.isRoot)&&i&&s==="bottom",h=a&&l&&this._items.length>l;return!t&&!c&&!h?null:k("footer",{className:V("search-menu-footer",o),children:[h?k("div",{className:"search-menu-exceed-limit-hint",children:we(a,this._items.length-l)}):null,t?super._renderWrapperFooter(e):null,c?this._renderSearchBox(e):null]},"footer")}_beforeRender(e){return this.isRoot&&(this._matchedParents=new Set,this._showCount=0),super._beforeRender(e)}static isItemMatch(e,t,i=["keys","text","title","subtitle"]){return t.length?t.every(s=>i.some(r=>{const o=typeof r=="function"?r(e):e[r];return typeof o=="string"&&o.length&&o.toLowerCase().includes(s)})):!0}static getSearchKeys(e=""){return y.unique(e.toLowerCase().split(" ").filter(t=>t.length))}static underlineKeys(e,t,i="is-match-keys"){return e.reduce((s,r)=>[...s].reduce((o,a)=>{if(typeof a!="string")return o.push(a),o;const l=a.toLowerCase().split(r);if(l.length===1)return o.push(a),o;let c=0;return l.forEach((h,u)=>{u&&(o.push(k("span",{class:i,children:a.substring(c,c+r.length)})),c+=r.length),o.push(a.substring(c,c+h.length)),c+=h.length}),o},[]),t)}};ut.inheritNestedProps=[...Nt.inheritNestedProps,"isItemMatch","search","underlineKeys","nestedSearch"],ut.defaultProps={...Nt.defaultProps,defaultNestedShow:!0,wrap:!0,nestedSearch:!0,underlineKeys:!0,limit:200};const Pb=Object.freeze(Object.defineProperty({__proto__:null,Menu:Nt,SearchMenu:ut},Symbol.toStringTag,{value:"Module"}));class Ho extends ve{}Ho.NAME="Menu",Ho.Component=Nt,Ho.replace=Nt.TAG;class Uo extends ve{}Uo.NAME="SearchMenu",Uo.Component=ut,Uo.replace=ut.TAG,tt(Pb);const qT="",GT="",YT="",XT="",QT="",JT="",ZT="",eD="",tD="",nD="",iD="";function Lb({className:n,style:e,actions:t,heading:i,content:s,contentClass:r,children:o,close:a,onClose:l,icon:c,iconClass:h,...u}){let p;a===!0?p=k(xe,{className:"alert-close btn ghost square text-inherit",square:!0,onClick:l,children:k("span",{class:"close"})}):$.isValidElement(a)?p=a:typeof a=="object"&&(p=k(xe,{...a,onClick:l}));const m=Be.render(t,[]);return k("div",{className:V("alert",n),style:e,...u,children:[k($e,{icon:c,className:V("alert-icon",h)}),typeof s!="string"?k(ge,{content:s}):k("div",{className:V("alert-content",r),children:[typeof i!="string"?k(ge,{content:i}):i&&k("div",{className:"alert-heading",children:i}),k("div",{className:"alert-text",children:s}),i?m:null]}),i?null:m,p,o]})}function Rb(n){if(n==="center")return"fade-from-center";if(n){if(n.includes("top"))return"fade-from-top";if(n.includes("bottom"))return"fade-from-bottom"}return"fade"}let Ob=class extends me{render(e){const{margin:t,type:i,placement:s,animation:r,show:o,className:a,time:l,...c}=e;return typeof c.html=="string"&&(c.content={html:c.html},delete c.html),k(Lb,{className:V("messager",a,i,r===!0?Rb(s):r,o?"in":""),...c})}};class $c extends ve{constructor(){super(...arguments),this._show=!1,this._showTimer=0,this._afterRender=({firstRender:e})=>{e&&this.show();const{margin:t}=this.options;t&&this.$element.css("margin",`${t}px`)}}get isShown(){return this._show}afterInit(){this.on("click",e=>{y(e.target).closest('.alert-close,[data-dismiss="messager"]').length&&(e.preventDefault(),e.stopPropagation(),this.hide())})}setOptions(e,t){return e=super.setOptions(e,t),{...e,show:this._show,afterRender:this._afterRender}}show(){this.render(),this.emit("show"),this._resetTimer(()=>{this._show=!0,this.render(),this._resetTimer(()=>{this.emit("shown");const{time:e}=this.options;e&&this._resetTimer(()=>this.hide(),e)})},100)}hide(){this._show&&this._resetTimer(()=>{this.emit("hide"),this._show=!1,this.render(),this._resetTimer(()=>{this.emit("hidden")})},50)}_resetTimer(e,t=200){this._showTimer&&clearTimeout(this._showTimer),this._showTimer=window.setTimeout(()=>{e(),this._showTimer=0},t)}}$c.NAME="MessagerItem",$c.Component=Ob;const nr=class Ev extends We{get isShown(){var e;return!!((e=this._item)!=null&&e.isShown)}show(e){this.setOptions(e),this._getItem().show()}hide(){var e;(e=this._item)==null||e.hide()}_getItem(){const e={...this.options};if(this._item)this._item.setOptions(e);else{const t=this._getHolder(),i=new $c(t,e);i.on("hidden",()=>{i.destroy(),t==null||t.remove(),this._holder=void 0,this._item=void 0}),this._item=i}return this._item}_getHolder(){if(this._holder)return this._holder;const{placement:e="top"}=this.options;let t=this.$element.find(`.messagers-${e}`);t.length||(t=y(`<div class="messagers messagers-${e}"></div>`).appendTo(this.$element));let i=t.find(`#messager-${this.gid}`);return i.length||(i=y(`<div class="messager-holder" id="messager-${this.gid}"></div>`).appendTo(t),this._holder=i[0]),i[0]}static show(e,t){typeof e=="string"&&(e={content:e});const{container:i,...s}=e,r={type:t,key:`messager_${Tt()}`,...s};r.type&&y.extend(r,this.TypeOptions[r.type]);const o=Ev.ensure(i||"body",r);return o.hide(),o.show(),o}};nr.NAME="messager",nr.DEFAULT={placement:"top",animation:!0,close:!0,margin:6,time:5e3},nr.MULTI_INSTANCE=!0,nr.TypeOptions={};let Kn=nr,Wo=class extends me{render(e){const{percent:t=50,color:i,background:s=null,height:r,width:o,children:a,className:l,style:c}=e;return k("div",{class:V("progress",l),style:{width:o,height:r,"--progress-bg":s,"--progress-bar-color":i,...c},children:[k("div",{class:"progress-bar",style:{width:`${t}%`}}),a]})}};Wo.defaultProps={percent:50,height:20,width:"auto"},tt(Object.freeze(Object.defineProperty({__proto__:null,ProgressBar:Wo},Symbol.toStringTag,{value:"Module"})));class Ac extends ve{}Ac.NAME="ProgressBar",Ac.Component=Wo,Ac.register();const rD="",oD="";let Vo=class extends me{render(e){const{percent:t=50,size:i=24,circleBg:s,circleColor:r,text:o,className:a,textStyle:l,textX:c,textY:h,children:u}=e,p=i/2;let{circleWidth:m=.1}=e;m<1&&(m=i*m);const v=(i-m)/2;return k("svg",{className:a,width:i,height:i,children:[k("circle",{cx:p,cy:p,r:v,"stroke-width":m,stroke:s,fill:"transparent"}),k("circle",{cx:p,cy:p,r:v,"stroke-width":m,stroke:r,fill:"transparent","stroke-linecap":"round","stroke-dasharray":Math.PI*v*2,"stroke-dashoffset":Math.PI*v*2*(100-t)/100,style:{transformOrigin:"center",transform:"rotate(-90deg)"}}),o?k("text",{x:c??p,y:h??p+m/2,"dominant-baseline":"middle","text-anchor":"middle",style:l||{fontSize:`${v}px`,stroke:"currentColor"},children:o===!0?Math.floor(t):o}):null,u]})}};Vo.defaultProps={circleBg:"var(--color-surface)",circleColor:"var(--color-primary-500)",text:!0};class Ko extends ve{}Ko.NAME="ProgressCircle",Ko.Component=Vo,Ko.register(),tt(Object.freeze(Object.defineProperty({__proto__:null,ProgressCircle:Vo},Symbol.toStringTag,{value:"Module"})));const lD="",cD="",uD="",hD="",dD="",fD="",pD="",mD="",gD="",ir='[droppable="true"]';class sr extends We{constructor(){super(...arguments),this._state={dragging:null,dropping:null},this._handleMouseDown=e=>{const{selector:t,handle:i,beforeDrag:s}=this.options,r=y(e.target),o=r.closest(t),a=o[0];!a||i&&!r.closest(i).length||s&&s.call(this,e,a)===!1||(o.attr("draggable","true"),this._setState({dragging:a}))},this._handleDragStart=e=>{const{dragElement:t}=this;if(!t){e.preventDefault();return}const{options:i}=this,{onDragStart:s}=i;if(s&&s.call(this,e,t)===!1){this._clean();return}const{$element:r}=this,{target:o,selector:a,draggingClass:l,droppableClass:c,hasDraggingClass:h,canDrop:u}=i;l&&(this.$element.find(l).removeClass(l),y(t).addClass(l));let p=typeof o=="function"?y(o.call(this,t)):r.find(o||a||ir);if(u&&(p=p.filter((m,v)=>u.call(this,e,t,v)!==!1)),!p.length){this._clean();return}c&&(r.find(c).removeClass(c),p.addClass(c)),h&&r.addClass(h),r.find(ir).removeAttr("droppable"),p.attr("droppable","true"),this._$targets=p},this._handleDrag=e=>{var i;const{dragElement:t}=this;t&&(this._setDragEffect(e),(i=this.options.onDrag)==null||i.call(this,e,t))},this._handleDragEnd=e=>{var i;const{dragElement:t}=this;t&&((i=this.options.onDragEnd)==null||i.call(this,e,t)),this._clean()},this._handleDragEnter=e=>{this._handleDragOver(e)},this._handleDragOver=e=>{var o,a;const{dragElement:t}=this,s=y(e.target).closest(ir)[0];if(!t||!s)return;const r=this.state.dropping;if(e.preventDefault(),this._setDragEffect(e),r!==s){const{droppingClass:l}=this.options;l&&(r&&this._leaveDropElement(e,r),y(s).addClass(l)),this._setState({dropping:s}),(o=this.options.onDragEnter)==null||o.call(this,e,t,s)}(a=this.options.onDragOver)==null||a.call(this,e,t,s)},this._handleDragLeave=e=>{const{dragElement:t}=this,i=y(e.target).filter(ir)[0];!t||!i||(e.preventDefault(),this._leaveDropElement(e,i),this._setState({dropping:null}))},this._handleDrop=e=>{var i;const t=y(e.target).closest(ir)[0];t&&(e.preventDefault(),(i=this.options.onDrop)==null||i.call(this,e,this.dragElement,t)),this._needClean=!0,setTimeout(()=>{this._needClean&&this._clean()},50)}}get state(){return this._state}get dragElement(){return this._state.dragging}get dropElement(){return this._state.dropping}async afterInit(){const{namespace:e}=this,{dragContainer:t,dropContainer:i,onDrag:s}=this.options;this._$dragContainer=t?y(t):this.$element,this._$dropContainer=i?y(i):this._$dragContainer,this._$dragContainer.on("mousedown"+e,this._handleMouseDown).on("dragstart"+e,this._handleDragStart).on("dragend"+e,this._handleDragEnd),s&&this._$dragContainer.on("drag"+e,this._handleDrag),this._$dropContainer.on("dragover"+e,this._handleDragOver).on("dragenter"+e,this._handleDragEnter).on("dragleave"+e,this._handleDragLeave).on("drop"+e,this._handleDrop),y(document).on(`mouseup${this.namespace}`,this._clean.bind(this))}destroy(){this._clean(),y(document).off(this.namespace),this._$dragContainer.off(this.namespace),this._$dropContainer.off(this.namespace),super.destroy()}_setState(e){var r;const t=this._state,{dragging:i=t.dragging,dropping:s=t.dropping}=e;i===t.dragging&&s===t.dropping||(this._state={dragging:i,dropping:s},(r=this.options.onChange)==null||r.call(this,this._state,t))}_setDragEffect(e){const{dropEffect:t}=this.options;t&&(e.dataTransfer.dropEffect=t)}_leaveDropElement(e,t){var s;const{droppingClass:i}=this.options;i&&y(t).removeClass(i),(s=this.options.onDragLeave)==null||s.call(this,e,this.dragElement,t)}_clean(){this._needClean=!0;const{draggingClass:e,droppableClass:t,droppingClass:i,hasDraggingClass:s}=this.options;s&&this.$element.removeClass(s);const{dragElement:r}=this;if(r){const a=y(r);e&&a.removeClass(e)}this._setState({dropping:null,dragging:null});const o=this._$targets;o&&(t&&o.removeClass(t),i&&o.removeClass(i),this._$targets=void 0)}}sr.NAME="Draggable",sr.DEFAULT={selector:'[draggable="true"]',dropEffect:"move",hasDraggingClass:"has-dragging",draggingClass:"is-dragging",droppableClass:"is-droppable",droppingClass:"is-dropping"};const Fb='[moveable="true"]',Ec=class Nv extends We{constructor(){super(...arguments),this._handleMouseDown=e=>{const{options:t}=this,{selector:i,handle:s,onMoveStart:r}=t,o=y(e.target),a=i==="self"?this.$element:o.closest(i),l=a[0];if(!l||s&&!o.closest(s).length||r&&r.call(this,e,l)===!1)return;a.attr("moveable","true");const{movingClass:c,hasMovingClass:h}=t;c&&a.addClass(c),h&&this.$element.addClass(h),e.preventDefault(),this._setState(e,l),y(document).off("mousemove mouseup").on(`mousemove${this.namespace}`,this._handleMouseMove.bind(this)).on(`mouseup${this.namespace}`,this._handleMouseUp.bind(this))},this._handleMouseMove=e=>{!this._state||!e.buttons||(e.preventDefault(),this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{var t;this._raf=0,this._setState(e),(t=this.options.onMove)==null||t.call(this,e,this._state)}))},this._handleMouseUp=e=>{var t,i;this._state&&(this._raf&&(cancelAnimationFrame(this._raf),this._raf=0),this._setState(e),(t=this.options.onMove)==null||t.call(this,e,this._state),(i=this.options.onMoveEnd)==null||i.call(this,e,this._state),this._clean())}}get state(){return this._state}get moveElement(){var e;return(e=this._state)==null?void 0:e.target}async afterInit(){this.on("mousedown",this._handleMouseDown)}destroy(){this._clean(),y(document).off(this.namespace),super.destroy()}_setState(e,t){var l;let i={x:e.pageX,y:e.pageY};const s=this._state;if(t){const c=y(t);let h;if(this.options.move===!0){const p=c.css("position");h=p==="fixed"||p==="absolute"||p==="relative"?"position":"transform"}else h=this.options.move||"none";const u=h==="transform"?Nv.getTranslate(t):h==="scroll"?{left:t.scrollLeft,top:t.scrollTop}:c.position();i=y.extend(i,{strategy:h,target:t,startX:i.x,startY:i.y,deltaX:0,deltaY:0,startLeft:u.left,startTop:u.top,left:u.left,top:u.top,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop})}else if(s){const c=i.x-s.startX,h=i.y-s.startY;i=y.extend({},s,i,{deltaX:c,deltaY:h,left:s.startLeft+c,top:s.startTop+h})}this._state=i;const{strategy:r,target:o}=i,a=y(o);r==="position"?a.css({left:i.left,top:i.top}):r==="transform"?a.css("transform",`translate(${i.left}px, ${i.top}px)`):r==="scroll"&&(o.scrollLeft=i.scrollLeft-i.deltaX,o.scrollTop=i.scrollTop-i.deltaY),(l=this.options.onChange)==null||l.call(this,i,s,e)}_clean(){y(document).off("mousemove mouseup");const{hasMovingClass:e,movingClass:t}=this.options;e&&this.$element.removeClass(e);const{moveElement:i}=this;if(i){const s=y(i);t&&s.removeClass(t)}this._state=void 0}static getTranslate(e){const i=window.getComputedStyle(e).getPropertyValue("transform");if(i==="none")return{left:0,top:0};const s=i.match(/^matrix\((.+)\)$/);if(!s)return{left:0,top:0};const r=s[1].split(", ");return{left:parseFloat(r[4]),top:parseFloat(r[5])}}};Ec.NAME="Moveable",Ec.DEFAULT={selector:Fb,hasMovingClass:"has-moving",movingClass:"is-moving",move:!0};let rr=Ec;const Nc=class Mv extends We{async afterInit(){const e=await Mv.loadModule(),{options:t}=this;if(t.dragShadow!==void 0&&t.dragShadow!==!0){const{dragShadow:i,onEnd:s,setData:r}=t;t.setData=(o,a)=>{i===!1&&!this._emptyShadow&&(this._emptyShadow=a.cloneNode(!0),this._emptyShadow.classList.add("sortable-empty-shadow"),document.body.appendChild(this._emptyShadow)),o.setDragImage(i===!1?this._emptyShadow:i,0,0),r==null||r(o,a)},t.onEnd=o=>{var a;s==null||s(o),(a=this._emptyShadow)==null||a.remove(),this._emptyShadow=void 0},delete t.dragShadow}this.module=new e(this.element,t)}option(e,t){if(t===void 0)return this.module.option(e);this.module.option(e,t)}closest(e,t){return this.module.closest(e,t)}sort(e,t){this.module.sort(e,t)}save(){this.module.save()}destroy(){super.destroy(),this.module.destroy()}toArray(){return this.module.toArray()}static async loadModule(){return this.Module||(this.Module=await y.getLib("sortablejs")),this.Module}};Nc.NAME="Sortable",Nc.DEFAULT={animation:150};let qo=Nc;y.registerLib("sortablejs",{src:"sortable/sortable.min.js",check:"Sortable"});let or=class extends gt{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new qo(this.element,e))}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-list"]}_getSortableOptions(){const{sortable:e,canSortTo:t}=this.props;if(!e)return;const i=typeof e=="object"?e:{};return{group:`SortableList.${this.gid}`,dataIdAttr:"z-key",draggable:".list-item",...i,onSort:s=>{var o,a;const r=this.getOrders();(o=this.props.onSort)==null||o.call(this,s,r),(a=i.onSort)==null||a.call(this,s)},onMove:(s,r)=>{var o;if(t){const a=s.dragged.getAttribute("z-key-path"),l=s.related.getAttribute("z-key-path"),c=this.getItem(a),h=this.getItem(l),u=t.call(this,s,c,h);if(u!==void 0)return u}return(o=i.onMove)==null?void 0:o.call(this,s,r)}}}};or.defaultProps={...gt.defaultProps,sortable:!0};let It=class extends Nt{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,i){return this.constructor.getTreeItem(e,super._getItem(e,t,i))}static getTreeItem(e,t){return t&&(t.type==="item"&&(t.icon===void 0&&(t.icon=t.items?t.expanded?e.expandedIcon:e.collapsedIcon:e.normalIcon),t.actions===void 0&&(t.actions=e.itemActions)),t)}};It.NAME="tree",It.defaultProps={...Nt.defaultProps,indent:12},It.defaultItemProps={...Nt.defaultItemProps,innerComponent:"div"},It.inheritNestedProps=[...Nt.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"];let Ti=class extends ut{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,i){return It.getTreeItem(e,super._getItem(e,t,i))}};Ti.NAME="tree",Ti.inheritNestedProps=[...ut.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"],Ti.ItemComponents={...ut.ItemComponents,item:[hn,{innerComponent:"div"}]};const zb=Object.freeze(Object.defineProperty({__proto__:null,SearchTree:Ti,Tree:It},Symbol.toStringTag,{value:"Module"}));let as=class extends It{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new qo(this.element,e))}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-tree"]}_getSortableOptions(){const{sortable:e}=this.props;if(!e)return;const t=typeof e=="object"?e:{},{onSort:i,canSortTo:s,parentKey:r}=this.props;return{group:`SortableTree.${this.gid}`,dataIdAttr:"z-key",draggable:".tree-item",...t,onSort:o=>{var l;const a=this.getOrders();i==null||i.call(this,o,a,r),(l=t.onSort)==null||l.call(this,o)},onMove:(o,a)=>{var l;if(s){const c=o.dragged.getAttribute("z-key-path"),h=o.related.getAttribute("z-key-path"),u=this.getItem(c),p=this.getItem(h),m=s.call(this,o,u,p,r);if(m!==void 0)return m}return(l=t.onMove)==null?void 0:l.call(this,o,a)}}}};as.defaultProps={...It.defaultProps,sortable:!0},as.inheritNestedProps=[...It.inheritNestedProps,"onSort","sortable","canSortTo"];class Go extends ve{}Go.NAME="SortableList",Go.Component=or,Go.replace=or.TAG;class Yo extends ve{}Yo.NAME="SortableTree",Yo.Component=as,Yo.replace=as.TAG;const yD="";/*! js-cookie v3.0.1 | MIT */function Xo(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)n[i]=t[i]}return n}var jb={read:function(n){return n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(n){return encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Mc(n,e){function t(s,r,o){if(!(typeof document>"u")){o=Xo({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var l in o)o[l]&&(a+="; "+l,o[l]!==!0&&(a+="="+o[l].split(";")[0]));return document.cookie=s+"="+n.write(r,s)+a}}function i(s){if(!(typeof document>"u"||arguments.length&&!s)){for(var r=document.cookie?document.cookie.split("; "):[],o={},a=0;a<r.length;a++){var l=r[a].split("="),c=l.slice(1).join("=");try{var h=decodeURIComponent(l[0]);if(o[h]=n.read(c,h),s===h)break}catch{}}return s?o[s]:o}}return Object.create({set:t,get:i,remove:function(s,r){t(s,"",Xo({},r,{expires:-1}))},withAttributes:function(s){return Mc(this.converter,Xo({},this.attributes,s))},withConverter:function(s){return Mc(Xo({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(n)}})}var cp=Mc(jb,{path:"/"});window.$&&Object.assign(window.$,{cookie:cp});var up=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hp={exports:{}};(function(n,e){(function(t,i){n.exports=i()})(up,function(){var t=function(d,f){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,_){g.__proto__=_}||function(g,_){for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&(g[x]=_[x])})(d,f)},i=function(){return(i=Object.assign||function(d){for(var f,g=1,_=arguments.length;g<_;g++)for(var x in f=arguments[g])Object.prototype.hasOwnProperty.call(f,x)&&(d[x]=f[x]);return d}).apply(this,arguments)};function s(d,f,g){if(g||arguments.length===2)for(var _,x=0,T=f.length;x<T;x++)!_&&x in f||((_=_||Array.prototype.slice.call(f,0,x))[x]=f[x]);return d.concat(_||Array.prototype.slice.call(f))}var r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:up,o=Object.keys,a=Array.isArray;function l(d,f){return typeof f!="object"||o(f).forEach(function(g){d[g]=f[g]}),d}typeof Promise>"u"||r.Promise||(r.Promise=Promise);var c=Object.getPrototypeOf,h={}.hasOwnProperty;function u(d,f){return h.call(d,f)}function p(d,f){typeof f=="function"&&(f=f(c(d))),(typeof Reflect>"u"?o:Reflect.ownKeys)(f).forEach(function(g){v(d,g,f[g])})}var m=Object.defineProperty;function v(d,f,g,_){m(d,f,l(g&&u(g,"get")&&typeof g.get=="function"?{get:g.get,set:g.set,configurable:!0}:{value:g,configurable:!0,writable:!0},_))}function b(d){return{from:function(f){return d.prototype=Object.create(f.prototype),v(d.prototype,"constructor",d),{extend:p.bind(null,d.prototype)}}}}var C=Object.getOwnPropertyDescriptor,S=[].slice;function D(d,f,g){return S.call(d,f,g)}function N(d,f){return f(d)}function P(d){if(!d)throw new Error("Assertion Failed")}function H(d){r.setImmediate?setImmediate(d):setTimeout(d,0)}function q(d,f){if(typeof f=="string"&&u(d,f))return d[f];if(!f)return d;if(typeof f!="string"){for(var g=[],_=0,x=f.length;_<x;++_){var T=q(d,f[_]);g.push(T)}return g}var I=f.indexOf(".");if(I!==-1){var A=d[f.substr(0,I)];return A==null?void 0:q(A,f.substr(I+1))}}function Y(d,f,g){if(d&&f!==void 0&&!("isFrozen"in Object&&Object.isFrozen(d)))if(typeof f!="string"&&"length"in f){P(typeof g!="string"&&"length"in g);for(var _=0,x=f.length;_<x;++_)Y(d,f[_],g[_])}else{var T,I,A=f.indexOf(".");A!==-1?(T=f.substr(0,A),(I=f.substr(A+1))===""?g===void 0?a(d)&&!isNaN(parseInt(T))?d.splice(T,1):delete d[T]:d[T]=g:Y(A=!(A=d[T])||!u(d,T)?d[T]={}:A,I,g)):g===void 0?a(d)&&!isNaN(parseInt(f))?d.splice(f,1):delete d[f]:d[f]=g}}function Q(d){var f,g={};for(f in d)u(d,f)&&(g[f]=d[f]);return g}var Z=[].concat;function ue(d){return Z.apply([],d)}var On="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ue([8,16,32,64].map(function(d){return["Int","Uint","Float"].map(function(f){return f+d+"Array"})}))).filter(function(d){return r[d]}),J=new Set(On.map(function(d){return r[d]})),se=null;function ye(d){return se=new WeakMap,d=function f(g){if(!g||typeof g!="object")return g;var _=se.get(g);if(_)return _;if(a(g)){_=[],se.set(g,_);for(var x=0,T=g.length;x<T;++x)_.push(f(g[x]))}else if(J.has(g.constructor))_=g;else{var I,A=c(g);for(I in _=A===Object.prototype?{}:Object.create(A),se.set(g,_),g)u(g,I)&&(_[I]=f(g[I]))}return _}(d),se=null,d}var _e={}.toString;function Ee(d){return _e.call(d).slice(8,-1)}var Oe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ce=typeof Oe=="symbol"?function(d){var f;return d!=null&&(f=d[Oe])&&f.apply(d)}:function(){return null};function ee(d,f){return f=d.indexOf(f),0<=f&&d.splice(f,1),0<=f}var Se={};function Ce(d){var f,g,_,x;if(arguments.length===1){if(a(d))return d.slice();if(this===Se&&typeof d=="string")return[d];if(x=ce(d)){for(g=[];!(_=x.next()).done;)g.push(_.value);return g}if(d==null)return[d];if(typeof(f=d.length)!="number")return[d];for(g=new Array(f);f--;)g[f]=d[f];return g}for(f=arguments.length,g=new Array(f);f--;)g[f]=arguments[f];return g}var Me=typeof Symbol<"u"?function(d){return d[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Jr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Yt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Jr),ri={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function wt(d,f){this.name=d,this.message=f}function Pn(d,f){return d+". Errors: "+Object.keys(f).map(function(g){return f[g].toString()}).filter(function(g,_,x){return x.indexOf(g)===_}).join(`
`)}function Ln(d,f,g,_){this.failures=f,this.failedKeys=_,this.successCount=g,this.message=Pn(d,f)}function At(d,f){this.name="BulkError",this.failures=Object.keys(f).map(function(g){return f[g]}),this.failuresByPos=f,this.message=Pn(d,this.failures)}b(wt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),b(Ln).from(wt),b(At).from(wt);var oi=Yt.reduce(function(d,f){return d[f]=f+"Error",d},{}),yn=wt,fe=Yt.reduce(function(d,f){var g=f+"Error";function _(x,T){this.name=g,x?typeof x=="string"?(this.message="".concat(x).concat(T?`
 `+T:""),this.inner=T||null):typeof x=="object"&&(this.message="".concat(x.name," ").concat(x.message),this.inner=x):(this.message=ri[f]||g,this.inner=null)}return b(_).from(yn),d[f]=_,d},{});fe.Syntax=SyntaxError,fe.Type=TypeError,fe.Range=RangeError;var Yr=Jr.reduce(function(d,f){return d[f+"Error"]=fe[f],d},{}),il=Yt.reduce(function(d,f){return["Syntax","Type","Range"].indexOf(f)===-1&&(d[f+"Error"]=fe[f]),d},{});function qe(){}function Xr(d){return d}function Hk(d,f){return d==null||d===Xr?f:function(g){return f(d(g))}}function Oi(d,f){return function(){d.apply(this,arguments),f.apply(this,arguments)}}function Uk(d,f){return d===qe?f:function(){var g=d.apply(this,arguments);g!==void 0&&(arguments[0]=g);var _=this.onsuccess,x=this.onerror;this.onsuccess=null,this.onerror=null;var T=f.apply(this,arguments);return _&&(this.onsuccess=this.onsuccess?Oi(_,this.onsuccess):_),x&&(this.onerror=this.onerror?Oi(x,this.onerror):x),T!==void 0?T:g}}function Wk(d,f){return d===qe?f:function(){d.apply(this,arguments);var g=this.onsuccess,_=this.onerror;this.onsuccess=this.onerror=null,f.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?Oi(g,this.onsuccess):g),_&&(this.onerror=this.onerror?Oi(_,this.onerror):_)}}function Vk(d,f){return d===qe?f:function(g){var _=d.apply(this,arguments);l(g,_);var x=this.onsuccess,T=this.onerror;return this.onsuccess=null,this.onerror=null,g=f.apply(this,arguments),x&&(this.onsuccess=this.onsuccess?Oi(x,this.onsuccess):x),T&&(this.onerror=this.onerror?Oi(T,this.onerror):T),_===void 0?g===void 0?void 0:g:l(_,g)}}function Kk(d,f){return d===qe?f:function(){return f.apply(this,arguments)!==!1&&d.apply(this,arguments)}}function zh(d,f){return d===qe?f:function(){var g=d.apply(this,arguments);if(g&&typeof g.then=="function"){for(var _=this,x=arguments.length,T=new Array(x);x--;)T[x]=arguments[x];return g.then(function(){return f.apply(_,T)})}return f.apply(this,arguments)}}il.ModifyError=Ln,il.DexieError=wt,il.BulkError=At;var vn=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Xy(d){vn=d}var Qr={},Qy=100,On=typeof Promise>"u"?[]:function(){var d=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[d,c(d),d];var f=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[f,c(f),d]}(),Jr=On[0],Yt=On[1],On=On[2],Yt=Yt&&Yt.then,Zr=Jr&&Jr.constructor,jh=!!On,eo=function(d,f){to.push([d,f]),sl&&(queueMicrotask(Gk),sl=!1)},Bh=!0,sl=!0,Fi=[],rl=[],Hh=Xr,ai={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qe,pgp:!1,env:{},finalize:qe},de=ai,to=[],zi=0,ol=[];function le(d){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var f=this._PSD=de;if(typeof d!="function"){if(d!==Qr)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Wh(this,this._value))}this._state=null,this._value=null,++f.ref,function g(_,x){try{x(function(T){if(_._state===null){if(T===_)throw new TypeError("A promise cannot be resolved with itself.");var I=_._lib&&Ns();T&&typeof T.then=="function"?g(_,function(A,R){T instanceof le?T._then(A,R):T.then(A,R)}):(_._state=!0,_._value=T,Zy(_)),I&&Ms()}},Wh.bind(null,_))}catch(T){Wh(_,T)}}(this,d)}var Uh={get:function(){var d=de,f=ul;function g(_,x){var T=this,I=!d.global&&(d!==de||f!==ul),A=I&&!ci(),R=new le(function(M,z){Vh(T,new Jy(tv(_,d,I,A),tv(x,d,I,A),M,z,d))});return this._consoleTask&&(R._consoleTask=this._consoleTask),R}return g.prototype=Qr,g},set:function(d){v(this,"then",d&&d.prototype===Qr?Uh:{get:function(){return d},set:Uh.set})}};function Jy(d,f,g,_,x){this.onFulfilled=typeof d=="function"?d:null,this.onRejected=typeof f=="function"?f:null,this.resolve=g,this.reject=_,this.psd=x}function Wh(d,f){var g,_;rl.push(f),d._state===null&&(g=d._lib&&Ns(),f=Hh(f),d._state=!1,d._value=f,_=d,Fi.some(function(x){return x._value===_._value})||Fi.push(_),Zy(d),g&&Ms())}function Zy(d){var f=d._listeners;d._listeners=[];for(var g=0,_=f.length;g<_;++g)Vh(d,f[g]);var x=d._PSD;--x.ref||x.finalize(),zi===0&&(++zi,eo(function(){--zi==0&&Kh()},[]))}function Vh(d,f){if(d._state!==null){var g=d._state?f.onFulfilled:f.onRejected;if(g===null)return(d._state?f.resolve:f.reject)(d._value);++f.psd.ref,++zi,eo(qk,[g,d,f])}else d._listeners.push(f)}function qk(d,f,g){try{var _,x=f._value;!f._state&&rl.length&&(rl=[]),_=vn&&f._consoleTask?f._consoleTask.run(function(){return d(x)}):d(x),f._state||rl.indexOf(x)!==-1||function(T){for(var I=Fi.length;I;)if(Fi[--I]._value===T._value)return Fi.splice(I,1)}(f),g.resolve(_)}catch(T){g.reject(T)}finally{--zi==0&&Kh(),--g.psd.ref||g.psd.finalize()}}function Gk(){ji(ai,function(){Ns()&&Ms()})}function Ns(){var d=Bh;return sl=Bh=!1,d}function Ms(){var d,f,g;do for(;0<to.length;)for(d=to,to=[],g=d.length,f=0;f<g;++f){var _=d[f];_[0].apply(null,_[1])}while(0<to.length);sl=Bh=!0}function Kh(){var d=Fi;Fi=[],d.forEach(function(_){_._PSD.onunhandled.call(null,_._value,_)});for(var f=ol.slice(0),g=f.length;g;)f[--g]()}function al(d){return new le(Qr,!1,d)}function Qe(d,f){var g=de;return function(){var _=Ns(),x=de;try{return ui(g,!0),d.apply(this,arguments)}catch(T){f&&f(T)}finally{ui(x,!1),_&&Ms()}}}p(le.prototype,{then:Uh,_then:function(d,f){Vh(this,new Jy(null,null,d,f,de))},catch:function(d){if(arguments.length===1)return this.then(null,d);var f=d,g=arguments[1];return typeof f=="function"?this.then(null,function(_){return(_ instanceof f?g:al)(_)}):this.then(null,function(_){return(_&&_.name===f?g:al)(_)})},finally:function(d){return this.then(function(f){return le.resolve(d()).then(function(){return f})},function(f){return le.resolve(d()).then(function(){return al(f)})})},timeout:function(d,f){var g=this;return d<1/0?new le(function(_,x){var T=setTimeout(function(){return x(new fe.Timeout(f))},d);g.then(_,x).finally(clearTimeout.bind(null,T))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&v(le.prototype,Symbol.toStringTag,"Dexie.Promise"),ai.env=ev(),p(le,{all:function(){var d=Ce.apply(null,arguments).map(hl);return new le(function(f,g){d.length===0&&f([]);var _=d.length;d.forEach(function(x,T){return le.resolve(x).then(function(I){d[T]=I,--_||f(d)},g)})})},resolve:function(d){return d instanceof le?d:d&&typeof d.then=="function"?new le(function(f,g){d.then(f,g)}):new le(Qr,!0,d)},reject:al,race:function(){var d=Ce.apply(null,arguments).map(hl);return new le(function(f,g){d.map(function(_){return le.resolve(_).then(f,g)})})},PSD:{get:function(){return de},set:function(d){return de=d}},totalEchoes:{get:function(){return ul}},newPSD:li,usePSD:ji,scheduler:{get:function(){return eo},set:function(d){eo=d}},rejectionMapper:{get:function(){return Hh},set:function(d){Hh=d}},follow:function(d,f){return new le(function(g,_){return li(function(x,T){var I=de;I.unhandleds=[],I.onunhandled=T,I.finalize=Oi(function(){var A,R=this;A=function(){R.unhandleds.length===0?x():T(R.unhandleds[0])},ol.push(function M(){A(),ol.splice(ol.indexOf(M),1)}),++zi,eo(function(){--zi==0&&Kh()},[])},I.finalize),d()},f,g,_)})}}),Zr&&(Zr.allSettled&&v(le,"allSettled",function(){var d=Ce.apply(null,arguments).map(hl);return new le(function(f){d.length===0&&f([]);var g=d.length,_=new Array(g);d.forEach(function(x,T){return le.resolve(x).then(function(I){return _[T]={status:"fulfilled",value:I}},function(I){return _[T]={status:"rejected",reason:I}}).then(function(){return--g||f(_)})})})}),Zr.any&&typeof AggregateError<"u"&&v(le,"any",function(){var d=Ce.apply(null,arguments).map(hl);return new le(function(f,g){d.length===0&&g(new AggregateError([]));var _=d.length,x=new Array(_);d.forEach(function(T,I){return le.resolve(T).then(function(A){return f(A)},function(A){x[I]=A,--_||g(new AggregateError(x))})})})}));var ft={awaits:0,echoes:0,id:0},Yk=0,ll=[],cl=0,ul=0,Xk=0;function li(d,f,g,_){var x=de,T=Object.create(x);return T.parent=x,T.ref=0,T.global=!1,T.id=++Xk,ai.env,T.env=jh?{Promise:le,PromiseProp:{value:le,configurable:!0,writable:!0},all:le.all,race:le.race,allSettled:le.allSettled,any:le.any,resolve:le.resolve,reject:le.reject}:{},f&&l(T,f),++x.ref,T.finalize=function(){--this.parent.ref||this.parent.finalize()},_=ji(T,d,g,_),T.ref===0&&T.finalize(),_}function Ps(){return ft.id||(ft.id=++Yk),++ft.awaits,ft.echoes+=Qy,ft.id}function ci(){return!!ft.awaits&&(--ft.awaits==0&&(ft.id=0),ft.echoes=ft.awaits*Qy,!0)}function hl(d){return ft.echoes&&d&&d.constructor===Zr?(Ps(),d.then(function(f){return ci(),f},function(f){return ci(),Ze(f)})):d}function Qk(){var d=ll[ll.length-1];ll.pop(),ui(d,!1)}function ui(d,f){var g,_=de;(f?!ft.echoes||cl++&&d===de:!cl||--cl&&d===de)||queueMicrotask(f?(function(x){++ul,ft.echoes&&--ft.echoes!=0||(ft.echoes=ft.awaits=ft.id=0),ll.push(de),ui(x,!0)}).bind(null,d):Qk),d!==de&&(de=d,_===ai&&(ai.env=ev()),jh&&(g=ai.env.Promise,f=d.env,(_.global||d.global)&&(Object.defineProperty(r,"Promise",f.PromiseProp),g.all=f.all,g.race=f.race,g.resolve=f.resolve,g.reject=f.reject,f.allSettled&&(g.allSettled=f.allSettled),f.any&&(g.any=f.any))))}function ev(){var d=r.Promise;return jh?{Promise:d,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:d.all,race:d.race,allSettled:d.allSettled,any:d.any,resolve:d.resolve,reject:d.reject}:{}}function ji(d,f,g,_,x){var T=de;try{return ui(d,!0),f(g,_,x)}finally{ui(T,!1)}}function tv(d,f,g,_){return typeof d!="function"?d:function(){var x=de;g&&Ps(),ui(f,!0);try{return d.apply(this,arguments)}finally{ui(x,!1),_&&queueMicrotask(ci)}}}function qh(d){Promise===Zr&&ft.echoes===0?cl===0?d():enqueueNativeMicroTask(d):setTimeout(d,0)}(""+Yt).indexOf("[native code]")===-1&&(Ps=ci=qe);var Ze=le.reject,Bi=String.fromCharCode(65535),Rn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",nv="String expected.",Ls=[],dl="__dbnames",Gh="readonly",Yh="readwrite";function Hi(d,f){return d?f?function(){return d.apply(this,arguments)&&f.apply(this,arguments)}:d:f}var iv={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function fl(d){return typeof d!="string"||/\./.test(d)?function(f){return f}:function(f){return f[d]===void 0&&d in f&&delete(f=ye(f))[d],f}}function sv(){throw fe.Type()}function Fe(d,f){try{var g=rv(d),_=rv(f);if(g!==_)return g==="Array"?1:_==="Array"?-1:g==="binary"?1:_==="binary"?-1:g==="string"?1:_==="string"?-1:g==="Date"?1:_!=="Date"?NaN:-1;switch(g){case"number":case"Date":case"string":return f<d?1:d<f?-1:0;case"binary":return function(x,T){for(var I=x.length,A=T.length,R=I<A?I:A,M=0;M<R;++M)if(x[M]!==T[M])return x[M]<T[M]?-1:1;return I===A?0:I<A?-1:1}(ov(d),ov(f));case"Array":return function(x,T){for(var I=x.length,A=T.length,R=I<A?I:A,M=0;M<R;++M){var z=Fe(x[M],T[M]);if(z!==0)return z}return I===A?0:I<A?-1:1}(d,f)}}catch{}return NaN}function rv(d){var f=typeof d;return f!="object"?f:ArrayBuffer.isView(d)?"binary":(d=Ee(d),d==="ArrayBuffer"?"binary":d)}function ov(d){return d instanceof Uint8Array?d:ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d)}var av=(Ye.prototype._trans=function(d,f,g){var _=this._tx||de.trans,x=this.name,T=vn&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(d==="readonly"?"read":"write"," ").concat(this.name));function I(M,z,E){if(!E.schema[x])throw new fe.NotFound("Table "+x+" not part of transaction");return f(E.idbtrans,E)}var A=Ns();try{var R=_&&_.db._novip===this.db._novip?_===de.trans?_._promise(d,I,g):li(function(){return _._promise(d,I,g)},{trans:_,transless:de.transless||de}):function M(z,E,j,L){if(z.idbdb&&(z._state.openComplete||de.letThrough||z._vip)){var F=z._createTransaction(E,j,z._dbSchema);try{F.create(),z._state.PR1398_maxLoop=3}catch(B){return B.name===oi.InvalidState&&z.isOpen()&&0<--z._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),z.close({disableAutoOpen:!1}),z.open().then(function(){return M(z,E,j,L)})):Ze(B)}return F._promise(E,function(B,O){return li(function(){return de.trans=F,L(B,O,F)})}).then(function(B){if(E==="readwrite")try{F.idbtrans.commit()}catch{}return E==="readonly"?B:F._completion.then(function(){return B})})}if(z._state.openComplete)return Ze(new fe.DatabaseClosed(z._state.dbOpenError));if(!z._state.isBeingOpened){if(!z._state.autoOpen)return Ze(new fe.DatabaseClosed);z.open().catch(qe)}return z._state.dbReadyPromise.then(function(){return M(z,E,j,L)})}(this.db,d,[this.name],I);return T&&(R._consoleTask=T,R=R.catch(function(M){return console.trace(M),Ze(M)})),R}finally{A&&Ms()}},Ye.prototype.get=function(d,f){var g=this;return d&&d.constructor===Object?this.where(d).first(f):d==null?Ze(new fe.Type("Invalid argument to Table.get()")):this._trans("readonly",function(_){return g.core.get({trans:_,key:d}).then(function(x){return g.hook.reading.fire(x)})}).then(f)},Ye.prototype.where=function(d){if(typeof d=="string")return new this.db.WhereClause(this,d);if(a(d))return new this.db.WhereClause(this,"[".concat(d.join("+"),"]"));var f=o(d);if(f.length===1)return this.where(f[0]).equals(d[f[0]]);var g=this.schema.indexes.concat(this.schema.primKey).filter(function(R){if(R.compound&&f.every(function(z){return 0<=R.keyPath.indexOf(z)})){for(var M=0;M<f.length;++M)if(f.indexOf(R.keyPath[M])===-1)return!1;return!0}return!1}).sort(function(R,M){return R.keyPath.length-M.keyPath.length})[0];if(g&&this.db._maxKey!==Bi){var I=g.keyPath.slice(0,f.length);return this.where(I).equals(I.map(function(M){return d[M]}))}!g&&vn&&console.warn("The query ".concat(JSON.stringify(d)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(f.join("+"),"]"));var _=this.schema.idxByName,x=this.db._deps.indexedDB;function T(R,M){return x.cmp(R,M)===0}var A=f.reduce(function(j,M){var z=j[0],E=j[1],j=_[M],L=d[M];return[z||j,z||!j?Hi(E,j&&j.multi?function(F){return F=q(F,M),a(F)&&F.some(function(B){return T(L,B)})}:function(F){return T(L,q(F,M))}):E]},[null,null]),I=A[0],A=A[1];return I?this.where(I.name).equals(d[I.keyPath]).filter(A):g?this.filter(A):this.where(f).equals("")},Ye.prototype.filter=function(d){return this.toCollection().and(d)},Ye.prototype.count=function(d){return this.toCollection().count(d)},Ye.prototype.offset=function(d){return this.toCollection().offset(d)},Ye.prototype.limit=function(d){return this.toCollection().limit(d)},Ye.prototype.each=function(d){return this.toCollection().each(d)},Ye.prototype.toArray=function(d){return this.toCollection().toArray(d)},Ye.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ye.prototype.orderBy=function(d){return new this.db.Collection(new this.db.WhereClause(this,a(d)?"[".concat(d.join("+"),"]"):d))},Ye.prototype.reverse=function(){return this.toCollection().reverse()},Ye.prototype.mapToClass=function(d){var f,g=this.db,_=this.name;function x(){return f!==null&&f.apply(this,arguments)||this}(this.schema.mappedClass=d).prototype instanceof sv&&(function(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function z(){this.constructor=R}t(R,M),R.prototype=M===null?Object.create(M):(z.prototype=M.prototype,new z)}(x,f=d),Object.defineProperty(x.prototype,"db",{get:function(){return g},enumerable:!1,configurable:!0}),x.prototype.table=function(){return _},d=x);for(var T=new Set,I=d.prototype;I;I=c(I))Object.getOwnPropertyNames(I).forEach(function(R){return T.add(R)});function A(R){if(!R)return R;var M,z=Object.create(d.prototype);for(M in R)if(!T.has(M))try{z[M]=R[M]}catch{}return z}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=A,this.hook("reading",A),d},Ye.prototype.defineClass=function(){return this.mapToClass(function(d){l(this,d)})},Ye.prototype.add=function(d,f){var g=this,_=this.schema.primKey,x=_.auto,T=_.keyPath,I=d;return T&&x&&(I=fl(T)(d)),this._trans("readwrite",function(A){return g.core.mutate({trans:A,type:"add",keys:f!=null?[f]:null,values:[I]})}).then(function(A){return A.numFailures?le.reject(A.failures[0]):A.lastResult}).then(function(A){if(T)try{Y(d,T,A)}catch{}return A})},Ye.prototype.update=function(d,f){return typeof d!="object"||a(d)?this.where(":id").equals(d).modify(f):(d=q(d,this.schema.primKey.keyPath),d===void 0?Ze(new fe.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(d).modify(f))},Ye.prototype.put=function(d,f){var g=this,_=this.schema.primKey,x=_.auto,T=_.keyPath,I=d;return T&&x&&(I=fl(T)(d)),this._trans("readwrite",function(A){return g.core.mutate({trans:A,type:"put",values:[I],keys:f!=null?[f]:null})}).then(function(A){return A.numFailures?le.reject(A.failures[0]):A.lastResult}).then(function(A){if(T)try{Y(d,T,A)}catch{}return A})},Ye.prototype.delete=function(d){var f=this;return this._trans("readwrite",function(g){return f.core.mutate({trans:g,type:"delete",keys:[d]})}).then(function(g){return g.numFailures?le.reject(g.failures[0]):void 0})},Ye.prototype.clear=function(){var d=this;return this._trans("readwrite",function(f){return d.core.mutate({trans:f,type:"deleteRange",range:iv})}).then(function(f){return f.numFailures?le.reject(f.failures[0]):void 0})},Ye.prototype.bulkGet=function(d){var f=this;return this._trans("readonly",function(g){return f.core.getMany({keys:d,trans:g}).then(function(_){return _.map(function(x){return f.hook.reading.fire(x)})})})},Ye.prototype.bulkAdd=function(d,f,g){var _=this,x=Array.isArray(f)?f:void 0,T=(g=g||(x?void 0:f))?g.allKeys:void 0;return this._trans("readwrite",function(I){var M=_.schema.primKey,A=M.auto,M=M.keyPath;if(M&&x)throw new fe.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(x&&x.length!==d.length)throw new fe.InvalidArgument("Arguments objects and keys must have the same length");var R=d.length,M=M&&A?d.map(fl(M)):d;return _.core.mutate({trans:I,type:"add",keys:x,values:M,wantResults:T}).then(function(F){var E=F.numFailures,j=F.results,L=F.lastResult,F=F.failures;if(E===0)return T?j:L;throw new At("".concat(_.name,".bulkAdd(): ").concat(E," of ").concat(R," operations failed"),F)})})},Ye.prototype.bulkPut=function(d,f,g){var _=this,x=Array.isArray(f)?f:void 0,T=(g=g||(x?void 0:f))?g.allKeys:void 0;return this._trans("readwrite",function(I){var M=_.schema.primKey,A=M.auto,M=M.keyPath;if(M&&x)throw new fe.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(x&&x.length!==d.length)throw new fe.InvalidArgument("Arguments objects and keys must have the same length");var R=d.length,M=M&&A?d.map(fl(M)):d;return _.core.mutate({trans:I,type:"put",keys:x,values:M,wantResults:T}).then(function(F){var E=F.numFailures,j=F.results,L=F.lastResult,F=F.failures;if(E===0)return T?j:L;throw new At("".concat(_.name,".bulkPut(): ").concat(E," of ").concat(R," operations failed"),F)})})},Ye.prototype.bulkUpdate=function(d){var f=this,g=this.core,_=d.map(function(I){return I.key}),x=d.map(function(I){return I.changes}),T=[];return this._trans("readwrite",function(I){return g.getMany({trans:I,keys:_,cache:"clone"}).then(function(A){var R=[],M=[];d.forEach(function(E,j){var L=E.key,F=E.changes,B=A[j];if(B){for(var O=0,U=Object.keys(F);O<U.length;O++){var W=U[O],K=F[W];if(W===f.schema.primKey.keyPath){if(Fe(K,L)!==0)throw new fe.Constraint("Cannot update primary key in bulkUpdate()")}else Y(B,W,K)}T.push(j),R.push(L),M.push(B)}});var z=R.length;return g.mutate({trans:I,type:"put",keys:R,values:M,updates:{keys:_,changeSpecs:x}}).then(function(E){var j=E.numFailures,L=E.failures;if(j===0)return z;for(var F=0,B=Object.keys(L);F<B.length;F++){var O,U=B[F],W=T[Number(U)];W!=null&&(O=L[U],delete L[U],L[W]=O)}throw new At("".concat(f.name,".bulkUpdate(): ").concat(j," of ").concat(z," operations failed"),L)})})})},Ye.prototype.bulkDelete=function(d){var f=this,g=d.length;return this._trans("readwrite",function(_){return f.core.mutate({trans:_,type:"delete",keys:d})}).then(function(I){var x=I.numFailures,T=I.lastResult,I=I.failures;if(x===0)return T;throw new At("".concat(f.name,".bulkDelete(): ").concat(x," of ").concat(g," operations failed"),I)})},Ye);function Ye(){}function no(d){function f(I,A){if(A){for(var R=arguments.length,M=new Array(R-1);--R;)M[R-1]=arguments[R];return g[I].subscribe.apply(null,M),d}if(typeof I=="string")return g[I]}var g={};f.addEventType=T;for(var _=1,x=arguments.length;_<x;++_)T(arguments[_]);return f;function T(I,A,R){if(typeof I!="object"){var M;A=A||Kk;var z={subscribers:[],fire:R=R||qe,subscribe:function(E){z.subscribers.indexOf(E)===-1&&(z.subscribers.push(E),z.fire=A(z.fire,E))},unsubscribe:function(E){z.subscribers=z.subscribers.filter(function(j){return j!==E}),z.fire=z.subscribers.reduce(A,R)}};return g[I]=f[I]=z}o(M=I).forEach(function(E){var j=M[E];if(a(j))T(E,M[E][0],M[E][1]);else{if(j!=="asap")throw new fe.InvalidArgument("Invalid event config");var L=T(E,Xr,function(){for(var F=arguments.length,B=new Array(F);F--;)B[F]=arguments[F];L.subscribers.forEach(function(O){H(function(){O.apply(null,B)})})})}})}}function io(d,f){return b(f).from({prototype:d}),f}function Rs(d,f){return!(d.filter||d.algorithm||d.or)&&(f?d.justLimit:!d.replayFilter)}function Xh(d,f){d.filter=Hi(d.filter,f)}function Qh(d,f,g){var _=d.replayFilter;d.replayFilter=_?function(){return Hi(_(),f())}:f,d.justLimit=g&&!_}function pl(d,f){if(d.isPrimKey)return f.primaryKey;var g=f.getIndexByKeyPath(d.index);if(!g)throw new fe.Schema("KeyPath "+d.index+" on object store "+f.name+" is not indexed");return g}function lv(d,f,g){var _=pl(d,f.schema);return f.openCursor({trans:g,values:!d.keysOnly,reverse:d.dir==="prev",unique:!!d.unique,query:{index:_,range:d.range}})}function ml(d,f,g,_){var x=d.replayFilter?Hi(d.filter,d.replayFilter()):d.filter;if(d.or){var T={},I=function(A,R,M){var z,E;x&&!x(R,M,function(j){return R.stop(j)},function(j){return R.fail(j)})||((E=""+(z=R.primaryKey))=="[object ArrayBuffer]"&&(E=""+new Uint8Array(z)),u(T,E)||(T[E]=!0,f(A,R,M)))};return Promise.all([d.or._iterate(I,g),cv(lv(d,_,g),d.algorithm,I,!d.keysOnly&&d.valueMapper)])}return cv(lv(d,_,g),Hi(d.algorithm,x),f,!d.keysOnly&&d.valueMapper)}function cv(d,f,g,_){var x=Qe(_?function(T,I,A){return g(_(T),I,A)}:g);return d.then(function(T){if(T)return T.start(function(){var I=function(){return T.continue()};f&&!f(T,function(A){return I=A},function(A){T.stop(A),I=qe},function(A){T.fail(A),I=qe})||x(T.value,T,function(A){return I=A}),I()})})}var On=Symbol(),Jh=(uv.prototype.execute=function(d){var f=(f=this.replacePrefix)===null||f===void 0?void 0:f[0];return f&&typeof d=="string"&&d.startsWith(f)?this.replacePrefix[1]+d.substring(f.length):d},uv);function uv(d){Object.assign(this,d)}var Jk=(Pe.prototype._read=function(d,f){var g=this._ctx;return g.error?g.table._trans(null,Ze.bind(null,g.error)):g.table._trans("readonly",d).then(f)},Pe.prototype._write=function(d){var f=this._ctx;return f.error?f.table._trans(null,Ze.bind(null,f.error)):f.table._trans("readwrite",d,"locked")},Pe.prototype._addAlgorithm=function(d){var f=this._ctx;f.algorithm=Hi(f.algorithm,d)},Pe.prototype._iterate=function(d,f){return ml(this._ctx,d,f,this._ctx.table.core)},Pe.prototype.clone=function(d){var f=Object.create(this.constructor.prototype),g=Object.create(this._ctx);return d&&l(g,d),f._ctx=g,f},Pe.prototype.raw=function(){return this._ctx.valueMapper=null,this},Pe.prototype.each=function(d){var f=this._ctx;return this._read(function(g){return ml(f,d,g,f.table.core)})},Pe.prototype.count=function(d){var f=this;return this._read(function(g){var _=f._ctx,x=_.table.core;if(Rs(_,!0))return x.count({trans:g,query:{index:pl(_,x.schema),range:_.range}}).then(function(I){return Math.min(I,_.limit)});var T=0;return ml(_,function(){return++T,!1},g,x).then(function(){return T})}).then(d)},Pe.prototype.sortBy=function(d,f){var g=d.split(".").reverse(),_=g[0],x=g.length-1;function T(R,M){return M?T(R[g[M]],M-1):R[_]}var I=this._ctx.dir==="next"?1:-1;function A(R,M){return R=T(R,x),M=T(M,x),R<M?-I:M<R?I:0}return this.toArray(function(R){return R.sort(A)}).then(f)},Pe.prototype.toArray=function(d){var f=this;return this._read(function(g){var _=f._ctx;if(_.dir==="next"&&Rs(_,!0)&&0<_.limit){var x=_.valueMapper,T=pl(_,_.table.core.schema);return _.table.core.query({trans:g,limit:_.limit,values:!0,query:{index:T,range:_.range}}).then(function(A){return A=A.result,x?A.map(x):A})}var I=[];return ml(_,function(A){return I.push(A)},g,_.table.core).then(function(){return I})},d)},Pe.prototype.offset=function(d){var f=this._ctx;return d<=0||(f.offset+=d,Rs(f)?Qh(f,function(){var g=d;return function(_,x){return g===0||(g===1?--g:x(function(){_.advance(g),g=0}),!1)}}):Qh(f,function(){var g=d;return function(){return--g<0}})),this},Pe.prototype.limit=function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),Qh(this._ctx,function(){var f=d;return function(g,_,x){return--f<=0&&_(x),0<=f}},!0),this},Pe.prototype.until=function(d,f){return Xh(this._ctx,function(g,_,x){return!d(g.value)||(_(x),f)}),this},Pe.prototype.first=function(d){return this.limit(1).toArray(function(f){return f[0]}).then(d)},Pe.prototype.last=function(d){return this.reverse().first(d)},Pe.prototype.filter=function(d){var f;return Xh(this._ctx,function(g){return d(g.value)}),(f=this._ctx).isMatch=Hi(f.isMatch,d),this},Pe.prototype.and=function(d){return this.filter(d)},Pe.prototype.or=function(d){return new this.db.WhereClause(this._ctx.table,d,this)},Pe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Pe.prototype.desc=function(){return this.reverse()},Pe.prototype.eachKey=function(d){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(g,_){d(_.key,_)})},Pe.prototype.eachUniqueKey=function(d){return this._ctx.unique="unique",this.eachKey(d)},Pe.prototype.eachPrimaryKey=function(d){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(g,_){d(_.primaryKey,_)})},Pe.prototype.keys=function(d){var f=this._ctx;f.keysOnly=!f.isMatch;var g=[];return this.each(function(_,x){g.push(x.key)}).then(function(){return g}).then(d)},Pe.prototype.primaryKeys=function(d){var f=this._ctx;if(f.dir==="next"&&Rs(f,!0)&&0<f.limit)return this._read(function(_){var x=pl(f,f.table.core.schema);return f.table.core.query({trans:_,values:!1,limit:f.limit,query:{index:x,range:f.range}})}).then(function(_){return _.result}).then(d);f.keysOnly=!f.isMatch;var g=[];return this.each(function(_,x){g.push(x.primaryKey)}).then(function(){return g}).then(d)},Pe.prototype.uniqueKeys=function(d){return this._ctx.unique="unique",this.keys(d)},Pe.prototype.firstKey=function(d){return this.limit(1).keys(function(f){return f[0]}).then(d)},Pe.prototype.lastKey=function(d){return this.reverse().firstKey(d)},Pe.prototype.distinct=function(){var d=this._ctx,d=d.index&&d.table.schema.idxByName[d.index];if(!d||!d.multi)return this;var f={};return Xh(this._ctx,function(x){var _=x.primaryKey.toString(),x=u(f,_);return f[_]=!0,!x}),this},Pe.prototype.modify=function(d){var f=this,g=this._ctx;return this._write(function(_){var x,T,I;I=typeof d=="function"?d:(x=o(d),T=x.length,function(O){for(var U=!1,W=0;W<T;++W){var K=x[W],G=d[K],X=q(O,K);G instanceof Jh?(Y(O,K,G.execute(X)),U=!0):X!==G&&(Y(O,K,G),U=!0)}return U});function A(O,K){var W=K.failures,K=K.numFailures;F+=O-K;for(var G=0,X=o(W);G<X.length;G++){var re=X[G];L.push(W[re])}}var R=g.table.core,M=R.schema.primaryKey,z=M.outbound,E=M.extractKey,j=f.db._options.modifyChunkSize||200,L=[],F=0,B=[];return f.clone().primaryKeys().then(function(O){function U(W){var K=Math.min(j,O.length-W);return R.getMany({trans:_,keys:O.slice(W,W+K),cache:"immutable"}).then(function(G){for(var X=[],re=[],te=z?[]:null,ne=[],oe=0;oe<K;++oe){var ae=G[oe],be={value:ye(ae),primKey:O[W+oe]};I.call(be,be.value,be)!==!1&&(be.value==null?ne.push(O[W+oe]):z||Fe(E(ae),E(be.value))===0?(re.push(be.value),z&&te.push(O[W+oe])):(ne.push(O[W+oe]),X.push(be.value)))}var Te=Rs(g)&&g.limit===1/0&&(typeof d!="function"||d===Zh)&&{index:g.index,range:g.range};return Promise.resolve(0<X.length&&R.mutate({trans:_,type:"add",values:X}).then(function(Ae){for(var De in Ae.failures)ne.splice(parseInt(De),1);A(X.length,Ae)})).then(function(){return(0<re.length||Te&&typeof d=="object")&&R.mutate({trans:_,type:"put",keys:te,values:re,criteria:Te,changeSpec:typeof d!="function"&&d}).then(function(Ae){return A(re.length,Ae)})}).then(function(){return(0<ne.length||Te&&d===Zh)&&R.mutate({trans:_,type:"delete",keys:ne,criteria:Te}).then(function(Ae){return A(ne.length,Ae)})}).then(function(){return O.length>W+K&&U(W+j)})})}return U(0).then(function(){if(0<L.length)throw new Ln("Error modifying one or more objects",L,F,B);return O.length})})})},Pe.prototype.delete=function(){var d=this._ctx,f=d.range;return Rs(d)&&(d.isPrimKey||f.type===3)?this._write(function(g){var _=d.table.core.schema.primaryKey,x=f;return d.table.core.count({trans:g,query:{index:_,range:x}}).then(function(T){return d.table.core.mutate({trans:g,type:"deleteRange",range:x}).then(function(I){var A=I.failures;if(I.lastResult,I.results,I=I.numFailures,I)throw new Ln("Could not delete some values",Object.keys(A).map(function(R){return A[R]}),T-I);return T-I})})}):this.modify(Zh)},Pe);function Pe(){}var Zh=function(d,f){return f.value=null};function Zk(d,f){return d<f?-1:d===f?0:1}function eT(d,f){return f<d?-1:d===f?0:1}function Kt(d,f,g){return d=d instanceof dv?new d.Collection(d):d,d._ctx.error=new(g||TypeError)(f),d}function Os(d){return new d.Collection(d,function(){return hv("")}).limit(0)}function gl(d,f,g,_){var x,T,I,A,R,M,z,E=g.length;if(!g.every(function(F){return typeof F=="string"}))return Kt(d,nv);function j(F){x=F==="next"?function(O){return O.toUpperCase()}:function(O){return O.toLowerCase()},T=F==="next"?function(O){return O.toLowerCase()}:function(O){return O.toUpperCase()},I=F==="next"?Zk:eT;var B=g.map(function(O){return{lower:T(O),upper:x(O)}}).sort(function(O,U){return I(O.lower,U.lower)});A=B.map(function(O){return O.upper}),R=B.map(function(O){return O.lower}),z=(M=F)==="next"?"":_}j("next"),d=new d.Collection(d,function(){return hi(A[0],R[E-1]+_)}),d._ondirectionchange=function(F){j(F)};var L=0;return d._addAlgorithm(function(F,B,O){var U=F.key;if(typeof U!="string")return!1;var W=T(U);if(f(W,R,L))return!0;for(var K=null,G=L;G<E;++G){var X=function(re,te,ne,oe,ae,be){for(var Te=Math.min(re.length,oe.length),Ae=-1,De=0;De<Te;++De){var an=te[De];if(an!==oe[De])return ae(re[De],ne[De])<0?re.substr(0,De)+ne[De]+ne.substr(De+1):ae(re[De],oe[De])<0?re.substr(0,De)+oe[De]+ne.substr(De+1):0<=Ae?re.substr(0,Ae)+te[Ae]+ne.substr(Ae+1):null;ae(re[De],an)<0&&(Ae=De)}return Te<oe.length&&be==="next"?re+ne.substr(re.length):Te<re.length&&be==="prev"?re.substr(0,ne.length):Ae<0?null:re.substr(0,Ae)+oe[Ae]+ne.substr(Ae+1)}(U,W,A[G],R[G],I,M);X===null&&K===null?L=G+1:(K===null||0<I(K,X))&&(K=X)}return B(K!==null?function(){F.continue(K+z)}:O),!1}),d}function hi(d,f,g,_){return{type:2,lower:d,upper:f,lowerOpen:g,upperOpen:_}}function hv(d){return{type:1,lower:d,upper:d}}var dv=(Object.defineProperty(pt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),pt.prototype.between=function(d,f,g,_){g=g!==!1,_=_===!0;try{return 0<this._cmp(d,f)||this._cmp(d,f)===0&&(g||_)&&(!g||!_)?Os(this):new this.Collection(this,function(){return hi(d,f,!g,!_)})}catch{return Kt(this,Rn)}},pt.prototype.equals=function(d){return d==null?Kt(this,Rn):new this.Collection(this,function(){return hv(d)})},pt.prototype.above=function(d){return d==null?Kt(this,Rn):new this.Collection(this,function(){return hi(d,void 0,!0)})},pt.prototype.aboveOrEqual=function(d){return d==null?Kt(this,Rn):new this.Collection(this,function(){return hi(d,void 0,!1)})},pt.prototype.below=function(d){return d==null?Kt(this,Rn):new this.Collection(this,function(){return hi(void 0,d,!1,!0)})},pt.prototype.belowOrEqual=function(d){return d==null?Kt(this,Rn):new this.Collection(this,function(){return hi(void 0,d)})},pt.prototype.startsWith=function(d){return typeof d!="string"?Kt(this,nv):this.between(d,d+Bi,!0,!0)},pt.prototype.startsWithIgnoreCase=function(d){return d===""?this.startsWith(d):gl(this,function(f,g){return f.indexOf(g[0])===0},[d],Bi)},pt.prototype.equalsIgnoreCase=function(d){return gl(this,function(f,g){return f===g[0]},[d],"")},pt.prototype.anyOfIgnoreCase=function(){var d=Ce.apply(Se,arguments);return d.length===0?Os(this):gl(this,function(f,g){return g.indexOf(f)!==-1},d,"")},pt.prototype.startsWithAnyOfIgnoreCase=function(){var d=Ce.apply(Se,arguments);return d.length===0?Os(this):gl(this,function(f,g){return g.some(function(_){return f.indexOf(_)===0})},d,Bi)},pt.prototype.anyOf=function(){var d=this,f=Ce.apply(Se,arguments),g=this._cmp;try{f.sort(g)}catch{return Kt(this,Rn)}if(f.length===0)return Os(this);var _=new this.Collection(this,function(){return hi(f[0],f[f.length-1])});_._ondirectionchange=function(T){g=T==="next"?d._ascending:d._descending,f.sort(g)};var x=0;return _._addAlgorithm(function(T,I,A){for(var R=T.key;0<g(R,f[x]);)if(++x===f.length)return I(A),!1;return g(R,f[x])===0||(I(function(){T.continue(f[x])}),!1)}),_},pt.prototype.notEqual=function(d){return this.inAnyRange([[-1/0,d],[d,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},pt.prototype.noneOf=function(){var d=Ce.apply(Se,arguments);if(d.length===0)return new this.Collection(this);try{d.sort(this._ascending)}catch{return Kt(this,Rn)}var f=d.reduce(function(g,_){return g?g.concat([[g[g.length-1][1],_]]):[[-1/0,_]]},null);return f.push([d[d.length-1],this.db._maxKey]),this.inAnyRange(f,{includeLowers:!1,includeUppers:!1})},pt.prototype.inAnyRange=function(U,f){var g=this,_=this._cmp,x=this._ascending,T=this._descending,I=this._min,A=this._max;if(U.length===0)return Os(this);if(!U.every(function(W){return W[0]!==void 0&&W[1]!==void 0&&x(W[0],W[1])<=0}))return Kt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",fe.InvalidArgument);var R=!f||f.includeLowers!==!1,M=f&&f.includeUppers===!0,z,E=x;function j(W,K){return E(W[0],K[0])}try{(z=U.reduce(function(W,K){for(var G=0,X=W.length;G<X;++G){var re=W[G];if(_(K[0],re[1])<0&&0<_(K[1],re[0])){re[0]=I(re[0],K[0]),re[1]=A(re[1],K[1]);break}}return G===X&&W.push(K),W},[])).sort(j)}catch{return Kt(this,Rn)}var L=0,F=M?function(W){return 0<x(W,z[L][1])}:function(W){return 0<=x(W,z[L][1])},B=R?function(W){return 0<T(W,z[L][0])}:function(W){return 0<=T(W,z[L][0])},O=F,U=new this.Collection(this,function(){return hi(z[0][0],z[z.length-1][1],!R,!M)});return U._ondirectionchange=function(W){E=W==="next"?(O=F,x):(O=B,T),z.sort(j)},U._addAlgorithm(function(W,K,G){for(var X,re=W.key;O(re);)if(++L===z.length)return K(G),!1;return!F(X=re)&&!B(X)||(g._cmp(re,z[L][1])===0||g._cmp(re,z[L][0])===0||K(function(){E===x?W.continue(z[L][0]):W.continue(z[L][1])}),!1)}),U},pt.prototype.startsWithAnyOf=function(){var d=Ce.apply(Se,arguments);return d.every(function(f){return typeof f=="string"})?d.length===0?Os(this):this.inAnyRange(d.map(function(f){return[f,f+Bi]})):Kt(this,"startsWithAnyOf() only works with strings")},pt);function pt(){}function _n(d){return Qe(function(f){return so(f),d(f.target.error),!1})}function so(d){d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault()}var ro="storagemutated",ed="x-storagemutated-1",di=no(null,ro),tT=(bn.prototype._lock=function(){return P(!de.global),++this._reculock,this._reculock!==1||de.global||(de.lockOwnerFor=this),this},bn.prototype._unlock=function(){if(P(!de.global),--this._reculock==0)for(de.global||(de.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var d=this._blockedFuncs.shift();try{ji(d[1],d[0])}catch{}}return this},bn.prototype._locked=function(){return this._reculock&&de.lockOwnerFor!==this},bn.prototype.create=function(d){var f=this;if(!this.mode)return this;var g=this.db.idbdb,_=this.db._state.dbOpenError;if(P(!this.idbtrans),!d&&!g)switch(_&&_.name){case"DatabaseClosedError":throw new fe.DatabaseClosed(_);case"MissingAPIError":throw new fe.MissingAPI(_.message,_);default:throw new fe.OpenFailed(_)}if(!this.active)throw new fe.TransactionInactive;return P(this._completion._state===null),(d=this.idbtrans=d||(this.db.core||g).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Qe(function(x){so(x),f._reject(d.error)}),d.onabort=Qe(function(x){so(x),f.active&&f._reject(new fe.Abort(d.error)),f.active=!1,f.on("abort").fire(x)}),d.oncomplete=Qe(function(){f.active=!1,f._resolve(),"mutatedParts"in d&&di.storagemutated.fire(d.mutatedParts)}),this},bn.prototype._promise=function(d,f,g){var _=this;if(d==="readwrite"&&this.mode!=="readwrite")return Ze(new fe.ReadOnly("Transaction is readonly"));if(!this.active)return Ze(new fe.TransactionInactive);if(this._locked())return new le(function(T,I){_._blockedFuncs.push([function(){_._promise(d,f,g).then(T,I)},de])});if(g)return li(function(){var T=new le(function(I,A){_._lock();var R=f(I,A,_);R&&R.then&&R.then(I,A)});return T.finally(function(){return _._unlock()}),T._lib=!0,T});var x=new le(function(T,I){var A=f(T,I,_);A&&A.then&&A.then(T,I)});return x._lib=!0,x},bn.prototype._root=function(){return this.parent?this.parent._root():this},bn.prototype.waitFor=function(d){var f,g=this._root(),_=le.resolve(d);g._waitingFor?g._waitingFor=g._waitingFor.then(function(){return _}):(g._waitingFor=_,g._waitingQueue=[],f=g.idbtrans.objectStore(g.storeNames[0]),function T(){for(++g._spinCount;g._waitingQueue.length;)g._waitingQueue.shift()();g._waitingFor&&(f.get(-1/0).onsuccess=T)}());var x=g._waitingFor;return new le(function(T,I){_.then(function(A){return g._waitingQueue.push(Qe(T.bind(null,A)))},function(A){return g._waitingQueue.push(Qe(I.bind(null,A)))}).finally(function(){g._waitingFor===x&&(g._waitingFor=null)})})},bn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new fe.Abort))},bn.prototype.table=function(d){var f=this._memoizedTables||(this._memoizedTables={});if(u(f,d))return f[d];var g=this.schema[d];if(!g)throw new fe.NotFound("Table "+d+" not part of transaction");return g=new this.db.Table(d,g,this),g.core=this.db.core.table(d),f[d]=g},bn);function bn(){}function td(d,f,g,_,x,T,I){return{name:d,keyPath:f,unique:g,multi:_,auto:x,compound:T,src:(g&&!I?"&":"")+(_?"*":"")+(x?"++":"")+fv(f)}}function fv(d){return typeof d=="string"?d:d?"["+[].join.call(d,"+")+"]":""}function nd(d,f,g){return{name:d,primKey:f,indexes:g,mappedClass:null,idxByName:(_=function(x){return[x.name,x]},g.reduce(function(x,T,I){return I=_(T,I),I&&(x[I[0]]=I[1]),x},{}))};var _}var oo=function(d){try{return d.only([[]]),oo=function(){return[[]]},[[]]}catch{return oo=function(){return Bi},Bi}};function id(d){return d==null?function(){}:typeof d=="string"?(f=d).split(".").length===1?function(g){return g[f]}:function(g){return q(g,f)}:function(g){return q(g,d)};var f}function pv(d){return[].slice.call(d)}var nT=0;function ao(d){return d==null?":id":typeof d=="string"?d:"[".concat(d.join("+"),"]")}function iT(d,f,R){function _(O){if(O.type===3)return null;if(O.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var L=O.lower,F=O.upper,B=O.lowerOpen,O=O.upperOpen;return L===void 0?F===void 0?null:f.upperBound(F,!!O):F===void 0?f.lowerBound(L,!!B):f.bound(L,F,!!B,!!O)}function x(j){var L,F=j.name;return{name:F,schema:j,mutate:function(B){var O=B.trans,U=B.type,W=B.keys,K=B.values,G=B.range;return new Promise(function(X,re){X=Qe(X);var te=O.objectStore(F),ne=te.keyPath==null,oe=U==="put"||U==="add";if(!oe&&U!=="delete"&&U!=="deleteRange")throw new Error("Invalid operation type: "+U);var ae,be=(W||K||{length:1}).length;if(W&&K&&W.length!==K.length)throw new Error("Given keys array must have same length as given values array.");if(be===0)return X({numFailures:0,failures:{},results:[],lastResult:void 0});function Te(Et){++an,so(Et)}var Ae=[],De=[],an=0;if(U==="deleteRange"){if(G.type===4)return X({numFailures:an,failures:De,results:[],lastResult:void 0});G.type===3?Ae.push(ae=te.clear()):Ae.push(ae=te.delete(_(G)))}else{var ne=oe?ne?[K,W]:[K,null]:[W,null],Ie=ne[0],xt=ne[1];if(oe)for(var St=0;St<be;++St)Ae.push(ae=xt&&xt[St]!==void 0?te[U](Ie[St],xt[St]):te[U](Ie[St])),ae.onerror=Te;else for(St=0;St<be;++St)Ae.push(ae=te[U](Ie[St])),ae.onerror=Te}function $l(Et){Et=Et.target.result,Ae.forEach(function(Vi,Cd){return Vi.error!=null&&(De[Cd]=Vi.error)}),X({numFailures:an,failures:De,results:U==="delete"?W:Ae.map(function(Vi){return Vi.result}),lastResult:Et})}ae.onerror=function(Et){Te(Et),$l(Et)},ae.onsuccess=$l})},getMany:function(B){var O=B.trans,U=B.keys;return new Promise(function(W,K){W=Qe(W);for(var G,X=O.objectStore(F),re=U.length,te=new Array(re),ne=0,oe=0,ae=function(Ae){Ae=Ae.target,te[Ae._pos]=Ae.result,++oe===ne&&W(te)},be=_n(K),Te=0;Te<re;++Te)U[Te]!=null&&((G=X.get(U[Te]))._pos=Te,G.onsuccess=ae,G.onerror=be,++ne);ne===0&&W(te)})},get:function(B){var O=B.trans,U=B.key;return new Promise(function(W,K){W=Qe(W);var G=O.objectStore(F).get(U);G.onsuccess=function(X){return W(X.target.result)},G.onerror=_n(K)})},query:(L=M,function(B){return new Promise(function(O,U){O=Qe(O);var W,K,G,ne=B.trans,X=B.values,re=B.limit,ae=B.query,te=re===1/0?void 0:re,oe=ae.index,ae=ae.range,ne=ne.objectStore(F),oe=oe.isPrimaryKey?ne:ne.index(oe.name),ae=_(ae);if(re===0)return O({result:[]});L?((te=X?oe.getAll(ae,te):oe.getAllKeys(ae,te)).onsuccess=function(be){return O({result:be.target.result})},te.onerror=_n(U)):(W=0,K=!X&&"openKeyCursor"in oe?oe.openKeyCursor(ae):oe.openCursor(ae),G=[],K.onsuccess=function(be){var Te=K.result;return Te?(G.push(X?Te.value:Te.primaryKey),++W===re?O({result:G}):void Te.continue()):O({result:G})},K.onerror=_n(U))})}),openCursor:function(B){var O=B.trans,U=B.values,W=B.query,K=B.reverse,G=B.unique;return new Promise(function(X,re){X=Qe(X);var oe=W.index,te=W.range,ne=O.objectStore(F),ne=oe.isPrimaryKey?ne:ne.index(oe.name),oe=K?G?"prevunique":"prev":G?"nextunique":"next",ae=!U&&"openKeyCursor"in ne?ne.openKeyCursor(_(te),oe):ne.openCursor(_(te),oe);ae.onerror=_n(re),ae.onsuccess=Qe(function(be){var Te,Ae,De,an,Ie=ae.result;Ie?(Ie.___id=++nT,Ie.done=!1,Te=Ie.continue.bind(Ie),Ae=(Ae=Ie.continuePrimaryKey)&&Ae.bind(Ie),De=Ie.advance.bind(Ie),an=function(){throw new Error("Cursor not stopped")},Ie.trans=O,Ie.stop=Ie.continue=Ie.continuePrimaryKey=Ie.advance=function(){throw new Error("Cursor not started")},Ie.fail=Qe(re),Ie.next=function(){var xt=this,St=1;return this.start(function(){return St--?xt.continue():xt.stop()}).then(function(){return xt})},Ie.start=function(xt){function St(){if(ae.result)try{xt()}catch(Et){Ie.fail(Et)}else Ie.done=!0,Ie.start=function(){throw new Error("Cursor behind last entry")},Ie.stop()}var $l=new Promise(function(Et,Vi){Et=Qe(Et),ae.onerror=_n(Vi),Ie.fail=Vi,Ie.stop=function(Cd){Ie.stop=Ie.continue=Ie.continuePrimaryKey=Ie.advance=an,Et(Cd)}});return ae.onsuccess=Qe(function(Et){ae.onsuccess=St,St()}),Ie.continue=Te,Ie.continuePrimaryKey=Ae,Ie.advance=De,St(),$l},X(Ie)):X(null)},re)})},count:function(B){var O=B.query,U=B.trans,W=O.index,K=O.range;return new Promise(function(G,X){var re=U.objectStore(F),te=W.isPrimaryKey?re:re.index(W.name),re=_(K),te=re?te.count(re):te.count();te.onsuccess=Qe(function(ne){return G(ne.target.result)}),te.onerror=_n(X)})}}}var T,I,A,z=(I=R,A=pv((T=d).objectStoreNames),{schema:{name:T.name,tables:A.map(function(j){return I.objectStore(j)}).map(function(j){var L=j.keyPath,O=j.autoIncrement,F=a(L),B={},O={name:j.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:L==null,compound:F,keyPath:L,autoIncrement:O,unique:!0,extractKey:id(L)},indexes:pv(j.indexNames).map(function(U){return j.index(U)}).map(function(G){var W=G.name,K=G.unique,X=G.multiEntry,G=G.keyPath,X={name:W,compound:a(G),keyPath:G,unique:K,multiEntry:X,extractKey:id(G)};return B[ao(G)]=X}),getIndexByKeyPath:function(U){return B[ao(U)]}};return B[":id"]=O.primaryKey,L!=null&&(B[ao(L)]=O.primaryKey),O})},hasGetAll:0<A.length&&"getAll"in I.objectStore(A[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),R=z.schema,M=z.hasGetAll,z=R.tables.map(x),E={};return z.forEach(function(j){return E[j.name]=j}),{stack:"dbcore",transaction:d.transaction.bind(d),table:function(j){if(!E[j])throw new Error("Table '".concat(j,"' not found"));return E[j]},MIN_KEY:-1/0,MAX_KEY:oo(f),schema:R}}function sT(d,f,g,_){var x=g.IDBKeyRange;return g.indexedDB,{dbcore:(_=iT(f,x,_),d.dbcore.reduce(function(T,I){return I=I.create,i(i({},T),I(T))},_))}}function yl(d,_){var g=_.db,_=sT(d._middlewares,g,d._deps,_);d.core=_.dbcore,d.tables.forEach(function(x){var T=x.name;d.core.schema.tables.some(function(I){return I.name===T})&&(x.core=d.core.table(T),d[T]instanceof d.Table&&(d[T].core=x.core))})}function vl(d,f,g,_){g.forEach(function(x){var T=_[x];f.forEach(function(I){var A=function R(M,z){return C(M,z)||(M=c(M))&&R(M,z)}(I,x);(!A||"value"in A&&A.value===void 0)&&(I===d.Transaction.prototype||I instanceof d.Transaction?v(I,x,{get:function(){return this.table(x)},set:function(R){m(this,x,{value:R,writable:!0,configurable:!0,enumerable:!0})}}):I[x]=new d.Table(x,T))})})}function sd(d,f){f.forEach(function(g){for(var _ in g)g[_]instanceof d.Table&&delete g[_]})}function rT(d,f){return d._cfg.version-f._cfg.version}function oT(d,f,g,_){var x=d._dbSchema;g.objectStoreNames.contains("$meta")&&!x.$meta&&(x.$meta=nd("$meta",gv("")[0],[]),d._storeNames.push("$meta"));var T=d._createTransaction("readwrite",d._storeNames,x);T.create(g),T._completion.catch(_);var I=T._reject.bind(T),A=de.transless||de;li(function(){return de.trans=T,de.transless=A,f!==0?(yl(d,g),M=f,((R=T).storeNames.includes("$meta")?R.table("$meta").get("version").then(function(z){return z??M}):le.resolve(M)).then(function(z){return j=z,L=T,F=g,B=[],z=(E=d)._versions,O=E._dbSchema=bl(0,E.idbdb,F),(z=z.filter(function(U){return U._cfg.version>=j})).length!==0?(z.forEach(function(U){B.push(function(){var W=O,K=U._cfg.dbschema;wl(E,W,F),wl(E,K,F),O=E._dbSchema=K;var G=rd(W,K);G.add.forEach(function(oe){od(F,oe[0],oe[1].primKey,oe[1].indexes)}),G.change.forEach(function(oe){if(oe.recreate)throw new fe.Upgrade("Not yet support for changing primary key");var ae=F.objectStore(oe.name);oe.add.forEach(function(be){return _l(ae,be)}),oe.change.forEach(function(be){ae.deleteIndex(be.name),_l(ae,be)}),oe.del.forEach(function(be){return ae.deleteIndex(be)})});var X=U._cfg.contentUpgrade;if(X&&U._cfg.version>j){yl(E,F),L._memoizedTables={};var re=Q(K);G.del.forEach(function(oe){re[oe]=W[oe]}),sd(E,[E.Transaction.prototype]),vl(E,[E.Transaction.prototype],o(re),re),L.schema=re;var te,ne=Me(X);return ne&&Ps(),G=le.follow(function(){var oe;(te=X(L))&&ne&&(oe=ci.bind(null,null),te.then(oe,oe))}),te&&typeof te.then=="function"?le.resolve(te):G.then(function(){return te})}}),B.push(function(W){var K,G,X=U._cfg.dbschema;K=X,G=W,[].slice.call(G.db.objectStoreNames).forEach(function(re){return K[re]==null&&G.db.deleteObjectStore(re)}),sd(E,[E.Transaction.prototype]),vl(E,[E.Transaction.prototype],E._storeNames,E._dbSchema),L.schema=E._dbSchema}),B.push(function(W){E.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(E.idbdb.version/10)===U._cfg.version?(E.idbdb.deleteObjectStore("$meta"),delete E._dbSchema.$meta,E._storeNames=E._storeNames.filter(function(K){return K!=="$meta"})):W.objectStore("$meta").put(U._cfg.version,"version"))})}),function U(){return B.length?le.resolve(B.shift()(L.idbtrans)).then(U):le.resolve()}().then(function(){mv(O,F)})):le.resolve();var E,j,L,F,B,O}).catch(I)):(o(x).forEach(function(z){od(g,z,x[z].primKey,x[z].indexes)}),yl(d,g),void le.follow(function(){return d.on.populate.fire(T)}).catch(I));var R,M})}function aT(d,f){mv(d._dbSchema,f),f.db.version%10!=0||f.objectStoreNames.contains("$meta")||f.db.createObjectStore("$meta").add(Math.ceil(f.db.version/10-1),"version");var g=bl(0,d.idbdb,f);wl(d,d._dbSchema,f);for(var _=0,x=rd(g,d._dbSchema).change;_<x.length;_++){var T=function(I){if(I.change.length||I.recreate)return console.warn("Unable to patch indexes of table ".concat(I.name," because it has changes on the type of index or primary key.")),{value:void 0};var A=f.objectStore(I.name);I.add.forEach(function(R){vn&&console.debug("Dexie upgrade patch: Creating missing index ".concat(I.name,".").concat(R.src)),_l(A,R)})}(x[_]);if(typeof T=="object")return T.value}}function rd(d,f){var g,_={del:[],add:[],change:[]};for(g in d)f[g]||_.del.push(g);for(g in f){var x=d[g],T=f[g];if(x){var I={name:g,def:T,recreate:!1,del:[],add:[],change:[]};if(""+(x.primKey.keyPath||"")!=""+(T.primKey.keyPath||"")||x.primKey.auto!==T.primKey.auto)I.recreate=!0,_.change.push(I);else{var A=x.idxByName,R=T.idxByName,M=void 0;for(M in A)R[M]||I.del.push(M);for(M in R){var z=A[M],E=R[M];z?z.src!==E.src&&I.change.push(E):I.add.push(E)}(0<I.del.length||0<I.add.length||0<I.change.length)&&_.change.push(I)}}else _.add.push([g,T])}return _}function od(d,f,g,_){var x=d.db.createObjectStore(f,g.keyPath?{keyPath:g.keyPath,autoIncrement:g.auto}:{autoIncrement:g.auto});return _.forEach(function(T){return _l(x,T)}),x}function mv(d,f){o(d).forEach(function(g){f.db.objectStoreNames.contains(g)||(vn&&console.debug("Dexie: Creating missing table",g),od(f,g,d[g].primKey,d[g].indexes))})}function _l(d,f){d.createIndex(f.name,f.keyPath,{unique:f.unique,multiEntry:f.multi})}function bl(d,f,g){var _={};return D(f.objectStoreNames,0).forEach(function(x){for(var T=g.objectStore(x),I=td(fv(M=T.keyPath),M||"",!0,!1,!!T.autoIncrement,M&&typeof M!="string",!0),A=[],R=0;R<T.indexNames.length;++R){var z=T.index(T.indexNames[R]),M=z.keyPath,z=td(z.name,M,!!z.unique,!!z.multiEntry,!1,M&&typeof M!="string",!1);A.push(z)}_[x]=nd(x,I,A)}),_}function wl(d,f,g){for(var _=g.db.objectStoreNames,x=0;x<_.length;++x){var T=_[x],I=g.objectStore(T);d._hasGetAll="getAll"in I;for(var A=0;A<I.indexNames.length;++A){var R=I.indexNames[A],M=I.index(R).keyPath,z=typeof M=="string"?M:"["+D(M).join("+")+"]";!f[T]||(M=f[T].idxByName[z])&&(M.name=R,delete f[T].idxByName[z],f[T].idxByName[R]=M)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(d._hasGetAll=!1)}function gv(d){return d.split(",").map(function(f,g){var _=(f=f.trim()).replace(/([&*]|\+\+)/g,""),x=/^\[/.test(_)?_.match(/^\[(.*)\]$/)[1].split("+"):_;return td(_,x||null,/\&/.test(f),/\*/.test(f),/\+\+/.test(f),a(x),g===0)})}var lT=(Cl.prototype._parseStoresSpec=function(d,f){o(d).forEach(function(g){if(d[g]!==null){var _=gv(d[g]),x=_.shift();if(x.unique=!0,x.multi)throw new fe.Schema("Primary key cannot be multi-valued");_.forEach(function(T){if(T.auto)throw new fe.Schema("Only primary key can be marked as autoIncrement (++)");if(!T.keyPath)throw new fe.Schema("Index must have a name and cannot be an empty string")}),f[g]=nd(g,x,_)}})},Cl.prototype.stores=function(g){var f=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,g):g;var g=f._versions,_={},x={};return g.forEach(function(T){l(_,T._cfg.storesSource),x=T._cfg.dbschema={},T._parseStoresSpec(_,x)}),f._dbSchema=x,sd(f,[f._allTables,f,f.Transaction.prototype]),vl(f,[f._allTables,f,f.Transaction.prototype,this._cfg.tables],o(x),x),f._storeNames=o(x),this},Cl.prototype.upgrade=function(d){return this._cfg.contentUpgrade=zh(this._cfg.contentUpgrade||qe,d),this},Cl);function Cl(){}function ad(d,f){var g=d._dbNamesDB;return g||(g=d._dbNamesDB=new Fn(dl,{addons:[],indexedDB:d,IDBKeyRange:f})).version(1).stores({dbnames:"name"}),g.table("dbnames")}function ld(d){return d&&typeof d.databases=="function"}function cd(d){return li(function(){return de.letThrough=!0,d()})}function ud(d){return!("from"in d)}var Ct=function(d,f){if(!this){var g=new Ct;return d&&"d"in d&&l(g,d),g}l(this,arguments.length?{d:1,from:d,to:1<arguments.length?f:d}:{d:0})};function lo(d,f,g){var _=Fe(f,g);if(!isNaN(_)){if(0<_)throw RangeError();if(ud(d))return l(d,{from:f,to:g,d:1});var x=d.l,_=d.r;if(Fe(g,d.from)<0)return x?lo(x,f,g):d.l={from:f,to:g,d:1,l:null,r:null},yv(d);if(0<Fe(f,d.to))return _?lo(_,f,g):d.r={from:f,to:g,d:1,l:null,r:null},yv(d);Fe(f,d.from)<0&&(d.from=f,d.l=null,d.d=_?_.d+1:1),0<Fe(g,d.to)&&(d.to=g,d.r=null,d.d=d.l?d.l.d+1:1),g=!d.r,x&&!d.l&&co(d,x),_&&g&&co(d,_)}}function co(d,f){ud(f)||function g(_,R){var T=R.from,I=R.to,A=R.l,R=R.r;lo(_,T,I),A&&g(_,A),R&&g(_,R)}(d,f)}function xl(d,f){var g=hd(f),_=g.next();if(_.done)return!1;for(var x=_.value,T=hd(d),I=T.next(x.from),A=I.value;!_.done&&!I.done;){if(Fe(A.from,x.to)<=0&&0<=Fe(A.to,x.from))return!0;Fe(x.from,A.from)<0?x=(_=g.next(A.from)).value:A=(I=T.next(x.from)).value}return!1}function hd(d){var f=ud(d)?null:{s:0,n:d};return{next:function(g){for(var _=0<arguments.length;f;)switch(f.s){case 0:if(f.s=1,_)for(;f.n.l&&Fe(g,f.n.from)<0;)f={up:f,n:f.n.l,s:1};else for(;f.n.l;)f={up:f,n:f.n.l,s:1};case 1:if(f.s=2,!_||Fe(g,f.n.to)<=0)return{value:f.n,done:!1};case 2:if(f.n.r){f.s=3,f={up:f,n:f.n.r,s:0};continue}case 3:f=f.up}return{done:!0}}}}function yv(d){var f,g,_=(((f=d.r)===null||f===void 0?void 0:f.d)||0)-(((g=d.l)===null||g===void 0?void 0:g.d)||0),x=1<_?"r":_<-1?"l":"";x&&(f=x=="r"?"l":"r",g=i({},d),_=d[x],d.from=_.from,d.to=_.to,d[x]=_[x],g[x]=_[f],(d[f]=g).d=vv(g)),d.d=vv(d)}function vv(g){var f=g.r,g=g.l;return(f?g?Math.max(f.d,g.d):f.d:g?g.d:0)+1}function Sl(d,f){return o(f).forEach(function(g){d[g]?co(d[g],f[g]):d[g]=function _(x){var T,I,A={};for(T in x)u(x,T)&&(I=x[T],A[T]=!I||typeof I!="object"||J.has(I.constructor)?I:_(I));return A}(f[g])}),d}function dd(d,f){return d.all||f.all||Object.keys(d).some(function(g){return f[g]&&xl(f[g],d[g])})}p(Ct.prototype,((Yt={add:function(d){return co(this,d),this},addKey:function(d){return lo(this,d,d),this},addKeys:function(d){var f=this;return d.forEach(function(g){return lo(f,g,g)}),this}})[Oe]=function(){return hd(this)},Yt));var Ui={},fd={},pd=!1;function kl(d){Sl(fd,d),pd||(pd=!0,setTimeout(function(){pd=!1,md(fd,!(fd={}))},0))}function md(d,f){f===void 0&&(f=!1);var g=new Set;if(d.all)for(var _=0,x=Object.values(Ui);_<x.length;_++)_v(I=x[_],d,g,f);else for(var T in d){var I,A=/^idb\:\/\/(.*)\/(.*)\//.exec(T);A&&(T=A[1],A=A[2],(I=Ui["idb://".concat(T,"/").concat(A)])&&_v(I,d,g,f))}g.forEach(function(R){return R()})}function _v(d,f,g,_){for(var x=[],T=0,I=Object.entries(d.queries.query);T<I.length;T++){for(var A=I[T],R=A[0],M=[],z=0,E=A[1];z<E.length;z++){var j=E[z];dd(f,j.obsSet)?j.subscribers.forEach(function(O){return g.add(O)}):_&&M.push(j)}_&&x.push([R,M])}if(_)for(var L=0,F=x;L<F.length;L++){var B=F[L],R=B[0],M=B[1];d.queries.query[R]=M}}function cT(d){var f=d._state,g=d._deps.indexedDB;if(f.isBeingOpened||d.idbdb)return f.dbReadyPromise.then(function(){return f.dbOpenError?Ze(f.dbOpenError):d});f.isBeingOpened=!0,f.dbOpenError=null,f.openComplete=!1;var _=f.openCanceller,x=Math.round(10*d.verno),T=!1;function I(){if(f.openCanceller!==_)throw new fe.DatabaseClosed("db.open() was cancelled")}function A(){return new le(function(j,L){if(I(),!g)throw new fe.MissingAPI;var F=d.name,B=f.autoSchema||!x?g.open(F):g.open(F,x);if(!B)throw new fe.MissingAPI;B.onerror=_n(L),B.onblocked=Qe(d._fireOnBlocked),B.onupgradeneeded=Qe(function(O){var U;z=B.transaction,f.autoSchema&&!d._options.allowEmptyDB?(B.onerror=so,z.abort(),B.result.close(),(U=g.deleteDatabase(F)).onsuccess=U.onerror=Qe(function(){L(new fe.NoSuchDatabase("Database ".concat(F," doesnt exist")))})):(z.onerror=_n(L),O=O.oldVersion>Math.pow(2,62)?0:O.oldVersion,E=O<1,d.idbdb=B.result,T&&aT(d,z),oT(d,O/10,z,L))},L),B.onsuccess=Qe(function(){z=null;var O,U,W,K,G,X=d.idbdb=B.result,re=D(X.objectStoreNames);if(0<re.length)try{var te=X.transaction((K=re).length===1?K[0]:K,"readonly");if(f.autoSchema)U=X,W=te,(O=d).verno=U.version/10,W=O._dbSchema=bl(0,U,W),O._storeNames=D(U.objectStoreNames,0),vl(O,[O._allTables],o(W),W);else if(wl(d,d._dbSchema,te),((G=rd(bl(0,(G=d).idbdb,te),G._dbSchema)).add.length||G.change.some(function(ne){return ne.add.length||ne.change.length}))&&!T)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),X.close(),x=X.version+1,T=!0,j(A());yl(d,te)}catch{}Ls.push(d),X.onversionchange=Qe(function(ne){f.vcFired=!0,d.on("versionchange").fire(ne)}),X.onclose=Qe(function(ne){d.on("close").fire(ne)}),E&&(G=d._deps,te=F,X=G.indexedDB,G=G.IDBKeyRange,ld(X)||te===dl||ad(X,G).put({name:te}).catch(qe)),j()},L)}).catch(function(j){switch(j==null?void 0:j.name){case"UnknownError":if(0<f.PR1398_maxLoop)return f.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),A();break;case"VersionError":if(0<x)return x=0,A()}return le.reject(j)})}var R,M=f.dbReadyResolve,z=null,E=!1;return le.race([_,(typeof navigator>"u"?le.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(j){function L(){return indexedDB.databases().finally(j)}R=setInterval(L,100),L()}).finally(function(){return clearInterval(R)}):Promise.resolve()).then(A)]).then(function(){return I(),f.onReadyBeingFired=[],le.resolve(cd(function(){return d.on.ready.fire(d.vip)})).then(function j(){if(0<f.onReadyBeingFired.length){var L=f.onReadyBeingFired.reduce(zh,qe);return f.onReadyBeingFired=[],le.resolve(cd(function(){return L(d.vip)})).then(j)}})}).finally(function(){f.openCanceller===_&&(f.onReadyBeingFired=null,f.isBeingOpened=!1)}).catch(function(j){f.dbOpenError=j;try{z&&z.abort()}catch{}return _===f.openCanceller&&d._close(),Ze(j)}).finally(function(){f.openComplete=!0,M()}).then(function(){var j;return E&&(j={},d.tables.forEach(function(L){L.schema.indexes.forEach(function(F){F.name&&(j["idb://".concat(d.name,"/").concat(L.name,"/").concat(F.name)]=new Ct(-1/0,[[[]]]))}),j["idb://".concat(d.name,"/").concat(L.name,"/")]=j["idb://".concat(d.name,"/").concat(L.name,"/:dels")]=new Ct(-1/0,[[[]]])}),di(ro).fire(j),md(j,!0)),d})}function gd(d){function f(T){return d.next(T)}var g=x(f),_=x(function(T){return d.throw(T)});function x(T){return function(R){var A=T(R),R=A.value;return A.done?R:R&&typeof R.then=="function"?R.then(g,_):a(R)?Promise.all(R).then(g,_):g(R)}}return x(f)()}function Tl(d,f,g){for(var _=a(d)?d.slice():[d],x=0;x<g;++x)_.push(f);return _}var uT={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(d){return i(i({},d),{table:function(f){var g=d.table(f),_=g.schema,x={},T=[];function I(E,j,L){var F=ao(E),B=x[F]=x[F]||[],O=E==null?0:typeof E=="string"?1:E.length,U=0<j,U=i(i({},L),{name:U?"".concat(F,"(virtual-from:").concat(L.name,")"):L.name,lowLevelIndex:L,isVirtual:U,keyTail:j,keyLength:O,extractKey:id(E),unique:!U&&L.unique});return B.push(U),U.isPrimaryKey||T.push(U),1<O&&I(O===2?E[0]:E.slice(0,O-1),j+1,L),B.sort(function(W,K){return W.keyTail-K.keyTail}),U}f=I(_.primaryKey.keyPath,0,_.primaryKey),x[":id"]=[f];for(var A=0,R=_.indexes;A<R.length;A++){var M=R[A];I(M.keyPath,0,M)}function z(E){var j,L=E.query.index;return L.isVirtual?i(i({},E),{query:{index:L.lowLevelIndex,range:(j=E.query.range,L=L.keyTail,{type:j.type===1?2:j.type,lower:Tl(j.lower,j.lowerOpen?d.MAX_KEY:d.MIN_KEY,L),lowerOpen:!0,upper:Tl(j.upper,j.upperOpen?d.MIN_KEY:d.MAX_KEY,L),upperOpen:!0})}}):E}return i(i({},g),{schema:i(i({},_),{primaryKey:f,indexes:T,getIndexByKeyPath:function(E){return(E=x[ao(E)])&&E[0]}}),count:function(E){return g.count(z(E))},query:function(E){return g.query(z(E))},openCursor:function(E){var j=E.query.index,L=j.keyTail,F=j.isVirtual,B=j.keyLength;return F?g.openCursor(z(E)).then(function(U){return U&&O(U)}):g.openCursor(E);function O(U){return Object.create(U,{continue:{value:function(W){W!=null?U.continue(Tl(W,E.reverse?d.MAX_KEY:d.MIN_KEY,L)):E.unique?U.continue(U.key.slice(0,B).concat(E.reverse?d.MIN_KEY:d.MAX_KEY,L)):U.continue()}},continuePrimaryKey:{value:function(W,K){U.continuePrimaryKey(Tl(W,d.MAX_KEY,L),K)}},primaryKey:{get:function(){return U.primaryKey}},key:{get:function(){var W=U.key;return B===1?W[0]:W.slice(0,B)}},value:{get:function(){return U.value}}})}}})}})}};function yd(d,f,g,_){return g=g||{},_=_||"",o(d).forEach(function(x){var T,I,A;u(f,x)?(T=d[x],I=f[x],typeof T=="object"&&typeof I=="object"&&T&&I?(A=Ee(T))!==Ee(I)?g[_+x]=f[x]:A==="Object"?yd(T,I,g,_+x+"."):T!==I&&(g[_+x]=f[x]):T!==I&&(g[_+x]=f[x])):g[_+x]=void 0}),o(f).forEach(function(x){u(d,x)||(g[_+x]=f[x])}),g}function vd(d,f){return f.type==="delete"?f.keys:f.keys||f.values.map(d.extractKey)}var hT={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(d){return i(i({},d),{table:function(f){var g=d.table(f),_=g.schema.primaryKey;return i(i({},g),{mutate:function(x){var T=de.trans,I=T.table(f).hook,A=I.deleting,R=I.creating,M=I.updating;switch(x.type){case"add":if(R.fire===qe)break;return T._promise("readwrite",function(){return z(x)},!0);case"put":if(R.fire===qe&&M.fire===qe)break;return T._promise("readwrite",function(){return z(x)},!0);case"delete":if(A.fire===qe)break;return T._promise("readwrite",function(){return z(x)},!0);case"deleteRange":if(A.fire===qe)break;return T._promise("readwrite",function(){return function E(j,L,F){return g.query({trans:j,values:!1,query:{index:_,range:L},limit:F}).then(function(B){var O=B.result;return z({type:"delete",keys:O,trans:j}).then(function(U){return 0<U.numFailures?Promise.reject(U.failures[0]):O.length<F?{failures:[],numFailures:0,lastResult:void 0}:E(j,i(i({},L),{lower:O[O.length-1],lowerOpen:!0}),F)})})}(x.trans,x.range,1e4)},!0)}return g.mutate(x);function z(E){var j,L,F,B=de.trans,O=E.keys||vd(_,E);if(!O)throw new Error("Keys missing");return(E=E.type==="add"||E.type==="put"?i(i({},E),{keys:O}):i({},E)).type!=="delete"&&(E.values=s([],E.values,!0)),E.keys&&(E.keys=s([],E.keys,!0)),j=g,F=O,((L=E).type==="add"?Promise.resolve([]):j.getMany({trans:L.trans,keys:F,cache:"immutable"})).then(function(U){var W=O.map(function(K,G){var X,re,te,ne=U[G],oe={onerror:null,onsuccess:null};return E.type==="delete"?A.fire.call(oe,K,ne,B):E.type==="add"||ne===void 0?(X=R.fire.call(oe,K,E.values[G],B),K==null&&X!=null&&(E.keys[G]=K=X,_.outbound||Y(E.values[G],_.keyPath,K))):(X=yd(ne,E.values[G]),(re=M.fire.call(oe,X,K,ne,B))&&(te=E.values[G],Object.keys(re).forEach(function(ae){u(te,ae)?te[ae]=re[ae]:Y(te,ae,re[ae])}))),oe});return g.mutate(E).then(function(K){for(var G=K.failures,X=K.results,re=K.numFailures,K=K.lastResult,te=0;te<O.length;++te){var ne=(X||O)[te],oe=W[te];ne==null?oe.onerror&&oe.onerror(G[te]):oe.onsuccess&&oe.onsuccess(E.type==="put"&&U[te]?E.values[te]:ne)}return{failures:G,results:X,numFailures:re,lastResult:K}}).catch(function(K){return W.forEach(function(G){return G.onerror&&G.onerror(K)}),Promise.reject(K)})})}}})}})}};function bv(d,f,g){try{if(!f||f.keys.length<d.length)return null;for(var _=[],x=0,T=0;x<f.keys.length&&T<d.length;++x)Fe(f.keys[x],d[T])===0&&(_.push(g?ye(f.values[x]):f.values[x]),++T);return _.length===d.length?_:null}catch{return null}}var dT={stack:"dbcore",level:-1,create:function(d){return{table:function(f){var g=d.table(f);return i(i({},g),{getMany:function(_){if(!_.cache)return g.getMany(_);var x=bv(_.keys,_.trans._cache,_.cache==="clone");return x?le.resolve(x):g.getMany(_).then(function(T){return _.trans._cache={keys:_.keys,values:_.cache==="clone"?ye(T):T},T})},mutate:function(_){return _.type!=="add"&&(_.trans._cache=null),g.mutate(_)}})}}}};function wv(d,f){return d.trans.mode==="readonly"&&!!d.subscr&&!d.trans.explicit&&d.trans.db._options.cache!=="disabled"&&!f.schema.primaryKey.outbound}function Cv(d,f){switch(d){case"query":return f.values&&!f.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var fT={stack:"dbcore",level:0,name:"Observability",create:function(d){var f=d.schema.name,g=new Ct(d.MIN_KEY,d.MAX_KEY);return i(i({},d),{transaction:function(_,x,T){if(de.subscr&&x!=="readonly")throw new fe.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(de.querier));return d.transaction(_,x,T)},table:function(_){var x=d.table(_),T=x.schema,I=T.primaryKey,E=T.indexes,A=I.extractKey,R=I.outbound,M=I.autoIncrement&&E.filter(function(L){return L.compound&&L.keyPath.includes(I.keyPath)}),z=i(i({},x),{mutate:function(L){function F(ae){return ae="idb://".concat(f,"/").concat(_,"/").concat(ae),K[ae]||(K[ae]=new Ct)}var B,O,U,W=L.trans,K=L.mutatedParts||(L.mutatedParts={}),G=F(""),X=F(":dels"),re=L.type,oe=L.type==="deleteRange"?[L.range]:L.type==="delete"?[L.keys]:L.values.length<50?[vd(I,L).filter(function(ae){return ae}),L.values]:[],te=oe[0],ne=oe[1],oe=L.trans._cache;return a(te)?(G.addKeys(te),(oe=re==="delete"||te.length===ne.length?bv(te,oe):null)||X.addKeys(te),(oe||ne)&&(B=F,O=oe,U=ne,T.indexes.forEach(function(ae){var be=B(ae.name||"");function Te(De){return De!=null?ae.extractKey(De):null}function Ae(De){return ae.multiEntry&&a(De)?De.forEach(function(an){return be.addKey(an)}):be.addKey(De)}(O||U).forEach(function(De,xt){var Ie=O&&Te(O[xt]),xt=U&&Te(U[xt]);Fe(Ie,xt)!==0&&(Ie!=null&&Ae(Ie),xt!=null&&Ae(xt))})}))):te?(ne={from:te.lower,to:te.upper},X.add(ne),G.add(ne)):(G.add(g),X.add(g),T.indexes.forEach(function(ae){return F(ae.name).add(g)})),x.mutate(L).then(function(ae){return!te||L.type!=="add"&&L.type!=="put"||(G.addKeys(ae.results),M&&M.forEach(function(be){var Te=L.values.map(function(De){return be.extractKey(De)}),Ae=be.keyPath.findIndex(function(De){return De===I.keyPath});ae.results.forEach(function(De){return Te[Ae]=De}),F(be.name).addKeys(Te)})),W.mutatedParts=Sl(W.mutatedParts||{},K),ae})}}),E=function(F){var B=F.query,F=B.index,B=B.range;return[F,new Ct((F=B.lower)!==null&&F!==void 0?F:d.MIN_KEY,(B=B.upper)!==null&&B!==void 0?B:d.MAX_KEY)]},j={get:function(L){return[I,new Ct(L.key)]},getMany:function(L){return[I,new Ct().addKeys(L.keys)]},count:E,query:E,openCursor:E};return o(j).forEach(function(L){z[L]=function(F){var B=de.subscr,O=!!B,U=wv(de,x)&&Cv(L,F)?F.obsSet={}:B;if(O){var W=function(ne){return ne="idb://".concat(f,"/").concat(_,"/").concat(ne),U[ne]||(U[ne]=new Ct)},K=W(""),G=W(":dels"),B=j[L](F),O=B[0],B=B[1];if((L==="query"&&O.isPrimaryKey&&!F.values?G:W(O.name||"")).add(B),!O.isPrimaryKey){if(L!=="count"){var X=L==="query"&&R&&F.values&&x.query(i(i({},F),{values:!1}));return x[L].apply(this,arguments).then(function(ne){if(L==="query"){if(R&&F.values)return X.then(function(Te){return Te=Te.result,K.addKeys(Te),ne});var oe=F.values?ne.result.map(A):ne.result;(F.values?K:G).addKeys(oe)}else if(L==="openCursor"){var ae=ne,be=F.values;return ae&&Object.create(ae,{key:{get:function(){return G.addKey(ae.primaryKey),ae.key}},primaryKey:{get:function(){var Te=ae.primaryKey;return G.addKey(Te),Te}},value:{get:function(){return be&&K.addKey(ae.primaryKey),ae.value}}})}return ne})}G.add(g)}}return x[L].apply(this,arguments)}}),z}})}};function xv(d,f,g){if(g.numFailures===0)return f;if(f.type==="deleteRange")return null;var _=f.keys?f.keys.length:"values"in f&&f.values?f.values.length:1;return g.numFailures===_?null:(f=i({},f),a(f.keys)&&(f.keys=f.keys.filter(function(x,T){return!(T in g.failures)})),"values"in f&&a(f.values)&&(f.values=f.values.filter(function(x,T){return!(T in g.failures)})),f)}function _d(d,f){return g=d,((_=f).lower===void 0||(_.lowerOpen?0<Fe(g,_.lower):0<=Fe(g,_.lower)))&&(d=d,(f=f).upper===void 0||(f.upperOpen?Fe(d,f.upper)<0:Fe(d,f.upper)<=0));var g,_}function Sv(d,f,j,_,x,T){if(!j||j.length===0)return d;var I=f.query.index,A=I.multiEntry,R=f.query.range,M=_.schema.primaryKey.extractKey,z=I.extractKey,E=(I.lowLevelIndex||I).extractKey,j=j.reduce(function(L,F){var B=L,O=F.type==="add"||F.type==="put"?F.values.filter(function(G){return G=z(G),A&&a(G)?G.some(function(X){return _d(X,R)}):_d(G,R)}).map(function(G){return G=ye(G),T&&Object.freeze(G),G}):[];switch(F.type){case"add":B=L.concat(f.values?O:O.map(function(X){return M(X)}));break;case"put":var U=new Ct().addKeys(F.values.map(function(X){return M(X)})),B=L.filter(function(X){return X=f.values?M(X):X,!xl(new Ct(X),U)}).concat(f.values?O:O.map(function(X){return M(X)}));break;case"delete":var W=new Ct().addKeys(F.keys);B=L.filter(function(X){return X=f.values?M(X):X,!xl(new Ct(X),W)});break;case"deleteRange":var K=F.range;B=L.filter(function(X){return!_d(M(X),K)})}return B},d);return j===d?d:(j.sort(function(L,F){return Fe(E(L),E(F))||Fe(M(L),M(F))}),f.limit&&f.limit<1/0&&(j.length>f.limit?j.length=f.limit:d.length===f.limit&&j.length<f.limit&&(x.dirty=!0)),T?Object.freeze(j):j)}function kv(d,f){return Fe(d.lower,f.lower)===0&&Fe(d.upper,f.upper)===0&&!!d.lowerOpen==!!f.lowerOpen&&!!d.upperOpen==!!f.upperOpen}function pT(d,f){return function(g,_,x,T){if(g===void 0)return _!==void 0?-1:0;if(_===void 0)return 1;if((_=Fe(g,_))===0){if(x&&T)return 0;if(x)return 1;if(T)return-1}return _}(d.lower,f.lower,d.lowerOpen,f.lowerOpen)<=0&&0<=function(g,_,x,T){if(g===void 0)return _!==void 0?1:0;if(_===void 0)return-1;if((_=Fe(g,_))===0){if(x&&T)return 0;if(x)return-1;if(T)return 1}return _}(d.upper,f.upper,d.upperOpen,f.upperOpen)}function mT(d,f,g,_){d.subscribers.add(g),_.addEventListener("abort",function(){var x,T;d.subscribers.delete(g),d.subscribers.size===0&&(x=d,T=f,setTimeout(function(){x.subscribers.size===0&&ee(T,x)},3e3))})}var gT={stack:"dbcore",level:0,name:"Cache",create:function(d){var f=d.schema.name;return i(i({},d),{transaction:function(g,_,x){var T,I,A=d.transaction(g,_,x);return _==="readwrite"&&(I=(T=new AbortController).signal,x=function(R){return function(){if(T.abort(),_==="readwrite"){for(var M=new Set,z=0,E=g;z<E.length;z++){var j=E[z],L=Ui["idb://".concat(f,"/").concat(j)];if(L){var F=d.table(j),B=L.optimisticOps.filter(function(be){return be.trans===A});if(A._explicit&&R&&A.mutatedParts)for(var O=0,U=Object.values(L.queries.query);O<U.length;O++)for(var W=0,K=(re=U[O]).slice();W<K.length;W++)dd((te=K[W]).obsSet,A.mutatedParts)&&(ee(re,te),te.subscribers.forEach(function(be){return M.add(be)}));else if(0<B.length){L.optimisticOps=L.optimisticOps.filter(function(be){return be.trans!==A});for(var G=0,X=Object.values(L.queries.query);G<X.length;G++)for(var re,te,ne,oe=0,ae=(re=X[G]).slice();oe<ae.length;oe++)(te=ae[oe]).res!=null&&A.mutatedParts&&(R&&!te.dirty?(ne=Object.isFrozen(te.res),ne=Sv(te.res,te.req,B,F,te,ne),te.dirty?(ee(re,te),te.subscribers.forEach(function(be){return M.add(be)})):ne!==te.res&&(te.res=ne,te.promise=le.resolve({result:ne}))):(te.dirty&&ee(re,te),te.subscribers.forEach(function(be){return M.add(be)})))}}}M.forEach(function(be){return be()})}}},A.addEventListener("abort",x(!1),{signal:I}),A.addEventListener("error",x(!1),{signal:I}),A.addEventListener("complete",x(!0),{signal:I})),A},table:function(g){var _=d.table(g),x=_.schema.primaryKey;return i(i({},_),{mutate:function(T){var I=de.trans;if(x.outbound||I.db._options.cache==="disabled"||I.explicit)return _.mutate(T);var A=Ui["idb://".concat(f,"/").concat(g)];return A?(I=_.mutate(T),T.type!=="add"&&T.type!=="put"||!(50<=T.values.length||vd(x,T).some(function(R){return R==null}))?(A.optimisticOps.push(T),T.mutatedParts&&kl(T.mutatedParts),I.then(function(R){0<R.numFailures&&(ee(A.optimisticOps,T),(R=xv(0,T,R))&&A.optimisticOps.push(R),T.mutatedParts&&kl(T.mutatedParts))}),I.catch(function(){ee(A.optimisticOps,T),T.mutatedParts&&kl(T.mutatedParts)})):I.then(function(R){var M=xv(0,i(i({},T),{values:T.values.map(function(L,E){var j,L=(j=x.keyPath)!==null&&j!==void 0&&j.includes(".")?ye(L):i({},L);return Y(L,x.keyPath,R.results[E]),L})}),R);A.optimisticOps.push(M),queueMicrotask(function(){return T.mutatedParts&&kl(T.mutatedParts)})}),I):_.mutate(T)},query:function(T){if(!wv(de,_)||!Cv("query",T))return _.query(T);var I=((M=de.trans)===null||M===void 0?void 0:M.db._options.cache)==="immutable",E=de,A=E.requery,R=E.signal,M=function(F,B,O,U){var W=Ui["idb://".concat(F,"/").concat(B)];if(!W)return[];if(!(B=W.queries[O]))return[null,!1,W,null];var K=B[(U.query?U.query.index.name:null)||""];if(!K)return[null,!1,W,null];switch(O){case"query":var G=K.find(function(X){return X.req.limit===U.limit&&X.req.values===U.values&&kv(X.req.query.range,U.query.range)});return G?[G,!0,W,K]:[K.find(function(X){return("limit"in X.req?X.req.limit:1/0)>=U.limit&&(!U.values||X.req.values)&&pT(X.req.query.range,U.query.range)}),!1,W,K];case"count":return G=K.find(function(X){return kv(X.req.query.range,U.query.range)}),[G,!!G,W,K]}}(f,g,"query",T),z=M[0],E=M[1],j=M[2],L=M[3];return z&&E?z.obsSet=T.obsSet:(E=_.query(T).then(function(F){var B=F.result;if(z&&(z.res=B),I){for(var O=0,U=B.length;O<U;++O)Object.freeze(B[O]);Object.freeze(B)}else F.result=ye(B);return F}).catch(function(F){return L&&z&&ee(L,z),Promise.reject(F)}),z={obsSet:T.obsSet,promise:E,subscribers:new Set,type:"query",req:T,dirty:!1},L?L.push(z):(L=[z],(j=j||(Ui["idb://".concat(f,"/").concat(g)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[T.query.index.name||""]=L)),mT(z,L,A,R),z.promise.then(function(F){return{result:Sv(F.result,T,j==null?void 0:j.optimisticOps,_,z,I)}})}})}})}};function Dl(d,f){return new Proxy(d,{get:function(g,_,x){return _==="db"?f:Reflect.get(g,_,x)}})}var Fn=(et.prototype.version=function(d){if(isNaN(d)||d<.1)throw new fe.Type("Given version is not a positive number");if(d=Math.round(10*d)/10,this.idbdb||this._state.isBeingOpened)throw new fe.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,d);var f=this._versions,g=f.filter(function(_){return _._cfg.version===d})[0];return g||(g=new this.Version(d),f.push(g),f.sort(rT),g.stores({}),this._state.autoSchema=!1,g)},et.prototype._whenReady=function(d){var f=this;return this.idbdb&&(this._state.openComplete||de.letThrough||this._vip)?d():new le(function(g,_){if(f._state.openComplete)return _(new fe.DatabaseClosed(f._state.dbOpenError));if(!f._state.isBeingOpened){if(!f._state.autoOpen)return void _(new fe.DatabaseClosed);f.open().catch(qe)}f._state.dbReadyPromise.then(g,_)}).then(d)},et.prototype.use=function(d){var f=d.stack,g=d.create,_=d.level,x=d.name;return x&&this.unuse({stack:f,name:x}),d=this._middlewares[f]||(this._middlewares[f]=[]),d.push({stack:f,create:g,level:_??10,name:x}),d.sort(function(T,I){return T.level-I.level}),this},et.prototype.unuse=function(d){var f=d.stack,g=d.name,_=d.create;return f&&this._middlewares[f]&&(this._middlewares[f]=this._middlewares[f].filter(function(x){return _?x.create!==_:!!g&&x.name!==g})),this},et.prototype.open=function(){var d=this;return ji(ai,function(){return cT(d)})},et.prototype._close=function(){var d=this._state,f=Ls.indexOf(this);if(0<=f&&Ls.splice(f,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}d.isBeingOpened||(d.dbReadyPromise=new le(function(g){d.dbReadyResolve=g}),d.openCanceller=new le(function(g,_){d.cancelOpen=_}))},et.prototype.close=function(g){var f=(g===void 0?{disableAutoOpen:!0}:g).disableAutoOpen,g=this._state;f?(g.isBeingOpened&&g.cancelOpen(new fe.DatabaseClosed),this._close(),g.autoOpen=!1,g.dbOpenError=new fe.DatabaseClosed):(this._close(),g.autoOpen=this._options.autoOpen||g.isBeingOpened,g.openComplete=!1,g.dbOpenError=null)},et.prototype.delete=function(d){var f=this;d===void 0&&(d={disableAutoOpen:!0});var g=0<arguments.length&&typeof arguments[0]!="object",_=this._state;return new le(function(x,T){function I(){f.close(d);var A=f._deps.indexedDB.deleteDatabase(f.name);A.onsuccess=Qe(function(){var R,M,z;R=f._deps,M=f.name,z=R.indexedDB,R=R.IDBKeyRange,ld(z)||M===dl||ad(z,R).delete(M).catch(qe),x()}),A.onerror=_n(T),A.onblocked=f._fireOnBlocked}if(g)throw new fe.InvalidArgument("Invalid closeOptions argument to db.delete()");_.isBeingOpened?_.dbReadyPromise.then(I):I()})},et.prototype.backendDB=function(){return this.idbdb},et.prototype.isOpen=function(){return this.idbdb!==null},et.prototype.hasBeenClosed=function(){var d=this._state.dbOpenError;return d&&d.name==="DatabaseClosed"},et.prototype.hasFailed=function(){return this._state.dbOpenError!==null},et.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(et.prototype,"tables",{get:function(){var d=this;return o(this._allTables).map(function(f){return d._allTables[f]})},enumerable:!1,configurable:!0}),et.prototype.transaction=function(){var d=(function(f,g,_){var x=arguments.length;if(x<2)throw new fe.InvalidArgument("Too few arguments");for(var T=new Array(x-1);--x;)T[x-1]=arguments[x];return _=T.pop(),[f,ue(T),_]}).apply(this,arguments);return this._transaction.apply(this,d)},et.prototype._transaction=function(d,f,g){var _=this,x=de.trans;x&&x.db===this&&d.indexOf("!")===-1||(x=null);var T,I,A=d.indexOf("?")!==-1;d=d.replace("!","").replace("?","");try{if(I=f.map(function(M){if(M=M instanceof _.Table?M.name:M,typeof M!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return M}),d=="r"||d===Gh)T=Gh;else{if(d!="rw"&&d!=Yh)throw new fe.InvalidArgument("Invalid transaction mode: "+d);T=Yh}if(x){if(x.mode===Gh&&T===Yh){if(!A)throw new fe.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");x=null}x&&I.forEach(function(M){if(x&&x.storeNames.indexOf(M)===-1){if(!A)throw new fe.SubTransaction("Table "+M+" not included in parent transaction.");x=null}}),A&&x&&!x.active&&(x=null)}}catch(M){return x?x._promise(null,function(z,E){E(M)}):Ze(M)}var R=(function M(z,E,j,L,F){return le.resolve().then(function(){var B=de.transless||de,O=z._createTransaction(E,j,z._dbSchema,L);if(O.explicit=!0,B={trans:O,transless:B},L)O.idbtrans=L.idbtrans;else try{O.create(),O.idbtrans._explicit=!0,z._state.PR1398_maxLoop=3}catch(K){return K.name===oi.InvalidState&&z.isOpen()&&0<--z._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),z.close({disableAutoOpen:!1}),z.open().then(function(){return M(z,E,j,null,F)})):Ze(K)}var U,W=Me(F);return W&&Ps(),B=le.follow(function(){var K;(U=F.call(O,O))&&(W?(K=ci.bind(null,null),U.then(K,K)):typeof U.next=="function"&&typeof U.throw=="function"&&(U=gd(U)))},B),(U&&typeof U.then=="function"?le.resolve(U).then(function(K){return O.active?K:Ze(new fe.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):B.then(function(){return U})).then(function(K){return L&&O._resolve(),O._completion.then(function(){return K})}).catch(function(K){return O._reject(K),Ze(K)})})}).bind(null,this,T,I,x,g);return x?x._promise(T,R,"lock"):de.trans?ji(de.transless,function(){return _._whenReady(R)}):this._whenReady(R)},et.prototype.table=function(d){if(!u(this._allTables,d))throw new fe.InvalidTable("Table ".concat(d," does not exist"));return this._allTables[d]},et);function et(d,f){var g=this;this._middlewares={},this.verno=0;var _=et.dependencies;this._options=f=i({addons:et.addons,autoOpen:!0,indexedDB:_.indexedDB,IDBKeyRange:_.IDBKeyRange,cache:"cloned"},f),this._deps={indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange},_=f.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var x,T,I,A,R,M={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:qe,dbReadyPromise:null,cancelOpen:qe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:f.autoOpen};M.dbReadyPromise=new le(function(E){M.dbReadyResolve=E}),M.openCanceller=new le(function(E,j){M.cancelOpen=j}),this._state=M,this.name=d,this.on=no(this,"populate","blocked","versionchange","close",{ready:[zh,qe]}),this.on.ready.subscribe=N(this.on.ready.subscribe,function(E){return function(j,L){et.vip(function(){var F,B=g._state;B.openComplete?(B.dbOpenError||le.resolve().then(j),L&&E(j)):B.onReadyBeingFired?(B.onReadyBeingFired.push(j),L&&E(j)):(E(j),F=g,L||E(function O(){F.on.ready.unsubscribe(j),F.on.ready.unsubscribe(O)}))})}}),this.Collection=(x=this,io(Jk.prototype,function(U,O){this.db=x;var L=iv,F=null;if(O)try{L=O()}catch(W){F=W}var B=U._ctx,O=B.table,U=O.hook.reading.fire;this._ctx={table:O,index:B.index,isPrimKey:!B.index||O.schema.primKey.keyPath&&B.index===O.schema.primKey.name,range:L,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:F,or:B.or,valueMapper:U!==Xr?U:null}})),this.Table=(T=this,io(av.prototype,function(E,j,L){this.db=T,this._tx=L,this.name=E,this.schema=j,this.hook=T._allTables[E]?T._allTables[E].hook:no(null,{creating:[Uk,qe],reading:[Hk,Xr],updating:[Vk,qe],deleting:[Wk,qe]})})),this.Transaction=(I=this,io(tT.prototype,function(E,j,L,F,B){var O=this;this.db=I,this.mode=E,this.storeNames=j,this.schema=L,this.chromeTransactionDurability=F,this.idbtrans=null,this.on=no(this,"complete","error","abort"),this.parent=B||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new le(function(U,W){O._resolve=U,O._reject=W}),this._completion.then(function(){O.active=!1,O.on.complete.fire()},function(U){var W=O.active;return O.active=!1,O.on.error.fire(U),O.parent?O.parent._reject(U):W&&O.idbtrans&&O.idbtrans.abort(),Ze(U)})})),this.Version=(A=this,io(lT.prototype,function(E){this.db=A,this._cfg={version:E,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,io(dv.prototype,function(E,j,L){if(this.db=R,this._ctx={table:E,index:j===":id"?null:j,or:L},this._cmp=this._ascending=Fe,this._descending=function(F,B){return Fe(B,F)},this._max=function(F,B){return 0<Fe(F,B)?F:B},this._min=function(F,B){return Fe(F,B)<0?F:B},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new fe.MissingAPI})),this.on("versionchange",function(E){0<E.newVersion?console.warn("Another connection wants to upgrade database '".concat(g.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(g.name,"'. Closing db now to resume the delete request.")),g.close({disableAutoOpen:!1})}),this.on("blocked",function(E){!E.newVersion||E.newVersion<E.oldVersion?console.warn("Dexie.delete('".concat(g.name,"') was blocked")):console.warn("Upgrade '".concat(g.name,"' blocked by other connection holding version ").concat(E.oldVersion/10))}),this._maxKey=oo(f.IDBKeyRange),this._createTransaction=function(E,j,L,F){return new g.Transaction(E,j,L,g._options.chromeTransactionDurability,F)},this._fireOnBlocked=function(E){g.on("blocked").fire(E),Ls.filter(function(j){return j.name===g.name&&j!==g&&!j._state.vcFired}).map(function(j){return j.on("versionchange").fire(E)})},this.use(dT),this.use(gT),this.use(fT),this.use(uT),this.use(hT);var z=new Proxy(this,{get:function(E,j,L){if(j==="_vip")return!0;if(j==="table")return function(B){return Dl(g.table(B),z)};var F=Reflect.get(E,j,L);return F instanceof av?Dl(F,z):j==="tables"?F.map(function(B){return Dl(B,z)}):j==="_createTransaction"?function(){return Dl(F.apply(this,arguments),z)}:F}});this.vip=z,_.forEach(function(E){return E(g)})}var Il,Yt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",yT=(bd.prototype.subscribe=function(d,f,g){return this._subscribe(d&&typeof d!="function"?d:{next:d,error:f,complete:g})},bd.prototype[Yt]=function(){return this},bd);function bd(d){this._subscribe=d}try{Il={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{Il={indexedDB:null,IDBKeyRange:null}}function Tv(d){var f,g=!1,_=new yT(function(x){var T=Me(d),I,A=!1,R={},M={},z={get closed(){return A},unsubscribe:function(){A||(A=!0,I&&I.abort(),E&&di.storagemutated.unsubscribe(L))}};x.start&&x.start(z);var E=!1,j=function(){return qh(F)},L=function(B){Sl(R,B),dd(M,R)&&j()},F=function(){var B,O,U;!A&&Il.indexedDB&&(R={},B={},I&&I.abort(),I=new AbortController,U=function(W){var K=Ns();try{T&&Ps();var G=li(d,W);return G=T?G.finally(ci):G}finally{K&&Ms()}}(O={subscr:B,signal:I.signal,requery:j,querier:d,trans:null}),Promise.resolve(U).then(function(W){g=!0,f=W,A||O.signal.aborted||(R={},function(K){for(var G in K)if(u(K,G))return;return 1}(M=B)||E||(di(ro,L),E=!0),qh(function(){return!A&&x.next&&x.next(W)}))},function(W){g=!1,["DatabaseClosedError","AbortError"].includes(W==null?void 0:W.name)||A||qh(function(){A||x.error&&x.error(W)})}))};return setTimeout(j,0),z});return _.hasValue=function(){return g},_.getValue=function(){return f},_}var Wi=Fn;function wd(d){var f=fi;try{fi=!0,di.storagemutated.fire(d),md(d,!0)}finally{fi=f}}p(Wi,i(i({},il),{delete:function(d){return new Wi(d,{addons:[]}).delete()},exists:function(d){return new Wi(d,{addons:[]}).open().then(function(f){return f.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(d){try{return f=Wi.dependencies,g=f.indexedDB,f=f.IDBKeyRange,(ld(g)?Promise.resolve(g.databases()).then(function(_){return _.map(function(x){return x.name}).filter(function(x){return x!==dl})}):ad(g,f).toCollection().primaryKeys()).then(d)}catch{return Ze(new fe.MissingAPI)}var f,g},defineClass:function(){return function(d){l(this,d)}},ignoreTransaction:function(d){return de.trans?ji(de.transless,d):d()},vip:cd,async:function(d){return function(){try{var f=gd(d.apply(this,arguments));return f&&typeof f.then=="function"?f:le.resolve(f)}catch(g){return Ze(g)}}},spawn:function(d,f,g){try{var _=gd(d.apply(g,f||[]));return _&&typeof _.then=="function"?_:le.resolve(_)}catch(x){return Ze(x)}},currentTransaction:{get:function(){return de.trans||null}},waitFor:function(d,f){return f=le.resolve(typeof d=="function"?Wi.ignoreTransaction(d):d).timeout(f||6e4),de.trans?de.trans.waitFor(f):f},Promise:le,debug:{get:function(){return vn},set:function(d){Xy(d)}},derive:b,extend:l,props:p,override:N,Events:no,on:di,liveQuery:Tv,extendObservabilitySet:Sl,getByKeyPath:q,setByKeyPath:Y,delByKeyPath:function(d,f){typeof f=="string"?Y(d,f,void 0):"length"in f&&[].map.call(f,function(g){Y(d,g,void 0)})},shallowClone:Q,deepClone:ye,getObjectDiff:yd,cmp:Fe,asap:H,minKey:-1/0,addons:[],connections:Ls,errnames:oi,dependencies:Il,cache:Ui,semVer:"4.0.4",version:"4.0.4".split(".").map(function(d){return parseInt(d)}).reduce(function(d,f,g){return d+f/Math.pow(10,2*g)})})),Wi.maxKey=oo(Wi.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(di(ro,function(d){fi||(d=new CustomEvent(ed,{detail:d}),fi=!0,dispatchEvent(d),fi=!1)}),addEventListener(ed,function(d){d=d.detail,fi||wd(d)}));var Fs,fi=!1,Dv=function(){};return typeof BroadcastChannel<"u"&&((Dv=function(){(Fs=new BroadcastChannel(ed)).onmessage=function(d){return d.data&&wd(d.data)}})(),typeof Fs.unref=="function"&&Fs.unref(),di(ro,function(d){fi||Fs.postMessage(d)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(d){if(!Fn.disableBfCache&&d.persisted){vn&&console.debug("Dexie: handling persisted pagehide"),Fs!=null&&Fs.close();for(var f=0,g=Ls;f<g.length;f++)g[f].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(d){!Fn.disableBfCache&&d.persisted&&(vn&&console.debug("Dexie: handling persisted pageshow"),Dv(),wd({all:new Ct(-1/0,[[]])}))})),le.rejectionMapper=function(d,f){return!d||d instanceof wt||d instanceof TypeError||d instanceof SyntaxError||!d.name||!Yr[d.name]?d:(f=new Yr[d.name](f||d.message,d),"stack"in d&&v(f,"stack",{get:function(){return this.inner.stack}}),f)},Xy(vn),i(Fn,Object.freeze({__proto__:null,Dexie:Fn,liveQuery:Tv,Entity:sv,cmp:Fe,PropModSymbol:On,PropModification:Jh,replacePrefix:function(d,f){return new Jh({replacePrefix:[d,f]})},default:Fn,RangeSet:Ct,mergeRanges:co,rangesOverlap:xl}),{default:Fn}),Fn})})(hp);var Hb=hp.exports;const Pc=Bb(Hb),dp=Symbol.for("Dexie"),ar=globalThis[dp]||(globalThis[dp]=Pc);if(Pc.semVer!==ar.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Pc.semVer} and ${ar.semVer}`);const{liveQuery:Ub,mergeRanges:Wb,rangesOverlap:Vb,RangeSet:Kb,cmp:qb,Entity:Gb,PropModSymbol:Yb,PropModification:Xb,replacePrefix:Qb}=ar;class $n{}$n.TABLE={name:"cache",schema:"++id, type, key, data, createTime, updateTime, [type+key]",version:1},$n.DEFAULT_TYPE="cache";const fp=Object.freeze(Object.defineProperty({__proto__:null,CacheData:$n},Symbol.toStringTag,{value:"Module"})),Jb=Object.values(fp).reduce((n,e)=>Math.max(e.TABLE.version,n),1),Zb=Object.values(fp).reduce((n,{TABLE:e})=>(n[e.name]=e.schema,n),{});class pp extends ar{constructor(e="DataHub"){super(e),this.version(Jb).stores(Zb),this.cache.mapToClass($n)}async getCache(e,t=$n.DEFAULT_TYPE){return this.cache.where("[type+key]").equals([t,e]).first()}async getCacheData(e,t=$n.DEFAULT_TYPE){const i=await this.getCache(e,t);return i==null?void 0:i.data}async limitSize(e=$n.DEFAULT_TYPE,t=1e3){let i=await this.cache.where("type").equals(e).count();for(;i>=t;){const s=await this.cache.where("type").equals(e).first();if(!s)break;await this.cache.delete(s.id),i=await this.cache.where("type").equals(e).count()}}async setCacheData(e,t,i,s=$n.DEFAULT_TYPE){if(t===null)return this.deleteCacheData(e,s);const r=await this.getCache(e,s);return i=i||Date.now(),r?(await this.cache.update(r.id,{data:t,updateTime:i}),r.id):await this.cache.add({key:e,data:t,type:s,createTime:i,updateTime:i})}async deleteCacheData(e,t=$n.DEFAULT_TYPE){return typeof e=="number"?this.cache.delete(e):this.cache.where("[type+key]").equals([t,e]).delete()}async getPageData(e,t,i){const{currentModule:s,currentMethod:r}=window.config;return this.getCacheData(e,`PAGE_${t||s}_${i||r}`)}setPageData(e,t,i,s){const{currentModule:r,currentMethod:o}=window.config;return this.setCacheData(e,t,void 0,`PAGE_${i||r}_${s||o}`)}}Object.defineProperty(window.$,"db",{get(){var n;return this._db||(window.parent!==window?this._db=window.parent.$.db:this._db=new pp(`zentao_${((n=window.config)==null?void 0:n.account)||""}`)),this._db}});/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function mp(n){return typeof n>"u"||n===null}function ew(n){return typeof n=="object"&&n!==null}function tw(n){return Array.isArray(n)?n:mp(n)?[]:[n]}function nw(n,e){var t,i,s,r;if(e)for(r=Object.keys(e),t=0,i=r.length;t<i;t+=1)s=r[t],n[s]=e[s];return n}function iw(n,e){var t="",i;for(i=0;i<e;i+=1)t+=n;return t}function sw(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var rw=mp,ow=ew,aw=tw,lw=iw,cw=sw,uw=nw,ot={isNothing:rw,isObject:ow,toArray:aw,repeat:lw,isNegativeZero:cw,extend:uw};function gp(n,e){var t="",i=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),i+" "+t):i}function lr(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=gp(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}lr.prototype=Object.create(Error.prototype),lr.prototype.constructor=lr,lr.prototype.toString=function(e){return this.name+": "+gp(this,e)};var $t=lr;function Lc(n,e,t,i,s){var r="",o="",a=Math.floor(s/2)-1;return i-e>a&&(r=" ... ",e=i-a+r.length),t-i>a&&(o=" ...",t=i+a-o.length),{str:r+n.slice(e,t).replace(/\t/g,"→")+o,pos:i-e+r.length}}function Rc(n,e){return ot.repeat(" ",e-n.length)+n}function hw(n,e){if(e=Object.create(e||null),!n.buffer)return null;e.maxLength||(e.maxLength=79),typeof e.indent!="number"&&(e.indent=1),typeof e.linesBefore!="number"&&(e.linesBefore=3),typeof e.linesAfter!="number"&&(e.linesAfter=2);for(var t=/\r?\n|\r|\0/g,i=[0],s=[],r,o=-1;r=t.exec(n.buffer);)s.push(r.index),i.push(r.index+r[0].length),n.position<=r.index&&o<0&&(o=i.length-2);o<0&&(o=i.length-1);var a="",l,c,h=Math.min(n.line+e.linesAfter,s.length).toString().length,u=e.maxLength-(e.indent+h+3);for(l=1;l<=e.linesBefore&&!(o-l<0);l++)c=Lc(n.buffer,i[o-l],s[o-l],n.position-(i[o]-i[o-l]),u),a=ot.repeat(" ",e.indent)+Rc((n.line-l+1).toString(),h)+" | "+c.str+`
`+a;for(c=Lc(n.buffer,i[o],s[o],n.position,u),a+=ot.repeat(" ",e.indent)+Rc((n.line+1).toString(),h)+" | "+c.str+`
`,a+=ot.repeat("-",e.indent+h+3+c.pos)+`^
`,l=1;l<=e.linesAfter&&!(o+l>=s.length);l++)c=Lc(n.buffer,i[o+l],s[o+l],n.position-(i[o]-i[o+l]),u),a+=ot.repeat(" ",e.indent)+Rc((n.line+l+1).toString(),h)+" | "+c.str+`
`;return a.replace(/\n$/,"")}var dw=hw,fw=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],pw=["scalar","sequence","mapping"];function mw(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(i){e[String(i)]=t})}),e}function gw(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(fw.indexOf(t)===-1)throw new $t('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=mw(e.styleAliases||null),pw.indexOf(this.kind)===-1)throw new $t('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var yt=gw;function yp(n,e){var t=[];return n[e].forEach(function(i){var s=t.length;t.forEach(function(r,o){r.tag===i.tag&&r.kind===i.kind&&r.multi===i.multi&&(s=o)}),t[s]=i}),t}function yw(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function i(s){s.multi?(n.multi[s.kind].push(s),n.multi.fallback.push(s)):n[s.kind][s.tag]=n.fallback[s.tag]=s}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(i);return n}function Oc(n){return this.extend(n)}Oc.prototype.extend=function(e){var t=[],i=[];if(e instanceof yt)i.push(e);else if(Array.isArray(e))i=i.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(i=i.concat(e.explicit));else throw new $t("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(r){if(!(r instanceof yt))throw new $t("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(r.loadKind&&r.loadKind!=="scalar")throw new $t("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(r.multi)throw new $t("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),i.forEach(function(r){if(!(r instanceof yt))throw new $t("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(Oc.prototype);return s.implicit=(this.implicit||[]).concat(t),s.explicit=(this.explicit||[]).concat(i),s.compiledImplicit=yp(s,"implicit"),s.compiledExplicit=yp(s,"explicit"),s.compiledTypeMap=yw(s.compiledImplicit,s.compiledExplicit),s};var vp=Oc,_p=new yt("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),bp=new yt("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),wp=new yt("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),Cp=new vp({explicit:[_p,bp,wp]});function vw(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}function _w(){return null}function bw(n){return n===null}var xp=new yt("tag:yaml.org,2002:null",{kind:"scalar",resolve:vw,construct:_w,predicate:bw,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function ww(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}function Cw(n){return n==="true"||n==="True"||n==="TRUE"}function xw(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var Sp=new yt("tag:yaml.org,2002:bool",{kind:"scalar",resolve:ww,construct:Cw,predicate:xw,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function Sw(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function kw(n){return 48<=n&&n<=55}function Tw(n){return 48<=n&&n<=57}function Dw(n){if(n===null)return!1;var e=n.length,t=0,i=!1,s;if(!e)return!1;if(s=n[t],(s==="-"||s==="+")&&(s=n[++t]),s==="0"){if(t+1===e)return!0;if(s=n[++t],s==="b"){for(t++;t<e;t++)if(s=n[t],s!=="_"){if(s!=="0"&&s!=="1")return!1;i=!0}return i&&s!=="_"}if(s==="x"){for(t++;t<e;t++)if(s=n[t],s!=="_"){if(!Sw(n.charCodeAt(t)))return!1;i=!0}return i&&s!=="_"}if(s==="o"){for(t++;t<e;t++)if(s=n[t],s!=="_"){if(!kw(n.charCodeAt(t)))return!1;i=!0}return i&&s!=="_"}}if(s==="_")return!1;for(;t<e;t++)if(s=n[t],s!=="_"){if(!Tw(n.charCodeAt(t)))return!1;i=!0}return!(!i||s==="_")}function Iw(n){var e=n,t=1,i;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),i=e[0],(i==="-"||i==="+")&&(i==="-"&&(t=-1),e=e.slice(1),i=e[0]),e==="0")return 0;if(i==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}function $w(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!ot.isNegativeZero(n)}var kp=new yt("tag:yaml.org,2002:int",{kind:"scalar",resolve:Dw,construct:Iw,predicate:$w,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Aw=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Ew(n){return!(n===null||!Aw.test(n)||n[n.length-1]==="_")}function Nw(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}var Mw=/^[-+]?[0-9]+e/;function Pw(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(ot.isNegativeZero(n))return"-0.0";return t=n.toString(10),Mw.test(t)?t.replace("e",".e"):t}function Lw(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||ot.isNegativeZero(n))}var Tp=new yt("tag:yaml.org,2002:float",{kind:"scalar",resolve:Ew,construct:Nw,predicate:Lw,represent:Pw,defaultStyle:"lowercase"}),Dp=Cp.extend({implicit:[xp,Sp,kp,Tp]}),Ip=Dp,$p=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Ap=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Rw(n){return n===null?!1:$p.exec(n)!==null||Ap.exec(n)!==null}function Ow(n){var e,t,i,s,r,o,a,l=0,c=null,h,u,p;if(e=$p.exec(n),e===null&&(e=Ap.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],i=+e[2]-1,s=+e[3],!e[4])return new Date(Date.UTC(t,i,s));if(r=+e[4],o=+e[5],a=+e[6],e[7]){for(l=e[7].slice(0,3);l.length<3;)l+="0";l=+l}return e[9]&&(h=+e[10],u=+(e[11]||0),c=(h*60+u)*6e4,e[9]==="-"&&(c=-c)),p=new Date(Date.UTC(t,i,s,r,o,a,l)),c&&p.setTime(p.getTime()-c),p}function Fw(n){return n.toISOString()}var Ep=new yt("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Rw,construct:Ow,instanceOf:Date,represent:Fw});function zw(n){return n==="<<"||n===null}var Np=new yt("tag:yaml.org,2002:merge",{kind:"scalar",resolve:zw}),Fc=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function jw(n){if(n===null)return!1;var e,t,i=0,s=n.length,r=Fc;for(t=0;t<s;t++)if(e=r.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;i+=6}return i%8===0}function Bw(n){var e,t,i=n.replace(/[\r\n=]/g,""),s=i.length,r=Fc,o=0,a=[];for(e=0;e<s;e++)e%4===0&&e&&(a.push(o>>16&255),a.push(o>>8&255),a.push(o&255)),o=o<<6|r.indexOf(i.charAt(e));return t=s%4*6,t===0?(a.push(o>>16&255),a.push(o>>8&255),a.push(o&255)):t===18?(a.push(o>>10&255),a.push(o>>2&255)):t===12&&a.push(o>>4&255),new Uint8Array(a)}function Hw(n){var e="",t=0,i,s,r=n.length,o=Fc;for(i=0;i<r;i++)i%3===0&&i&&(e+=o[t>>18&63],e+=o[t>>12&63],e+=o[t>>6&63],e+=o[t&63]),t=(t<<8)+n[i];return s=r%3,s===0?(e+=o[t>>18&63],e+=o[t>>12&63],e+=o[t>>6&63],e+=o[t&63]):s===2?(e+=o[t>>10&63],e+=o[t>>4&63],e+=o[t<<2&63],e+=o[64]):s===1&&(e+=o[t>>2&63],e+=o[t<<4&63],e+=o[64],e+=o[64]),e}function Uw(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var Mp=new yt("tag:yaml.org,2002:binary",{kind:"scalar",resolve:jw,construct:Bw,predicate:Uw,represent:Hw}),Ww=Object.prototype.hasOwnProperty,Vw=Object.prototype.toString;function Kw(n){if(n===null)return!0;var e=[],t,i,s,r,o,a=n;for(t=0,i=a.length;t<i;t+=1){if(s=a[t],o=!1,Vw.call(s)!=="[object Object]")return!1;for(r in s)if(Ww.call(s,r))if(!o)o=!0;else return!1;if(!o)return!1;if(e.indexOf(r)===-1)e.push(r);else return!1}return!0}function qw(n){return n!==null?n:[]}var Pp=new yt("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Kw,construct:qw}),Gw=Object.prototype.toString;function Yw(n){if(n===null)return!0;var e,t,i,s,r,o=n;for(r=new Array(o.length),e=0,t=o.length;e<t;e+=1){if(i=o[e],Gw.call(i)!=="[object Object]"||(s=Object.keys(i),s.length!==1))return!1;r[e]=[s[0],i[s[0]]]}return!0}function Xw(n){if(n===null)return[];var e,t,i,s,r,o=n;for(r=new Array(o.length),e=0,t=o.length;e<t;e+=1)i=o[e],s=Object.keys(i),r[e]=[s[0],i[s[0]]];return r}var Lp=new yt("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Yw,construct:Xw}),Qw=Object.prototype.hasOwnProperty;function Jw(n){if(n===null)return!0;var e,t=n;for(e in t)if(Qw.call(t,e)&&t[e]!==null)return!1;return!0}function Zw(n){return n!==null?n:{}}var Rp=new yt("tag:yaml.org,2002:set",{kind:"mapping",resolve:Jw,construct:Zw}),zc=Ip.extend({implicit:[Ep,Np],explicit:[Mp,Pp,Lp,Rp]}),qn=Object.prototype.hasOwnProperty,Qo=1,Op=2,Fp=3,Jo=4,jc=1,e0=2,zp=3,t0=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,n0=/[\x85\u2028\u2029]/,i0=/[,\[\]\{\}]/,jp=/^(?:!|!!|![a-z\-]+!)$/i,Bp=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Hp(n){return Object.prototype.toString.call(n)}function dn(n){return n===10||n===13}function Di(n){return n===9||n===32}function Mt(n){return n===9||n===32||n===10||n===13}function ls(n){return n===44||n===91||n===93||n===123||n===125}function s0(n){var e;return 48<=n&&n<=57?n-48:(e=n|32,97<=e&&e<=102?e-97+10:-1)}function r0(n){return n===120?2:n===117?4:n===85?8:0}function o0(n){return 48<=n&&n<=57?n-48:-1}function Up(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"":n===95?" ":n===76?"\u2028":n===80?"\u2029":""}function a0(n){return n<=65535?String.fromCharCode(n):String.fromCharCode((n-65536>>10)+55296,(n-65536&1023)+56320)}for(var Wp=new Array(256),Vp=new Array(256),cs=0;cs<256;cs++)Wp[cs]=Up(cs)?1:0,Vp[cs]=Up(cs);function l0(n,e){this.input=n,this.filename=e.filename||null,this.schema=e.schema||zc,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=n.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Kp(n,e){var t={name:n.filename,buffer:n.input.slice(0,-1),position:n.position,line:n.line,column:n.position-n.lineStart};return t.snippet=dw(t),new $t(e,t)}function pe(n,e){throw Kp(n,e)}function Zo(n,e){n.onWarning&&n.onWarning.call(null,Kp(n,e))}var qp={YAML:function(e,t,i){var s,r,o;e.version!==null&&pe(e,"duplication of %YAML directive"),i.length!==1&&pe(e,"YAML directive accepts exactly one argument"),s=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),s===null&&pe(e,"ill-formed argument of the YAML directive"),r=parseInt(s[1],10),o=parseInt(s[2],10),r!==1&&pe(e,"unacceptable YAML version of the document"),e.version=i[0],e.checkLineBreaks=o<2,o!==1&&o!==2&&Zo(e,"unsupported YAML version of the document")},TAG:function(e,t,i){var s,r;i.length!==2&&pe(e,"TAG directive accepts exactly two arguments"),s=i[0],r=i[1],jp.test(s)||pe(e,"ill-formed tag handle (first argument) of the TAG directive"),qn.call(e.tagMap,s)&&pe(e,'there is a previously declared suffix for "'+s+'" tag handle'),Bp.test(r)||pe(e,"ill-formed tag prefix (second argument) of the TAG directive");try{r=decodeURIComponent(r)}catch{pe(e,"tag prefix is malformed: "+r)}e.tagMap[s]=r}};function Gn(n,e,t,i){var s,r,o,a;if(e<t){if(a=n.input.slice(e,t),i)for(s=0,r=a.length;s<r;s+=1)o=a.charCodeAt(s),o===9||32<=o&&o<=1114111||pe(n,"expected valid JSON character");else t0.test(a)&&pe(n,"the stream contains non-printable characters");n.result+=a}}function Gp(n,e,t,i){var s,r,o,a;for(ot.isObject(t)||pe(n,"cannot merge mappings; the provided source object is unacceptable"),s=Object.keys(t),o=0,a=s.length;o<a;o+=1)r=s[o],qn.call(e,r)||(e[r]=t[r],i[r]=!0)}function us(n,e,t,i,s,r,o,a,l){var c,h;if(Array.isArray(s))for(s=Array.prototype.slice.call(s),c=0,h=s.length;c<h;c+=1)Array.isArray(s[c])&&pe(n,"nested arrays are not supported inside keys"),typeof s=="object"&&Hp(s[c])==="[object Object]"&&(s[c]="[object Object]");if(typeof s=="object"&&Hp(s)==="[object Object]"&&(s="[object Object]"),s=String(s),e===null&&(e={}),i==="tag:yaml.org,2002:merge")if(Array.isArray(r))for(c=0,h=r.length;c<h;c+=1)Gp(n,e,r[c],t);else Gp(n,e,r,t);else!n.json&&!qn.call(t,s)&&qn.call(e,s)&&(n.line=o||n.line,n.lineStart=a||n.lineStart,n.position=l||n.position,pe(n,"duplicated mapping key")),s==="__proto__"?Object.defineProperty(e,s,{configurable:!0,enumerable:!0,writable:!0,value:r}):e[s]=r,delete t[s];return e}function Bc(n){var e;e=n.input.charCodeAt(n.position),e===10?n.position++:e===13?(n.position++,n.input.charCodeAt(n.position)===10&&n.position++):pe(n,"a line break is expected"),n.line+=1,n.lineStart=n.position,n.firstTabInLine=-1}function nt(n,e,t){for(var i=0,s=n.input.charCodeAt(n.position);s!==0;){for(;Di(s);)s===9&&n.firstTabInLine===-1&&(n.firstTabInLine=n.position),s=n.input.charCodeAt(++n.position);if(e&&s===35)do s=n.input.charCodeAt(++n.position);while(s!==10&&s!==13&&s!==0);if(dn(s))for(Bc(n),s=n.input.charCodeAt(n.position),i++,n.lineIndent=0;s===32;)n.lineIndent++,s=n.input.charCodeAt(++n.position);else break}return t!==-1&&i!==0&&n.lineIndent<t&&Zo(n,"deficient indentation"),i}function ea(n){var e=n.position,t;return t=n.input.charCodeAt(e),!!((t===45||t===46)&&t===n.input.charCodeAt(e+1)&&t===n.input.charCodeAt(e+2)&&(e+=3,t=n.input.charCodeAt(e),t===0||Mt(t)))}function Hc(n,e){e===1?n.result+=" ":e>1&&(n.result+=ot.repeat(`
`,e-1))}function c0(n,e,t){var i,s,r,o,a,l,c,h,u=n.kind,p=n.result,m;if(m=n.input.charCodeAt(n.position),Mt(m)||ls(m)||m===35||m===38||m===42||m===33||m===124||m===62||m===39||m===34||m===37||m===64||m===96||(m===63||m===45)&&(s=n.input.charCodeAt(n.position+1),Mt(s)||t&&ls(s)))return!1;for(n.kind="scalar",n.result="",r=o=n.position,a=!1;m!==0;){if(m===58){if(s=n.input.charCodeAt(n.position+1),Mt(s)||t&&ls(s))break}else if(m===35){if(i=n.input.charCodeAt(n.position-1),Mt(i))break}else{if(n.position===n.lineStart&&ea(n)||t&&ls(m))break;if(dn(m))if(l=n.line,c=n.lineStart,h=n.lineIndent,nt(n,!1,-1),n.lineIndent>=e){a=!0,m=n.input.charCodeAt(n.position);continue}else{n.position=o,n.line=l,n.lineStart=c,n.lineIndent=h;break}}a&&(Gn(n,r,o,!1),Hc(n,n.line-l),r=o=n.position,a=!1),Di(m)||(o=n.position+1),m=n.input.charCodeAt(++n.position)}return Gn(n,r,o,!1),n.result?!0:(n.kind=u,n.result=p,!1)}function u0(n,e){var t,i,s;if(t=n.input.charCodeAt(n.position),t!==39)return!1;for(n.kind="scalar",n.result="",n.position++,i=s=n.position;(t=n.input.charCodeAt(n.position))!==0;)if(t===39)if(Gn(n,i,n.position,!0),t=n.input.charCodeAt(++n.position),t===39)i=n.position,n.position++,s=n.position;else return!0;else dn(t)?(Gn(n,i,s,!0),Hc(n,nt(n,!1,e)),i=s=n.position):n.position===n.lineStart&&ea(n)?pe(n,"unexpected end of the document within a single quoted scalar"):(n.position++,s=n.position);pe(n,"unexpected end of the stream within a single quoted scalar")}function h0(n,e){var t,i,s,r,o,a;if(a=n.input.charCodeAt(n.position),a!==34)return!1;for(n.kind="scalar",n.result="",n.position++,t=i=n.position;(a=n.input.charCodeAt(n.position))!==0;){if(a===34)return Gn(n,t,n.position,!0),n.position++,!0;if(a===92){if(Gn(n,t,n.position,!0),a=n.input.charCodeAt(++n.position),dn(a))nt(n,!1,e);else if(a<256&&Wp[a])n.result+=Vp[a],n.position++;else if((o=r0(a))>0){for(s=o,r=0;s>0;s--)a=n.input.charCodeAt(++n.position),(o=s0(a))>=0?r=(r<<4)+o:pe(n,"expected hexadecimal character");n.result+=a0(r),n.position++}else pe(n,"unknown escape sequence");t=i=n.position}else dn(a)?(Gn(n,t,i,!0),Hc(n,nt(n,!1,e)),t=i=n.position):n.position===n.lineStart&&ea(n)?pe(n,"unexpected end of the document within a double quoted scalar"):(n.position++,i=n.position)}pe(n,"unexpected end of the stream within a double quoted scalar")}function d0(n,e){var t=!0,i,s,r,o=n.tag,a,l=n.anchor,c,h,u,p,m,v=Object.create(null),b,C,S,D;if(D=n.input.charCodeAt(n.position),D===91)h=93,m=!1,a=[];else if(D===123)h=125,m=!0,a={};else return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=a),D=n.input.charCodeAt(++n.position);D!==0;){if(nt(n,!0,e),D=n.input.charCodeAt(n.position),D===h)return n.position++,n.tag=o,n.anchor=l,n.kind=m?"mapping":"sequence",n.result=a,!0;t?D===44&&pe(n,"expected the node content, but found ','"):pe(n,"missed comma between flow collection entries"),C=b=S=null,u=p=!1,D===63&&(c=n.input.charCodeAt(n.position+1),Mt(c)&&(u=p=!0,n.position++,nt(n,!0,e))),i=n.line,s=n.lineStart,r=n.position,hs(n,e,Qo,!1,!0),C=n.tag,b=n.result,nt(n,!0,e),D=n.input.charCodeAt(n.position),(p||n.line===i)&&D===58&&(u=!0,D=n.input.charCodeAt(++n.position),nt(n,!0,e),hs(n,e,Qo,!1,!0),S=n.result),m?us(n,a,v,C,b,S,i,s,r):u?a.push(us(n,null,v,C,b,S,i,s,r)):a.push(b),nt(n,!0,e),D=n.input.charCodeAt(n.position),D===44?(t=!0,D=n.input.charCodeAt(++n.position)):t=!1}pe(n,"unexpected end of the stream within a flow collection")}function f0(n,e){var t,i,s=jc,r=!1,o=!1,a=e,l=0,c=!1,h,u;if(u=n.input.charCodeAt(n.position),u===124)i=!1;else if(u===62)i=!0;else return!1;for(n.kind="scalar",n.result="";u!==0;)if(u=n.input.charCodeAt(++n.position),u===43||u===45)jc===s?s=u===43?zp:e0:pe(n,"repeat of a chomping mode identifier");else if((h=o0(u))>=0)h===0?pe(n,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?pe(n,"repeat of an indentation width identifier"):(a=e+h-1,o=!0);else break;if(Di(u)){do u=n.input.charCodeAt(++n.position);while(Di(u));if(u===35)do u=n.input.charCodeAt(++n.position);while(!dn(u)&&u!==0)}for(;u!==0;){for(Bc(n),n.lineIndent=0,u=n.input.charCodeAt(n.position);(!o||n.lineIndent<a)&&u===32;)n.lineIndent++,u=n.input.charCodeAt(++n.position);if(!o&&n.lineIndent>a&&(a=n.lineIndent),dn(u)){l++;continue}if(n.lineIndent<a){s===zp?n.result+=ot.repeat(`
`,r?1+l:l):s===jc&&r&&(n.result+=`
`);break}for(i?Di(u)?(c=!0,n.result+=ot.repeat(`
`,r?1+l:l)):c?(c=!1,n.result+=ot.repeat(`
`,l+1)):l===0?r&&(n.result+=" "):n.result+=ot.repeat(`
`,l):n.result+=ot.repeat(`
`,r?1+l:l),r=!0,o=!0,l=0,t=n.position;!dn(u)&&u!==0;)u=n.input.charCodeAt(++n.position);Gn(n,t,n.position,!1)}return!0}function Yp(n,e){var t,i=n.tag,s=n.anchor,r=[],o,a=!1,l;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=r),l=n.input.charCodeAt(n.position);l!==0&&(n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,pe(n,"tab characters must not be used in indentation")),!(l!==45||(o=n.input.charCodeAt(n.position+1),!Mt(o))));){if(a=!0,n.position++,nt(n,!0,-1)&&n.lineIndent<=e){r.push(null),l=n.input.charCodeAt(n.position);continue}if(t=n.line,hs(n,e,Fp,!1,!0),r.push(n.result),nt(n,!0,-1),l=n.input.charCodeAt(n.position),(n.line===t||n.lineIndent>e)&&l!==0)pe(n,"bad indentation of a sequence entry");else if(n.lineIndent<e)break}return a?(n.tag=i,n.anchor=s,n.kind="sequence",n.result=r,!0):!1}function p0(n,e,t){var i,s,r,o,a,l,c=n.tag,h=n.anchor,u={},p=Object.create(null),m=null,v=null,b=null,C=!1,S=!1,D;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=u),D=n.input.charCodeAt(n.position);D!==0;){if(!C&&n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,pe(n,"tab characters must not be used in indentation")),i=n.input.charCodeAt(n.position+1),r=n.line,(D===63||D===58)&&Mt(i))D===63?(C&&(us(n,u,p,m,v,null,o,a,l),m=v=b=null),S=!0,C=!0,s=!0):C?(C=!1,s=!0):pe(n,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),n.position+=1,D=i;else{if(o=n.line,a=n.lineStart,l=n.position,!hs(n,t,Op,!1,!0))break;if(n.line===r){for(D=n.input.charCodeAt(n.position);Di(D);)D=n.input.charCodeAt(++n.position);if(D===58)D=n.input.charCodeAt(++n.position),Mt(D)||pe(n,"a whitespace character is expected after the key-value separator within a block mapping"),C&&(us(n,u,p,m,v,null,o,a,l),m=v=b=null),S=!0,C=!1,s=!1,m=n.tag,v=n.result;else if(S)pe(n,"can not read an implicit mapping pair; a colon is missed");else return n.tag=c,n.anchor=h,!0}else if(S)pe(n,"can not read a block mapping entry; a multiline key may not be an implicit key");else return n.tag=c,n.anchor=h,!0}if((n.line===r||n.lineIndent>e)&&(C&&(o=n.line,a=n.lineStart,l=n.position),hs(n,e,Jo,!0,s)&&(C?v=n.result:b=n.result),C||(us(n,u,p,m,v,b,o,a,l),m=v=b=null),nt(n,!0,-1),D=n.input.charCodeAt(n.position)),(n.line===r||n.lineIndent>e)&&D!==0)pe(n,"bad indentation of a mapping entry");else if(n.lineIndent<e)break}return C&&us(n,u,p,m,v,null,o,a,l),S&&(n.tag=c,n.anchor=h,n.kind="mapping",n.result=u),S}function m0(n){var e,t=!1,i=!1,s,r,o;if(o=n.input.charCodeAt(n.position),o!==33)return!1;if(n.tag!==null&&pe(n,"duplication of a tag property"),o=n.input.charCodeAt(++n.position),o===60?(t=!0,o=n.input.charCodeAt(++n.position)):o===33?(i=!0,s="!!",o=n.input.charCodeAt(++n.position)):s="!",e=n.position,t){do o=n.input.charCodeAt(++n.position);while(o!==0&&o!==62);n.position<n.length?(r=n.input.slice(e,n.position),o=n.input.charCodeAt(++n.position)):pe(n,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!Mt(o);)o===33&&(i?pe(n,"tag suffix cannot contain exclamation marks"):(s=n.input.slice(e-1,n.position+1),jp.test(s)||pe(n,"named tag handle cannot contain such characters"),i=!0,e=n.position+1)),o=n.input.charCodeAt(++n.position);r=n.input.slice(e,n.position),i0.test(r)&&pe(n,"tag suffix cannot contain flow indicator characters")}r&&!Bp.test(r)&&pe(n,"tag name cannot contain such characters: "+r);try{r=decodeURIComponent(r)}catch{pe(n,"tag name is malformed: "+r)}return t?n.tag=r:qn.call(n.tagMap,s)?n.tag=n.tagMap[s]+r:s==="!"?n.tag="!"+r:s==="!!"?n.tag="tag:yaml.org,2002:"+r:pe(n,'undeclared tag handle "'+s+'"'),!0}function g0(n){var e,t;if(t=n.input.charCodeAt(n.position),t!==38)return!1;for(n.anchor!==null&&pe(n,"duplication of an anchor property"),t=n.input.charCodeAt(++n.position),e=n.position;t!==0&&!Mt(t)&&!ls(t);)t=n.input.charCodeAt(++n.position);return n.position===e&&pe(n,"name of an anchor node must contain at least one character"),n.anchor=n.input.slice(e,n.position),!0}function y0(n){var e,t,i;if(i=n.input.charCodeAt(n.position),i!==42)return!1;for(i=n.input.charCodeAt(++n.position),e=n.position;i!==0&&!Mt(i)&&!ls(i);)i=n.input.charCodeAt(++n.position);return n.position===e&&pe(n,"name of an alias node must contain at least one character"),t=n.input.slice(e,n.position),qn.call(n.anchorMap,t)||pe(n,'unidentified alias "'+t+'"'),n.result=n.anchorMap[t],nt(n,!0,-1),!0}function hs(n,e,t,i,s){var r,o,a,l=1,c=!1,h=!1,u,p,m,v,b,C;if(n.listener!==null&&n.listener("open",n),n.tag=null,n.anchor=null,n.kind=null,n.result=null,r=o=a=Jo===t||Fp===t,i&&nt(n,!0,-1)&&(c=!0,n.lineIndent>e?l=1:n.lineIndent===e?l=0:n.lineIndent<e&&(l=-1)),l===1)for(;m0(n)||g0(n);)nt(n,!0,-1)?(c=!0,a=r,n.lineIndent>e?l=1:n.lineIndent===e?l=0:n.lineIndent<e&&(l=-1)):a=!1;if(a&&(a=c||s),(l===1||Jo===t)&&(Qo===t||Op===t?b=e:b=e+1,C=n.position-n.lineStart,l===1?a&&(Yp(n,C)||p0(n,C,b))||d0(n,b)?h=!0:(o&&f0(n,b)||u0(n,b)||h0(n,b)?h=!0:y0(n)?(h=!0,(n.tag!==null||n.anchor!==null)&&pe(n,"alias node should not have any properties")):c0(n,b,Qo===t)&&(h=!0,n.tag===null&&(n.tag="?")),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):l===0&&(h=a&&Yp(n,C))),n.tag===null)n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);else if(n.tag==="?"){for(n.result!==null&&n.kind!=="scalar"&&pe(n,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+n.kind+'"'),u=0,p=n.implicitTypes.length;u<p;u+=1)if(v=n.implicitTypes[u],v.resolve(n.result)){n.result=v.construct(n.result),n.tag=v.tag,n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);break}}else if(n.tag!=="!"){if(qn.call(n.typeMap[n.kind||"fallback"],n.tag))v=n.typeMap[n.kind||"fallback"][n.tag];else for(v=null,m=n.typeMap.multi[n.kind||"fallback"],u=0,p=m.length;u<p;u+=1)if(n.tag.slice(0,m[u].tag.length)===m[u].tag){v=m[u];break}v||pe(n,"unknown tag !<"+n.tag+">"),n.result!==null&&v.kind!==n.kind&&pe(n,"unacceptable node kind for !<"+n.tag+'> tag; it should be "'+v.kind+'", not "'+n.kind+'"'),v.resolve(n.result,n.tag)?(n.result=v.construct(n.result,n.tag),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):pe(n,"cannot resolve a node with !<"+n.tag+"> explicit tag")}return n.listener!==null&&n.listener("close",n),n.tag!==null||n.anchor!==null||h}function v0(n){var e=n.position,t,i,s,r=!1,o;for(n.version=null,n.checkLineBreaks=n.legacy,n.tagMap=Object.create(null),n.anchorMap=Object.create(null);(o=n.input.charCodeAt(n.position))!==0&&(nt(n,!0,-1),o=n.input.charCodeAt(n.position),!(n.lineIndent>0||o!==37));){for(r=!0,o=n.input.charCodeAt(++n.position),t=n.position;o!==0&&!Mt(o);)o=n.input.charCodeAt(++n.position);for(i=n.input.slice(t,n.position),s=[],i.length<1&&pe(n,"directive name must not be less than one character in length");o!==0;){for(;Di(o);)o=n.input.charCodeAt(++n.position);if(o===35){do o=n.input.charCodeAt(++n.position);while(o!==0&&!dn(o));break}if(dn(o))break;for(t=n.position;o!==0&&!Mt(o);)o=n.input.charCodeAt(++n.position);s.push(n.input.slice(t,n.position))}o!==0&&Bc(n),qn.call(qp,i)?qp[i](n,i,s):Zo(n,'unknown document directive "'+i+'"')}if(nt(n,!0,-1),n.lineIndent===0&&n.input.charCodeAt(n.position)===45&&n.input.charCodeAt(n.position+1)===45&&n.input.charCodeAt(n.position+2)===45?(n.position+=3,nt(n,!0,-1)):r&&pe(n,"directives end mark is expected"),hs(n,n.lineIndent-1,Jo,!1,!0),nt(n,!0,-1),n.checkLineBreaks&&n0.test(n.input.slice(e,n.position))&&Zo(n,"non-ASCII line breaks are interpreted as content"),n.documents.push(n.result),n.position===n.lineStart&&ea(n)){n.input.charCodeAt(n.position)===46&&(n.position+=3,nt(n,!0,-1));return}if(n.position<n.length-1)pe(n,"end of the stream or a document separator is expected");else return}function Xp(n,e){n=String(n),e=e||{},n.length!==0&&(n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n.charCodeAt(0)===65279&&(n=n.slice(1)));var t=new l0(n,e),i=n.indexOf("\0");for(i!==-1&&(t.position=i,pe(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)v0(t);return t.documents}function _0(n,e,t){e!==null&&typeof e=="object"&&typeof t>"u"&&(t=e,e=null);var i=Xp(n,t);if(typeof e!="function")return i;for(var s=0,r=i.length;s<r;s+=1)e(i[s])}function b0(n,e){var t=Xp(n,e);if(t.length!==0){if(t.length===1)return t[0];throw new $t("expected a single document in the stream, but found more")}}var w0=_0,C0=b0,Qp={loadAll:w0,load:C0},Jp=Object.prototype.toString,Zp=Object.prototype.hasOwnProperty,Uc=65279,x0=9,cr=10,S0=13,k0=32,T0=33,D0=34,Wc=35,I0=37,$0=38,A0=39,E0=42,em=44,N0=45,ta=58,M0=61,P0=62,L0=63,R0=64,tm=91,nm=93,O0=96,im=123,F0=124,sm=125,bt={};bt[0]="\\0",bt[7]="\\a",bt[8]="\\b",bt[9]="\\t",bt[10]="\\n",bt[11]="\\v",bt[12]="\\f",bt[13]="\\r",bt[27]="\\e",bt[34]='\\"',bt[92]="\\\\",bt[133]="\\N",bt[160]="\\_",bt[8232]="\\L",bt[8233]="\\P";var z0=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],j0=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function B0(n,e){var t,i,s,r,o,a,l;if(e===null)return{};for(t={},i=Object.keys(e),s=0,r=i.length;s<r;s+=1)o=i[s],a=String(e[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),l=n.compiledTypeMap.fallback[o],l&&Zp.call(l.styleAliases,a)&&(a=l.styleAliases[a]),t[o]=a;return t}function H0(n){var e,t,i;if(e=n.toString(16).toUpperCase(),n<=255)t="x",i=2;else if(n<=65535)t="u",i=4;else if(n<=4294967295)t="U",i=8;else throw new $t("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+ot.repeat("0",i-e.length)+e}var U0=1,ur=2;function W0(n){this.schema=n.schema||zc,this.indent=Math.max(1,n.indent||2),this.noArrayIndent=n.noArrayIndent||!1,this.skipInvalid=n.skipInvalid||!1,this.flowLevel=ot.isNothing(n.flowLevel)?-1:n.flowLevel,this.styleMap=B0(this.schema,n.styles||null),this.sortKeys=n.sortKeys||!1,this.lineWidth=n.lineWidth||80,this.noRefs=n.noRefs||!1,this.noCompatMode=n.noCompatMode||!1,this.condenseFlow=n.condenseFlow||!1,this.quotingType=n.quotingType==='"'?ur:U0,this.forceQuotes=n.forceQuotes||!1,this.replacer=typeof n.replacer=="function"?n.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function rm(n,e){for(var t=ot.repeat(" ",e),i=0,s=-1,r="",o,a=n.length;i<a;)s=n.indexOf(`
`,i),s===-1?(o=n.slice(i),i=a):(o=n.slice(i,s+1),i=s+1),o.length&&o!==`
`&&(r+=t),r+=o;return r}function Vc(n,e){return`
`+ot.repeat(" ",n.indent*e)}function V0(n,e){var t,i,s;for(t=0,i=n.implicitTypes.length;t<i;t+=1)if(s=n.implicitTypes[t],s.resolve(e))return!0;return!1}function na(n){return n===k0||n===x0}function hr(n){return 32<=n&&n<=126||161<=n&&n<=55295&&n!==8232&&n!==8233||57344<=n&&n<=65533&&n!==Uc||65536<=n&&n<=1114111}function om(n){return hr(n)&&n!==Uc&&n!==S0&&n!==cr}function am(n,e,t){var i=om(n),s=i&&!na(n);return(t?i:i&&n!==em&&n!==tm&&n!==nm&&n!==im&&n!==sm)&&n!==Wc&&!(e===ta&&!s)||om(e)&&!na(e)&&n===Wc||e===ta&&s}function K0(n){return hr(n)&&n!==Uc&&!na(n)&&n!==N0&&n!==L0&&n!==ta&&n!==em&&n!==tm&&n!==nm&&n!==im&&n!==sm&&n!==Wc&&n!==$0&&n!==E0&&n!==T0&&n!==F0&&n!==M0&&n!==P0&&n!==A0&&n!==D0&&n!==I0&&n!==R0&&n!==O0}function q0(n){return!na(n)&&n!==ta}function dr(n,e){var t=n.charCodeAt(e),i;return t>=55296&&t<=56319&&e+1<n.length&&(i=n.charCodeAt(e+1),i>=56320&&i<=57343)?(t-55296)*1024+i-56320+65536:t}function lm(n){var e=/^\n* /;return e.test(n)}var cm=1,Kc=2,um=3,hm=4,ds=5;function G0(n,e,t,i,s,r,o,a){var l,c=0,h=null,u=!1,p=!1,m=i!==-1,v=-1,b=K0(dr(n,0))&&q0(dr(n,n.length-1));if(e||o)for(l=0;l<n.length;c>=65536?l+=2:l++){if(c=dr(n,l),!hr(c))return ds;b=b&&am(c,h,a),h=c}else{for(l=0;l<n.length;c>=65536?l+=2:l++){if(c=dr(n,l),c===cr)u=!0,m&&(p=p||l-v-1>i&&n[v+1]!==" ",v=l);else if(!hr(c))return ds;b=b&&am(c,h,a),h=c}p=p||m&&l-v-1>i&&n[v+1]!==" "}return!u&&!p?b&&!o&&!s(n)?cm:r===ur?ds:Kc:t>9&&lm(n)?ds:o?r===ur?ds:Kc:p?hm:um}function Y0(n,e,t,i,s){n.dump=function(){if(e.length===0)return n.quotingType===ur?'""':"''";if(!n.noCompatMode&&(z0.indexOf(e)!==-1||j0.test(e)))return n.quotingType===ur?'"'+e+'"':"'"+e+"'";var r=n.indent*Math.max(1,t),o=n.lineWidth===-1?-1:Math.max(Math.min(n.lineWidth,40),n.lineWidth-r),a=i||n.flowLevel>-1&&t>=n.flowLevel;function l(c){return V0(n,c)}switch(G0(e,a,n.indent,o,l,n.quotingType,n.forceQuotes&&!i,s)){case cm:return e;case Kc:return"'"+e.replace(/'/g,"''")+"'";case um:return"|"+dm(e,n.indent)+fm(rm(e,r));case hm:return">"+dm(e,n.indent)+fm(rm(X0(e,o),r));case ds:return'"'+Q0(e)+'"';default:throw new $t("impossible error: invalid scalar style")}}()}function dm(n,e){var t=lm(n)?String(e):"",i=n[n.length-1]===`
`,s=i&&(n[n.length-2]===`
`||n===`
`),r=s?"+":i?"":"-";return t+r+`
`}function fm(n){return n[n.length-1]===`
`?n.slice(0,-1):n}function X0(n,e){for(var t=/(\n+)([^\n]*)/g,i=function(){var c=n.indexOf(`
`);return c=c!==-1?c:n.length,t.lastIndex=c,pm(n.slice(0,c),e)}(),s=n[0]===`
`||n[0]===" ",r,o;o=t.exec(n);){var a=o[1],l=o[2];r=l[0]===" ",i+=a+(!s&&!r&&l!==""?`
`:"")+pm(l,e),s=r}return i}function pm(n,e){if(n===""||n[0]===" ")return n;for(var t=/ [^ ]/g,i,s=0,r,o=0,a=0,l="";i=t.exec(n);)a=i.index,a-s>e&&(r=o>s?o:a,l+=`
`+n.slice(s,r),s=r+1),o=a;return l+=`
`,n.length-s>e&&o>s?l+=n.slice(s,o)+`
`+n.slice(o+1):l+=n.slice(s),l.slice(1)}function Q0(n){for(var e="",t=0,i,s=0;s<n.length;t>=65536?s+=2:s++)t=dr(n,s),i=bt[t],!i&&hr(t)?(e+=n[s],t>=65536&&(e+=n[s+1])):e+=i||H0(t);return e}function J0(n,e,t){var i="",s=n.tag,r,o,a;for(r=0,o=t.length;r<o;r+=1)a=t[r],n.replacer&&(a=n.replacer.call(t,String(r),a)),(An(n,e,a,!1,!1)||typeof a>"u"&&An(n,e,null,!1,!1))&&(i!==""&&(i+=","+(n.condenseFlow?"":" ")),i+=n.dump);n.tag=s,n.dump="["+i+"]"}function mm(n,e,t,i){var s="",r=n.tag,o,a,l;for(o=0,a=t.length;o<a;o+=1)l=t[o],n.replacer&&(l=n.replacer.call(t,String(o),l)),(An(n,e+1,l,!0,!0,!1,!0)||typeof l>"u"&&An(n,e+1,null,!0,!0,!1,!0))&&((!i||s!=="")&&(s+=Vc(n,e)),n.dump&&cr===n.dump.charCodeAt(0)?s+="-":s+="- ",s+=n.dump);n.tag=r,n.dump=s||"[]"}function Z0(n,e,t){var i="",s=n.tag,r=Object.keys(t),o,a,l,c,h;for(o=0,a=r.length;o<a;o+=1)h="",i!==""&&(h+=", "),n.condenseFlow&&(h+='"'),l=r[o],c=t[l],n.replacer&&(c=n.replacer.call(t,l,c)),An(n,e,l,!1,!1)&&(n.dump.length>1024&&(h+="? "),h+=n.dump+(n.condenseFlow?'"':"")+":"+(n.condenseFlow?"":" "),An(n,e,c,!1,!1)&&(h+=n.dump,i+=h));n.tag=s,n.dump="{"+i+"}"}function eC(n,e,t,i){var s="",r=n.tag,o=Object.keys(t),a,l,c,h,u,p;if(n.sortKeys===!0)o.sort();else if(typeof n.sortKeys=="function")o.sort(n.sortKeys);else if(n.sortKeys)throw new $t("sortKeys must be a boolean or a function");for(a=0,l=o.length;a<l;a+=1)p="",(!i||s!=="")&&(p+=Vc(n,e)),c=o[a],h=t[c],n.replacer&&(h=n.replacer.call(t,c,h)),An(n,e+1,c,!0,!0,!0)&&(u=n.tag!==null&&n.tag!=="?"||n.dump&&n.dump.length>1024,u&&(n.dump&&cr===n.dump.charCodeAt(0)?p+="?":p+="? "),p+=n.dump,u&&(p+=Vc(n,e)),An(n,e+1,h,!0,u)&&(n.dump&&cr===n.dump.charCodeAt(0)?p+=":":p+=": ",p+=n.dump,s+=p));n.tag=r,n.dump=s||"{}"}function gm(n,e,t){var i,s,r,o,a,l;for(s=t?n.explicitTypes:n.implicitTypes,r=0,o=s.length;r<o;r+=1)if(a=s[r],(a.instanceOf||a.predicate)&&(!a.instanceOf||typeof e=="object"&&e instanceof a.instanceOf)&&(!a.predicate||a.predicate(e))){if(t?a.multi&&a.representName?n.tag=a.representName(e):n.tag=a.tag:n.tag="?",a.represent){if(l=n.styleMap[a.tag]||a.defaultStyle,Jp.call(a.represent)==="[object Function]")i=a.represent(e,l);else if(Zp.call(a.represent,l))i=a.represent[l](e,l);else throw new $t("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');n.dump=i}return!0}return!1}function An(n,e,t,i,s,r,o){n.tag=null,n.dump=t,gm(n,t,!1)||gm(n,t,!0);var a=Jp.call(n.dump),l=i,c;i&&(i=n.flowLevel<0||n.flowLevel>e);var h=a==="[object Object]"||a==="[object Array]",u,p;if(h&&(u=n.duplicates.indexOf(t),p=u!==-1),(n.tag!==null&&n.tag!=="?"||p||n.indent!==2&&e>0)&&(s=!1),p&&n.usedDuplicates[u])n.dump="*ref_"+u;else{if(h&&p&&!n.usedDuplicates[u]&&(n.usedDuplicates[u]=!0),a==="[object Object]")i&&Object.keys(n.dump).length!==0?(eC(n,e,n.dump,s),p&&(n.dump="&ref_"+u+n.dump)):(Z0(n,e,n.dump),p&&(n.dump="&ref_"+u+" "+n.dump));else if(a==="[object Array]")i&&n.dump.length!==0?(n.noArrayIndent&&!o&&e>0?mm(n,e-1,n.dump,s):mm(n,e,n.dump,s),p&&(n.dump="&ref_"+u+n.dump)):(J0(n,e,n.dump),p&&(n.dump="&ref_"+u+" "+n.dump));else if(a==="[object String]")n.tag!=="?"&&Y0(n,n.dump,e,r,l);else{if(a==="[object Undefined]")return!1;if(n.skipInvalid)return!1;throw new $t("unacceptable kind of an object to dump "+a)}n.tag!==null&&n.tag!=="?"&&(c=encodeURI(n.tag[0]==="!"?n.tag.slice(1):n.tag).replace(/!/g,"%21"),n.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",n.dump=c+" "+n.dump)}return!0}function tC(n,e){var t=[],i=[],s,r;for(qc(n,t,i),s=0,r=i.length;s<r;s+=1)e.duplicates.push(t[i[s]]);e.usedDuplicates=new Array(r)}function qc(n,e,t){var i,s,r;if(n!==null&&typeof n=="object")if(s=e.indexOf(n),s!==-1)t.indexOf(s)===-1&&t.push(s);else if(e.push(n),Array.isArray(n))for(s=0,r=n.length;s<r;s+=1)qc(n[s],e,t);else for(i=Object.keys(n),s=0,r=i.length;s<r;s+=1)qc(n[i[s]],e,t)}function nC(n,e){e=e||{};var t=new W0(e);t.noRefs||tC(n,t);var i=n;return t.replacer&&(i=t.replacer.call({"":i},"",i)),An(t,0,i,!0,!0)?t.dump+`
`:""}var iC=nC,sC={dump:iC};function Gc(n,e){return function(){throw new Error("Function yaml."+n+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var rC=yt,oC=vp,aC=Cp,lC=Dp,cC=Ip,uC=zc,hC=Qp.load,dC=Qp.loadAll,fC=sC.dump,pC=$t,mC={binary:Mp,float:Tp,map:wp,null:xp,pairs:Lp,set:Rp,timestamp:Ep,bool:Sp,int:kp,merge:Np,omap:Pp,seq:bp,str:_p},gC=Gc("safeLoad","load"),yC=Gc("safeLoadAll","loadAll"),vC=Gc("safeDump","dump"),ym={Type:rC,Schema:oC,FAILSAFE_SCHEMA:aC,JSON_SCHEMA:lC,CORE_SCHEMA:cC,DEFAULT_SCHEMA:uC,load:hC,loadAll:dC,dump:fC,YAMLException:pC,types:mC,safeLoad:gC,safeLoadAll:yC,safeDump:vC};window.$&&Object.assign(window.$,{yaml:ym});class Yc extends ve{}Yc.NAME="Avatar",Yc.Component=ss,tt(Tb);const vD="",_D="",bD="",wD="";class Xc extends ve{}Xc.NAME="BtnGroup",Xc.Component=Jt,tt(Object.freeze(Object.defineProperty({__proto__:null,BtnGroup:Jt},Symbol.toStringTag,{value:"Module"})));const xD="",SD="",vm=Symbol("EVENT_PICK");class ia extends me{constructor(e){super(e),this._handleClick=this._handleClick.bind(this),this._hasInput=!!y(`#${e.id}`).length}get hasInput(){return this._hasInput}_handleClick(e){const{togglePop:t,clickType:i,onClick:s}=this.props;let r=i==="open"?!0:void 0;const o=y(e.target),a=s==null?void 0:s(e);if(!e.defaultPrevented){if(typeof a=="boolean")r=a;else{if(o.closest('[data-dismiss="pick"]').length){t(!1);return}if(o.closest("a,input").length)return}requestAnimationFrame(()=>t(r))}}_getClass(e){const{state:t,className:i,disabled:s,readonly:r,pickerName:o,empty:a}=e,{open:l}=t;return V("pick",i,o?`${o}-pick`:"",l&&"is-open focus",s&&"disabled",r&&"readonly",a?"is-empty-value":"")}_getProps(e){const{id:t,style:i,attrs:s}=e;return{id:`pick-${t}`,className:this._getClass(e),style:i,tabIndex:-1,onClick:this._handleClick,...s}}_renderTrigger(e){const{children:t,state:i}=e;return t??i.value}_renderValue(e){const{name:t,state:{value:i=""},disabled:s,readonly:r,id:o}=e;if(t)if(this._hasInput)y(`#${o}`).val(i);else return k("input",{id:o,type:"hidden",className:"pick-value",name:t,value:i,readonly:r,disabled:s});return null}componentDidMount(){const{id:e}=this.props;y(`#${e}`).on(`change.zui.pick.${e} syncValue.zui.pick.${e}`,(t,i)=>{if(typeof i=="symbol")return;const s=y.isPlainObject(i)&&typeof i.setValue=="string"?i.setValue:t.target.value;this._skipTriggerChange=s,this.props.changeState({value:s})})}componentWillUnmount(){const{id:e}=this.props;y(`#${e}`).off(`change.zui.pick.${e}`)}componentDidUpdate(e){const{id:t,state:i,name:s}=this.props;s&&e.state.value!==i.value&&(this._skipTriggerChange!==i.value&&y(`#${t}`).trigger("change",vm),this._skipTriggerChange=!1)}render(e){return w(e.tagName||"div",this._getProps(e),this._renderTrigger(e),this._renderValue(e))}}const Yn=Math.min,jt=Math.max,sa=Math.round,ra=Math.floor,fn=n=>({x:n,y:n}),_C={left:"right",right:"left",bottom:"top",top:"bottom"},bC={start:"end",end:"start"};function Qc(n,e,t){return jt(n,Yn(e,t))}function fs(n,e){return typeof n=="function"?n(e):n}function Xn(n){return n.split("-")[0]}function ps(n){return n.split("-")[1]}function _m(n){return n==="x"?"y":"x"}function Jc(n){return n==="y"?"height":"width"}function Ii(n){return["top","bottom"].includes(Xn(n))?"y":"x"}function Zc(n){return _m(Ii(n))}function wC(n,e,t){t===void 0&&(t=!1);const i=ps(n),s=Zc(n),r=Jc(s);let o=s==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=oa(o)),[o,oa(o)]}function CC(n){const e=oa(n);return[eu(n),e,eu(e)]}function eu(n){return n.replace(/start|end/g,e=>bC[e])}function xC(n,e,t){const i=["left","right"],s=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(n){case"top":case"bottom":return t?e?s:i:e?i:s;case"left":case"right":return e?r:o;default:return[]}}function SC(n,e,t,i){const s=ps(n);let r=xC(Xn(n),t==="start",i);return s&&(r=r.map(o=>o+"-"+s),e&&(r=r.concat(r.map(eu)))),r}function oa(n){return n.replace(/left|right|bottom|top/g,e=>_C[e])}function kC(n){return{top:0,right:0,bottom:0,left:0,...n}}function bm(n){return typeof n!="number"?kC(n):{top:n,right:n,bottom:n,left:n}}function aa(n){const{x:e,y:t,width:i,height:s}=n;return{width:i,height:s,top:t,left:e,right:e+i,bottom:t+s,x:e,y:t}}function wm(n,e,t){let{reference:i,floating:s}=n;const r=Ii(e),o=Zc(e),a=Jc(o),l=Xn(e),c=r==="y",h=i.x+i.width/2-s.width/2,u=i.y+i.height/2-s.height/2,p=i[a]/2-s[a]/2;let m;switch(l){case"top":m={x:h,y:i.y-s.height};break;case"bottom":m={x:h,y:i.y+i.height};break;case"right":m={x:i.x+i.width,y:u};break;case"left":m={x:i.x-s.width,y:u};break;default:m={x:i.x,y:i.y}}switch(ps(e)){case"start":m[o]-=p*(t&&c?-1:1);break;case"end":m[o]+=p*(t&&c?-1:1);break}return m}const TC=async(n,e,t)=>{const{placement:i="bottom",strategy:s="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:n,floating:e,strategy:s}),{x:h,y:u}=wm(c,i,l),p=i,m={},v=0;for(let b=0;b<a.length;b++){const{name:C,fn:S}=a[b],{x:D,y:N,data:P,reset:H}=await S({x:h,y:u,initialPlacement:i,placement:p,strategy:s,middlewareData:m,rects:c,platform:o,elements:{reference:n,floating:e}});h=D??h,u=N??u,m={...m,[C]:{...m[C],...P}},H&&v<=50&&(v++,typeof H=="object"&&(H.placement&&(p=H.placement),H.rects&&(c=H.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:s}):H.rects),{x:h,y:u}=wm(c,p,l)),b=-1)}return{x:h,y:u,placement:p,strategy:s,middlewareData:m}};async function tu(n,e){var t;e===void 0&&(e={});const{x:i,y:s,platform:r,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:u="floating",altBoundary:p=!1,padding:m=0}=fs(e,n),v=bm(m),C=a[p?u==="floating"?"reference":"floating":u],S=aa(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(C)))==null||t?C:C.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),D=u==="floating"?{x:i,y:s,width:o.floating.width,height:o.floating.height}:o.reference,N=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),P=await(r.isElement==null?void 0:r.isElement(N))?await(r.getScale==null?void 0:r.getScale(N))||{x:1,y:1}:{x:1,y:1},H=aa(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:D,offsetParent:N,strategy:l}):D);return{top:(S.top-H.top+v.top)/P.y,bottom:(H.bottom-S.bottom+v.bottom)/P.y,left:(S.left-H.left+v.left)/P.x,right:(H.right-S.right+v.right)/P.x}}const DC=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:i,placement:s,rects:r,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:h=0}=fs(n,e)||{};if(c==null)return{};const u=bm(h),p={x:t,y:i},m=Zc(s),v=Jc(m),b=await o.getDimensions(c),C=m==="y",S=C?"top":"left",D=C?"bottom":"right",N=C?"clientHeight":"clientWidth",P=r.reference[v]+r.reference[m]-p[m]-r.floating[v],H=p[m]-r.reference[m],q=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let Y=q?q[N]:0;(!Y||!await(o.isElement==null?void 0:o.isElement(q)))&&(Y=a.floating[N]||r.floating[v]);const Q=P/2-H/2,Z=Y/2-b[v]/2-1,ue=Yn(u[S],Z),J=Yn(u[D],Z),se=ue,ye=Y-b[v]-J,_e=Y/2-b[v]/2+Q,Ee=Qc(se,_e,ye),Oe=!l.arrow&&ps(s)!=null&&_e!==Ee&&r.reference[v]/2-(_e<se?ue:J)-b[v]/2<0,ce=Oe?_e<se?_e-se:_e-ye:0;return{[m]:p[m]+ce,data:{[m]:Ee,centerOffset:_e-Ee-ce,...Oe&&{alignmentOffset:ce}},reset:Oe}}}),IC=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,i;const{placement:s,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:b=!0,...C}=fs(n,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const S=Xn(s),D=Ii(a),N=Xn(a)===a,P=await(l.isRTL==null?void 0:l.isRTL(c.floating)),H=p||(N||!b?[oa(a)]:CC(a)),q=v!=="none";!p&&q&&H.push(...SC(a,b,v,P));const Y=[a,...H],Q=await tu(e,C),Z=[];let ue=((i=r.flip)==null?void 0:i.overflows)||[];if(h&&Z.push(Q[S]),u){const _e=wC(s,o,P);Z.push(Q[_e[0]],Q[_e[1]])}if(ue=[...ue,{placement:s,overflows:Z}],!Z.every(_e=>_e<=0)){var J,se;const _e=(((J=r.flip)==null?void 0:J.index)||0)+1,Ee=Y[_e];if(Ee)return{data:{index:_e,overflows:ue},reset:{placement:Ee}};let Oe=(se=ue.filter(ce=>ce.overflows[0]<=0).sort((ce,ee)=>ce.overflows[1]-ee.overflows[1])[0])==null?void 0:se.placement;if(!Oe)switch(m){case"bestFit":{var ye;const ce=(ye=ue.filter(ee=>{if(q){const Se=Ii(ee.placement);return Se===D||Se==="y"}return!0}).map(ee=>[ee.placement,ee.overflows.filter(Se=>Se>0).reduce((Se,Ce)=>Se+Ce,0)]).sort((ee,Se)=>ee[1]-Se[1])[0])==null?void 0:ye[0];ce&&(Oe=ce);break}case"initialPlacement":Oe=a;break}if(s!==Oe)return{reset:{placement:Oe}}}return{}}}};async function $C(n,e){const{placement:t,platform:i,elements:s}=n,r=await(i.isRTL==null?void 0:i.isRTL(s.floating)),o=Xn(t),a=ps(t),l=Ii(t)==="y",c=["left","top"].includes(o)?-1:1,h=r&&l?-1:1,u=fs(e,n);let{mainAxis:p,crossAxis:m,alignmentAxis:v}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof v=="number"&&(m=a==="end"?v*-1:v),l?{x:m*h,y:p*c}:{x:p*c,y:m*h}}const AC=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,i;const{x:s,y:r,placement:o,middlewareData:a}=e,l=await $C(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:s+l.x,y:r+l.y,data:{...l,placement:o}}}}},EC=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:i,placement:s}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:C=>{let{x:S,y:D}=C;return{x:S,y:D}}},...l}=fs(n,e),c={x:t,y:i},h=await tu(e,l),u=Ii(Xn(s)),p=_m(u);let m=c[p],v=c[u];if(r){const C=p==="y"?"top":"left",S=p==="y"?"bottom":"right",D=m+h[C],N=m-h[S];m=Qc(D,m,N)}if(o){const C=u==="y"?"top":"left",S=u==="y"?"bottom":"right",D=v+h[C],N=v-h[S];v=Qc(D,v,N)}const b=a.fn({...e,[p]:m,[u]:v});return{...b,data:{x:b.x-t,y:b.y-i,enabled:{[p]:r,[u]:o}}}}}},NC=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,i;const{placement:s,rects:r,platform:o,elements:a}=e,{apply:l=()=>{},...c}=fs(n,e),h=await tu(e,c),u=Xn(s),p=ps(s),m=Ii(s)==="y",{width:v,height:b}=r.floating;let C,S;u==="top"||u==="bottom"?(C=u,S=p===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(S=u,C=p==="end"?"top":"bottom");const D=b-h.top-h.bottom,N=v-h.left-h.right,P=Yn(b-h[C],D),H=Yn(v-h[S],N),q=!e.middlewareData.shift;let Y=P,Q=H;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(Q=N),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(Y=D),q&&!p){const ue=jt(h.left,0),J=jt(h.right,0),se=jt(h.top,0),ye=jt(h.bottom,0);m?Q=v-2*(ue!==0||J!==0?ue+J:jt(h.left,h.right)):Y=b-2*(se!==0||ye!==0?se+ye:jt(h.top,h.bottom))}await l({...e,availableWidth:Q,availableHeight:Y});const Z=await o.getDimensions(a.floating);return v!==Z.width||b!==Z.height?{reset:{rects:!0}}:{}}}};function la(){return typeof window<"u"}function ms(n){return Cm(n)?(n.nodeName||"").toLowerCase():"#document"}function Bt(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function pn(n){var e;return(e=(Cm(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function Cm(n){return la()?n instanceof Node||n instanceof Bt(n).Node:!1}function Zt(n){return la()?n instanceof Element||n instanceof Bt(n).Element:!1}function mn(n){return la()?n instanceof HTMLElement||n instanceof Bt(n).HTMLElement:!1}function xm(n){return!la()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Bt(n).ShadowRoot}function fr(n){const{overflow:e,overflowX:t,overflowY:i,display:s}=en(n);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!["inline","contents"].includes(s)}function MC(n){return["table","td","th"].includes(ms(n))}function ca(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function nu(n){const e=iu(),t=Zt(n)?en(n):n;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(t.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(t.contain||"").includes(i))}function PC(n){let e=Qn(n);for(;mn(e)&&!gs(e);){if(nu(e))return e;if(ca(e))return null;e=Qn(e)}return null}function iu(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function gs(n){return["html","body","#document"].includes(ms(n))}function en(n){return Bt(n).getComputedStyle(n)}function ua(n){return Zt(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Qn(n){if(ms(n)==="html")return n;const e=n.assignedSlot||n.parentNode||xm(n)&&n.host||pn(n);return xm(e)?e.host:e}function Sm(n){const e=Qn(n);return gs(e)?n.ownerDocument?n.ownerDocument.body:n.body:mn(e)&&fr(e)?e:Sm(e)}function pr(n,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=Sm(n),r=s===((i=n.ownerDocument)==null?void 0:i.body),o=Bt(s);if(r){const a=su(o);return e.concat(o,o.visualViewport||[],fr(s)?s:[],a&&t?pr(a):[])}return e.concat(s,pr(s,[],t))}function su(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function km(n){const e=en(n);let t=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const s=mn(n),r=s?n.offsetWidth:t,o=s?n.offsetHeight:i,a=sa(t)!==r||sa(i)!==o;return a&&(t=r,i=o),{width:t,height:i,$:a}}function ru(n){return Zt(n)?n:n.contextElement}function ys(n){const e=ru(n);if(!mn(e))return fn(1);const t=e.getBoundingClientRect(),{width:i,height:s,$:r}=km(e);let o=(r?sa(t.width):t.width)/i,a=(r?sa(t.height):t.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const LC=fn(0);function Tm(n){const e=Bt(n);return!iu()||!e.visualViewport?LC:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function RC(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Bt(n)?!1:e}function $i(n,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=n.getBoundingClientRect(),r=ru(n);let o=fn(1);e&&(i?Zt(i)&&(o=ys(i)):o=ys(n));const a=RC(r,t,i)?Tm(r):fn(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,h=s.width/o.x,u=s.height/o.y;if(r){const p=Bt(r),m=i&&Zt(i)?Bt(i):i;let v=p,b=su(v);for(;b&&i&&m!==v;){const C=ys(b),S=b.getBoundingClientRect(),D=en(b),N=S.left+(b.clientLeft+parseFloat(D.paddingLeft))*C.x,P=S.top+(b.clientTop+parseFloat(D.paddingTop))*C.y;l*=C.x,c*=C.y,h*=C.x,u*=C.y,l+=N,c+=P,v=Bt(b),b=su(v)}}return aa({width:h,height:u,x:l,y:c})}function ou(n,e){const t=ua(n).scrollLeft;return e?e.left+t:$i(pn(n)).left+t}function Dm(n,e,t){t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=i.left+e.scrollLeft-(t?0:ou(n,i)),r=i.top+e.scrollTop;return{x:s,y:r}}function OC(n){let{elements:e,rect:t,offsetParent:i,strategy:s}=n;const r=s==="fixed",o=pn(i),a=e?ca(e.floating):!1;if(i===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=fn(1);const h=fn(0),u=mn(i);if((u||!u&&!r)&&((ms(i)!=="body"||fr(o))&&(l=ua(i)),mn(i))){const m=$i(i);c=ys(i),h.x=m.x+i.clientLeft,h.y=m.y+i.clientTop}const p=o&&!u&&!r?Dm(o,l,!0):fn(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+h.x+p.x,y:t.y*c.y-l.scrollTop*c.y+h.y+p.y}}function FC(n){return Array.from(n.getClientRects())}function zC(n){const e=pn(n),t=ua(n),i=n.ownerDocument.body,s=jt(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=jt(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-t.scrollLeft+ou(n);const a=-t.scrollTop;return en(i).direction==="rtl"&&(o+=jt(e.clientWidth,i.clientWidth)-s),{width:s,height:r,x:o,y:a}}function jC(n,e){const t=Bt(n),i=pn(n),s=t.visualViewport;let r=i.clientWidth,o=i.clientHeight,a=0,l=0;if(s){r=s.width,o=s.height;const c=iu();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:r,height:o,x:a,y:l}}function BC(n,e){const t=$i(n,!0,e==="fixed"),i=t.top+n.clientTop,s=t.left+n.clientLeft,r=mn(n)?ys(n):fn(1),o=n.clientWidth*r.x,a=n.clientHeight*r.y,l=s*r.x,c=i*r.y;return{width:o,height:a,x:l,y:c}}function Im(n,e,t){let i;if(e==="viewport")i=jC(n,t);else if(e==="document")i=zC(pn(n));else if(Zt(e))i=BC(e,t);else{const s=Tm(n);i={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return aa(i)}function $m(n,e){const t=Qn(n);return t===e||!Zt(t)||gs(t)?!1:en(t).position==="fixed"||$m(t,e)}function HC(n,e){const t=e.get(n);if(t)return t;let i=pr(n,[],!1).filter(a=>Zt(a)&&ms(a)!=="body"),s=null;const r=en(n).position==="fixed";let o=r?Qn(n):n;for(;Zt(o)&&!gs(o);){const a=en(o),l=nu(o);!l&&a.position==="fixed"&&(s=null),(r?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||fr(o)&&!l&&$m(n,o))?i=i.filter(h=>h!==o):s=a,o=Qn(o)}return e.set(n,i),i}function UC(n){let{element:e,boundary:t,rootBoundary:i,strategy:s}=n;const o=[...t==="clippingAncestors"?ca(e)?[]:HC(e,this._c):[].concat(t),i],a=o[0],l=o.reduce((c,h)=>{const u=Im(e,h,s);return c.top=jt(u.top,c.top),c.right=Yn(u.right,c.right),c.bottom=Yn(u.bottom,c.bottom),c.left=jt(u.left,c.left),c},Im(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function WC(n){const{width:e,height:t}=km(n);return{width:e,height:t}}function VC(n,e,t){const i=mn(e),s=pn(e),r=t==="fixed",o=$i(n,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=fn(0);if(i||!i&&!r)if((ms(e)!=="body"||fr(s))&&(a=ua(e)),i){const p=$i(e,!0,r,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else s&&(l.x=ou(s));const c=s&&!i&&!r?Dm(s,a):fn(0),h=o.left+a.scrollLeft-l.x-c.x,u=o.top+a.scrollTop-l.y-c.y;return{x:h,y:u,width:o.width,height:o.height}}function au(n){return en(n).position==="static"}function Am(n,e){if(!mn(n)||en(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return pn(n)===t&&(t=t.ownerDocument.body),t}function Em(n,e){const t=Bt(n);if(ca(n))return t;if(!mn(n)){let s=Qn(n);for(;s&&!gs(s);){if(Zt(s)&&!au(s))return s;s=Qn(s)}return t}let i=Am(n,e);for(;i&&MC(i)&&au(i);)i=Am(i,e);return i&&gs(i)&&au(i)&&!nu(i)?t:i||PC(n)||t}const KC=async function(n){const e=this.getOffsetParent||Em,t=this.getDimensions,i=await t(n.floating);return{reference:VC(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function qC(n){return en(n).direction==="rtl"}const GC={convertOffsetParentRelativeRectToViewportRelativeRect:OC,getDocumentElement:pn,getClippingRect:UC,getOffsetParent:Em,getElementRects:KC,getClientRects:FC,getDimensions:WC,getScale:ys,isElement:Zt,isRTL:qC};function YC(n,e){let t=null,i;const s=pn(n);function r(){var a;clearTimeout(i),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),r();const{left:c,top:h,width:u,height:p}=n.getBoundingClientRect();if(a||e(),!u||!p)return;const m=ra(h),v=ra(s.clientWidth-(c+u)),b=ra(s.clientHeight-(h+p)),C=ra(c),D={rootMargin:-m+"px "+-v+"px "+-b+"px "+-C+"px",threshold:jt(0,Yn(1,l))||1};let N=!0;function P(H){const q=H[0].intersectionRatio;if(q!==l){if(!N)return o();q?o(!1,q):i=setTimeout(()=>{o(!1,1e-7)},1e3)}N=!1}try{t=new IntersectionObserver(P,{...D,root:s.ownerDocument})}catch{t=new IntersectionObserver(P,D)}t.observe(n)}return o(!0),r}function Nm(n,e,t,i){i===void 0&&(i={});const{ancestorScroll:s=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,c=ru(n),h=s||r?[...c?pr(c):[],...pr(e)]:[];h.forEach(S=>{s&&S.addEventListener("scroll",t,{passive:!0}),r&&S.addEventListener("resize",t)});const u=c&&a?YC(c,t):null;let p=-1,m=null;o&&(m=new ResizeObserver(S=>{let[D]=S;D&&D.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var N;(N=m)==null||N.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let v,b=l?$i(n):null;l&&C();function C(){const S=$i(n);b&&(S.x!==b.x||S.y!==b.y||S.width!==b.width||S.height!==b.height)&&t(),b=S,v=requestAnimationFrame(C)}return t(),()=>{var S;h.forEach(D=>{s&&D.removeEventListener("scroll",t),r&&D.removeEventListener("resize",t)}),u==null||u(),(S=m)==null||S.disconnect(),m=null,l&&cancelAnimationFrame(v)}}const lu=AC,cu=EC,uu=IC,Mm=NC,XC=DC,hu=(n,e,t)=>{const i=new Map,s={platform:GC,...t},r={...s.platform,_c:i};return TC(n,e,{...s,platform:r})};class du extends me{constructor(e){super(e),this._ref=he(),this._handleDocClick=t=>{const{state:{open:i},id:s,togglePop:r}=this.props,o=y(t.target);i!=="closing"&&!o.closest(`#pick-${s},#pick-pop-${s}`).length&&o.parent().length&&r(!1)},this._handleClick=this._handleClick.bind(this)}get trigger(){return y(`#pick-${this.props.id}`)[0]}get element(){var e;return(e=this._ref)==null?void 0:e.current}get container(){return this._container}_handleClick(e){const{togglePop:t,onClickItem:i,state:s}=this.props,r=y(e.target),o=r.closest("[data-pick-value]");if(i&&i(e,s.value),o.length)return e.stopPropagation(),t(!1,{value:`${o.dataset("pickValue")}`});if(r.closest('[data-dismiss="pick"]').length)return t(!1)}_getClass(e){const{className:t,state:i,pickerName:s,empty:r}=e,{open:o}=i;return V("pick-pop",s?`${s}-pick-pop`:"",t,o===!0&&"in",r?"is-empty-value":"")}_getProps(e){const{id:t,style:i,maxHeight:s,maxWidth:r,minHeight:o,minWidth:a}=e,l=y.extend({maxHeight:s,maxWidth:r,minHeight:o,minWidth:a},i);return{id:`pick-pop-${t}`,className:this._getClass(e),style:l,ref:this._ref,onClick:this._handleClick}}_getContainer(e){if(!this._container){const t=y(e.container||"body");let i=t.find(".pick-container");i.length||(i=y("<div>").addClass("pick-container").appendTo(t)),this._container=i[0]}return this._container}_render(e){return k("div",{...this._getProps(e),children:this._renderPop(e)})}_renderPop(e){return e.children}_getStyle(e={},t){var c;const i=(c=this.trigger)==null?void 0:c.getBoundingClientRect();if(!i)return{};const{width:s,minWidth:r,maxWidth:o,maxHeight:a}=this.props,l=i.width;if(typeof s=="function"?e.width=s():s==="100%"?e.width=l:s&&(e.width=Ge(s)),r==="100%"&&(e.minWidth=l),o==="100%"&&(e.maxWidth=l),this.props.limitInScreen&&t&&(!a||a==="auto"||typeof a=="number")){let h;if(t.includes("bottom"))h=window.innerHeight-i.bottom-2;else{const u=this.element.getBoundingClientRect().height;h=i.top,u>h&&typeof e.top=="number"&&(e.top+=u-h)}h&&(e.maxHeight=typeof a=="number"?Math.min(h,a):h)}else a&&(e.maxHeight=a);return e}layout(){const{element:e,trigger:t,props:i}=this,{state:s}=i;if(!e||!t||!s.open){this._layoutWatcher&&(this._layoutWatcher(),this._layoutWatcher=void 0);return}this._layoutWatcher||(this._layoutWatcher=Nm(t,e,()=>{const{placement:r,width:o,noFlipAfterShow:a}=i,l=this._lastPlacement;hu(t,e,{placement:a&&l?l:!r||r==="auto"?"bottom-start":r,middleware:[r==="auto"&&(!a||!l)?uu():null,cu(),lu(1)].filter(Boolean)}).then(({x:c,y:h,placement:u})=>{var p,m;if(Un(t)||!Gs(t,{checkZeroSize:!0})){y(e).css({display:"none"});return}y(e).css(this._getStyle({left:c,top:h},u)),(m=(p=this.props).onLayout)==null||m.call(p,e),l||(this._lastPlacement=u)}),o==="100%"&&y(e).css(this._getStyle())}))}componentDidMount(){var e,t;this.layout(),y(document).on("click",this._handleDocClick),(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!0})}componentDidUpdate(){var e,t;(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!1})}componentWillUnmount(){var t,i;y(document).off("click",this._handleDocClick);const e=this._layoutWatcher;e&&(e(),this._layoutWatcher=void 0),this._container=void 0,this._ref=void 0,y(`#pick-pop-${this.props.id}`).remove(),(i=(t=this.props).beforeDestroy)==null||i.call(t)}render(e){return sp(this._render(e),this._getContainer(e))}}const kD="";let ht=class extends me{constructor(e){super(e),this._toggleTimer=0,this._pop=he(),this._trigger=he(),this.toggle=async(t,i)=>{(this.props.disabled||this.props.readonly)&&(t=!1);const{state:s}=this;if(typeof t=="boolean"&&t===(!!s.open&&s.open!=="closing"))return i&&await this.changeState(i),this.state;this._toggleTimer&&(clearTimeout(this._toggleTimer),this._toggleTimer=0);let r=await this.changeState(a=>(t=t??!a.open,{open:t?"opening":"closing",...i}));const{open:o}=r;return o==="closing"?(await bi(200,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!1})):o==="opening"&&(await bi(50,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!0})),r},this._id=e.id??`_pick${Tt()}`,this.changeState=this.changeState.bind(this),this.state=this.getDefaultState(e)}get id(){return this._id}get pop(){return this._pop.current}get trigger(){return this._trigger.current}get value(){return this.state.value}getDefaultState(e){return{value:String((e||this.props).defaultValue??""),open:!1}}resetState(e,t){const i=this.getDefaultState(e);t?this.state=i:this.changeState(i)}changeState(e,t){return new Promise(i=>{this.setState(e,()=>{t==null||t(),i(this.state)})})}open(e){return this.toggle(!0,e)}close(e){return this.toggle(!1,e)}_getTriggerProps(e,t){return{id:this.id,ref:this._trigger,state:t,className:e.className,pickerName:e.pickerName,style:e.style,name:e.name,tagName:e.tagName,attrs:e.attrs,disabled:e.disabled,readonly:e.readonly,clickType:e.clickType,onClick:e.onClick,changeState:this.changeState,togglePop:this.toggle}}_getPopProps(e,t){return{id:this.id,state:t,className:e.popClass,pickerName:e.pickerName,style:e.popStyle,disabled:e.disabled,readonly:e.readonly,changeState:this.changeState,togglePop:this.toggle,placement:e.popPlacement,container:e.popContainer,width:e.popWidth,height:e.popHeight,minHeight:e.popMinHeight,maxHeight:e.popMaxHeight,maxWidth:e.popMaxWidth,minWidth:e.popMinWidth,limitInScreen:e.limitPopInScreen,onClickItem:e.onClickItem}}_renderTrigger(e,t){return null}_renderPop(e,t){return null}_afterRender(e=!1){var t;(t=this.props.afterRender)==null||t.call(this,{firstRender:e})}_getPop(e){return e.Pop||this.constructor.Pop}_getTrigger(e){return e.Trigger||this.constructor.Trigger}_isEmptyValue(){const{value:e}=this.state;return e==null||e===""}_handleChange(e,t){const{onChange:i}=this.props;i&&i.call(this,e,t)}_handlePopToggle(e){const{onPopShown:t,onPopHidden:i}=this.props;e===!0&&t?t.call(this):!e&&i&&i.call(this)}setValue(e,t){if(t){const i=this._trigger.current;i&&(i._skipTriggerChange=e)}return this.changeState({value:e})}componentDidMount(){this._afterRender(!0)}componentWillUpdate(e,t){const{open:i}=this.state,{open:s}=t;if(!i==!s)return;const{onPopShow:r,onPopHide:o}=this.props;s&&r?r.call(this):!s&&o&&o.call(this)}componentDidUpdate(e,t){const{open:i,value:s}=this.state,{open:r,value:o}=t;!!i!=!!r&&this._handlePopToggle(!!i),s!==o&&this._handleChange(s,o),this._afterRender()}componentWillUnmount(){var t;(t=this.props.beforeDestroy)==null||t.call(this),this._toggleTimer&&clearTimeout(this._toggleTimer);const e=this._pop.current;e&&e.componentWillUnmount&&e.componentWillUnmount()}render(e,t){const{open:i}=t,s=this._getTrigger(e);let r;if(i&&(!e.hidePopWhenEmpty||!this._isEmptyValue())){const o=this._getPop(e);r=k(o,{ref:this._pop,...this._getPopProps(e,t),children:this._renderPop(e,t)},"pop")}return k(Tn,{children:[k(s,{...this._getTriggerProps(e,t),children:this._renderTrigger(e,t)},"pick"),r]})}};ht.Trigger=ia,ht.Pop=du,ht.defaultProps={popContainer:"body",popClass:"popup",popWidth:"100%",popPlacement:"auto",popMinWidth:50,popMinHeight:32,popMaxHeight:300,limitPopInScreen:!0,clickType:"open"};let Pm=class extends ht{getDefaultState(e){const t=super.getDefaultState(e);return t.value===void 0&&(e||this.props).required&&(t.value=this.getColors()[0]),t}getColors(){const{colors:e}=this.props;return typeof e=="string"?e.split(","):e||[]}componentDidMount(){this.syncColor()}syncColor(){const{syncBackground:e,syncBorder:t,syncColor:i,syncValue:s}=this.props,r=this.state.value||"";if(e&&y(e).css("backgroundColor",r),t&&y(t).css("borderColor",r),i&&y(i).css("color",r),s){const o=y(s);o.is("input,textarea,select")?o.val(r):o.text(r)}}_handleChange(e,t){this.props.disabled||(super._handleChange(e,t),this.syncColor())}_renderTrigger(e,t){const{icon:i}=e,{value:s}=t;return[i?k($e,{icon:i},"icon"):k("span",{class:"color-picker-item bg-current ring ring-gray ring-inset",style:{background:s}})]}_getTriggerProps(e,t){const i=super._getTriggerProps(e,t);return i.style=y.extend({color:t.value},i.style),i.className=V("color-picker",i.className,{disabled:e.disabled}),i}_renderPop(e,t){const{closeBtn:i,heading:s}=e,r=this.getColors(),{value:o}=t;let a;return s&&(a=k("div",{className:"color-picker-heading",children:[s,i?k("button",{className:"btn ghost square rounded size-sm","data-dismiss":"pick",children:k("span",{class:"close"})}):null]},"heading")),[a,k("div",{className:"color-picker-row",children:[r.map(l=>k("button",{className:"btn color-picker-item",style:{backgroundColor:l},"data-pick-value":l,children:o===l?k($e,{icon:"check"}):null},l)),k("button",{className:"btn color-picker-item","data-pick-value":"",children:k($e,{className:"text-fore",icon:"trash"})})]},"row")]}};Pm.defaultProps={...ht.defaultProps,className:"rounded btn square size-sm ghost",popClass:"color-picker-pop popup",colors:["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#14b8a6","#0ea5e9","#6366f1","#a855f7","#d946ef","#ec4899"],closeBtn:!0,popWidth:"auto",popMinWidth:184};class ha extends ve{}ha.NAME="ColorPicker",ha.Component=Pm,ha.register();const TD="";class Lm extends me{constructor(){super(...arguments),this._ref=he(),this._handleClickItem=(e,t)=>{var i,s;(s=(i=this.props).onChange)==null||s.call(i,e,+t.item.key)}}componentDidMount(){setTimeout(()=>{y(this._ref.current).find(".menu-item>.active").scrollIntoView({container:".menu"})},100)}render(e){const{minuteStep:t=5,hour:i,minute:s}=e,r=[],o=[];for(let l=0;l<24;++l)r.push({key:String(l),text:l<10?`0${l}`:l,active:i===l});for(let l=0;l<60;l+=t)o.push({key:String(l),text:l<10?`0${l}`:l,active:s===l});const a="col w-10 max-h-full overflow-y-auto scrollbar-thin scrollbar-hover";return k("div",{className:"time-picker-menu row",ref:this._ref,children:[k(Nt,{className:a,items:r,onClickItem:this._handleClickItem.bind(this,"hour")}),k(Nt,{className:a,items:o,onClickItem:this._handleClickItem.bind(this,"minute")})]})}}const DD="",Rm=n=>{if(!n)return;const e=Ve(`1999-01-01 ${n}`);if(!Number.isNaN(e.getDay()))return e};let da=class extends ht{constructor(){super(...arguments),this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setTime(e.target.value)},this._handleSetTime=(e,t)=>{this.setTime({[e]:String(t)})},this._handleClearBtnClick=()=>{this.setTime("")}}getDefaultState(e){const t=super.getDefaultState(e);return t.value==="now"&&(t.value=lt(new Date,(e||this.props).format)),t}setTime(e,t){if(!t&&(this.props.disabled||this.props.readonly))return;let i="";if(typeof e=="string")i=e;else{const[c,h]=(this.state.value||"00:00").split(":"),{hour:u=+c,minute:p=+h}=e;i=`${u}:${p}`}const s=Rm(i),{onInvalid:r,required:o,defaultValue:a,format:l}=this.props;return this.changeState({value:s?lt(s,l):o?a:""},()=>{!s&&r&&r(i)})}setValue(e,t){if(t){const i=this._trigger.current;i&&(i._skipTriggerChange=e)}return this.setTime(e,!0)}getTime(){const e=Rm(this.state.value);return e?[e.getHours(),e.getMinutes()]:null}_renderTrigger(e,t){const{placeholder:i,icon:s,required:r,disabled:o,readonly:a}=e,{value:l="",open:c}=t,h=`time-picker-${this.id}`;let u;return c&&!r&&l.length?u=k("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:k("span",{className:"close"})}):s&&(s===!0?u=k("i",{class:"i-time"}):u=k($e,{icon:s})),[k("input",{id:h,type:"text",className:"form-control",placeholder:i,value:l,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),u?k("label",{for:h,className:"input-control-suffix",children:u},"icon"):null]}_getTriggerProps(e,t){const i=super._getTriggerProps(e,t);return{...i,className:V(i.className,"time-picker input-control has-suffix-icon")}}_renderPop(e){const[t,i]=this.getTime()||[];return k(Lm,{hour:t,minute:i,minuteStep:e.minuteStep,onChange:this._handleSetTime})}};da.defaultProps={...ht.defaultProps,popWidth:"auto",popMaxHeight:320,minuteStep:5,format:"hh:mm",icon:!0};function QC(n,e,t){return e&&n<e?e:t&&n>t?t:n}function mr(n){if(n==null)return null;if(typeof n=="function"&&(n=n()),typeof n=="string"&&n.startsWith("today")){const e=new Date;n.length>6?n=Df(e,n.substring(5).replace("+","")):n=e}else n=Ve(n);return fc(n)?n:null}const ID="";Ne.addLang({zh_cn:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},zh_tw:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},en:{today:"Today",yearFormat:"{0}",weekNames:["SUN","MON","TUE","WED","THU","FRI","SAT"],monthNames:["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sept.","Oct.","Nov.","Dec."]}});const JC=(n,e,t=0)=>{const i=new Date(n,e-1,1),s=i.getDay(),r=i.getTime()-(7+s-t)%7*Zi;return{days:7*5,startTime:r,firstDay:i.getTime()}},Om=(n,e)=>new Set((Array.isArray(n)?n:[n]).map(t=>lt(t,e)));class ZC extends me{constructor(){super(...arguments),this._handleClickDate=e=>{const{onClickDate:t}=this.props;if(!t)return;const i=y(e.target).closest(".mini-calendar-day").dataset("date");i&&t(i)}}render(e){var ue,J;const t=new Date,{weekStart:i=1,weekNames:s=Ne.getLang("weekNames"),monthNames:r=Ne.getLang("monthNames"),year:o=t.getFullYear(),month:a=t.getMonth()+1,highlights:l=[],selections:c=[],maxDate:h,minDate:u,isAllowDate:p}=e,m=[],v="btn ghost square rounded-full";for(let se=0;se<7;se++){const ye=(i+se)%7;m.push(k("div",{className:V("col mini-calendar-day",{"is-weekend":ye===0||ye===6}),children:k("div",{children:s?s[ye]:ye})},se))}const{startTime:b,days:C,firstDay:S}=JC(o,a,i),D=S+C*Zi;let N=b;const P=[],H="yyyy-MM-dd",q=Om(l,H),Y=Om(c,H),Q=((ue=h?Ve(h):null)==null?void 0:ue.getTime())??Number.MAX_SAFE_INTEGER,Z=((J=u?Ve(u):null)==null?void 0:J.getTime())??0;for(;N<=D;){const se=[];for(let ye=0;ye<7;ye++){const _e=new Date(N);let Ee=(p==null?void 0:p(_e))??!0;typeof Ee=="boolean"&&(Ee={allow:Ee});const Oe=_e.getDate(),ce=lt(_e,H),ee=_e.getDay(),Se=dc(_e,S),Ce=V("col mini-calendar-day",{active:q.has(ce),selected:Y.has(ce),"is-first":Oe===1,"is-in-month":Se,"is-out-month":!Se,"is-today":Wn(_e,t),"is-weekend":ee===0||ee===6,disabled:!Ee.allow||(N>Q||N<Z)&&!Wn(_e,Q)&&!Wn(_e,Z)});se.push(k("div",{className:Ce,"data-date":ce,children:k("button",{type:"button",className:v,onClick:this._handleClickDate,title:Ee.hint,children:Oe===1&&r?r[_e.getMonth()]:_e.getDate()})},ce)),N+=Zi}P.push(k("div",{className:"row",children:se},N))}return k("div",{className:"mini-calendar",children:[k("div",{className:"row",children:m}),P]})}}class Fm extends me{constructor(){super(...arguments);qt(this,Za,he());qt(this,el,t=>{const{onChange:i}=this.props;if(!i)return;const r=y(t.target).closest("[data-value]").dataset("value");r&&(i(+r),t.stopPropagation())})}render(t){const{className:i,max:s,min:r,value:o}=t,a=[],l=new Date().getFullYear();for(let c=r;c<=s;++c)a.push(k(xe,{type:"ghost","data-value":c,active:c===o,className:V(l===c?"is-current":""),onClick:Rt(this,el),children:c},c));return k("div",{className:i,ref:Rt(this,Za),children:a})}}Za=new WeakMap,el=new WeakMap;class ex extends me{constructor(t){super(t);qt(this,tl);qt(this,nl);qt(this,Ur,void 0);qt(this,Wr,void 0);qt(this,Vr,void 0);qt(this,Kr,void 0);qt(this,qr,void 0);qt(this,Gr,void 0);Xt(this,Ur,he()),Xt(this,Wr,r=>{const o=y(r.target).closest("[data-set-date]");o.length&&this.changeDate(o.dataset("set-date"))}),Xt(this,Vr,()=>{const{year:r,month:o}=this.state;o===1?this.setState({year:r-1,month:12}):this.setState({month:o-1})}),Xt(this,Kr,()=>{const{year:r,month:o}=this.state;o===12?this.setState({year:r+1,month:1}):this.setState({month:o+1})}),Xt(this,qr,r=>{this.setState({year:r,select:"day"})}),Xt(this,Gr,r=>{this.setState({month:r,select:"day"})}),this.changeDate=r=>{var o,a;(a=(o=this.props).onChange)==null||a.call(o,r)};const{date:i}=t,s=mr(i)||new Date;this.state={select:"day",year:s.getFullYear(),month:s.getMonth()+1}}_showSelect(t){this.setState(i=>i.select===t?{select:"day"}:{select:t})}render(t,i){const{date:s,yearText:r=Ne.getLang("yearFormat")||"{0}",weekNames:o=Ne.getLang("weekNames"),monthNames:a=Ne.getLang("monthNames"),minDate:l,maxDate:c,weekStart:h}=t,u=mr(s),{year:p,month:m,select:v}=i,b=v==="day",C=l||Ve("1970-1-1"),S=c||Ve("2099-12-31");return k("div",{className:"date-picker-menu row",ref:Rt(this,Ur),onClick:Rt(this,Wr),children:[Sd(this,tl,Pv).call(this,t),k("div",{className:"cell",style:"width: 312px",children:[k("div",{className:"row p-2",children:[k(xe,{type:v==="year"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"year"),children:we(r,p)}),k(xe,{type:v==="month"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"month"),children:a?a[m-1]:m}),k("div",{className:"flex-auto"}),b?k("div",{children:[k(xe,{type:"ghost",size:"sm",square:!0,onClick:Rt(this,Vr),children:k("i",{className:"chevron-left"})}),k(xe,{type:"ghost",size:"sm",square:!0,onClick:Rt(this,Kr),children:k("i",{className:"chevron-right"})})]}):null]}),b?k(ZC,{weekStart:h,weekNames:o,monthNames:a,maxDate:S,minDate:C,year:p,month:m,selections:u||[],onClickDate:this.changeDate,isAllowDate:t.isAllowDate}):null,v==="year"?k(Fm,{className:"date-pick-menu-years overflow-y-auto scrollbar-hover scrollbar-thin",value:p,min:C.getFullYear(),max:S.getFullYear(),onChange:Rt(this,qr)}):v==="month"?k(Fm,{className:"date-pick-menu-month overflow-y-auto scrollbar-hover scrollbar-thin",value:m,min:1,max:12,onChange:Rt(this,Gr)}):null,b?Sd(this,nl,Lv).call(this,t):null]})]})}}Ur=new WeakMap,Wr=new WeakMap,Vr=new WeakMap,Kr=new WeakMap,qr=new WeakMap,Gr=new WeakMap,tl=new WeakSet,Pv=function(t){return Nt.render(t.menu,[],{onClickItem:i=>{const s=i.item.value;typeof s=="string"&&this.changeDate(s)}},this)},nl=new WeakSet,Lv=function(t){let{actions:i}=t;const{todayText:s=Ne.getLang("today"),clearText:r}=t;return i===void 0&&(i=[{text:s,"data-set-date":lt(new Date,"yyyy-MM-dd")}]),Array.isArray(i)&&(i={items:i}),k("div",{className:"date-picker-menu-footer",children:[k(Be,{btnProps:{className:"ghost text-primary"},...i}),r?k(xe,{type:"ghost text-link","data-set-date":"",children:r}):null]})};const $D="";let vs=class extends ht{constructor(){super(...arguments),this.setDate=(e,t)=>{const{disabled:i,readonly:s}=this.props;if(!t&&(i||s))return;const r=this._calcValue(e);return this.changeState({value:r},()=>{this._afterSetDate()})},this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setDate(e.target.value)},this._handleClearBtnClick=()=>{this.setDate("")},this._handleSetDate=e=>{this.setDate(e)}}getDefaultState(e){const t=super.getDefaultState(e);return{...t,value:this._calcValue(t.value)}}getDate(){return this._date}setValue(e,t){if(t){const i=this._trigger.current;i&&(i._skipTriggerChange=e)}return this.setDate(e,!0)}_calcValue(e){const{onInvalid:t,defaultValue:i="",required:s,allowInvalid:r,format:o}=this.props;let a=this._parseDate(e);if(!a&&t){const l=t(e);l&&(a=this._parseDate(l))}return this._date=a,a?lt(a,o):r?e:s?i:""}_getDateRange(e){const{minDate:t,maxDate:i}=this.props;return[mr(typeof t=="function"?t(e):t),mr(typeof i=="function"?i(e):i)]}_parseDate(e){const t=mr(e);return t&&this._isAllowDate(t)?QC(t,...this._getDateRange(e)):null}_afterSetDate(){this.toggle(!1)}_renderTrigger(e,t){const{placeholder:i,icon:s,required:r,disabled:o,readonly:a,display:l}=e,{value:c="",open:h}=t,u=`date-picker-${this.id}`;let p;h&&!r&&c.length?p=k("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:k("span",{className:"close"})}):s&&(s===!0?p=k("i",{class:"i-calendar"}):p=k($e,{icon:s}));const m=h?c:l?l(c,this._date):c;return[k("input",{id:u,type:"text",className:"form-control",placeholder:i,value:m,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),p?k("label",{for:u,className:"input-control-suffix",children:p},"icon"):null]}_getTriggerProps(e,t){const i=super._getTriggerProps(e,t);return{...i,className:V(i.className,"date-picker input-control has-suffix-icon")}}_getPopProps(e,t){const i=super._getPopProps(e,t);return{...i,className:V(i.className,"popup")}}_isAllowDate(e){var i;const t=((i=this.props.isAllowDate)==null?void 0:i.call(this,e))??!0;return t===!0||typeof t=="object"&&t&&t.allow}_renderPop(e,t){const{weekNames:i,monthNames:s,weekStart:r,yearText:o,todayText:a,clearText:l,menu:c,actions:h,required:u,isAllowDate:p}=e,[m,v]=this._getDateRange(t.value);return k(ex,{onChange:this._handleSetDate,date:this._date,weekNames:i,monthNames:s,weekStart:r,yearText:o,todayText:a,clearText:u?"":l,menu:c,actions:h,minDate:m,maxDate:v,isAllowDate:p?this._isAllowDate.bind(this):void 0})}};vs.defaultProps={...ht.defaultProps,popWidth:"auto",popMaxHeight:320,format:"yyyy-MM-dd",icon:!0,limitPopInScreen:!1};let fu=class extends vs{constructor(){super(...arguments),this._handleSetDate=e=>{const t=Ve(e),i=this.getDate()||new Date;t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),this.setDate(lt(t,this.props.format))},this._handleSetTime=(e,t)=>{const i=this.getDate()||new Date;e==="hour"?i.setHours(t):i.setMinutes(t),this.setDate(lt(i,this.props.format))}}getTime(){const e=this.getDate();return e?[e.getHours(),e.getMinutes()]:null}_afterSetDate(){}_renderPop(e,t){const[i,s]=this.getTime()||[];return k("div",{className:"datetime-picker-menu row",children:[super._renderPop(e,t),k("div",{className:"divider"}),k(Lm,{hour:i,minute:s,minuteStep:e.minuteStep,onChange:this._handleSetTime})]})}};fu.defaultProps={...vs.defaultProps,popMaxHeight:310,format:"yyyy-MM-dd hh:mm",minuteStep:5};class fa extends ve{}fa.NAME="TimePicker",fa.Component=da,fa.register();class pa extends ve{}pa.NAME="DatePicker",pa.Component=vs,pa.register();class ma extends ve{}ma.NAME="DatetimePicker",ma.Component=fu,ma.register();const AD="",zm="show",pu="in",tx='[data-dismiss="modal"]',ga="modal-hide",_s=class Ki extends We{constructor(){super(...arguments),this._timer=0,this._handleClick=e=>{const t=e.target,i=t.closest(".modal");!i||i!==this.modalElement||(t.closest(tx)||this.options.backdrop===!0&&t===i)&&(e.preventDefault(),this.hide())}}static get SELECTOR(){return".modal"}get modalElement(){return this.element}get shown(){return this._shown}get dialog(){return this.modalElement.querySelector(".modal-dialog")}get rob(){return this._rob}_observeResize(){var e;if(this.options.responsive&&typeof ResizeObserver<"u"){(e=this._rob)==null||e.disconnect();const{dialog:t}=this;if(t){const i=new ResizeObserver(()=>{if(!this._shown)return;const s=t.clientWidth,r=t.clientHeight,[o,a]=this._lastDialogSize||[];(o!==s||a!==r)&&(this._lastDialogSize=[s,r],this.layout())});i.observe(t),this._rob=i}}}_cancelObserver(){var e;(e=this._rob)==null||e.disconnect(),this._rob=void 0}afterInit(){this.on("click",this._handleClick),this.options.show&&(this.show(),this._observeResize()),this.on("hidden",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();const i=e.target.closest(".modal")===t;i&&this._cancelObserver(),i&&!Ki.getAll().some(s=>s.shown)&&y("html").enableScroll()}),this.on("show",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();e.target.closest(".modal")===t&&(this._observeResize(),y("html").disableScroll())}),this.shown&&y("html").disableScroll()}destroy(){super.destroy(),this._cancelObserver()}show(e){var c;const{modalElement:t}=this,i=y(t);if(this._shown&&i.hasClass(pu))return i.removeClass(ga).css("z-index",`${Ki.zIndex++}`),!1;this._shown=!0,this.setOptions(e);const{animation:s,backdrop:r,className:o,style:a}=this.options;i.setClass({"modal-trans":s,"modal-no-backdrop":!r,[ga]:!1},zm,o).css({zIndex:`${Ki.zIndex++}`,...a});const l=this.constructor;return l.hideOthers&&this.options.hideOthers!==!1&&l.getAll().forEach(h=>{h!==this&&h.shown&&!i.closest(h.modalElement).length&&h.hideForOther()}),this.options.closeOthers&&l.getAll().forEach(h=>{h!==this&&!i.closest(h.modalElement).length&&h.hide()}),this.layout(),(c=this.options.onShow)==null||c.call(this),this.emit("show"),this._setTimer(()=>{i.addClass(pu),this._setTimer(()=>{var h,u;(h=i.find("[autofocus]")[0])==null||h.focus(),(u=this.options.onShown)==null||u.call(this),this.emit("shown")})},50),!0}hideForOther(){y(this.modalElement).addClass(ga)}hide(){var t;if(!this._shown)return!1;this._shown=!1,y(this.modalElement).removeClass(pu),(t=this.options.onHide)==null||t.call(this),this.emit("hide"),this._setTimer(()=>{var i;y(this.modalElement).removeClass(zm),(i=this.options.onHidden)==null||i.call(this),this.emit("hidden")});const e=this.constructor;return e.hideOthers&&this.options.hideOthers!==!1&&e.getAll().forEach(i=>{i.shown&&i!==this&&y(i.modalElement).removeClass(ga)}),!0}layout(e,t){if(!this._shown)return;const{dialog:i}=this;if(!i)return;const s=y(i);if(t=t??this.options.size,t){s.removeAttr("data-size");const h={width:"",height:""};typeof t=="object"?(h.width=t.width,h.height=t.height):typeof t=="string"&&["md","sm","lg","full"].includes(t)?s.attr("data-size",t):t&&(h.width=t),s.css(h)}e=e??this.options.position??"fit";const r=i.clientWidth,o=i.clientHeight;this._lastDialogSize=[r,o],typeof e=="function"&&(e=e({width:r,height:o}));const a={left:null,bottom:null,right:null};let l=null,c="center";typeof e=="number"?(c="flex-start",l=e):typeof e=="object"&&e?(Object.assign(a,e),l=a.top??l,c=a.alignSelf??"flex-start"):e==="fit"?(c="flex-start",l=`${Math.max(0,Math.floor((window.innerHeight-o)/3))}px`):e==="bottom"?c="flex-end":e==="top"?c="flex-start":e!=="center"&&typeof e=="string"&&(c="flex-start",l=e),a.top=l,a.alignSelf=c,s.css(a),y(this.modalElement).css("justifyContent",a.left?"flex-start":"center")}_setTimer(e,t){this._timer&&(clearTimeout(this._timer),this._timer=0),e&&(this.options.animation?this._timer=window.setTimeout(e,t??this.options.transTime):e())}static last(e){return Ki.query(e,void 0,t=>t.shown)}static hide(e){var t;(t=Ki.last(e))==null||t.hide()}static show(e){var t;(t=Ki.query(e,void 0,i=>!i.shown))==null||t.show()}};_s.NAME="Modal",_s.MULTI_INSTANCE=!0,_s.DEFAULT={position:"fit",show:!0,keyboard:!0,animation:!0,backdrop:!0,responsive:!0,transTime:300},_s.hideOthers=!0,_s.zIndex=1500;let bs=_s;y(window).on(`resize.${bs.NAMESPACE}`,()=>{bs.getAll().forEach(n=>{const e=n;e.shown&&e.options.responsive&&e.layout()})});class jm extends me{constructor(e){super(e),this._ref=he(),this.state={showed:!e.waitShowEvent}}componentDidMount(){const{waitShowEvent:e,afterRender:t}=this.props;t==null||t.call(this,{firstRender:!0}),e&&y(this._ref.current).on(e,()=>{this.setState({showed:!0})})}componentDidUpdate(){var e;(e=this.props.afterRender)==null||e.call(this,{firstRender:!1})}componentWillUnmount(){var e;(e=this.props.beforeDestroy)==null||e.call(this)}renderHeader(){const{header:e,headerClass:t,title:i}=this.props;return $.isValidElement(e)?e:e===!1||!i?null:e?k(ge,{className:V("modal-header",t),content:e}):k("div",{className:V("modal-header",t),children:k("div",{className:"modal-title",children:i})})}renderActions(){const{actions:e,closeBtn:t}=this.props;return!t&&!e?null:$.isValidElement(e)?e:k("div",{className:"modal-actions",children:[e?k(Be,{...e}):null,t?k("button",{type:"button",class:"btn square ghost","data-dismiss":"modal",children:k("span",{class:"close"})}):null]})}renderBody(){const{body:e,bodyClass:t}=this.props;return e?$.isValidElement(e)?e:k(ge,{className:V("modal-body",t),content:e}):null}renderFooter(){const{footer:e,footerClass:t,footerActions:i}=this.props;return $.isValidElement(e)?e:e===!1||!i?null:e?k(ge,{className:V("modal-footer",t),content:e}):k("div",{className:V("modal-footer",t),children:i?k(Be,{...i}):null})}render(){const{className:e,style:t,contentClass:i,children:s,waitShowEvent:r}=this.props,o=r&&!this.state.showed;return k("div",{ref:r?this._ref:void 0,className:V("modal-dialog",e,o?"loading":""),style:t,children:[k("div",{className:V("modal-content",i),children:[this.renderHeader(),this.renderActions(),this.renderBody(),s,this.renderFooter()]}),o?k("div",{class:"load-indicator loading"}):null]})}}jm.defaultProps={closeBtn:!0};class mu extends me{constructor(){super(...arguments),this._ref=he(),this._height=Je(),this._timer=0,this._handleError=e=>{e.message.includes("ResizeObserver loop completed with undelivered notifications")&&this.componentWillUnmount()},this._handleIframeLoad=()=>{const e=this.iframeDoc;if(!e)return;const{iframeBodyClass:t,watchHeight:i}=this.props;i&&this._watchIframeHeight(),t&&e.body.classList.add(t),y(this._ref.current).trigger("modal-iframe-loaded")}}get iframeDoc(){var e,t;return(t=(e=this._ref.current)==null?void 0:e.contentWindow)==null?void 0:t.document}componentDidMount(){this.props.watchHeight&&this._watchIframeHeight(),window.addEventListener("error",this._handleError)}componentWillUnmount(){var e;window.removeEventListener("error",this._handleError),(e=this._rob)==null||e.disconnect(),this._timer&&clearTimeout(this._timer)}_watchIframeHeight(){const e=this.iframeDoc;if(!e)return;let t=this._rob;t==null||t.disconnect(),t=new ResizeObserver(()=>{this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{const i=e.body,s=e.documentElement,r=Math.ceil(Math.max(i.scrollHeight,i.offsetHeight,s.offsetHeight));r&&r!==this._height.value&&(this._height.value=r),this._timer=0},10)}),t.observe(e.body),this._rob=t}render(){return k("iframe",{className:"modal-iframe",style:this._height.value?`height: ${this._height.value}px;`:void 0,src:this.props.url,ref:this._ref,onLoad:this._handleIframeLoad})}}mu.defaultProps={watchHeight:!0};var gu=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},tn=(n,e,t)=>(gu(n,e,"read from private field"),t?t.call(n):e.get(n)),gr=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},ws=(n,e,t,i)=>(gu(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),ya=(n,e,t)=>(gu(n,e,"access private method"),t),En,yr,Nn,va,yu,_a,vu;function nx(n,e){const{custom:t,title:i,content:s,closeBtn:r}=e;return{body:s,closeBtn:r,title:i,...typeof t=="function"?t():t}}async function ix(n,e){const{dataType:t="html",url:i,request:s,custom:r,title:o,replace:a=!0,executeScript:l=!0}=e,c=await y.ajax({url:i,headers:{"X-ZUI-Modal":"true"},...s});if(t!=="html")try{const h=JSON.parse(c);return{title:o,...r,...h}}catch{}return a!==!1&&t==="html"?[c]:{title:o,...r,body:t==="html"?k(Dn,{className:"modal-body",html:c,executeScript:l}):c}}async function sx(n,e){const{url:t,custom:i,title:s,size:r}=e,o=typeof r=="object"&&typeof r.height=="number";return{title:s,...i,waitShowEvent:"modal-iframe-loaded",body:k(mu,{url:t,watchHeight:!o})}}const rx={custom:nx,ajax:ix,iframe:sx},Bm="loading",Hm=class qi extends bs{constructor(){super(...arguments),gr(this,va),gr(this,_a),gr(this,En,void 0),gr(this,yr,void 0),gr(this,Nn,void 0),this._builded=!1}get id(){return tn(this,yr)}get loading(){var e;return(e=tn(this,En))==null?void 0:e.classList.contains(Bm)}get shown(){var e;return!!((e=tn(this,En))!=null&&e.classList.contains("show"))}get modalElement(){let e=tn(this,En);if(!e){const{options:t}=this;let i=tn(this,yr);i||(i=t.id||`modal-${Tt()}`,ws(this,yr,i));const{$element:s}=this;if(e=s.find(`#${i}`)[0],e)y(e).data(this.constructor.KEY,this);else{const r=this.key;e=y("<div>").attr({id:i,"data-key":r}).data(this.constructor.KEY,this).css(t.style||{}).setClass("modal modal-async load-indicator",t.className).appendTo(s)[0]}ws(this,En,e)}return e}get $emitter(){const e=tn(this,En);return e?y(e):this.$element}afterInit(){super.afterInit(),this.options.destroyOnHide&&this.options.type!=="static"&&this.on("hidden",e=>{y(e.target).data("key")===this.key&&this.destroy()})}show(e){return super.show(e)?(this.buildDialog(),!0):!1}destroy(){super.destroy();const e=tn(this,En);e&&(y(e).removeData(this.constructor.KEY).remove(),ws(this,En,void 0))}render(e){return super.render(e),this.buildDialog()}async buildDialog(){if(this.loading)return!1;tn(this,Nn)&&clearTimeout(tn(this,Nn));const{modalElement:e,options:t}=this,i=y(e),{type:s,loadTimeout:r,loadingClass:o=Bm,loadingText:a=null,cache:l}=t;if(!s||s==="static")return!0;if(l&&this._builded)return this.layout(),!0;const c=rx[s];if(!c)return console.warn(`Modal: Cannot build modal with type "${s}"`),!1;i.attr("data-loading",a).addClass(o),r&&ws(this,Nn,window.setTimeout(()=>{ws(this,Nn,0),ya(this,_a,vu).call(this,this.options.timeoutTip)},r));const h=await c.call(this,e,t);return this._destroyed?!1:(h===!1?await ya(this,_a,vu).call(this,this.options.failedTip):h&&typeof h=="object"&&await ya(this,va,yu).call(this,h),tn(this,Nn)&&(clearTimeout(tn(this,Nn)),ws(this,Nn,0)),this.layout(),this._builded=!0,await bi(100),i.removeClass(o),!0)}static isValid(e){return!y.isDetached(e.modalElement)}static open(e){return new Promise(t=>{const{container:i=document.body,ref:s,...r}=e,o={show:!0,...r};!o.type&&o.url&&(o.type="ajax"),!o.type&&e.id&&(o.type="static"),o.key===void 0&&(o.key=o.id);const a=qi.ensure(i,o);s&&(s.current=a);const l=`${qi.NAMESPACE}.open${Tt()}`;a.on(`hidden${l}`,()=>{a.off(l),t(a)}),a.show()})}static async alert(e){typeof e=="string"&&(e={message:e});const{type:t,message:i,icon:s,iconClass:r="icon-lg muted",actions:o="confirm",onClickAction:a,custom:l,key:c="__alert",...h}=e,u=(typeof l=="function"?l():l)||{};let p=k(ge,{content:i});s?p=k("div",{className:V("modal-body row gap-4 items-center",u.bodyClass),children:[k("div",{className:`icon ${s} ${r}`}),p]}):p=k("div",{className:V("modal-body",u.bodyClass),children:p});const m=[];(Array.isArray(o)?o:o?[o]:[]).forEach(C=>{C={...typeof C=="string"?{key:C}:C},typeof C.key=="string"&&(C.text||(C.text=Ne.getLang(C.key,C.key)),C.btnType||(C.btnType=`btn-wide ${C.key==="confirm"?"primary":"btn-default"}`)),C&&m.push(C)},[]);let v;const b=m.length?{gap:4,items:m,onClickItem:({item:C,event:S})=>{const D=qi.query(S.target);if(!D||D.key!==c)return;v=C.key,(a==null?void 0:a(C,D))!==!1&&D&&D.hide()}}:void 0;return await qi.open({key:c,type:"custom",size:400,className:"modal-alert",content:p,modal:!0,backdrop:"static",hideOthers:!1,custom:{footerActions:b,...u},...h}),v}static async confirm(e){typeof e=="string"&&(e={message:e});const{onClickAction:t,onResult:i,...s}=e;return await qi.alert({actions:["confirm","cancel"],onClickAction:(o,a)=>{i==null||i(o.key==="confirm",a),t==null||t(o,a)},...s})==="confirm"}static async prompt(e){typeof e=="string"&&(e={message:e});const{defaultValue:t="",placeholder:i,onResult:s,onShown:r,message:o,content:a,bodyClass:l,custom:c,multiline:h,...u}=e;let p=t,m=!1;const v=D=>{p=D.target.value},b=he(),C=D=>{var N,P;D.key==="Enter"?(m=!0,D.preventDefault(),(N=b.current)==null||N.hide()):D.key==="Escape"&&((P=b.current)==null||P.hide())};return await qi.confirm({...u,custom:{closeBtn:!1,...c},message:o,ref:b,content:k("div",{className:V("modal-body",l),children:[k(ge,{content:o}),h?k("textarea",{className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:i,defaultValue:t,onChange:v,onKeyDown:C,rows:10}):k("input",{type:"text",className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:i,defaultValue:t,onChange:v,onKeyDown:C}),a]})})||m?p:null}};En=new WeakMap,yr=new WeakMap,Nn=new WeakMap,va=new WeakSet,yu=function(n){return new Promise(e=>{if(Array.isArray(n))return y(this.modalElement).html(n[0]).zuiInit(),this.layout(),this._observeResize(),e();const{afterRender:t,...i}=n;n={afterRender:s=>{this.layout(),t==null||t(s),this._observeResize(),e()},...i},Ci(k(jm,{...n}),this.modalElement)})},_a=new WeakSet,vu=function(n){if(n)return ya(this,va,yu).call(this,{body:k("div",{className:"modal-load-failed",children:n})})},Hm.DEFAULT={...bs.DEFAULT,loadTimeout:1e4,destroyOnHide:!0};let Re=Hm;Re.register();class Cs extends We{get modal(){return this._modal}get container(){const{container:e}=this.options;return typeof e=="string"?document.querySelector(e):e instanceof HTMLElement?e:document.body}show(){var e;return(e=this._initModal())==null?void 0:e.show()}hide(){var e;return(e=this._modal)==null?void 0:e.hide()}_getBuilderOptions(){const{container:e,...t}=this.options,i=t,s=this.$element.attr("href")||"";return i.type||(i.target||s[0]==="#"?i.type="static":i.type=i.type||(i.url||s?"ajax":"custom")),!i.url&&(i.type==="iframe"||i.type==="ajax")&&s[0]!=="#"&&(i.url=s),i.key===void 0&&(i.key=`${this._key}`),i}_initModal(){const e=this._getBuilderOptions();let t=this._modal;if(t)return t.setOptions(e),t;if(e.type==="static"){const i=this._getStaticModalElement();if(!i)return;t=bs.ensure(i,e)}else t=Re.ensure(this.container,e);return this._modal=t,t.on("destroyed",()=>{this._modal=void 0}),t}_getStaticModalElement(){let e=this.options.target;if(!e){const{$element:t}=this;if(t.is("a")){const i=t.attr("href");i!=null&&i.startsWith("#")&&(e=i)}}return this.container.querySelector(e||".modal")}}Cs.NAME="ModalTrigger",Cs.toggle={name:"modal",skip:"[disabled],.disabled,.open-in-parent",convertHref:!0,onGet(n){return Cs.get(n)},onCreate(n,e,t){return new Cs(n,t)}},Cs.register();const ox={zh_cn:{selectFile:"选择文件",fileSelectTip:"（不超过 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超过了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超过了总大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超过了数量 {maxFileCount} 的限制。"},zh_tw:{selectFile:"選擇文件",fileSelectTip:"（不超過 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超過了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超過了總大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超過了數量 {maxFileCount} 的限制。"},en:{selectFile:"Select File",fileSelectTip:"(Not exceeding {maxFileSize})",removeFile:"Remove File",renameFile:"Rename",duplicatedTip:"File “{name}” ({size}) already exists.",exceededSizeTip:"File “{name}” ({size}) exceeds the limit of {maxFileSize}.",exceededTotalSizeTip:"File “{name}” ({size}) exceeds the total size limit of {totalFileSize}.",exceededCountTip:"File “{name}” ({size}) exceeds the limit of {maxFileCount}."}};let Jn=class extends Ke{constructor(e){if(e.totalFileSize)if(e.maxFileSize){const{maxFileSize:t,totalFileSize:i}=e,s=typeof t=="number"?t:Sn(t),r=typeof i=="number"?i:Sn(i);e.maxFileSize=s>r?i:t}else e.maxFileSize=e.totalFileSize;e.maxFileSize||(e.maxFileSize="100MB"),super(e),this._input=he(),this._file=he(),this._id=`file-selector-input-${Tt()}`,this._data=new DataTransfer,this.stopRenameFile=()=>{const{renaming:t,newName:i}=this.state;this.cancelRenameFile(),!(!t||!i)&&this.renameFile(t,i)},this.cancelRenameFile=()=>{this.setState({renaming:""})},this._handleChange=t=>{const i=t.target;i.files&&(this.selectFiles(i.files),this.setState({inputKey:Tt()}))},this._handleDragOver=t=>{t.preventDefault(),this.state.dragging||this.setState({dragging:!0})},this._handleDragLeave=t=>{t.preventDefault(),this.setState({dragging:!1})},this._handleDrop=t=>{var s;this._handleDragLeave(t);const i=this.constructor.filterFiles(((s=t.dataTransfer)==null?void 0:s.files)||[],this.props.accept);i.length&&(this.selectFiles(i),this.setState({inputKey:Tt()}))},this._handleRenameChange=t=>{this.setState({newName:t.target.value})},this._handleClick=t=>{if(this.props.disabled)return;const s=y(t.target).closest("[data-remove-file],[data-rename-file]");if(!s.length)return;const r=s.data();r.renameFile?this.startRenameFile(String(r.renameFile)):r.removeFile&&this.removeFile(String(r.removeFile))},this.state={files:(e.defaultFiles||[]).map(t=>this.constructor.getInfo(t)),inputKey:0}}get size(){return this.state.files.reduce((e,t)=>e+t.size,0)}get count(){return this.state.files.length}get multiple(){const{multiple:e,maxFileCount:t,name:i=""}=this.props;return!!(t!==1&&(e??i.endsWith("[]")))}get info(){const{maxFileSize:e=0,maxFileCount:t=Number.MAX_SAFE_INTEGER}=this.props;return{size:vt(this.size,1),maxFileSize:vt(typeof e=="string"?Sn(e):e,1),maxFileCount:t,count:this.count}}get files(){return this._data.files}componentDidMount(){const e=this.state.files.reduce((t,i)=>(i.file&&t.push(i.file),t),[]);e.length&&(e.forEach(t=>this._data.items.add(t)),this._syncFiles())}getFile(e){return this.state.files.find(t=>t.id===e)}getFileByName(e){return this.state.files.find(t=>t.name===e)}select(){var e;(e=this._input.current)==null||e.click()}async selectFiles(e){var t;if(((t=this.props.onSelect)==null?void 0:t.call(this,e))!==!1){this._skipAddMore=!1;for(let i=0;i<e.length&&(await this.addFile(e[i]),!this._skipAddMore);i++);}}async _checkDuplicated(e){const{allowSameName:t,onDuplicated:i,duplicatedTip:s=this.i18n("duplicatedTip")}=this.props,{name:r}=e,o=t?this.getFile(e.id):this.getFileByName(r);return o?((i==null?void 0:i.call(this,r,e,o))===!0||s&&await this._showAlert(s,{name:r,size:vt(e.size,1)}),!0):!1}async _checkExceededSize(e){const{maxFileSize:t,onExceededSize:i,exceededSizeTip:s=this.i18n("exceededSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?Sn(t):t;return e.size<=r?!1:((i==null?void 0:i.call(this,r,e))===!0||s&&await this._showAlert(s,{name:e.name,size:vt(e.size,1),maxFileSize:t}),!0)}async _checkTotalSize(e){const{totalFileSize:t,onExceededTotalSize:i,exceededTotalSizeTip:s=this.i18n("exceededTotalSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?Sn(t):t,o=e.size+this.size;return o<=r?!1:((i==null?void 0:i.call(this,r,e))===!0||s&&await this._showAlert(s,{name:e.name,size:vt(e.size,1),totalSize:vt(o,1)}),!0)}async _checkExceededCount(e){const{maxFileCount:t=0,onExceededCount:i,exceededCountTip:s=this.i18n("exceededCountTip")}=this.props;if(!t)return!1;const r=this.count+1;return r<=t?!1:((i==null?void 0:i.call(this,t,e))===!0||s&&await this._showAlert(s,{name:e.name,size:vt(e.size,1),exceededCount:r}),!0)}async addFile(e){const{onAdd:t,disabled:i}=this.props;if(i)return!1;const s=this.constructor.getInfo(e);return await this._checkExceededCount(s)?(this._skipAddMore=!0,!1):await this._checkDuplicated(s)?!1:await this._checkExceededSize(s)?(this._skipAddMore=!0,!1):await this._checkTotalSize(s)?(this._skipAddMore=!0,!1):t&&t.call(this,s)===!1?!1:(this._data.items.add(e),this._syncFiles(!0),await this.changeState(c=>({files:[...c.files,s]})),!0)}startRenameFile(e){this.setState({renaming:e,newName:void 0},()=>{const t=y(this._file.current).closest(".file-selector").find(".file-selector-rename-input")[0];t&&(t.select(),t.focus())})}async renameFile(e,t){const i=this.getFile(e);if(!i||i.name===t)return;const{onRename:s}=this.props;if(s&&await s.call(this,t,i.name,i)===!1)return;const r=i.file,{files:o,renamedFiles:a={}}=this.state;if(r){const c=new File([r],t,{type:r.type,lastModified:r.lastModified}),h=Array.from(this._data.files).indexOf(r);h>=0&&this._data.items.remove(h),this._data.items.add(c),this._syncFiles(!0),i.file=c}else a[i.id]=t;i.name=t,i.ext=this.constructor.getExt(t);const l=o.indexOf(i);l>=0?o.splice(l,1,i):o.push(i),this.setState({files:[...o],renamedFiles:{...a}})}async removeFile(e){const t=this.getFile(e);if(!t)return;const{onRemove:i,removeConfirm:s}=this.props;if(s){let c=s;if(typeof c=="string"&&(c={message:c}),typeof c.message=="string"&&(c.message=we(c.message,{name:t.name,size:vt(t.size,1)})),!await Re.confirm(c))return}if(i&&await i.call(this,t)===!1)return;if(t.file){const c=Array.from(this._data.files).indexOf(t.file);c>=0&&this._data.items.remove(c)}const{files:r,deletedFiles:o=[],renamedFiles:a={}}=this.state,l=r.indexOf(t);l>=0&&(!t.file&&!o.includes(t.id)&&(delete a[t.id],o.push(t.id)),r.splice(l,1),this.setState({files:[...r],deletedFiles:[...o],renamedFiles:{...a}}),this._syncFiles(!0))}_syncFiles(e=!1){const t=this._data.files,i=this._file.current;i.files=t,e&&y(i).trigger("change",{files:t})}_showAlert(e,t){return typeof e=="string"&&(e={message:e}),typeof e.message=="string"&&(e.message=we(e.message,{...this.info,...t})),Re.alert(e)}_getTip(e){return typeof e=="string"?we(e,this.info):e}_renderInput(e){return k("input",{id:this._id,multiple:this.multiple,accept:e.accept,style:"display:none",type:"file",ref:this._input,onChange:this._handleChange},`input${this.state.inputKey}`)}_getDraggableProps(){const e={};return this.props.draggable&&!this.props.disabled&&(e.onDragOver=this._handleDragOver,e.onDragLeave=this._handleDragLeave,e.onDrop=this._handleDrop),e}_renderUpload(e){const{mode:t,disabled:i,tip:s=this.i18n("fileSelectTip"),uploadBtn:r}=e,o=ke({component:"label",attrs:{for:i?void 0:this._id},disabled:i,text:this.i18n("selectFile")},typeof r=="object"?r:typeof r=="string"?{text:r}:{}),a=k("div",{className:"file-selector-tip",children:k(ge,{content:this._getTip(s),generatorThis:this,generatorArgs:[this.state]})}),l=t==="grid",c=l?{}:this._getDraggableProps();return l||t==="box"?k(xe,{...o,...c,className:V(l?"file-selector-grid-btn":"file-selector-box",o.className),children:a},"upload"):k("div",{className:"file-selector-btn",...c,children:[k(xe,{rounded:"full",size:"sm",...o}),a]},"upload")}_renderForForm(e){const{name:t,accept:i,onChange:s,deleteName:r,renameName:o}=e,{deletedFiles:a,renamedFiles:l}=this.state,c=[k("input",{ref:this._file,type:"file",name:t,multiple:this.multiple,accept:i,style:"display:none",onChange:s},"form")];return r&&a&&c.push(...a.map(h=>k("input",{type:"hidden",name:`${r}[${h}]`,value:h},`delete:${h}`))),o&&l&&c.push(...Object.entries(l).map(([h,u])=>k("input",{type:"hidden",name:`${o}[${h}]`,value:u},`rename:${h}`))),c}_getIcon(e){let{fileIcons:t}=this.props;if(t)return typeof t=="string"&&(t={default:t}),t[e.ext]??t.default}_getThumbnail(e){if((e.file||e.url)&&this.props.thumbnail&&this.constructor.isImage(e))return e.url||URL.createObjectURL(e.file)}_getAvatar(e){const t=this._getThumbnail(e);let i;if(t)i={src:t};else{const s=this._getIcon(e);s&&(i={icon:s})}return i&&{size:this.props.mode==="grid"?void 0:"sm",...i}}_getFileActions(e){if(this.props.disabled)return;let{removeBtn:t,renameBtn:i}=this.props;typeof t=="function"&&(t=t.call(this,e)),typeof t=="string"?t={text:t}:t===!0&&(t={hint:this.i18n("removeFile"),icon:"trash"}),typeof i=="function"&&(i=i.call(this,e)),typeof i=="string"?i={text:i}:i===!0&&(i={hint:this.i18n("renameFile"),icon:"edit"});const s=[];return i&&s.push({"data-rename-file":e.id,...i}),t&&s.push({"data-remove-file":e.id,...t}),s}_renderFile(e){let{itemProps:t}=this.props;return t=ke({className:this.props.mode==="grid"?"file-selector-grid-item":"file-selector-item",multiline:!1,title:e.name,subtitle:vt(e.size,1),avatar:this._getAvatar(e),actions:this._getFileActions(e),"z-id":e.id},typeof t=="function"?t.call(this,e):t),k(hn,{...t},e.id)}_renderFileRename(e){let{itemProps:t}=this.props;if(typeof t=="function")t=t.call(this,e);else{const{newName:i=e.name}=this.state,s=this.props.mode==="grid",r=k("div",{className:"file-selector-rename-text",children:[k("div",{className:"form-control size-sm",children:i}),k("input",{type:"text",defaultValue:e.name,className:"form-control size-sm select-all file-selector-rename-input",autofocus:!0,onBlur:s?this.stopRenameFile:void 0,onChange:this._handleRenameChange,onInput:this._handleRenameChange})]});t=ke({className:`${s?"file-selector-grid-item":"file-selector-item"} is-renaming`,multiline:!1,avatar:this._getAvatar(e),"z-id":e.id,contentClass:"file-selector-rename",content:s?r:[r,k(xe,{icon:"check",text:this.i18n("confirm"),type:"primary-pale",size:"sm",onClick:this.stopRenameFile}),k(xe,{icon:"close",text:this.i18n("cancel"),type:"gray-pale",size:"sm",onClick:this.cancelRenameFile})]},t)}return k(hn,{...t},e.id)}_renderList(e){const{files:t,renaming:i}=this.state;return k("div",{className:`file-selector-list${t.length?"":" is-empty"}`,onClick:this._handleClick,children:t.map(s=>s.id===i?this._renderFileRename(s):this._renderFile(s))},"list")}_renderGrid(e){const t=this._getDraggableProps(),{gridWidth:i=120,gridHeight:s=148,gridGap:r=12}=e,o={"--file-selector-grid-width":Ge(i),"--file-selector-grid-height":Ge(s),"--file-selector-grid-gap":Ge(r)},{files:a,renaming:l}=this.state;return k("div",{className:"file-selector-grid",style:o,onClick:this._handleClick,...t,children:[a.map(c=>c.id===l?this._renderFileRename(c):this._renderFile(c)),this._renderUpload(e)]},"grid")}_getClassName(e){return["file-selector",`is-mode-${e.mode}`,e.className,this.state.dragging?"is-dragging":""]}_getChildren(e){const t=e.mode==="grid";return[t?null:this._renderUpload(e),t?this._renderGrid(e):this._renderList(e),this._renderInput(e),this._renderForForm(e)]}static getExt(e){return(e.split(".").pop()||"").toLowerCase()}static getInfo(e){const{name:t,size:i,type:s}=e;if(e instanceof File)return{name:t,size:i,type:s,file:e,id:[t,i].join(":"),ext:this.getExt(t)};const r=typeof i=="string"?Sn(i):i;return{name:t,size:r,id:e.id?String(e.id):[t,r].join(":"),type:s??"",ext:this.getExt(t),file:e.file,url:e.url}}static isAccept(e,t){return!t||!t.length?!0:(Array.isArray(t)?t:t.split(",")).some(s=>e.type&&s===e.type?!0:s.startsWith(".")?e.name.endsWith(s):s.endsWith("/*")?e.type.startsWith(s.slice(0,-1)):!1)}static isImage(e){return this.isAccept(e,this.imageAccepts)}static filterFiles(e,t){if(!t||!t.length)return e;e instanceof FileList&&(e=Array.from(e));const i=t.split(",");return e.filter(s=>this.isAccept(s,i))}};Jn.defaultProps={mode:"button",fileIcons:"file",renameBtn:!0,removeBtn:!0,draggable:!0,thumbnail:!0,maxFileCount:0},Jn.i18n=ox,Jn.imageAccepts="image/*,.png,.jpg,.jpeg,.gif";let _u=class extends Jn{};_u.defaultProps={...Jn.defaultProps,mode:"grid",accept:Jn.imageAccepts};const ax=Object.freeze(Object.defineProperty({__proto__:null,FileSelector:Jn,ImageSelector:_u},Symbol.toStringTag,{value:"Module"}));class ba extends ve{}ba.NAME="FileSelector",ba.Component=Jn,ba.replace=!0;class wa extends ve{}wa.NAME="ImageSelector",wa.Component=_u,wa.replace=!0,tt(ax);const ED="",bu=class Rv extends gt{_getClassName(e){const{type:t,stacked:i}=e;return[super._getClassName(e),t?`nav-${t}`:"",i?"nav-stacked":""]}static render(e,t,i,s){let r=typeof e=="function"?e.call(s??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),i&&(r=ke(i,r)),w(Rv,{...r})}};bu.NAME="nav",bu.defaultItemProps={component:"li",innerComponent:"a"};let Um=bu;const lx=Object.freeze(Object.defineProperty({__proto__:null,Nav:Um},Symbol.toStringTag,{value:"Module"}));class wu extends ve{}wu.NAME="Nav",wu.Component=Um,tt(lx);const ND="",MD="",PD="",LD="",RD="",OD="",FD="",zD="",jD="",BD="",HD="",UD="",WD="";function vr(n,e){const t=n.pageTotal||Math.ceil(n.recTotal/n.recPerPage);return typeof e=="string"&&(e==="first"?e=1:e==="last"?e=t:e==="prev"?e=n.page-1:e==="next"?e=n.page+1:e==="current"?e=n.page:e=Number.parseInt(e,10)),e=e!==void 0?Math.max(1,Math.min(e<0?t+e:e,t)):n.page,{...n,pageTotal:t,page:e}}function Wm({key:n,type:e,btnType:t,page:i,format:s,pagerInfo:r,linkCreator:o,...a}){const l=vr(r,i);return a.text===void 0&&!a.icon&&s&&(a.text=typeof s=="function"?s(l):we(s,l)),a.url===void 0&&o&&(a.url=typeof o=="function"?o(l):we(o,l)),a.disabled===void 0&&(a.disabled=i!==void 0&&l.page===r.page),k(xe,{type:t,"z-go-to-page":l.page,...a})}function Vm({key:n,type:e,page:t,text:i="",pagerInfo:s,children:r,...o}){const a=vr(s,t);return i=typeof i=="function"?i(a):we(i,a),k(Ke,{...o,children:[r,i]})}function cx({type:n,btnType:e,count:t=12,pagerInfo:i,linkCreator:s,...r}){if(!i.pageTotal)return;const o={...r,square:!0},a=()=>(o.text="",o.icon="icon-ellipsis-h",o.disabled=!0,k(xe,{type:e,...o})),l=(h,u)=>{const p=[];for(let m=h;m<=u;m++){o.text=m,delete o.icon,o.disabled=!1;const v=vr(i,m);s&&(o.url=typeof s=="function"?s(v):we(s,v)),p.push(k(xe,{type:e,...o}))}return p};let c=[];return c=[...l(1,1)],i.pageTotal<=1||(i.pageTotal<=t?c=[...c,...l(2,i.pageTotal)]:i.page<t-2?c=[...c,...l(2,t-2),a(),...l(i.pageTotal,i.pageTotal)]:i.page>i.pageTotal-t+3?c=[...c,a(),...l(i.pageTotal-t+3,i.pageTotal)]:c=[...c,a(),...l(i.page-Math.ceil((t-4)/2),i.page+Math.floor((t-4)/2)),a(),...l(i.pageTotal,i.pageTotal)]),c}const VD="";let ux=class extends me{render(e){const{id:t,popup:i,title:s,content:r,style:o,className:a,closeBtn:l,arrow:c,headingClass:h,titleClass:u,contentClass:p,arrowStyle:m,onlyInner:v,footer:b,footerClass:C}=e;let S=k(ge,{content:r},"content");(p||s)&&(S=k("div",{className:p,children:S},"content"));let D=k(ge,{content:b},"footer");(C||s)&&(D=k("div",{className:C,children:D},"footer"));const N=[],P=l?k("button",{className:"btn ghost square size-sm btn-close","data-dismiss":"popover",children:k("span",{className:"close"})}):null;return s?N.push(k("div",{className:h,children:[s?k(ge,{className:u,content:s}):null,P]},"heading")):N.push(P),N.push(S,D),c&&N.push(k("div",{className:typeof c=="string"?c:"arrow",style:m},"arrow")),v?N:k("div",{id:t,className:V("popover",a,{popup:i,"has-heading":s}),style:o,children:N})}};class Ca extends ve{}Ca.NAME="PopoverPanel",Ca.Component=ux;const Km="show",qm="in",xs=class Ov extends We{constructor(){super(...arguments),this._getClickBounding=()=>{const e=this._triggerEvent;return{x:e.clientX,y:e.clientY,left:e.clientX,top:e.clientY,width:0,height:0,bottom:e.clientY,right:e.clientX}}}get shown(){return this._shown}get id(){return this._id}get zIndex(){return this._zIndex}get trigger(){return this._triggerElement}get target(){return this._targetElement}afterInit(){const{trigger:e,id:t,triggerEvent:i}=this.options;this._triggerEvent=i,this._id=t||`popover_${this.gid}`;const s=this.getTriggerElement();if(s instanceof HTMLElement){const o=y(s),{namespace:a}=this;if(e){const l=()=>{let c=o.dataset();const h=o.attr(`zui-toggle-${this.constructor.ZUI}`);h&&(c=y.extend(c,_i(h))),this.setOptions(c)};e==="hover"?o.on(`pointerenter${a}`,c=>{o.is("[disabled],.disabled")||(l(),this.show({delay:!0,event:c}))}).on(`pointerleave${a} pointercancel${a}`,()=>{this.delayHide()}):o.on(`${e}${a}`,c=>{o.is("[disabled],.disabled")||(this.shown||l(),this.toggle({event:c,delay:!0}),c.preventDefault())})}}const{show:r}=this.options;r&&this.show({delay:typeof r=="number"?r:!1})}getTriggerElement(){if(!this._triggerElement){let{element:e=this.element}=this.options;e===document.body&&(e={getBoundingClientRect:this._getClickBounding}),this._triggerElement=e,this._virtual=!(e instanceof HTMLElement)}return this._triggerElement}initTarget(){let e=this.options.target;return this._dynamic=!e,e?(typeof e=="function"&&(e=e()),typeof e=="string"&&(e==="$next"?e=y(this._triggerElement).next():e.startsWith("$target:")&&(e=y(this._triggerElement).closest(e.slice(8)))),y(e)[0]):this._createTarget()}show(e){const{delay:t,event:i,hideOthers:s=this.options.hideOthers}=e||{};if(i&&(this._triggerEvent=i),t)return this._resetTimer(()=>{this.show()},t===!0?this.options.delay:t);if(!this.inited){this.setOptions({show:!0});return}if(this._shown)return;const r=this.initTarget();if(!r)return;this._targetElement=r;const o=y(r),{animation:a,onShow:l,onShown:c,trigger:h,elementShowClass:u}=this.options,{SHOWN_POPOVERS:p}=this.constructor;o.addClass(Km),a&&o.addClass(a===!0?"fade":a),this._zIndex=Ov.Z_INDEX++,this._shown=!0,this.render(),p.set(this.gid,this),l==null||l.call(this),this.emit("show"),s&&p.forEach(v=>{v!==this&&v.hide()});const{namespace:m}=this;h==="hover"&&(this._clearDelayHide(),o.off(m).on(`pointerenter${m}`,()=>{this._clearDelayHide()}).on(`pointerleave${m}`,()=>{this.delayHide()})),this._virtual||(o.attr("zui-commands-proxy","").data("zui.commandProxy",this._triggerElement),u&&y(this._triggerElement).addClass(u)),this._resetTimer(()=>{o.addClass(qm),this._resetTimer(()=>{c==null||c.call(this),this.emit("shown")},200)},50)}hide(e){(!this._shown||!this._targetElement)&&this._resetTimer();const{destroyOnHide:t,animation:i,onHide:s,onHidden:r,trigger:o,hideNewOnHide:a,elementShowClass:l}=this.options,c=y(this._targetElement),{SHOWN_POPOVERS:h}=this.constructor;if(this._shown=!1,h.delete(this.gid),s==null||s.call(this),this.emit("hide"),c.removeClass(qm),o==="hover"&&(this._clearDelayHide(),c.off(this.namespace)),!this._virtual){const u=y(this._triggerElement);u.removeAttr("zui-commands-proxy").removeData("zui.commandProxy"),l&&u.removeClass(l).removeAttr("data-pop-placement")}a&&h.forEach(u=>{u!==this&&u.zIndex>this.zIndex&&u.hide()}),this._resetTimer(()=>{r==null||r.call(this),this.emit("hidden"),c.removeClass(Km),(t||e)&&this._resetTimer(()=>{this.destroy()},!e&&typeof t=="number"?t:0),this._destoryTarget()},i&&!e?200:0)}toggle(e){this._shown?this.hide():this.show(e)}destroy(){if(super.destroy(),!this._virtual){const{namespace:e}=this;y(this._triggerElement).off(e)}this._resetTimer(),this._destoryTarget(),this._clearDelayHide()}layout(){const e=this._triggerElement,t=this._targetElement,i=this._layoutWatcher;if(!t||!e||!this._shown){i&&(i(),this._layoutWatcher=void 0);return}i||(this._layoutWatcher=Nm(e,t,()=>{if(this.destroyed||!this._shown)return;const{animation:s,name:r="popover",minWidth:o,minHeight:a,maxWidth:l,maxHeight:c,limitInScreen:h,onLayout:u}=this.options;if(!this._virtual){const p={minWidth:Ge(o),minHeight:Ge(a),maxWidth:Ge(l),maxHeight:Ge(c)},{width:m,height:v}=this.options;m&&(p.width=typeof m=="function"?m():m==="100%"?y(e).outerWidth():m),v&&(p.height=typeof v=="function"?v():v),Object.keys(p).length&&y(t).css(p)}hu(...this._getLayoutOptions()).then(({x:p,y:m,middlewareData:v,placement:b,strategy:C})=>{if(e instanceof HTMLElement&&Un(e)){this.hide(!0);return}const S={position:C,left:p,top:m},D=y(t).css(S);h&&D.css({top:Math.max(0,Math.min(window.innerHeight-D.outerHeight(),m)),left:Math.max(0,Math.min(window.innerWidth-D.outerWidth(),p))});const N=b.split("-")[0],P={top:"bottom",right:"left",bottom:"top",left:"right"}[N],H=v.arrow;H&&D.attr("data-pop-placement",N).find(".arrow").css({left:H.x,top:H.y}).attr("class",`arrow ${r}-arrow arrow-${P}`),s===!0&&D.attr("class",`${D.attr("class").split(" ").filter(q=>q!=="fade"&&!q.startsWith("fade-from")).join(" ")} fade-from-${P}`),this._virtual||y(this._triggerElement).attr("data-pop-placement",N),u&&u.call(this,{target:t,trigger:e,popSide:N,arrowSide:P,x:p,y:m,placement:b,strategy:C})})},{ancestorResize:!1}))}render(e){super.render(e);const t=this._targetElement;if(!t)return;const i=this._getRenderOptions(),s=y(t);if(s.z("popover",this.gid).toggleClass("popup",i.popup).css(i.style),i.className&&s.setClass(i.className),this._dynamic){let r=this._panel;r&&r.element!==t&&(r.destroy(),r=void 0),r?r.render(i):(r=new Ca(t,i),r.on("inited",()=>this.layout())),this._panel=r}else i.arrow&&(s.find(".arrow").length||s.append(y('<div class="arrow"></div>').css(i.arrowStyle))),this.layout()}handleClickOutside(e){if(this.options.mask){const t=this._triggerElement;t instanceof HTMLElement&&y(e.target).closest(t).length||this.hide()}}handleClickTarget(e){}delayHide(e=100){this._resetTimer(),this._clearDelayHide(),this._hideTimer=window.setTimeout(()=>{this._hideTimer=0,this.hide()},e)}_clearDelayHide(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=0)}_getLayoutOptions(){const e=this._triggerElement,t=this._targetElement,{placement:i,flip:s,limitSize:r,shift:o,offset:a,arrow:l,strategy:c}=this.options,h=l?t.querySelector(".arrow"):null,u=h?typeof l=="number"?l:5:0,p=()=>typeof a=="function"?a:typeof a=="object"?{mainAxis:(a.mainAxis||0)+u,...a}:(a||0)+u;return[e,t,{placement:i,strategy:c,middleware:[s?uu():null,o?cu(typeof o=="object"?o:void 0):null,a||u?lu(p()):null,l?XC({element:h}):null,r?Mm({apply({availableWidth:m,availableHeight:v,placement:b}){y(t).css({maxHeight:v-(["top","bottom"].includes(b.split("-")[0])?u:0)-2,maxWidth:m-2})}}):null].filter(Boolean)}]}_getRenderOptions(){const{name:e="popover"}=this.options,{popup:t,title:i,content:s,headingClass:r=`${e}-heading`,titleClass:o=`${e}-title`,contentClass:a=`${e}-content`,style:l,className:c=e,closeBtn:h,arrow:u,footer:p,footerClass:m=`${e}-footer`}=this.options;return{popup:t,title:i,titleClass:o,headingClass:r,contentClass:a,content:s,style:{zIndex:this._zIndex,...l},className:c,closeBtn:h,arrow:u?`arrow ${e}-arrow`:!1,arrowStyle:{"--arrow-size":`${typeof u=="number"?u:5}px`},onlyInner:!0,footer:p,footerClass:m}}_destoryTarget(){var e,t,i;(e=this._layoutWatcher)==null||e.call(this),this._layoutWatcher=void 0,this._dynamic&&((t=this._panel)==null||t.destroy(),(i=this._targetElement)==null||i.remove(),this._panel=void 0,this._targetElement=void 0)}_resetTimer(e,t=0){this._timer&&clearTimeout(this._timer),e&&(this._timer=window.setTimeout(()=>{this._timer=0,e()},t))}_createTarget(){const{container:e="body"}=this.options,t=y(e);let i=t.find(`#${this._id}`);return i.length||(i=y("<div />").attr({id:this._id,class:"popover"}).appendTo(t)),i[0]}static show(e){const{element:t,event:i,...s}=e,r=t||(i==null?void 0:i.currentTarget);return this.ensure(r instanceof HTMLElement?r:document.body,{element:r,show:!0,destroyOnHide:!0,triggerEvent:i,...s})}};xs.NAME="Popover",xs.Z_INDEX=1700,xs.MULTI_INSTANCE=!0,xs.DEFAULT={placement:"top",strategy:"absolute",flip:!0,arrow:!0,offset:1,trigger:"click",mask:!0,delay:0,animation:!0,closeBtn:!0,popup:!0,elementShowClass:"with-popover-show",hideNewOnHide:!0},xs.SHOWN_POPOVERS=new Map;let Ht=xs;Ht.toggle={trigger:["click","hover"],convertHref:{selector:"target"},check(n,e){const t=y(n);return t.data(this.KEY)?!1:e==="hover"?(t.dataset("trigger")||this.DEFAULT.trigger)==="hover":!0},getOptions(n,e,t){return{triggerEvent:t,...e}},onToggle(n,e,t){n.toggle({event:t})}},Ht.register(),y(()=>{y(document).on(`click.${Ht.NAMESPACE}`,n=>{const{SHOWN_POPOVERS:e}=Ht;if(!e.size)return;const t=y(n.target),i=t.closest("[z-popover]"),s=i.length?i.z("popover"):0,r=s?e.get(s):null;if(r){const a=r.options.name??r.constructor.ZUI;if(t.closest(`[data-dismiss="popover"],[data-dismiss="${a}"]`).length){r.hide();return}if(r.handleClickTarget(n))return}const o=[...e.values()].sort((a,l)=>l.zIndex-a.zIndex);for(const a of o)if(a!==r&&a.handleClickOutside(n))return})}),Object.assign(window,{Popover:Ht});const KD="";class gn extends Ht{handleClickTarget(e){const t=y(e.target),{notHideOnClick:i}=this.options;return(!i||!t.closest(i).length)&&this.hide(),!0}_getMenuOptions(){const{items:e,placement:t,menu:i,tree:s,onClickItem:r,relativeTarget:o=this._triggerElement}=this.options;return{items:e,placement:t,tree:s,onClickItem:r,nestedToggle:".item",accordion:!0,relativeTarget:{target:o,event:this.options.triggerEvent,dropdown:this},dropdown:this,popup:!0,...i}}_getRenderOptions(){const e=super._getRenderOptions();return this._dynamic?{...e,contentClass:"",popup:!1,content:w(xa,this._getMenuOptions())}:e}}gn.NAME="Dropdown",gn.DEFAULT={...Ht.DEFAULT,name:"dropdown",placement:"bottom-start",arrow:!1,closeBtn:!1,animation:"fade",limitSize:!0,notHideOnClick:".not-hide-menu,.form-control,input,label,.nested-toggle-icon"},gn.toggle={...Ht.toggle,getOptions(n,e,t){return e=Ht.toggle.getOptions.call(this,n,e,t),!e.target&&!e.items&&!e.menu&&(e.target=y(n).next(".dropdown-menu")),e}},gn.register();class Ss extends xe{constructor(){super(...arguments),this._ref=he()}get triggerElement(){return this._ref.current}_updateData(){const{dropdown:e,menu:t,items:i,onClickItem:s,relativeTarget:r=this.triggerElement}=this.props,o=gn.get(this.triggerElement),a={items:i,onClickItem:s,menu:t,relativeTarget:r,...y(this.triggerElement).dataset(),...e};o?o.setOptions(a):new gn(this.triggerElement,a)}componentDidMount(){this._updateData()}componentDidUpdate(){this._updateData()}componentWillUnmount(){var e;(e=gn.get(this.triggerElement))==null||e.destroy()}_getProps(e){const{trigger:t,placement:i}=e;return{...super._getProps(e),"data-toggle":"dropdown","data-trigger":t,"data-placement":i,ref:this._ref}}}Ss.defaultProps={caret:!0},Object.assign(Jt.ItemComponents,{dropdown:Ss}),Object.assign(Be.ItemComponents,{dropdown:Ss});class xa extends ut{constructor(){super(...arguments),this._handleSearchFocus=()=>{this._searchFocused=!0},this._handleSearchBlur=()=>{this._searchFocused=!1}}get isHoverTrigger(){const{nestedTrigger:e,tree:t}=this.props;return e?e==="hover":!t}get dropdown(){return this.props.dropdown}layout(){var h;if(this.props.tree||this.isRoot)return;const e=(h=this.element)==null?void 0:h.parentElement,t=y(e);e&&this._searchFocused&&this._position&&t.css(this._position);const r=t.parent().children(".dropdown-menu").children(`[z-key-path="${this.props.parentKey}"]`)[0];if(!e||!r)return;let{maxHeight:o}=this.props;const{flip:a,shift:l,offset:c}=this.props;hu(r,e,{placement:this.props.placement,middleware:[a?uu():null,l?cu(typeof l=="object"?l:void 0):null,lu(c),Mm({apply({availableWidth:u,availableHeight:p}){if(o){const[m,v]=xi(o);o=Math.min(v==="%"?m*window.innerHeight:m,p-2)}else o=p;t.css({maxHeight:o,maxWidth:u-2})}})]}).then(({x:u,y:p})=>{t.css({left:u,top:p}),this._position={left:u,top:p,width:e.offsetWidth,height:e.offsetHeight}})}_getClassName(e){return["dropdown-menu scrollbar-hover scrollbar-thin",super._getClassName(e)]}_afterRender(e){super._afterRender(e),this.layout()}_getNestedProps(e,t,i,s){return ke(this.isHoverTrigger?{"z-key":i.key,"z-hover":this.props.parentKey??"root",onMouseEnter:this._handleHover,onMouseLeave:this._handleHover}:{},super._getNestedProps(e,t,i,s))}_getItemFromEvent(e){const t=super._getItemFromEvent(e);if(t)return t;const i=y(e.target).closest(".dropdown-menu[z-key]");if(i.length){const s=i.attr("z-key"),r=i.parent().parent().children(".dropdown-menu").children(`[z-key="${s}"]`);if(r.length)return super._getItemFromEvent(e,r[0])}}_renderNestedList(e,t,i,s){const r=super._renderNestedList(e,t,i,s);if(this.props.tree)return r;this._nestedContextMenu.push(r)}_getWrapClass(e){return[super._getWrapClass(e),e.tree?"is-tree":this.isRoot?"is-contextmenu":"is-contextmenu popup"]}_renderWrapperFooter(e){const t=super._renderWrapperFooter(e),i=this._nestedContextMenu;return this.props.tree||!i.length?t:[t,...i]}_renderNestedToggle(e,t){if(this.props.tree)return super._renderNestedToggle(e,t);if(typeof t=="boolean")return k("span",{className:`${this.name}-toggle nested-toggle-icon`,children:k("span",{className:"caret-right"})})}_getSearchBoxProps(e){return{...super._getSearchBoxProps(e),onFocus:this._handleSearchFocus,onBlur:this._handleSearchBlur}}_beforeRender(e){return this._nestedContextMenu=[],super._beforeRender(e)}}xa.defaultProps={...ut.defaultProps,searchBox:!1,placement:"right-start",defaultNestedShow:!1,expandOnSearch:!1,nestedSearch:!1,flip:!0,shift:!0,offset:1},xa.inheritNestedProps=[...ut.inheritNestedProps,"container","tree"];const hx=Object.freeze(Object.defineProperty({__proto__:null,DropdownButton:Ss,DropdownMenu:xa},Symbol.toStringTag,{value:"Module"}));function dx({type:n,pagerInfo:e,linkCreator:t,items:i=[5,10,15,20,25,30,35,40,45,50,100,200,500,1e3,2e3],dropdown:s={},menu:r,itemProps:o,...a}){var c;s.items=i.map(h=>{const u={...e,recPerPage:h};return{...o,key:h,text:`${h}`,active:h===e.recPerPage,url:t?typeof t=="function"?t(u):we(t,u):void 0,"z-change-page-size":h}});const{text:l=""}=a;return a.text=typeof l=="function"?l(e):we(l,e),s.menu={...r,...s.menu,className:V((c=s.menu)==null?void 0:c.className,"pager-size-menu")},k(Ss,{dropdown:s,...a})}function Gm({key:n,page:e,type:t,btnType:i,pagerInfo:s,size:r,onClick:o,onChange:a,linkCreator:l,...c}){const h={...c};let u;const p=b=>{var C;u=Number((C=b.target)==null?void 0:C.value)||1,u=u>s.pageTotal?s.pageTotal:u},m=b=>{if(!(b!=null&&b.target))return;u=u<=s.pageTotal?u:s.pageTotal;const C=vr(s,u);a&&!a({info:C,event:b})||(b.target.href=h.url=typeof l=="function"?l(C):we(l,C))},v=vr(s,e||0);return h.url=typeof l=="function"?l(v):we(l,v),k("div",{className:V("input-group","pager-goto-group",r?`size-${r}`:""),children:[k("input",{type:"number",class:"form-control",max:s.pageTotal,min:"1",onInput:p}),k(xe,{type:i,...h,onClick:m})]})}const Sa=class kd extends Be{constructor(){super(...arguments),this._pagerChanges=Je({}),this._changedPager=je(()=>kd.format({...this.props,...this._pagerChanges.value})),this._changeEffect=Qt(()=>{const{onChangePageInfo:e}=this.props,t=this._changedPager.value;e&&this._changeEvent&&(e(t,this._changeEvent),this._changeEvent=void 0)}),this._handleClickLink=e=>{const t=y(e.currentTarget);if(t.is(".disabled"))return;const i=t.z("goToPage");typeof i=="number"&&(this._changeEvent=e,this._pagerChanges.value={...this._pagerChanges.value,page:i})},this._handleClickSizeMenu=e=>{const{item:t}=e,i=t["z-change-page-size"];typeof i=="number"&&!t.disabled&&(this._changeEvent=e.event,this._pagerChanges.value={...this._pagerChanges.value,recPerPage:i})}}_isBtnType(e){const{type:t}=e;return super._isBtnType(e)||["link","nav","size-menu","goto"].includes(t)}componentDidUpdate(e){if(this.props.useState)this.props.recTotal!==e.recTotal&&(this._pagerChanges.value={...this._pagerChanges.value,recTotal:this.props.recTotal});else{const{page:t,recTotal:i,recPerPage:s}=this.props;(t!==e.page||i!==e.recTotal||s!==e.recPerPage)&&(this._pagerChanges.value={})}}componentWillUnmount(){this._changeEffect()}_beforeRender(e){return this._pagerInfo=e.useState?this._changedPager.value:kd.format(e),super._beforeRender(e)}_getItem(e,t,i){const s=super._getItem(e,t,i);if(!s)return!1;const{type:r="item"}=t,o=this._pagerInfo;return r==="info"?y.extend(s,{pagerInfo:o}):(r==="link"||r==="size-menu"||r==="nav"||r==="goto")&&y.extend(s,{pagerInfo:o,linkCreator:e.linkCreator}),r==="size-menu"&&(s.menu={onClickItem:this._handleClickSizeMenu,...s.menu}),r==="link"&&(s.onClick=this._handleClickLink),s}static format(e){const{page:t=1,recTotal:i=0,recPerPage:s=10}=e,r=Math.max(0,+i),o=Math.max(1,+s),a=o?Math.ceil(r/o):0;return{page:Math.min(Math.max(1,+t),a),recTotal:r,recPerPage:o,pageTotal:a}}};Sa.NAME="pager",Sa.ItemComponents={...Be.ItemComponents,info:Vm,link:Wm,nav:cx,"size-menu":dx,goto:Gm},Sa.defaultItemProps={btnType:"ghost",size:"sm"};let _r=Sa;class Cu extends ve{}Cu.NAME="Pager",Cu.Component=_r,tt(Object.freeze(Object.defineProperty({__proto__:null,Pager:_r,PagerGoto:Gm,PagerInfoItem:Vm,PagerLink:Wm},Symbol.toStringTag,{value:"Module"})));const GD="",YD="";class ka extends ve{}ka.NAME="Pick",ka.Component=ht,ka.replace=!0;const XD="",QD="",JD="",ZD="";class xu extends me{constructor(e){super(e),this._searchInput=he(),this._measure=he(),this._changeTimer=0,this._handleChange=t=>{if(t.isComposing)return;const i=t.target.value;this.setState({search:i},()=>{const{onSearch:s}=this.props;s&&(this._changeTimer&&clearTimeout(this._changeTimer),this._changeTimer=window.setTimeout(()=>{this._changeTimer=0,s(i)},this.props.debounce||300))}),t.stopPropagation()},this._handleClear=t=>{t.stopPropagation(),this.clear()},this.state={search:e.defaultSearch??""}}get $pop(){return y(`#pick-pop-${this.props.id}`)}focus(){var e;(e=this._searchInput.current)==null||e.focus()}setSearch(e,t=!0){var s,r,o,a;if(!e.length&&this.state.search.length&&((r=(s=this.props).onClear)==null||r.call(s)),((o=this._searchInput.current)==null?void 0:o.value)===e){t&&this.focus();return}y((a=this._searchInput)==null?void 0:a.current).val(e).trigger("change"),t&&this.focus()}clear(){this.setSearch("")}componentDidMount(){this.focus();const{hotkeys:e}=this.props;if(e){const t=oc(e,{clear:{keys:"Escape",handler:()=>{this.state.search.trim().length?this.clear():this.$pop.trigger("hidePop")}},enter:{keys:"Enter",handler:i=>{i.preventDefault(),this.$pop.trigger("selectActive"),this.clear()}},activeNext:{keys:"ArrowDown",handler:()=>{this.$pop.trigger("activeNext")}},activePrev:{keys:"ArrowUp",handler:()=>{this.$pop.trigger("activePrev")}},deselectLast:{keys:"Backspace",handler:()=>{this.state.search.trim().length||this.$pop.trigger("deselectLast")}}});t&&(this._hotkeysScope=`PickerSearch_${Tt()}`,y(this._searchInput.current).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}y(this._searchInput.current).on("compositionend",this._handleChange)}componentDidUpdate(){const{inline:e}=this.props;if(e){const{current:t}=this._measure,{current:i}=this._searchInput;if(t&&i){const s=y(i).parent();s.width(Math.ceil(Math.min(t.clientWidth,s.closest(".picker").outerWidth()-32)))}}}componentWillUnmount(){clearTimeout(this._changeTimer),this._hotkeysScope&&y(this._searchInput.current).unbindHotkeys(this._hotkeysScope),y(this._searchInput.current).off("compositionend",this._handleChange)}render(e,t){const{placeholder:i,inline:s}=e,{search:r}=t,o=r.trim().length>0;let a;return s?a=k("div",{className:"picker-search-measure",ref:this._measure,children:r}):o?a=k("button",{type:"button",className:"btn picker-search-clear square size-sm ghost",onClick:this._handleClear,children:k("span",{className:"close"})}):a=k("span",{className:"magnifier"}),k("div",{className:`picker-search${s?" is-inline":""}`,children:[k("input",{className:"form-control picker-search-input",type:"text",placeholder:i,value:r,autoComplete:"off",onChange:this._handleChange,onInput:this._handleChange,ref:this._searchInput}),a]})}}class Ym extends ia{constructor(){super(...arguments),this._search=he(),this._handleDeselectClick=e=>{const{onDeselect:t,state:{selections:i}}=this.props,s=y(e.target).closest(".picker-deselect-btn").attr("data-value");t&&i.length&&typeof s=="string"&&t(s),e.stopPropagation()},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})},this._renderSelection=e=>{const{text:t}=e;return k("div",{className:"picker-multi-selection",title:typeof t=="string"?t:void 0,children:[k("span",{className:"text",children:k(ge,{content:t})}),this.props.disabled||this.props.readonly?null:k("div",{className:"picker-deselect-btn btn size-xs ghost",onClick:this._handleDeselectClick,"data-value":e.value,children:k("span",{className:"close"})})]},e.value)}}get searchBox(){return this._search.current}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return V(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-multi form-control")}_renderSearch(e){const{state:{search:t},searchHint:i,hotkeys:s}=e;return k(xu,{inline:!0,id:e.id,ref:this._search,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:i,hotkeys:s})}_renderTrigger(e){const{state:{selections:t=[],open:i,value:s},search:r,placeholder:o,display:a,valueList:l,children:c,caretClass:h}=this.props,u=i&&r;let p;const m=!u&&!t.length;return a&&(!m||o===void 0)?(typeof a=="function"?p=a.call(this,l,t):typeof a=="string"&&(p=we(a,{value:s,values:l,count:l.length})),p=k("div",{className:"picker-multi-selections",children:p},"selections")):m?p=k("span",{className:"picker-select-placeholder",children:o},"selections"):p=k("div",{className:"picker-multi-selections",children:[t.map(this._renderSelection),u?this._renderSearch(e):null]},"selections"),[p,c,k("span",{class:V("caret",h)},"caret")]}_renderValue(e){const{name:t,state:{value:i=""},disabled:s,readonly:r,id:o,valueList:a,emptyValue:l}=e;if(t)if(this.hasInput)y(`#${o}`).val(i);else{const c=a.length?a:[l];return k("select",{id:o,multiple:!0,className:"pick-value",name:t.endsWith("[]")?t:`${t}[]`,disabled:s,readonly:r,style:{display:"none"},children:c.map(h=>k("option",{value:h,children:h},h))})}return null}componentDidMount(){super.componentDidMount();const{id:e,valueList:t,emptyValue:i}=this.props;y(`#${e}`).val(t.length?t:[i])}componentDidUpdate(e){const{id:t,state:i,name:s,valueList:r,emptyValue:o}=this.props;if(s&&e.state.value!==i.value){const a=y(`#${t}`).val(r.length?r:[o]);this._skipTriggerChange!==i.value&&a.trigger("change",vm),this._skipTriggerChange=!1}}}class Xm extends ia{constructor(){super(...arguments),this._search=he(),this._handleDeselectClick=e=>{this.props.disabled||(this.props.onClear(),e.stopPropagation())},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})}}get searchBox(){return this._search.current}_getSearchPlaceholder(){const{searchHint:e,state:{value:t,selections:i}}=this.props;let s=e;if(s===void 0){const r=i.find(o=>o.value===t);r&&typeof r.text=="string"&&(s=r.text)}return s}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return V(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-single form-control")}_renderSearch(e){const{state:{search:t},hotkeys:i}=e;return k(xu,{ref:this._search,id:e.id,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:this._getSearchPlaceholder(),hotkeys:i})}_renderTrigger(e){const{children:t,state:{selections:i=[],value:s,open:r},placeholder:o,search:a,disabled:l,readonly:c,clearable:h,display:u,caretClass:p}=e,[m]=i,v=r&&a;let b;if(v)b=this._renderSearch(e);else if(m||o===void 0&&u){const{text:D}=m||{text:"",value:""};typeof u=="function"?b=u.call(this,s,i):typeof u=="string"?b=we(u,m):b=k(ge,{content:D}),b=k("span",{className:"picker-single-selection",title:typeof D=="string"?D:void 0,children:b},"main")}else b=k("span",{className:"picker-select-placeholder",children:o},"main");const C=h&&!v?k("button",{type:"button",className:"btn picker-deselect-btn size-xs square ghost",disabled:l,readonly:c,onClick:this._handleDeselectClick,children:k("span",{className:"close"})},"deselect"):null,S=v?null:k("span",{className:V("caret flex-none",p)},"caret");return[b,t,C,S]}}function Qm(n,e){return n.reduce((t,i)=>(Array.isArray(i.items)&&Qm(i.items,t),typeof i.value=="string"&&t.set(i.value,i),t),e||new Map)}class Jm extends du{constructor(){super(...arguments),this._menu=he(),this._disabledSet=new Set,this._getItem=(e,t)=>{var c;if(e.parentKey!==void 0)return e;const i=new Set(this.props.valueList);let s=e.items,r=!1,o=!1;Array.isArray(s)&&this.props.multiple&&(r=!0,s=s.reduce((h,u,p)=>{const m=this._getItem(u,p);return m&&(m.selected?o=!0:r=!1,h.push(m)),h},[]));const a=r||i.has(e.value);e={selected:a,hint:typeof e.text=="string"?e.text:void 0,...e,checked:this._hasCheckbox||typeof e.checked=="boolean"?r?!0:o?"indeterminate":a:void 0,className:V(e.className,{hover:e.value!==void 0&&e.value===this.props.state.hoverItem}),items:s},e.content&&e.text&&delete e.text;const l=((c=this._getItemCallback)==null?void 0:c.call(this,e,t))??e;return l&&((l.disabled||l.value===void 0)&&(l.hover===void 0&&(l.hover=!1),l.disabled===void 0&&(l.disabled=!0),this._disabledSet.add(l.value)),a&&!l.disabled&&l.value!==void 0&&this._firstSelected===void 0&&(this._firstSelected=l.value),l)},this._beforeRenderItem=(e,t)=>{var i;return(i=this._renderItemCallback)==null?void 0:i.call(this,e,t)},this._handleItemClick=({item:e,event:t})=>{const i=e.value,s=t.target;if(e.disabled||i===void 0||s.closest(".item-icon,.nested-toggle-icon,.disabled")||Array.isArray(e.items)&&e.items.every(a=>this._disabledSet.has(a.value)))return;const{multiple:r,onPick:o}=this.props;if(r)if(e.items){const l=[...Qm(e.items).values()].filter(c=>!c.items&&!this._disabledSet.has(c.value)).map(c=>c.value);y(s).closest(".item").children(".item-inner.selected").length?o({diselect:l}):o({select:l})}else o({toggle:i});else o({select:i})}}get menu(){return this._menu.current}get picker(){return this.props.picker}componentDidMount(){var e,t;super.componentDidMount(),this._firstSelected===void 0?(e=this.menu)==null||e.activeNext():(t=this.menu)==null||t.toggleActive(this._firstSelected,!0),y(this.element).on("activeNext.zui.Picker",()=>{var i;(i=this.menu)==null||i.activeNext()}).on("activePrev.zui.Picker",()=>{var i;(i=this.menu)==null||i.activePrev()}).on("selectActive.zui.Picker",()=>{const i=this.menu;if(!i)return;const s=i.getActiveKey();if(s!==void 0){const r=i.getRenderedItem(s);r&&y(this.element).find(`.item[z-key-path="${r._keyPath}"]`).trigger("click")}}).on("hidePop.zui.Picker",()=>{this.props.togglePop(!1)}).on("deselectLast.zui.Picker",()=>{if(this.props.multiple){const{valueList:i}=this.props,s=i[i.length-1];s&&this.props.onDeselect(s)}}),setTimeout(()=>{var i;y((i=this.menu)==null?void 0:i.element).find(".menu-item>.selected").scrollIntoView({block:"center"})},100)}componentWillUnmount(){super.componentWillUnmount(),y(this.element).off(".zui.Picker")}_getClass(e){return V(super._getClass(e),"picker-menu")}_getMenuProps(e){const{menu:t,tree:i,state:s,checkbox:r,header:o,footer:a,noMatchHint:l,maxItemsCount:c,exceedLimitHint:h}=e,{items:u,search:p}=s;return ke({ref:this._menu,className:"picker-menu-list",underlineKeys:!0,limit:c,items:u,defaultNestedShow:!0,activeOnHover:!0,search:p,exceedLimitHint:h,onClickItem:this._handleItemClick,nestedToggle:".nested-toggle-icon,.item-icon",checkbox:r,searchProps:["keys","text","title","subtitle","value"],header:o,footer:a,noMatchHint:l,relativeTarget:this},t,i)}_renderPop(e){const{tree:t}=e;this._firstSelected=void 0,this._disabledSet.clear();const i=this._getMenuProps(e);return this._hasCheckbox=!!i.checkbox,this._getItemCallback=i.getItem,this._renderItemCallback=i.beforeRenderItem,i.getItem=this._getItem,i.beforeRenderItem=this._beforeRenderItem,t?k(Ti,{...i}):k(ut,{...i})}}function Ai(n,e){return n.reduce((t,i)=>(Array.isArray(i.items)&&Ai(i.items,t),t.set(i.value===void 0?"":String(i.value),i),t),e||new Map)}let nn=class extends ht{constructor(e){super(e),this._updateTimer=0,this.toggleValue=(t,i)=>{if(!this.props.multiple)return i||t!==this.value?this.setValue(t):this.setValue();const{valueList:s}=this,r=s.indexOf(t);if(i!==r>=0)return r>-1?s.splice(r,1):s.push(t),this.setValue(s)},this.deselect=(t=[])=>{const{valueList:i}=this,s=new Set(this.formatValueList(t)),r=i.filter(o=>!s.has(o));this.setValue(r)},this.clear=()=>{this.setValue()},this.select=t=>{const i=this.formatValueList(t),s=this.props.multiple?[...this.valueList,...i]:i[0];return this.setValue(s)},this.isSelected=t=>this.valueList.includes(t),this._handlePickValue=t=>{var o,a;const{toggle:i,select:s,diselect:r}=t;i!==void 0?this.toggleValue(i):s!==void 0?this.select(s):r!==void 0&&this.deselect(r),this.props.multiple?this.props.clearSearchOnSelect&&((o=this.state.search)!=null&&o.length)&&this.focusSearch(""):(this.toggle(!1),(a=this.searchBox)==null||a.clear())},this.setValue=this.setValue.bind(this),this.isEmptyValue=this.isEmptyValue.bind(this)}get valueList(){return this.formatValueList(this.state.value)}get firstEmptyValue(){return this._emptyValueSet.values().next().value}get searchBox(){var e;return(e=this.trigger)==null?void 0:e.searchBox}focusSearch(e){const{searchBox:t}=this;t&&(typeof e=="string"?t.setSearch(e):t.focus())}getDefaultState(e){const{items:t,valueSplitter:i=",",emptyValue:s=""}=e||this.props,r={...super.getDefaultState(e),loading:!1,search:"",items:Array.isArray(t)?t:[],selections:[]};if(this._emptyValueSet=new Set(typeof s=="string"?s.split(i):[]),Array.isArray(t)&&t.length){const{limitValueInList:o,required:a,multiple:l}=this.props;if(t.forEach(c=>{typeof c.value=="number"&&(c.value=String(c.value))}),o){const c=Ai(t);r.value=this.formatValueList(r.value,i).filter(h=>c.has(h)).join(i),a&&!l&&!this.formatValueList(r.value,i).length&&(r.value=t[0].value??"")}}return r}isEmptyValue(e){return this._emptyValueSet.has(e)}deselectAll(){this.setValue([])}selectAll(){const{items:e}=this.state;if(!Array.isArray(e))return;const i=[...Ai(e).values()].reduce((s,r)=>(r.disabled||s.push(r.value),s),[]);return this.select(i)}isSelectedAll(){const{items:e}=this.state;if(!Array.isArray(e))return!1;const t=Ai(e),i=new Set(this.valueList);return[...t.values()].every(s=>s.disabled||i.has(s.value))}async load(){let e=this._abort;e&&e.abort();const{items:t=[],searchDelay:i}=this.props,{search:s=""}=this.state;let r=[];if(Array.isArray(t))r=t;else{if(e=new AbortController,this._abort=e,await bi(i||500),this._abort!==e)return r;let o=t;if(typeof o=="string"&&(o={url:o}),typeof o=="object"&&o.url&&(o={...o,url:we(o.url,{search:encodeURIComponent(s)})}),r=await _t(o,[this,s],{signal:e.signal}),this._abort!==e)return r}return this._abort=void 0,r}changeState(e,t){return super.changeState(i=>{const s=typeof e=="function"?e(i):e;if(s.value!==void 0&&s.value!==i.value||s.items&&s.items!==i.items){const r=s.items||i.items,o=new Map;Array.isArray(i.items)&&i.items!==s.items&&Ai(i.items,o),Array.isArray(r)&&(Ai(r,o),s.selections=this.formatValueList(s.value??i.value).reduce((a,l)=>(this.isEmptyValue(l)||a.push(o.get(l)||{value:l,text:l}),a),[]))}return s},t)}async update(e){const{state:t,props:i}=this,s=this._itemsCacheInfo||{},r={};if(this._itemsCacheInfo=s,!t.loading&&(e||s.search!==t.search||i.items!==s.items)){await this.changeState({loading:!0});let a=await this.load();const l=c=>c.filter(h=>(h.key=h.key??h.value,typeof h.value=="number"&&(h.value=String(h.value)),this.isEmptyValue(h.value)?!1:(Array.isArray(h.items)&&(h.items=l(h.items)),!0)));a=l(a),r.loading=!1,r.items=a,s.items=i.items,s.search=t.search}else s.items&&!t.open&&i.cache===!1&&!Array.isArray(i.items)&&(s.items=void 0);(e||s.value!==t.value)&&(s.value=t.value);const o=r.items;i.required&&!i.multiple&&this.isEmptyValue(this.state.value)&&Array.isArray(o)&&o.length&&(r.value=o[0].value),Object.keys(r).length&&await this.changeState(r)}async tryUpdate(){this._updateTimer&&clearTimeout(this._updateTimer),this._updateTimer=window.setTimeout(()=>{this._updateTimer=0,this.update()},50)}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.tryUpdate()}componentDidMount(){super.componentDidMount(),this.tryUpdate()}componentWillUnmount(){var e;(e=this._abort)==null||e.abort(),this._abort=void 0,this._itemsCacheInfo=void 0,clearTimeout(this._updateTimer),super.componentWillUnmount()}_handleChange(e,t){if(super._handleChange(e,t),e!==t){const{onDeselect:i,onSelect:s,onClear:r,multiple:o}=this.props,a=this.formatValueList(t),l=this.valueList;if(r&&!l.length&&a.length&&r.call(this),i){const c=a.filter(h=>!l.includes(h));c.length&&i.call(this,o?c:c[0])}if(s){const c=l.filter(h=>!a.includes(h));c.length&&s.call(this,o?c:c[0])}}}_getTriggerProps(e,t){return{...super._getTriggerProps(e,t),multiple:e.multiple,hotkeys:e.hotkeys,placeholder:e.placeholder,search:e.search,display:e.display,searchHint:e.searchHint,caretClass:e.caretClass,clearable:!!this.valueList.length&&!e.required,valueList:this.valueList,emptyValue:this.firstEmptyValue,onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue}}_getPopProps(e,t){return{...super._getPopProps(e,t),picker:this,menu:e.menu,tree:e.tree,checkbox:e.checkbox,multiple:e.multiple,search:e.search,maxItemsCount:e.maxItemsCount,footer:this._renderToolbar(),valueList:this.valueList,noFlipAfterShow:!0,noMatchHint:t.loading?Ne.getLang("loadingHint"):e.searchEmptyHint??Ne.getLang("searchEmptyHint"),exceedLimitHint:e.exceedLimitHint??Ne.getLang("exceedLimitHint"),onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue,onPick:this._handlePickValue}}_getTrigger(e){return e.Trigger||(e.multiple?Ym:Xm)}_renderToolbar(){let{toolbar:e}=this.props;return e?(e===!0&&(e=[{key:"selectAll",text:Ne.getLang("selectAll")},{key:"cancelSelect",text:Ne.getLang("cancelSelect")}]),Be.render(e,[],{size:"sm",relativeTarget:this,getItem:t=>(t.onClick||(t.key==="selectAll"?(t.onClick=this.selectAll.bind(this),t.disabled=this.isSelectedAll()):t.key==="cancelSelect"&&(t.onClick=this.deselectAll.bind(this),t.disabled=!this.valueList.length)),t)},this)):null}formatValueList(e,t){let i;return typeof e=="string"&&e.length?i=e.split(t??this.props.valueSplitter??","):Array.isArray(e)?i=e:i=[e],y.unique(i).reduce((s,r)=>(r==null||(r=typeof r!="string"?String(r):r,this.isEmptyValue(r)||s.push(r)),s),[])}formatValue(e){const t=this.formatValueList(e);return t.length?t.join(this.props.valueSplitter??","):this.firstEmptyValue}setValue(e=[],t){let i=this.formatValueList(e);if(i.length){const{items:r,limitValueInList:o}=this.props;if(o){const a=Ai(Array.isArray(r)?r:this.state.items);i=i.filter(l=>a.has(l))}}const s=this.formatValue(i);return super.setValue(s,t)}};nn.defaultProps={...ht.defaultProps,className:"picker",valueSplitter:",",limitValueInList:!0,search:!0,emptyValue:"",cache:!0,hotkeys:!0,clearSearchOnSelect:!0},nn.Pop=Jm;const fx=Object.freeze(Object.defineProperty({__proto__:null,Picker:nn,PickerMenu:Jm,PickerMultiSelect:Ym,PickerSearch:xu,PickerSingleSelect:Xm},Symbol.toStringTag,{value:"Module"}));class Ta extends ve{}Ta.NAME="Picker",Ta.Component=nn,Ta.register(),Ne.addLang({zh_cn:{selectAll:"全选",cancelSelect:"取消选择",searchEmptyHint:"无匹配选项",loadingHint:"正在加载...",exceedLimitHint:"还有 {0} 个选项没有显示，可尝试搜索来查找"},zh_tw:{selectAll:"全選",cancelSelect:"取消選擇",searchEmptyHint:"無匹配選項",loadingHint:"正在載入...",exceedLimitHint:"還有 {0} 個選項沒有顯示，可嘗試搜索來查找"},en:{selectAll:"Select All",cancelSelect:"Cancel Select",searchEmptyHint:"No matching options",loadingHint:"Loading...",exceedLimitHint:"There are {0} items not displayed, try searching to find"}}),tt(fx);class Da extends ve{}Da.NAME="SearchBox",Da.Component=ki,Da.register(),tt(Mb);const eI="";function Su(n,e){const[t,i]=xi(n);return i==="%"?e*t/100:t}const Zm="is-sidebar-resizing",eg="has-sidebar-animation",ku="is-animating",Ia=".sidebar-gutter";class $a extends We{get side(){return this._side}get width(){return this._width}get $parent(){const{parent:e}=this.options;return e?y(e):this.$element.parent()}afterInit(){const{$element:e}=this,t=e.parent(),i=t[0],s=t.width();this._container=i;const{preserve:r,side:o=e.hasClass("sidebar-right")?"right":"left",animation:a,dragToResize:l,width:c,minWidth:h=0,maxWidth:u=Number.MAX_SAFE_INTEGER,toggleBtn:p,dbclick:m}=this.options;this._storeID=r?`SIDEBAR:${r}:width`:"",this._side=o,this._minWidth=Su(h,s),this._maxWidth=Su(u,s),this._defaultWidth=Math.max(this._minWidth,Math.min(this._maxWidth,Su(c||e.width(),s))),this._width=(r?Xe.get(this._storeID):null)??this._defaultWidth,this.render(),p&&e.on(`click${this.namespace}`,".gutter-toggle",()=>this.toggle()),m&&e.on(`dblclick${this.namespace}`,Ia,()=>{m==="reset"?this.update(this._defaultWidth):this.toggle()}).on("mousedown",Ia,v=>{v.preventDefault()}),l&&(this._moveable=new rr(e,{selector:Ia,move:!1,onMoveStart:()=>{this._startWidth=this._width,this.$parent.addClass(Zm).removeClass(eg)},onMove:(v,b)=>{const{deltaX:C}=b;Math.abs(C)<10||this.update(this._startWidth+C*(o==="left"?1:-1))},onMoveEnd:()=>{a&&this.$parent.addClass(eg),this.$parent.removeClass(Zm)}})),a&&this.on("transitionend",v=>{v.target===e[0]&&v.propertyName==="width"&&e.removeClass(ku)})}destroy(){var e;super.destroy(),this._raf&&cancelAnimationFrame(this._raf),(e=this._moveable)==null||e.destroy()}toggle(e){e=e??!!this._width,e&&(this._widthBack=this._width),this.update(e?0:this._widthBack||this._defaultWidth)}update(e,t){if(!t){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this.update(e,!0)});return}const{preserve:i,toggleBtn:s,onResize:r,onToggle:o,animation:a}=this.options;if(e=e<this._minWidth?s?0:this._minWidth:Math.min(this._maxWidth,e,this._container.clientWidth),e===this._width)return;const l=!this._width,c=!e;this._width=e,i&&Xe.set(this._storeID,e),this.render(),r==null||r(e),l!==c&&(l&&a&&this.$element.addClass(ku),o==null||o(c)),this.emit("sidebarResize",e)}render(){var h;const{side:e,width:t,$element:i,$parent:s}=this,r=!t,{toggleBtn:o,gutterWidth:a=xi(i.parent().css("gap"))[0]||1,animation:l}=this.options;i.addClass(`sidebar-${e}`).toggleClass("is-collapsed",r).toggleClass("is-expanded",!r).css({"--gutter-width":`${a}px`,width:`var(--sidebar-${e}-width)`,"--sidebar-duration":typeof l=="number"?`${l}ms`:null});let c=i.find(Ia);c.length||(c=y('<div class="sidebar-gutter gutter gutter-horz"></div>').appendTo(i)),o?c.children(".gutter-toggle").length||c.append(`<button class="gutter-toggle" type="button"><span class="chevron-${e}"></span></button>`):c.children(".gutter-resize-handler").length||c.append('<div class="gutter-resize-handler"></div>'),s.addClass(`has-sidebar-${e}`).css(`--sidebar-${e}-width`,`${t}px`).toggleClass(`is-sidebar-${e}-collapsed`,r),(h=this._moveable)!=null&&h.state&&i.removeClass(ku)}}$a.NAME="Sidebar",$a.DEFAULT={minWidth:40,toggleBtn:!0,animation:!0,dragToResize:!0,dbclick:"reset"};const tI="",nI="",iI="";class Tu extends ve{}Tu.NAME="Toolbar",Tu.Component=Be,tt(Db);const sI="";class ks extends Ht{_getRenderOptions(){const{type:e,className:t,title:i,content:s}=this.options;let r=i,o=s;return o===void 0&&(o=r,r=void 0),{...super._getRenderOptions(),title:r,content:o,className:V("tooltip",e,t,r?"tooltip-has-title":""),contentClass:r?"tooltip-content":""}}}ks.NAME="Tooltip",ks.DEFAULT={...Ht.DEFAULT,trigger:"hover",delay:500,closeBtn:!1,popup:!1,name:"tooltip",animation:"fade",destroyOnHide:5e3,hideOthers:!0,hideNewOnHide:!1},ks.register();const rI="",oI="",aI="";class Aa extends ve{}Aa.NAME="Tree",Aa.Component=It,Aa.replace=It.TAG;class Du extends ve{}Du.NAME="SearchTree",Du.Component=Ti,tt(zb);const lI="",cI="",uI="",hI="";class Ea extends We{init(){const{multiple:e,defaultFileList:t,limitSize:i}=this.options;this.fileMap=new Map,this.renameMap=new Map,this.itemMap=new Map,this.dataTransfer=new DataTransfer,this.limitBytes=i?Sn(i):Number.MAX_VALUE,this.currentBytes=0,e||(this.options.limitCount=1),this.$element.addClass("upload"),this.initFileInputCash(),this.initUploadCash(),t&&this.addFileItem(t)}initUploadCash(){const{name:e,uploadText:t,uploadIcon:i,listPosition:s,btnClass:r,tip:o,draggable:a}=this.options;this.$list=y('<ul class="file-list py-1"></ul>');const l=y(`<span class="upload-tip">${o}</span>`);if(!a){if(this.$label=y(`<label class="btn ${r}" for="${e}">${t}</label>`),i){const p=y(`<i class="icon icon-${i}"></i>`);this.$label.prepend(p)}const u=s==="bottom"?[this.$label,l,this.$list]:[this.$list,this.$label,l];this.$element.append(this.$input,...u);return}const c=y(`<span class="text-primary">${t}</span>`);if(i){const u=y(`<i class="icon icon-${i} mr-1"></i>`);c.prepend(u)}this.$label=y(`<label class="draggable-area col justify-center items-center cursor-pointer block w-full h-16" for="${e}"></label>`).append(c).append(l),this.bindDragEvent();const h=s==="bottom"?[this.$label,this.$list]:[this.$list,this.$label];this.$element.append(this.$input,...h)}bindDragEvent(){this.$label.on("dragover",e=>{e.preventDefault(),this.$label.hasClass("border-primary")||(this.$label.removeClass("border-gray"),this.$label.addClass("border-primary")),this.$label.hasClass("dragover")||this.$label.addClass("dragover")}).on("dragleave",e=>{e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover")}).on("drop",e=>{var i;e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover");const t=Array.from(((i=e.dataTransfer)==null?void 0:i.files)??[]);console.log(e.dataTransfer.files),this.addFileItem(t)})}initFileInputCash(){const{name:e,multiple:t,accept:i}=this.options;this.$input=y("<input />").addClass("hidden").prop("type","file").prop("name",e).prop("id",e).prop("multiple",t).on("change",s=>{const r=s.target.files;if(!r)return;const o=[...r];this.addFileItem(o)}),i&&this.$input.prop("accept",i)}addFile(e){const{multiple:t,onSizeChange:i}=this.options;t||(this.renameMap.clear(),this.fileMap.clear(),this.dataTransfer.items.clear(),this.currentBytes=e.size),this.renameMap.set(e.name,e.name),this.fileMap.set(e.name,e),this.dataTransfer.items.add(e),this.$input.prop("files",this.dataTransfer.files),this.currentBytes+=e.size,i==null||i(this.currentBytes)}renameDuplicatedFile(e){if(!this.fileMap.has(e.name))return e;const t=e.name.lastIndexOf(".");if(t===-1)return this.renameDuplicatedFile(new File([e],`${e.name}(1)`));const i=e.name.substring(0,t),s=e.name.substring(t);return this.renameDuplicatedFile(new File([e],`${i}(1)${s}`))}filterFiles(e){const{accept:t}=this.options;if(!t)return e;const i=t.replace(/\s/g,"").split(","),s=[],r=[],o=[];return i.forEach(a=>{a.endsWith("/*")?r.push(a.substring(0,a.length-1)):a.includes("/")?s.push(a):a.startsWith(".")&&o.push(a)}),e.filter(a=>s.includes(a.type)||r.some(l=>a.type.startsWith(l))||o.some(l=>a.name.endsWith(l)))}addFileItem(e){e=this.filterFiles(e);const{multiple:t,limitCount:i,exceededSizeHint:s,onExceededSize:r,exceededCountHint:o,onExceededCount:a,onAdd:l}=this.options;if(t){for(let p of e){if(i&&this.fileMap.size>=i){a==null||a(i),o&&alert(o);return}if(this.currentBytes+p.size>this.limitBytes){r==null||r(this.limitBytes),s&&alert(s);return}p=this.renameDuplicatedFile(p);const m=l==null?void 0:l(p);if(!m)continue;p=m;const v=this.createFileItem(p);this.itemMap.set(p.name,v),this.$list.append(v)}return}if(e.length===0||e[0].size>this.limitBytes)return;let c=this.renameDuplicatedFile(e[0]);const h=l==null?void 0:l(c);if(!h)return;c=h;const u=this.createFileItem(c);this.itemMap.clear(),this.itemMap.set(c.name,u),this.$list.empty().append(u)}deleteFileItem(e){var l,c;const t=this.renameMap.get(e)??e;this.renameMap.delete(e);const i=this.fileMap.get(t);if(!i)return;const{onDelete:s,onSizeChange:r}=this.options,o=this.itemMap.get(i.name);this.itemMap.delete(i.name),o==null||o.addClass("hidden");const a=(l=o==null?void 0:o.find(".file-delete"))==null?void 0:l.data("tooltip");a&&(a.destroy(),(c=a.tooltip)==null||c.remove()),setTimeout(()=>o==null?void 0:o.remove(),3e3),s==null||s(i),this.fileMap.delete(i.name),this.currentBytes-=i.size,r==null||r(this.currentBytes),this.dataTransfer=new DataTransfer,this.fileMap.forEach(h=>this.dataTransfer.items.add(h)),this.$input.prop("files",this.dataTransfer.files)}renameFileItem(e,t){var r,o;const i=this.renameMap.get(e.name);this.renameMap.set(e.name,t),i&&(e=this.fileMap.get(i)??e);const s=this.itemMap.get(e.name);s&&(this.itemMap.set(t,s).delete(e.name),(o=(r=this.options).onRename)==null||o.call(r,t,e.name),this.fileMap.delete(e.name),this.dataTransfer=new DataTransfer,e=new File([e],t),this.fileMap.set(t,e).forEach(a=>this.dataTransfer.items.add(a)),this.$input.prop("files",this.dataTransfer.files))}createFileItem(e){const{showIcon:t}=this.options;return this.addFile(e),y('<li class="file-item my-1 flex items-center gap-2"></li>').append(t?this.fileIcon():null).append(this.createFileInfo(e)).append(this.createRenameContainer(e))}fileIcon(){const{icon:e}=this.options;return y(`<i class="icon icon-${e}"></i>`)}fileRenameBtn(){const{useIconBtn:e,renameText:t,renameIcon:i,renameClass:s}=this.options;if(e){const r=y(`<button class="btn btn-link h-5 w-5 p-0 ${s}"><i class="icon icon-${i}"></i></button>`).prop("type","button").addClass("file-action file-rename");return new ks(r,{title:t}),r}return y("<button />").prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-rename ${s}`).html(t)}fileDeleteBtn(){const{useIconBtn:e,deleteText:t,deleteIcon:i,deleteClass:s}=this.options;if(e){const r=y(`<button class="btn btn-link h-5 w-5 p-0 ${s}"><i class="icon icon-${i}"></i></button>`).prop("type","button").addClass("file-action file-delete");return r.data("tooltip",new ks(r,{title:t})),r}return y("<button />").html(t).prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-delete ${s}`)}fileName(e){return y(`<span class="file-name">${e}</span>`)}fileSize(e){return y(`<span class="file-size text-gray">${vt(e)}</span>`)}createFileInfo(e){const{renameBtn:t,deleteBtn:i,showSize:s}=this.options,r=y('<div class="file-info flex items-center gap-2"></div>');return r.append(this.fileName(e.name)),s&&r.append(this.fileSize(e.size)),t&&r.append(this.fileRenameBtn().on("click",o=>{r.addClass("hidden").closest(".file-item").find(".input-rename-container.hidden").removeClass("hidden");const a=y(o.target).closest("li").find("input")[0];a.focus(),a.value.lastIndexOf(".")!==-1&&a.setSelectionRange(0,a.value.lastIndexOf("."))})),i&&r.append(this.fileDeleteBtn().on("click",()=>this.deleteFileItem(e.name))),r}createRenameContainer(e){const{confirmText:t,cancelText:i,duplicatedHint:s,onDuplicated:r}=this.options,o=y('<div class="input-group input-rename-container hidden"></div>'),a=y("<input />").addClass("form-control").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).on("keydown",u=>{if(u.key==="Enter"){const p=o.closest(".file-item"),m=p.find(".file-name");if(m.html()===a.val()){o.addClass("hidden"),p.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),s&&alert(s);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),p.find(".file-info.hidden").removeClass("hidden"),m.html(a.val())}else u.key==="Escape"&&(a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden"))}),l=y("<button />").addClass("btn primary rename-confirm-btn").prop("type","button").html(t).on("click",()=>{const u=o.closest(".file-item"),p=u.find(".file-name");if(p.html()===a.val()){o.addClass("hidden"),u.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),s&&alert(s);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),u.find(".file-info.hidden").removeClass("hidden"),p.html(a.val())}),c=y("<button />").prop("type","button").addClass("btn rename-cancel-btn").html(i).on("click",()=>{a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden")}),h=y('<div class="btn-group"></div').append(l).append(c);return o.append(a).append(h)}}Ea.NAME="Upload",Ea.DEFAULT={uploadText:"上传文件",confirmText:"确定",cancelText:"取消",useIconBtn:!0,renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!0,multiple:!0,listPosition:"bottom",limitSize:!1,icon:"file-o",btnClass:"",tip:"",draggable:!1,showSize:!0,onAdd:n=>n};const dI="";class Iu extends Ea{init(){this.initUploadButtonItemCash(),this.options.onSizeChange=()=>{this.$uploadInfo.html(this.options.totalCountText.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.fileMap.size>0?(this.$tip.remove(),this.$list.append(this.$uploadButtonItem)):(this.$uploadButtonItem.remove(),this.$label.append(this.$tip))},super.init(),this.$list.addClass("flex")}initUploadButtonItemCash(){this.$uploadButtonItem=y(`<label class="upload-button-item order-last" for="${this.options.name}" />`).addClass("flex justify-center items-center cursor-pointer").css({width:120,height:120,background:"var(--color-slate-100)"}).append(y('<i class="icon icon-plus" />'))}initUploadCash(){const{name:e,tip:t,uploadText:i,uploadIcon:s,totalCountText:r}=this.options;this.$list=y('<ul class="file-list py-1 flex-wrap gap-x-4 gap-y-4"></ul>'),this.$label=y('<div class="draggable-area relative block w-full border border-dashed border-gray"></div>').css({minHeight:64});const o=y(`<label for="${e}" class="text-primary cursor-pointer">${i}</label>`);if(s){const a=y(`<i class="icon icon-${s} mr-1"></i>`);o.prepend(a)}this.$tip=y('<div class="absolute inset-0 col justify-center items-center"></div>').append(o),t&&this.$tip.append(y(`<span class="upload-tip">${t}</span>`)),this.$label.append(this.$tip),this.$label.append(this.$input,this.$list),this.bindDragEvent(),this.$element.append(this.$label),this.$uploadInfo=y('<div class="py-1" />').css({color:"var(--color-slate-500)"}).html(r.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.$element.append(this.$uploadInfo)}filterFiles(e){const{accept:t}=this.options;if(t==="image/*")return e.filter(s=>s.type.includes("image"));const i=t.replace(/\s/g,"").replace(/\./g,"image/").split(",");return e.filter(s=>i.includes(s.type))}createFileItem(e){const t=super.createFileItem(e).addClass("relative").removeClass("flex items-center gap-2 my-1");this.setImageUrl(e,t);const{deleteBtn:i,showSize:s}=this.options;return i&&t.append(this.fileDeleteBtn().addClass("absolute right-0 top-0 text-white").css({background:"var(--color-slate-500)"}).on("click",()=>this.deleteFileItem(e.name))),s&&t.append(this.fileSize(e.size).addClass("file-size label text-white circle darker absolute px-1 hidden").removeClass("text-gray").css({top:96,left:4})),t}setImageUrl(e,t){const i=new FileReader;i.onload=()=>{y('<div class="img flex-none" />').addClass("rounded").css({backgroundImage:`url(${i.result})`,backgroundSize:"cover"}).prependTo(t)},i.readAsDataURL(e)}createFileInfo(e){const t=this.fileRenameBtn().addClass("flex-none").on("click",s=>{const r=y(s.target).closest(".file-item");r.find(".file-info").addClass("hidden"),r.find(".input-rename-container").removeClass("hidden");const o=r.find("input")[0];o.focus(),o.value.lastIndexOf(".")!==-1&&o.setSelectionRange(0,o.value.lastIndexOf("."))});return y('<div class="file-info flex justify-between items-center"></div>').css({width:120}).append(y(`<div class="file-name py-1 ellipsis">${e.name}</div>`)).append(t)}createRenameContainer(e){const{duplicatedHint:t,onDuplicated:i}=this.options,s=y("<input />").addClass("input-rename-container border-primary border hidden").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).css({width:120}).on("keydown",r=>{if(r.key==="Enter"){const o=s.closest(".file-item").find(".file-name");if(o.html()===s.val()){s.addClass("hidden"),o.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(s.val())){i==null||i(s.val()),t&&alert(t);return}this.renameFileItem(e,s.val()),s.addClass("hidden"),o.html(s.val()).closest(".file-info").removeClass("hidden")}else r.key==="Escape"&&s.val(e.name).addClass("hidden").closest(".file-item").find(".file-name").removeClass("hidden")}).on("blur",()=>{const r=s.closest(".file-item").find(".file-name");if(r.html()===s.val()){s.addClass("hidden"),r.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(s.val())){i==null||i(s.val()),t&&alert(t);return}this.renameFileItem(e,s.val()),s.addClass("hidden"),r.html(s.val()).closest(".file-info").removeClass("hidden")});return s}}Iu.NAME="UploadImgs",Iu.DEFAULT={uploadText:"添加文件",renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!1,multiple:!0,limitSize:!1,btnClass:"",draggable:!0,accept:"image/jpg, image/jpeg, image/gif, image/png",showSize:!0,useIconBtn:!0,totalCountText:'共 <span class="font-bold text-black">%s</span> 个文件 <span class="font-bold text-black">%s</span> 个文件等待上传。'};const $u=Symbol("batch-form"),Au=class Td extends We{constructor(){super(...arguments),this._actions=null,this._cols=[],this._idSeed=0,this._rows=[]}afterInit(){var s;const e=y(this.element),t=e.find(".form-batch-table").addClass("borderless");let i=t.find("tbody");i.length||(i=y("<tbody/>").appendTo(t)),this.$tbody=i,this._template=(s=e.find(".form-batch-template").get(0))==null?void 0:s.innerHTML,this._cols=[],t.find("thead>tr>.form-batch-head").each((r,o)=>{const a=y(o),l=a.data();l&&(l.hidden=a.hasClass("hidden"),this._cols.push(l)),a.data("name")==="ACTIONS"&&a.addClass("form-batch-col-actions")}),this.options.fixedActions&&(e.addClass("has-fixed-actions"),this._sticky=new Ao(e,{side:"right",offset:0,scrollContainer:".form-batch-container",targets:'td[data-name="ACTIONS"],th[data-name="ACTIONS"]'})),e.on("click",r=>{var h;const o=y(r.target).closest(".form-batch-btn");if(!o.length)return;const a=o.dataset("type"),l=o.closest("tr"),c=l.dataset("index");a==="add"?this.addRow(c):a==="delete"?this.deleteRow(c):a==="ditto"&&this.toggleDitto(o),(h=this.options.onClickAction)==null||h.call(this,a,l,c)}).on("change",".form-batch-input,.pick-value",r=>{const o=y(r.target);r.___td===$u||o.hasClass("pick-value")&&!r.___td||this.syncDitto(o)}).on("change",'[type="radio"],[type="checkbox"]',r=>{Td.updateCheckValues(y(r.target))}),this.options.sortable&&(this._sortable=new qo(i,{draggable:"tr",handle:'.form-batch-btn[data-type="sort"]',dataIdAttr:"data-gid",ghostClass:"bg-primary-50",onSort:()=>{this._rows=this._sortable.toArray().map(Number),this.render()},dragShadow:!1,...typeof this.options.sortable=="object"?this.options.sortable:{}})),this.render()}destroy(){var e;y(this.element).off("click change"),this.$tbody=void 0,this._template=void 0,this._cols.length=0,this._rows.length=0,(e=this._sticky)==null||e.destroy()}render(e,t){super.render(e,t),!t&&this._rows.length?this._renderRows():(this._actions=null,this._initRows())}addRow(e,t){return t=t??this._idSeed++,typeof e=="number"&&e>=0&&e<=this._rows.length?this._rows.splice(e+1,0,t):(e=this._rows.length,this._rows.push(t)),this._renderRows(void 0,e),t}deleteRow(e){var i;if(this._rows.length<=1||typeof e!="number"||e<0||e>=this._rows.length)return!1;const t=this._rows[e];this._rows.splice(e,1),(i=this.$tbody)==null||i.children(`[data-gid="${t}"]`).remove(),this._renderRows(void 0,e)}deleteRowByGid(e){return this.deleteRow(this._rows.indexOf(e))}toggleDitto(e,t){const i=e.closest("td");t=t??i.attr("data-ditto")!=="on",i.attr("data-ditto",t?"on":"off"),t&&i.closest("tr").prev("tr").find(`td[data-name="${i.data("name")}"]`).find(".form-batch-input,.pick-value").each((o,a)=>{this.syncDitto(y(a),!1)})}syncDitto(e,t=!0,i=!1){const s=e.closest("td");t&&s.attr("data-ditto","off");const r=s.data("name"),a=(e.hasClass("pick-value")?e.closest(".form-group-wrapper"):e).attr("data-name"),l=`td[data-name="${r}"][data-ditto="on"]`,c=e.val();let h=e.closest("tr").next("tr"),u=h.find(l);for(;u.length;){const p=u.find(`.form-batch-input[data-name="${a}"]`);if(p.length&&p.val()!==c)p.val(c).trigger("change",$u);else{const m=u.find(".pick").parent().zui();m&&m.$&&m.$element.attr("data-name")===a&&m.$.value!==c&&m.$.setValue(c,!0).then(()=>{m.$element.find(".pick-value").trigger("change",$u)})}if(i)break;h=h.next("tr"),u=h.find(l)}}toggleCols(e,t){const i=this.$element.find(".form-batch-table").find("th.form-batch-head,td.form-batch-control");i.length&&(typeof e=="string"&&(e=[e]),e.forEach(s=>{const r=this._cols.find(o=>o.name===s);r&&(r.hidden=!t,i.filter(`[data-name="${s}"]`).toggleClass("hidden",!t),t&&requestAnimationFrame(()=>{i.filter(".form-batch-ditto-control").each((o,a)=>{const l=y(a),c=l.find(".form-batch-ditto-btn");l.css("--form-batch-ditto-width",`${c.outerWidth()}px`)})}))}))}_initRows(){const e=this.$tbody;if(!this._template||!(e!=null&&e.length))return;const{data:t=[],minRows:i,maxRows:s,mode:r,rowsCount:o=r==="add"?Math.min(Math.max(1,s??100),Math.max(1,i??(r==="add"?10:1),t.length)):t.length}=this.options;this._rows=Array(o).fill(0).map((a,l)=>l),this._idSeed=this._rows.length,this._renderRows(t)}_renderRows(e=[],t=0){var s;const i=this._rows.length;for(let r=t;r<i;r++)this._renderRow(r,e[r]);(s=this.$tbody)==null||s.attr("data-count",`${i}`)}_renderActions(e){var i;let t=this._actions;if(!t){const{addRowIcon:s="icon-plus",deleteRowIcon:r="icon-trash",sortRowIcon:o="icon-move",sortable:a}=this.options;t=new DocumentFragment;const l='<button type="button" data-type="{type}" class="form-batch-btn btn square ghost size-sm" title="{text}"><i class="icon {icon}"></i></button>';let{actions:c}=this.options;c===void 0&&(c=[],o!==!1&&a&&c.push("sort"),s!==!1&&c.push("add"),r!==!1&&c.push("delete"));const h={sort:{type:"sort",icon:o||"",text:this.i18n("sort"),className:"cursor-move"},add:{type:"add",icon:s||"",text:this.i18n("add")},delete:{type:"delete",icon:r||"",text:this.i18n("delete")}};c.forEach(u=>{typeof u=="string"&&(u={type:u});const p=y.extend({},h[u.type],u),m=y(we(l,p));p.className&&m.addClass(p.className),t.append(m[0])}),(i=this.options.onRenderActions)==null||i.call(this,t),this._actions=t,this.$element.find('.form-batch-head[data-name="ACTIONS"]').attr("data-action-count",t.children.length+"")}e.empty().append(t.cloneNode(!0))}_renderRow(e,t){const i=this.$tbody,s=String(this._rows[e]),{idKey:r="id",mode:o,onRenderRowCol:a,onRenderRow:l}=this.options,c=o==="add",h=String(t&&t[r]!==void 0?t[r]:e+1);let u=i.children(`[data-gid="${s}"]`),p=!1;if(u.length){if(!t&&u.dataset("index")===e)return}else{p=!0;let C=this._template;if((C.includes(" zui-create ")||C.includes(" zui-create="))&&(C=C.replace(/(id|for)="([\\$a-z_]+)"/g,`$1="$2_${s}"`)),C.includes("<script>")&&C.includes('zui.create("')){const S=[];C=C.replace(/(zui\.create\("[a-zA-Z]+","#)(\w+)(",)/g,(D,N,P,H)=>(S.push(P),`${N}${P}_${s}${H}`)),S.forEach(D=>{const N=`${D}_${s}`;C=C.replace(`id="${D}"`,`id="${N}"`)})}C=C.replaceAll("{GID}",s),u=y(C.trim()).attr("data-gid",s),u.find('[type="radio"],[type="checkbox"]').each((S,D)=>{const N=y(D),P=N.attr("id"),H=`${P}_${s}`;N.attr("id",H),u.find(`label[for="${P}"]`).attr("for",H)}),u.zuiInit({onCreate:(S,D)=>(typeof D.name=="string"&&(D.name=`${D.name}[${h}]`),D)})}const m=this._rows[e-1],v=i.children(`[data-gid="${m}"]`);u.attr("data-index",`${e}`),u.find("textarea").autoHeight(),u.on("inited",(C,[S])=>{let D=S.options.name;if(D){const N=D.split("[");N.length>1&&N.pop(),D=N.join("[");const P=S.$element.closest("td");if(S.$element.attr("data-name",D),v.length&&P.data("ditto")==="on"){const H=v.find(`td[data-name="${P.data("name")}"]`);this.syncDitto(H.find(`[data-name="${D}"] .pick-value`),!1,!0)}else t&&t[D]!==void 0&&S.$.setValue(t[D],!0)}}),t&&u.data("data",t),e?v.length?v.after(u):u.appendTo(i):u.prependTo(i),p&&u.find("script").remove();const b=t||u.data("data");this._cols.forEach(C=>{let S=u.find(`td[data-name="${C.name}"]`);if(S.length||(S=y(`<td data-name="${C.name}"></td>`).appendTo(u)),C.index){S.find(".form-control-static").text(h).attr("id",`${C.name}_${s}`),a==null||a.call(this,S,C,b,e);return}if(S.toggleClass("hidden",!!C.hidden),!S.data("init")||t){if(C.name==="ACTIONS"){if(S.addClass("form-batch-col-actions"),!c)return;this._renderActions(S);return}S.data("init",1).find("[name],.form-control-static").each((N,P)=>{const H=y(P);if(H.hasClass("form-control-static")){const q=H.attr("data-name");t&&H.text(String(t[q]??""))}else{const q=H.attr("name"),Y=`${q}[${h}]`;if(H.attr({name:Y,"data-name":q}).addClass("form-batch-input"),t&&t[q]!==void 0){const Q=String(t[q]??"");if(H.is('[type="radio"]'))H.prop("checked",Q===H.val());else if(H.is('[type="checkbox"]')){const Z=new Set(Q.split(","));H.prop("checked",Z.has(H.val()))}else H.val(Q)}}}),S.find('[type="radio"],[type="checkbox"]').each((N,P)=>{const H=y(P);typeof H.attr("data-name")!="string"||H.attr("data-val")!==void 0||Td.updateCheckValues(H,S,h)})}else S.find("[name]").each((N,P)=>{const H=y(P),q=H.attr("data-name");if((H.attr("name")??"").startsWith(`${q}[`)){if(H.attr("name",`${q}[${h}]`),H.is('[type="radio"]'))H.prop("checked",H.val()===H.attr("data-val"));else if(H.is('[type="checkbox"]')){const Y=new Set(H.attr("data-val").split(","));Y.size>1&&H.attr("name",`${q}[${h}][]`),H.prop("checked",Y.has(H.val()))}}}),S.find(".pick").each((N,P)=>{var q;const H=y(P).parent();(q=H.zui())==null||q.render({name:`${H.data("name")}[${h}]`})});if(C.ditto){S.addClass("form-batch-ditto");let N=S.find(".form-batch-ditto-btn");if(e){const{defaultDitto:P="on"}=C;if(S.attr("data-ditto",P),!N.length){N=y(`<button type="button" class="btn ghost form-batch-btn form-batch-ditto-btn" data-type="ditto">${this.i18n("ditto")}</button>`);let H=S.children(".form-batch-ditto-wrapper");H.length||(H=y('<div class="form-batch-ditto-wrapper"></div>').append(S.children()).appendTo(S)),H.append(N)}requestAnimationFrame(()=>S.css("--form-batch-ditto-width",`${N.outerWidth()}px`)),P==="on"&&v.find(`td[data-name="${C.name}"]`).find(".form-batch-input").each((q,Y)=>{this.syncDitto(y(Y),!1,!0)})}else S.attr("data-ditto",""),N.remove()}const D=!!(C.ditto&&e);S.toggleClass("form-batch-ditto-control",D),S.find(".form-batch-ditto-btn").toggle(D),a==null||a.call(this,S,C,b,e)}),l==null||l.call(this,u,e,b)}static updateCheckValues(e,t,i){const s=e.attr("data-name");if(typeof s!="string")return;const r=e.attr("type");t=t||e.closest("td");const o=t.find(`[type="${r}"][data-name="${s}"]`);i!==void 0&&r==="checkbox"&&o.length>1&&o.attr("name",`${s}[${i}][]`);const a=[];o.filter(":checked").each((c,h)=>{a.push(y(h).val())});const l=r==="radio"?a[0]:a.join(",");o.attr("data-val",l)}};Au.NAME="BatchForm",Au.DEFAULT={mode:"add",idKey:"id",i18n:{zh_cn:{ditto:"同上",delete:"删除",add:"添加",sort:"排序"},zh_tw:{ditto:"同上",delete:"刪除",add:"添加",sort:"排序"},en:{ditto:"Ditto",delete:"Delete",add:"Add",sort:"Sort"}}};let px=Au;const fI="";function mx(n){return typeof n=="string"?n.split(",").map(e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t}):n}let Eu=class extends me{constructor(){super(...arguments),this._canvas=he(),this._timer=0,this._needDraw=!1}componentDidMount(){var t;this.tryDraw=this.tryDraw.bind(this),this.tryDraw();const e=(t=this._canvas.current)==null?void 0:t.parentElement;if(this.props.responsive!==!1){if(e&&typeof ResizeObserver<"u"){const i=new ResizeObserver(this.tryDraw);i.observe(e),this._rob=i}this._rob||window.addEventListener("resize",this.tryDraw)}if(e&&typeof IntersectionObserver<"u"){const i=new IntersectionObserver(s=>{this._needDraw&&s.some(r=>r.isIntersecting)&&this.tryDraw()});i.observe(e),this._iob=i}}componentDidUpdate(){this.tryDraw()}componentWillUnmount(){var e;(e=this._rob)==null||e.disconnect(),window.removeEventListener("resize",this.tryDraw)}tryDraw(){this._timer&&cancelAnimationFrame(this._timer),this._timer=requestAnimationFrame(()=>{this.draw(),this._timer=0})}draw(){const e=this._canvas.current;if(!e)return;const t=e.parentElement,{width:i,height:s,responsive:r=!0}=this.props;let o=i||t.clientWidth,a=s||t.clientHeight;if(i&&s&&r&&(o=t.clientWidth,a=Math.floor(s*o/i)),e.style.width=`${o}px`,e.style.height=`${a}px`,o=o*(window.devicePixelRatio||1),a=a*(window.devicePixelRatio||1),e.width=o,e.height=a,!y(t).isVisible()&&this._iob){this._needDraw=!0;return}const{lineSize:l=1,scaleLine:c=!1,scaleLineSize:h,scaleLineGap:u=1,scaleLineDash:p,referenceLine:m,referenceLineSize:v,referenceLineDash:b,color:C="#2c78f1",fillColor:S=["rgba(46, 127, 255, 0.3)","rgba(46, 127, 255, 0.05)"],lineDash:D=[],bezier:N}=this.props,P=mx(this.props.data);if(!P.length)return;const H=Math.floor(o/(P.length-1)),q=Math.max(...P.filter(ue=>ue!==null)),Y=P.map((ue,J)=>{const se=typeof ue!="number";return{x:J*H,y:se?a:Math.round((1-ue/q)*(a-l)),empty:se}});let Q=Y[0];const Z=e.getContext("2d");if(c){const ue=typeof c=="string"?c:"rgba(100,100,100,.1)";Z.strokeStyle=ue,Z.lineWidth=h||l,p&&Z.setLineDash(p);for(let J=0;J<Y.length;++J){if(J%u!==0)continue;const se=Y[J];Z.moveTo(se.x,0),Z.lineTo(se.x,a)}Z.stroke()}if(m&&Y.length>1){const ue=typeof m=="string"?m:"rgba(100,100,100,.2)",J=Y[Y.length-1];Z.moveTo(J.x,a),Z.strokeStyle=ue,Z.lineWidth=v||l,Z.lineTo(Q.x,Q.y),b&&Z.setLineDash(b),Z.stroke()}for(Z.setLineDash(D);Y.length&&Y[Y.length-1].empty;)Y.pop();if(S){const ue=Y[Y.length-1];if(Z.beginPath(),Z.moveTo(0,a),Z.lineTo(Q.x,Q.y),N){const J=Math.round(H/2);for(let se=1;se<Y.length;++se){const ye=Y[se],_e=Math.round((ye.y-Q.y)/5);Z.bezierCurveTo(Q.x+J,Q.y+_e,ye.x-J,ye.y-_e,ye.x,ye.y),Q=ye}}else for(let J=1;J<Y.length;++J)Q=Y[J],Z.lineTo(Q.x,Q.y);if(Z.lineTo(ue.x,a),Array.isArray(S)){const J=Z.createLinearGradient(0,0,0,a);for(let se=0;se<S.length;++se)J.addColorStop(se/(S.length-1),S[se]);Z.fillStyle=J}else Z.fillStyle=S;Z.fill()}if(Q=Y[0],Z.beginPath(),Z.moveTo(Q.x,Q.y),N){const ue=Math.round(H/2);for(let J=1;J<Y.length;++J){const se=Y[J],ye=Math.round((se.y-Q.y)/5);Z.bezierCurveTo(Q.x+ue,Q.y+ye,se.x-ue,se.y-ye,se.x,se.y),Q=se}}else for(let ue=1;ue<Y.length;++ue)Q=Y[ue],Z.lineTo(Q.x,Q.y);Z.strokeStyle=C,Z.lineWidth=l,Z.stroke()}render(){const{style:e,className:t,canvasClass:i}=this.props;return w("div",{class:"center burn-chart",className:t,style:e},w("canvas",{className:i,ref:this._canvas}))}};Eu.defaultProps={responsive:!0,lineSize:1,scaleLine:!1,scaleLineSize:1,bezier:!0};class Nu extends ve{}Nu.NAME="Burn",Nu.Component=Eu;class tg extends Ke{_getClassName(e){return["datalist",e.className]}_getProps(e){return ke(super._getProps(e),e.labelWidth?{style:{"--datalist-label-width":Ge(e.labelWidth)}}:null)}_getChildren(){const{items:e=[]}=this.props;return e.map((t,i)=>{const{key:s=i,className:r,label:o,labelStyle:a,labelClass:l,labelAttrs:c,content:h,contentStyle:u,contentClass:p,contentAttrs:m,...v}=t;return w("div",{key:s,className:V("datalist-item",r),...v},w("div",{className:V("datalist-item-label",l),style:a,...c},w(ge,{content:o})),w("div",{className:V("datalist-item-content",p),style:u,...m},w(ge,{content:h})))})}}tt(Object.freeze(Object.defineProperty({__proto__:null,Datalist:tg},Symbol.toStringTag,{value:"Module"})));const mI="",gx="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ei=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n));for(;n--;)e+=gx[t[n]&63];return e};const gI="";class ng extends me{constructor(t){super(t);qt(this,ii,void 0);qt(this,si,void 0);Xt(this,ii,0),Xt(this,si,null),this._handleWheel=i=>{const{wheelContainer:s}=this.props,r=i.target;if(!(!r||!s)&&(typeof s=="string"&&r.closest(s)||typeof s=="object")){const o=(this.props.type==="horz"?i.deltaX:i.deltaY)*(this.props.wheelSpeed??1);this.scrollOffset(o)&&i.preventDefault()}},this._handleMouseMove=i=>{const{dragStart:s}=this.state;s&&(Rt(this,ii)&&cancelAnimationFrame(Rt(this,ii)),Xt(this,ii,requestAnimationFrame(()=>{const r=this.props.type==="horz"?i.clientX-s.x:i.clientY-s.y;this.scroll(s.offset+r*this.props.scrollSize/this.props.clientSize),Xt(this,ii,0)})),i.preventDefault())},this._handleMouseUp=()=>{this.state.dragStart&&this.setState({dragStart:!1})},this._handleMouseDown=i=>{this.state.dragStart||this.setState({dragStart:{x:i.clientX,y:i.clientY,offset:this.scrollPos}}),i.preventDefault(),i.stopPropagation()},this._handleClick=i=>{const s=i.currentTarget;if(!s)return;const r=s.getBoundingClientRect(),{type:o,clientSize:a,scrollSize:l}=this.props,c=(o==="horz"?i.clientX-r.left:i.clientY-r.top)-this.barSize/2;this.scroll(c*l/a),i.preventDefault()},this.state={scrollPos:this.props.defaultScrollPos??0,dragStart:!1}}get scrollPos(){return this.props.scrollPos??this.state.scrollPos}get controlled(){return this.props.scrollPos!==void 0}get maxScrollPos(){const{scrollSize:t,clientSize:i}=this.props;return Math.max(0,t-i)}get barSize(){const{clientSize:t,scrollSize:i,size:s=12,minBarSize:r=3*s}=this.props;return Math.max(Math.round(t*t/i),r)}componentDidMount(){document.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp);const{wheelContainer:t}=this.props;t&&(Xt(this,si,typeof t=="string"?document:t.current),Rt(this,si).addEventListener("wheel",this._handleWheel,{passive:!1}))}componentWillUnmount(){document.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),Rt(this,si)&&Rt(this,si).removeEventListener("wheel",this._handleWheel)}scroll(t){return t=Math.max(0,Math.min(Math.round(t),this.maxScrollPos)),t===this.scrollPos?!1:(this.controlled?this._afterScroll(t):this.setState({scrollPos:t},this._afterScroll.bind(this,t)),!0)}scrollOffset(t){return this.scroll(this.scrollPos+t)}_afterScroll(t){const{onScroll:i}=this.props;i&&i(t,this.props.type??"vert")}render(){const{clientSize:t,type:i,size:s=12,className:r,style:o,left:a,top:l,bottom:c,right:h}=this.props,{maxScrollPos:u,scrollPos:p}=this,{dragStart:m}=this.state,v={left:a,top:l,bottom:c,right:h,...o},b={};return i==="horz"?(v.height=s,v.width=t,b.width=this.barSize,b.left=Math.round(Math.min(u,p)*(t-b.width)/u)):(v.width=s,v.height=t,b.height=this.barSize,b.top=Math.round(Math.min(u,p)*(t-b.height)/u)),k("div",{className:V("scrollbar",r,{"is-vert":i==="vert","is-horz":i==="horz","is-dragging":m}),style:v,onMouseDown:this._handleClick,children:k("div",{className:"scrollbar-bar",style:b,onMouseDown:this._handleMouseDown})})}}ii=new WeakMap,si=new WeakMap;const Na=new Map,Ma=[];function ig(n,e){const{name:t}=n;if(!(e!=null&&e.override)&&Na.has(t))throw new Error(`DTable: Plugin with name ${t} already exists`);Na.set(t,n),e!=null&&e.buildIn&&!Ma.includes(t)&&Ma.push(t)}function He(n,e){ig(n,e);const t=i=>{if(!i)return n;const{defaultOptions:s,...r}=n;return{...r,defaultOptions:{...s,...i}}};return t.plugin=n,t}function sg(n){return Na.delete(n)}function rg(n){if(typeof n=="string"){const e=Na.get(n);return e||console.warn(`DTable: Cannot found plugin "${n}"`),e}if(typeof n=="function"&&"plugin"in n)return n.plugin;if(typeof n=="object")return n;console.warn("DTable: Invalid plugin",n)}function og(n,e,t){return e.forEach(i=>{var r;if(!i)return;const s=rg(i);s&&(t.has(s.name)||((r=s.plugins)!=null&&r.length&&og(n,s.plugins,t),n.push(s),t.add(s.name)))}),n}function yx(n=[],e=!0){if(e&&Ma.length&&n.unshift(...Ma),!(n!=null&&n.length))return[];const t=og([],n,new Set),i=[],s=t.reduce((r,o,a)=>{var l;return r.set(o.name,a*1e3),(l=o.requireAfter)!=null&&l.length&&i.push(o),r},new Map);return i.length&&(i.forEach(r=>{const o=r.requireAfter.reduce((a,l)=>(s.has(l)&&a.push(s.get(l)),a),[]);o.length&&s.set(r.name,Math.max(...o)+1)}),t.sort((r,o)=>s.get(r.name)-s.get(o.name))),t}function ag(){return{cols:[],data:[],rowKey:"id",width:"100%",height:"auto",rowHeight:35,defaultColWidth:80,minColWidth:24,maxColWidth:9999,header:!0,footer:void 0,headerHeight:0,footerHeight:0,rowHover:!0,colHover:!1,cellHover:!1,bordered:!1,striped:!0,responsive:!1,scrollbarHover:!0,horzScrollbarPos:"outside"}}function lg(n,e,t){return n&&(e&&(n=Math.max(e,n)),t&&(n=Math.min(t,n))),n}function cg(n,e){return typeof n=="string"&&(n=n.endsWith("%")?parseFloat(n)/100:parseFloat(n)),typeof e=="number"&&(typeof n!="number"||isNaN(n))&&(n=e),n}function Mu(n,e=!1,t=0){if(!n.list.length)return;if(e&&n.widthSetting&&(n.widthSetting=Math.min(n.widthSetting,n.width)),t&&(!n.widthSetting||n.widthSetting>t)&&n.width>t&&(n.widthSetting=t),n.widthSetting&&n.width!==n.widthSetting){n.width=n.widthSetting;const s=n.width-n.totalWidth;if(!e&&s>0||e&&s!==0){const r=n.flexList.length?n.flexList:n.list,o=r.reduce((a,l)=>a+(l.flex||1),0);r.forEach(a=>{const l=Math[s<0?"max":"min"](s,Math.ceil(s*((a.flex||1)/o)));a.realWidth=a.width+l})}}let i=0;n.list.forEach((s,r)=>{s.realWidth||(s.realWidth=s.width),s.left=i,s.sideIndex=r,i+=s.realWidth})}function ug(n){return n?n==="left"?"left":"right":"center"}function vx(n,e,t,i){const{defaultColWidth:s,minColWidth:r,maxColWidth:o,fixedLeftWidth:a=0,fixedRightWidth:l=0}=e,c=P=>(typeof P=="function"&&(P=P.call(n)),P=cg(P,0),P<1&&(P=Math.round(P*i)),P),h={width:0,list:[],flexList:[],widthSetting:0,totalWidth:0},u={...h,list:[],flexList:[],widthSetting:c(a)},p={...h,list:[],flexList:[],widthSetting:c(l)},m={left:u,center:h,right:p},v=[],b={};let C=!1;const S=[],D={};if(t.forEach(P=>{const{colTypes:H,onAddCol:q}=P;H&&Object.entries(H).forEach(([Y,Q])=>{D[Y]||(D[Y]=[]),D[Y].push(Q)}),q&&S.push(q)}),e.cols.forEach((P,H)=>{if(P.hidden)return;const{type:q="",name:Y}=P,Q={fixed:!1,flex:!1,width:s,minWidth:r,maxWidth:o,...P,type:q},Z={name:Y,type:q,setting:Q,flex:0,left:0,width:0,realWidth:0,visible:!0,index:H,side:ug(Q.fixed),sideIndex:0,order:Q.order,border:Q.border},ue=D[q];ue&&ue.forEach(Oe=>{const ce=typeof Oe=="function"?Oe.call(n,Q):Oe;ce&&Object.assign(Q,ce,P)});const{flex:J,minWidth:se=r,maxWidth:ye=o}=Q,_e=cg(Q.width||s,s);Z.flex=J===!0?1:typeof J=="number"?J:0,Z.width=lg(_e<1?Math.round(_e*i):_e,se,ye),Z.side=ug(Q.fixed),S.forEach(Oe=>Oe.call(n,Z)),v.push(Z),b[Z.name]=Z;const Ee=m[Z.side];Ee.list.push(Z),Ee.totalWidth+=Z.width,Ee.width=Ee.totalWidth,Z.flex&&Ee.flexList.push(Z),typeof Z.order=="number"&&(C=!0)}),C){const P=(H,q)=>(H.order??H.index)-(q.order??q.index);v.sort(P),u.list.sort(P),h.list.sort(P),p.list.sort(P)}Mu(p,!0);const N=i-p.width-Math.max(40,r);return Mu(u,!0,N),h.widthSetting=i-u.width-p.width,Mu(h),{list:v,map:b,...m}}function _x(n){var ce;const{col:e,className:t,height:i,row:s,onRenderCell:r,style:o,outerStyle:a,children:l,outerClass:c,width:h,left:u,top:p,...m}=n,v={left:u??e.left,top:p??s.top,width:h??e.realWidth,height:i,...a},{align:b,cellStyle:C,cellClass:S,className:D}=e.setting,N={justifyContent:b?b==="left"?"start":b==="right"?"end":b:void 0,...C,...o},{name:P,border:H}=e,q=["dtable-cell",c,t,D,{"has-border-left":H===!0||H==="left","has-border-right":H===!0||H==="right"}],Y=["dtable-cell-content",S],Q=(ce=s.data)==null?void 0:ce[P],Z=[l??Q??""],ue=r?r(Z,{row:s,col:e,value:Q},n,w):Z,J=[],se=[],ye={},_e={};let Ee="div";ue==null||ue.forEach(ee=>{if(typeof ee=="object"&&ee&&!$.isValidElement(ee)&&("html"in ee||"className"in ee||"style"in ee||"attrs"in ee||"children"in ee||"tagName"in ee)){const Se=ee.outer?J:se;ee.html?Se.push(k("div",{className:V("dtable-cell-html",ee.className),style:ee.style,dangerouslySetInnerHTML:{__html:ee.html},...ee.attrs??{}})):(ee.style&&Object.assign(ee.outer?v:N,ee.style),ee.className&&(ee.outer?q:Y).push(ee.className),ee.children&&Se.push(ee.children),ee.attrs&&Object.assign(ee.outer?ye:_e,ee.attrs)),ee.tagName&&!ee.outer&&(Ee=ee.tagName)}else(typeof ee!="object"||$.isValidElement(ee))&&se.push(ee)});const Oe=Ee;return k("div",{className:V(q),style:v,"data-col":P,"data-row":s.id,"data-type":e.type||null,...m,...ye,children:[se.length>0&&k(Oe,{className:V(Y),style:N,..._e,children:se}),J]})}function Pu({rows:n=[],cols:e,rowHeight:t,scrollLeft:i=0,scrollTop:s=0,left:r=0,top:o=0,width:a,height:l="100%",className:c,CellComponent:h=_x,cellClass:u,onRenderCell:p}){var C;const m=Array.isArray(n)?n:[n],v=((C=m[0])==null?void 0:C.top)??0,b=m.length;return k("div",{className:V("dtable-cells",c),style:{top:o,left:r,width:a,height:l},children:k("div",{className:"dtable-cells-container",style:{left:-i,top:-s+v},children:m.reduce((S,D,N)=>{const P=e.length;return e.forEach((H,q)=>{S.push(k(h,{className:V(`is-${D.index%2?"odd":"even"}-row`,q?"":"is-first-in-row",q===P-1?"is-last-in-row":"",N?"":"is-first-row",N===b-1?"is-last-row":"",u),col:H,row:D,top:D.top-v,height:t,onRenderCell:p},`${D.index}:${H.name}`))}),S},[])})})}function hg({top:n,height:e,rowHeight:t,rows:i,cols:{left:s,center:r,right:o},scrollLeft:a,scrollTop:l,className:c,cellClass:h,style:u,onRenderCell:p,children:m}){let v=null;s.list.length&&(v=k(Pu,{className:"dtable-fixed-left",rows:i,scrollTop:l,cols:s.list,width:s.width,rowHeight:t,cellClass:h,onRenderCell:p},"left"));let b=null;r.list.length&&(b=k(Pu,{rows:i,className:"dtable-scroll-center",scrollLeft:a,scrollTop:l,cols:r.list,left:s.width,width:r.width,rowHeight:t,cellClass:h,onRenderCell:p},"center"));let C=null;return o.list.length&&(C=k(Pu,{className:"dtable-fixed-right",rows:i,scrollTop:l,cols:o.list,left:s.width+r.width,width:o.width,rowHeight:t,cellClass:h,onRenderCell:p},"right")),k("div",{className:V("dtable-block",c),style:{...u,top:n,height:e},children:[v,b,C,m]})}var dg=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},it=(n,e,t)=>(dg(n,e,"read from private field"),t?t.call(n):e.get(n)),dt=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Ut=(n,e,t)=>(dg(n,e,"access private method"),t),Zn,br,wr,Lu,fg,Ru,pg,Ou,mg,Fu,gg,Pa,zu,La,Ra,ju,Bu,Hu,Uu,Cr,Oa,Fa,Wu,Vu,yg,Ku,vg;let Ts=class extends me{constructor(e){super(e),dt(this,Lu),dt(this,Ru),dt(this,Ou),dt(this,Fu),dt(this,Pa),dt(this,Cr),dt(this,Fa),dt(this,Vu),dt(this,Ku),this.ref=he(),this._rafId=0,this._needRender=!1,this._plugins=[],this._lastUsedPlugins=new Map,this._events=new Map,this._data={},this._i18nMaps=[],this._hover={in:!1},this.updateLayout=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const{element:t}=this;t&&!Un(t)&&this.update({dirtyType:"layout"}),this._rafId=0})},dt(this,Zn,(t,i)=>{i=i||t.type;const s=this._events.get(i);if(s!=null&&s.length){for(const r of s)if(r.call(this,t)===!1){t.stopPropagation(),t.preventDefault();break}}}),dt(this,br,t=>{it(this,Zn).call(this,t,`window_${t.type}`)}),dt(this,wr,t=>{it(this,Zn).call(this,t,`document_${t.type}`)}),dt(this,La,(t,i,s,r)=>{const{row:o,col:a}=i;i.value=this.getCellValue(o,a),t[0]=i.value;const l=o.id==="HEADER"?"onRenderHeaderCell":"onRenderCell",c=(h,u)=>{try{t=h.call(this,t,i,s,r)}catch(p){console.error(`[ZUI] DTable render cell(${o.id}:${a.name}) by ${u} error:`,p)}};return a.setting[l]&&c(a.setting[l],"col"),this._plugins.forEach(h=>{h[l]&&c(h[l],`plugin (${h.name})`)}),this.options[l]&&c(this.options[l],"options"),t}),dt(this,Ra,(t,i)=>{i==="horz"?this.scroll({scrollLeft:t}):this.scroll({scrollTop:t})}),dt(this,ju,t=>{var a,l,c;const i=this.getPointerInfo(t);if(!i)return;const{rowID:s,colName:r,cellElement:o}=i;if(s==="HEADER")o&&((a=this.options.onHeaderCellClick)==null||a.call(this,t,{colName:r,element:o}),this._plugins.forEach(h=>{var u;(u=h.onHeaderCellClick)==null||u.call(this,t,{colName:r,element:o})}));else{const h=this.layout.visibleRows.find(u=>u.id===s);if(o){if(((l=this.options.onCellClick)==null?void 0:l.call(this,t,{colName:r,rowID:s,rowInfo:h,element:o}))===!0)return;for(const u of this._plugins)if(((c=u.onCellClick)==null?void 0:c.call(this,t,{colName:r,rowID:s,rowInfo:h,element:o}))===!0)return}}}),dt(this,Bu,t=>{const i=t.key.toLowerCase();if(["pageup","pagedown","home","end"].includes(i))return!this.scroll({to:i.replace("page","")})}),dt(this,Hu,t=>{const i=y(t.target).closest(".dtable-cell");if(!i.length)return Ut(this,Cr,Oa).call(this,!1);Ut(this,Cr,Oa).call(this,[i.attr("data-row"),i.attr("data-col")])}),dt(this,Uu,()=>{Ut(this,Cr,Oa).call(this,!1)}),this._id=e.id??`dtable-${Tt()}`,this.state={scrollTop:0,scrollLeft:0,renderCount:0},this._allPlugins=Object.freeze(yx(e.plugins)),this._allPlugins.forEach(t=>{const{methods:i,data:s,state:r}=t;i&&Object.entries(i).forEach(([o,a])=>{typeof a=="function"&&Object.assign(this,{[o]:a.bind(this)})}),s&&Object.assign(this._data,s.call(this)),r&&Object.assign(this.state,r.call(this))}),Ut(this,Fa,Wu).call(this),this._plugins.forEach(t=>{var i;(i=t.onCreate)==null||i.call(this,t)})}get options(){var e;return((e=this._layout)==null?void 0:e.options)||this._options||ag()}get plugins(){return this._plugins}get layout(){return this._layout}get id(){return this._id}get data(){return this._data}get element(){return this.ref.current}get parent(){var e;return this.props.parent??((e=this.element)==null?void 0:e.parentElement)}get hoverInfo(){return this._hover}componentWillReceiveProps(){this._options=void 0}shouldComponentUpdate(){return!0}componentDidMount(){this._needRender?this.forceUpdate():Ut(this,Pa,zu).call(this),this.on("click",it(this,ju)),this.on("keydown",it(this,Bu));const{options:e}=this;(e.rowHover||e.colHover)&&(this.on("mouseover",it(this,Hu)),this.on("mouseleave",it(this,Uu)));let{responsive:t}=e;if(t){t===!0&&(t="window,parent");const i=t.split(",");if(typeof ResizeObserver<"u"){const s=[],r=new ResizeObserver(this.updateLayout);this._rob=r;const{parent:o}=this;i.forEach(a=>{a!=="window"&&(a==="parent"?o&&r.observe(o):a[0]==="~"?s.push(a.slice(1)):y(a).each((l,c)=>r.observe(c)))}),s.length&&this.on(s.join(" "),this.updateLayout)}i.includes("window")&&this.on("window_resize",this.updateLayout)}this._checkPluginsState()}componentDidUpdate(){Ut(this,Pa,zu).call(this),this._checkPluginsState(),this._plugins.forEach(e=>{var t;(t=e.onUpdated)==null||t.call(this)})}componentWillUnmount(){var t;(t=this._rob)==null||t.disconnect();const{element:e}=this;if(e)for(const i of this._events.keys())i.startsWith("window_")?window.removeEventListener(i.replace("window_",""),it(this,br)):i.startsWith("document_")?document.removeEventListener(i.replace("document_",""),it(this,wr)):e.removeEventListener(i,it(this,Zn));this._plugins.forEach(i=>{var s;(s=i.onUnmounted)==null||s.call(this)}),this._allPlugins.forEach(i=>{var s;(s=i.onDestory)==null||s.call(this)}),this._data={},this._events.clear(),this._noAnimation&&clearTimeout(this._noAnimation),this._rafId&&cancelAnimationFrame(this._rafId)}resetState(e,t){this._options=void 0,this._layout=void 0,e=e||this.props;const i={};this._plugins.forEach(s=>{const{resetState:r,state:o}=s;r&&(typeof r=="function"?Object.assign(i,r.call(this,e)):o&&Object.assign(i,o.call(this)))}),Object.keys(i).length&&this.setState(i)}on(e,t,i){var r;i&&(e=`${i}_${e}`);const s=this._events.get(e);s?s.push(t):(this._events.set(e,[t]),e.startsWith("window_")?window.addEventListener(e.replace("window_",""),it(this,br)):e.startsWith("document_")?document.addEventListener(e.replace("document_",""),it(this,wr)):(r=this.element)==null||r.addEventListener(e,it(this,Zn)))}off(e,t,i){var o;i&&(e=`${i}_${e}`);const s=this._events.get(e);if(!s)return;const r=s.indexOf(t);r>=0&&s.splice(r,1),s.length||(this._events.delete(e),e.startsWith("window_")?window.removeEventListener(e.replace("window_",""),it(this,br)):e.startsWith("document_")?document.removeEventListener(e.replace("document_",""),it(this,wr)):(o=this.element)==null||o.removeEventListener(e,it(this,Zn)))}emitCustomEvent(e,t){it(this,Zn).call(this,t instanceof Event?t:new CustomEvent(e,{detail:t}),e)}disableAnimation(e=200){var t;this._noAnimation&&clearTimeout(this._noAnimation),(t=this.element)==null||t.classList.add("no-animation"),this._noAnimation=window.setTimeout(()=>{var i;this._noAnimation=void 0,(i=this.element)==null||i.classList.remove("no-animation")},e)}scroll(e,t){const{scrollLeft:i,scrollTop:s,rowsHeightTotal:r,rowsHeight:o,rowHeight:a,cols:{center:{totalWidth:l,width:c}}}=this.layout,{to:h}=e;let{scrollLeft:u,scrollTop:p}=e;if(h==="up"||h==="down")p=s+(h==="down"?1:-1)*Math.floor(o/a)*a;else if(h==="left"||h==="right")u=i+(h==="right"?1:-1)*c;else if(h==="top")p=0;else if(h==="bottom")p=r-o;else if(h==="begin")u=0;else if(h==="end")u=l-c;else{const{offsetLeft:v,offsetTop:b}=e;typeof v=="number"&&(u=i+v),typeof b=="number"&&(p=s+b)}const m={};return typeof u=="number"&&(u=Math.max(0,Math.min(u,l-c)),u!==i&&(m.scrollLeft=u)),typeof p=="number"&&(p=Math.max(0,Math.min(p,r-o)),p!==s&&(m.scrollTop=p)),Object.keys(m).length?(this.setState(m,()=>{var v;(v=this.options.onScroll)==null||v.call(this,m),t==null||t.call(this,!0)}),!0):(t==null||t.call(this,!1),!1)}getColInfo(e){if(e===void 0)return;if(typeof e=="object")return e;const{cols:t}=this.layout;return typeof e=="number"?t.list[e]:t.map[e]}getRowInfo(e){if(e===void 0)return;if(typeof e=="object")return e;if(e===-1||e==="HEADER")return{id:"HEADER",index:-1,top:0};const{rows:t,rowsMap:i,allRows:s}=this.layout;return typeof e=="number"?t[e]:i[e]||s.find(r=>r.id===e)}getCellValue(e,t){var a;const i=typeof e=="object"?e:this.getRowInfo(e);if(!i)return;const s=typeof t=="object"?t:this.getColInfo(t);if(!s)return;let r=i.id==="HEADER"?s.setting.title:(a=i.data)==null?void 0:a[s.name];const{cellValueGetter:o}=this.options;return o&&(r=o.call(this,i,s,r)),r}getRowInfoByIndex(e){return this.layout.rows[e]}update(e={},t){if(!this._options)return;typeof e=="function"&&(t=e,e={});const{dirtyType:i,state:s}=e;if(i==="layout")this._layout=void 0;else if(i==="options"){if(this._options=void 0,!this._layout)return;this._layout=void 0}this.setState(s||(r=>({renderCount:r.renderCount+1})),t)}getPointerInfo(e){const t=e.target;if(!t||t.closest(".no-cell-event"))return;const i=y(t).closest(".dtable-cell");if(!i.length)return;const s=i.attr("data-row"),r=i.attr("data-col");if(!(typeof r!="string"||typeof s!="string"))return{cellElement:i[0],colName:r,rowID:s,target:t}}componentDidCatch(e,t){console.error(`[ZUI] DTable ${this.id} Error:`,e,t)}i18n(e,t,i){return Ne(this._i18nMaps,e,t,i,this.options.lang)??`{i18n:${e}}`}getPlugin(e){return this.plugins.find(t=>t.name===e)}_checkPluginsState(){const e=new Set(this._lastUsedPlugins.keys());this._plugins.forEach(t=>{var s;if(e.has(t.name)){e.delete(t.name);return}let{events:i}=t;i&&(typeof i=="function"&&(i=i.call(this)),Object.entries(i).forEach(([r,o])=>{o&&this.on(r,o)})),(s=t.onMounted)==null||s.call(this),this._lastUsedPlugins.set(t.name,t)}),e.size&&e.forEach(t=>{var s;const i=this._lastUsedPlugins.get(t);(s=i==null?void 0:i.onUnmounted)==null||s.call(this),this._lastUsedPlugins.delete(t)})}render(){let e=Ut(this,Ku,vg).call(this);const{className:t,rowHover:i,colHover:s,cellHover:r,bordered:o,striped:a,scrollbarHover:l,beforeRender:c,emptyTip:h,style:u}=this.options,p={...u},m=["dtable",t,{"dtable-hover-row":i,"dtable-hover-col":s,"dtable-hover-cell":r,"dtable-bordered":o,"dtable-striped":a,"scrollbar-hover":l,"no-animation":this._noAnimation}],v=[];if(e){const b=!e.rows.length;if(c){const C=c.call(this,e);C&&(e=C)}this._plugins.forEach(C=>{var D;const S=(D=C.beforeRender)==null?void 0:D.call(this,e);S&&(e=S)}),p.width=e.width,p.height=e.height,p["--dtable-row-height"]=`${e.rowHeight}px`,p["--dtable-header-height"]=`${e.headerHeight}px`,m.push(e.className,b?"dtable-is-empty":"",{"dtable-has-scroll-y":e.rowsHeightTotal>e.rowsHeight,"dtable-scrolled-down":e.scrollTop>0,"dtable-scrolled-bottom":e.scrollTop>=e.rowsHeightTotal-e.rowsHeight,"dtable-scrolled-right":e.scrollLeft>0,"dtable-scrolled-end":e.scrollLeft>=e.cols.center.totalWidth-e.cols.center.width}),e.children&&v.push(...e.children),b&&h?(delete p.height,v.push(k("div",{className:"dtable-empty-tip",children:k(ge,{content:h,generatorThis:this,generatorArgs:[e]})},"empty-tip"))):(v.push(Ut(this,Lu,fg).call(this,e),Ut(this,Ru,pg).call(this,e),Ut(this,Ou,mg).call(this,e)),e.scrollable&&v.push(Ut(this,Fu,gg).call(this,e))),this._plugins.forEach(C=>{var D;const S=(D=C.onRender)==null?void 0:D.call(this,e);S&&(S.style&&Object.assign(p,S.style),S.className&&m.push(S.className),S.children&&v.push(S.children))})}return k("div",{id:this._id,className:V(m),style:p,ref:this.ref,tabIndex:-1,children:v})}};Zn=new WeakMap,br=new WeakMap,wr=new WeakMap,Lu=new WeakSet,fg=function(n){const{header:e,cols:t,headerHeight:i,scrollLeft:s,headerChildren:r}=n;if(!e)return null;if(e===!0)return k(hg,{className:"dtable-header",cols:t,height:i,scrollLeft:s,rowHeight:i,scrollTop:0,cellClass:"dtable-header-cell",rows:{id:"HEADER",index:-1,top:0},top:0,onRenderCell:it(this,La),children:r},"header");const o=Array.isArray(e)?e:[e];return k(kc,{className:"dtable-header",style:{height:i},renders:o,generateArgs:[n],generatorThis:this,children:r},"header")},Ru=new WeakSet,pg=function(n){const{headerHeight:e,rowsHeight:t,visibleRows:i,rowHeight:s,cols:r,scrollLeft:o,scrollTop:a,bodyChildren:l}=n;return k(hg,{className:"dtable-body",top:e,height:t,rows:i,rowHeight:s,scrollLeft:o,scrollTop:a,cols:r,onRenderCell:it(this,La),children:l},"body")},Ou=new WeakSet,mg=function(n){let{footer:e}=n;if(typeof e=="function"&&(e=e.call(this,n)),!e)return null;const t=Array.isArray(e)?e:[e];return k(kc,{className:"dtable-footer",style:{height:n.footerHeight,top:n.rowsHeight+n.headerHeight},renders:t,generateArgs:[n],generatorThis:this,generators:n.footerGenerators,children:n.footerChildren},"footer")},Fu=new WeakSet,gg=function(n){const e=[],{scrollLeft:t,cols:{left:{width:i},center:{width:s,totalWidth:r}},scrollTop:o,rowsHeight:a,rowsHeightTotal:l,footerHeight:c,headerHeight:h}=n,{scrollbarSize:u=12,horzScrollbarPos:p,vertScrollbarPos:m}=this.options;return r>s&&e.push(k(ng,{type:"horz",scrollPos:t,scrollSize:r,clientSize:s,onScroll:it(this,Ra),left:i,bottom:(p==="inside"?0:-u)+c,size:u,wheelContainer:this.ref},"horz"),k("div",{className:"dtable-scroll-shadow is-left",style:{left:i,height:h+a}}),k("div",{className:"dtable-scroll-shadow is-right",style:{left:i+s,height:h+a}})),l>a&&e.push(k(ng,{type:"vert",scrollPos:o,scrollSize:l,clientSize:a,onScroll:it(this,Ra),right:m==="outside"?-u:0,size:u,top:h,wheelContainer:this.ref},"vert")),e.length?e:null},Pa=new WeakSet,zu=function(){var n;this._needRender=!1,this._plugins.forEach(e=>{var t;return(t=e.afterRender)==null?void 0:t.call(this)}),(n=this.options.afterRender)==null||n.call(this)},La=new WeakMap,Ra=new WeakMap,ju=new WeakMap,Bu=new WeakMap,Hu=new WeakMap,Uu=new WeakMap,Cr=new WeakSet,Oa=function(n){const{element:e,options:t}=this;if(!e)return;const i=y(e),s=n?{in:!0,row:n[0],col:n[1]}:{in:!1};t.colHover==="header"&&s.row!=="HEADER"&&(s.col=void 0);const r=this._hover;s.in!==r.in&&i.toggleClass("dtable-hover",s.in),s.row!==r.row&&(i.find(".is-hover-row").removeClass("is-hover-row"),s.row&&i.find(`.dtable-cell[data-row="${s.row}"]`).addClass("is-hover-row")),s.col!==r.col&&(i.find(".is-hover-col").removeClass("is-hover-col"),s.col&&i.find(`.dtable-cell[data-col="${s.col}"]`).addClass("is-hover-col")),this._hover=s},Fa=new WeakSet,Wu=function(){if(this._options)return!1;const e={...ag(),...this._allPlugins.reduce((t,i)=>{const{defaultOptions:s}=i;return s&&Object.assign(t,s),t},{}),...this.props};return this._options=e,this._plugins=this._allPlugins.reduce((t,i)=>{const{options:s}=i;let r=e;return s&&(r=Object.assign({...r},typeof s=="function"?s.call(this,e):s)),r!==e&&Object.assign(e,r),t.push(i),t},[]).filter(t=>{const{when:i}=t;return!i||i.call(this,e)}),this._i18nMaps=[this.options.i18n,...this.plugins.map(t=>t.i18n)].filter(Boolean),!0},Vu=new WeakSet,yg=function(){var Z,ue;const{plugins:n}=this;let e=this._options;const t={flex:k("div",{style:"flex:auto"}),divider:k("div",{style:"width:1px;margin:var(--space);background:var(--color-border);height:50%"})};n.forEach(J=>{var ye;const se=(ye=J.beforeLayout)==null?void 0:ye.call(this,e);se&&(e={...e,...se}),Object.assign(t,J.footer)});let i=e.width,s=0;if(typeof i=="function"&&(i=i.call(this)),i==="100%"){const{parent:J}=this;if(J)s=J.clientWidth;else{this._needRender=!0;return}}const r=vx(this,e,n,s),{data:o,rowKey:a="id",rowHeight:l=35,rowConverter:c}=e,h=[],u=(J,se,ye)=>{var Oe,ce;const _e=ye??{[a]:J},Ee={data:c?c.call(this,_e,se):_e,id:J,index:h.length,top:0};if(ye||(Ee.lazy=!0),h.push(Ee),((Oe=e.onAddRow)==null?void 0:Oe.call(this,Ee,se))!==!1){for(const ee of n)if(((ce=ee.onAddRow)==null?void 0:ce.call(this,Ee,se))===!1)return}};if(typeof o=="number")for(let J=0;J<o;J++)u(`${J}`,J);else Array.isArray(o)&&o.forEach((J,se)=>{typeof J=="object"?u(`${J[a]??""}`,se,J):u(`${J??""}`,se)});let p=h;const m={};if(e.onAddRows){const J=e.onAddRows.call(this,p,r);J&&(p=J)}for(const J of n){const se=(Z=J.onAddRows)==null?void 0:Z.call(this,p,r);se&&(p=se)}p.forEach((J,se)=>{m[J.id]=J,J.index=se,J.top=J.index*l});const{header:v,footer:b}=e,C=v?e.headerHeight||l:0,S=b?e.footerHeight||l:0;let D=e.height,N=0;const P=p.length*l,H=C+S+P;if(typeof D=="function"&&(D=D.call(this,H)),D==="auto")N=H;else if(typeof D=="object")N=Math.min(D.max,Math.max(D.min,H));else if(D==="100%"){const{parent:J}=this;if(J)N=J.clientHeight;else{N=0,this._needRender=!0;return}}else N=D;const q=N-C-S,Y={options:e,allRows:h,width:s,height:N,rows:p,rowsMap:m,rowHeight:l,rowsHeight:q,rowsHeightTotal:P,header:v,footer:b,footerGenerators:t,headerHeight:C,footerHeight:S,cols:r},Q=(ue=e.onLayout)==null?void 0:ue.call(this,Y);Q&&Object.assign(Y,Q),n.forEach(J=>{if(J.onLayout){const se=J.onLayout.call(this,Y);se&&Object.assign(Y,se)}}),this._layout=Y},Ku=new WeakSet,vg=function(){(Ut(this,Fa,Wu).call(this)||!this._layout)&&Ut(this,Vu,yg).call(this);const{layout:n}=this;if(!n)return;const{cols:{center:e}}=n;let{scrollLeft:t}=this.state;t=Math.min(Math.max(0,e.totalWidth-e.width),t);let i=0;e.list.forEach(v=>{v.left=i,i+=v.realWidth,v.visible=v.left+v.realWidth>=t&&v.left<=t+e.width});const{rowsHeightTotal:s,rowsHeight:r,rows:o,rowHeight:a}=n,l=Math.min(Math.max(0,s-r),this.state.scrollTop),c=Math.floor(l/a),h=l+r,u=Math.min(o.length,Math.ceil(h/a)),p=[],{rowDataGetter:m}=this.options;for(let v=c;v<u;v++){const b=o[v];b.lazy&&m&&(b.data=m([b.id])[0],b.lazy=!1),p.push(b)}return Object.assign(n,{visibleRows:p,scrollTop:l,scrollLeft:t,headerChildren:[],bodyChildren:[],footerChildren:[],children:[],className:"",scrollable:!0}),n},Ts.addPlugin=ig,Ts.removePlugin=sg;class bx extends me{constructor(){super(...arguments),this._dtablePlugins=["sort","zentao","resize","pager"],this._dtable=he(),this._createActionItem=(e,t)=>{var i,s;return e.command=e.command.replace("{id}",String(t.row.data.id)),e.key==="move"&&((s=(i=this.props).canMoveDoc)==null?void 0:s.call(i,t.row.data))===!1&&(e.disabled=!0),e},this._getToolbar=e=>{const{getActions:t}=this.props,i=t==null?void 0:t("doc-table",{ui:"table-foot-toolbar",dtable:e});if(i)return{btnProps:{size:"sm",btnType:"secondary"},items:i}}}_getCols(){const e={edit:{hint:"编辑",icon:"edit",command:"startEditDoc/{id}",key:"edit"},move:{hint:"移动",icon:"folder-move",command:"moveDoc/{id}",key:"move"},delete:{hint:"删除",icon:"trash",command:"deleteDoc/{id}",key:"trash"}},{searchKeys:t=[]}=this.props;return[{name:"rawID",title:"ID",type:"checkID",sort:"number"},{name:"title",title:"标题",type:"title",onRenderCell:(r,o)=>{const a=o.row.data,l=a.title;return r[0]=w("div",{className:"row items-center gap-1 cursor-pointer","zui-command":`selectDoc/${a.id}`},w($e,{icon:a.icon??this.props.docIcon,className:a.icon?"":"text-special"})," ",w("a",{title:l,className:"doc-list-item-title text-primary"},t.length?ut.underlineKeys(t,[l]):l)),a.status==="draft"&&r.push(w("div",{className:"label special-pale size-sm rounded-full ml-1 flex-none"},"草稿")),r},sort:!0},{name:"collects",title:"收藏数",onRenderCell:(r,o)=>{const a=o.row.data;return a.api?[]:[w(xe,{type:"ghost",size:"sm",text:a.collects||0,icon:a.isCollector?"star text-warning":"star-empty text-gray","zui-command":`collectDoc/${o.row.id}`})]},sort:"number",cellClass:"px-2",fixed:"left"},{name:"views",title:"浏览数",sort:"number",align:"center"},{name:"addedBy",title:"创建者",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"editedBy",title:"修改者",type:"user",sort:!0},{name:"editedDate",title:"修改日期",type:"date",sort:!0},{name:"actions",title:"操作",type:"actions",width:96,minWidth:96,actionsMap:e,actions:["edit","move","delete"],actionItemCreator:this._createActionItem}]}_getTableOptions(e){const{docs:t,userMap:i,getTableOptions:s,app:r,orderBy:o}=e;let a="",l="";typeof o=="string"&&o&&([a,l]=o.split("_"));const c=t.map(u=>u.data);["order","id"].includes(a)&&l&&(l==="asc"?c.sort((u,p)=>u.order-p.order):c.sort((u,p)=>p.order-u.order));const h={width:"100%",height(u){var m;const p=(m=this.element)==null?void 0:m.parentElement;return p?Math.min(u,p.clientHeight):u},cols:this._getCols(),checkable:!0,sort:!0,plugins:this._dtablePlugins,data:c,userMap:i,colResize:!0,footToolbar:this._getToolbar,footer:["checkbox","toolbar","checkedInfo","flex","pager"],localPager:!0,loadPartial:!0,canRowCheckable:u=>+String(u)==+u?!0:"disabled",emptyTip:w("div",{className:"center gap-4"},w("div",{className:"text-gray"},r.getLang("noDocs","没有文档")),Be.render({items:r.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:r.getPagerItems()}};return(s==null?void 0:s(h,{type:"doc-list"}))??h}render(e){return w("div",{class:V("doc-list h-full col",e.className)},w(Ts,{ref:this._dtable,...this._getTableOptions(e)}))}}const Ds=class extends gt{_getFileIcon(e,t){if(!t)return null;const i=typeof t;return i==="string"?t:(t=t||this.props.fileIcon,i==="function"?t.call(this,e):t[e.extension]||"file")}_getItems(e){const t=super._getItems(e),{fileIcon:i,fileSizeFormat:s,itemProps:r,heading:o,fileUrl:a,fileActions:l}=e,c=t.map(h=>{let u=null;return typeof h.size=="number"&&(u=vt(h.size),s&&(u=we(s,{size:u}))),{key:`${h.id}`,icon:this.constructor.getFileIcon(h,i),iconClass:"text-gray",title:h.title,subtitle:u,multiline:!1,url:typeof a=="function"?a.call(this,h):a?we(a,h):void 0,actions:l?l.call(this,h):void 0,...r}});return o&&c.unshift({key:"heading",titleClass:"font-bold",type:"heading",...o}),c}_getRenderedItem(e,t){return t}static getFileIcon(e,t){if(!t)return null;const i=typeof t;return i==="string"?t:i==="function"?t.call(this,e):t[e.extension]||"file"}static getDefaultIconMap(){return[["file-image",["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]],["file-audio",["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac"]],["file-video",["mp4","avi","mkv","mov","flv","wmv","webm"]],["file-archive",["zip","rar","7z","tar","gz","bz2","xz"]],["file-code",["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown"]],["file-pdf",["pdf"]],["file-log",["log"]],["markdown",["md"]],["file-word",["doc","docx"]],["file-excel",["xls","xlsx"]],["file-powerpoint",["ppt","pptx"]],["file-text",["txt","csv"]]].reduce((t,[i,s])=>(s.forEach(r=>{t[r]=i}),t),{})}};Ds.NAME="file-list",Ds.defaultProps={...gt.defaultProps,fileSizeFormat:"({size})",fileIcon:Ds.getDefaultIconMap()},Ds.TAG="div",Ds.defaultItemProps={component:"div"};let xr=Ds;function _g(n){n=n||location.search,n[0]==="?"&&(n=n.substring(1));try{const e=new URLSearchParams(n),t={};for(const i of e.keys())t[i]=e.getAll(i).join(",");return t}catch{return{}}}function bg(n){if(!n)return{url:n};const{config:e}=window;if(/^https?:\/\//.test(n)){const l=window.location.origin;if(!n.includes(l))return{external:!0,url:n};n=(e.webRoot.endsWith("/")?"/":"")+n.substring((l+e.webRoot).length)}const t=n.split("#"),i=t[0].split("?"),s=i[1],r=s?_g(s):{};let o=i[0];const a={url:n,isOnlyBody:r.onlybody==="yes",vars:[],hash:t[1]||"",params:r,tid:r.tid||""};if(e.requestType==="GET"){a.moduleName=r[e.moduleVar]||"index",a.methodName=r[e.methodVar]||"index",a.viewType=r[e.viewVar]||e.defaultView;for(const l in r)l!==e.moduleVar&&l!==e.methodVar&&l!==e.viewVar&&l!=="onlybody"&&l!=="tid"&&a.vars.push([l,r[l]])}else{let l=o.lastIndexOf("/");l===o.length-1&&(o=o.substring(0,l),l=o.lastIndexOf("/")),l>=0&&(o=o.substring(l+1));const c=o.lastIndexOf(".");c>=0?(a.viewType=o.substring(c+1),o=o.substring(0,c)):a.viewType=e.defaultView;const h=o.split(e.requestFix);if(a.moduleName=h[0]||"index",a.methodName=h[1]||"index",h.length>2)for(let u=2;u<h.length;u++)a.vars.push(["",h[u]]),r["$"+(u-1)]=h[u]}return a}function Pt(n,e,t,i,s,r){if(typeof n=="object")return Pt(n.moduleName,n.methodName,n.vars,n.viewType,n.hash,n.params);const o=window.config||{};if(t){typeof t=="string"&&(t=t.split("&"));for(let c=0;c<t.length;c++){const h=t[c];if(typeof h=="string"){const u=h.split("=");t[c]=[u.shift(),u.join("=")]}}}const a=[],l=o.requestType==="GET";if(l){if(a.push(o.router,"?",o.moduleVar,"=",n,"&",o.methodVar,"=",e),t)for(let c=0;c<t.length;c++)a.push("&",t[c][0],"=",t[c][1]);i&&i!==o.defaultView&&a.push("&",o.viewVar,"=",i)}else{if(o.requestType=="PATH_INFO"&&a.push(o.webRoot,n,o.requestFix,e),o.requestType=="PATH_INFO2"&&a.push(o.webRoot,"index.php/",n,o.requestFix,e),t)for(let c=0;c<t.length;c++)a.push(o.requestFix+t[c][1]);i=i||o.defaultView,i&&a.push(".",i)}return r&&Object.keys(r).forEach(c=>{const h=r[c];c[0]!=="$"&&a.push(!l&&!a.includes("?")?"?":"&",c,"=",h)}),typeof s=="string"&&a.push(s.startsWith("#")?"":"#",s),a.join("")}const qu=class zs extends me{constructor(){super(...arguments),this._files=Je(),this._loadID="",this._timer=0,this._handleChangePager=e=>{this.props.app.resetPager("files",{...e})}}_filterFiles(e){if(!(e!=null&&e.length))return e;const{currentUser:t,onGetUser:i,searchKeys:s=[],filterType:r}=this.props,o=r&&r!=="all";if(!o&&!s.length)return e;const a=["title","id","addedBy","addedDate","extension","objectType","sourceName",l=>`.${l.extension}`,i?l=>i(l.addedBy).realname:null].filter(Boolean);return e.filter(l=>!(o&&!zs.isFileMatchFilter(l,r,t)||s.length&&!ut.isItemMatch(l,s,a)))}_getCols(){const{searchKeys:e=[],fileUrl:t,app:i}=this.props,s=l=>typeof t=="function"?t.call(this,l):t?we(t,l):void 0;return[{name:"id",title:"ID",type:"id",sort:"number"},{name:"title",title:"附件名称",type:"title",width:300,onRenderCell:(l,c)=>{var v;const h=c.row.data,u=zs.getFilterTypeFromExt(h.extension),p=u?(v=zs.filterTypeConfig[u])==null?void 0:v.iconClass:void 0,m=h.title;return l[0]=w("a",{title:m,href:s(h),target:"_blank",className:"doc-list-item-title text-primary"},e.length?ut.underlineKeys(e,[m]):m),l.unshift(w($e,{icon:xr.getFileIcon(h,xr.getDefaultIconMap())||"file",className:p})),l},sort:!0},{name:"objectName",title:"来源",type:"text",sort:!0,width:400,flex:1,cellClass:"px-2",onRenderCell:(l,c)=>{const h=c.row.data,{objectType:u,objectID:p,sourceName:m}=h;if(!u||!p)return l;const v=Pt(u,"view",`${u}ID=${p}`),b=`#${p} ${m}`,C=u==="doc";return l.push(w("a",{"data-toggle":C?void 0:"modal","data-size":C?void 0:"lg",href:v,title:`${h.objectName??""}${b}`},b)),l}},{name:"extension",title:"类型",sort:!0,align:"center"},{name:"size",title:"大小",format:vt,sort:"number"},{name:"addedBy",title:"由谁添加",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"actions",title:"操作",fixed:"right",width:64,minWidth:64,onRenderCell:(l,c)=>{const h=c.row.data;return l[0]=w(xe,{type:"ghost",className:"text-primary",size:"sm",icon:"download",hint:i.getLang("downloadFile","下载文件"),target:"_blank",url:s(h)}),l}}]}async loadFiles(){const{filesFetcher:e,objectID:t,objectType:i}=this.props;this._files.value=void 0,this._loadID=[i,t].join();const s=await _t(e,[{objectID:+t,objectType:i}]);[this.props.objectType,this.props.objectID].join()===this._loadID&&(this._files.value=s||[])}tryLoadFiles(){this._loadID!==[this.props.objectType,this.props.objectID].join()&&(this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this._timer=0,this._loadID!==[this.props.objectType,this.props.objectID].join()&&this.loadFiles()},100))}componentDidMount(){this.tryLoadFiles()}componentDidUpdate(){this.tryLoadFiles()}componentWillUnmount(){this._timer&&clearTimeout(this._timer)}_getTableOptions(e,t){const{app:i}=e,s={width:"100%",height(r){var a;const o=(a=this.element)==null?void 0:a.parentElement;return o?Math.min(r,o.clientHeight):r},cols:this._getCols(),checkable:!1,className:"h-full",sort:!0,sortBy:{name:"id",order:"asc"},plugins:["sort","zentao","resize","pager"],data:t||[],userMap:e.userMap,colResize:!0,localPager:!0,loadPartial:!0,emptyTip:t?w("div",{className:"center gap-4 text-gray"},i.getLang("noFiles","没有文件")):null,footPager:{items:i.getPagerItems(),onChangePageInfo:this._handleChangePager}};return i.getTableOptions(s,{type:"file-list"})??s}render(e){const t=this._filterFiles(this._files.value),i=this._getTableOptions(e,t);return w("div",{className:`doc-lib-files h-full col load-indicator${t?"":" loading"}`,"data-loading":e.app.getLang("loadingFilesTip","正在加载文件...")},w(Ts,{...i}))}static getFilterTypeFromExt(e){const[t]=Object.entries(zs.filterExtensions).find(([,i])=>i.has(e))||[];return t}static isFileMatchFilter(e,t,i){if(t==="addedByMe")return e.addedBy===i;if(t==="bug"||t==="story"||t==="task")return e.objectType===t;const{filterExtensions:s}=zs,{extension:r}=e;if(t==="other")return Object.values(s).every(a=>!a.has(r));const o=s[t];return o==null?void 0:o.has(r)}};qu.filterTypeConfig={all:{text:"全部",icon:"file-alt",iconClass:"text-gray"},story:{text:"需求",icon:"lightbulb",iconClass:"text-primary"},bug:{text:"Bug",icon:"bug",iconClass:"text-danger"},task:{text:"任务",icon:"checkbox",iconClass:"text-secondary"},office:{text:"Office",icon:"file-word",iconClass:"text-primary"},doc:{text:"文档",icon:"file-text",iconClass:"text-secondary"},image:{text:"图片",icon:"file-image",iconClass:"text-warning"},av:{text:"音视频",icon:"file-video",iconClass:"text-danger"},archive:{text:"压缩包",icon:"file-archive",iconClass:"text-important"},code:{text:"代码",icon:"file-code",iconClass:"text-success"},other:{text:"其他",icon:"file",iconClass:"text-gray"},addedByMe:{text:"由我添加",icon:"person",iconClass:"text-primary"}},qu.filterExtensions={av:new Set(["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac","mp4","avi","mkv","mov","flv","wmv","webm"]),image:new Set(["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]),code:new Set(["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown","log"]),doc:new Set(["pdf","txt","md"]),office:new Set(["doc","docx","xls","xlsx","ppt","pptx"]),archive:new Set(["zip","rar","7z","tar","gz","bz2","xz","exe","dmg"])};let Gu=qu;class wx extends me{constructor(){super(...arguments),this.state={},this._menu=he(),this._ref=he(),this._getTreeItem=e=>{var b;const t=e.data,i=t.id;if(e.type==="doc")return{className:"item tree-item",type:"item",key:e.key,icon:t.icon??(t.type==="chapter"?this.props.chapterIcon:this.props.docIcon),iconClass:t.icon?"":t.type==="chapter"?"text-important":"text-special",selected:i===this.props.docID,text:t.title,hint:t.title,items:(b=e.docs)!=null&&b.length?[...e.docs]:void 0,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions("doc",t,"sidebar"),_data:e};const{moduleIcon:s,moduleID:r,lib:o,docID:a,app:l}=this.props,c=l.props.libColors,{modules:h=[],docs:u=[]}=e,p=e.type==="lib";let m=t.icon;if(m===void 0)if(p){const C=t.type==="api"?this.props.apiLibIcon:this.props.libIcon;m=typeof C=="string"&&c?{icon:C,style:{color:c[i%c.length]}}:C}else m=s;const v={className:"item tree-item",type:"item",key:e.key,text:t.name,icon:m,items:p?void 0:[...h,...u],iconClass:p?"gray-pale w-5 h-5 center rounded-lg":"text-warning",selected:!1,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions(e.type,t,"sidebar"),hint:t.name,_data:e};if(!a){const C=o==null?void 0:o.data.id;p&&!r?v.selected=i===C:!p&&r&&(v.selected=i===r)}return v},this._toggleSearchBox=()=>{this.setState({search:!this.state.search})},this._handleToggleTree=()=>{const{nestedShow:e,defaultShow:t}=this._menu.current.state,i=(!e||!Object.keys(e))&&!t;this.setState({isExpandAll:i})},this._toggleTree=()=>{var t;const{isExpandAll:e}=this.state;(t=this._menu.current)==null||t.toggleAll(!this.state.isExpandAll),this.setState({isExpandAll:!e})},this._handleClickItem=e=>{var i,s,r,o,a,l,c,h;if(e.event.target.closest(".item-icon,.nested-toggle-icon"))return;const t=e.renderedItem._data;t&&(t.type==="doc"?(s=(i=this.props).onSelectDoc)==null||s.call(i,t.data):t.type==="lib"?(o=(r=this.props).onSelectLib)==null||o.call(r,t.data.id):t.type==="files"?(l=(a=this.props).onShowFiles)==null||l.call(a):(h=(c=this.props).onSelectLib)==null||h.call(c,t.data.lib,t.data.id))},this._handleClickFileFilter=e=>{this.props.app.setFilterType(e.item.key,"files")}}_renderFooterToolbar(e){var i,s;const t=(s=(i=this.props).getActions)==null?void 0:s.call(i,e,"current","sidebar-toolbar");if(t!=null&&t.length)return Be.render({items:t},[],{type:"ghost",size:"sm"})}_renderFooterHint(e){const t=this.props.app.renderCustom("sidebar-footer-hint",e);if(t!==void 0&&typeof t!="string")return t;let i="";if(typeof t=="string")i=t;else{const{space:s,spaceType:r,lib:o,showFiles:a,app:l}=this.props;if(s){const c=l.getLang("colon",": ");i=`${l.getLang(["spaceTypeNames",r],[],{custom:"空间",mine:"空间",product:"产品",project:"项目"}[r]||r)}${c}${s.name}`,o?i+=` ${l.getLang("libNamePrefix","库")}${c}${o.data.name}`:a&&(i+=` ${l.getLang("libNamePrefix","库")}${c}${l.getLang("filesLib","附件库")}`)}}return w("div",{className:"flex-auto text-gray text-clip overflow-hidden whitespace-nowrap",title:i},i)}_renderFooter(e){const t=this.props.app.renderCustom("sidebar-footer",e);return t!==void 0?t:w("div",{key:"actions",className:"doc-tree-actions row items-center flex-none surface-light h-9 border-t pl-2 pr-1"},this._renderFooterHint(e),this._renderFooterToolbar(e))}_getLibs(e){const{libs:t,app:i,onShowFiles:s,libTypes:r=[],libFilesIcon:o="annex-lib"}=e,a=[],l=s?{key:"project-files",text:i.getLang("filesLib","附件库"),icon:o,iconClass:"success-pale w-5 h-5 center rounded-lg",actions:!1,selected:e.showFiles,_data:{type:"files"}}:null;if(!(r!=null&&r.length))return a.push(...t.map(p=>this._getTreeItem(p))),l&&a.push(l),[a,!1];const[c,h]=Cx(t,r,i.spaceType),u=!!h.size;return r.forEach((p,m)=>{const v=c.get(p.type)||[];if(v.length)if(a.push({key:`lib-type-${p.type}`,type:"heading",text:p.name,content:w("span",{className:"label size-sm rounded-full gray-pale"},v.length+(l&&!m?1:0)),icon:p.icon,actions:!1,className:m&&a.length>1?"mt-1.5 pt-1 border-t":""}),u){const b=new Set,C=v.reduce((S,D)=>{const N=D.data.execution,P=N?h.get(N):null;if(P&&P.length>1){if(b.has(N))return S;b.add(N),S.push({className:"item tree-item",type:"item",key:`e${N}`,text:D.data.executionName??D.data.name,innerComponent:"div",icon:"run",iconClass:"text-gray",items:P.map(H=>({...this._getTreeItem(H),text:H.data.originName}))})}else S.push(this._getTreeItem(D));return S},[]);a.push(...C)}else a.push(...v.map(b=>this._getTreeItem(b)));!m&&l&&a.push(l)}),[a,u]}_renderLibList(e){const{libs:t,app:i,space:s}=e;if(!(t!=null&&t.length))return w("div",{key:"empty",className:"center gap-4 h-full"},w("div",{className:"text-gray"},i.getLang("noLibs","没有文档库")),Be.render({items:i.getActions("space",{ui:"sidebar-no-lib",data:s})},[]));const[r,o]=this._getLibs(e),a=e.app.getSortableOptions("lib");return w("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},o?w(a?as:It,{ref:this._menu,wrapClass:"doc-lib-list doc-lib-tree px-1",className:"p-2",items:r,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...a}):w(a?or:gt,{className:"doc-lib-list p-2",itemKey:"key",items:r,activeOnHover:!1,hoverItemActions:!0,onClickItem:this._handleClickItem,itemProps:{titleClass:"text-clip"},...a}))}_renderModuleTree(e){const{lib:t,app:i}=e,s=t?[...t.modules,...t.docs].filter(a=>!a.data.deleted):[];if(!s.length)return w("div",{key:"empty",className:"center gap-4 h-full"},w("div",{className:"text-gray"},i.getLang("noModules","没有目录")),Be.render({items:i.getActions("lib",{ui:"sidebar-no-module",data:t})},[]));const r=e.app.getSortableOptions("doc-module");return w("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},w(r?as:It,{ref:this._menu,wrapClass:"doc-lib-list doc-lib-tree px-1",className:V("p-2",t?"":"pl-3"),items:s,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",getItem:this._getTreeItem,onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...r}))}_renderFileFilterList(e){const t=["all","story","bug","task","office","doc","image","av","archive","code","other"].map(s=>({key:s,...Gu.filterTypeConfig[s]}));e.currentUser&&t.push({key:"addedByMe",...Gu.filterTypeConfig.addedByMe});const i=e.app.filterType;return w(gt,{className:"doc-file-filter-list py-2 px-3",itemKey:"key",items:t.map(s=>({...s,selected:s.key===i})),activeOnHover:!1,onClickItem:this._handleClickFileFilter})}_scrollToSelected(){const e=this._ref.current.querySelector(".item>.selected");e&&y(e).scrollIntoView({behavior:"smooth"})}componentDidMount(){this._sidebar=new $a(this._ref.current,{width:240,minWidth:64,maxWidth:400,parent:".doc-app",side:"left",preserve:this.props.preserve}),this._scrollToSelected()}componentDidUpdate(e){(e.moduleID!==this.props.moduleID||e.docID!==this.props.docID)&&this._scrollToSelected()}componentWillUnmount(){var e;(e=this._sidebar)==null||e.destroy()}render(e){const{className:t,lib:i,showFiles:s,app:r}=e,o=!i||s;return w("div",{className:V("doc-sidebar sidebar border-r flex-none z-50 col",t),ref:this._ref},r.renderCustom("sidebar-before",this),o?this._renderLibList(e):this._renderModuleTree(e),r.renderCustom("sidebar-after",this),this._renderFooter(o?"space":"lib"))}}function Cx(n,e,t){const i=new Map,s=new Map;for(const{type:o}of e)s.set(o,[]);const r=s.get(t);for(const o of n){const{type:a=""}=o.data;if(s.has(a)?s.get(a).push(o):r&&r.push(o),a!=="execution")continue;const l=o.data.execution;i.has(l)?i.get(l).push(o):i.set(l,[o])}return[s,i]}function Ni(n){return typeof n=="string"&&String(+n)===n?+n:n}function wg(n){return typeof n=="string"?+n.replace("api.",""):n}function xx(n,e,t){const i=new Map,s=new Map,r=new Map,o=[];if(e){const{libs:a=[],docs:l=[],modules:c=[]}=e;for(const u of a){if(u.deleted||u.space!==n&&!t)continue;const m={type:"lib",key:`l${u.id}`,docs:[],modules:[],data:u};i.set(u.id,m),o.push(m)}const h=[];for(const u of c){if(u.deleted)continue;const p=`m${u.id}`,m=i.get(u.lib);if(!m||m.data.type==="api"&&u.type!=="api")continue;const v={type:"module",key:p,docs:[],modules:[],data:u,parent:m};s.set(u.id,v),u.parent?h.push(v):m.modules.push(v)}if(h.length)for(const u of h){const p=s.get(u.data.parent);p&&(p.modules.push(u),u.parent=p)}for(const u of l){const p=`${u.id}`,m=i.get(u.lib);if(!m&&u.lib!==n)continue;const v={type:"doc",key:p,data:u,parent:m,docs:[]};r.set(u.id,v)}for(const u of r.values()){if(u.data.parent){const v=r.get(u.data.parent);if(v){v.docs.push(u),u.parent=v;continue}}const p=s.get(u.data.module),m=i.get(u.data.lib);p?(p.docs.push(u),u.parent=p):m&&m.docs.push(u)}}return{libs:i,modules:s,docs:r,libList:o}}function Sr(n,e=[],t){if(e.push(...t?n.docs.map(i=>i.data):n.docs),n.modules)for(const i of n.modules)Sr(i,e,t);for(const i of n.docs)Sr(i,e,t);return e}const Cg=1e9;let Sx=Cg;function kx(){return Sx++}function xg(n){return n>=Cg}function Tx(n){const{link:e,itemProps:t={},typeIconMap:i={},labelMap:s={},searchKeys:r,active:o,itemType:a="",checkIcon:l,hideDirIcon:c}=this,{id:h,keys:u,text:p,className:m,type:v,url:b,items:C,icon:S,label:D,...N}=n;let{type:P}=n;P=P==="item"?a:P||a;let H=C?D??(s[P]||P):null,q;typeof H=="string"&&H.length&&(q=H,H=w("span",{class:"label rounded-full gray-pale size-sm ml-1"},H));let Y=b;Y===void 0&&e&&(typeof e=="function"?Y=e(n):typeof e=="object"?(Y=e[P],Y&&(Y=we(Y,n))):C||(Y=we(e,n)));let Q=S;Q===void 0&&(!c||Y)&&(Q=i[P]),typeof Q=="string"&&(Q={icon:Q},q&&y.extend(Q,{"data-toggle":"tooltip","data-title":q}));let Z=p??(s[P]||P);r!=null&&r.length&&(Z=Ti.underlineKeys(r,[Z]));const ue=String(o)===String(h);return{type:"item",key:h,content:H,icon:Q,trailingIcon:l&&ue?{icon:"check",className:"mx-1 text-primary"}:void 0,items:C,"data-url":Y,"data-type":P,title:Z,selected:ue,hint:p,...t,...N,className:V("dropmenu-item tree-item",m,t.className,C?"is-dir":"is-item"),innerClass:Y?"is-link open-url":"is-toggle",active:!1}}function Sg(n){const{className:e,items:t,tree:i,onClickItem:s,defaultNestedShow:r}=n;return w(It,{items:t,getItem:Tx.bind(n),className:V(e,"dropmenu-tree"),defaultNestedShow:r,onClickItem:s,...i})}const Dx=(n,e)=>{const{keys:t="",text:i}=n;return!e.length||e.every(s=>t.toLowerCase().includes(s)||typeof i=="string"&&i.toLowerCase().includes(s))},kg=(n,e,t=0)=>(n=n.reduce((i,s)=>{const{items:r}=s;if(r){if(r.length){const[o,a]=kg(r,e);o.length&&(i.push({...s,items:o}),t+=a)}}else Dx(s,e)&&(i.push(s),t++);return i},[]),[n,t]);class Ix extends du{constructor(e){super(e),this._searchbox=he(),this._list=he(),this._handleSearch=t=>{this.setState({search:t})},this._handleExpandBtnClick=()=>{this.expand()},this._handleItemClick=({item:t,event:i})=>{const s=y(i.target);!s.closest(".tree-toggle").length&&s.closest(".is-link").length&&(this.props.togglePop(!1,{text:t.text??`${t.type}:${t.id}`}),this.props.changeState({text:t.text??`${t.type||""}:${t.id}`,value:t.id}))},this._scrollToActive=()=>{requestAnimationFrame(()=>{const t=this._list.current;t&&y(t).find(".tree-item-inner.active").scrollIntoView()})},this.activeTab=t=>{this.setState({active:t})},this.expand=t=>{this.setState({expanded:t??!this.state.expanded})},this.state={search:"",data:e.data,expanded:!1,loading:!!e.fetcher&&!e.data}}async load(){var i,s;let{fetcher:e}=this.props;if(!e)return this._scrollToActive();if(typeof e=="string"&&(e={url:e}),typeof e=="object"){const{url:r,...o}=e;e=()=>y.ajax({url:r,dataType:"json",jsonParser:Yl,...o})}this.setState({loading:!0});let t=await e();t.result&&(t=t.data),t={...this.props.data,...t},this.setState({data:t,loading:!1},this._scrollToActive),(s=(i=this.props).onCacheData)==null||s.call(i,t)}componentDidMount(){var e;super.componentDidMount(),this.props.data||this.load(),(e=this._searchbox.current)==null||e.focus(),this._scrollToActive()}_getTreeProps(e){const{data:{labelMap:t,link:i,typeIconMap:s,typeLabelMap:r,itemProps:o,tree:a,itemType:l,checkIcon:c,hideDirIcon:h=!0}={},search:u}=this.state,p=y.unique(u.toLowerCase().split(" ").filter(m=>m.length));return{items:p.length&&e.items.length>100?e.items.slice(0,100):e.items,labelMap:t,typeIconMap:{execution:"run",project:"project",product:"product",program:"cards-view",...s},hideDirIcon:h,typeLabelMap:r,itemProps:o,itemType:l,checkIcon:c,onClickItem:this._handleItemClick,tree:a,link:i,active:this.props.state.value,defaultNestedShow:!!((e.count||e.items.length)<100||p.length||e.index===0&&!e.expand),searchKeys:p}}_getData(){const{data:e={},search:t,active:i}=this.state,{tabs:s=[{name:"other"}],expandName:r}=e;let{data:o=[]}=e;Array.isArray(o)&&(o={other:o});const a={},l=y.unique(t.toLowerCase().split(" ").filter(p=>p.length));let c,h;Object.keys(o).forEach(p=>{const m=r===p,v=s.find(P=>P.name===p)||{name:p},b=o[p]||[],C=(i===p||v.active&&i===void 0)&&!m,[S,D]=kg(b,l),N={name:p,items:S,text:v.text,active:C,count:D,index:0,expand:m};m?c=N:(a[p]=N,C&&(h=N))});const u=s.reduce((p,{name:m})=>{if(m!==r){const v=a[m]||{name:m,items:[]};v.index=p.length,p.push(v)}return p},[]);return!h&&u.length&&(h=u[0]),{tabs:u,expandData:c,activeTab:h}}_renderList(e,t,i){const s=t.name,{expanded:r,data:o={},search:a}=this.state;let{hideSingleTab:l=!0}=o;return l=e.length===1&&l,w(Tn,null,l?null:w("div",{className:"dropmenu-nav"},w("ul",{key:"nav",className:"nav nav-secondary"},e.map(({name:c,text:h,count:u})=>w("li",{className:"nav-item"},w("a",{className:`${s===c?" active":""}`,onClick:this.activeTab.bind(this,c)},h||c,u?w("span",{className:"label gray-pale rounded-full size-sm font-normal"},u):null))))),w("div",{key:"tab",className:"flex-auto dropmenu-list scrollbar-hover"},w(Sg,{key:`${s}${a!=null&&a.length?"-search":""}`,...this._getTreeProps(t)})),i?w("div",{key:"foot",className:"dropmenu-foot flex-none toolbar justify-between border-t"},o.footToolbar?Be.render(o.footToolbar,[]):w("div",{className:"flex-auto"}),w(xe,{type:"ghost text-dark rounded gap-0.5 px-1.5",trailingIcon:`angle-${this.state.expanded?"left":"right"} opacity-60`,onClick:this._handleExpandBtnClick},i.text||i.name," ",i.count&&r?w("span",{className:"ml-1 label gray-pale rounded-full size-sm font-normal"},i.count):null)):null)}_renderExpand(e){const{search:t}=this.state;return w("div",{className:"col w-1/2 dropmenu-list scrollbar-hover"},w(Sg,{key:`${e.name}${t!=null&&t.length?"-search":""}`,...this._getTreeProps(e)}))}_renderPop(){const{expanded:e,data:t={}}=this.state,{searchHint:i,search:s=!0,title:r}=t,{expandData:o,tabs:a,activeTab:l}=this._getData(),c=e&&o;return w(Tn,null,s?w("div",{key:"search",className:"p-3 flex-none"},w(ki,{ref:this._searchbox,className:"size-md",placeholder:i,onChange:this._handleSearch})):null,r?w("div",{className:"dropmenu-title"},r):null,w("div",{class:"row flex-auto min-h-0",ref:this._list},w("div",{class:`col w-${c?"1/2":"full"}`},this._renderList(a,l,o)),c?w("div",{class:"w-px bg-gray opacity-10"}):null,e&&o&&this._renderExpand(o)))}_getClass(e){const{expanded:t,loading:i,data:s={}}=this.state;return V("dropmenu load-indicator col",super._getClass(e),t&&"is-expanded",i&&"loading",s.search!==!1&&"has-search",s.title?"has-title":"")}_getStyle(e={},t){e=super._getStyle(e,t);const{width:i=248}=this.props;return typeof i=="number"&&(e.width=i*(this.state.expanded?2:1)),e}_getProps(e){const{style:t,...i}=super._getProps(e),s=this.trigger,r=s==null?void 0:s.getBoundingClientRect();return{...i,style:{...t,...this._getStyle(),maxHeight:r?Math.max(r.top-8,window.innerHeight-r.bottom-8):t.maxHeight}}}}class $x extends ia{_getProps(e){const t=super._getProps(e);return{type:"button","data-value":e.state.value,...t}}_renderTrigger(e){const{text:t,state:i,children:s,caret:r,leadingAngle:o,display:a}=e;let l=i.text??t??"";return a&&(l=typeof a=="function"?a.call(this,l,i):a),[o&&w($e,{icon:"angle-right",className:"is-leading"}),w("span",{key:"text",className:"text",title:typeof l=="string"?l:void 0},l??s),r&&w("div",{key:"caret",class:"is-caret"},w("span",{className:"caret"}))]}}let kr=class extends ht{constructor(){super(...arguments),this._setCacheData=e=>{const{cache:t}=this.props;t&&(this._cacheData=e,typeof t=="number"&&(this._cacheTimer&&clearTimeout(this._cacheTimer),this._cacheTimer=window.setTimeout(()=>{this._cacheData=void 0,this._cacheTimer=0},t)))}}getDefaultState(e){return{...super.getDefaultState(e),text:void 0}}componentWillUnmount(){super.componentWillUnmount(),this._cacheTimer&&clearTimeout(this._cacheTimer)}componentWillReceiveProps(e){(this.props.data!==e.data||this.props.fetcher!==e.fetcher)&&(this._cacheData=void 0)}_getTriggerProps(e,t){const{className:i,...s}=super._getTriggerProps(e,t),{value:r=""}=t;return{...s,className:V(i,{"has-value":r.length}),text:e.text,caret:e.caret,maxWidth:e.maxWidth,leadingAngle:e.leadingAngle,display:e.display}}_getPopProps(e,t){return{...super._getPopProps(e,t),data:this._cacheData||e.data,fetcher:e.fetcher,cache:!!e.cache,onCacheData:this._setCacheData,onClickItem:e.onClickItem}}};kr.defaultProps={...ht.defaultProps,popWidth:248,popMaxHeight:800,maxWidth:160,className:"dropmenu-btn btn ghost",tagName:"button",clickType:"toggle",leadingAngle:!0,caret:!0,cache:60*1e3*4},kr.Pop=Ix,kr.Trigger=$x;class Ax extends me{constructor(){super(...arguments),this._handleClickItem=(e,t)=>{var i,s;e.target.closest(".dropmenu-nav")||e.target.closest(".dropmenu-foot")||(s=(i=this.props).onSelect)==null||s.call(i,+t,!0)}}render(e){const{space:t,fetcher:i,menuOptions:s}=e;return w(kr,{text:t==null?void 0:t.name,defaultValue:t==null?void 0:t.id.toString(),onClickItem:this._handleClickItem,fetcher:i,leadingAngle:!1,...s})}}class Tg extends me{constructor(){super(...arguments),this._picker=he(),this._getItems=()=>{const{spaces:e=[],spaceIcon:t}=this.props;return e.map(i=>({id:i.id,icon:t,text:i.name,value:i.id,className:"group"}))},this._renderCurrent=()=>{const{space:e}=this.props;return w("div",{class:"row items-center"},w("div",{className:"text-md flex-none"},e==null?void 0:e.name),w("span",{className:"caret"}))},this._handleClick=e=>{var t,i,s;!this.props.noClickTrigger&&!e.target.closest(".doc-space-picker-toggle")&&((s=(i=this.props).onSelect)==null||s.call(i,((t=this.props.space)==null?void 0:t.id)||0,!0),e.preventDefault())},this._handleItemClick=e=>{var s,r;const t=this._picker.current;if(!t)return;const i=e.item.value;(r=(s=this.props).onSelect)==null||r.call(s,i,!0),t.select(i),t.close()}}render(e){const{getSpaceFetcher:t,spaceID:i,space:s,spaceType:r,onSelect:o,menuOptions:a}=e;if(t){const p=t(r,i);if(p)return w(Ax,{fetcher:p,space:s,onSelect:o,menuOptions:a})}const{spaces:l=[],searchBox:c=!0}=e,h=s||l[0],u={searchBox:c,search:void 0,onClickItem:this._handleItemClick};return w(nn,{ref:this._picker,className:"doc-space-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-space-picker-menu",style:{maxWidth:200},items:this._getItems,defaultValue:h?String(h.id):"",required:!0,search:!1,cache:!1,caretClass:"hidden",menu:u,popMinWidth:200,display:this._renderCurrent,onClick:this._handleClick})}}Tg.defaultProps={noClickTrigger:!0};class Tr extends me{constructor(){super(...arguments),this._picker=he(),this._getItems=()=>{const{items:e=[],icon:t,apiIcon:i,chapterIcon:s,current:r,getItems:o}=this.props,a=e.filter(l=>!l.data.deleted).map(l=>({id:l.data.id,icon:l.type==="lib"&&l.data.type==="api"?i:l.type==="doc"&&l.data.type==="chapter"?s:t,text:this._getItemText(l),value:l.data.id,selected:(r==null?void 0:r.key)===l.key}));return o?o(a):a},this._renderCurrent=()=>{const{current:e,placeholder:t,type:i,suffixIcon:s,children:r}=this.props,o=i==="lib";return w("div",{class:V("row items-center",o?"gap-2":"gap-1")},w("div",{className:V("row items-center",o?"text-md":"",e?"":"text-gray")},e?this._getItemText(e):t,w("span",{className:"caret"})),r,s?w($e,{icon:s}):null)},this._handleClick=e=>{var t,i,s;!this.props.noClickTrigger&&!e.target.closest(".doc-path-picker-toggle")&&((s=(i=this.props).onSelect)==null||s.call(i,((t=this.props.current)==null?void 0:t.data.id)||0,this.props.type),e.preventDefault())},this._handleItemClick=e=>{var s,r;const t=this._picker.current;if(!t)return;const i=e.item.value;(r=(s=this.props).onSelect)==null||r.call(s,Ni(i),e.item.dataType),t.select(i),t.close()}}_getItemText(e){return e?e.type==="doc"?e.data.title:e.data.name:""}render(e){const{current:t,type:i,maxWidth:s,display:r,searchBox:o=!0}=e,a={searchBox:o,search:void 0,onClickItem:this._handleItemClick};return w(nn,{ref:this._picker,className:"doc-path-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-path-picker-menu",style:{maxWidth:s},items:this._getItems,defaultValue:t?String(t.data.id):"",search:!1,cache:!1,caretClass:"hidden",menu:a,popMinWidth:200,required:i!=="lib",display:r??this._renderCurrent,onClick:this._handleClick})}}Tr.defaultProps={type:"module",maxWidth:160,noClickTrigger:!0};class Ex extends me{constructor(){super(...arguments),this._handleSelectModule=e=>{var t,i;(i=(t=this.props).onSelectModule)==null||i.call(t,+e,!0)},this._handleSelectLib=(e,t)=>{var i,s;t==="files"?this.props.app.showFiles():(s=(i=this.props).onSelectLib)==null||s.call(i,+e,0)},this._unselectLib=()=>{var e,t;(t=(e=this.props).onSelectLib)==null||t.call(e,0,0)},this._handleSelectVersion=e=>{var t,i;(i=(t=this.props).onSelectDocVersion)==null||i.call(t,e.item.version)},this._handleRestoreDocVersion=async()=>{const{app:e,doc:t}=this.props,{version:i=1,id:s}=t==null?void 0:t.data,r=this.props.docVersion||i;await Re.confirm({title:e.getLang("restoreVersionHint","恢复到版本")+` #${r}`,message:e.getLang("restoreVersionConfirm",[{version:r}],"这将使用文档版本 #{version} 的内容创建一个新的版本，确定要继续吗？")})&&e.restoreDoc(s,r)},this._getLibItems=e=>{const{app:t,libIcon:i,showFiles:s}=this.props;return t.canShowLibFiles?[...e,{text:t.getLang("filesLib","附件库"),icon:i,key:"files",dataType:"files",selected:!!s,disabled:!1}]:e}}_renderAngle(e){return w("div",{key:e,class:"doc-path-picker-angle chevron-right scale-75 opacity-75 flex-none"})}_renderModulePickers(e){const{module:t}=e;if(!t)return[];let i=t;const s=[];for(;i;){const{parent:o}=i;if(s.push(i),o.type!=="module")break;i=o}const r=[];return s.reverse().forEach((o,a)=>{if(s.length>=3&&a>0&&a<s.length-1){a===1&&r.push(["module-ellipsis",w("div",{key:"module-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},w("div",{className:"more"}))]);return}const{key:l}=o;r.push([`${l}-angle`,w(Tr,{key:l,icon:e.moduleIcon,current:o,items:o.parent.modules,searchBox:{placeholder:this.props.app.getLang("searchModulePlaceholder","searchModulePlaceholder")},onSelect:this._handleSelectModule})])}),r}_renderParents(e){var c,h;const{doc:t,app:i,docIcon:s,onSelectDoc:r}=e;if(!t||((c=t.parent)==null?void 0:c.type)!=="doc")return[];let o=t.parent;const a=[];for(;o&&(a.push(o),((h=o.parent)==null?void 0:h.type)==="doc");)o=o.parent;const l=[];return a.reverse().forEach((u,p)=>{var v;if(a.length>=3&&p>0&&p<a.length-1){p===1&&l.push(["parent-ellipsis",w("div",{key:"parent-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},w("div",{className:"more"}))]);return}const{key:m}=u;l.push([`${m}-angle`,w(Tr,{key:m,type:"doc",icon:s,chapterIcon:i.props.chapterIcon,current:u,items:(v=u.parent)==null?void 0:v.docs,searchBox:{placeholder:i.getLang("searchPlaceholder","搜索")},onSelect:r,maxWidth:300})])}),l}_renderCurrent(e){var l,c;const{doc:t,creatingDoc:i,editingDoc:s,docIcon:r,onSelectDoc:o,app:a}=e;if(i)return w(xe,{key:"doc",type:"ghost",icon:r,className:"mr-4 min-w-0 justify-start"},w("span",{className:"text-gray min-w-0 overflow-hidden"},i.title),w("span",{className:"label size-sm rounded-full primary-pale flex-none"},a.getLang("newDocLabel","新文档")));if(s)return w(xe,{key:"doc",type:"ghost",icon:r,className:"mr-4 min-w-0 justify-start"},w("span",{className:"text-gray min-w-0 overflow-hidden"},s.title),w("span",{className:"label size-sm rounded-full primary-pale flex-none"},a.getLang("editingDocLabel","编辑中")));if(t){const{version:h=1,privs:u={},id:p}=t.data,m=e.docVersion||h,v=!t.data.deleted&&!t.data.api&&h>1&&m!==h&&(((l=a.props.privs)==null?void 0:l.restoreDoc)??u.edit!==!1),b=a.isLoadingDoc(p);return[w(Tr,{key:"doc",type:"doc",icon:r,chapterIcon:a.props.chapterIcon,current:t,items:(c=t.parent)==null?void 0:c.docs,onSelect:o,searchBox:{placeholder:a.getLang("searchPlaceholder","搜索")},maxWidth:300,suffixIcon:s?"draft-edit":void 0}),h>1?w("div",{key:"version",className:"hint mx-1","data-hint":a.getLang("currentDocVersionHint","当前版本，点击切换")},w(Ss,{text:`#${m}`,size:"xs",type:"gray-pale",rounded:"full",className:"h-4",items:Array(h).fill(0).map((C,S)=>({text:`#${h-S}`,version:h-S,selected:m===h-S})),menu:{onClickItem:this._handleSelectVersion}})):null,v?w("div",{key:"restoreVersion","data-hint":`${a.getLang("restoreVersionHint","恢复到版本")} #${m}`,className:"hint ml-1"},w(xe,{disabled:b,text:a.getLang("restoreVersion","恢复"),type:"ghost text-primary",size:"sm",rounded:"full",onClick:this._handleRestoreDocVersion})):null,t.data.status==="draft"?w("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},a.getLang("draft","草稿")):null]}return null}_renderLibPicker(e){const{lib:t,libs:i,libIcon:s,apiLibIcon:r,libPlaceholder:o,showFiles:a,app:l}=e;return!t&&!a?null:w(Tr,{key:"lib",type:"lib",icon:s,apiIcon:r,current:t,items:i,getItems:this._getLibItems,display:a?()=>w("div",{class:"row items-center gap-2"},w("div",{class:"text-md"},l.getLang("filesLib","附件库")),w("span",{className:"caret"})):void 0,placeholder:o,searchBox:{placeholder:l.getLang("searchLibPlaceholder","搜索库")},onSelect:this._handleSelectLib})}render(e){const{spaceIcon:t,space:i,spaces:s,onSelectSpace:r,children:o,homeName:a,noSpace:l,getSpaceFetcher:c,spaceID:h,spaceType:u,app:p}=e;let m;if(l)m=l==="hidden"?null:w(xe,{icon:i?t:"home",type:"ghost",iconClass:"w-4 h-4 center rounded-md primary flex-none",textClass:"text-md",text:i==null?void 0:i.name,onClick:this._unselectLib});else if(i){let P=p.props.spaceMenuOptions;typeof P=="function"&&(P=P.call(p,u,h)),m=w(Tg,{key:"space",spaceIcon:t,space:i,spaces:s,searchBox:{placeholder:p.getLang("searchSpacePlaceholder","搜索空间")},onSelect:r,getSpaceFetcher:c,spaceType:u,spaceID:h,menuOptions:P})}const v=this._renderLibPicker(e),b=this._renderModulePickers(e),C=this._renderParents(e),S=this._renderCurrent(e);let D=[];a!==!1&&D.push(["home",w(xe,{key:"home-btn",icon:"home",size:"md",type:"ghost text-primary",hint:typeof a=="string"?a:void 0,command:"goHome",...typeof a=="object"?a:{}})]),D.push(["space",m]),v&&D.push(["lib",v]),b&&D.push(...b),C&&D.push(...C),S&&D.push(["current",S]);const N=p.getCustomRender("app-nav");return N&&(D=N.call(p,D,this)||D),w("div",{className:"doc-app-nav row items-center flex-auto min-w-0"},D.reduce((P,[H,q],Y)=>(q==null||(Array.isArray(q)?P.push(...q):P.push(q),Y<D.length-1&&P.push(this._renderAngle(H+"-angle"))),P),[]),o)}}function Yu(){var n;return(n=window.frameElement)==null?void 0:n.closest("affine-zui-iframe")}function Xu(){const n=Yu();if(!n)return;const e=n.getAttribute("data-block-id"),t=n.closest("editor-host");if(!(!t||!e))return t.std.doc.getBlock(e)}function Nx(){const n=Xu();n&&n.doc.deleteBlock(n.model)}function Mx(n){const e=Xu();e&&e.doc.updateBlock(e.model,n)}function Px(){var n;return(n=Yu())==null?void 0:n.adjustHeight()}const Lx={getElement:Yu,get:Xu,delete:Nx,update:Mx,adjustHeight:Px};function Qu(n,e){var i;if(Array.isArray(n))return n.map(s=>Qu(s,e));let t=n;return(i=t.children)!=null&&i.length&&(t={...n,children:Qu(n.children,e)}),e(t)}const sn=class Le extends We{constructor(){super(...arguments),this._lastChangeContent="",this._assetsMap=new Map,this._isEmpty=!0,this._hocuspocusProvider=null}get collection(){if(!this._collection)throw new Error("Editor._collection must be initialized!");return this._collection}get schema(){if(!this._schema)throw new Error("Editor._schema must be initialized!");return this._schema}get doc(){if(!this._doc)throw new Error("Editor._doc must be initialized!");return this._doc}get editor(){if(!this._editor)throw new Error("Editor._editor must be initialized!");return this._editor}get host(){return this.editor.host}get title(){var e;return((e=this.doc.meta)==null?void 0:e.title)??this.options.title??"Untitled"}get context(){var r,o;const e=(r=this.doc.root)==null?void 0:r.id;if(!e||!this.host)return;const t=this.host.view.getBlock(e);if(!t)return;const i=this.host.selection.find("text");if(!i)return;const s=(o=this.host.doc.getBlock(i.blockId))==null?void 0:o.model;if(s)return{rootComponent:t,model:s}}get isEmpty(){return Le.Module.utils.isEmptyDoc(this.doc)}get rootService(){try{return this.editor.std.getService("affine:page")}catch{return null}}async readyToUseHocuspocus(e,t=!0){try{if(!e)return null;const i=typeof e=="string"?JSON.parse(e):e,{Y:s,utils:r}=Le.Module,o=i.meta.id,{hocuspocusUrls:a,token:l}=this.options,c=a==null?void 0:a[0];if(!c||!l)return null;if(t&&(await(await fetch(`${c}/doc/${this.options.docID}@${o}/exists`)).json()).data)return o;const h=await r.convertSnapshotToYDoc(i,this.getBlockSources());if(!h)return null;const u=s.encodeStateAsUpdate(h);return(await(await fetch(`${c}/doc/${this.options.docID}@${o}/init`,{method:"POST",body:u,headers:{"Content-Type":"application/octet-stream",token:l}})).json()).result==="success"?o:null}catch(i){return console.error("Ready to use hocuspocus error:",i),null}}async afterInit(){const{schema:e,collection:t,content:i,mode:s,contentType:r,title:o,uid:a,onLoadingLibChange:l,useHocuspocus:c}=this.options,{store:h}=await Le.loadModule(l);if(this.destroyed)return;const{DocCollection:u}=h;if(this._uid=a||Ei(13),c){const{checkExists:p=!0}=typeof c=="object"?c:{},m=await this.readyToUseHocuspocus(i,p);if(m){this.initHocuspocusDoc({docId:m,mode:s});return}}this._schema=e||Le.createSchema(),this._collection=t||new u({schema:this.schema,blobSources:this.getBlockSources()}),this._collection.meta.initialize(),this._editor=Le.createEditor(s),await this.updateDoc(i,r,o),this.doc.history.clear(),await this.syncData(!0),this.element.appendChild(this.editor),this.$element.addClass("affine-theme").on("syncData",()=>this.syncData())}async initHocuspocusDoc({docId:e,mode:t}){const{store:i}=Le.Module,{DocCollection:s}=i;this._schema=this.options.schema||Le.createSchema(),this._collection=new s({schema:this.schema,blobSources:this.getBlockSources()}),this.collection.start(),this.collection.meta.initialize(),this._doc=this.collection.createDoc({id:e}),this.createHocuspocusProvider(),this.doc.load(),this._editor=Le.createEditor(t),this.editor.doc=this.doc,this.element.appendChild(this.editor)}destroyHocuspocusProvider(){var e;(e=this._hocuspocusProvider)==null||e.destroy()}setDocReadonly(){this.options.readonly&&this.collection.awarenessStore.setReadonly(this.collection.getBlockCollection(this.doc.id),!0)}getBlockSources(){const{onDownload:e,downloadUrl:t,onUpload:i}=this.options;if(!e&&!i&&!t)return;const s=this._assetsMap;return{main:{name:this._uid,readonly:!1,get:async r=>{const o=s.get(r);if(o)return o;if(e)try{const a=await e({key:r,editorID:this._uid}),l=a==null?void 0:a.blob;if(l)return s.set(r,l),l}catch(a){console.error("[ZUI] download file failed",a)}else if(t){let a=t;if(r.startsWith("data:"))a=r;else if(/https?:\/\//.test(r)){const h=window.EDITOR_IMAGE_PROXY_ENDPOINT;a=h?`${h}?url=${encodeURIComponent(r)}`:r}else a=we(t,{objectType:"doc",objectID:this.options.docID,gid:btoa(`g-${r}`),title:"",extra:"editor"});const c=await(await fetch(a)).blob();return s.set(r,c),c}return null},set:async(r,o)=>{if(s.set(r,o),i)try{await i({key:r,blob:o,editorID:this._uid})}catch(a){console.error("[ZUI] update file failed",a)}return r},delete:async r=>{s.delete(r)},list:async()=>Array.from(s.keys())}}}render(e,t){super.render(e,t),t&&this.updateDoc(this.options.content,void 0,this.options.title)}async getHtml(e){const{store:t}=Le.Module,i=this.doc,s=i.collection;return e||(e=new t.Job({collection:s}).docToSnapshot(i)),e?await Le.convertToHtml(e,s,this.options.downloadUrl):""}async export(e="pdf",t){const{blocks:i}=Le.Module,s=this.editor.std.get(i.ExportManager);return s?(y("body").addClass("editor-is-exporting"),e==="png"?await s.exportPng():e==="markdown"?await this.exportMarkdown():e==="json"?await this.exportSnapshot(t):e==="html"?await this.exportHtml():await s.exportPdf(),y("body").removeClass("editor-is-exporting"),!0):!1}exportMarkdown(){var t;const e=(t=this.rootService)==null?void 0:t.transformers.markdown;return e==null?void 0:e.exportDoc(this.doc)}exportHtml(){var t;const e=(t=this.rootService)==null?void 0:t.transformers.html;return e==null?void 0:e.exportDoc(this.doc)}async exportSnapshot(e){const t=await this.toSnapshot(),i=new Blob([JSON.stringify(t)],{type:"application/json"});Ji(i,`${e??(t==null?void 0:t.meta.title)??this.title}.json`)}exportPDF(){return this.export("pdf")}exportPNG(){return this.export("png")}getBlock(e){var t;if(e instanceof HTMLElement&&(e=((t=e.closest("[data-block-id]"))==null?void 0:t.getAttribute("data-block-id"))||""),typeof e=="string")return this.doc.getBlock(e)}deleteBlock(e){const t=this.getBlock(e);if(t)return this.doc.deleteBlock(t.model),!0}updateBlock(e,t){const i=this.getBlock(e);i&&this.doc.updateBlock(i.model,t)}_createEmptyDoc(){const e=Le.createEmptyDoc(this.collection);return this._isEmpty=!0,e}async _importSnapshot(e){const{store:t}=Le.Module,i=e,s=this.collection,r=new t.Job({collection:s});let o;try{o=await r.snapshotToDoc(i),o&&s.setDocMeta(o.id,{createDate:i.meta.createDate})}catch(a){console.error("[ZUI] parse doc content error:",a)}return o||this._createEmptyDoc()}async importHTML(e){return await Le.importHtml(e,this.collection)||this._createEmptyDoc()}async importConfluence(e){return await Le.importConfluence(e,this.collection)||this._createEmptyDoc()}async importMarkdown(e){const{blocks:t}=Le.Module,i=this.collection,s=await t.MarkdownTransformer.importMarkdownToDoc({collection:i,markdown:e});return s?i.getDoc(s)||this._createEmptyDoc():this._createEmptyDoc()}_migrateFrom(e){return e.$migrate==="html"?this.importHTML(e.$data):e.$migrate==="markdown"?this.importMarkdown(e.$data):e.$migrate==="confluence"?this.importConfluence(e.$data):this._createEmptyDoc()}async updateDoc(e="",t="snapshot",i){if(this._doc&&this._doc.dispose(),e==="")this._doc=this._createEmptyDoc();else if(t==="doc"||t==="snapshot"||typeof e=="object")try{for(;typeof e=="string";)e=JSON.parse(e);e.$migrate?this._doc=await this._migrateFrom(e):this._doc=await this._importSnapshot(e),this._lastChangeContent=typeof e=="string"?e:JSON.stringify(e)}catch(c){this._doc=this._createEmptyDoc(),console.error("[ZUI] parse doc content error:",c)}else t==="html"?this._doc=await this.importHTML(e):t==="markdown"?this._doc=await this.importMarkdown(e):t==="confluence"?this._doc=await this.importConfluence(e):this._doc=this._createEmptyDoc();const{readonly:s,name:r,htmlName:o}=this.options;this.setDocReadonly();const a=(c,h)=>{const u=document.createElement("input");return u.type="hidden",u.name=c,u.value=h||"",this.element.appendChild(u),u};r&&(this._input||(this._input=a(r)),this._uidInput||(this._uidInput=a("uid",this._uid)),this._input.value=JSON.stringify(e)),o&&(this._htmlInput||(this._htmlInput=a(o)),this._htmlInput.value=await this.getHtml()),this.editor.doc=this._doc;const l=()=>{this._isEmpty=this.isEmpty,this.$element.toggleClass("is-editor-empty",!!this._isEmpty)};return this._doc.slots.blockUpdated.on(()=>{l(),this.trySyncData()}),l(),this.$element.toggleClass("is-readonly",!!s).toggleClass("is-editing",!s),i!==void 0&&this.updateTitle(i),this._doc}async updateTitle(e){var s;const t=this.doc,i=t.root.title;i&&(i.clear(),i.insert(e,0)),t.collection.setDocMeta(this.doc.id,{title:(s=t.root)==null?void 0:s.title.toString()})}trySyncData(){this._updateTimer=window.setTimeout(()=>{this.syncData()},200)}async syncData(e){var s,r;const t=await this.toSnapshot();if(!t)return this._lastChangeContent="",!1;const i=JSON.stringify(t);if(this._lastChangeContent===i)return!1;if(this._lastChangeContent=i,this._input&&(this._input.value=i),!e){const o={uid:this._uid,content:i,title:t.meta.title,contentType:"doc",isEmpty:this._isEmpty};(r=(s=this.options).onChange)==null||r.call(s,o,t)}}async getData(e){return e===void 0&&(e=await this.toSnapshot()),e?{content:JSON.stringify(e),title:e.meta.title,uid:this._uid}:{content:"",title:"",uid:this._uid}}async toSnapshot(){return Le.toSnapshot(this.doc)}insertText(e,t){if(t=t||this.context,!t)return;const{rootComponent:i,model:s}=t;if(!s.text){console.error("Can't insert text! Text not found");return}Le.Module.components.insertContent(i.host,s,e)}insertBlock(e,t,i){if(i=i||this.context,!i)return;const{rootComponent:s,model:r}=i,o=s.doc.getParent(r);if(!o)return;const a=o.children.indexOf(r),l=e.includes(":")?e:`affine:${e}`;return s.doc.addBlock(l,t,s.doc.getParent(r),a)}insertComponent(e,t,i){const s=typeof e=="string"?{name:e}:e;return this.insertBlock("affine:embed-zui-component",{options:t,...s},i)}insertIframe(e,t){const i=typeof e=="string"?{name:e}:e;return this.insertBlock("affine:embed-zui-iframe",i,t)}insertHtmlBlock(e,t){const i=typeof e=="string"?{html:e}:e;return this.insertBlock("affine:embed-zui-html",i,t)}insertLazyBlock(e,t,i){const{content:s,...r}=t||{};return this.insertCustom({...s,fetcher:e},r,i)}insertCustom(e,t,i){return this.insertBlock("affine:embed-zui-custom",{content:e,...t},i)}async createHocuspocusProvider(){console.log("> connect to hocuspocus");const e=this._doc;if(!e)throw new Error("Hocuspocus provider needs a doc.");const{awarenessUser:t,hocuspocusUrls:i,token:s}=this.options;if(!t)throw new Error("Hocuspocus provider needs awarenessUser");if(!i||!i[1])throw new Error("Hocuspocus provider needs hocuspocusUrls");const r=e.awarenessStore.awareness,{hocuspocusProvider:o}=await Le.loadModule(),a=new o.HocuspocusProvider({url:i[1],name:`${this.options.docID}@${e.id}`,document:e.spaceDoc,awareness:r,token:s,onAuthenticationFailed:l=>{var c,h,u;console.log("> onAuthenticationFailed",l),(h=(c=this.options).onAuthenticationFailed)==null||h.call(c,l),(u=this._hocuspocusProvider)==null||u.destroy()},onAwarenessUpdate:l=>{var c,h;console.log("> Hocuspocus awareness update",l),(h=(c=this.options).onAwarenessUpdate)==null||h.call(c,l)},onConnect:()=>{var l,c;console.log("> Hocuspocus connect"),(c=(l=this.options).onConnect)==null||c.call(l)},onDisconnect:({event:l})=>{var c,h;console.log("> Hocuspocus disconnect",l),(h=(c=this.options).onDisconnect)==null||h.call(c,l)},onClose:({event:l})=>{var c,h,u;console.log(">>> Hocuspocus close",l),l.code===4205&&l.reason==="Reset Connection"&&((c=this._hocuspocusProvider)==null||c.destroy(),(u=(h=this.options).onClose)==null||u.call(h,l))},onMessage:l=>{console.log("> Hocuspocus message",l)},onOutgoingMessage:l=>{console.log("> Hocuspocus outgoing message",l)},onStateless:l=>{console.log("> Hocuspocus stateless",l)},onSynced:l=>{console.log(">>> Hocuspocus synced!",l),this._hocuspocusProvider=a,this.setDocReadonly()},onStatus:l=>{console.log("> Hocuspocus status",l)},onDestroy:()=>{console.log(">>> Hocuspocus destroy"),this._hocuspocusProvider=null}});a.setAwarenessField("user",t)}destroy(){var e,t,i,s,r;super.destroy(),(e=this._doc)==null||e.dispose(),(t=this._editor)==null||t.remove(),(i=this._input)==null||i.remove(),(s=this._uidInput)==null||s.remove(),(r=this._hocuspocusProvider)==null||r.destroy(),this._updateTimer&&clearTimeout(this._updateTimer)}static async loadModule(e){var t,i;if(!this.Module){if(e==null||e(!0),!this.Module){const s=await y.getLib("blocksuite");this.Module=s,(i=(t=s.zui).use)==null||i.call(t,{init:hc,create:Io,runJS:qs}),this.slashMenuSettings.forEach(([r,o])=>{s.utils.setSlashMenu(this.formatSlashMenuItems(r),o)}),this.slashMenuSettings=[]}e==null||e(!1)}return this.Module}static formatSlashMenuItems(e){const t=this.Module,i=s=>r=>s.call(this.query(r.rootComponent),r);return e.map(s=>{if(typeof s=="object"&&s){if(typeof s.icon=="string"){let r=s.icon,o=t.icons[r];o===void 0&&(r.startsWith("icon-")||(r=`icon-${r}`),r.split(" ").includes("icon")||(r=`icon ${r}`),o=t.lit.html`<i class=${r}></i>`),s={...s,icon:o}}s.divider&&(s={groupName:"",...s}),s.action?s={...s,action:i(s.action)}:s.subMenu&&(s={...s,subMenu:this.formatSlashMenuItems(s.subMenu)})}return s})}static setSlashMenu(e,t){this.Module?this.Module.utils.setSlashMenu(this.formatSlashMenuItems(e),t):this.slashMenuSettings.push([e,t])}static forEachBlock(e,t){t(e);for(const i of e.children)t(i),this.forEachBlock(i,t)}static createEditor(e){const{presets:t,blocks:i,utils:s}=Le.Module;let r;const o=()=>s!=null&&s.patchPageRootSpec?s.patchPageRootSpec(i.PageEditorBlockSpecs):i.PageEditorBlockSpecs;return e==="full"?(r=new t.AffineEditorContainer,r.pageSpecs=o()):e==="edgeless"?r=new t.EdgelessEditor:(r=new t.PageEditor,r.specs=o()),r}static async convertToHtml(e,t,i){const{store:s,blocks:r}=Le.Module;let o;if(typeof e=="string")try{o=JSON.parse(e)}catch(v){console.error("[ZUI] parse doc content error:",v)}else o=e;if(!o)return"";t=t||new s.DocCollection({schema:new s.Schema().register(r.AffineSchemas)});const a=new s.Job({collection:t}),l=new r.HtmlAdapter(a),c=Qu(o.blocks,v=>v.flavour==="affine:bookmark"?{...v,flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:v.props.title??v.props.url,attributes:{link:v.props.url}},v.props.description?{insert:` (${v.props.description})`}:null].filter(Boolean)}}}:v),h=await l.fromBlockSnapshot({snapshot:c,assets:a.assetsManager}),u=document.createElement("template");u.innerHTML=h.file.replace("<!--BlockSuiteDocTitlePlaceholder-->","");const p=u.content;if(i&&h.assetsIds.length){const v=new Set(h.assetsIds),b=new Map;a.assets.entries().forEach(([C,S])=>{S.name&&b.set(S.name,{file:S,id:C})}),p.querySelectorAll("img").forEach(C=>{const S=C.getAttribute("alt")??"";let D=S.split(".").shift(),N;if(D&&v.has(D))N=a.assets.get(D);else{const P=b.get(S);P&&(D=P.id,N=P.file)}if(N){const P=we(i,{gid:btoa(`g-${D}`),title:btoa(D),extra:"editor"});C.src=P.replaceAll("&","{{AMP}}")+"#g="+btoa(D)}})}return p.querySelectorAll("pre.shiki>code").forEach(v=>{v.textContent=v.textContent}),p.querySelectorAll(".affine-block-children-container").forEach(v=>{v.childNodes.length||v.remove()}),p.children[p.childElementCount-1].innerHTML.replaceAll("{{AMP}}","&")}static createEmptyDoc(e){const{store:t}=Le.Module;e||(e=new t.DocCollection({schema:Le.createSchema()}),e.start(),e.meta.initialize());const i=e.createDoc();i.load();const s=i.addBlock("affine:page",void 0);i.addBlock("affine:surface",void 0,s);const r=i.addBlock("affine:note",void 0,s);return i.addBlock("affine:paragraph",void 0,r),i}static toSnapshot(e){const{collection:t}=e;return new Le.Module.store.Job({collection:t}).docToSnapshot(e)}static cleanHtml(e){const t=document.createElement("template");return t.innerHTML=e,t.content.querySelectorAll("img").forEach(s=>{const r=s.getAttribute("src");r!=null&&r.startsWith("/")&&s.setAttribute("src",`${location.origin}${r}`)}),t.innerHTML}static async importConfluence(e,t){const i=await Le.loadModule(),{store:s}=i;try{t=t||new s.DocCollection({schema:Le.createSchema()});const r=await i.blocks.ConfluenceTransformer.importConfluenceToDoc({collection:t,confluence:e});if(r)return t.getDoc(r)}catch(r){console.error("[ZUI] import confluence error:",r)}}static async importHtml(e,t){const{store:i,blocks:s}=await Le.loadModule();try{t=t||new i.DocCollection({schema:Le.createSchema()});const r=await s.HtmlTransformer.importHTMLToDoc({collection:t,html:this.cleanHtml(e)});if(r)return t.getDoc(r)}catch(r){console.error("[ZUI] import html error:",r)}}static async htmlToSnap(e,t){try{const{store:i,blocks:s}=await Le.loadModule();t=t||new i.DocCollection({schema:Le.createSchema()});const r=new i.Job({collection:t});return await new s.HtmlAdapter(r).toBlockSnapshot({file:this.cleanHtml(e)})}catch(i){console.error("[ZUI] html to snap error:",i)}}static setGlobalConfig(e){window.EDITOR_CONFIG||(window.EDITOR_CONFIG={}),Object.assign(window.EDITOR_CONFIG,e)}static createSchema(){const{store:e,blocks:t}=Le.Module,{AffineSchemas:i}=t,s=new e.Schema().register(i);return["affine:embed-linked-doc","affine:embed-youtube","affine:embed-figma","affine:embed-github","affine:embed-loom"].forEach(r=>s.flavourSchemaMap.delete(r)),s}static nanoid(){return Ei()}};sn.NAME="Editor",sn.DEFAULT={mode:"page",contentType:"snapshot"},sn.slashMenuSettings=[],sn.iframe=Lx,sn.confluenceBlockMatcherMap={},sn.registerConfluenceBlockMatcher=(n,e)=>{if(sn.Module)sn.Module.blocks.ConfluenceAdapter.registerBlockMatcher(n,e);else if(typeof n=="object")for(const t in n)sn.confluenceBlockMatcherMap[t]=n[t];else sn.confluenceBlockMatcherMap[n]=e};let rn=sn;const Dg=Ne.getCode();y.registerLib("blocksuite",{src:[`editor/blocksuite/editor${Dg!=="zh_cn"?`.${Dg}`:""}.umd.cjs`,"editor/blocksuite/editor.css"],check:"BlockSuite"}),rn.register();let{maxUploadSize:Mi}=window.config||{};Mi&&(Mi=typeof Mi=="string"?Sn(Mi):Mi,rn.setGlobalConfig({maxFileSize:Mi,maxImageSize:Mi}));const Rx=Pt("file","read","fileID={fileID}","{viewType}");rn.setGlobalConfig({imageSrcGetter:n=>{if(n.startsWith("{")&&n.endsWith("}")){const e=n.slice(1,-1),[t,i]=e.split(".");return Rx.replace("{fileID}",t).replace("{viewType}",i)}return n}});class za extends rn{}za.NAME="PageEditor",za.DEFAULT={mode:"page"},za.register(),Object.assign(window,{Editor:rn});class Is extends me{constructor(){super(...arguments),this._ref=he()}get element(){return this._ref.current}get $(){return this._editor}init(e){var u;const{className:t,style:i,rootProps:s,ref:r,children:o,jsx:a,key:l,autoInit:c,...h}=this.props;return e={...h,...e},(u=this._editor)==null||u.destroy(),y(this.element).empty(),this._editor=new rn(this.element,e),this._editor}destroyHocuspocusProvider(){var e;(e=this._editor)==null||e.destroyHocuspocusProvider()}update(e){var t;(t=this._editor)==null||t.render(e)}getData(){var e;return(e=this._editor)==null?void 0:e.getData()}getHtml(){var e;return(e=this._editor)==null?void 0:e.getHtml()}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){var e;(e=this._editor)==null||e.destroy()}render(e){const{className:t,style:i,rootProps:s,children:r}=e;return w("div",{ref:this._ref,className:V("editor",t),style:i,...s},r)}}Is.defaultProps={autoInit:!0};const Ig=class Fv extends me{constructor(e){super(e),this._editorRoot=he(),this._titleEle=he(),this._handleChange=()=>{var t,i;(i=(t=this.props).onChange)==null||i.call(t,this.data)},this._uid=e.uid??Ei(13).replaceAll("-","_")}get data(){var t,i,s;const e=((i=(t=this._editorRoot.current)==null?void 0:t.querySelector("zen-editor"))==null?void 0:i.value)??"";return{title:((s=this._titleEle.current)==null?void 0:s.value)??"",content:e,html:e,uid:this._uid,contentType:this.props.contentType}}_loadLib(){return y.getLib("zeneditor",{type:"module"})}async init(e){var l,c,h,u;customElements.get("zen-editor")||((c=(l=this.props).onLoadingLibChange)==null||c.call(l,!0),await this._loadLib(),(u=(h=this.props).onLoadingLibChange)==null||u.call(h,!1));const{readonly:t,content:i,contentType:s,placeholder:r,uploadUrl:o=""}={...this.props,...e},a=[];a.push(`<zen-editor class="p-0 w-full h-full" upload-url="${we(o,{uid:encodeURIComponent(this._uid),extra:"",field:"imgFile",gid:""})}"${t?" readonly hide-ui":""} fullscreenable expose-editor${s==="markdown"?" markdown":""}${r?` placeholder="${r}"`:""} size="auto" menubar-mode="compact" css="${Fv.injectCSS()}">`,`  <article slot="content">${i}</article>`,"</zen-editor>",`<textarea rows="1" style="display: none">${i}</textarea>`,`<input type="hidden" name="uid" value="${this._uid}" />`),y(this._editorRoot.current).html(a.join(`
`))}async getData(){return Promise.resolve(this.data)}update(e){this.init(e)}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){const e=this._editorRoot.current;e&&(e.innerHTML="")}_renderTitle(e){const{readonly:t,title:i,mode:s}=e;return s!=="full"?null:t?w("h1",{class:"zen-editor-title",style:"font-size: 40px"},i):w("input",{ref:this._titleEle,class:"zen-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:i,onChange:this._handleChange})}render(e){const{className:t,readonly:i,children:s}=e;return w("div",{className:V("zen-editor-container relative",t)},this._renderTitle(e),w("div",{ref:this._editorRoot,className:V("zen-editor p-px mt-px rounded relative",i?"is-readonly":""),onChange:this._handleChange}),s)}static injectCSS(){return[".editor {border: unset; border-radius: unset; color: var(--color-fore)}",".editor.size-auto {min-height: 0;}","zen-editor-menu-item > .menu-item {color: #9ea3b0!important;}","zen-editor-menu-item > .menu-item:hover {color: var(--color-primary-400)!important; background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active {color: var(--color-primary-400)!important; background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300);}","zen-editor-menu-item > .menu-item.is-active:hover {background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active:not(:hover) {background-color: transparent!important;}","zen-editor-menu-item > .menu-item:has(.color):hover, zen-editor-menu-item > .menu-item:has(.color).is-active {background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300)!important;}",".menubar {border-bottom: 1px solid #d8dbde!important; padding: 0.125rem;}",".editor__content {padding: 0!important}",".tippy-content > div {border: 1px solid #d8dbde!important;}",".tippy-content zen-editor-menu-item {line-height: normal;}",".tippy-content zen-editor-menu-item .label {all: unset;}",".tiptap.ProseMirror {padding-top: 0.5rem;}",".tiptap.ProseMirror p {margin: 0;}"].join(`
`)}};Ig.defaultProps={autoInit:!0};let Ox=Ig;y.registerLib("zeneditor",{src:"zen-editor/zen-editor.esm.js",type:"module"});let Dr=class extends me{render(e){const{avatar:t,account:i,realname:s,user:r,...o}=e,a={code:r?r.account:i,text:r?r.realname??r.account:s??i,src:r?r.avatar:t,...o};return w(ss,{...a})}};Dr.defaultProps={size:24,circle:!0};function $g(n,e="yyyy年M月d日 hh:mm",t="M月d日 hh:mm"){const i=Ve(n);return Ks(i,new Date)?lt(i,t):lt(i,e)}const Fx=(n,e)=>{if(!e)return;const t=[];for(const i of e)t.includes(i.account)||t.push(i.account);return t.map(i=>n.getUserInfo(i))},zx=n=>n.map(t=>({account:t.account,realname:t.name,avatar:t.avatar})),jx=(n,e=!0)=>n?n.length<=3?n:e?[n[0],"more",n[n.length-1]]:[n[0],n[1],"more"]:null;function Ag(n){const{createDate:e,app:t,editors:i,creator:s}=n,r=t.getUserInfo(s),o=je(()=>{var h;const{editingUsers:c}=t.signals;return(h=c.value)!=null&&h.length?zx(c.value):null}),a=o.value||Fx(t,i),l=jx(a,!o.value);return w("div",{className:"doc-users-bar flex flex-nowrap gap-2"},w("div",{className:"flex flex-nowrap gap-1"},w("div",{title:e?t.getLang("createdByUserAt",[{name:r.realname,time:$g(e)}],"由 {name} 创建于 {time}"):r.realname},w(Dr,{size:"xs",user:r})),w("span",null,r.realname),w("span",null,t.getLang("created"))),l!=null&&l.length?w("div",{className:"flex flex-nowrap gap-1"},w("div",{className:"avatar-group",title:a==null?void 0:a.map(c=>c.realname).join("、")},l.map(c=>typeof c=="string"?w(Dr,{size:"xs",className:"rotate-90",icon:"ellipsis-v"}):w(Dr,{size:"xs",user:c}))),w("span",null,t.getLang(o.value?"editing":"edited"))):null)}function ja(){return w("span",{className:"inline-block w-px h-3 bg-gray-400"})}const Bx=()=>document.documentElement.lang.includes("zh"),Ju=n=>{const e=Ve(n);if(Bx())return $g(e,"yyyy年MM月dd日","MM月dd日");const[,t,i,s]=e.toDateString().split(" "),r=new Date().getFullYear();return e.getFullYear()===r?`${t} ${i} `:`${t} ${i} ${s} `};function Hx(n){var s;const{doc:e,app:t}=n;if(!e.status)return w("div",{className:"doc-editor-info flex text-gray gap-2 items-center py-2.5"},w(Ag,{app:t,createDate:e.addedDate,editors:e.editors,creator:e.addedBy}),w(ja,null),w("span",null,t.getLang("notSaved")));const i=!!t.editingUsers.length;return w("div",{className:"doc-editor-info flex text-gray gap-2 items-center py-2.5"},w(Ag,{app:t,createDate:e.addedDate,editors:e.editors,creator:e.addedBy}),w(ja,null),w("span",null,e.status==="draft"?t.getLang("draft"):t.getLang("released")),w(ja,null),w("span",{className:"hint","data-hint":Ve(e.addedDate).toLocaleString()},Ju(e.addedDate),t.getLang("created")),i?w("span",{className:"-px-2"},t.getLang("autoSaveHint","所有编辑内容都会自动保存")):null,i?w("span",null,Ju(new Date),t.getLang("edited")):e.editedDate?w("span",{className:"hint","data-hint":Ve(e.editedDate).toLocaleString()},Ju(e.editedDate),t.getLang("edited")):null,w(ja,null),w("div",{key:"views",className:"text-sm hint flex items-center gap-1","data-hint":t.getLang("viewsCount","阅读次数")},w($e,{icon:"eye"}),e.views||0),e.api||((s=t.props.privs)==null?void 0:s.collect)==="no"?null:w("div",{key:"star",className:`text-sm hint cursor-pointer ${e.isCollector?"text-warning":"text-gray"} flex items-center gap-1`,"data-hint":t.getLang(e.isCollector?"cancelCollection":"collect"),"zui-command":`collectDoc/${e.id}`},w(xe,{size:"xs",type:"ghost",icon:e.isCollector?"star":"star-empty",text:e.collects||0})))}class Ux extends me{constructor(e){super(e),this._editor=he(),this._titleEle=he(),this._isLoadingLib=Je(!1),this._convertedToNewDoc=Je(0),this._gid=Ei(),this._saveTimer=0,this._dataTime=0,this._cacheDataTime=0,this._isLoadingFile=Je(!1),this._loadFileTimer=0,this._handleChange=t=>{const i=t.content;(i!==this._data.content||t.html!==this._data.html)&&(this._data.content=i,this._data.contentType=t.contentType,this._data.html=t.html,this._dataTime=Date.now(),this._callChange()),this.trySaveCache()},this._handleKeywordsChange=t=>{const s=t.target.value.split(/,|，/).map(r=>r.trim()).filter(Boolean).join(", ");s!==this._data.keywords&&(this._data.keywords=s,this._callChange())},this._handleTitleChange=t=>{var s;const i=t.target.value;if(i!==this._data.title){this._data.title=i;const{editor:r}=this;r instanceof Is&&((s=r.$)==null||s.updateTitle(i)),this._callChange()}},this._handleConvertDoc=async()=>{const{app:t}=this.props;await Re.confirm({title:t.getLang("convertToNewDoc","转换文档"),content:t.getLang("convertToNewDocConfirm","确定要将此文档转换为新文档格式吗？")})&&await this._switchDoc(!0)},this._switchDoc=async t=>{const{doc:i}=this.props,s=i.$html;s&&this.triggerChange({content:s,contentType:"html",html:s}),await bi(100),this._convertedToNewDoc.value=t?i.id:0},this._switchToOldDoc=()=>{this._switchDoc(!1)},this._handleLoadingLibChange=t=>{this._isLoadingLib.value=t},this._toggleFileLoading=t=>{this._loadFileTimer&&clearTimeout(this._loadFileTimer),t?(this._isLoadingFile.value=!0,this._loadFileTimer=0):this._loadFileTimer=window.setTimeout(()=>{this._isLoadingFile.value=!1,this._loadFileTimer=0},1500)},this._handleAwarenessUpdate=t=>{const{states:i}=t,{app:s}=this.props,r=Array.from(new Map(i.map(o=>o.user).map(o=>[o.id,o])).values());s.changeState({editingUsers:r})},this._handleDownload=async t=>{const{downloadUrl:i}=this.props,s=this.props.app.getDownloadUrl(t.key,i);this._toggleFileLoading(!0);let r=null;try{r=await(await fetch(s)).blob()}catch(o){console.error("[ZUI - DocEditor] download file failed",o)}return this._toggleFileLoading(!1),{blob:r}},this._handleUpload=async t=>{const{uploadUrl:i}=this.props,{key:s,blob:r,editorID:o}=t;await y.post(we(i,{uid:encodeURIComponent(o),extra:"editor",field:"imgFile",gid:btoa(s)}),{imgFile:r,"labels[]":[r.name]},"json")},this._data={title:e.doc.title,content:e.doc.content??""}}get gid(){return this._gid}get editor(){return this._editor.current}get cacheID(){return`doc-${this.props.mode==="edit"?this.props.doc.id:"new"}-${this._gid}`}async getData(e){const t=this._editor.current;if(t instanceof Is){const r={...await t.getData(),contentType:"doc"};return e!=null&&e.getHtml&&(r.html=await t.getHtml()),r}return await(t==null?void 0:t.getData())}focusTitle(){var e;(e=this._titleEle.current)==null||e.focus()}setTitle(e){this._data.title=e;const t=this._titleEle.current;t&&(t.value=e,this.triggerChange())}async triggerChange(e,t){var s;const i=await this.getData(t);!i&&!e||((s=this._handleChange)==null||s.call(this,{...i,...e}),this.saveCache())}saveCache(){this._cacheDataTime!==this._dataTime&&(y.db.setCacheData(this.cacheID,this._data,0,"docAppCache"),this._cacheDataTime=this._dataTime)}trySaveCache(){this._saveTimer&&clearTimeout(this._saveTimer),this._saveTimer=window.setTimeout(()=>{this.saveCache(),this._saveTimer=0},1e3)}removeCache(){y.db.deleteCacheData(this.cacheID,"docAppCache")}_callChange(){var t,i;const{doc:e}=this.props;(i=(t=this.props).onChange)==null||i.call(t,{id:e.id,...this._data})}_renderTitle(e){const{doc:{title:t,deleted:i},mode:s,app:r}=e;return s==="view"?i?w("div",{class:"flex gap-2 items-center"},w("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t),w("span",{class:"label danger"},r.getLang("deleted","已删除"))):w("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t):w("input",{key:"title",ref:this._titleEle,type:"text",class:"doc-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:t,onChange:this._handleTitleChange,placeholder:r.getLang("docTitlePlaceholder","请输入文档标题")})}_renderInfo(e){return w(Hx,{...e})}_renderKeywords(e){const{doc:{keywords:t},mode:i,app:s}=e,r=(t==null?void 0:t.split(/,|，/).map(a=>a.trim()).filter(Boolean))??[];if(i==="view")return w("div",{key:"kw",title:s.getLang("keywords","关键字"),class:`doc-editor-keywords row gap-2 px-1 my-2${r.length?"":" hidden"}`},r.map(a=>w("span",{className:"label label-sm secondary-outline"},a.trim())));const o=`doc-app-kw-${this._gid}`;return w("div",{key:"kw",className:"input-control has-prefix-icon my-2 doc-editor-keywords"},w("input",{key:"kw",type:"text",id:o,class:"form-control ring-0 shadow-none",defaultValue:r.join(", "),onChange:this._handleKeywordsChange,placeholder:s.getLang("keywordsPlaceholder","关键字，使用逗号分隔")}),w("label",{for:o,class:"input-control-prefix"},w("i",{className:"icon icon-tag"})))}componentDidMount(){this.props.mode==="edit"&&this.focusTitle()}render(e){var se,ye,_e,Ee;const{className:t,doc:i,belowTitle:s,mode:r,uploadUrl:o,downloadUrl:a,app:l}=e,c=i.contentType==="doc"?"doc":i.contentType==="markdown"?"markdown":"html",h=c==="doc"&&!i.$convert,u=c==="markdown",p=r==="view",m=r==="edit",v=l.props.autoConvertDoc||i.status==="draft",b=this._convertedToNewDoc.value,C=m&&(i.contentType==="html"||i.contentType==="attachment"||i.$convert),S=!(i.content??"").trim().length,D=S&&r==="view",N=m&&C&&b===i.id,P=u||h||N||S,H=P?Is:Ox,q=i.content===void 0||i.content===null,Y=this._isLoadingLib.value,Q=this._isLoadingFile.value,Z=q||Y;let{useHocuspocus:ue}=l.props;ue=typeof ue=="function"?ue(l):ue;const J=l.mode==="edit"&&ue;return w("div",{class:V("doc-editor load-indicator col",t,Z||Q?"loading":"",p?"is-readonly":"is-editing",D?"is-empty":"flex-auto"),"data-loading":q?l.getLang("loadingDocTip","正在加载文档内容..."):Y?l.getLang("loadingEditorTip","正在加载编辑器..."):l.getLang("loadingFile","正在下载文档附件...")},this._renderTitle(e),this._renderInfo(e),this._renderKeywords(e),v&&N&&P&&m?w("div",{className:"center mb-3"},w("div",{class:"row gap-2 items-center primary-pale pl-2 rounded-full"},w("p",{className:"text-gray"},l.getLang("oldDocEditingTip","此文档为旧版本编辑器创建，已启用新版编辑器编辑，保存后将转换为新版文档")),w(xe,{text:l.getLang("switchToOldEditor","切换回旧编辑器"),size:"sm",type:"ghost",rounded:"full",className:"underline",onClick:this._switchToOldDoc}))):null,s,!Z&&!D&&w(H,{ref:this._editor,key:`editor-${i.id}-${r}-${i.currentVersion||i.version}`,className:"doc-editor-control flex-auto",mode:h?"full":"page",autoInit:!0,readonly:p,downloadUrl:a,uploadUrl:o,onDownload:a?this._handleDownload:void 0,onUpload:this._handleUpload,uid:i.uid??`doc${i.id}`,content:i.content??"",title:i.title,contentType:c,placeholder:o?l.getLang("pasteImageTip","可以在编辑器直接贴图。"):"",onChange:this._handleChange,onLoadingLibChange:this._handleLoadingLibChange,token:l.props.token,docID:Wx(l.docID),useHocuspocus:J,hocuspocusUrls:l.props.hocuspocusUrls,awarenessUser:l.props.awarenessUser,onAwarenessUpdate:this._handleAwarenessUpdate,onAuthenticationFailed:(se=l.props.onAuthenticationFailed)==null?void 0:se.bind(null,l),onConnect:(ye=l.props.onHocuspocusConnect)==null?void 0:ye.bind(null,l),onDisconnect:(_e=l.props.onHocuspocusDisconnect)==null?void 0:_e.bind(null,l),onClose:(Ee=l.props.onHocuspocusClose)==null?void 0:Ee.bind(null,l)},v&&C&&!N?w("div",{className:"absolute right-0 top-1"},w(xe,{type:"primary-pale",size:"md",onClick:this._handleConvertDoc},l.getLang("convertToNewDoc","转换为新文档格式"))):null))}}function Wx(n){if(typeof n=="number")return n;const e=n.match(/\d+/);return e?+e:0}let Zu=class extends Ke{get actions(){return this.state.actions||this.props.actions||[]}getDefaultState(e){e=e||this.props;let{preserve:t,defaultReversed:i}=e;return t===!0&&(t=""),i===void 0&&typeof t=="string"&&(this._preserveID=`HistoryPanel.reversed${t.length?`:${t}`:""}`,i=Xe.get(this._preserveID)),e.actions&&(this._currentLoadID=[e.objectType,e.objectID].join()),{actions:e.actions,expandMap:{},reversed:i}}resetState(e,t){const i=this.getDefaultState(e);t?this.state=i:this.changeState(i)}componentDidMount(){y.on(`load.HistoryPanel.${this.gid}.zt`,(e,{objectType:t,objectID:i})=>{t===this.props.objectType&&String(i)===String(this.props.objectID)&&this.load()}),this.state.actions||this.load()}componentWillUnmount(){y.off(`.HistoryPanel.${this.gid}.zt`)}componentDidUpdate(){(!this.state.actions||this._currentLoadID!==[this.props.objectType,this.props.objectID].join())&&!this.state.loading&&this.load()}async load(){const{objectType:e,objectID:t}=this.props;let i=this.props.fetcher;i||(i=Pt("action","ajaxGetList",`objectType=${e}&objectID=${t}`));const s=[e,t].join();if(this.state.loading)return;await this.changeState({loading:!0});const o={actions:await _t(i,[{objectType:e,objectID:t}])||[],loading:!1},a=[this.props.objectType,this.props.objectID].join();a!==s?delete o.actions:this._currentLoadID=a,await this.changeState(o)}reverse(e){return e===void 0&&(e=!this.state.reversed),this.changeState({reversed:e},()=>{typeof this._preserveID=="string"&&Xe.set(this._preserveID,e)})}toggle(e,t){return this.changeState(i=>{const{expandMap:s}=i;return t===void 0&&(t=!s[e]),{expandMap:{...s,[e]:t}}})}isAllExpanded(){const{expandMap:e}=this.state;return this.actions.every(t=>{const{history:i,historyChanges:s}=t;return!(i&&i.length||typeof s=="string"&&s.length)||e[t.id]})}toggleAll(e){return e===void 0&&(e=!this.isAllExpanded()),this.changeState({expandMap:e?this.actions.reduce((t,i)=>({...t,[i.id]:e}),{}):{}})}_getClassName(e){return[super._getClassName(e),"history-panel",e.panel?"panel":""]}_getChildren(e){const t=this._buildHeader(e),i=this._buildBody(e);return e.panel?[t?w("div",{key:"heading",className:"panel-heading"},t):null,w("div",{key:"body",className:"panel-body"},i)]:[t,i]}_buildFiles(e){let t=e.files;return Array.isArray(t)&&(t={items:t}),!t||!t.items?null:w(xr,{key:"files",className:"bg-primary-50 py-1 px-1.5",...this.props.fileListProps,...t})}_buildAction(e,t,i,s){const{history:r,historyChanges:o}=e,a=r&&r.length||typeof o=="string"&&o.length,l=typeof e.comment=="string"&&e.comment.length,c=`${t+1}`,h={component:"li",key:String(e.id),"data-id":e.id,"data-action":e.action,className:["history-panel-action list-item item",a?i?"is-expanded":"is-collapsed":""],innerClass:"item-inner list-item-inner",avatar:{className:"text-gray ring canvas",background:"",size:16,circle:!0,...e.action==="finished"?{icon:{icon:"check",className:"text-success"}}:{children:w("span",{style:c.length>1?{transform:`scale(${1-c.length*.1})`}:void 0},c)}},title:{html:e.content},text:a?w(xe,{icon:i?"minus":"plus",type:"ghost",size:"xs",className:"history-panel-action-toggle ring text-gray scale-75",onClick:this.toggle.bind(this,e.id,void 0)}):null,children:a&&i||l?w("div",{className:"history-panel-action-content pl-6 col gap-1 mb-1"},a&&i?typeof o=="string"&&o.length?w("div",{key:"history",className:"history-panel-action-history pl-1",dangerouslySetInnerHTML:{__html:o}}):w("ul",{key:"history",className:"history-panel-action-history col pl-1"},r.map(u=>w("li",{key:u.id,className:"history-panel-history-item",dangerouslySetInnerHTML:{__html:u.content}}))):null,e.comment?w("div",{key:"comment",className:`history-panel-action-comment py-2 surface relative ${e.commentEditable?"pl-3 pr-6":"px-3"}`},e.commentEditable?w(xe,{key:"btn",type:"ghost",icon:"pencil",size:"sm",className:"comment-btn hover:text-primary absolute top-1 right-1","data-toggle":"comment","data-action-ID":e.id,url:s.editCommentUrl?s.editCommentUrl.replace("{actionID}",String(e.id)):void 0}):null,w("div",{className:"article",key:"comment",dangerouslySetInnerHTML:{__html:e.comment}})):null,this._buildFiles(e)):null};return w(hn,{...h})}_buildBody(e){const{actions:t}=this,{loading:i,expandMap:s,reversed:r}=this.state;return w("ul",{key:"actions",className:V("list history-panel-body load-indicator",{loading:i},r?"col-reverse":"col",e.bodyClass)},t.map((o,a)=>this._buildAction(o,a,s[o.id],e)))}_buildHeader(e){let{header:t}=e;if(!t)return null;const{title:i="History",toolbar:s=!0,commentBtn:r=!0}=e,o=[];if(s){const{reversed:a}=this.state,l=this.isAllExpanded(),{actions:c}=this,h={key:"toolbar",className:"history-panel-toolbar",gap:1,items:[c.length>1?{icon:a?"arrow-down":"arrow-up",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.reverse.bind(this,void 0)}:null,c.some(u=>{const{history:p,historyChanges:m}=u;return p&&p.length||typeof m=="string"&&m.length})?{icon:l?"minus":"plus",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.toggleAll.bind(this,void 0)}:null].filter(Boolean)};typeof s=="object"&&Object.assign(h,s),h.items&&(!Array.isArray(h.items)||h.items.length)&&o.push(w(Be,{...h}))}if(r){const a={key:"commentBtn",type:"ghost",className:"comment-btn text-gray",size:"sm",url:e.commentUrl,icon:{icon:"message",className:"icon-sm text-primary"},"data-toggle":"comment","data-object-ID":e.objectID,"data-object-type":e.objectType};typeof r=="object"?Object.assign(a,r):typeof r=="string"&&(a.text=r),o.push(w(xe,{...a}))}return t={key:"header",className:"history-panel-header",title:i,titleClass:"font-bold mr-1",content:o,contentClass:"flex items-center flex-auto gap-2",...typeof t=="object"?t:{}},w(hn,{...t})}};Zu.defaultProps={header:!0,panel:!0,preserve:!0};class Ir extends me{constructor(){super(...arguments),this._ref=he(),this._timer=0,this._editorSelector="page-editor,affine-page-root,zen-editor,.doc-editor-content",this.state={},this._getItem=e=>{var t;return e.innerClass=(t=e.text)!=null&&t.length?"":"hidden",e},this._handleClickItem=e=>{var t;(t=e.event.target)!=null&&t.closest(".tree-toggle")||this.scrollIntoDoc(e.item)}}update(){var l,c;const e=this.props.container||((l=this._ref.current)==null?void 0:l.closest(".doc-view"));if(!e)return;this._container!==e&&(this._container&&y(this._container).off(".doc-outline"),this._container=e,y(e).on("docChange.doc-outline",()=>{this.tryUpdate()}));const i=y(e).find(this._editorSelector)[0];if(!i)return;const s=i.tagName.toLowerCase(),r=s==="zen-editor"?"zen":s==="page-editor"||s==="affine-page-root"?"blocksuite":"html";this._editorType=r;const o=r==="blocksuite"?Ir.getBlocksuiteHeadings(i):Ir.getEditorHeadings(i),a=Ir.formHeadings(o);this._lastDocID=(c=this.props.doc)==null?void 0:c.id,this.setState({items:a})}tryUpdate(){var e;this._timer&&clearTimeout(this._timer),this._lastDocID!==((e=this.props.doc)==null?void 0:e.id)&&this.setState({items:void 0}),this._timer=window.setTimeout(()=>{this.update(),this._timer=0},1e3)}scrollIntoDoc(e){var s,r,o,a;const t=this._container;if(!t)return;const i=y(t).find(this._editorSelector)[0];if(i)if(this._editorType==="blocksuite")(s=i.querySelector(`affine-paragraph[data-block-id="${e.id}"]`))==null||s.scrollIntoView({behavior:"smooth",block:"start"});else{const c=(((a=(o=(r=i.shadowRoot)==null?void 0:r.querySelector("zen-editor-core"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector("zen-editor-content"))||i).querySelectorAll("h1,h2,h3,h4,h5,h6");if(!c)return;const{text:h,level:u}=e;let p=e.index!==void 0?c[e.index]:void 0;(!p||p.textContent!==h||p.tagName!==`H${u}`)&&(p=Array.from(c).find(m=>m.textContent===h&&m.tagName===`H${u}`)),p&&p.scrollIntoView({behavior:"smooth",block:"start"})}}componentDidMount(){this.tryUpdate()}componentDidUpdate(e){this.props.doc!==e.doc&&this.tryUpdate()}componentWillUnmount(){this._container&&y(this._container).off(".doc-outline"),this._timer&&clearTimeout(this._timer)}render(e,t){const{items:i}=t;return w("div",{className:"doc-outline",ref:this._ref},i?i.length?w(It,{items:i,defaultNestedShow:!0,getItem:this._getItem,nestedToggle:".tree-toggle",onClickItem:this._handleClickItem}):w("div",{className:"text-gray p-2"},e.app.getLang("noOutline","没有大纲")):w("div",{className:"text-gray p-1"},e.app.getLang("loading","加载中...")))}static formHeadings(e){let t,i=e.reduce((s,r)=>{r.text=r.text.trim();const{level:o}=r;if(!r.text.length&&(o===1||t&&t.level===o))return s;if(o>1){t||(t={level:1,text:"",id:""},s.push(t));let a;if(t.level===o-1)a=t;else if(t.level>=o){for(;t.level>=o;)t.parent&&(t=t.parent);a=t}else{for(;t.level<o-1;){const l={level:t.level+1,text:"",id:"",parent:t};t.items||(t.items=[]),t.items.push(l),t=l}a=t}r.parent=a,a.items||(a.items=[]),a.items.push(r)}else s.push(r);return t=r,s},[]);return i.length===1&&i[0].text===""&&(i=i[0].items||[]),i}static getBlocksuiteHeadings(e){const t=[],i=(s,r)=>{var a;const o=((a=s.querySelector("v-text"))==null?void 0:a.textContent)??"";t.push({id:s.closest("affine-paragraph").dataset.blockId??`${r}_${o}`,text:o,level:r})};return e.querySelectorAll(".affine-paragraph-rich-text-wrapper").forEach(s=>{const r=s.classList;let o=0;r.contains("h1")?o=1:r.contains("h2")?o=2:r.contains("h3")?o=3:r.contains("h4")?o=4:r.contains("h5")?o=5:r.contains("h6")&&(o=6),o&&i(s,o)}),t}static getEditorHeadings(e){var s,r,o;const t=[],i=((o=(r=(s=e.shadowRoot)==null?void 0:s.querySelector("zen-editor-core"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector("zen-editor-content"))||e;return i&&i.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(a=>{const l=a.textContent||"",c=a.id,h=parseInt(a.tagName[1]);l.length&&h<7&&t.push({index:t.length,level:h,text:l,id:c})}),t}}const Eg=class Dd extends me{constructor(e){super(e),this._ref=he();const{defaultStatus:t=Dd.defaultProps.defaultStatus}=e;this._status=e.status||Je(t)}toggleTab(e){e===void 0?this._status.value=this._status.value?!1:Dd.defaultProps.defaultStatus:this._status.value=e===!1||this._status.value===e?!1:e}_renderContent(e,t,i){var o;if(!e||!i)return null;const{doc:s,app:r}=t;if(i.render)return w(ge,{content:i.render(s)});if(e==="info"){const{creator:a,modifier:l}=t,c=[{label:r.getLang("docStatus","状态"),content:s.status==="draft"?w("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},r.getLang("draft","草稿")):r.getLang("released","已发布")},{label:r.getLang("creator","创建者"),content:a.realname},{label:r.getLang("createDate","创建时间"),content:lt(s.addedDate)},{label:r.getLang("modifier","修改者"),content:l==null?void 0:l.realname},s.editedDate?{label:r.getLang("editDate","修改时间"),content:lt(s.editedDate)}:null,{label:r.getLang("viewsCount","阅读次数"),content:s.views},{label:r.getLang("collectCount","收藏次数"),content:[s.collects,s.isCollector?w("span",{className:"label side-sm rounded-full warning-pale"},r.getLang("collected","已收藏")):null]}].filter(Boolean);return w("div",{className:"col gap-2"},w("div",{className:"font-bold px-1"},r.getLang("docInfo","文档信息")),w(tg,{items:c}))}if(e==="outline")return w("div",{className:"col gap-2"},w("div",{className:"font-bold px-1"},i.title??r.getLang("docOutline","文档大纲")),w(Ir,{app:r,container:(o=this._ref.current)==null?void 0:o.closest(".doc-view"),doc:s}));if(e==="history")return xg(s.rawID)?null:w("div",{style:"margin-top: -6px"},w(Zu,{panel:!1,title:i.title??r.getLang("history","历史记录"),objectType:s.api?"api":"doc",objectID:s.rawID,fetcher:t.historyFetcher,...t.historyPanel}))}_renderNav(e,t,i){const{app:s}=t;return w("menu",{key:"nav",className:"doc-view-sidebar-nav nav nav-stacked gap-1 p-1 flex-none rounded-lg"},i.map(({icon:r,title:o,key:a})=>w("li",{class:"nav-item item hint-left","data-hint":o,key:a},w("a",{className:`rounded-lg${e===a?" active":""}`,"zui-command":`toggleViewSideTab/${a}`},w($e,{icon:r})))),i.length?w("li",{key:"divider",class:"nav-divider divider"}):null,w("li",{class:"nav-item item hint-left","data-hint":s.fullscreen?s.getLang("exitFullscreen","退出全屏"):s.getLang("enterFullscreen","进入全屏")},w("a",{className:"rounded-lg","zui-command":"toggleFullscreen"},w($e,{icon:s.fullscreen?"fullscreen-exit":"fullscreen"}))),e?w("li",{class:"nav-item item hint-left","data-hint":s.getLang("collapse","收起")},w("a",{className:"rounded-lg","zui-command":"toggleViewSideTab/false"},w($e,{icon:"icon-menu-arrow-right"}))):null)}render(e){var h;const{className:t,app:i,doc:s,showTabsNav:r}=e;let o=this._status.value;const a=xg(+s.id);o&&a&&(o="outline");const l=((h=i.props.getDocViewSidebarTabs)==null?void 0:h.call(i,s,{isNewDoc:a,mode:i.mode}))||[{icon:"list-box",title:i.getLang("docOutline","文档大纲"),key:"outline"}],c=l==null?void 0:l.find(u=>u.key===o);return c||(o=""),!r&&!o?null:w("div",{className:V("doc-view-sidebar flex-none z-50 sticky top-3 right-1 self-start",t,`is-${o?"opened":"closed"}`,`is-${o}`,r?`has-tabs-nav-${r}`:""),ref:this._ref},w("div",{className:"doc-view-sidebar-container border shadow rounded-lg row items-stretch mb-3"},w("div",{key:"content",className:"doc-view-sidebar-content p-2 border-r flex-auto overflow-y-auto scrollbar-hover"},this._renderContent(o,e,c)),r?this._renderNav(o,e,l):w(xe,{type:"ghost",size:"sm",icon:"close text-gray",className:"absolute top-1.5 right-1.5 z-10",command:"toggleViewSideTab/false"})))}};Eg.defaultProps={defaultStatus:"outline",showTabsNav:"right"};let Vx=Eg;class Kx extends me{constructor(e){super(e),this._editorRef=he(),this._ref=he(),this._sidebarRef=he(),this._currentDocID=Je(""),this._modeChangeEffect=Qt(()=>{this.props.app.mode!=="view"&&(this._currentDocID.value="")}),this._docChangeEffect=Qt(()=>{const{docID:s,docVersion:r}=this.props.app.signals,o=[s,r].join();o!==this._currentDocID.value&&(this._currentDocID.value=o,this.tryLoadDoc())}),this._handleChange=s=>{const{doc:r,mode:o="view",onChange:a}=this.props;a==null||a(s,o,r),y(this.element).trigger("docChange",[s,o,r])};const{preserve:t}=e,i=t?`${t}-expanded`:null;this._status=Je(i?Xe.get(i,!1):!1),i&&this._status.subscribe(s=>{Xe.set(i,s)})}get editor(){return this._editorRef.current}get element(){return this._ref.current}get sidebar(){return this._sidebarRef.current}tryLoadDoc(){const e=this._currentDocID.value;if(e){const[t,i]=e.split(",").map(Ni);this.props.app.loadDoc(t,i)}}componentWillUnmount(){this._modeChangeEffect(),this._docChangeEffect()}_renderEditor(e){const{doc:t,mode:i="view",uploadUrl:s,downloadUrl:r,app:o}=e,a=o.renderCustom("editor");return a!==void 0?a:w(Ux,{app:o,ref:this._editorRef,mode:i,doc:t,uploadUrl:s?we(s,{objectID:i==="create"?0:t.id,objectType:"doc",api:t.contentType==="doc"?"true":"",extra:t.contentType==="doc"?"editor":""}):void 0,downloadUrl:r?we(r,{id:t.id,objectID:t.id,objectType:"doc"}):void 0,onChange:this._handleChange})}render(e){var m;const{doc:t,fileActions:i,fileIcon:s,fileUrl:r,creator:o,modifier:a,onGetUser:l,historyFetcher:c,highlight:h,app:u}=e,p=this._status.value;return w("div",{className:V("doc-view absolute inset-0 overflow-auto scrollbar-hover canvas z-10 row",`is-sidebar-${p?"opened":"closed"}`,h?"highlight":""),ref:this._ref},w("div",{class:"doc-view-content mx-auto col gap-4 flex-auto"},this._renderEditor(e),(m=t.files)!=null&&m.length?w(xr,{className:"doc-files my-4 px-3 py-2 surface rounded-lg",heading:{icon:"paper-clip",title:u.getLang("attachment","附件")},items:t.files,fileActions:i,fileIcon:s,fileUrl:r,itemProps:{target:"_blank"},hoverItemActions:!0}):null),w(Vx,{ref:this._sidebarRef,app:u,doc:t,creator:o,modifier:a,status:this._status,historyFetcher:c,historyPanel:u.props.historyPanel,onGetUser:l,showTabsNav:!1}))}}function Ng(n,e){const{page:t,recPerPage:i}={page:1,recTotal:n.length,pageTotal:Math.ceil(n.length/20),recPerPage:20,...e},s=(t-1)*i,r=t*i;return n.slice(s,r)}class qx extends me{constructor(e){var i;super(e),this._libsMap=Je({}),this._filterType=Je(),this._loading=Je(!1),this._currentFilterType=je(()=>{const{app:s}=this.props,r=this._filterType.value,o=s.spaceType;return r||(o==="product"||o==="project"?"mine":"all")}),this._spaceList=je(()=>{const{app:s}=this.props;let r=s.signals.spaces.value;const o=this._currentFilterType.value,a=s.spaceType,l=s.props.isMatchFilter;return o&&l&&(r=r.filter(c=>l.call(s,a,o,c))),r.sort((c,h)=>c.order-h.order)}),this._pagedSpaceList=je(()=>{const s=this._spaceList.value;return Ng(s,this.props.app.signals.pager.value)}),this._autoLoadLibs=Qt(()=>{const s=this._spaceList.value;this.loadLibs(s.map(r=>r.id))}),this._handleFilterTypeClick=s=>{const o=s.target.getAttribute("data-type");o&&(this._filterType.value=o)},this._handleLibClick=s=>{const r=y(s.target);if(r.closest(".toolbar").length)return;const o=r.closest("[z-lib]").z("lib"),a=r.closest("[z-space]").z("space");!o||!a||this.props.app.selectSpace(a,+o)},this._handleChangePager=s=>{this.props.app.resetPager("home",{...s})};const t=e.app.getFilterTypes("home")||[];this._filterType.value=(i=t[0])==null?void 0:i[0]}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const i=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0;this._loading.value=!0;const s=await _t(t,[{spaceList:e,spaceType:this.app.spaceType}],i);Ys(()=>{this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...s},this._loading.value=!1})}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,s=this._spaceList.value.length,r=t.getFilterTypes("home")||[],o=this._currentFilterType.value;return w("div",{key:"header",class:"doc-app-header flex-none surface-light row items-center border-b py-2 pl-1 pr-2 flex-none"},w("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},r.map(([a,l])=>w("li",{key:a,className:"nav-item item"},w("a",{className:a===o?"active rounded":"rounded","data-type":a},l,a===o&&s?w("span",{className:"label size-sm canvas ring-0 rounded-md"},s):null)))),w("div",{className:"flex-auto"}),w(Be,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,s=this._libsMap.value[e];if(s)return s;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const h of o){const u=h.lib,p=c.get(u)||0;c.set(u,p+1)}for(let h=0;h<a.length;h++){const u=a[h];if(!(u.deleted||u.space!==e)&&(r.push({id:u.id,name:u.name,docs:c.get(u.id)||0}),l&&r.length>=l))break}return r}_renderSpace(e,t){var c;const{app:i}=t,s=i.getItemActions("space",e,"space-card"),r=[{text:i.getLang("enterSpace","进入空间"),textClass:"text-primary",command:`selectSpace/${e.id}/true`},...s];let o=this._getSpaceLibs(e.id);const a=i.props.libColors;let l;return o?o.length?(o.length>5&&(o=o.slice(0,5)),l=w("div",{class:"row flex-wrap"},o.map(h=>{const u=i.getItemActions("lib",h,"space-card");return w("div",{className:"doc-space-card-lib p-1.5 w-1/5 group"},w("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleLibClick,"z-lib":h.id,"z-space":e.id},w($e,{icon:"doclib text-2xl",style:a?{color:a[h.id%a.length]}:null}),w("div",{class:"font-bold text-clip",title:h.name},h.name),w("div",{class:"text-gray text-sm"},h.docs?i.getLang("docsTotalInfo",[h.docs],"共 {0} 个文档"):i.getLang("noDocs","没有文档")),u!=null&&u.length?Be.render({items:u},[],{size:"sm",type:"ghost",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100"}):null))}))):l=w("div",{className:"center gap-4 py-3"},w("div",{className:"text-gray"},i.getLang("noLibs","没有文档库")),(c=i.props.privs)!=null&&c.createLib?w(xe,{type:"primary-pale",icon:"plus",command:`createLib/${e.id}`},i.getLang("createLib","创建文档库")):null):l=w("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),w("div",{class:"doc-space-card ring rounded surface-light",key:e.id},w("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},w("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},w($e,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),w("div",{className:"min-w-0 flex-auto"},w("strong",null,e.name))),w(Be,{size:"md",items:r})),w("div",{class:"doc-space-card-libs p-1.5",style:"min-height: 118px"},l))}_renderBody(e){const t=this._pagedSpaceList.value;return w("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(i=>this._renderSpace(i,e)),t.length===0?w("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._spaceList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return w("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},w("div",{class:"flex-auto"}),w(_r,{...t}))}componentDidMount(){this.props.app.resetPager("home",{recTotal:this._spaceList.value.length})}componentWillUnmount(){this._autoLoadLibs()}render(e){return this._loading.value?w("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":e.app.getLang("loadingDocsData","正在加载文档数据...")}):[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}const Gx=n=>{var t,i;n=JSON.parse(JSON.stringify(n));const e=new Map;for(const s of n){const r=String(s.id);e.has(r)?s.items&&((i=(t=e.get(r))==null?void 0:t.items)==null||i.push(...s.items)):e.set(r,s)}return Array.from(e.values())};class Yx extends me{constructor(e){super(e),this._libsMap=Je({}),this._filterType=Je(),this._programData=Je(),this._hasDocsOnly=Je(!1),this._showClosed=Je(!1),this._otherPrograms=je(()=>{var i;if(!this._programData.value)return[];const t=[];if(t.push(...this._programData.value.data.other),this._showClosed.value){const s=this._programData.value.data.closed;for(const r of s){const o={...r,items:(i=r.items)==null?void 0:i.filter(a=>!a.isPO&&!a.involved)};t.push(o)}}return t}),this._myPrograms=je(()=>{var i;if(!this._programData.value)return[];const t=[];if(t.push(...this._programData.value.data.my),this._showClosed.value){const s=this._programData.value.data.closed;for(const r of s){const o={...r,items:(i=r.items)==null?void 0:i.filter(a=>a.isPO||a.involved)};t.push(o)}}return t}),this._currentFilterType=je(()=>{const t=this._filterType.value;return t||"mine"}),this._programList=je(()=>{const i=this._currentFilterType.value==="mine"?this._myPrograms.value:this._otherPrograms.value;return Gx(i)}),this._pagedProgramList=je(()=>{const t=this._programList.value;return Ng(t,this.app.signals.pager.value)}),this._spaceList=je(()=>{const{app:t}=this.props;let i=t.signals.spaces.value;const s=this._currentFilterType.value,r=t.spaceType,o=t.props.isMatchFilter;return s&&o&&(i=i.filter(a=>o.call(t,r,s,a))),i.sort((a,l)=>a.order-l.order)}),this._autoLoadLibs=Qt(()=>{const t=this._spaceList.value;this.loadLibs(t.map(i=>i.id))}),this._handleFilterTypeClick=t=>{const s=t.target.getAttribute("data-type");s&&(this._filterType.value=s)},this._handleSpaceClick=t=>{const i=y(t.target);if(i.closest(".toolbar").length)return;const s=i.closest("[z-space]").z("space");s!=null&&this.props.app.selectSpace(s,!0)},this._handleChangePager=t=>{this.props.app.resetPager("home",{...t})},this._filterType.value="mine"}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const i=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0,s=await _t(t,[{spaceList:e,spaceType:this.app.spaceType}],i);this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...s}}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,i=this._programList.value.length,s=t.spaceType==="product"?[["mine",t.getLang("productMine")],["other",t.getLang("productOther")]]:[["mine",t.getLang("projectMine")],["other",t.getLang("projectOther")]],r=this._currentFilterType.value;return w("div",{key:"header",class:"doc-app-header flex-none surface-light row gap-2 items-center border-b py-2 pl-1 pr-2 flex-none"},w("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},s.map(([o,a])=>w("li",{key:o,className:"nav-item item"},w("a",{className:o===r?"active rounded":"rounded","data-type":o},a,o===r&&i?w("span",{className:"label size-sm canvas ring-0 rounded-md"},i):null)))),w(rs,{id:"show-no-doc",name:"show-no-doc",defaultChecked:this._hasDocsOnly.value,label:t.getLang(t.spaceType==="product"?"showHasDocsOnlyProduct":"showHasDocsOnlyProject"),onChange:(o,a)=>{typeof a=="boolean"&&(this._hasDocsOnly.value=a)}}),w(rs,{id:"show-closed",name:"show-closed",defaultChecked:this._showClosed.value,label:t.getLang(t.spaceType==="product"?"showClosedProduct":"showClosedProject"),onChange:(o,a)=>{typeof a=="boolean"&&(this._showClosed.value=a)}}),w("div",{className:"flex-auto"}),w(Be,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,s=this._libsMap.value[e];if(s)return s;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const h of o){const u=h.lib,p=c.get(u)||0;c.set(u,p+1)}for(let h=0;h<a.length;h++){const u=a[h];if(!(u.deleted||u.space!==e)&&(r.push({id:u.id,name:u.name,docs:c.get(u.id)||0}),l&&r.length>=l))break}return r}_getSpaceDocSum(e){var t;return((t=this._getSpaceLibs(e))==null?void 0:t.map(i=>i.docs).reduce((i,s)=>i+s,0))||0}_renderProgram(e,t){var a;const{app:i}=t,s=this._hasDocsOnly.value?(a=e.items)==null?void 0:a.filter(l=>this._getSpaceDocSum(Number(l.id))>0):e.items,r=i.props.libColors;let o;return e?s!=null&&s.length?o=w("div",{class:"row flex-wrap"},s.map(l=>{const c=this._getSpaceDocSum(l.id);return w("div",{className:"doc-space-card-lib p-1.5 w-1/5 group",key:l.id},w("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleSpaceClick,"z-space":l.id},w($e,{icon:"doclib text-2xl",style:r?{color:r[Number(l.id)%r.length]}:null}),w("div",{class:"font-bold text-clip",title:l.text},l.text),w("div",{class:"text-gray text-sm"},c?i.getLang("docsTotalInfo",[c],"共 {0} 个文档"):i.getLang("noDocs","没有文档"))))})):o=w("div",{className:"center gap-4 py-3"},w("div",{className:"text-gray"},i.getLang(i.spaceType==="product"?"noProducts":"noProjects"))):o=w("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),w("div",{class:"doc-space-card ring rounded surface-light",key:e.id},w("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},w("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},w($e,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),w("div",{className:"min-w-0 flex-auto"},w("strong",null,e.text)))),w("div",{class:"doc-space-card-libs p-1.5",style:"min-height: 118px"},o))}_renderBody(e){const t=this._pagedProgramList.value;return w("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(i=>this._renderProgram(i,e)),t.length===0?w("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._programList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return w("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},w("div",{class:"flex-auto"}),w(_r,{...t}))}componentDidMount(){var t,i;this.props.app.resetPager("home",{recTotal:this._programList.value.length,recPerPage:5});const e=(i=(t=this.props.app.props).getSpaceFetcher)==null?void 0:i.call(t,this.props.app.spaceType);e&&_t(e).then(s=>void(this._programData.value=s))}componentWillUnmount(){this._autoLoadLibs()}render(e){return[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}class Xx extends me{constructor(){super(...arguments),this._dtable=he(),this._handleCellClick=(e,t)=>{var s;const i=(s=t.rowInfo)==null?void 0:s.data;this.props.app.selectDoc(i)}}_getCols(){return[{name:"title",onRenderCell:function(e,t){const i=t.row.data;return[{className:`api-list-item row items-center my-0.5 mx-1 gap-2 flex-auto is-${i.method} cursor-pointer rounded`,html:[`<div class="font-mono w-14 text-center api-method py-1 rounded rounded-r-none">${i.method}</div>`,`<div class="font-mono api-path">${i.path}</div>`,`<div class="flex-auto text-right api-title pr-2">${i.originTitle}</div>`].join("")}]}}]}_getTableOptions(e){var h;const{app:t,docs:i}=e,s=t.lib,r=s==null?void 0:s.data.orderBy;let o="",a="";typeof r=="string"&&r&&([o,a]=r.split("_"));const l=i.map(u=>u.data);["order","id"].includes(o)&&a&&(a==="asc"?l.sort((u,p)=>u.order-p.order):l.sort((u,p)=>p.order-u.order));const c={width:"100%",height(u){var m;const p=(m=this.element)==null?void 0:m.parentElement;return p?Math.min(u,p.clientHeight):u},cols:this._getCols(),data:l,header:!1,checkable:!1,footer:["flex","pager"],localPager:!0,emptyTip:w("div",{className:"center gap-4"},w("div",{className:"text-gray"},t.getLang("noApi","没有 API")),Be.render({items:t.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:t.getPagerItems()},onCellClick:this._handleCellClick};return((h=t.getTableOptions)==null?void 0:h.call(t,c,{type:"api-list"}))??c}render(e){return w("div",{class:V("doc-list doc-api-list h-full col",e.className)},w(Ts,{ref:this._dtable,...this._getTableOptions(e)}))}}const yI="";let eh=class extends Sc{constructor(e){super(e),this._loadingDocs=new Map,this._viewRef=he(),this._homeRef=he(),this._treeMap=je(()=>{const{spaceID:t,libs:i,modules:s,docs:r}=this.signals;return xx(t.value,{libs:i.value,modules:s.value,docs:r.value},!!this.props.noSpace)}),this._space=je(()=>{const{spaces:t,spaceID:i}=this.signals,s=i.value;return t.value.find(r=>r.id===s)}),this._spaceList=je(()=>{const{spaces:t,spaceType:i}=this.signals,s=i.value;return t.value.filter(r=>!r.deleted&&r.type===s)}),this._libList=je(()=>this._treeMap.value.libList),this._docList=je(()=>{const{lib:t,module:i,doc:s}=this;return(s==null?void 0:s.data.type)==="chapter"?this._filterDocs(Sr(s,[],!0),{api:(t==null?void 0:t.data.type)==="api"}):i||t?this._filterDocs(Sr(i||t,[],!0),{api:(t==null?void 0:t.data.type)==="api"}):this._filterDocs(void 0,{api:!1})}),this._doc=je(()=>this._treeMap.value.docs.get(this.signals.docID.value)),this._viewingDoc=je(()=>{const t=this._doc.value,i=this.signals.docVersion.value;return!t||!i||i===t.data.version||!t.data.versions?t:{...t,data:{...t.data,...t.data.versions[i]||{content:null},currentVersion:i}}}),this._module=je(()=>{var i;const t=((i=this._doc.value)==null?void 0:i.data.module)||this.signals.moduleID.value;return this._treeMap.value.modules.get(t)}),this._lib=je(()=>{var i;const t=((i=this._module.value)==null?void 0:i.data.lib)||this.signals.libID.value;return this._treeMap.value.libs.get(t)}),this._viewType=je(()=>this._viewInfo.value[0]),this._viewInfo=je(()=>{var o;const t=this.signals.mode.value;let i;const s=this.signals.creatingDoc.value,r=this.signals.editingDoc.value;if(t==="create")i=s;else if(t==="edit"){const a=this.getDoc(r==null?void 0:r.id);i=r,a&&i&&(i={...i,collects:a.collects,isCollector:a.isCollector,views:a.views})}else t==="view"&&(i=((o=this._viewingDoc.value)==null?void 0:o.data)||this._getLocalDoc(this.signals.docID.value));return[t,i]}),this._docUsers=je(()=>{const t=this._doc.value;if(!t)return[];const{addedBy:i,editedBy:s}=t.data;return[this.getUserInfo(i),s?this.getUserInfo(s):void 0]}),this._hasEditingDoc=je(()=>!!this._editingDoc.value),this._editingDoc=je(()=>{const[t,i]=this._viewInfo.value;return t==="edit"||t==="create"?i:void 0}),this._canShowLibFiles=je(()=>{const t=this.signals.spaceType.value;let{showLibFiles:i}=this.props;return typeof i=="function"?i=i.call(this,t):Array.isArray(i)&&(i=i.includes(t)),i}),this._location=je(()=>{var p;const{spaceType:t,spaceID:i,libID:s,moduleID:r,docID:o,pager:a,searchKeys:l,docVersion:c,mode:h,params:u}=this.signals;return{mode:h.value,spaceType:t.value,spaceID:i.value,libID:s.value,moduleID:r.value,docID:o.value,docVersion:c.value,search:(p=l.value)==null?void 0:p.join(" "),filterType:this.filterType,pager:a.value,noSpace:this.props.noSpace,orderBy:"",params:u.value}}),this._filterType=je(()=>this.signals.filterType.value[this.signals.mode.value]??"all"),this._viewEffect=Qt(()=>{var l,c,h,u;const{libID:t,moduleID:i,docID:s}=this.signals,r=s.value?"doc":i.value?"module":t.value?"lib":"space",o=s.value?(l=this._doc.value)==null?void 0:l.data:i.value?(c=this._module.value)==null?void 0:c.data:t.value?(h=this._lib.value)==null?void 0:h.data:this._space.value,a=this.signals.mode.value;(u=this.props.onSwitchView)==null||u.call(this,a,this._location.value,{type:r,title:o?r==="doc"?o.title:o.name:"",data:o})}),this._modeEffect=Qt(()=>{var r,o;const{mode:t}=this.signals;let{useHocuspocus:i}=this.props;const{onModeChange:s}=this.props;i=typeof i=="function"?i(this):i,i&&((o=(r=this.editor)==null?void 0:r.destroyHocuspocusProvider)==null||o.call(r)),s==null||s(this,t.value)}),this._handleDocChange=(t,i)=>{if(i==="create"){const s=this.signals.creatingDoc.value;s&&(s.title!==t.title||s.content!==t.content||s.keywords!==t.keywords||s.html!==t.html)&&(this.signals.creatingDoc.value={...s,...t,changed:!0,contentType:t.contentType||s.contentType})}else if(i==="edit"){const s=this.signals.editingDoc.value;s&&(s.title!==t.title||s.content!==t.content||s.keywords!==t.keywords||s.html!==t.html)&&(this.signals.editingDoc.value={...s,...t,changed:!0,contentType:t.contentType||s.contentType})}},this._getFileActions=t=>{var i;return this.getActions("file",{ui:"doc-view",data:t,doc:(i=this.doc)==null?void 0:i.data})},this._handleSearch=t=>{this.signals.searchKeys.value=ut.getSearchKeys(t)},this._handleFilterTypeClick=t=>{const i=t.target,s=i.getAttribute("data-type");if(s){const r=i.getAttribute("data-view");this.setFilterType(s,r)}},this.selectSpace=this.selectSpace.bind(this),this.selectDoc=this.selectDoc.bind(this),this.selectLib=this.selectLib.bind(this),this.selectModule=this.selectModule.bind(this),this.getUserInfo=this.getUserInfo.bind(this),this.selectDocVersion=this.selectDocVersion.bind(this),this.showFiles=this.showFiles.bind(this),this.getActions=this.getActions.bind(this),this.getItemActions=this.getItemActions.bind(this),this.executeCommand=this.executeCommand.bind(this),this.getTableOptions=this.getTableOptions.bind(this),this.toggleFullscreen=this.toggleFullscreen.bind(this)}get spaceType(){return this.signals.spaceType.value}get spaceID(){return this.signals.spaceID.value}get libID(){return this.signals.libID.value}get moduleID(){return this.signals.moduleID.value}get docID(){return this.signals.docID.value}get docVersion(){return this.signals.docVersion.value}get space(){return this._space.value}get lib(){return this._lib.value}get module(){return this._module.value}get doc(){return this._doc.value}get treeMap(){return this._treeMap.value}get docList(){return this._docList.value}get docUsers(){return this._docUsers.value}get viewInfo(){return this._viewInfo.value}get libList(){return this._libList.value}get spaceList(){return this._spaceList.value}get mode(){return this.signals.mode.value}get canShowLibFiles(){return this._canShowLibFiles.value}get hasEditingDoc(){return this._hasEditingDoc.value}get location(){return this._location.value}get filterType(){return this._filterType.value}get editor(){var e,t;return(t=(e=this._viewRef.current)==null?void 0:e.editor)==null?void 0:t.editor}get fullscreen(){return this.signals.fullscreen.value}get editingDoc(){return this._editingDoc.value}get editingUsers(){var e;return((e=this.signals.editingUsers)==null?void 0:e.value)||[]}_filterDocs(e,t){if(e=e||this.signals.docs.value,e.length){const i=t==null?void 0:t.api,s=t==null?void 0:t.chapter,r=this.signals.searchKeys.value||[],o=this.filterType,a="key"in e[0],{currentUser:l,isMatchFilter:c,noSpace:h}=this.props,u=c?c.bind(this,"doc",o):b=>o==="createdByMe"?b.addedBy===l:o==="editedByMe"?b.editedBy===l:o==="draft"?b.status==="draft":o==="collected"?b.isCollector:!0;if(a&&!r.length)return o!=="all"&&o?e.filter(b=>u(b.data)):e;const p=this.signals.spaceID.value,m=this._treeMap.value,v=["id","title","keywords","addedBy","editedBy",b=>this.getUserInfo(b.addedBy).realname,b=>{const C=b.editedBy;return C?this.getUserInfo(C).realname:void 0}];return e.reduce((b,C)=>{const S=a?C.data:C;if(S.deleted||!s&&S.type==="chapter"||i!==void 0&&!!S.api!==i||o&&!u(S)||r.length&&!ut.isItemMatch(S,r,v))return b;const D=m.libs.get(S.lib);return(h||S.lib===p||D&&D.data.space===p)&&b.push(a?C:m.docs.get(S.id)),b},[])}return[]}_getLocalDoc(e){if(e)return{id:e,type:"text",rawID:wg(e),parent:0,contentType:"doc",content:"",title:"",addedBy:"",lib:this.libID,module:this.moduleID,addedDate:lt(new Date),order:0,local:!0}}loadHomeLibs(){var e;(e=this._homeRef.current)==null||e.loadLibs()}toggleFullscreen(){y.toggleFullscreen({target:document.body,afterEnter:()=>{this.signals.fullscreen.value=!0,y("body").addClass("has-doc-app-fullscreen")},afterExit:()=>{y("body").removeClass("has-doc-app-fullscreen"),this.signals.fullscreen.value=!1}})}toggleViewSideTab(e){var t,i,s;return(s=(i=(t=this._viewRef)==null?void 0:t.current)==null?void 0:i.sidebar)==null?void 0:s.toggleTab(e)}getDefaultState(e){e=e||this.props;const{data:t,fetcher:i,mode:s="home",filterType:r="all",pager:o,search:a,docVersion:l=0,defaultState:c,params:h}=e,u=this.formatData({libTypes:e.libTypes||[],...t},e);return{loading:!!(!t&&i),editingDoc:void 0,creatingDoc:void 0,searchKeys:ut.getSearchKeys(a),fullscreen:!1,filterType:{[s]:r},docVersion:l,mode:s,highlightView:!1,editingUsers:[],pager:o,params:h,...c,...u}}resetState(e){super.resetState(e),requestAnimationFrame(()=>this._afterReset())}getDataSignal(e){const{signals:t}=this;return e==="doc"?t.docs:e==="module"?t.modules:e==="lib"?t.libs:t.spaces}getCurrentItem(e){var t,i,s;return e==="doc"?(t=this._doc.value)==null?void 0:t.data:e==="module"?(i=this._module.value)==null?void 0:i.data:e==="lib"?(s=this._lib.value)==null?void 0:s.data:this._space.value}getSpace(e){return e?this.signals.spaces.value.find(t=>t.id===e):this._space.value}getLib(e){return e?this.treeMap.libs.get(e):this._lib.value}getDoc(e){var t,i;return e=e||((t=this._doc.value)==null?void 0:t.data),typeof e!="object"&&(e=e?(i=this._treeMap.value.docs.get(e))==null?void 0:i.data:void 0),e}getUserInfo(e){const{userMap:t={}}=this.props,i=t[e];return i?typeof i=="string"?{account:e,realname:i}:{...i,account:e}:{account:e,realname:e}}getDownloadUrl(e,t){if(t=t||this.props.downloadUrl,!t)return;let i="";if(e.startsWith("data:"))i=e;else if(/https?:\/\//.test(e)){const s=window.EDITOR_IMAGE_PROXY_ENDPOINT;i=s?`${s}?url=${encodeURIComponent(e)}`:e}else if(e.startsWith("attachment:")){const s=e.substring(11).split("/")[0];i=we(t,{objectType:"doc",objectID:this.docID,gid:"",title:btoa(s),extra:""})}else i=we(t,{objectType:"doc",objectID:this.docID,gid:btoa(`g-${e}`),title:"",extra:"editor"});return i}downloadFile(e,t){const i=this.getDownloadUrl(e);if(i)return!t&&e.startsWith("attachment:")&&(t=decodeURIComponent(e.substring(11).split("/")[0])),Ji(i,t)}async switchView(e,t){if(!await this.checkEditingDoc())return;t=t||this.mode;const{spaceType:i,spaceID:s,libID:r,moduleID:o,docID:a,params:l,filterType:c,pager:h}=e,{fetchOnChangeSpace:u,fetcher:p}=this.props,m=i&&this.signals.spaceType.value!==i||s!==void 0&&this.signals.spaceID.value!==s,v=u&&p&&m,b={...i?{spaceType:i}:null,...s!==void 0?{spaceID:s}:null,...r!==void 0?{libID:r}:null,...o!==void 0?{moduleID:o}:null,...a!==void 0?{docID:a}:null,...l!==void 0?{params:l}:null,...c!==void 0?{filterType:{...this.signals.filterType.value,[t]:c}}:null,...h!==void 0?{pager:{...this.signals.pager.value,...h}}:null,mode:t};return this.changeState(b,async()=>{v&&await this.load(p,this.signals.spaceType.value,s),a&&t==="edit"?this.startEditDoc(a):t==="create"?this.startCreateDoc():t==="files"?this.showFiles():t==="home"&&this.goHome()})}setFilterType(e,t){this.signals.filterType.value={...this.signals.filterType.value,[t||this.mode]:e}}exportDoc(e="pdf",t){var s;const i=this.editor;if(i instanceof Is)return(s=i.$)==null?void 0:s.export(e,t)}importDoc(e,t,i){var r,o,a;const s=this.editor;s instanceof Is&&((r=s.$)==null||r.updateDoc(e,t==="json"?"snapshot":t,i),typeof i=="string"&&((a=(o=this._viewRef.current)==null?void 0:o.editor)==null||a.setTitle(i)))}getLang(e,t=[],i){const{langData:s}=this.props;let r;if(typeof t=="string"?(i=t,r=[]):r=Array.isArray(t)?t:[t],!s)return i??(Array.isArray(e)?e.join("."):e);const o=Array.isArray(e)?Bs(s,e):s[e]??i;return typeof o=="function"?o.call(this,...r):typeof o=="string"&&r.length?we(o,...r):o}getActions(e,t){const{getActions:i}=this.props,s=i?i.call(this,e,t):[];return s!=null&&s.length&&t.ui?s.filter(r=>r&&(!r.ui||r.ui.split(",").includes(t.ui))):s||[]}getFilterTypes(e){const{getFilterTypes:t}=this.props;return t?t.call(this,e)||[]:[["all","All"]]}getTableOptions(e,t){const{getTableOptions:i}=this.props;return i?i.call(this,e,t):e}getPagerItems(){return[{type:"info",text:this.getLang("recTotalFormat","共 {recTotal} 项")},{type:"size-menu",text:this.getLang("recPerPageFormat","每页 {recPerPage} 项"),placement:"top",caret:"up"},{type:"link",page:"first",hint:this.getLang("firstPage","第一页"),icon:"icon-first-page"},{type:"link",page:"prev",hint:this.getLang("prevPage","上一页"),icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",hint:this.getLang("nextPage","icon-angle-right"),icon:"icon-angle-right"},{type:"link",page:"last",hint:this.getLang("lastPage","最后一页"),icon:"icon-last-page"}]}getPagerOptions(e,t){const{getPagerOptions:i}=this.props,s=i?i.call(this,e,t):e;return s.items||(s.items=this.getPagerItems()),s}getSortableOptions(e){const{getSortableOptions:t}=this.props;return t==null?void 0:t.call(this,e)}getItemActions(e,t,i){const s=t==="current"?this.getCurrentItem(e):typeof t=="number"?this.getDataSignal(e).value.find(r=>r.id===t):t;return s?this.getActions(e,{ui:i,data:s}):(console.warn(`[ZUI] getItemActions: ${e} data with ID "${t}" not found.`),[])}async selectSpace(e,t,i){var a,l;if(!await this.checkEditingDoc())return;e==="_first"&&(e=((a=this.spaceList[0])==null?void 0:a.id)??0);const{fetchOnChangeSpace:s,fetcher:r,autoSelectLib:o}=this.props;if(i===void 0&&(i=!!(s&&r&&(this.signals.spaceID.value!==e||typeof t=="number"&&t!==this.signals.libID.value))),!(this.signals.spaceID.value===e&&!t))return this.changeState({spaceID:e,mode:"list",...t?{libID:typeof t=="number"?t:o&&!i?((l=this.libList[0])==null?void 0:l.data.id)??0:0,moduleID:0,docID:0}:null,...i?{data:void 0,loading:!0}:null},()=>{i&&this.load(r,this.signals.spaceType.value,e)})}async selectDoc(e,t){if(!await this.checkEditingDoc())return;typeof e!="object"&&(e=this.getDoc(e));const i=e?e.id:0;return this.changeState({mode:(e==null?void 0:e.type)==="chapter"?"list":"view",docID:i,...i!==this.signals.docID.value?{docVersion:0}:null,...e?{libID:e.lib,moduleID:e.module}:null,...t!==void 0?{docVersion:+t}:null})}async goHome(){if(await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"home"})}getDefaultPager(e){const{getDefaultPager:t,preserve:i}=this.props,s=i?Xe.get(`${i}:pager:${e}`):null;return t?t.call(this,e):{page:1,recTotal:0,recPerPage:typeof s=="number"?s:20,pageTotal:0}}resetPager(e,t){const i={...this.getDefaultPager(e),...this.signals.pager.value,...t};this.signals.pager.value=i;const{preserve:s}=this.props;s&&Xe.set(`${s}:pager:${e}`,i.recPerPage)}async showFiles(){if(this.canShowLibFiles&&await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"files",pager:this.getDefaultPager("files")})}async selectLib(e,t){if(!await this.checkEditingDoc())return;const i=this._module.value;i&&t===void 0&&i.data.lib!==e&&(t=0),t===void 0&&(t=this.signals.moduleID.value);const s=e?this.treeMap.libs.get(e):null;if(!(e&&!s||t&&!this.treeMap.modules.get(t)))return this.changeState({libID:e,moduleID:t,mode:"list",docID:0})}selectDocVersion(e,t){const i=this.signals.docID.value;t=t||i;const s=this.getDoc(t);s&&(e=Math.max(0,Math.min(+e,s.version??0)),!(t===i&&e===this.signals.docVersion.value)&&this.changeState({docID:t,docVersion:e}))}async selectModule(e,t){if(!await this.checkEditingDoc())return;const i=this._doc.value;return this.changeState({moduleID:e,...t||i&&e!==i.data.id?{docID:0,mode:"list"}:null})}setData(e,t){var r;const{signals:i}=this,s=this.formatData(e,{spaceType:i.spaceType.value,spaceID:i.spaceID.value,libID:i.libID.value,moduleID:i.moduleID.value,docID:i.docID.value});return this.changeState({...s,...t,libTypes:(r=s.libTypes)!=null&&r.length?s.libTypes:i.libTypes.value})}async checkEditingDoc(){if(this._hasEditingDoc.value){const[,e]=this._viewInfo.value;if(e!=null&&e.changed){this.signals.highlightView.value=!0;const t=await Re.confirm(this.getLang("leaveEditingConfirm","文档编辑中，确定要离开吗？"));if(this.signals.highlightView.value=!1,!t)return!1}await this.changeState({editingDoc:void 0,creatingDoc:void 0,docVersion:0})}return!0}async load(e,t,i,s){var r,o;if(e=e||this.props.fetcher,e){const{signals:a}=this;t=t||a.spaceType.value,i=i||a.spaceID.value;const{noLoading:l=!1,picks:c=[]}=s||{},h=typeof c=="string"?[c]:c;await this.changeState({loading:!l,spaceType:t,spaceID:i});const u=await _t(e,[{spaceType:t,spaceID:i,picks:h,noSpace:!!this.props.noSpace}],void 0,this);await this.setData(h?{spaces:a.spaces.value,libs:a.libs.value,modules:a.modules.value,docs:a.docs.value,spaceID:a.spaceID.value,libTypes:a.libTypes.value,...this.props.autoSelectLib?{libID:((o=(r=u.libs)==null?void 0:r[0])==null?void 0:o.id)??0}:{},...u}:u,l?void 0:{loading:!1})}}isLoadingDoc(e){return this._loadingDocs.has(e)}async loadDoc(e,t,i){var l;let s=this.getDoc(e)||this._getLocalDoc(e);if(!s||((l=this.props.privs)==null?void 0:l.view)===!1)return;if(i=i||this.props.docFetcher,!i){if(s.api)return;i=()=>t?{id:e,content:"",version:t}:{id:e,content:""}}const r=this._loadingDocs;if(r.has(e))return new Promise(c=>{r.get(e).push(c)});r.set(e,[]),t=t||s.version||0;const o=!t||t===s.version||!s.version,a=await _t(i,[{docID:e,version:t}],void 0,this);if(a){const c=o?this.formatDataItem("doc",{...s,...a,id:e,local:!1}):{...s,...a.version?{version:a.version}:null,...a.privs?{privs:a.privs}:null,...a.editable!==void 0?{editable:a.editable}:null,versions:{...s.versions,[t]:this.formatDataItem("doc",a)},local:!1};if(this.props.autoConvertDoc||c.status==="draft")if(c.contentType==="html"&&c.content&&s.$convert===void 0){const h=await rn.htmlToSnap(c.content);c.$convert=!!h}else c.$convert=!1;s=this.update("doc",c,{keepDeleted:!0})}return r.get(e).forEach(c=>c(s)),r.delete(e),s}formatDataItem(e,t,i,s){if(e==="module")t.lib=+(t.lib??t.root),t.parent=+(t.parent??0);else if(e==="lib"){const o=t;o.space=o.space??i,o.space=String(+o.space)===String(o.space)?+o.space:o.space}else e==="space"&&(t.type=t.type??s);if(t.id=Ni(t.id),t.deleted=typeof t.deleted=="string"?!!JSON.parse(t.deleted):t.deleted,e==="doc"){const o=t;if(o.files){!Array.isArray(o.files)&&typeof o.files=="object"&&(o.files=Object.values(o.files));for(const a of o.files)a.id=+a.id,a.size=+a.size,a.downloads=a.downloads?+a.downloads:0,a.deleted=typeof a.deleted=="string"?!!JSON.parse(a.deleted):a.deleted}o.api===void 0&&(o.api=typeof t.id=="string"&&t.id.startsWith("api.")),o.rawID=wg(t.id),o.product=+(o.product??0),o.project=+(o.project??0),o.execution=+(o.execution??0),o.version=+(o.version??0),o.views=+(o.views??0),o.module=+(o.module??0),o.lib=+(o.lib??0),o.collects=+(o.collects??0),o.contentVersion&&(o.contentVersion=+o.contentVersion,Number.isNaN(o.contentVersion)||(o.currentVersion=o.contentVersion)),o.editable!==void 0&&(o.privs={...o.privs,edit:o.editable}),o.contentType==="attachment"&&(o.contentType="html"),o.parent&&(o.parent=Ni(o.parent)),o.draft&&(typeof o.draft=="string"?o.draft=o.status==="draft"?{id:0,doc:o.id,content:o.content,contentType:o.contentType,title:o.title,version:0,addedBy:o.addedBy,addedDate:o.addedDate}:null:(o.draft.type&&(o.draft.contentType=o.draft.type),o.draft.rawContent&&(o.draft.content=o.draft.rawContent,delete o.draft.rawContent),o.status==="draft"&&(o.contentType=o.draft.contentType,o.content=o.draft.content))),o.rawContent&&(o.content=o.rawContent,delete o.rawContent),!o.collects&&o.isCollector&&(o.collects=1),o.editedBy===o.addedBy&&o.editedDate===o.addedDate&&(delete o.editedBy,delete o.editedDate)}typeof t.order!="number"&&typeof t.id=="number"&&(t.order=t.id);const{formatDataItem:r}=this.props;return r?r.call(this,e,t,i,s):t}formatData(e,t){let{libID:i=0,moduleID:s=0,docID:r,spaceID:o=0}=t;i&&(i=+i),s&&(s=+s),r&&(r=Ni(r));const{spaceType:a}=t,{libs:l=[],modules:c=[],docs:h=[],spaces:u=[],spaceID:p,libTypes:m=[]}=e||{};let v,b,C,S;return p&&(o=p),o=Ni(o),l.forEach(D=>{this.formatDataItem("lib",D,p)}),l.sort((D,N)=>(D.order??D.id)-(N.order??N.id)),u.forEach(D=>{this.formatDataItem("space",D,p,a)}),c.forEach(D=>{this.formatDataItem("module",D,p)}),h.forEach(D=>{this.formatDataItem("doc",D,p)}),r?v=h.find(D=>D.id===r):r=0,v&&!s&&(s=v.module??0),s&&(b=c.find(D=>D.id===s)),i=b?b.lib:i,!i&&this.props.autoSelectLib&&(C=l[0],i=C?C.id:0),i&&(!C||C.id!==i)&&(C=l.find(D=>D.id===i)),o=C?C.space:o,!this.props.noSpace&&u.length&&(S=u.find(D=>D.id===o)),o||(S=u[0],o=S?S.id:o),!o&&l.length&&(o=l[0].space),{spaceType:(S?S.type:a)||"mine",libs:l,modules:c,docs:h,spaces:u,spaceID:o,libID:i,moduleID:s,docID:r,libTypes:m}}batchUpdate(e,t){Ys(()=>{Object.keys(e).forEach(i=>{const s=e[i];this.update(i,s)}),t&&this.changeState(t)})}update(e,t,i){const s=!Array.isArray(t),r=s?[t]:t,o=this.getDataSignal(e),a=[],l=o.value,c=this.signals.spaceID.value,h=i==null?void 0:i.keepDeleted;return r.forEach(u=>{const p=Ni(u.id),m=l.findIndex(b=>b.id===p),v=m>=0?{...l[m],...u}:u;if(this.formatDataItem(e,v,c),v.deleted&&!h)m>=0&&(l[m]=v);else if(m>=0){if(e==="doc"){const b=l[m],C=v,S=C.contentVersion??C.version;b.version!==S&&Object.assign(v,{version:Math.max(b.version,S),versions:{...b.versions,[b.version]:b,[S]:v}})}l[m]=v}else l.push(v);a.push(v)}),o.value=[...l],s?a[0]:a}delete(e,t){Array.isArray(t)||(t=[t]);const i=new Set(t);if(!i.size)return!1;const s=this.getDataSignal(e),r=s.value;return!r||!Array.isArray(r)||!r.length?!1:(Ys(()=>{const o=new Set;e==="module"||e==="lib"?t.forEach(l=>{const c=e==="module"?this.treeMap.modules.get(l):this.treeMap.libs.get(l);c&&c.docs.forEach(h=>o.add(h.data.id))}):e==="doc"&&t.forEach(l=>{const c=this.treeMap.docs.get(l);c!=null&&c.docs.length&&Sr(c,[],!0).forEach(h=>o.add(h.id))}),s.value=r.filter(l=>!i.has(l.id)),o.size&&this.delete("doc",[...o]);const a=this.docID;(e==="doc"&&t.includes(a)||o.has(a))&&this.selectDoc(0)}),!0)}startCreateDoc(e,t,i){e=e??this.signals.libID.value,t=t??this.signals.moduleID.value;const s=this.signals.creatingDoc.value;if(!(s&&s.lib===e&&s.module===t))return this.changeState({creatingDoc:this._getCreatingDoc(i),mode:"create"})}cancelCreateDoc(){return this.changeState({creatingDoc:void 0,mode:"list"})}async saveNewDoc(e){var c,h,u,p,m,v,b;await((h=(c=this._viewRef.current)==null?void 0:c.editor)==null?void 0:h.triggerChange(void 0,{getHtml:!0}));const{signals:t}=this,i=t.creatingDoc.value;if(!i)return;if(i.title.trim()===""){await Re.alert(this.getLang("docTitleRequired","文档标题不能为空。")),(p=(u=this._viewRef.current)==null?void 0:u.editor)==null||p.focusTitle();return}const s=t.spaceID.value,r=t.libID.value,o=t.moduleID.value,a=await((m=this.props.onCreateDoc)==null?void 0:m.call(this,{...i,status:e||"normal",lib:t.libID.value,module:t.moduleID.value},s,r,o));if(!a)return Re.alert(this.getLang("saveDocFailed","文档保存失败，请稍后重试"));const l=+a.space.split(".")[1];return l!==s&&l===l?(await this.changeState({creatingDoc:void 0}),await this.selectSpace(l,a.lib),this.selectDoc(a)):(a.rawContent&&(a.content=a.rawContent),(b=(v=this._viewRef.current)==null?void 0:v.editor)==null||b.removeCache(),this.changeState({docs:[...t.docs.value,a],docID:a.id,libID:a.lib,moduleID:a.module,creatingDoc:void 0,mode:"view"}))}async startEditDoc(e,t){var l,c;if(e=e||((l=this._doc.value)==null?void 0:l.data),typeof e!="object"&&(e=this.getDoc(e)),!e)return;const i=t==null?void 0:t.loadDoc;if((i===!0||i!==!1&&!e.api&&(e.content===void 0||e.content===null))&&(e=await this.loadDoc(e.id),!e))return;if(e.editable===!1||((c=e.privs)==null?void 0:c.edit)===!1)return Re.alert(this.getLang("needEditable","您没有当前文档的编辑权限。"));const s=!!((t==null?void 0:t.convert)??e.$convert),{content:r,contentType:o,title:a=""}=e.draft||e;await this.changeState({docID:e.id,libID:e.lib,moduleID:e.module,editingDoc:{...e,title:a,contentType:o,content:r,...t==null?void 0:t.template,changed:!1,$convert:s,$html:s?e.content:void 0},mode:"edit"})}async restoreDoc(e,t){var l,c,h;let i=this.getDoc(e);if(!i)return;t=+t;const s=await this.loadDoc(e,t);if(i={...i,...s},((l=i.privs)==null?void 0:l.edit)===!1||i.editable===!1)return Re.alert(this.getLang("needEditable","您没有当前文档的编辑权限。"));const r=(c=i.versions)==null?void 0:c[t];if(!r)return;const o=await((h=this.props.onSaveDoc)==null?void 0:h.call(this,{...i,content:r.content,contentType:r.contentType,title:r.title,fromVersion:t}));if(o===!1)return;const a=typeof o=="object"?o.version:i.version+1;if(typeof o=="object"){const u={...i,version:a,contentVersion:a,...o};this.update("doc",u)}this.selectDoc(e,a)}cancelEditDoc(e){return this.changeState({mode:"view",editingDoc:void 0,docVersion:0,...e})}async saveDoc(e){var o,a,l,c,h;await((a=(o=this._viewRef.current)==null?void 0:o.editor)==null?void 0:a.triggerChange(void 0,{getHtml:!0}));const t=this.signals.editingDoc.value;if(!t)return this.cancelEditDoc();const i=this.getDoc(t.id);let s={...i,...t,status:e||"normal"};s.contentType==="doc"&&(s.$convert=!1);const r=await((l=this.props.onSaveDoc)==null?void 0:l.call(this,s));if(r!==!1){if((h=(c=this._viewRef.current)==null?void 0:c.editor)==null||h.removeCache(),r&&(r!==!0&&Object.assign(s,r),s=this.update("doc",s),s.lib!==(i==null?void 0:i.lib))){this.cancelEditDoc(),this.selectDoc(s);return}this.cancelEditDoc()}}_afterReset(){const{fetcher:e,data:t,mode:i,docID:s}=this.props,r=()=>{i==="edit"&&s?this.startEditDoc(s):i==="create"?this.startCreateDoc():i==="files"&&this.showFiles()};e&&!t?this.load().then(r):r()}componentDidMount(){var e;super.componentDidMount(),this._afterReset(),(e=this.props.onMounted)==null||e.call(this)}componentDidUpdate(e){var o;const{fetcher:t,data:i,spaceID:s,spaceType:r}=this.props;t&&!i&&(e.spaceType!==r||e.spaceID!==s)&&this.load(),(o=this.props.onUpdated)==null||o.call(this)}componentWillUnmount(){var e;this._viewEffect(),this._modeEffect(),(e=this.props.onUnmounted)==null||e.call(this)}_getCreatingDoc(e="doc"){const t=kx();return{id:t,rawID:t,type:"text",parent:0,lib:this.signals.libID.value,module:this.signals.moduleID.value,title:"",content:"",contentType:e,addedBy:this.props.currentUser||"",addedDate:lt(new Date,"yyyy-MM-dd HH:mm:ss"),uid:Ei(13).replaceAll("-","_"),order:0}}_getClassName(e){return["doc-app",e.className,this._viewType.value!=="list"?"has-show-view":"",this.signals.fullscreen.value?"is-enter-fullscreen":"",`doc-app-mode-${this.mode}`]}_getProps(e){var t;return{...super._getProps(e),style:{width:Ge(e.width),height:Ge(e.height)},"data-view":this._viewType.value,"data-lib-type":(t=this._lib.value)==null?void 0:t.data.type,"data-space-type":this.spaceType}}_renderSidebar(e){var h,u;const{libIcon:t,apiLibIcon:i,preserve:s,moduleIcon:r,docIcon:o,chapterIcon:a,currentUser:l}=e,c=this.spaceType;return w(wx,{key:"sidebar",app:this,className:"surface-light",preserve:s?`${s}-sidebar`:void 0,currentUser:l,libIcon:t,apiLibIcon:i,moduleIcon:r,docIcon:o,chapterIcon:a,spaceType:c,space:this._space.value,libs:this._libList.value,lib:this._lib.value,libTypes:this.signals.libTypes.value,showFiles:this.signals.mode.value==="files",moduleID:((h=this._module.value)==null?void 0:h.data.id)||0,docID:((u=this._doc.value)==null?void 0:u.data.id)||0,getActions:this.getItemActions,onSelectDoc:this.selectDoc,onSelectLib:this.selectLib,onShowFiles:this.canShowLibFiles?this.showFiles:void 0})}_renderFiles(){const e=this.renderCustom("files");if(e!==void 0)return e;const{currentUser:t,fileUrl:i,filesFetcher:s,userMap:r}=this.props;return w(Gu,{key:"files",app:this,userMap:r,objectType:this.spaceType,objectID:this.spaceID,filterType:this.filterType,currentUser:t,onGetUser:this.getUserInfo,fileUrl:i,searchKeys:this.signals.searchKeys.value,filesFetcher:s})}_renderList(e){var c,h;if(this.signals.mode.value==="files")return this._renderFiles();const t=this.renderCustom("list");if(t!==void 0)return t;if(((c=this.lib)==null?void 0:c.data.type)==="api")return w(Xx,{app:this,docs:this._docList.value});const{libIcon:i,moduleIcon:s,docIcon:r,userMap:o,canMoveDoc:a}=e,l=this.signals.searchKeys.value;return w(bx,{key:"list",app:this,libIcon:i,moduleIcon:s,docIcon:r,userMap:o,searchKeys:l,docs:this._docList.value,canMoveDoc:a,getActions:this.getActions,getTableOptions:this.getTableOptions,orderBy:(h=this._lib.value)==null?void 0:h.data.orderBy})}_renderView(e){const t=this.renderCustom("view");if(t!==void 0)return t;const[i,s]=this._viewInfo.value;if(!s||s.type==="chapter")return null;const{fileIcon:r,fileUrl:o,preserve:a,historyFetcher:l,uploadUrl:c,downloadUrl:h}=e,[u,p]=this._docUsers.value;return w(Kx,{ref:this._viewRef,app:this,key:i,doc:s,mode:i,onChange:this._handleDocChange,fileIcon:r,fileActions:this._getFileActions,fileUrl:o,creator:u,modifier:p,uploadUrl:c,downloadUrl:h,preserve:a?`${a}-view`:void 0,onGetUser:this.getUserInfo,historyFetcher:l,highlight:this.signals.highlightView.value})}_renderMain(e){const t=this._renderView(e);return w("div",{key:"main",className:`doc-main flex-auto relative min-w-0${t?" show-view":""}`},this._renderList(e),t)}_renderSearchBox(e){let t={rootClass:"doc-app-search w-40 ml-1 mr-3",defaultValue:(this.signals.searchKeys.value||[]).join(" "),onChange:this._handleSearch,placeholder:this.getLang("searchPlaceholder","搜索")};const{getSearchBoxOptions:i}=this.props;return i&&(t=i.call(this,t,{type:e})),w(ki,{...t})}_renderFilters(){var a;const e=this.renderCustom("filters");if(e!==void 0)return e;const t=this._viewType.value;if(t!=="list"&&t!=="files")return null;const i=this.getFilterTypes(t),s=t==="list",r=this.filterType,o=s?(a=this._docList.value)==null?void 0:a.length:0;return w("div",{className:"row items-center flex-auto justify-end"},i.length?w("menu",{className:"nav nav-compact",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},i.map(([l,c])=>w("li",{key:l,className:"nav-item item"},w("a",{className:l===r?"active rounded-full":"rounded-full","data-type":l,"data-view":t},c,l===r&&o?w("span",{className:"label size-sm canvas ring-0 rounded-full"},o):null)))):null,this._renderSearchBox(t))}_renderToolbar(){var r;const e=this.renderCustom("toolbar");if(e!==void 0)return e;const t=this._viewType.value,i=[],s="toolbar";if(t==="list")i.push(...this.getActions("doc-list",{ui:s}));else if(t==="view"){const o=(r=this._doc.value)==null?void 0:r.data;o&&(o.deleted||i.push(...this.getActions("doc",{ui:s,data:o})))}else t==="edit"?i.push(...this.getActions("doc-edit",{ui:s,data:this.signals.editingDoc.value})):t==="create"&&i.push(...this.getActions("doc-create",{ui:s,data:this.signals.creatingDoc.value}));return w(Be,{className:"doc-app-toolbar",gap:2,size:"md",items:i})}_renderHeader(e){const t=this.renderCustom("header");return t!==void 0?t:w("div",{key:"header",class:"doc-app-header surface-light row items-center border-b py-1.5 pl-1 pr-2"},w(Ex,{app:this,spaceIcon:e.spaceIcon,libIcon:e.libIcon,apiLibIcon:e.apiLibIcon,moduleIcon:e.moduleIcon,libFilesIcon:e.libFilesIcon,noSpace:e.noSpace,docIcon:e.docIcon,spaces:this._spaceList.value,space:this._space.value,libs:this._libList.value,lib:this._lib.value,doc:this._doc.value,docVersion:this.signals.docVersion.value,creatingDoc:this.signals.creatingDoc.value,editingDoc:this.signals.editingDoc.value,showFiles:this.signals.mode.value==="files",module:this._module.value,libPlaceholder:"所有库",onSelectDocVersion:this.selectDocVersion,onSelectLib:this.selectLib,onSelectSpace:this.selectSpace,onSelectModule:this.selectModule,onSelectDoc:this.selectDoc,homeName:e.homeName,getSpaceFetcher:e.getSpaceFetcher,spaceType:this.spaceType,spaceID:this.spaceID},this._renderFilters()),this._renderToolbar())}_renderBody(e){return w("div",{key:"body",class:"doc-app-body flex-auto min-h-0 row items-stretch"},this._renderSidebar(e),this._renderMain(e))}_renderHome(){const e=this.renderCustom("home");return e!==void 0?e:this.spaceType==="product"||this.spaceType==="project"&&window.config.vision!=="lite"?w(Yx,{ref:this._homeRef,app:this}):w(qx,{ref:this._homeRef,app:this})}_getChildren(e){return this.signals.mode.value==="home"?this._renderHome():this.signals.loading.value?w("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":this.getLang("loadingDocsData","正在加载文档数据...")}):this._space.value?[this._renderHeader(e),this._renderBody(e)]:w("div",{key:"empty-tip",class:"doc-empty-tip center h-full gap-8"},w("div",{className:"relative text-primary"},w($e,{icon:"file-alt",className:"opacity-10",style:"font-size: 72px; transform: rotate(-30deg); transform-origin: 0 72px;"}),w($e,{icon:"file-alt",className:"opacity-30 absolute left-0 top-0",style:"font-size: 72px; transform: rotate(-15deg); transform-origin: 0 72px;"}),w($e,{icon:"file-text",className:"absolute left-0 top-0",style:"font-size: 72px; transform: rotate(0deg); transform-origin: 0 72px;"})),w("div",{className:"text-gray text-lg"},this.getLang("noSpaceTip","这里什么也没有，先创建一个空间再使用吧！")),Be.render({size:"lg",items:this.getActions("home",{ui:"home-no-space"})},[]))}getCustomRender(e){var t;return(t=this.props.customRenders)==null?void 0:t[e]}renderCustom(e,...t){let i=this.getCustomRender(e);if(typeof i=="function"&&(i=i.call(this,...t)),i!==void 0)return typeof i=="string"?i:w(ge,{key:e,content:i,generatorArgs:t,generatorThis:this})}};eh.NAME="DocApp",eh.defaultProps={spaceIcon:"docspace",libIcon:"doclib",apiLibIcon:"interface-lib",moduleIcon:"folder-o",docIcon:"doc",libFilesIcon:"annex-lib",chapterIcon:"list-box",fetchOnChangeSpace:!0,preserve:"doc-app",autoConvertDoc:!0,commands:{},showLibFiles:["product","project","execution"],libColors:["secondary","primary","warning","success","special"].map(n=>`var(--color-${n}-500)`)};async function Mg(n,e){const t=await _t(e.docFetcher,[{docID:n,version:0}]);if(!(t!=null&&t.content))return!1;let i="";if(e.type==="html"){if(!await rn.htmlToSnap(t.content))return!1}else try{i=await rn.convertToHtml(t.content,void 0,e.downloadUrl)}catch(o){console.warn("[ZUI] Convert doc to html failed:",o)}const s={content:i};let r;return await y.post(we(e.migrateUrl,{docID:n}),s,o=>{const a=o;r=a.result==="success"?!0:a.message},"json"),r}async function Pg(n){try{n=n||Pt("doc","ajaxGetMigrateDocs");const e=await _t(n);return Array.isArray(e)?{doc:e,html:[]}:e}catch{return{}}}async function Lg(n,e){await rn.loadModule();const{onProgress:t,migrateUrl:i=Pt("doc","ajaxMigrateDoc","docID={docID}"),docFetcher:s=Pt("doc","ajaxGetDoc","docID={docID}"),downloadUrl:r=Pt("file","ajaxQuery","fileID={gid}")}=e||{},o={migrateUrl:i,docFetcher:s,downloadUrl:r};let a=0;const l=n.doc.length+n.html.length,c=["doc","html"];for(const h of c)for(const u of n[h])t==null||t(a,l),await Mg(u,{...o,type:h}),await bi(50),a++;return t==null||t(a,l),n}class th extends me{constructor(){super(...arguments),this._current=Je(0)}migrate(){const{idList:e,docFetcher:t,downloadUrl:i,migrateUrl:s}=this.props;return Lg(e,{docFetcher:t,downloadUrl:i,migrateUrl:s,onProgress:r=>{this._current.value=r}})}componentDidMount(){this.migrate()}render(e){var o;const t=this._current.value,i=e.idList,s=i.doc.length+i.html.length,r=t===s;return w("div",{className:"col gap-4 p-6"},w("div",{class:"row gap-2 items-center"},w("div",{class:`progress progress-striped flex-auto ${r?"":"active"}`},w("div",{class:"progress-bar",style:`width: ${Math.floor(t*100/s)}%`})),w("div",{class:"text-gray"},Math.floor(t*100/s),"%")),r?w("div",{className:"text-center mt-2"},w("button",{type:"button",class:"btn primary",onClick:(o=e.onFinish)==null?void 0:o.bind(this,i)},e.finishText)):w("div",null,we(e.progressTip,{current:t,total:s})))}static async open(e){let t;const i=he();return await Re.open({type:"custom",ref:i,size:400,content:w(th,{...e,onFinish:s=>{var r;t=s,(r=i.current)==null||r.hide()}}),custom:{closeBtn:!1}}),t}}async function Qx(n){const{preserve:e="DocApp:migratedDocs:v2"}=n||{};if(Xe.get(e))return;const{doc:t=[],html:i=[]}=await Pg(n==null?void 0:n.migrateUrl),s=t.length+i.length;if(!s)return;const r={zh_cn:{confirm:"检查到有 {0} 个文档数据需要迁移，是否进行迁移操作？你也可以下次进入文档应用时再进行迁移。",progressTip:"正在迁移文档数据...（{current}/{total}）",finish:"迁移完成"},zh_tw:{confirm:"檢查到有 {0} 个文檔數據需要遷移，是否進行遷移操作？你也可以下次進入文檔應用時再進行遷移。",progressTip:"正在遷移文檔數據...（{current}/{total}）",finish:"遷移完成"},en:{confirm:"There are {0} documents need to be migrated, do you want to migrate them now? You can also migrate them next time when you enter the document application.",progressTip:"Migrating documents...({current}/{total})",finish:"Migrate finished"}},o=r[ef()]||r.en,a=(n==null?void 0:n.confirm)||o.confirm;if(a&&!await Re.confirm(we(a,s)))return;const l=(n==null?void 0:n.progressTip)||o.progressTip,c=(n==null?void 0:n.finishText)||o.finish,h=await th.open({idList:{doc:t,html:i},...n,progressTip:l,finishText:c});return h&&Xe.set(e,Date.now()),h}const Jx=Object.freeze(Object.defineProperty({__proto__:null,getMigrateDocs:Pg,migrateDoc:Mg,migrateDocs:Lg,tryMigrateDocs:Qx},Symbol.toStringTag,{value:"Module"}));class $r extends ve{}$r.NAME="DocApp",$r.Component=eh,Object.assign($r,Jx),$r.register();const vI="",_I="",bI="",wI="",CI="",xI="",SI="",kI="";class nh extends ve{}nh.NAME="Dropmenu",nh.Component=kr;class Rg extends We{init(){const{echarts:e}=window;if(!e){console.warn("ZUI: ECharts is not loaded.");return}const{responsive:t=!0,theme:i,...s}=this.options,r=e.init(this.element,i);r.setOption(s),t&&y(window).on(`resize.${this.gid}.ECharts.zt`,r.resize),this.chart=r}destroy(){var i;const{echarts:e}=window;if(!e){super.destroy();return}const{responsive:t=!0}=this.options;t&&y(window).off(`resize.${this.gid}.ECharts.zt`),(i=this.chart)==null||i.dispose(),super.destroy()}}Rg.NAME="ECharts";let ih=class extends ve{};ih.NAME="FileList",ih.Component=xr;const TI="",Og=n=>n.replace(/([[\]])/g,"\\$1");class Ba extends We{constructor(){super(...arguments),this._disabled=!1,this._timer=0}init(){this.$element.on("submit",this.onSubmit.bind(this)).on("input mousedown change",this.onInput.bind(this))}enable(e=!0,t=0){if(this._resetTimer(),t){this._timer=window.setTimeout(()=>{this.enable(e),this._timer=0},t);return}this.$element.toggleClass("loading",!e),this.$element.find('.btn-submit,button[type="submit"]').toggleClass("disabled",!e).prop("disabled",!e),this._disabled=!e}disable(){this.enable(!1)}onInput(e){const t=y(e.target).closest(".has-error");if(!t.length)return;let i=t.attr("name");i||(i=t.find(".pick-value").attr("name"));const s=i?`#${i.split("[")[0]}Tip,#${Og(i)}Tip`:".form-tip";t.removeClass("has-error"),t.closest(".form-group,.form-batch-control").find(s).remove()}onSubmit(e){var o;if(e.preventDefault(),this._disabled)return;const{element:t}=this,i=y.extend({},this.options);this.emit("before",e,t,i);const s=()=>{this.$element.find(".ajax-form-tip").each(function(){const l=y(this);l.closest(".form-group,.form-batch-control").find(".has-error").removeClass("has-error"),l.remove()}),this.disable();const a=this._processData();this._send(a)},r=(o=i.beforeSubmit)==null?void 0:o.call(i,e,t,i);if(r!==!1){if(r instanceof Promise){r.then(a=>a&&s());return}s()}}submit(){this.element.submit()}reset(){this.element.reset()}destroy(){this._resetTimer()}_resetTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=0)}_processData(){const{$element:e,options:t}=this;let i=new FormData(this.element),{submitEmptySelectValue:s="",submitNoValueChecks:r}=t;const{submitDisabledValue:o=!0}=t;s!==!1&&(typeof s!="boolean"&&(s=""),e.find("select").each((l,c)=>{const h=y(c),u=h.attr("name");h.is("[disabled]")&&!o||i.has(u)||i.append(u,typeof s=="object"?s[u]:s)})),o&&e.find("[disabled][name]").each((l,c)=>{const h=y(c);if(h.hasClass("not-submit-disabled-value"))return;const u=h.attr("name");i.has(u)||i.append(u,h.val())}),r&&(r=typeof r=="string"?r:"",e.find('[type="checkbox"],[type="radio"]').not(":checked").each((l,c)=>{const h=y(c),u=h.attr("name");i.has(u)||h.is("[disabled]")&&!o||i.append(u,h.data("notCheckedValue")??r)}));const{beforeSend:a}=t;if(a){const l=a(i);l instanceof FormData&&(i=l)}return this.emit("send",i),i}_send(e){const{$element:t,options:i}=this;let s,r;const o=i.url||t.attr("action"),a={method:t.attr("method")||"POST",data:e,headers:t.closest(".modal").length?{"X-ZUI-Modal":"true"}:void 0,dataType:"json",jsonParser:JSON.parse},{optionsModifiers:l}=this.constructor;l.length&&l.forEach(h=>{const u=h.call(this,a);u&&u!==a&&y.extend(!0,a,u)});const c=y.ajax(o,a).success((h,u,p)=>{var m,v,b;h instanceof Blob?(Ji(h,(b=(v=(m=p.headers.get("Content-Disposition"))==null?void 0:m.split(";")[1])==null?void 0:v.split("=")[1])==null?void 0:b.replace(/"/g,"")),r={result:"success"}):(r=h,(!r||typeof r!="object")&&(s=new Error("Invalid json format")))}).fail(h=>{s=h}).complete(()=>{var h,u;if(s)this.emit("error",s),console.warn("ZUI: send ajax form failed",s),i.onError?i.onError(s):Re.showError({size:"lg",error:[`<b>POST:</b> ${o}`,`<b>Error:</b> ${s.message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}`,`<b>Response:</b> ${c.data}`].join("<br>")});else{const p=(h=i.onResult)==null?void 0:h.call(this,r);if(p===!1)return;p&&(r=y.extend(r,p)),this._handleResult(r)}this.emit("complete",r,s),(u=i.onComplete)==null||u.call(i,r,s),this.enable(!0,s||(r==null?void 0:r.result)!=="success"?0:5e3)})}_showValidateMessage(e){var i;let t;Object.entries(e).forEach(([s,r])=>{Array.isArray(r)&&(r=r.join(""));const o=Og(s),{$element:a}=this;let l=a.find(`#${o}`);if(l.length||(l=a.find(`[data-form-name="${o}"]`)),l.length||(l=a.find(`[name="${o}"]`)),!l.length&&!s.includes("[")&&(l=a.find(`[name="${o}[]"]`)),!l.length){Re.alert(r);return}l.hasClass("pick-value")&&(l=l.closest(".pick")),l.addClass("has-error");const c=l.closest(".form-group,.form-batch-control,td");if(c.length){let h=c.find(`#${o}Tip`);h.length||(h=c.find(".form-tip")),h.length||(h=y(`<div class="form-tip ajax-form-tip text-danger pre-line" id="${s}Tip"></div>`).appendTo(c)),h.empty().text(r)}else Re.alert(r);t||(t=l)}),t&&((i=t[0])==null||i.focus())}_handleResult(e){var l,c;const{options:t}=this;let{message:i}=e;const s=e.result==="success";if(s){if(this.emit("success",e),((l=t.onSuccess)==null?void 0:l.call(t,e))===!1)return;typeof i=="string"&&i.length&&Kn.show({content:i,type:"success"})}else{if(this.emit("fail",e),((c=t.onFail)==null?void 0:c.call(t,e))===!1)return;i&&(Array.isArray(i)&&(i=i.join(`
`)),typeof i=="string"&&i.length?Re.alert(i):typeof i=="object"&&this._showValidateMessage(i))}const r=t.closeModal??e.closeModal;r&&(r!=="onlySuccess"||s)&&Re.hide(typeof r=="string"&&r!=="onlySuccess"?r:void 0);const o=t.callback??e.callback;if(o){const h=[["options",t],["result",e]];if(typeof o=="string"){const u=y.runJS(o,...h);typeof u=="function"&&!o.endsWith(";")&&u(e)}else if(typeof o=="object"){const u=y.runJS(o.name,...h);typeof u=="function"&&u.apply(this,Array.isArray(o.params)?o.params:[o.params])}}const a=t.load??e.load??e.locate;a&&this.$element.trigger("locate.zt",a)}}Ba.NAME="AjaxForm",Ba.optionsModifiers=[];function sh(n,e){var a,l;const t=n.result==="success";if(t){if(((a=e.onSuccess)==null?void 0:a.call(e,n))===!1)return}else if(((l=e.onFail)==null?void 0:l.call(e,n))===!1)return;const{message:i}=n;i&&(e.onMessage?e.onMessage(i,n):typeof i=="string"&&i.length&&(t?Kn.show({content:i,type:"success"}):Re.alert(i)));const s=e.closeModal??n.closeModal;s&&Re.hide(typeof s=="string"?s:void 0);const r=e.callback??n.callback;if(r){const c=[["options",e],["result",n]];if(typeof r=="string"){const h=y.runJS(r,...c);typeof h=="function"&&!r.endsWith(";")&&h(n)}else if(typeof r=="object"){const h=y.runJS(r.name,...c);typeof h=="function"&&h.apply(null,Array.isArray(r.params)?r.params:[r.params])}}const o=e.load??n.load??n.locate;o&&y(e.element||document).trigger("locate.zt",o)}function Fg(n){return typeof n=="string"&&(n=n.split(",").reduce((e,t)=>{const[i,s]=t.trim().split(":");return e[i.trim()]=s.trim(),e},{})),Object.keys(n).reduce((e,t)=>{const i=t.endsWith("?"),s=i?t.substring(0):t;let r=n[s];if(typeof r=="string"){const[o,a]=r.split("~"),l=y(o);if(!l.length)return e;a==="checkedIDList"?r=l.closest("[data-zui-dtable]").dtable("getChecks"):l[0].hasAttribute("data-map-value")?r=l.dataset("mapValue"):l.closest(".pick").length?r=l.closest(".pick").find(".pick-value").val():l.is("input,select,textarea")?r=l.val():r=l.text()}return(i||r!=null&&r!==""&&(!Array.isArray(r)||r.length))&&(e[s]=r),e},{})}async function Pi(n){if(n.confirm)return await Re.confirm(n.confirm)?Pi({...n,confirm:void 0}):[void 0,new Error("canceled")];if(n={...Ba.DEFAULT,...n},n.beforeSubmit&&await n.beforeSubmit(n)===!1)return[void 0,new Error("canceled")];const{loadingClass:e,element:t}=n;t&&e&&y(t).addClass(e);const{data:i,dataMap:s}=n;let r;i&&(r=vo(i)),s&&(r=vo(Fg(s),r));const{beforeSend:o}=n;if(o){const h=o(r);h instanceof FormData&&(r=h)}let a,l;return await new Hs({url:n.url,method:n.method||"POST",body:r,headers:n.headers,dataType:"json"}).success(h=>{l=h,(!l||typeof l!="object")&&(a=new Error("Invalid json format"))}).fail(h=>{a=h,console.warn("ZUI: cannot submit ajax form",h)}).complete(()=>{var h,u,p;if(a)(h=n.onError)==null||h.call(n,a);else{const m=(u=n.onResult)==null?void 0:u.call(null,l);if(m===!1)return;m&&(l=y.extend(l,m)),sh(l,n)}(p=n.onComplete)==null||p.call(n,l,a),t&&e&&y(t).removeClass(e)}).send(),[l,a]}y.extend(y,{ajaxSubmit:Pi}),y(document).on("click.ajaxSubmit.zui",".ajax-submit",function(n){n.preventDefault();const e=y(this);if(e.is("[disabled],.disabled"))return;const t=e.data();!t.url&&e.is("a")&&(t.url=e.attr("href")||""),t.url&&(t.element=this[0],Pi(t))});class Zx extends me{constructor(e){super(e),this.state={pinnedList:e.pinnedList||[]}}_handlePinnedChange(e){const{pinnedList:t}=this.state;t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),this.setState({pinnedList:t})}_handleSave(){var e,t;(t=(e=this.props).onSave)==null||t.call(e,this.state.pinnedList)}render(e,t){const{tip:i,items:s,saveText:r=Ne.getLang("save"),resetText:o=Ne.getLang("reset"),cancelText:a=Ne.getLang("cancel"),pinnedIcon:l="pinned",unpinnedIcon:c="unpinned"}=e,{pinnedList:h}=t,u=new Set(h);return w("form",{className:"form-setting-form w-80 col gap-3"},w("div",{className:"text-gray mt-2"},i),w("div",{className:"divider opacity-5"}),w("div",{className:"row flex-wrap"},s.map(({text:p,value:m})=>{const v=u.has(m);return w("label",{className:"state size-sm ghost w-1/2 pl-1 pr-2 py-1 flex flex-nowrap gap-2 items-center rounded",onClick:this._handlePinnedChange.bind(this,m)},w($e,{icon:v?l:c,className:v?"text-primary":"text-gray-400"}),w("div",{className:`flex-auto text-clip${v?"":" text-gray"}`},p))})),w("div",{className:"row flex-nowrap gap-4 mt-2"},w(xe,{size:"md",className:"btn-wide",type:"primary",onClick:this._handleSave.bind(this)},r),w(xe,{size:"md",className:"btn-wide","data-dismiss":"popover"},a),w(xe,{size:"md",type:"primary-ghost",disabled:!h.length,onClick:()=>this.setState({pinnedList:[]})},o)))}}class zg extends Ht{_getFormItems(){const e=this.$element.closest("form"),t=[],i=[];return e.find(".form-group.is-foldable[data-name]").each((s,r)=>{if(y(r).hasClass("hidden"))return;const o=y(r),a=o.data("name"),l=o.find(".form-label").first();let c=o.data("label");if(c===void 0){const h=l.find(".text");h.length&&(c=h.text())}c===void 0&&(c=l.text().trim()),t.push({value:a,text:c||a}),o.hasClass("is-pinned")&&i.push(a)}),{items:t,pinnedList:i}}_handleSave(e){const{customUrl:t,onSave:i}=this.options,s=()=>{(i==null?void 0:i(e))!==!1&&this.hide();const r=this.$element.closest("form");r.find(".form-group.is-foldable[data-name]").each((o,a)=>{const l=y(a),c=l.data("name");l.toggleClass("is-pinned",e.includes(c))}),r.toggleClass("no-foldable-items",!r.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)};t?Pi({url:t,data:{"fields[]":e},onSuccess:r=>{delete r.callback,s()}}):s()}_getRenderOptions(){const{title:e,tip:t,className:i,saveText:s,resetText:r,cancelText:o}=this.options,{items:a,pinnedList:l}=this._getFormItems();return{...super._getRenderOptions(),title:e,headingClass:"popover-heading transparent px-4 pt-4",contentClass:"px-4 pb-4",titleClass:"text-lg font-bold",content:w(Zx,{tip:t,saveText:s,resetText:r,cancelText:o,items:a,pinnedList:l,onSave:this._handleSave.bind(this),onCancel:this.hide.bind(this)}),className:V("form-setting-popover",i)}}}zg.NAME="FormSetting";class jg extends We{get mode(){return this.$container.hasClass("is-full")?"full":"lite"}get shownFoldItems(){return this.$container.hasClass("show-fold-items")}get $container(){let e=this._$container;if(!e){const{$element:t}=this;e=t.closest(".panel-form,.page-form"),e.length||(e=t),this._$container=e}return e}afterInit(){super.afterInit();const e=[],{$element:t}=this;t.children(".form-group[data-name]").each((a,l)=>{e.push(y(l).attr("data-name"))}),this._fields=e;const{fullModeOrders:i}=this.options;this._fullModefields=typeof i=="string"?[i]:i;let{preserve:s}=this.options;(s===!0||s===void 0)&&(s=t.attr("id")),this._preserveID=s||!1;const r=this.options.mode||(this._preserveID?Xe.get(`FormGrid:${this._preserveID}:mode`,this.mode):this.mode);this.toggleMode(r,!1,!0);const{namespace:o}=this;this.$container.on(`click${o}`,".btn-full-form",()=>this.toggleMode("full")).on(`click${o}`,".btn-lite-form",()=>this.toggleMode("lite")).on(`click${o}`,".btn-toggle-fold",()=>this.toggleFold()),t.on(`change${o}`,"[name]",this._handleChange.bind(this)),t.toggleClass("no-foldable-items",!t.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)}getField(e){const{$element:t}=this;let i=t.children(`.form-group[data-name="${e}"]`);if(!i.length)return;const s=t.children(`[data-wrap-before="${e}"]`),r=t.children(`[data-wrap-after="${e}"]`);let o=y();return s.length&&(o=o.add(s)),i.find("script").remove(),i=t.children(`.form-group[data-name="${e}"]`),o=o.add(i),r.length&&(o=o.add(r)),{name:e,wrapBefore:!!s.length,wrapAfter:!!r.length,foldable:i.hasClass("is-foldable"),$ele:i,$group:o}}destroy(){super.destroy(),this.$container.off(this.namespace)}toggleFold(e){e=e??!this.shownFoldItems,this.$container.toggleClass("show-fold-items",e)}openSetting(){this.$container.find(".btn-custom-form").trigger("click")}toggleMode(e,t,i){const s=this.mode;e=e||(s==="full"?"lite":"full"),!(s===e&&!t)&&(this.$container.toggleClass("is-full",e==="full").toggleClass("is-lite",e==="lite"),!i&&this._preserveID&&Xe.set(`FormGrid:${this._preserveID}:mode`,e),this.updateOrders())}updateOrders(e,t){e&&(this._fields=e),t&&(this._fullModefields=typeof t=="string"?[t]:t);const{mode:i}=this;i==="full"?(t=this._fullModefields,Array.isArray(t)&&t.forEach(s=>{this.sortFields(s)})):this.sortFields()}sortFields(e){e=e||this._fields,typeof e=="string"&&(e=e.split(","));let t;e.forEach(r=>{const o=this.getField(r);if(o){if(t){const a=t.$group.last();if(o.$group.first()[0]===a[0])return;o.$group.insertAfter(a)}t=o}});const i=this.$element.children(".form-group.is-foldable").first(),s=this.$element.children(`[data-wrap-before="${i.attr("data-name")}"]`);this.$element.children(".panel-form-divider").insertBefore(s.length?s:i)}_handleChange(e){const{autoLoad:t,loadUrl:i}=this.options;if(!t)return;const s=y(e.target).closest("[name]");Object.keys(t).forEach(r=>{const o=t[r];".[#".includes(r[0])||(r=`[name="${r}"]`),s.closest(r).length&&window.loadForm(y.extend({url:i,target:s},typeof o=="string"?{items:o}:o))})}}jg.NAME="FormGrid";const DI="";class Bg extends We{init(){const{initGantt:e}=this.options;typeof e=="function"&&e()}destroy(){const{destroyGantt:e}=this.options;typeof e=="function"&&e(),super.destroy()}}Bg.NAME="Gantt";const II="";tt(hx);const $I="";let Hg=class extends ht{constructor(){super(...arguments),this._searchBox=he(),this._menu=he(),this._handleChange=e=>{this.setState({value:e.trim()})},this._handleFocus=()=>{this.toggle(!0)},this._handleEenter=()=>{var t;const e=(t=this._menu.current)==null?void 0:t.getActiveKey();e&&this.search(e)},this._handleClickItem=e=>{this.search(e.item.key)}}search(e){var t,i;(t=this.props.onSearch)==null||t.call(this,e,this.state.value),this.toggle(!1,{value:""}),(i=this._searchBox.current)==null||i.blur()}componentDidUpdate(e,t){var s;super.componentDidUpdate(e,t);const i=this._menu.current;this.state.open&&i&&!((s=this._types)!=null&&s.has(i.getActiveKey()))&&i.activeNext()}_getHotkeys(){return this._hotkeys||(this._hotkeys={activeNext:{keys:"ArrowDown",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activeNext()}},activePrev:{keys:"ArrowUp",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activePrev()}},enter:!0}),this._hotkeys}_renderTrigger(e){return w(ki,{delay:0,ref:this._searchBox,placeholder:e.searchHint,onChange:this._handleChange,onFocus:this._handleFocus,hotkeys:this._getHotkeys(),onEnter:this._handleEenter,...e.searchBox})}_getItems(e,t){const{items:i,getObjectID:s,getSearchType:r}=e,{value:o}=t;let a=r==null?void 0:r.call(this,o);const l=a&&a[0]==="!";l&&(a=a.slice(1));const c=s?s.call(this,o):Number.isInteger(+o)?+o:!1,h=Number.isInteger(c),u=[],p=i.reduce((b,C)=>(b.set(C.key,C),b),new Map),m="search",v=b=>{var C;return{html:((C=b.text)==null?void 0:C.replace("{0}",o))??o}};if(a&&h){const b=p.get(a);b&&u.push({...b,className:V(b.className,"w-full"),text:v(b)})}if(!l){const b=p.get(m);u.push({...b,className:V(b==null?void 0:b.className,"w-full"),text:b?v(b):o})}return h&&i.forEach(b=>{b.key===m||b.key===a||l||u.push({...b,className:V(b.className,"w-1/2"),text:v(b)})}),this._types=new Set(u.map(b=>b.key)),u}_renderPop(e,t){return w(Nt,{className:"row flex-wrap overflow-auto scrollbar-hover",items:this._getItems(e,t),onClickItem:this._handleClickItem,ref:this._menu,activeOnHover:!0,...e.menu})}};Hg.defaultProps={...ht.defaultProps,pickerName:"global-search",hidePopWhenEmpty:!0};class Ha extends ve{}Ha.NAME="GlobalSearch",Ha.Component=Hg,Ha.replace=!0;function eS(n,e=1e3){let t=null;return(...i)=>{t&&clearTimeout(t),t=setTimeout(()=>{n(...i),t=null},e)}}const Ug=class zv extends We{static async loadModule(){return this.Module||(this.Module=await y.getLib("g6")),this.Module}async afterInit(){const e=await zv.loadModule();if(this.destroyed)return;const{type:t="TreeGraph",width:i=this.$element.width(),height:s=this.$element.height()||500,responsive:r=!1,data:o,nodeFn:a,edgeFn:l,comboFn:c,...h}=this.options,u=new e[t]({container:this.element,width:i,height:s,...h});a&&u.node(a),l&&u.edge(l),c&&u.combo(c),u.data(o),u.render(),this.instance=u,r&&this.initResizeObserver()}initResizeObserver(){const e=eS(()=>{this.instance.changeSize(this.$element.width(),this.$element.height()),this.instance.render()},500);this.resizeObserver=new ResizeObserver(()=>{e()}),this.resizeObserver.observe(this.element)}destroy(){var e;this.options.responsive&&((e=this.resizeObserver)==null||e.disconnect()),this.instance.destroy(),super.destroy()}};Ug.NAME="Graph";let Wg=Ug;y.registerLib("g6",{src:"graph/g6.min.js",check:"G6"}),Wg.register();class Ar extends ve{static update(e){y.trigger("load.HistoryPanel",e)}}Ar.NAME="HistoryPanel",Ar.Component=Zu,Ar.replace=!0,Ar.register();function rh(n){const{objectType:e,objectID:t,actionID:i,url:s,...r}=n;let o=s;return!o&&(i||e&&t)&&(o=Pt("action",i?"editComment":"comment",i?`actionID=${i}`:`objectType=${e}&objectID=${t}`)),Re.open({id:`modal-comment-${i?`edit-${i}`:`${e}-${t}`}`,url:o,hideOthers:!1,...r})}y(document).on("click.zt",'[data-toggle="comment"]',n=>{n.preventDefault();const e=y(n.currentTarget);if(e.is(".disabled,:disabled"))return;const t=e.data();if(e.is("a")){const i=e.attr("href");i&&(t.url=i)}t.objectId?(t.objectID=+t.objectId,delete t.objectId):t.actionId&&(t.actionID=+t.actionId,delete t.actionId),delete t.toggle,rh(t)}),Object.assign(Re,{comment:rh});const AI="",EI="";class oh extends We{init(){this.clipWidth=this.options.defaultWidth,this.clipHeight=this.options.defaultHeight,this.initDom(),this.initSize(),this.bindEvents()}initDom(){this.$canvas=this.$element.find(".canvas"),this.$img=this.$canvas.find("img"),this.$btn=this.$element.find("button");const e=this.$img.prop("src"),{coverColor:t,coverOpacity:i}=this.options;this.$canvas.append([`<div class="cover" style="background: ${t}; opacity: ${i};"></div>`,`<div class="controller" style="width: ${this.clipWidth}px; height: ${this.clipHeight}px">`,["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"].map(s=>`<div class="control" data-type="${s}"></div>`).join(""),"</div>",'<div class="cliper">',`<img src="${e}"/>`,"</div>"].join("")),this.$controller=this.$canvas.find(".controller"),this.$cliper=this.$canvas.find(".cliper"),this.$chipImg=this.$cliper.find("img")}resetImage(e){this.$img.prop("src",e),this.$chipImg.prop("src",e),this.imgWidth=0,this.left=-1,this.initSize()}initSize(){const{minWidth:e,minHeight:t,ready:i,onSizeError:s}=this.options;if(this.imgWidth)return;const r=a=>{this.imgWidth=a.width,this.imgHeight=a.height,(a.width<e||a.height<t)&&(s==null||s({width:a.width,height:a.height}),this.options.minWidth=Math.min(a.width,e),this.options.minHeight=Math.min(a.height,t)),i==null||i(),this.width=Math.min(this.imgWidth,this.$element.width()),this.$canvas.css("width",this.width),this.height=this.$canvas.height(),(this.left===void 0||this.left<0)&&(this.left=Math.floor((this.width-this.$controller.width())/2),this.top=Math.floor((this.height-this.$controller.height())/2)),this.refreshSize()},o=this.$img[0];o.complete?r(o):o.onload=()=>{r(o)}}refreshSize(e){const{minWidth:t,minHeight:i,fixedRatio:s,defaultWidth:r,defaultHeight:o}=this.options;this.clipWidth=Math.max(t,Math.min(this.width,this.clipWidth)),this.clipHeight=Math.max(i,Math.min(this.height,this.clipHeight)),s&&(e&&e==="height"?(this.clipWidth=Math.max(t,Math.min(this.width,this.clipHeight*r/o)),this.clipHeight=this.clipWidth*o/r):(this.clipHeight=Math.max(i,Math.min(this.height,this.clipWidth*o/r)),this.clipWidth=this.clipHeight*r/o)),this.left=Math.min(this.width-this.clipWidth,Math.max(0,this.left)),this.top=Math.min(this.height-this.clipHeight,Math.max(0,this.top)),this.right=this.left+this.clipWidth,this.bottom=this.top+this.clipHeight,this.$controller.css({left:this.left,top:this.top,width:this.clipWidth,height:this.clipHeight}),this.$cliper.css("clip",`rect(${this.top}px, ${this.left+this.clipWidth}px, ${this.top+this.clipHeight}px, ${this.left}px)`)}getData(){return{originWidth:this.imgWidth,originHeight:this.imgHeight,scaleWidth:this.width,scaleHeight:this.height,width:this.right-this.left,height:this.bottom-this.top,left:this.left,top:this.top,right:this.right,bottom:this.bottom,scaled:this.imgWidth!==this.width||this.imgHeight!==this.height}}bindEvents(){this.$element.on("resize",this.initSize.bind(this)),this.$btn.on("click",e=>{var t,i;(i=(t=this.options).handleBtnClick)==null||i.call(t,e,this.getData())}),this.moveable=new rr(this.$controller,{selector:".control,.controller",move:!1,onMoveStart:()=>{this.startLeft=this.left,this.startTop=this.top,this.startClipWidth=this.clipWidth,this.startClipHeight=this.clipHeight},onMove:(e,t)=>{const i=y(t.target);if(i.is(".controller"))this.left=this.startLeft+t.deltaX,this.top=this.startTop+t.deltaY,this.refreshSize();else{const s=i.data("type");let r=!1;const{minWidth:o,minHeight:a}=this.options;switch(s){case"left":case"top-left":case"bottom-left":this.left=Math.min(this.right-o,Math.max(0,this.startLeft+t.deltaX)),this.clipWidth=this.right-this.left;break;case"right":case"top-right":case"bottom-right":this.clipWidth=Math.min(this.width-this.left,Math.max(o,this.startClipWidth+t.deltaX));break}switch(s){case"top":case"top-left":case"top-right":this.top=Math.min(this.bottom-a,Math.max(0,this.startTop+t.deltaY)),this.clipHeight=this.bottom-this.top,r=!0;break;case"bottom":case"bottom-left":case"bottom-right":this.clipHeight=Math.min(this.height-this.top,Math.max(a,this.startClipHeight+t.deltaY)),r=!0;break}this.refreshSize(r)}}})}destroy(){var e;(e=this.moveable)==null||e.destroy(),super.destroy()}}oh.NAME="ImgCutter",oh.DEFAULT={coverColor:"#000",coverOpacity:.6,defaultWidth:128,defaultHeight:128,minWidth:48,minHeight:48,fixedRatio:!0};const Li=class{static get images(){var e;return(e=this.Module)==null?void 0:e.images}static async loadModule(){return this.Module||(this.Module=await y.getLib("mammoth")),this.Module}};Li.convertToHtml=async function(n,e){const{convertToHtml:t}=await Li.loadModule();return t(n,e)},Li.extractRawText=async function(n){const{extractRawText:e}=await Li.loadModule();return e(n)},Li.embedStyleMap=async function(n,e){const{embedStyleMap:t}=await Li.loadModule();return t(n,e)};let tS=Li;y.registerLib("mammoth",{src:["mammoth/mammoth.browser.min.js"],check:"mammoth",type:"module"});const NI="";Object.assign(Kn.TypeOptions,{success:{key:"zt-messager-success",icon:"check-circle",type:"success",close:!1},danger:{icon:"exclamation-sign",type:"danger",close:!1}}),Object.assign(Kn,{success(n){return Kn.show(n,"success")},fail(n){return Kn.show(n,"danger")}}),Object.assign(Kn.DEFAULT,{time:3e3,className:"messager-lite"});const MI="";function nS(n){return Re.confirm({iconClass:"warning rounded-full center w-8 h-8 flex-none",type:"custom",custom:{className:"modal-reconfirm",closeBtn:!1},...n})}async function iS(n){const{sortable:e={},onSort:t,items:i,itemProps:s={icon:"move muted",innerClass:"border rounded px-2 canvas cursor-move hover:shadow"},list:r,header:o,message:a,footer:l,...c}=n;let h;const u=(m,v)=>{h=v,t==null||t(m,v)};if(await Re.confirm({type:"custom",content:w("div",{className:"modal-body sort-view col gap-2"},w(ge,{className:"sort-view-header",content:o}),w(ge,{className:"sort-view-message muted",content:a}),w(or,{className:"space-y-2",sortable:e,items:i,itemProps:s,onSort:u,...r}),w(ge,{className:"sort-view-footer",content:l})),...c}))return h}Ne.addLang({zh_cn:{occurredError:"发生了错误"},zh_tw:{occurredError:"發生了錯誤"},en:{occurredError:"An error occurred"}});async function sS(n){const{title:e,mono:t,html:i=!0,copyBtn:s=!0,basePath:r,contentClass:o,error:a,...l}=n;let c=typeof a=="string"?a:(a==null?void 0:a.message)??"",h=t,u=e;i&&(r&&(c=c.split(r).join('<i class="icon icon-file-text opacity-50"></i>/')),c.startsWith(`<br />
`)&&(c=c.replace(`<br />
`,"")),c.startsWith("<!DOCTYPE html")&&(h===void 0&&(h=!1),u===void 0&&(u=y(c).filter("title").text())));const p=he();return await Re.confirm({title:u??Ne.getLang("occurredError"),message:"",type:"custom",custom:{className:"backdrop-blur border-2 border-canvas bg-opacity-80 rounded-xl",headerClass:"text-danger"},content:w("div",{ref:p,className:V("modal-body",h!==!1?" font-mono":"",o),style:{whiteSpace:h!==!1?"pre-line":"normal"},dangerouslySetInnerHTML:{__html:c}}),actions:[s?{key:"confirm",text:typeof s=="string"?s:Ne.getLang("copy"),icon:"copy",onClick:()=>{const v=p.current;if(navigator.clipboard)navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([v.innerText],{type:"text/plain"}),"text/html":new Blob([v.innerHTML],{type:"text/html"})})]);else{const b=document.createRange();b.selectNode(v),window.getSelection().removeAllRanges(),window.getSelection().addRange(b),document.execCommand("copy"),window.getSelection().removeAllRanges()}}}:null,{key:"cancel",text:Ne.getLang("close")}].filter(Boolean),...l})}Object.assign(Re,{reconfirm:nS,sortView:iS,showError:sS}),Re.DEFAULT.backdrop="static",Re.DEFAULT.request={dataFilter:n=>{if(n[0]==="{")try{const e=JSON.parse(n);if(e.result)return sh(e,{closeModal:!0}),setTimeout(()=>{y(".modal").each(function(){const t=y(this);t.text().trim().length||t.modal("hide")})},200),""}catch{}return n}},mu.defaultProps.iframeBodyClass="body-modal";function Vg({pri:n="",text:e,className:t}){return n=`${n}`.trim(),e===void 0&&(e=n==="0"||n===""?"":n),w("span",{className:V(`pri-${n}`,t)},e)}let Er=class extends ht{constructor(){super(...arguments),this._handleClearBtnClick=e=>{this.setValue(""),e.preventDefault()}}getDefaultState(e){const t=super.getDefaultState(e);if(t.value===void 0&&(e||this.props).required){const i=this._getItems().shift();i&&(t.value=i.value)}return t}_getTriggerProps(e,t){const i=super._getTriggerProps(e,t);return e.disabled&&(i.className=V(i.className,"disabled")),i}_renderTrigger(e,t){var l;const{value:i}=t,{placeholder:s,required:r}=e,o=i===void 0||i==="",a=!o&&!r;return[w("div",{className:"text"},o?w("span",{class:"placeholder"},s):this._renderItem(t.value,(l=this._getItems().find(({value:c})=>c===i))==null?void 0:l.text,"pri")),a?w(xe,{type:"button",class:"btn square btn-close size-xs ghost rounded-full",onClick:this._handleClearBtnClick},w("span",{class:"close"})):null,a?null:w("span",{key:"caret",class:"caret"})]}_getItems(){let{items:e=["",1,2,3,4]}=this.props;return Array.isArray(e)?e=e.map((t,i)=>typeof t=="object"?t:t?{text:`${t}`,value:`${i}`}:{text:"",value:""}):typeof e=="object"&&(e=Object.keys(e).map(t=>({value:t,text:e[t]}))),e=e.filter(({value:t})=>t!==""),e.sort((t,i)=>+t.value-+i.value),e}_renderItem(e,t,i){return w(Vg,{key:i,pri:e,text:t})}_renderPop(){const{value:e}=this.state;return w("div",{className:"pick-pri-list"},this._getItems().map(({value:t,text:i})=>w("button",{key:t,type:"button",class:`btn w-full ${e===t?"primary-pale":"ghost"}`,"data-pick-value":t},this._renderItem(t,i))))}};Er.defaultProps={...ht.defaultProps,items:["",1,2,3,4],className:"pick-pri form-control",popClass:"pick-pri-pop popup",popWidth:"auto",popMinWidth:56};function Kg({severity:n="",text:e,className:t}){n=`${n}`.trim(),e===void 0&&(e=n==="0"||n===""?"":n);const i=`${+e}`!=`${n}`;return w("span",{className:V(`severity${i?" severity-label":""}`,t),"data-severity":n},i?e:"")}let ah=class extends Er{_renderItem(e,t,i){return w(Kg,{key:i,severity:e,text:t})}};ah.defaultProps={...Er.defaultProps,items:["",1,2,3,4]};class lh extends ve{}lh.NAME="PriPicker",lh.Component=Er;class ch extends ve{}ch.NAME="SeverityPicker",ch.Component=ah;const PI="",LI="";let uh=class extends Ke{constructor(e){super(e),this._syncPickerData=()=>{const o=this.getFormData();y(this.element).find(".pick-value[name]").each((a,l)=>{const c=y(l),h=c.attr("name").split("[")[0],u=o[h];c.trigger("syncValue",{setValue:u})})},this._handleDeleteQueryClick=(o,a)=>{a.stopPropagation(),this.deleteQuery(o)},this._handleChange=o=>{const a=y(o.target);let l=a.attr("name");if(!l)return;l.endsWith("]")&&(l=l.split("[")[0]);let c=a.val();Array.isArray(c)&&(c=c.join(",")),this.changeData(l,c)},this._handleSubmit=o=>{o.preventDefault(),this.submit()};const{setting:t,preserve:i,module:s}=e;let r;i&&(r=`SearchForm:${typeof i=="string"?i:s}:more`,this._preserveKey=r),this.state={showQueryPanel:!1,setting:t&&t.conditions?t:void 0,more:r?Xe.get(r):void 0},this.submit=this.submit.bind(this),this.reset=this.reset.bind(this)}get showMore(){var e;return this.state.more??((e=this.state.setting)==null?void 0:e.more)}get isShow(){return this.state.show??this.props.show}get loaded(){return!!this.state.setting}get groupItemCount(){var e;return((e=this.state.setting)==null?void 0:e.groupItemCount)||3}componentDidMount(){this.props.show&&this.show(),y.on("update.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.load(t.reset??!0)}),y.on("addQuery.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.addQuery(t.id,t.text)})}componentDidUpdate(e,t){const{container:i}=this.props;if(i){const s=y(i),{show:r,more:o}=this.state,a=r!==t.show,l=o!==t.more;a&&s.toggleClass("show-search-form",r),(a||l)&&s.trigger("layout.SearchForm.zt",this),l&&this._preserveKey&&Xe.set(this._preserveKey,o)}}componentWillUnmount(){y.off(".SearchForm.zt")}async load(e){if(this.state.loading)return;await this.changeState({loading:!0,...e?{data:void 0}:null});const t=this.props.url||Pt("search","buildForm",`module=${this.props.module}`);try{const i=await _t(t);await this.changeState({setting:i,loading:!1,clickedReset:!1})}catch{await this.changeState({loading:!1,clickedReset:!1})}e&&this._syncPickerData()}async show(){await this.changeState({show:!0}),this.loaded||await this.load()}toggleQueryPanel(e){return e===void 0&&(e=!this.state.showQueryPanel),this.changeState({showQueryPanel:e})}toggle(e){return e===void 0&&(e=!this.isShow),e?this.show():this.hide()}toggleMore(e){return e===void 0&&(e=!this.showMore),this.changeState({more:e})}hide(){return this.changeState({show:!1})}getFormData(e){var s;e=e||this.state.setting;const t={groupAndOr:"or"},i=this.groupItemCount*2;for(let r=1;r<=i;r++)t[`field${r}`]=((s=this._conditionList[r-1])==null?void 0:s.value)??"",t[`operator${r}`]="=",t[`value${r}`]="",t[`andOr${r}`]="and";return{...t,...e.defaultData,...this.state.data}}getSubmitData(){const e=this._data;return{module:this.props.module,actionURL:this.state.setting.actionURL,groupItems:this.groupItemCount,formType:this.showMore?"more":"lite",...e}}submit(){var i;let e=this.getSubmitData();if(!e)return;const t=(i=this.props.beforeSearch)==null?void 0:i.call(this,e);t!==!1&&(t&&(e=t),Pi({url:this.props.searchUrl||Pt("search","buildQuery"),data:e,onSuccess:s=>{var r;return((r=this.props.onSearch)==null?void 0:r.call(this,s))===!1||this._handleSearch(y.extend({success:()=>this.load()},typeof s.load=="string"?{url:s.load}:s.load)),!1}}))}reset(){return this.changeState(e=>{const t=new Array(this.groupItemCount*2).fill(0).reduce((i,s,r)=>(i[`value${r+1}`]="",i),{});return{clickedReset:!0,data:{...e.data,...t}}},this._syncPickerData)}applyQuery(e){var s;const{actionURL:t}=this.state.setting,i=t.replace("myQueryID",String(e));((s=this.props.onSearch)==null?void 0:s.call(this,{result:"success",load:i}))!==!1&&this._handleSearch({url:i,success:()=>this.load(!0)})}deleteQuery(e,t){const{deleteQueryConfirm:i,canDeleteQuery:s}=this.state.setting;if(!t&&i){Re.confirm(i).then(o=>{o&&this.deleteQuery(e,!0)});return}const r=typeof s=="string"?s.replace("{id}",`${e}`):Pt("search","deleteQuery",`queryID=${e}`);Pi({url:r,onSuccess:()=>{const o=this.state.setting,{savedQueryList:a=[]}=o;return this.changeState({setting:{...o,savedQueryList:a.filter(l=>l.id!==e)}}),!1}})}addQuery(e,t){const i=this.state.setting,{savedQueryList:s=[]}=i;s.some(r=>r.id===e)||this.changeState({showQueryPanel:!0,setting:{...i,savedQueryList:[{id:e,text:t},...s]}})}changeData(e,t){const i={[e]:t};if(e.startsWith("field")){const s=t,r=+e.substring(5),{defaultOperator:o,defaultValue:a=""}=this._conditionMap[s];o&&(i[`operator${r}`]=o),i[`value${r}`]=a}else if(e.startsWith("value")){const s=this.getFormData(),r=+e.substring(5),o=s[`field${r}`],{control:a}=this._conditionMap[o];if(a==="date"){const l=t.startsWith("$"),c=s[`operator${r}`];l&&c!=="between"?i[`operator${r}`]="between":!l&&c==="between"&&(i[`operator${r}`]="<=")}}this.changeState(s=>({data:{...s.data,...i}}),this._syncPickerData)}_handleSearch(e){const t=this.element.closest(".modal");let{searchLoader:i=t?{load:"modal",target:t}:"table"}=this.props;const s=y(this.element);let r=s.closest(".tab-pane");typeof i=="string"?(i={load:i},r.length||(r=s.closest("#main"))):t&&(r.length||(r=y(t)));const o=r.find("[data-zui-dtable]");return o.length&&(i.load="table",i.target=o.children(".dtable").attr("id")),typeof e=="string"?i.url=e:typeof e=="object"&&(i={...i,...e}),y.trigger("locate.zt",i),!1}_renderOperators(e,t){var s;const i=this._operatorList;return w(nn,{name:e,items:i,required:!0,defaultValue:t??((s=i[0])==null?void 0:s.value),search:!1,maxItemsCount:0})}_renderControl(e,t,i,s){const r=this._conditionMap[e]||{},{control:o="text"}=r,{controlRenders:a}=this.constructor,l=a[o]||a.text;return o==="date"&&r.datePeriods===void 0&&s.datePeriods&&(r.datePeriods=s.datePeriods),l.call(this,r,t,i??"")}_renderField(e,t,i,s,r){var h;const{conditions:o}=s,a=t*i+e+1,l=!e;this._conditionList||(this._conditionList=o.map(({text:u,name:p})=>({text:u??p,value:p})));const c=r[`field${a}`]??((h=o[a])==null?void 0:h.name);return w("tr",{key:a,className:"search-form-field"},w("td",{className:V("is-andOr",l?"font-bold text-right nowrap":void 0)},l?(s.groupTitles||[])[t]:this._renderAndOrSelect(`andOr${a}`,r[`andOr${a}`],s)),w("td",{className:"is-condition"},w(nn,{name:`field${a}`,items:this._conditionList,required:!0,defaultValue:c,popMinWidth:"100%",popWidth:"auto",maxItemsCount:0})),w("td",{className:"is-operator"},this._renderOperators(`operator${a}`,r[`operator${a}`])),w("td",{className:"is-control",key:`${c}:${a}`},this._renderControl(c,`value${a}`,r[`value${a}`],s)))}_renderGroup(e,t,i){const{groupItemCount:s}=this,{showMore:r}=this,o=[],a=r?s:1;for(let l=0;l<a;l++)o.push(this._renderField(l,e,s,t,i));return w("div",{className:"search-form-group flex-1",key:e},w("table",{className:"table-fixed w-full"},w("tbody",null,o)))}_renderAndOrSelect(e,t,i){const{andText:s="And",orText:r="Or"}=i;return w(nn,{name:e,items:[{value:"and",text:s},{value:"or",text:r}],defaultValue:t,required:!0,search:!1})}_renderForm(e,t){this._conditionMap={},this._conditionList=e.conditions.map(u=>{const{name:p,text:m}=u;return this._conditionMap[p]=u,{text:m??p,value:p}});const{showMore:i}=this;this._operatorList=(e.operators||"=,!=,>,>=,<,<=".split(",")).map(u=>typeof u=="string"?{text:u,value:u}:u);const s=this.getFormData(e);this._data=s;const{searchBtnText:r="Search",resetBtnText:o="Reset",saveQueryBtnText:a="Save",canSaveQuery:l}=e,{simple:c,noMore:h}=t;return w("form",{key:"form",className:"search-form-wrapper flex-auto py-3 px-2",onSubmit:this._handleSubmit},w("div",{className:"row items-center",onChange:this._handleChange},this._renderGroup(0,e,s),w("div",{className:"col flex-none items-center justify-center px-4 w-24"},this._renderAndOrSelect("groupAndOr",s.groupAndOr,e)),this._renderGroup(1,e,s)),w("div",{className:`toolbar gap-4 justify-center flex-nowrap ${c?"ml-4":"mt-3"}`},w(xe,{key:"submit",type:"primary",btnType:"submit"},r),c?null:w(xe,{key:"reset",onClick:this.reset},o),c&&h?null:w("div",{className:c?"":"absolute top-0 right-0"},c?null:w(xe,{key:"saveQuery",type:"ghost",className:"text-primary","data-toggle":"modal",disabled:!l||this.state.clickedReset,url:l?typeof l=="string"?l:Pt("search","saveQuery",`module=${t.module}`):void 0,"data-title":a},a),h?null:w(xe,{key:"toggle",type:"ghost",className:"text-primary",icon:i?"chevron-double-up":"chevron-double-down",onClick:this.toggleMore.bind(this,void 0)}))))}_renderQueryPanel(e,t){const{savedQueryList:i=[],saveQueryPanelWidth:s=200,saveQueryPanelTitle:r="Saved queries",canDeleteQuery:o}=t;return w("div",{key:"panel",className:V("search-form-query sidebar sidebar-right pt-3 transition-none",e?"is-expanded":"is-collapsed"),style:{minHeight:100,width:e?Ge(s):0,transition:"none"}},w("div",{class:"sidebar-gutter gutter gutter-border gutter-horz border-default",onClick:this.toggleQueryPanel.bind(this,void 0)},w("button",{class:"gutter-toggle",type:"button"},w("span",{class:"chevron-right"}))),e?w("div",{className:"search-form-query-panel pl-3 h-full col"},w("div",{className:"search-form-query-title font-bold mb-1.5 flex-none"},r),w("ul",{className:"search-form-query-list col items-start gap-1 overflow-auto scrollbar-hover pr-3 pb-2 pt-px pl-0"},i.map(({id:a,text:l,noDelete:c})=>w("li",{key:a,className:`search-form-query-item label gray-pale rounded-full state pl-2 hover:text-primary hover:primary-pale inline-flex gap-1 max-w-full ${o&&!c?"pr-0":"pr-2"}`,onClick:this.applyQuery.bind(this,a)},w("span",{className:"min-w-0 flex-auto overflow-hidden nowrap"},l),o&&!c?w(xe,{type:"ghost",className:"size-xs rounded-full flex-none"},w("i",{className:"close",onClick:this._handleDeleteQueryClick.bind(this,a)})):null)))):null)}_getProps(e){return{...super._getProps(e),"data-module":e.module}}_getClassName(e){const t=super._getClassName(e);if(!this.isShow)return[t,"search-form","hidden"];const{setting:i,showQueryPanel:s}=this.state,{showMore:r}=this,o=i==null?void 0:i.savedQueryList;return[t,"search-form",i?"is-loaded":"is-empty",{"is-lite":!r,"is-more":r,"is-simple":e.simple,"show-save-query":o&&s}]}_getChildren(e){if(!this.isShow)return null;const{setting:t,showQueryPanel:i,loading:s}=this.state,r=!e.simple&&t&&t.savedQueryList;return w("div",{className:V(`search-form-container row gap-3 load-indicator${s?" loading":""}`,e.innerClass),style:`max-height: ${76+44*(this.showMore?this.groupItemCount:1)}px`},t?this._renderForm(t,e):null,r?this._renderQueryPanel(i,t):null)}};uh.controlRenders={text:(n,e,t)=>w("input",{className:"form-control",type:"text",name:e,value:t,placeholder:n.placeholder,...n.controlProps}),select:(n,e,t)=>{const{items:i=[]}=n;return w(nn,{name:e,items:i,defaultValue:t,placeholder:n.placeholder,popMinWidth:"100%",popWidth:"auto",maxItemsCount:0,...n.controlProps})},date:(n,e,t)=>{const{datePeriods:i}=n,s={};return i&&(s.menu=[...i],s.allowInvalid=!0,s.display=r=>{const o=i.find(a=>a.value===r);return o?o.text:r}),w(vs,{name:e,defaultValue:t,placeholder:n.placeholder,...s,...n.controlProps})},time:(n,e,t)=>w(da,{name:e,defaultValue:t,placeholder:n.placeholder,...n.controlProps}),datetime:(n,e,t)=>w(fu,{name:e,defaultValue:t,placeholder:n.placeholder,...n.controlProps})},uh.defaultProps={preserve:!0};class Gt extends ve{}Gt.NAME="SearchForm",Gt.Component=uh,Gt.replace=!0,Gt.toggleForm=hh,Gt.update=qg,Gt.addQuery=Gg,Gt.toggle={convertHref:!0,getOptions(n,e){const t=y(n);if(t.is("a")){const i=t.attr("href");i&&(!e.target&&"#.".includes(i[0])?e.target=i:e.url||(e.url=i))}return e},handler(n,e){hh({container:y(n).closest(e.container||".modal,#main"),...e})}},Gt.register();function hh(n){typeof n=="string"?n={module:n}:n||(n={module:window.config.currentModule});const e=y(n.container||".modal,#main").first();if(!e.length)return;n.module||(n.module=window.config.currentModule);let t;if(n.target?t=y(n.target,e):(t=e.find(`[${Gt.DATA_KEY}],.search-form`),n.module&&(t=t.filter(`[data-module="${n.module}"]`))),!t.length){let s=e.closest(".modal").find(".modal-body");s.length||(s=e.find(".main-content-cell")),s.length||(s=e.find("#mainContent")),t=y("<div/>").attr({"zui-key":"searchForm","data-module":n.module}).prependTo(s.length?s.first():e)}let i=t.zui(Gt.NAME);return i?i.$.toggle(n.show):i=new Gt(t,{container:e,show:!0,...n}),i}function qg(n,e){y.trigger("update.SearchForm.zt",{module:n,reset:e})}function Gg(n){y.trigger("addQuery.SearchForm.zt",n)}const RI="";class Ua extends ve{}Ua.NAME="UserAvatar",Ua.Component=Dr,Ua.register();const rS={1:"error",2:"warning",4:"parse",8:"notice",16:"core-error",32:"core-warning",64:"compile-error",128:"compile-warning",256:"user-error",512:"user-warning",1024:"user-notice",2048:"strict",4096:"recoverable-error",8192:"deprecated",16384:"user-deprecated",32767:"all"};function Yg(n){return typeof n=="number"&&(n=rS[n]),n}function Xg(n){return n=Yg(n),n.includes("error")?"error":n.includes("warning")?"warning":"info"}function oS({errors:n,...e}){const t=n.reduce((i,s)=>(i[Xg(s.level)]++,i),{error:0,warning:0,info:0});return w("div",{class:"row items-stretch text-sm","data-hint":"PHP errors",...e},t.error?w("button",{type:"button",class:"state font-bold px-0.5 danger"},w("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"ERR"),t.error):null,t.warning?w("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-90"},w("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"WAR"),t.warning):null,t.info?w("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-80"},w("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"INF"),t.info):null)}function Wt(n,e,t,i){console.groupCollapsed(`%c${n} %c${e}`,"color: #fff; background-color: #9333ea; padding: 0 0.1em 0 0.25em; border-radius: 0.25em 0 0 0.25em;","color: #9333ea; background-color: #e9d5ff; padding: 0 0.5em; border-radius: 0 0.25em 0.25em 0;",i),console.table(t),console.groupEnd()}function ei(n,e=400,t=100){return n<t?"success":n<e?"warning":"danger"}function on(n){return n<1e3?`${n.toFixed(0)}ms`:`${(n/1e3).toFixed(2)}s`}function Qg({perf:n,guardState:e,guardData:t}){var l;const i=n.id==="page"?"页面":n.id==="#dtable"?"表格":"部分",s=[],{trace:r,xhprof:o}=n,a=r==null?void 0:r.request;if(e){const c=e==="sending"?"发送中":e==="error"?"发送失败，点击查看":"已发送",h=e==="sending"?"text-warning":e==="error"?"text-danger":"text-success",u=t?`${t.request.module}-${t.request.method}#${t.requestId}`:"",p=Wt.bind(null,"Perf Guard Data",e===!0?"sended":e||"null",t,t==null?void 0:t.requestId);s.push(w("div",{onClick:p,class:`px-0.5 state ${h}`,"data-hint":`性能门禁数据${t?`（${u}）`:""}：${c}`},w("i",{class:e==="sending"?"icon icon-spinner-indicator spin":e===!0?"icon-shield-check":"icon-shield"})),w("div",{class:"muted"},"/"))}if(n.requestEnd){n.clientCache&&s.push(w("div",{class:"px-0.5 state text-success","data-hint":`使用本地缓存渲染：${n.clientCache}`},w("i",{class:"icon-check-circle"})),w("div",{class:"muted"},"/"));const c=n.requestEnd-n.requestBegin;if(s.push(w("div",{class:`px-0.5 state text-${ei(c,500,300)}`,"data-hint":"总加载时间 (好<300ms≤正常<500ms≤差)",onClick:Wt.bind(null,"Trace","Perf",n,n.id)},w("i",{class:"icon-history"})," ",on(c))),a){const u=a.timeUsed;s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${ei(u)}`,"data-hint":"服务器耗时 (好<300≤正常<500≤差)",onClick:Wt.bind(null,"Trace","Request",a,n.id)},w("span",{class:"scale-95 font-bold inline-block"},"S"),on(u)))}if(n.dataSize){if(a){const u=c-a.timeUsed;s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${ei(u,600,200)}`,"data-hint":"网络用时 (好<200≤正常<600≤差)",onClick:Wt.bind(null,"Trace","Request",a,n.id)},w("span",{class:"scale-95 font-bold inline-block"},"N"),on(u)))}if(s.push(w("div",{class:"px-0.5 state","data-hint":"下载大小",onClick:Wt.bind(null,"Trace","Perf",n,n.id)},w("span",{class:"muted"},w("i",{class:"icon icon-cube"})," ",vt(n.dataSize,1)))),a){const u=c-a.timeUsed,p=1e3*n.dataSize/u;s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${p<102400?"danger":p<1024e3?"warning":"success"}`,"data-hint":"下载速度(B<100KB≤正常<1MB≤G)",onClick:Wt.bind(null,"Trace","Request",a,n.id)},w("i",{class:"icon icon-arrow-down"}),vt(p,1),"/s"))}}if(n.renderEnd&&n.renderBegin){const u=n.renderEnd-n.renderBegin,p=ei(u,200,50);s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${p}`,"data-hint":"浏览器渲染用时 (好<50≤正常<200≤差)",onClick:Wt.bind(null,"Trace","Perf",n,n.id)},w("i",{class:`icon-${p==="danger"?"frown":p==="warning"?"meh":"smile"}`}),on(u)))}if(a){const{memory:u,querys:p}=a;typeof u=="number"&&s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${ei(u*1024,1024e3,102400)}`,"data-hint":"服务器内存占用 (好<10KB≤正常<100KB≤差)",onClick:Wt.bind(null,"Trace","Request",a,n.id)},w("span",{class:"scale-95 font-bold inline-block"},"M"),vt(u*1024))),typeof p=="number"&&s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${ei(p,30,10)}`,"data-hint":"SQL执行次数 (好<30≤正常<10≤差)",onClick:Wt.bind(null,"SQL Query",`${((l=r.sqlQuery)==null?void 0:l.length)??0} queries`,r.sqlQuery,n.id)},w("span",{class:"scale-95 font-bold inline-block"},"Q"),p))}r!=null&&r.files&&s.push(w("div",{class:"muted"},"/"),w("div",{class:"px-0.5 state","data-hint":"服务器加载PHP文件数目",onClick:Wt.bind(null,"Trace",`${r.files.length} php files`,r.files,n.id)},w("span",{class:"muted"},w("i",{class:"icon-file icon-sm scale-75"}),r.files.length)));const h=r==null?void 0:r.profiles;if(h!=null&&h.length){let u=0,p={Duration:0};if(h.forEach(m=>{m.Duration>.3&&u++,m.Duration>p.Duration&&(p=m)}),s.push(w("div",{class:`px-0.5 state text-${ei(u,3,1)}`,"data-hint":"服务器最慢SQL数 (好<3≤正常<1≤差)",onClick:Wt.bind(null,"SQL Query",`${h.length} SQL profiles`,h,n.id)},w("span",{class:"scale-95 font-bold inline-block"},"LQ"),u)),p.Duration){const m=p.Duration*1e3;s.push(w("div",{class:`px-0.5 state text-${ei(m,600,300)}`,"data-hint":"服务器最慢SQL耗时 (好<600≤正常<300≤差)",onClick:Wt.bind(null,"SQL Query",`Slowest SQL query: ${m}ms`,p,n.id)},w("span",{class:"scale-95 font-bold inline-block"},"MLQ"),on(m)))}}}else s.push(w("div",{class:"muted px-0.5"},"loading..."));return w("div",{class:"zin-perf-btn-list row items-center bg-black text-sm"},w("div",{class:"px-1 bg-canvas bg-opacity-20 self-stretch flex items-center","data-hint":`请求 ${n.id} URL: ${n.url}`},w("span",{class:"muted"},i)),s,o?w("a",{class:"state text-secondary px-0.5",href:o,target:"_blank","data-hint":"打开 xhprof 报告"},"XHP"):null)}function aS(n){Wt("Trace","Error",n,n.message),navigator.clipboard.writeText(`vim +${n.line} ${n.file}`)}function lS({errors:n=[],show:e,basePath:t}){n.length||(e=!1);const i=n.map(s=>{const r=Yg(s.level),o=Xg(r),a=o==="error"?"danger":o==="info"?"important":"warning";return w("div",{class:`zin-error-item state ${a}-pale text-fore px-2 py-1 ring ring-darker`,onClick:aS.bind(null,s)},w("div",{class:"zin-error-msg font-bold text-base"},w("strong",{class:`text-${a}`,style:"text-transform: uppercase;"},r)," ",s.message),w("div",{class:"zin-error-info text-sm opacity-60 break-all"},w("strong",null,"vim +",s.line)," ",w("span",{className:"underline"},t?s.file.substring(t.length):s.file)))});return w("div",{class:`zin-errors-panel canvas absolute bottom-full left-0 mono shadow-xl ring rounded fade-from-bottom ${e?"in":"events-none"}`},i)}const OI="";function cS(){const n=navigator.userAgent;let e="Unknown",t="Unknown";return n.indexOf("Chrome")>-1?(e="Chrome",t=n.substring(n.indexOf("Chrome")+7)):n.indexOf("Firefox")>-1?(e="Firefox",t=n.substring(n.indexOf("Firefox")+8)):n.indexOf("Safari")>-1?(e="Safari",t=n.substring(n.indexOf("Safari")+7),n.indexOf("Version")>-1&&(t=n.substring(n.indexOf("Version")+8))):window.StyleMedia&&(e="Edge",t=n.substring(n.indexOf("Edge")+5)),t=t.split(" ")[0],t=t.split(";")[0],t=t.split(")")[0],{name:e,version:t}}let uS=class extends me{constructor(e){var t,i;super(e),this._timer=0,this._browser=cS(),this._guardData={},this.state={showPanel:e.defaultShow??!0,showZinbar:!!((i=(t=e.defaultData)==null?void 0:t.errors)!=null&&i.length||!Xe.get("Zinbar:hidden")),...e.defaultData},this.togglePanel=this.togglePanel.bind(this),this.sendGuardData=this.sendGuardData.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this)}componentDidMount(){document.addEventListener("click",this.handleClickOutside)}componentDidUpdate(){var o,a,l,c;const{pagePerf:e}=this.state;let t="",i="";const s=(a=(o=e==null?void 0:e.trace)==null?void 0:o.sqlQuery)==null?void 0:a.length,r=(c=(l=e==null?void 0:e.trace)==null?void 0:l.request)==null?void 0:c.timeUsed;if(r&&e.renderEnd){const h=e.renderEnd-e.renderBegin,u=r+h,p=[];let m="",v="";u>=500?(m="danger",p.push(`处理时间${on(u)}超过500ms（后端${on(r)}，前端${on(h)}）`)):u>=300&&(m="warning",p.push(`处理时间${on(u)}超过300ms（后端${on(r)}，前端${on(h)}）`)),s&&(s>=60?(v="danger",p.push(`SQL查询超过60次（实际${s}）`)):s>=40&&(v="warning",p.push(`SQL查询超过40次（实际${s}）`))),(m||v)&&(t=m==="danger"||v==="danger"?"danger":"warning",i=[t==="danger"?"页面有性能问题":"页面有优化空间",...p].join("，"))}y("body").z({perf:t,perfMessage:i})}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}handleClickOutside(e){const t=e.target;this.state.showPanel&&!t.closest(".zinbar")&&this.setState({showPanel:!1})}async sendGuardData(e=180){var m,v,b;const{guardApi:t}=this.props;if(!t)return;this._timer&&clearTimeout(this._timer);const{pagePerf:i}=this.state;if(!(i!=null&&i.renderEnd))return;if(e){this._timer=window.setTimeout(()=>{this.sendGuardData(0)},e);return}const s=bg(i.url);if(!(s!=null&&s.moduleName))return;this.setState({guardState:"sending"});const{author:r="anonymous",email:o,host:a=location.origin}=this.props,{profiles:l=[],sqlQuery:c=[],request:h}=i.trace||{};l.forEach(C=>{C.DurationOriginal||(C.DurationOriginal=C.Duration,C.Duration=1e3*C.Duration)});const u=c.findIndex(C=>C.includes("SET profiling = ")),p=u>=0?c.length-u-1:c.length;this._guardData={timestamp:Date.now(),identifier:r,email:o,requestId:Ei(),dataVer:3,request:{host:a,url:/https?:/.test(i.url)?i.url:`${a}${i.url}`,module:s.moduleName,method:s.methodName,xhprof:i.xhprof?/https?:/.test(i.xhprof)?i.xhprof:`${a}${i.xhprof}`:null,php:h==null?void 0:h.php,errorCount:((m=this.state.errors)==null?void 0:m.length)||0,errors:this.state.errors??[]},userEnv:{system:navigator.userAgentData?navigator.userAgentData.platform:navigator.platform,userAgent:navigator.userAgent,browser:[this._browser.name,this._browser.version].join(" ")},metrics:{frontend:{renderTime:Math.round(i.renderEnd-i.renderBegin),downloadSize:i.dataSize},backend:{totalTime:h==null?void 0:h.timeUsed,sqlTime:l.reduce((C,S)=>C+S.Duration,0),sqlCount:Math.max(l.length||0,p),sqlDetails:l,phpFileLoaded:((v=i.trace)==null?void 0:v.files.length)||0,phpFiles:(b=i.trace)==null?void 0:b.files,requestMemory:h==null?void 0:h.memory}}};try{const C=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._guardData),mode:"no-cors"});this._guardData.$response=await C.text(),this.setState({guardState:!0})}catch(C){this._guardData.$error=C,console.error("[ZUI] Send guard data failed:",C,this),this.setState({guardState:"error"})}}update(e,t,i){this.setState(s=>{const r=!(e!=null&&e.id)||e.id==="page",o={};return r?(e&&(o.pagePerf={...s.pagePerf,...e}),t&&(o.errors=t),e!=null&&e.requestEnd||(o.guardState=!1)):(e&&(o.partPerf={...s.partPerf,...e}),t&&(o.errors=[...s.errors??[],...t??[]])),i&&(o.basePath=i),o},this.props.guardApi?this.sendGuardData:void 0)}togglePanel(){this.setState({showPanel:!this.state.showPanel})}toggleZinbar(){const e=!this.state.showZinbar;this.setState({showZinbar:e},()=>{Xe.set("Zinbar:hidden",!e)})}render(){const{errors:e,pagePerf:t,partPerf:i,showZinbar:s,basePath:r,guardState:o}=this.state,{fixed:a}=this.props,l=e==null?void 0:e.length;return w("div",{className:V("zinbar row h-5 items-stretch gap-px inverse bg-opacity-50",a?"relative":"fixed right-0 bottom-0",{collapse:!s}),style:{zIndex:9999}},w("button",{type:"button","data-hint":s?"折叠":"展开",className:`w-4 ${l&&!s?"danger":"bg-inverse"} flex items-center justify-center`,style:{marginLeft:-15},onClick:this.toggleZinbar.bind(this)},w("span",{class:s?"caret-right":"caret-left"})),l?w(oS,{errors:e,onClick:this.togglePanel}):null,t?w(Qg,{perf:t,guardState:o,guardData:this._guardData}):null,i?w(Qg,{perf:i}):null,w(lS,{show:this.state.showPanel,basePath:r,errors:e}))}};class dh extends ve{}dh.NAME="Zinbar",dh.Component=uS;let Jg=class extends Ke{_renderContent(e){const{subtitle:t,subtitleClass:i,content:s,contentClass:r}=e;if(!(!t&&!s))return[k("div",{className:V("card-content",r),children:[t?k("div",{className:V("card-subtitle",i),children:k(ge,{content:t})},"subtitle"):null,s?k(ge,{content:s},"extraContent"):null]},"content")]}_renderHeading(e){const{icon:t,prefix:i,prefixClass:s,title:r,titleClass:o,titleUrl:a,titleAttrs:l,suffix:c,suffixClass:h,heading:u,headingClass:p}=e;if(!t&&!i&&!r&&!c&&!u)return;const m=a?"a":"span";return k("div",{className:V("card-heading",p),children:[t?k($e,{className:"card-icon",icon:t},"icon"):null,i?k(ge,{className:V("card-prefix",s),content:i},"prefix"):null,r?k(m,{className:V("card-title",o),href:a,...l,children:k(ge,{content:r})},"title"):null,c?k(ge,{className:V("card-suffix",h),content:c},"suffix"):null,u?k(ge,{content:u},"extraHeading"):null]})}_renderHeader(e){const{header:t,headerClass:i}=e;if(t)return k("div",{className:V("card-header",i),children:k(ge,{content:t},"header")})}_renderFooter(e){const{footer:t,footerClass:i,footActions:s}=e;if(t||s)return k("div",{className:V("card-footer",i),children:[k(ge,{content:t},"footer"),Be.render(s,[e],{key:"foot-actions",relativeTarget:e,className:"card-foot-actions",size:"sm"},this)]})}_renderActions(e){return Be.render(e.actions,[e],{key:"actions",relativeTarget:e,className:"card-actions",size:"sm"},this)}_renderList(e){const{items:t}=e;if(!t)return;const i=ke({key:"list",className:"card-list"},typeof t=="object"?t:{items:t});return k(gt,{...i})}_renderAvatar(e){const{avatar:t}=e;if(t){const i=typeof t=="function"?t.call(this,e):t;if(i)return i.className=V("item-avatar",i.className),k(ss,{...i},"avatar")}}_getClassName(e){return["card",e.className,e.selected?"selected":""]}_getChildren(e){return[this._renderActions(e),this._renderHeader(e),this._renderAvatar(e),this._renderHeading(e),this._renderContent(e),this._renderList(e),this._renderFooter(e),e.children]}};class Zg extends Jg{_getClassName(e){return e.className}_getChildren(e){const{innerAttrs:t,innerClass:i,selected:s,innerComponent:r="div"}=e,o=ke({className:V("card",i,s?"selected":"")},t);return k(r,{...o,children:super._getChildren(e)})}}let $s=class extends gt{_getClassName(e){return[super._getClassName(e),e.countPerRow?"card-grid":""]}_getProps(e){const{gap:t,countPerRow:i}=e;return ke({style:{"--list-gap":t?Ge(t):void 0,"--list-count-per-row":i}},super._getProps(e))}_getRenderedItem(e,t){return t}};$s.NAME="card-list",$s.TAG="div",$s.ItemComponents={...gt.ItemComponents,default:Zg,item:Zg},$s.defaultItemProps={component:"div"};class Wa extends ve{}Wa.NAME="Card",Wa.Component=Jg,Wa.replace=!0;class fh extends ve{}fh.NAME="CardList",fh.Component=$s;const FI="",zI="";class As extends gn{_getLayoutOptions(){const e=super._getLayoutOptions();return this.options.element||(e[0]={getBoundingClientRect:this._getClickBounding}),e}}As.NAME="ContextMenu",As.DEFAULT={...gn.DEFAULT,name:"contextmenu",trigger:"contextmenu"},As.register();const jI="",BI="";function hS(n){const{left:e,className:t,top:i,id:s,onMenuBtnClick:r,title:o,width:a,height:l,content:c,loading:h,draggable:u=!0}=n;return k("div",{class:"dashboard-block-cell",style:{left:e,top:i,width:a,height:l},children:k("div",{className:V("dashboard-block load-indicator",h&&!c?"loading":"",r?"has-more-menu":"",t),draggable:u,"data-id":s,children:[k("div",{class:"dashboard-block-header",children:[k("div",{class:"dashboard-block-title",children:o}),r?k("div",{class:"dashboard-block-actions toolbar",children:k("button",{class:"toolbar-item dashboard-block-action btn square ghost rounded size-sm","data-type":"more",onClick:r,children:k("div",{class:"more-vert"})})}):null]}),y.isPlainObject(c)&&c.html?k(Dn,{className:"dashboard-block-body",executeScript:!0,...c}):k("div",{class:"dashboard-block-body",children:c})]})})}const HI="",UI="",ph=([n,e,t,i],[s,r,o,a])=>!(n+t<=s||s+o<=n||e+i<=r||r+a<=e),ey=(n,e)=>n[1]===e[1]?n[0]-e[0]:n[1]-e[1],Va="Dashboard:Block.cache:";let ty=class extends me{constructor(e){super(e),this._ref=he(),this._loadTimer=0,this._map=new Map,this._oldMap=new Map,this.tryLoadNext=()=>{clearTimeout(this._loadTimer),this._loadTimer=window.setTimeout(()=>this.loadNext(),100)},this._checkLayout=()=>{const{onLayoutChange:t}=this.props;if(!t)return;const{blocks:i}=this.state,s={};let r=!1;i.forEach(o=>{const[a,l,c,h]=this._map.get(o.id),u=this._oldMap.get(o.id);(!u||u[0]!==a||u[1]!==l||u[2]!==c||u[3]!==h)&&(r=!0,s[o.id]={left:a,top:l,width:c,height:h},this._oldMap.set(o.id,[a,l,c,h]))}),r&&t(s)},this._handleMenuClick=t=>{const i=t.target.closest(".dashboard-block");if(!i)return;const s=i.dataset.id;if(!s)return;const r=this.getBlock(s);if(!r||!r.menu)return;const{menu:o}=r,{onClickMenu:a}=this.props;As.show({triggerEvent:t,element:t.currentTarget,placement:"bottom-end",menu:{onClickItem:l=>{var c;((c=l.item.data)==null?void 0:c.type)==="refresh"&&this.load(s),a&&a.call(this,l,r)},...o}})},this.state={blocks:this._initBlocks(e.blocks)}}getBlock(e){return this.state.blocks.find(t=>t.id===e)}update(e,t){const{id:i}=e,{blocks:s}=this.state,r=s.findIndex(a=>a.id===i);if(r<0)return;const o=s[r];e.fetch&&e.fetch!==o.fetch&&e.needLoad===void 0&&(e.needLoad=!0),s[r]={...o,...e},this.setState({blocks:s},t)}delete(e){const{blocks:t}=this.state,i=t.findIndex(s=>s.id===e);i<0||(t.splice(i,1),this.setState({blocks:t}))}add(e){e=Array.isArray(e)?e:[e],this.setState({blocks:[...this.state.blocks,...this._initBlocks(e)]})}load(e,t){const i=this.getBlock(e);!i||i.loading||(t=t||i.fetch,t&&this.update({id:e,loading:!0,needLoad:!1},async()=>{try{const s=await y.fetch(t,[e,i],({url:r})=>({url:we(r,i),dataType:"html"}));this.update({id:e,loading:!1,content:{html:s}},()=>{var r;this._setCache(e,s),(r=this.props.onLoad)==null||r.call(this,i)})}catch(s){const r=k("div",{class:"panel center text-danger p-5",children:["Error: ",s.message]});this.update({id:e,loading:!1,content:r},()=>{var o;(o=this.props.onLoadFail)==null||o.call(this,s,i)})}}))}reset(e){this.setState({blocks:this._initBlocks(e)})}loadNext(){const{blocks:e}=this.state;let t="";for(const i of e){if(i.loading)return;if(!i.visible&&this._isVisible(i.id))return this.update({id:i.id,visible:!0});if(i.needLoad&&i.visible){t=i.id;break}}t.length&&requestAnimationFrame(()=>this.load(t))}_isVisible(e){return!this.props.onlyLoadVisible||!!y(this._ref.current).find(`.dashboard-block[data-id="${e}"]`).isVisible()}_setCache(e,t){const{cache:i}=this.props;if(i)try{typeof i=="string"?Xe.set(`${Va}${i}:${e}`,t):Xe.session.set(`${Va}${e}`,t)}catch(s){console.warn("ZUI: Failed to cache block content.",{id:e,html:t,error:s})}}_getCache(e){const{cache:t}=this.props;if(!t)return;const i=typeof t=="string"?Xe.get(`${Va}${t}:${e}`):Xe.session.get(`${Va}${e}`);if(i)return{html:i}}_initBlocks(e){const{blockFetch:t,blockMenu:i,grid:s}=this.props;return e.map(o=>{const{id:a,size:l,width:c,height:h,left:u=-1,top:p=-1,fetch:m=t,menu:v=i,content:b,...C}=o,[S,D]=this._getBlockSize(c&&h?{width:c,height:h}:l);return{id:`${a}`,width:S,height:D,left:Math.min(u,s-S),top:p,fetch:m,menu:v,content:b??this._getCache(`${a}`),loading:!1,needLoad:!!m,...C}})}_getBlockSize(e){const{blockDefaultSize:t,blockSizeMap:i}=this.props;return e=e??t,typeof e=="string"&&(e=i[e]),e=e||t,Array.isArray(e)||(e=[e.width,e.height]),e}_layout(){const{blocks:e,dragging:t,dropping:i}=this.state,s=this._map;if(s.size){const a=[0,0,0,0];e.sort((l,c)=>ey(s.get(l.id)||a,s.get(c.id)||a))}s.clear(),t&&i&&s.set(t,i),e.forEach(a=>{a.id!==t&&this._layoutBlock(a)});const r=Array.from(s.entries());r.sort((a,l)=>ey(a[1],l[1]));let o=0;return r.forEach(([a,l])=>{let c=l[1]-1;for(;c>=0&&this._canMove([l[0],c,l[2],l[3]],a);)c--;c++,l[1]=c,o=Math.max(o,c+l[3])}),i&&(o=Math.max(o,i[1]+i[3])),{blocks:e,height:o}}_initDraggable(){const e=this._ref.current;this._draggable=new sr(e,{selector:".dashboard-block",target:()=>e,beforeDrag:(t,i)=>{const s=i.getBoundingClientRect();if(t.clientY-s.top>48)return t.preventDefault(),!1;this._dragOffset=[t.clientX-s.left,t.clientY-s.top]},onDragStart:(t,i)=>{const s=i.dataset.id;s!==void 0&&(this._dragging=this._map.get(s),this.setState({dragging:s}))},onDragOver:t=>{const{cellHeight:i,grid:s}=this.props,r=e.getBoundingClientRect(),[,,o,a]=this._dragging,[l,c]=this._dragOffset,h=Math.min(s-o,Math.max(0,Math.round((t.clientX-r.left-l)/(r.width/s)))),u=Math.max(0,Math.round((t.clientY-r.top-c)/i)),p=this.state.dropping;p&&p[0]===h&&p[1]===u||this.setState({dropping:[h,u,o,a]})},onDragEnd:()=>{const{dragging:t,dropping:i}=this.state,s={dragging:void 0,dropping:void 0},r={};if(t&&i){const{blocks:o}=this.state;o.forEach((a,l)=>{const[c,h]=t===a.id?i:this._map.get(a.id);(a.left!==c||a.top!==h)&&(o[l]={...a,left:c,top:h},r[a.id]={left:c,top:h})}),s.blocks=o}this.setState(s,this._checkLayout),this._dragging=void 0,this._dragOffset=void 0}})}_layoutBlock(e){const{id:t,left:i,top:s,width:r,height:o}=e,a=[i,s,r,o];i<0||s<0?this._appendBlock(t,a):this._insertBlock(t,a)}_canMove(e,t){const{dropping:i}=this.state;if(i&&ph(e,i))return!1;for(const[s,r]of this._map.entries())if(s!==t&&ph(r,e))return!1;return!0}_canPlace(e){const{dragging:t}=this.state;return this._canMove(e,t)}_insertBlock(e,t){const{dropping:i}=this.state;for(i&&ph(t,i)&&(t[1]=i[1]+i[3]);!this._canPlace(t);)t[1]=t[1]+1;this._map.set(e,t)}_appendBlock(e,t){const[i,s,r,o]=t;let a=s;if(i>=0&&s>=0){if(this._canPlace(t)){this._map.set(e,[i,s,r,o]);return}a=-1}let l=i<0?0:i,c=a<0?0:a,h=!1;const u=this.props.grid;for(;!h;){if(this._canPlace([l,c,r,o])){h=!0;break}i<0?(l+=1,l+r>u&&(l=0,c+=1)):c+=1}this._map.set(e,[l,c,r,o])}componentDidMount(){this.loadNext(),y(window).on("scroll",this.tryLoadNext),this._initDraggable();for(const[e,t]of this._map.entries())this._oldMap.set(e,[...t])}componentDidUpdate(e){e.blocks!==this.props.blocks?this.setState({blocks:this._initBlocks(this.props.blocks)}):this.loadNext()}componentWillUnmount(){clearTimeout(this._loadTimer),y(window).off("scroll",this.tryLoadNext),this._draggable.destroy()}render(){const{blocks:e,height:t}=this._layout(),{cellHeight:i,grid:s,emptyBlockContent:r}=this.props,{dropping:o,dragging:a}=this.state,l=this._map;return k("div",{class:"dashboard",children:k("div",{class:"dashboard-blocks",style:{height:t*i},ref:this._ref,children:[o?k("div",{className:"dashboard-drop-shadow",style:{left:`${100*o[0]/s}%`,top:i*o[1],width:`${100*o[2]/s}%`,height:i*o[3]}},"dropping"):null,e.map((c,h)=>{const{id:u,menu:p,content:m,title:v}=c,[b,C,S,D]=u===a&&o?o:l.get(u)||[0,0,c.width,c.height];return k(hS,{id:u,index:h,left:`${100*b/s}%`,top:i*C,width:`${100*S/s}%`,height:i*D,content:m??r,title:v,className:V(c.needLoad?"need-load":"",m?"has-content":""),onMenuBtnClick:p?this._handleMenuClick:void 0},c.id)})]})})}};ty.defaultProps={responsive:!1,cache:!0,blocks:[],grid:3,gap:16,cellHeight:64,blockDefaultSize:[1,3],blockMenu:{items:[{text:"Refresh",data:{type:"refresh"}}]},onlyLoadVisible:!0,blockSizeMap:{xs:[1,3],sm:[1,4],md:[1,5],lg:[1,6],xl:[1,8],xsWide:[2,3],smWide:[2,4],mdWide:[2,5],lgWide:[2,6],xlWide:[2,8],xsLong:[3,3],smLong:[3,4],mdLong:[3,5],lgLong:[3,6],xlLong:[3,8]}};class mh extends ve{}mh.NAME="Dashboard",mh.Component=ty;function gh(n,e,t,i){if(typeof n=="function"&&(n=n.call(this,e)),typeof n=="string"&&n.length&&(n={url:n}),!n)return Array.isArray(t)?k(Tn,{children:t}):t;const{url:s,...r}=n,{setting:o}=e.col,a={};return o&&Object.keys(o).forEach(l=>{l.startsWith("data-")&&(a[l]=o[l])}),k("a",{href:we(s,e.row.data),...i,...r,...a,children:t})}function yh(n,e,t){if(n==null)return;const i=e.row.data;return t=t??(i==null?void 0:i[e.col.name]),typeof n=="function"?n.call(this,t,e):we(n,{...i,0:t})}function ny(n,e,t,i){var s;return t?(t=t??((s=e.row.data)==null?void 0:s[e.col.name]),t==="0000-00-00 00:00:00"||t==="0000-00-00"?i??"":n===!1?t:(n===!0&&(n="[yyyy-]MM-dd hh:mm"),typeof n=="function"&&(n=n.call(this,t,e)),lt(t,n,i??t))):i??t}function iy(n,e){const{link:t}=e.col.setting,i=gh.call(this,t,e,n[0]);return i&&(n[0]=i),n}function sy(n,e){const{format:t,digits:i}=e.col.setting;let s=n[0];return typeof i=="number"&&!Number.isNaN(Number(s))&&(s=Number(s),i>=0&&(s=s.toFixed(i))),t&&(s=yh.call(this,t,e,s)),n[0]=s,n}function ry(n,e){const{map:t,mapSplitter:i=",",mapJoiner:s}=e.col.setting;if(t){let r=n[0];typeof r=="string"&&i&&(r=r.split(i)),typeof t=="function"?n[0]=t.call(this,r,e):typeof t=="object"&&(Array.isArray(r)||(r=[r]),n[0]=r.map(o=>t[o]??o).join(s??i))}return n}function oy(n,e,t){const i={};return typeof n=="function"?Object.assign(i,n.call(this,t)):Object.keys(n).forEach(s=>{var o;const r=(o=t.row.data)==null?void 0:o[n[s]];r!==void 0&&(i[s]=r)}),Object.keys(i).length&&e.push({style:i}),e}function ay(n,e,t="[yyyy-]MM-dd hh:mm"){const{formatDate:i=t,invalidDate:s}=e.col.setting;return n[0]=ny.call(this,i,e,n[0],s),n}function vh(n,e,t=!1){const{html:i=t}=e.col.setting;if(i===!1)return n;const s=n[0],r=i===!0?s:yh.call(this,i,e,s);return n[0]={html:r},n}const dS=He({name:"rich",colTypes:{html:{onRenderCell(n,e){return vh.call(this,n,e,!0)}},progress:{align:"center",onRenderCell(n,{col:e}){const{progressType:t,barColor:i,barBgColor:s,barHeight:r=6,barWidth:o=64,circleSize:a=24,circleBorderSize:l=1,circleBgColor:c="var(--color-border)",circleColor:h="var(--color-success-500)"}=e.setting,u=n[0];return n[0]=t==="bar"?k(Wo,{className:"rounded-full",width:o,height:r,color:i||h,background:s,percent:u}):k(Vo,{percent:u,size:a,circleWidth:l,circleBg:c,circleColor:h,text:!0}),n}},datetime:{formatDate:"[yyyy-]MM-dd hh:mm"},date:{formatDate:"yyyy-MM-dd"},time:{formatDate:"hh:mm"}},onRenderCell(n,e){const{formatDate:t,html:i,hint:s,styleMap:r}=e.col.setting;if(t&&(n=ay.call(this,n,e,t)),n=ry.call(this,n,e),n=sy.call(this,n,e),i?n=vh.call(this,n,e):n=iy.call(this,n,e),s){let o=e.value;typeof s=="function"?o=s.call(this,e):typeof s=="string"?o=we(s,e.row.data):typeof n[0]=="string"&&(o=n[0]),n.push({attrs:{title:o}})}return r&&(n=oy.call(this,r,n,e)),n}},{buildIn:!0}),fS={default:(n,e,t)=>{var r,o;const i=(r=n.data)==null?void 0:r[t.name],s=(o=e.data)==null?void 0:o[t.name];return i===s?0:i==null?1:String(i).localeCompare(String(s))},date:(n,e,t)=>{var r,o;const i=Ve(((r=n.data)==null?void 0:r[t.name])??0),s=Ve(((o=e.data)==null?void 0:o[t.name])??0);return i.getTime()-s.getTime()},number:(n,e,t)=>{var r,o;const i=(r=n.data)==null?void 0:r[t.name],s=(o=e.data)==null?void 0:o[t.name];return Number.parseFloat(i)-Number.parseFloat(s)}},pS=He({name:"sort",defaultOptions:{sort:!1},when:n=>!!n.sort,onCreate(){const{sortBy:n}=this.options;n&&(this.state.sortBy=Array.isArray(n)?n:[n])},onAddRows(n,e){const{sortBy:t}=this.state;if(!t||!t.length)return;const{sort:i}=this.options,s={...fS,...typeof i=="function"?{default:i}:typeof i=="object"?i:{}};return[...n].sort((r,o)=>{for(const{name:a,order:l}of t){const c=e.map[a];if(!c)continue;let h=c.setting.sort;if(h===!0?h=s.default:typeof h=="string"&&(h=s[h]),!h)continue;const u=h.call(this,r,o,c);if(u)return l==="asc"?u:-u}return 0})},onHeaderCellClick(n,e){if(!n.target.closest(".dtable-sort-link"))return;const t=this.getColInfo(e.colName);if(!t||!t.setting.sort)return;const{sortBy:i=[]}=this.state,s=i.findIndex(a=>a.name===t.name),{multiSort:r}=this.options;let o="asc";if(s>=0){const a=i[s].order;a==="asc"?o="desc":a==="desc"&&(o="none"),r&&i.splice(s,1)}r||(i.length=0),this.update({dirtyType:"layout",state:{sortBy:[{name:e.colName,order:o},...i].filter(a=>a.order!=="none")}})},onRenderHeaderCell(n,e){var l;const{col:t}=e,{sortBy:i}=this.state;if(!t.setting.sort)return n;const o=((l=i==null?void 0:i.find(c=>c.name===t.name))==null?void 0:l.order)||"none",a=k("div",{className:`dtable-sort dtable-sort-${o}`});return n[0]=k("a",{className:"dtable-sort-link",href:"javascript:;",children:[n[0],a]}),n.push({outer:!0,attrs:{"data-sort":o}}),n}},{buildIn:!0}),mS={html:{component:Dn}},ly=He({name:"custom",onRenderCell(n,e){const{col:t}=e;let{custom:i}=t.setting;if(typeof i=="function"&&(i=i.call(this,e)),!i)return n;const s=Array.isArray(i)?i:[i],{customMap:r}=this.options;return s.forEach(o=>{let a;typeof o=="string"?a=o.startsWith("<")?{component:Dn,props:{html:we(o,{value:e.value,...e.row.data,$value:e.value})}}:{component:o}:a=o;let{component:l}=a;const c=[a];typeof l=="string"&&c.unshift(mS[l],r==null?void 0:r[l]);const h={};c.forEach(p=>{if(p){const{props:m}=p;m&&y.extend(h,typeof m=="function"?m.call(this,e):m),l=p.component||l}},{props:{}});const u=l;n[0]={outer:!0,className:"dtable-custom-cell",children:k(u,{...h})}}),n}}),qI="";function gS(n,e){var a,l;typeof n=="boolean"&&(e=n,n=void 0);const t=this.state.checkedRows,i={},{canRowCheckable:s,allowCheckDisabled:r}=this.options,o=(c,h)=>{const u=s?s.call(this,c):!0;!u||!r&&u==="disabled"||!!t[c]===h||(h?t[c]=!0:delete t[c],i[c]=h)};if(n===void 0?(e===void 0&&(e=!cy.call(this)),(a=this.layout)==null||a.allRows.forEach(({id:c})=>{o(c,!!e)})):(Array.isArray(n)||(n=[n]),n.forEach(c=>{o(c,e??!t[c])})),Object.keys(i).length){const c=(l=this.options.beforeCheckRows)==null?void 0:l.call(this,n,i,t);c&&Object.keys(c).forEach(h=>{const u=s?s.call(this,h):!0;!u||!r&&u==="disabled"||(c[h]?t[h]=!0:delete t[h])}),this.setState({checkedRows:{...t}},()=>{var h;(h=this.options.onCheckChange)==null||h.call(this,i)})}return i}function yS(n){return this.state.checkedRows[n]??!1}function cy(){var s,r;const n=(s=this.layout)==null?void 0:s.allRows.length;if(!n)return!1;const e=this.getChecks().length,{canRowCheckable:t,allowCheckDisabled:i}=this.options;return t?e===((r=this.layout)==null?void 0:r.allRows.reduce((o,a)=>{const l=t?t.call(this,a.id):!0;return o+(!l||!i&&l==="disabled"?0:1)},0)):e===n}function vS(){var e;const n=new Set((e=this.layout)==null?void 0:e.allRows.map(t=>t.id));return Object.keys(this.state.checkedRows).filter(t=>n.has(t))}function _S(n){const{checkable:e}=this.options;n===void 0&&(n=!e),e!==n&&this.setState({forceCheckable:n})}function uy(n,e,t=!1,i=void 0){return k(rs,{className:"dtable-checkbox",checked:n,disabled:t,label:i})}const hy='input[type="checkbox"],.dtable-checkbox',bS=He({name:"checkable",defaultOptions:{checkable:"auto",checkboxRender:uy},when:n=>!!n.checkable,options(n){const{forceCheckable:e}=this.state;return e!==void 0?n.checkable=e:n.checkable==="auto"&&(n.checkable=!!n.cols.some(t=>t.checkbox)),n},state(){return{checkedRows:{}}},methods:{toggleCheckRows:gS,isRowChecked:yS,isAllRowChecked:cy,getChecks:vS,toggleCheckable:_S},i18n:{zh_cn:{checkedCountInfo:"已选择 {selected} 项",totalCountInfo:"共 {total} 项"},zh_tw:{checkedCountInfo:"已選擇 {selected} 項",totalCountInfo:"共 {total} 項"},en:{checkedCountInfo:"Selected {selected} items",totalCountInfo:"Total {total} items"}},footer:{checkbox(){const n=this.isAllRowChecked();return[k("div",{style:{paddingRight:"calc(3*var(--space))",display:"flex",alignItems:"center"},onClick:()=>this.toggleCheckRows(),children:uy(n,void 0,!1,this.options.checkboxLabel)})]},checkedInfo(n,e){const t=this.getChecks(),{checkInfo:i}=this.options;if(i)return[k(ge,{className:"dtable-check-info",content:i.call(this,t)})];const s=t.length,r=[];return s&&r.push(this.i18n("checkedCountInfo",{selected:s})),r.push(this.i18n("totalCountInfo",{total:e.allRows.length})),[k("div",{className:"dtable-check-info",children:r.join(", ")})]}},onCreate(){const{checkedRows:n}=this.options;n&&this.setState(e=>({checkedRows:{...e.checkedRows,...n.reduce((t,i)=>(t[i]=!0,t),{})}}))},onRenderCell(n,{row:e,col:t}){var c;const{id:i}=e,{canRowCheckable:s}=this.options,r=s?s.call(this,i):!0;if(!r)return n;const{checkbox:o}=t.setting,a=typeof o=="function"?o.call(this,i):o,l=this.isRowChecked(i);if(a){const h=(c=this.options.checkboxRender)==null?void 0:c.call(this,l,i,r==="disabled");n.push(h,{outer:!0,className:"has-checkbox"})}return l&&n.push({outer:!0,className:"is-checked"}),n},onRenderHeaderCell(n,{row:e,col:t}){var o;const{id:i}=e,{checkbox:s}=t.setting;if(typeof s=="function"?s.call(this,i):s){const a=this.isAllRowChecked(),l=(o=this.options.checkboxRender)==null?void 0:o.call(this,a,i);n.push(l,{outer:!0,className:"has-checkbox"})}return n},onHeaderCellClick(n){if(this.data.disableCheckable)return;const e=n.target;if(!e)return;const t=e.closest(hy);t&&this.toggleCheckRows(t.checked)},onCellClick(n,{rowID:e}){if(this.data.disableCheckable)return;const t=y(n.target);if(!t.length||t.closest("btn,a,button.not-checkable,.form-control,.btn").length)return;(t.closest(hy).not(".disabled").length||this.options.checkOnClickRow)&&this.toggleCheckRows(e)}}),dy=He({name:"store",defaultOptions:{store:!0},when:n=>!!n.store,data(){return{store:new Zs(`DTable:${this.id}`)}}}),XI="",QI="";var fy=(n=>(n.unknown="",n.collapsed="collapsed",n.expanded="expanded",n.hidden="hidden",n.normal="normal",n))(fy||{});function Ka(n){const e=this.data.nestedMap.get(n);if(!e||e.state!=="")return e??{state:"normal",level:-1};if(!e.parent&&!e.children)return e.state="normal",e;const t=e.children&&this.state.nestedState[n];let i=!1,{parent:s}=e;for(;s;){const r=Ka.call(this,s);if(r.state!=="expanded"){i=!0;break}s=r.parent}return e.state=i?"hidden":t?"collapsed":e.children?"expanded":"normal",e.level=e.parent?Ka.call(this,e.parent).level+1:0,e}function wS(n){return n!==void 0?Ka.call(this,n):this.data.nestedMap}function CS(n,e){let{nestedState:t}=this.state;const{nestedMap:i}=this.data;if(n==="HEADER")if(e===void 0&&(e=!py.call(this)),e){const s=i.entries();for(const[r,o]of s)o.state==="expanded"&&(t[r]=!0)}else t={};else{const s=Array.isArray(n)?n:[n];e===void 0&&(e=!t[s[0]]),s.forEach(r=>{const o=i.get(r);e&&(o!=null&&o.children)?t[r]=!0:delete t[r]})}this.update({dirtyType:"layout",state:{nestedState:{...t}}},()=>{const{onNestedChange:s,preserveNested:r}=this.options;s==null||s.call(this),r&&this.data.store.set("nestedState",t)})}function py(){const n=this.data.nestedMap.values();for(const e of n)if(e.state==="expanded")return!1;return!0}function my(n,e=1,t,i=0){var s;t||(t=[...n.keys()]);for(const r of t){const o=n.get(r);o&&(o.level===i&&(o.order=e++),(s=o.children)!=null&&s.length&&(e=my(n,e,o.children,i+1)))}return e}function gy(n,e,t,i){const s=n.getNestedRowInfo(e);return!s||s.state===""||!s.children||s.children.forEach(r=>{i[r]=t,gy(n,r,t,i)}),s}function yy(n,e,t,i,s){var a;const r=n.getNestedRowInfo(e);if(!r||r.state==="")return;((a=r.children)==null?void 0:a.every(l=>{const c=!!(i[l]!==void 0?i[l]:s[l]);return t===c}))&&(i[e]=t),r.parent&&yy(n,r.parent,t,i,s)}const qa="dtable-nested-toggle",xS=He({name:"nested",plugins:[dy],requireAfter:["sortable"],defaultOptions:{nested:"auto",nestedParentKey:"parent",asParentKey:"asParent",nestedIndent:20,canSortTo(n,e){const{nestedMap:t}=this.data,i=t.get(n.id),s=t.get(e.id);return(i==null?void 0:i.parent)===(s==null?void 0:s.parent)},beforeCheckRows(n,e,t){if(!this.options.checkable||!(n!=null&&n.length)||this.options.noNestedCheck)return;const i={};return Object.entries(e).forEach(([s,r])=>{const o=gy(this,s,r,i);o!=null&&o.parent&&yy(this,o.parent,r,i,t)}),i}},options(n){return n.nested==="auto"&&(n.nested=!!n.cols.some(e=>e.nestedToggle)),n},when:n=>!!n.nested,data(){return{nestedMap:new Map,nestedRowMap:new Map}},state(){return{nestedState:{}}},methods:{getNestedInfo:wS,toggleRow:CS,isAllCollapsed:py,getNestedRowInfo:Ka},onCreate(){let{defaultNestedState:n}=this.options;if(this.options.preserveNested){const e=this.data.store.get("nestedState");e&&(n=e)}if(n===!0){const{data:e,rowKey:t="id"}=this.options;Array.isArray(e)&&(n=e.reduce((i,s)=>(i[typeof s=="string"?s:s[t]]=!0,i),{}))}this.state.nestedState=n||{}},onMounted(){this.options.defaultNestedState===!0&&!this.options.preserveNested&&this.toggleRow("HEADER",!0)},beforeLayout(){this.data.nestedMap.clear(),this.data.nestedRowMap.clear()},onAddRow(n){this.data.nestedRowMap.set(n.id,n)},onAddRows(n){const{nestedMap:e,nestedRowMap:t}=this.data;n.forEach(r=>{var c,h;const o=e.get(r.id)??{state:"",level:0};let a=((c=r.data)==null?void 0:c[this.options.nestedParentKey??"parent"])??[];Array.isArray(a)||(a=[a]);let l;for(a=[...a];a.length;){let u=a.pop();if(u===void 0)continue;if(u=String(u),t.get(u)){l=u;break}}if(o.parent=l==="0"?void 0:l,(h=r.data)!=null&&h[this.options.asParentKey??"asParent"]&&(o.children=[]),e.set(r.id,o),l){let u=e.get(l);u||(u={state:"",level:0},e.set(l,u)),u.children||(u.children=[]),u.children.push(r.id)}});const i=new Map,s=n.length*100;return n=n.filter(r=>{const o=this.getNestedRowInfo(r.id);return i.set(r.id,o),o.state!=="hidden"}),my(i),n.sort((r,o)=>{const a=i.get(r.id),l=i.get(o.id);return((a==null?void 0:a.order)??s+r.index)-((l==null?void 0:l.order)??s+o.index)}),n},onRenderCell(n,e){var c;const{row:t,col:i}=e,{id:s,data:r}=t,{nestedToggle:o,childLabel:a}=i.setting,l=this.getNestedRowInfo(s);if(a){const h=Number(r[this.options.nestedParentKey||"parent"]);if(!Number.isNaN(h)&&h>0){let u;typeof a=="string"?u=k("span",{className:"dtable-child-label label rounded-full size-sm gray-pale",children:we(a,r)}):u=k(ge,{className:"dtable-child-label",content:a,generatorThis:e}),n.unshift(u)}}if(o&&(l.children||l.parent)&&n.push(((c=this.options.onRenderNestedToggle)==null?void 0:c.call(this,l,s,i,r))??k("a",{className:`${qa} state${l.children?"":" is-no-child"}`,children:k("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${l.state}`}),l.level){let{nestedIndent:h=o}=i.setting;h&&(h===!0&&(h=this.options.nestedIndent??12),n.push(k("div",{className:"dtable-nested-indent",style:{width:h*l.level+"px"}})))}return n},onRenderHeaderCell(n,{row:e,col:t}){var s;const{id:i}=e;return t.setting.nestedToggle&&n.push(((s=this.options.onRenderNestedToggle)==null?void 0:s.call(this,void 0,i,t,void 0))??k("a",{className:`${qa} state`,children:k("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${this.isAllCollapsed()?"collapsed":"expanded"}`}),n},onHeaderCellClick(n){const e=n.target;if(!(!e||!e.closest(`.${qa}`)))return this.toggleRow("HEADER"),!0},onCellClick(n,{rowID:e}){const t=n.target;if(!(!t||!this.getNestedRowInfo(e).children||!t.closest(`.${qa}`)))return this.toggleRow(e),!0}});function _h(n,{row:e,col:t}){const{data:i}=e,s=i?i[t.name]:void 0;if(!(s!=null&&s.length))return n;const{avatarClass:r="rounded-full",avatarKey:o=`${t.name}Avatar`,avatarCodeKey:a,avatarNameKey:l=`${t.name}Name`}=t.setting;let{avatarProps:c={}}=t.setting;typeof c=="function"&&(c=c(t,e));const h=(i?i[l]:s)||n[0],u={size:"xs",src:i?i[o]:void 0,text:h,code:a?i?i[a]:void 0:s,...c,className:V(r,c.className,"flex-none")};if(n[0]=k(ss,{...u}),t.type==="avatarBtn"){const{avatarBtnProps:p}=t.setting,m=typeof p=="function"?p(t,e):p;n[0]=k("button",{type:"button",className:"btn btn-avatar",...m,children:[n[0],k("div",{children:h})]})}else t.type==="avatarName"&&(n[0]=k("div",{className:"flex items-center gap-1",children:[n[0],k("span",{children:h})]}));return n}const SS=He({name:"avatar",colTypes:{avatar:{onRenderCell:_h},avatarBtn:{onRenderCell:_h},avatarName:{onRenderCell:_h}}},{buildIn:!0}),kS=He({name:"sort-type",defaultOptions:{sortType:!0},when:n=>!!n.sortType&&!n.sort,onRenderHeaderCell(n,e){const{col:t}=e,{setting:i}=t;let{sortType:s}=i;if(t.setting.sort!==void 0||s===!1)return n;const{sortLink:r,orderBy:o}=this.options;if(o&&o[t.name]!==void 0&&(s=o[t.name]),s){const a=s===!0?"none":s,l=k("div",{className:`dtable-sort dtable-sort-${a}`});n.push({outer:!0,attrs:{"data-sort":a}});let{sortLink:c=r}=i;if(c){const h=a==="asc"?"desc":"asc";typeof c=="function"&&(c=c.call(this,t,h,a)),typeof c=="string"&&(c={url:c});const{url:u,...p}=c;n[0]=k("a",{className:"dtable-sort-link",href:we(u,{...i,sortType:h}),...p,children:[typeof n[0]!="object"||$.isValidElement(n[0])?n[0]:t.name,l]})}else n.push(l)}return n}},{buildIn:!0}),bh=n=>{n.length!==1&&n.forEach((e,t)=>{!t||e.border!==void 0||e.setting.group===n[t-1].setting.group||(e.border="left")})},TS=He({name:"group",defaultOptions:{groupDivider:!0},when:n=>!!n.groupDivider,onLayout(n){if(!this.options.groupDivider)return;const{cols:e}=n;bh(e.left.list),bh(e.center.list),bh(e.right.list)}}),n$="",DS=He({name:"header-group",defaultOptions:{headerGroup:!0},data(){return{headerGroups:new Map}},when:n=>!!n.headerGroup,beforeLayout(n){const{headerGroups:e}=this.data;e.clear();const{cols:t}=n;if(!(t!=null&&t.length))return;const i={};return t.forEach((s,r)=>{const{headerGroup:o}=s;if(!o){i[s.name]=r;return}let a=e.get(o);a?a.cols.push(s.name):(a={cols:[s.name],index:r},e.set(o,a)),i[s.name]=a.index+a.cols.length/t.length}),t.sort((s,r)=>i[s.name]-i[r.name]),{headerHeight:!n.headerHeight&&n.rowHeight?n.rowHeight*2:void 0,cols:t}},onRenderHeaderCell(n,{col:e}){const{headerGroup:t}=e.setting;if(t){const i=this.data.headerGroups.get(t),s=this.layout.headerHeight/2;if(e.name===i.cols[0]){const r=i.cols.reduce((a,l)=>{var c;return a+(((c=this.getColInfo(l))==null?void 0:c.realWidth)??0)},0),o={height:s-1,width:r-1};n.push(k("div",{class:"dtable-header-group",style:o,children:t}))}n.push({className:"dtable-header-as-group",style:{paddingTop:s}})}return n}}),IS=He({name:"cellspan",when:n=>!!n.getCellSpan,data(){return{cellSpanMap:new Map,overlayCellSet:new Set}},onLayout(n){const{getCellSpan:e}=this.options;if(!e)return;const{cellSpanMap:t,overlayCellSet:i}=this.data,{rows:s,cols:r,rowHeight:o}=n;t.clear(),i.clear();const a=(l,c,h)=>{const{index:u}=c;l.forEach((p,m)=>{const{index:v}=p,b=`C${v}R${u}`;if(i.has(b))return;const C=e.call(this,{row:c,col:p});if(!C)return;const S=Math.min(C.colSpan||1,l.length-m),D=Math.min(C.rowSpan||1,s.length-h);if(S<=1&&D<=1)return;let N=0;for(let P=0;P<S;P++){N+=l[m+P].realWidth;for(let H=0;H<D;H++){const q=`C${v+P}R${u+H}`;q!==b&&i.add(q)}}t.set(b,{colSpan:S,rowSpan:D,width:N,height:o*D})})};s.forEach((l,c)=>{["left","center","right"].forEach(h=>{a(r[h].list,l,c)})})},onRenderCell(n,{row:e,col:t}){const i=`C${t.index}R${e.index}`;if(this.data.overlayCellSet.has(i))n.push({outer:!0,style:{display:"none",className:"cellspan-overlayed-cell"}});else{const s=this.data.cellSpanMap.get(i);s&&n.push({outer:!0,style:{width:s.width,height:s.height}})}return n}}),Nr=He({name:"mousemove",events:{click(n){this.data.ignoreNextClick&&(n.preventDefault(),this.data.ignoreNextClick=void 0)},mousedown(){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick)},mousemove(n){this.data.mmRafID&&cancelAnimationFrame(this.data.mmRafID),this.data.mmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("mousemovesmooth",n),this.data.mmRafID=0}),n.preventDefault()},document_mousemove(n){this.data.dmmRafID&&cancelAnimationFrame(this.data.dmmRafID),this.data.dmmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("document_mousemovesmooth",n),this.data.mmRafID=0})}},methods:{ignoreNextClick(n=10){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick),this.data.ignoreNextClick=window.setTimeout(()=>{this.data.ignoreNextClick=void 0},n)}}});function $S(){var N,P,H,q;const{scrollToMouse:n}=this.data;if(!n)return this.stopScrollToMouse();const{position:e,startTime:t,delay:i}=n;if(!e||Date.now()-t<i)return;const s=(P=(N=this.ref.current)==null?void 0:N.querySelector(".dtable-body"))==null?void 0:P.getBoundingClientRect();if(!s)return;const r=(q=(H=this.ref.current)==null?void 0:H.querySelector(".dtable-scroll-center"))==null?void 0:q.getBoundingClientRect(),{maxStep:o,detectPadding:a,speed:l,side:c}=n,{x:h,y:u}=e,{top:p,bottom:m}=s,{left:v,right:b}=r||s;let C=0;h<v-a?C=-Math.max(o,v-a-h):h>b-a&&(C=Math.max(o,h-(b-a)));let S=0;if(u<p-a?S=-Math.max(o,p-a-u):u>m-a&&(S=Math.max(o,u-(m-a))),c){const Y=new Set((Array.isArray(c)?c:[c]).reduce((Q,Z)=>(Z==="x"?Q.push("left","right"):Z==="y"?Q.push("top","bottom"):Q.push(Z),Q),[]));(!Y.has("left")&&C<0||!Y.has("right")&&C>0)&&(C=0),(!Y.has("top")&&S<0||!Y.has("bottom")&&S>0)&&(S=0)}const D={};C!==0&&(D.scrollLeft=this.layout.scrollLeft+l*C),S!==0&&(D.scrollTop=this.layout.scrollTop+l*S),this.scroll(D)}const wh=He({name:"autoscroll",plugins:[Nr],events:{document_mousemovesmooth(n){if(!this.data.scrollToMouse)return;const{clientX:e,clientY:t}=n;this.data.scrollToMouse.position={x:e,y:t}}},methods:{scrollTo({col:n,row:e,extra:t=2}){const i=this.getColInfo(n),s=this.getRowInfo(e);if(!i&&!s)return!1;const r={},{layout:o}=this;if(i){const{scrollLeft:a,cols:l}=o,c=i.left+i.realWidth;i.left<a?r.scrollLeft=i.left-t:c>l.center.width+a&&(r.scrollLeft=c-l.center.width+t)}if(s){const{scrollTop:a,rowHeight:l,rowsHeight:c}=o,h=s.top+l;s.top<a?r.scrollTop=s.top-t:h>c+a&&(r.scrollTop=h-c+t)}return this.scroll(r),!0},startScrollToMouse(n){const e={interval:60,speed:.5,delay:200,maxStep:this.options.rowHeight,onlyInside:!1,detectPadding:30,startTime:Date.now(),...n};this.data.scrollToMouse=e,clearInterval(this.data.scrollToTimer),this.data.scrollToTimer=window.setInterval($S.bind(this),e.interval)},stopScrollToMouse(){clearInterval(this.data.scrollToTimer),this.data.scrollToMouse=void 0}},onUnmounted(){clearInterval(this.data.scrollToTimer)}}),a$="",AS=He({name:"sortable",defaultOptions:{sortable:!0},when:n=>!!n.sortable,plugins:[Nr,wh],resetState:!0,state(){return{rowOrders:void 0,sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0}},events:{click(n){n.target.closest(".dtable-sort-link")&&(this.state.rowOrders=void 0)},mousedown(n){var a;if(this.data.disableSortable)return;const{sortHandler:e=".dtable-cell"}=this.options;if(!y(n.target).closest(e).length)return;const s=this.getPointerInfo(n);if(!s||s.rowID==="HEADER")return;const r=this.getRowInfo(s.rowID);if(!r||((a=this.options.onSortStart)==null?void 0:a.call(this,r,n))===!1)return;n.preventDefault();const o=n.clientY;this.data.sortableInfo={from:r,offset:o-s.cellElement.getBoundingClientRect().top,startMouseY:o,lastMouseY:o}},document_mouseup(n){var i;const{sortableInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingState(n);if(t){let s,r;const{sortingFrom:o,sortingTo:a,sortingSide:l}=t;if(a&&l){const c=this.layout.rows.map(m=>m.id),h=[...c],u=o.index,p=a.index;if(!(u===p+1&&l==="after")&&!(u===p-1&&l==="before")){const m=c.splice(u,1);c.splice(p,0,m[0]),s={},r=[],c.forEach((v,b)=>{s[v]=b,r.push(v)}),(h.join()===r.join()||((i=this.options.onSort)==null?void 0:i.call(this,o,a,l,r))===!1)&&(s=void 0,r=void 0)}}(a||Math.abs(e.lastMouseY-e.startMouseY)>4)&&this.ignoreNextClick(),this.disableAnimation(),this.update({dirtyType:"layout",state:c=>y.extend({sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0},s?{rowOrders:{...c.rowOrders,...s}}:null)},()=>{var c;(c=this.options.onSortEnd)==null||c.call(this,o,a,l,r),setTimeout(()=>{this.data.disableCheckable=void 0},50)})}this.data.sortableInfo=void 0},document_mousemovesmooth(n){const{sortableInfo:e}=this.data;if(!e)return;const t=this.getSortingState(n);t&&(e.state||(this.startScrollToMouse({side:"y"}),this.data.disableCheckable=!0),e.lastMouseY=n.clientY,e.state=t,this.setState(t))}},methods:{getSortingState(n){var q;const{disableSortable:e,sortableInfo:t}=this.data;if(e||!t)return;const{headerHeight:i,footerHeight:s,visibleRows:r,scrollTop:o,rowHeight:a}=this.layout,l=this.element.getBoundingClientRect(),c=l.width,h=l.height-i-s,u=n.clientX-l.left,p=n.clientY-l.top-i;if(u<0||u>c||p<0||p>h)return t.state;const m=p+o,v=r.find(Y=>Y.top<=m&&Y.top+a>m);if(!v)return t.state;const b=t.from,C=v.id!==b.id?v.id:void 0,S=C?this.getRowInfo(C):void 0,D=p,N=m<v.top+a/2?"before":"after";return S&&((q=this.options.canSortTo)==null?void 0:q.call(this,b,S,N))!==!1?{sortingFrom:b,sortingPos:D,sortingTo:S,sortingSide:N}:{sortingFrom:b,sortingPos:D,sortingTo:void 0,sortingSide:void 0}}},onAddRows(n){const{rowOrders:e}=this.state;if(!e)return;const t=n.length*100;return n=n.sort((i,s)=>{const r=e[i.id]??t+i.index,o=e[s.id]??t+s.index;return r-o}),n},beforeRender(n){const{sortingFrom:e}=this.state,{visibleRows:t}=n;e&&(t.some(i=>i.id===e.id)||(n.visibleRows=[...t,e]),n.className=V(n.className,"dtable-sorting"))},onRenderCell(n,e,t){const{sortingFrom:i,sortingPos:s,sortingTo:r,sortingSide:o}=this.state;if(!i)return n;const a=e.row,l={},c=[];if(i.id===a.id)l.top=s-this.data.sortableInfo.offset+((t.top??a.top)-(a.top-this.layout.scrollTop)),c.push("is-sorting-from");else if(r){const h=r.id===a.id;h&&c.push(`text-primary is-sorting-to is-sorting-to-${o}`),i.index>a.index&&(h&&o==="before"||a.index>r.index)?c.push("is-sorting-before"):i.index<a.index&&(h&&o==="after"||a.index<r.index)&&c.push("is-sorting-after")}return c.length&&n.push({outer:!0,style:l,className:c}),n}}),vy=He({name:"pager",state(){const n=this.props.localPager;if(n){const{page:e=1,recTotal:t=0,recPerPage:i=20,pageTotal:s=1}=this.props.footPager||{};return{pager:{page:e,recTotal:t,recPerPage:i,pageTotal:s,...typeof n=="object"?n:null}}}return{}},footer:{pager(){let{footPager:n}=this.options;const{localPager:e}=this.options;return n?(n={items:[{type:"link",page:"first",icon:"icon-first-page"},{type:"link",page:"prev",icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",icon:"icon-angle-right"},{type:"link",page:"last",icon:"icon-last-page"}],...n},Array.isArray(n.items)&&n.items.forEach(t=>{t.type==="size-menu"&&t.caret===void 0&&(t.caret="up")}),this.options.localPager&&(Object.assign(n,{...typeof e=="object"?e:null,...this.state.pager,recTotal:this.layout.allRows.length,useState:!0}),n.onChangePageInfo=t=>{this.update({dirtyType:"layout",state:i=>({pager:{...i.pager,...t}})})}),[k(_r,{...n})]):[]}},onAddRows(n){const{localPager:e}=this.options;if(e){const{page:t=1,recPerPage:i=20}={...typeof e=="object"?e:null,...this.state.pager},s=(t-1)*i,r=Math.min(t*i,n.length);return n.slice(s,r)}}}),ES=Object.freeze(Object.defineProperty({__proto__:null,NestedRowState:fy,avatar:SS,cellspan:IS,checkable:bS,custom:ly,group:TS,headerGroup:DS,nested:xS,pager:vy,renderDatetime:ny,renderDatetimeCell:ay,renderFormat:yh,renderFormatCell:sy,renderHtmlCell:vh,renderLink:gh,renderLinkCell:iy,renderMapCell:ry,renderStyleMapCell:oy,rich:dS,sort:pS,sortType:kS,sortable:AS},Symbol.toStringTag,{value:"Module"}));class Ri extends ve{setOptions(e,t){return e=super.setOptions(e,t),e.parent||(e.parent=this.element),e}}Ri.NAME="DTable",Ri.Component=Ts,Ri.definePlugin=He,Ri.removePlugin=sg,Ri.getPlugin=rg,Ri.plugins=ES;const u$="",h$="",d$="",f$="",p$="",m$="",g$="";class Ch extends Ke{_getClassName(e){return["kanban-header-col",e.className,e.subCols?"has-subs":"",e.parentName!==void 0?"is-sub":""]}_getProps(e){const{width:t,color:i,name:s,gapLeft:r,gapRight:o}=e;return ke(super._getProps(e),{style:{"--kanban-col-color":i,"--kanban-col-width":Ge(t),"--kanban-col-gap-left":Ge(r),"--kanban-col-gap-right":Ge(o)},"z-col":s})}_getChildren(e){const{prefix:t,prefixClass:i,title:s,titleClass:r,titleAlign:o="center",subtitle:a,subtitleClass:l,icon:c,trailingIcon:h,actions:u,subCols:p}=e;return[k("div",{className:`kanban-header-col-wrapper is-align-${o}`,children:[k("div",{className:"kanban-header-title",children:[c?k($e,{className:"as-leading-icon",icon:c},"icon"):null,t?k("span",{className:V("as-prefix",i),children:k(ge,{content:t})},"prefix"):null,s?k("span",{className:V("as-title",r),title:typeof s=="string"?s:void 0,children:k(ge,{content:s})},"title"):null,a?k("span",{className:V("as-subtitle",l),children:k(ge,{content:a})},"subtitle"):null,h?k($e,{className:"as-trailing-icon",icon:h},"trailingIcon"):null]},"title"),Be.render(u,[e],{key:"actions",className:"kanban-header-col-actions",size:"sm"},this)]},"wrapper"),p?k("div",{className:"kanban-header-sub-cols",children:p.map((m,v)=>k(Ch,{index:v,...m},m.name))},"subs"):null]}}class NS extends me{constructor(){super(...arguments),this._ref=he()}componentDidMount(){this._ref.current&&(this._sticky=Ao.ensure(this._ref.current,{scrollContainer:".kanban-list"}))}componentWillUnmount(){var e;(e=this._sticky)==null||e.destroy()}render(e){return k("div",{className:"kanban-header",ref:this._ref,children:[k("div",{className:"kanban-header-lane-name"},"name"),k("div",{className:"kanban-header-cols",children:e.cols.map((t,i)=>k(Ch,{index:i,...t},t.name))},"cols")]})}}class _y extends me{constructor(){super(...arguments),this._listRef=he(),this._renderItem=e=>{const{itemRender:t,lane:i,name:s}=this.props;return t.call(this,{item:e,lane:i,col:s})},this._handleScroll=e=>{const{current:t}=this._listRef;t&&y(t).trigger("laneColScroll",e)}}componentDidMount(){const{current:e}=this._listRef;e&&(this._ob=new ResizeObserver(t=>{y(this._listRef.current).trigger("laneColResize",t[0])}),this._ob.observe(e))}componentWillUnmount(){var e;(e=this._ob)==null||e.disconnect()}render(e){const{items:t}=e,{width:i,color:s,content:r,contentClass:o,itemRender:a,itemGap:l,watchSize:c,name:h,lane:u,itemCountPerRow:p,gapLeft:m,gapRight:v,laneColClass:b}=e,C={"--kanban-col-color":s,"--kanban-col-width":Ge(i),"--kanban-col-gap-left":Ge(m),"--kanban-col-gap-right":Ge(v)};return k("div",{className:V("kanban-lane-col",b),style:C,"z-lane":u,"z-col":h,children:[r?k("div",{className:V("kanban-col-content",o),children:k(ge,{content:r,generatorThis:this,generatorArgs:[e]})}):null,k("div",{className:"kanban-items scrollbar-thin scrollbar-hover",onScroll:this._handleScroll,children:k($s,{forwardRef:c?this._listRef:void 0,itemProps:{className:"kanban-item card-list-item"},items:t,itemRender:a?this._renderItem:void 0,countPerRow:p,gap:l},"list")})]})}}_y.defaultProps={watchSize:!0};class MS extends Ke{_getClassName(e){const{className:t,index:i,maxHeight:s,height:r}=e;return["kanban-lane",t,{"is-first":!i,"is-auto-height":!s&&(!r||r==="auto")}]}_getProps(e){const{height:t,minHeight:i,maxHeight:s,color:r,name:o,gapTop:a,gapBottom:l}=e;return ke(super._getProps(e),{style:{"--kanban-lane-color":r,height:Ge(t),minHeight:Ge(i),maxHeight:Ge(s),"--kanban-col-gap-top":Ge(a),"--kanban-col-gap-bottom":Ge(l)},"z-lane":o})}_renderCol(e,t,i,s,r){if(r){const o=r(e,t);o&&(t={...t,...o})}return k(_y,{itemRender:i,lane:e.name,items:s[t.name],...t},t.name)}_getChildren(e){const{title:t,titleClass:i,actions:s,cols:r,items:o={},hideName:a,itemRender:l,getLaneCol:c}=e;return[a?null:k("div",{className:"kanban-lane-name",children:[Be.render(s,[e],{key:"actions",className:"kanban-lane-actions",size:"sm"},this),k("div",{className:V("kanban-lane-title",i),title:typeof t=="string"?t:void 0,children:k(ge,{content:t})},"title")]},"name"),k("div",{className:"kanban-lane-cols",children:r.reduce((h,u)=>(u.subCols?u.subCols.forEach(p=>{h.push(this._renderCol(e,p,l,o,c))}):h.push(this._renderCol(e,u,l,o,c)),h),[])},"cols")]}}function PS(n){const{lanes:e,cols:t,items:i={},itemRender:s,hideLaneName:r,getLaneCol:o}=n;return k("div",{className:"kanban-body",children:e.map((a,l)=>k(MS,{index:l,cols:t,items:i[a.name],hideName:r,itemRender:s,getLaneCol:o,...a},a.name))})}const Vt=12,LS={left:"right",right:"left",top:"bottom",bottom:"top","":""},ti=({from:n,to:e,fromKanban:t,toKanban:i})=>`${t?`${t}_`:""}${n}-${i?`${i}_`:""}${e}`;function by(n,e){return e==="top"?{x:n.x+n.width/2,y:n.y}:e==="left"?{x:n.x,y:n.y+n.height/2}:e==="right"?{x:n.x+n.width,y:n.y+n.height/2}:{x:n.x+n.width/2,y:n.y+n.height}}function RS(n,e){return(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)}function OS(n,e,t,i){const s=t?[t]:["left","right","top","bottom"],r=i?[i]:["left","right","top","bottom"];let o=Number.MAX_SAFE_INTEGER,a={x:0,y:0},l={x:0,y:0};return s.forEach(c=>{r.forEach(h=>{const u=by(n,c),p=by(e,h),m=RS(u,p)*(LS[c]===h?1:2);m<o&&(o=m,t=c,i=h,a=u,l=p)})}),{fromSide:t,toSide:i,fromPos:a,toPos:l}}function FS(n,e){return{x:(n.x+e.x)/2,y:(n.y+e.y)/2}}function wy(n,e){return{x:Math.min(n.x,e.x),y:Math.min(n.y,e.y),width:Math.abs(n.x-e.x),height:Math.abs(n.y-e.y)}}function Cy(n,e,t){const i={id:`marker-${e}-${t}-${n}`,orient:"auto",markerUnits:"strokeWidth",refX:e==="start"?0:6,refY:3,markerWidth:6,markerHeight:6,path:{d:"",fill:"currentColor"}};return n==="arrow"?e==="start"?i.path.d="M6,0 L6,6 L0,3 z":i.path.d="M0,0 L0,6 L6,3 z":n==="dot"?i.path.d="M3,3 m-3,0 a 3,3 0 1,1 6,0 a 3,3 0 1,1 -6,0":n==="square"?i.path.d="M0,0 L0,6 L6,6 L6,0 z":n==="diamond"&&(i.path.d="M3,0 L6,3 L3,6 L0,3 z"),i}function zS(n,e,t,i,s="curve",r=2,o=1){const{x:a,y:l,width:c,height:h}=wy(n,e),u=Vt-a,p=Vt-l;if(s==="curve"){const m=c*(1+Math.max(-.3,Math.min(.3,1-c/50)))*o,v=h*(1+Math.max(-.3,Math.min(.3,1-h/50)))*o,b=r*5,C={a1x:n.x+(t==="left"?-b:t==="right"?b:0),a1y:n.y+(t==="top"?-b:t==="bottom"?b:0),ax:n.x+(t==="left"?-m:t==="right"?m:0),ay:n.y+(t==="top"?-v:t==="bottom"?v:0),bx:e.x+(i==="left"?-(m-b):i==="right"?m-b:0),by:e.y+(i==="top"?-(v-b):i==="bottom"?v-b:0),b1x:e.x+(i==="left"?-b:i==="right"?b:0),b1y:e.y+(i==="top"?-b:i==="bottom"?b:0)};return`M ${n.x+u} ${n.y+p} L ${C.a1x+u} ${C.a1y+p} C ${C.ax+u} ${C.ay+p} ${C.bx+u} ${C.by+p} ${C.b1x+u} ${C.b1y+p} L ${e.x+u} ${e.y+p}`}if(s==="fold"){const m=FS(n,e),v=c/2,b=h/2,C={ax:n.x+(t==="left"?-v:t==="right"?v:0),ay:n.y+(t==="top"?-b:t==="bottom"?b:0),bx:e.x+(i==="left"?-v:i==="right"?v:0),by:e.y+(i==="top"?-b:i==="bottom"?b:0)};return`M ${n.x+u} ${n.y+p} L ${C.ax+u} ${C.ay+p} L ${m.x+u} ${m.y+p} L ${C.bx+u} ${C.by+p} L ${e.x+u} ${e.y+p}`}return`M ${n.x+u} ${n.y+p} L ${e.x+u} ${e.y+p}`}function jS(n){const{fromRect:e,toRect:t}=n,i=ti(n),s={x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top},r={x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top},{fromSide:o,toSide:a,fromPos:l,toPos:c}=OS(s,r),h=wy(l,c),{x:u,y:p,width:m,height:v}=h;l.x+=Vt-u,l.y+=Vt-p,c.x+=Vt-u,c.y+=Vt-p;const{weight:b=1.5,fromPoint:C,toPoint:S="arrow"}=n,D={left:`${0-Vt}px`,top:`${0-Vt}px`,width:`${m+2*Vt}px`,height:`${v+2*Vt}px`},N={"stroke-width":b,fill:"transparent",stroke:"currentColor","stroke-linejoin":"round","marker-start":C&&C!=="none"?`url(#marker-start-${i}-${C})`:void 0,"marker-end":S&&S!=="none"?`url(#marker-end-${i}-${S})`:void 0,d:zS(l,c,o,a,n.shape,b)},P={"stroke-width":b+5,"stroke-linejoin":"round",fill:"transparent",stroke:"currentColor",d:N.d,class:"opacity-0"},H={width:m+2*Vt,height:v+2*Vt},q=[];return n.lineStyle==="dashed"?N["stroke-dasharray"]=`${b*3} ${b*3}`:n.lineStyle==="dotted"&&(N["stroke-dasharray"]=`${b} ${b}`),C&&C!=="none"&&q.push(Cy(C,"start",i)),S&&S!=="none"&&q.push(Cy(S,"end",i)),{x:u,y:p,width:m,height:v,fromSide:o,toSide:a,fromPos:l,toPos:c,nodeStyle:D,svgPathProps:N,svgPathBackProps:P,svgProps:H,markers:q,padding:Vt}}class xy extends me{constructor(){super(...arguments),this.state={},this._handleMouseHover=e=>{this.setState({hover:e.type==="mouseenter"})},this._onDelete=()=>{var e;(e=this.props.onDelete)==null||e.call(this,this.props)}}render(e,t){const{text:i,textSize:s,color:r,onDelete:o,weight:a=1.5,from:l,to:c}=e,{hover:h}=t,{x:u,y:p,padding:m,width:v,height:b,svgProps:C,markers:S,svgPathProps:D,svgPathBackProps:N,fromPos:P}=jS(e);return k("div",{className:V("kanban-link",h?"is-hover":""),style:{left:u,top:p,width:v,height:b,color:r,"--kanban-link-weight":a},"z-from":l,"z-to":c,onMouseEnter:o?this._handleMouseHover:void 0,onMouseLeave:o?this._handleMouseHover:void 0,children:[k("svg",{...C,xmlns:"http://www.w3.org/2000/svg",version:"1.1",children:[S.length?k("defs",{children:S.map(({path:H,id:q,...Y})=>k("marker",{...Y,id:q,children:k("path",{...H})},q))}):null,k("path",{...N}),k("path",{...D})]}),k("div",{className:"kanban-link-start-point",style:{left:P.x-m,top:P.y-m}}),o?k("div",{className:"kanban-link-delete-btn",children:k("button",{type:"button",className:"btn rounded-full size-sm square primary",onClick:this._onDelete,children:k("i",{className:"close"})})}):null,i?k("div",{className:"kanban-link-text",style:{fontSize:`${s||12}px`},children:i}):null]})}}const Mr=".kanban";class BS extends me{constructor(){super(...arguments),this._ref=he(),this.state={}}componentDidMount(){const e=this._ref.current,{container:t=".kanban"}=this.props,i=e.closest(t),s=y(i);this._container=i,this._multiKanban=s.find(".kanban").length>1;const r=".kanban-item,.kanban-link-editor-from";s.on(`mouseenter${Mr}`,r,o=>{if(this.state.dragPos)return;clearTimeout(this._leaveTimer);const a=y(o.target).closest(r),l=a.z("key");this.state.from===l||a.hasClass("is-dragging")||this.setState({from:l,fromKanban:this._multiKanban?a.closest(".kanban").z("key"):void 0,to:void 0,fromRect:this._getRect(a.children()[0]),dragPos:void 0})}).on(`mouseleave${Mr}`,r,()=>{this.state.dragPos||(clearTimeout(this._leaveTimer),this._leaveTimer=window.setTimeout(()=>{this._cancelHover(),this._leaveTimer=0},200))}).on(`dragstart${Mr}`,".kanban-item",()=>{this.state.dragPos||this._cancelHover()}).on(`laneColScroll${Mr}`,o=>{const{from:a}=this.state;a&&this.setState({fromRect:this._getRect(y(o.target).find(`.kanban-item[z-key="${a}"]`).children()[0])})}),this._moveable=new rr(e,{selector:".kanban-link-editor-point",move:"none",onMoveStart:()=>{if(!this.state.from)return!1;s.addClass("is-adding-link")},onMove:o=>{const{top:a,left:l}=i.getBoundingClientRect(),c={left:o.clientX-l+i.scrollLeft,top:o.clientY-a+i.scrollTop};let h,u,p;const m=y(o.target).closest(r);m.length&&h!==this.state.from&&(h=m.attr("z-key"),p=this._multiKanban?m.closest(".kanban").z("key"):void 0,u=this._getRect(m.children()[0])),this.setState({dragPos:c,to:h,toKanban:p,toRect:u})},onMoveEnd:()=>{const{from:o,fromKanban:a,to:l,toKanban:c}=this.state,{onAddLink:h}=this.props;(o!==l||a!==c)&&h&&o!==void 0&&l!==void 0&&(h==null||h.call(this,{from:o,fromKanban:a,to:l,toKanban:c})),this._cancelHover(),s.removeClass("is-adding-link")}})}componentWillUnmount(){var t;const e=(t=this._ref.current)==null?void 0:t.closest(".kanban");e&&y(e).off(Mr),this._raf&&cancelAnimationFrame(this._raf)}_getRect(e){const t=e.getBoundingClientRect(),i=this._container,{top:s,left:r}=i.getBoundingClientRect();return{left:t.left-r+i.scrollLeft,top:t.top-s+i.scrollTop,width:t.width,height:t.height}}_cancelHover(){this.setState({from:void 0,to:void 0,fromRect:void 0,dragPos:void 0})}_renderLink(e){const{fromRect:t,toRect:i,from:s,to:r="",dragPos:o}=e;if(!t||!s||!o)return null;const a=i?{left:i.left,top:i.top,right:i.left+i.width,bottom:i.top+i.height}:{left:o.left,top:o.top,right:o.left,bottom:o.top};return k(xy,{from:s,to:r,lineStyle:"dotted",color:"var(--color-primary-500)",fromRect:{left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+t.height},toRect:a},"link")}render(e,t){const{from:i,fromRect:s,to:r,toRect:o}=t;let a,l;return i&&s&&(a=k("div",{className:"kanban-link-editor-from not-moveable","z-key":i,style:s,children:[k("div",{className:"kanban-link-editor-point is-left"}),k("div",{className:"kanban-link-editor-point is-top"}),k("div",{className:"kanban-link-editor-point is-right"}),k("div",{className:"kanban-link-editor-point is-bottom"})]})),r&&o&&(l=k("div",{className:"kanban-link-editor-to","z-key":r,style:o})),k("div",{className:V("kanban-link-editor"),ref:this._ref,children:[a,l,this._renderLink(t)]})}}const xh=".kanban";class Sy extends me{constructor(){super(...arguments),this._ref=he(),this._watchSet=new Set,this.state={layout:{},scrollTop:0,scrollLeft:0}}componentDidMount(){var s;const{container:e=".kanban"}=this.props,t=(s=this._ref.current)==null?void 0:s.closest(e),i=y(t);this._multiKanban=i.find(".kanban").length>1,i.on(`laneColResize${xh} laneColScroll${xh}`,()=>{this._tryUpdateLayout()}),this._container=t,this._tryUpdateLayout()}componentWillUnmount(){const e=this._container;e&&y(e).off(xh),this._raf&&cancelAnimationFrame(this._raf)}componentDidUpdate(e){(e.links!==this.props.links||e.filters!==this.props.filters)&&this._tryUpdateLayout()}_tryUpdateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._updateLayout(),this._raf=0})}_updateLayout(){const e=[...this._watchSet],t=this._container,i=y(t),{top:s,left:r}=t.getBoundingClientRect(),o=t.scrollTop-s,a=t.scrollLeft-r,l={};e.forEach(c=>{const[h,u]=c.split("_"),p=i.find(`${this._multiKanban?`.kanban[z-key="${h}"] `:""}.kanban-item[z-key="${u}"]`).children()[0];if(p&&Gs(p,{container:".kanban-lane-col"})){const{top:m,left:v,bottom:b,right:C}=p.getBoundingClientRect();l[c]={top:m+o,left:v+a,bottom:b+o,right:C+a}}}),this.setState({layout:l})}_renderLink(e){const{layout:t}=this.state,{from:i,fromKanban:s="",to:r,toKanban:o=""}=e,a=`${s}_${i}`,l=`${o}_${r}`,c=t[a],h=t[l];return this._watchSet.add(a),this._watchSet.add(l),!c||!h?null:k(xy,{...e,fromRect:c,toRect:h,onDelete:this.props.onDeleteLink},`${i}-${r}`)}_renderLinks(e){const{links:t,filters:i}=e,s=new Set(i),r=o=>{const{from:a,to:l,fromKanban:c="",toKanban:h=""}=o;return this._multiKanban?s.has(`${c}_${a}`)||s.has(`${h}_${l}`)||s.has(c)||s.has(h)||s.has(ti(o)):s.has(a)||s.has(l)||s.has(`${a}-${l}`)};return t.reduce((o,a)=>{if(!i||r(a)){const l=this._renderLink(a);l&&o.push(l)}return o},[])}_renderEditor(e){const{editLinks:t,onAddLink:i,container:s}=e;return t?k(BS,{container:s,onAddLink:i},"editor"):null}render(e){return this._watchSet.clear(),k("div",{className:"kanban-links",ref:this._ref,children:[this._renderLinks(e),this._renderEditor(e)]})}}function HS(n,e,t){if(!n||!n.length)return[];const{getCol:i,colProps:s,itemCountPerRow:r,itemGap:o}=e;let a=!1;const l=[],c=new Map;return n=n.reduce((h,u,p)=>{if(u=ke({itemGap:o,itemCountPerRow:r},s,u),i){const m=i.call(this,u);m!==!1&&(u=m||u)}return u.deleted||(typeof u.order=="number"?a=!0:u.order=p,typeof u.name!="string"&&(u.name=String(u.name)),t==null||t.call(this,u),u.parentName!==void 0?(u.parentName=String(u.parentName),l.push(u)):(c.set(u.name,u),h.push(u))),h},[]),l.forEach(h=>{const u=c.get(h.parentName);u&&(u.subCols=Mn(u.subCols,[h],"name"))}),a&&(n.sort(Pr),[...c.values()].forEach(h=>{h.subCols&&h.subCols.sort(Pr)})),n}function US(n,e,t){if(!n||!n.length)return[];const{getLane:i,laneProps:s}=e;let r=!1;return n=n.reduce((o,a,l)=>{if(s&&(a=ke({},s,a)),i){const c=i.call(this,a);c!==!1&&(a=c||a)}return a.deleted||(typeof a.order=="number"?r=!0:a.order=l,a.color===void 0&&(a.color=`hsl(${43*pc(a.name)%360}deg 40% 50%)`),typeof a.name!="string"&&(a.name=String(a.name)),t==null||t.call(this,a),o.push(a)),o},[]),r&&n.sort(Pr),n}function ky(n,e,t,i,s){if(!(n!=null&&n.length))return[];const{itemProps:r,getItem:o}=i;let a=!1;return n=n.reduce((l,c)=>{r&&(c=ke({},r,c));const h=(o==null?void 0:o.call(this,{col:t.name,lane:e.name,item:c,laneInfo:e,colInfo:t}))??c;return h!==!1&&!h.deleted&&(typeof h.order=="number"?a=!0:h.order=l.length-1,l.push(h),s==null||s.call(this,h)),l},[]),a&&n.sort(Pr),n}function Pr(n,e){return n.order-e.order}function Mn(n,e,t="key"){if(!n)return e?[...e]:[];const i=[...n];if(e){let s=0;const r=i.reduce((o,a,l)=>(o.set(String(a[t]??l),l),s=Math.max(a.order??l,s),o),new Map);e.forEach(o=>{const a=String(o[t]);r.has(a)?i[r.get(a)]={...i[r.get(a)],...o}:i.push({order:s++,...o})})}return i}function Ty(n,e){return Array.isArray(n)?n.map(t=>({...t,[e]:String(t[e])})):Object.keys(n).reduce((t,i)=>{const s=n[i];return Object.keys(s).forEach(r=>{t.push(...(s[r]||[]).map(o=>({...o,lane:i,col:r,[e]:String(o[e])})))}),t},[])}function Dy(n,e){const{items:t=[],...i}=n;return{items:Ty(t,e),...i}}function Sh(n,e,t){var a;const i=Mn(n.lanes,e.lanes,"name"),s=Mn(n.cols,e.cols,"name"),r=Mn(n.links,(a=e.links)==null?void 0:a.map(l=>(l[t]===void 0&&(l[t]=ti(l)),l)),t),o=Mn(n.items,Ty(e.items||[],t),t);return{lanes:i,cols:s,items:o,links:r}}let Lr=class extends Ke{constructor(){super(...arguments),this._ref=he(),this._raf=0,this._data=new vi(this._getData.bind(this),()=>{const{getCol:e,colProps:t,itemCountPerRow:i,itemGap:s,getLane:r,laneProps:o,itemProps:a,getItem:l,getLink:c,linkProps:h,responsive:u}=this.props;return[this._kanbanData,e,t,i,s,r,o,a,l,h,c,u]}),this._kanbanData=new vi(()=>{const{itemKey:e,props:t}=this,{data:i}=t,{data:s,changes:r}=this.state,o=(s||ql(i)?s:Dy(i,e))||{};return r?Sh(o,r,e):o},()=>{const{data:e,changes:t,selected:i}=this.state;return[e,t,i,this.props.data]}),this._handleGlobalClick=e=>{y(e.target).closest(".kanban-item").length||this.select([])},this._onAddLink=async e=>{const{onAddLink:t}=this.props;e[this.itemKey]=ti(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)},this._handleMouseMove=e=>{this._hoverTimer&&clearTimeout(this._hoverTimer);const t=this._getElementInfo(e.target),i=(t==null?void 0:t.type)==="item"?t.key:void 0;this._hoverTimer=window.setTimeout(()=>{i!==this.state.hover&&this.setState({hover:i},()=>{y(this._ref.current).trigger("kanbanItemHover",{kanban:this.props.key,hover:i})}),this._hoverTimer=0},!i&&this.state.hover?0:20)},this._handleClick=e=>{if(e.target.closest("a,button"))return;const{onClickItem:t,selectable:i}=this.props,s=this._getElementInfo(e.target);t&&(s==null?void 0:s.type)==="item"&&t.call(this,e,s)===!1||i&&(s==null?void 0:s.type)==="item"&&this.select(s.key,!0)}}get data(){return this._data.cache}get itemKey(){return this.props.itemKey||"id"}componentDidMount(){this._afterRender(!0),this.tryLoad(),this._initDraggable();const{responsive:e,selectable:t}=this.props,i=this._ref.current;if(i&&e){const s=new ResizeObserver(this.updateLayout.bind(this));y(typeof e!="boolean"?e:i.closest(".kanban-list")||i.parentElement).each((o,a)=>{s.observe(a)}),this._rob=s,this.state.containerWidth||this.updateLayout()}t&&y(document).on("click.kanban",this._handleGlobalClick)}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e,t,i;(e=this.props.beforeDestroy)==null||e.call(this),(t=this._draggable)==null||t.destroy(),(i=this._rob)==null||i.disconnect(),this.props.selectable&&y(document).off("click.kanban",this._handleGlobalClick)}getDefaultState(e){return{loading:!1,selected:(e||this.props).defaultSelected,data:void 0,changes:void 0,loadFailed:void 0}}load(){const{data:e,onLoad:t,onLoadFail:i}=this.props;this._loadedSetting=e,this.setState({loading:!0},async()=>{const s={loading:!1};try{const r=Dy(await _t(e,[this],{throws:!0}),this.itemKey);s.data=(t==null?void 0:t.call(this,r))||r}catch(r){s.loadFailed=(typeof i=="function"?i.call(this,r):i)||String(r)}this.setState(s)})}updateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0;const e=this._ref.current;if(e){const{responsive:t,laneNameWidth:i=20}=this.props,s=y(typeof t!="boolean"?t:e.closest(".kanban-list")||e.parentElement),r=s[0];let o=s.width()-i-(r.offsetWidth-r.clientWidth);const a=e.closest(".kanban-region");a&&(o-=a.clientWidth-y(a).width()),this.setState({containerWidth:o})}})}tryLoad(){const{loading:e}=this.state,{data:t}=this.props;e||!t||!ql(t)||t===this._loadedSetting||this.load()}getCol(e){return this.data.colMap.get(String(e))}getLane(e){return e=String(e),this.data.lanes.find(t=>t.name===e)}getItem(e){return this.data.map.get(String(e))}update(e){return this.changeState(t=>({changes:Sh({...t.changes},e,this.itemKey)}))}createSnap(){return{date:Date.now(),kanban:this,data:y.extend(!0,{},this._data),restore(){this.kanban.changeState({changes:this.data})}}}addItem(e,t,i){return this.updateItem(e,t,i)}updateItem(e,t,i){const s=Array.isArray(e)?e:[e];return this.update({items:t||i?s.map(r=>({...r,lane:t??r.lane,col:i??r.col})):s})}deleteItem(e){return this.updateItem(Array.isArray(e)?e.map(t=>({[this.props.itemKey||"id"]:t,deleted:!0})):{[this.itemKey]:e,deleted:!0})}updateLane(e){return this.update({lanes:Array.isArray(e)?e:[e]})}addLane(e){return this.updateLane(e)}deleteLane(e){return this.updateLane(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateCol(e){return this.update({cols:Array.isArray(e)?e:[e]})}addCol(e){return this.updateCol(e)}deleteCol(e){return this.updateCol(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateLink(e,t){return this.update({links:(Array.isArray(e)?e:[e]).map(i=>({deleted:!1,...i,...t,[this.itemKey]:ti(i)}))})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}select(e,t){let i=Array.isArray(e)?e:e?[e]:[],s=this.state.selected||[];const{onSelect:r}=this.props;return this.changeState(o=>{if(s=o.selected||[],t){const a=new Set(s),l=new Set;return i.forEach(c=>{a.has(c)?a.delete(c):l.add(c)}),i=[...a,...l],{selected:i}}return{selected:i}},()=>{r==null||r(i,s),y(this._ref.current).trigger("kanbanItemSelected",{kanban:this.props.key,selected:i,oldSelected:s})})}_getElementInfo(e){const t=y(e),i=t.closest(".kanban-item");if(i.length){const a=i.attr("z-key");if(a){const l=this.getItem(a);if(l)return{type:"item",key:a,element:e,item:l,lane:l.lane,col:l.col}}}if(t.closest(".kanban-new-item").length)return{type:"newItem",element:e};const r=t.closest(".kanban-header-col,.kanban-lane-col");if(r.length)return{type:"col",element:e,col:r.attr("z-col"),lane:r.attr("z-lane")};const o=t.closest(".kanban-lane").attr("z-lane");if(o!==void 0)return{type:"lane",element:e,lane:o}}_getDropInfo(e,t,i){const s=this._getElementInfo(t);if(!s)return;const r=this._getElementInfo(i);if(!r||r.element.closest(".kanban")!==this.element)return;let o;if(s.type==="item"&&r.type==="col")o="inside";else{const a=i.getBoundingClientRect();s.type==="col"?o=e.clientX<a.left+a.width/2?"before":"after":o=e.clientY<a.top+a.height/2?"before":"after"}return{side:o,event:e,drag:s,drop:r}}_getDropChanges(e){const{drag:t,drop:i}=e,s=this.data,r={},{itemKey:o}=this,a={list:[],lane:i.lane,col:i.col};if(t.type==="item"){const l=t.item,c=s.items[i.lane][i.col],h=[...c],u={[o]:l[o],order:l.order},p=i.col===l.col,m=i.lane===l.lane;if(p&&m&&l[o]===i.item[o])return{changes:r,data:a};p||(u.col=i.col),m||(u.lane=i.lane);let v=!1;if(i.type==="col"&&(!m||!p))h.push(u),v=!0;else if(i.type==="item"){const b=i.item,C=i.col!==l.col||i.lane!==l.lane?-1:h.findIndex(D=>D[o]===l[o]);C>=0&&h.splice(C,1);const S=h.findIndex(D=>D[o]===b[o]);h.splice(e.side==="before"?S:S+1,0,u),v=!0}if(v){r.items=[];let b=-1;h.forEach((C,S)=>{const D=Math.max(0,b+1,C.order??S),N=c[S];b=D,(N!==C||D!==N.order)&&(C={...C,order:D}),C!==N&&r.items.push(C),a.list.push(C[o])})}}else if(t.type==="newItem"){const{onDropNewItem:l}=this.props;let c;if(l?c=l.call(this,e):(c=y(t.element).data(),c!=null&&c.item&&(c=c.item)),c={lane:i.lane,col:i.col,...c},c!=null&&c[o]){const u=[...s.items[i.lane][i.col]];u.push(c),r.items=u,a.list.push(c[o])}}return{changes:r,data:a}}_initDraggable(){const{draggable:e}=this.props,t=this._ref.current;if(!e||!t)return;const{dragTypes:i=["item","newItem"],onDragStart:s,onDrop:r,canDrop:o,dropRules:a}=this.props,l=typeof i=="string"?i.split(","):i,c={item:".kanban-item",lane:".kanban-lane-name",col:".kanban-header-col",newItem:".kanban-new-item"},h=typeof e=="object"?e:{},u=(m,v)=>{y(m).attr({"z-drag-type":v?v.drag.type:null,"z-drop-type":v?v.drop.type:null,"z-drop-side":v?v.side:null})},p={...h,selector:h.selector||l.map(m=>c[m]||"").filter(Boolean).join(","),target:h.target||(m=>{const v=this._getElementInfo(m);if(!v)return;const b={lane:".kanban-lane",col:".kanban-header-col",item:".kanban-item,.kanban-items",newItem:".kanban-item,.kanban-items"}[v.type];return y(t).find(b)}),canDrop:h.canDrop||o||a?(m,v,b)=>{const C=this._getElementInfo(v);if(!C)return!1;const S=this._getElementInfo(b);if(!S||S.element.closest(".kanban")!==this.element)return!1;if(C.type==="item"&&a){const D=C.col,N=S.col,P=C.lane,H=S.lane,q=a[`${P}:${D}`]??a[D];return typeof q=="boolean"?q:!q||q.includes(N)||q.includes(`${H}:${N}`)||q.includes(`${H}:`)}if(o)return o.call(this,C,S)}:void 0,onDragStart:(m,v)=>{var C;const b=this._getElementInfo(v);return b?s?s.call(this,{event:m,drag:b}):(C=h.onDragStart)==null?void 0:C.call(this,m,v):!1},onDragOver:(m,v,b)=>{const C=this._getDropInfo(m,v,b);C&&u(b,C)},onDragLeave:(m,v,b)=>{u(b)},onDrop:(m,v,b)=>{var S;u(b);const C=this._getDropInfo(m,v,b);if(!C)return!1;if(r){const{changes:D,data:N}=this._getDropChanges(C);if(Object.keys(D).length){C.data=N;const P=this.createSnap();r.call(this,D,C,P.restore)!==!1&&this.update(D)}}return(S=h.onDrop)==null?void 0:S.call(this,m,v,b)}};this._draggable=new sr(t,p)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_getData(){const{itemKey:e,props:t}=this,i=this._kanbanData.value;let s=!1;const{items:r=[]}=i,o={},a=new Map,l=HS.call(this,i.cols,t,C=>{C.parentName!==void 0&&(s=!0),a.set(C.name,C)}),c=US.call(this,i.lanes,t,C=>{o[C.name]=l.reduce((S,D)=>(D.subCols?D.subCols.forEach(N=>{S[N.name]=[]}):S[D.name]=[],S),{})}),h=new Set,u=r.reduce((C,S)=>{if(S.deleted)return h.add(S[e]),C;C.set(S[e],S);const D=o[S.lane];if(D){const N=D[S.col];N&&N.push(S)}return C},new Map),{selected:p=[]}=this.state,m=new Set(p),v=C=>{C.selected=m.has(C[e])};c.forEach(C=>{const S=o[C.name];S&&l.forEach(D=>{var N;S[D.name]=ky.call(this,S[D.name],C,D,t,v),(N=D.subCols)==null||N.forEach(P=>{S[P.name]=ky.call(this,S[P.name],C,P,t,v)})})});let{links:b=[]}=i;return b=b.reduce((C,S)=>{var D;if(!S.deleted&&u.has(S.from)&&u.has(S.to)&&!h.has(S.from)&&!h.has(S.to)){S[e]===void 0&&(S[e]=ti(S));const N=((D=t.getLink)==null?void 0:D.call(this,S))??S;N!==!1&&!N.deleted&&C.push(N)}return C},[]),{cols:l,lanes:c,items:o,map:u,colMap:a,links:b,hasSubCols:s}}_layoutCols(e,t){const{containerWidth:i=0}=this.state,{colsGap:s=8,minColWidth:r=150,maxColWidth:o=600,colWidth:a=200}=t,l=[];let c=0;const h=u=>{const{minWidth:p=r,maxWidth:m=o}=u;let{width:v=a}=u;typeof v=="function"&&(v=v.call(this,u));const b=v==="auto";if(b)v=p;else{const[C,S]=xi(v);S==="%"?v=i*C/100:v=C}return v=Math.min(m,Math.max(p,v)),c+=v+(c?s:0),u={...u,width:v,maxWidth:m,minWidth:p},b&&l.push(u),u};if(e=e.map(u=>u.subCols?{...u,subCols:u.subCols.map(h)}:h(u)),l.length&&c<i){const u=Math.floor((i-c)/l.length);l.forEach(p=>{p.width=Math.min(p.maxWidth,Math.max(p.minWidth,p.width+u))})}return e}_layoutLanes(e,t){const{laneHeight:i,maxLaneHeight:s,minLaneHeight:r}=t;return!i&&!s&&!r?e:e.map(o=>({height:typeof i=="function"?i.call(this,o):i,maxHeight:s,minHeight:r,...o}))}_getClassName(e){return["kanban",e.className,e.sticky?"kanban-sticky":"",this.data.hasSubCols?"has-sub-cols":""]}_getProps(e){const{laneNameWidth:t,colsGap:i,lanesGap:s,selectable:r,onClickItem:o,showLinkOnHover:a}=e;return ke(super._getProps(e),{ref:this._ref,style:{"--kanban-lane-name-width":t,"--kanban-cols-gap":Ge(i),"--kanban-lanes-gap":Ge(s)},onClick:o||r?this._handleClick:void 0,onMouseMove:a?this._handleMouseMove:void 0})}_renderLinks(e){const{links:t=[]}=this.data,{editLinks:i}=e;if(!i&&!t.length)return;const{showLinkOnHover:s,showLinkOnSelected:r}=e;let o;if(r||s){o=[];const{selected:a,hover:l}=this.state;r&&a&&o.push(...a),s&&l&&o.push(l),o=[...new Set(o)]}return k(Sy,{links:t,filters:o,editLinks:i,onDeleteLink:i?this._onDeleteLink:void 0,onAddLink:i?this._onAddLink:void 0},"links")}_getChildren(e){const t=this._data.value,{cols:i,lanes:s,items:r}=t,{laneNameWidth:o}=e,a=this._layoutCols(i,e),l=this._layoutLanes(s,e);return[k(NS,{cols:a},"header"),k(PS,{itemRender:e.itemRender,getLaneCol:e.getLaneCol,cols:a,lanes:l,items:r,hideLaneName:o===0},"body"),this._renderLinks(e),e.children]}};Lr.defaultProps={draggable:!0,sticky:!0,responsive:!0,itemKey:"id",colWidth:200,colsGap:8},Lr.customProps=["onDrop","onDragStart"];class Iy extends Ke{constructor(){super(...arguments),this._kanbanRefs=new Map,this._needUpdateData=new Map,this._handleClickHeading=e=>{y(e.target).closest("a,.btn,button").not(".kanban-region-toggle").length||this.setState(t=>({collapsed:!t.collapsed}))}}componentDidUpdate(){if(this.state.collapsed)return;const e=this._needUpdateData;[...e.keys()].forEach(t=>{const i=this.getKanban(t);i&&(i.update(e.get(t)),e.delete(t))})}getDefaultState(e){return{collapsed:(e||this.props).collapsed,heading:void 0,items:void 0}}resetState(e,t){this._kanbanRefs.forEach(i=>{var s;return(s=i.current)==null?void 0:s.resetState()}),super.resetState(e,t)}getKanban(e){var t;return(t=this._kanbanRefs.get(String(e)))==null?void 0:t.current}toggle(e){this.setState(t=>({collapsed:e===void 0?!t.collapsed:!e}))}update(e){const{items:t}=e;return t&&(e={...e},e.items=t.map((i,s)=>{const r=String(i.key||s);return i.deleted?{key:r,deleted:!0}:(i.data&&typeof i.data=="object"&&this.getKanban(r)&&(this._needUpdateKanban(r,i.data),i={...i},delete i.data),i)})),new Promise(i=>{this.setState(e.items?s=>({...e,items:Mn(s.items,e.items)}):e,i)})}_needUpdateKanban(e,t){const i=this._needUpdateData,s=i.get(e),{kanbanItemKey:r="key"}=this.props;i.set(e,Sh(s||{},t,r))}_buildItems(e){const{items:t=[],kanbanProps:i,kanbanItemKey:s="key"}=e;let{items:r}=this.state;r?(r=Mn(t,r,s).filter(c=>!c.deleted),r.sort(Pr)):r=t;const o=this._kanbanRefs,a=new Set(o.keys()),l=r.map((c,h)=>{if(c.deleted)return null;const u=ke({className:"kanban-region-item",key:h},typeof i=="function"?i.call(this,c,h):i,c),p=String(u.key);let m=o.get(p);return m||(m=he(),o.set(p,m)),u.ref=m,a.delete(p),k(Lr,{"z-key":p,...u})});return a.forEach(c=>{o.delete(c)}),l}_getClassName(e){return["kanban-region",e.className,this.state.collapsed?"is-collapsed":"is-expanded",e.heading?"has-heading":""]}_getChildren(e){const{heading:t,toggleFromHeading:i}=e,{collapsed:s,heading:r}=this.state,o=ke({className:"kanban-heading",onClick:i?this._handleClickHeading:void 0},typeof t=="function"?t.call(this):t,r);return[t&&k(hn,{...o},"heading"),s?null:this._buildItems(e)]}}const kh=".kanban";let $y=class extends Ke{constructor(){super(...arguments),this.state={},this._ref=he(),this._kanbanRefs=new Map,this._onAddLink=async e=>{const{onAddLink:t,linkItemKey:i}=this.props;e[i]=ti(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)}}componentDidMount(){const e=this._ref.current;if(e){const{moveable:t,responsive:i,showLinkOnSelected:s,showLinkOnHover:r}=this.props;if(t&&(this._moveable=new rr(e,y.extend({selector:"self",move:"scroll",onMoveStart:(o,a)=>{const{bottom:l,right:c}=a.getBoundingClientRect();return o.clientY<l&&o.clientY>l-20||o.clientX<c&&o.clientX>c-20?!1:!y(o.target).closest("a,input,.btn,.state,.kanban-item,.not-moveable").length}},typeof t=="object"?t:null))),s&&y(e).on(`kanbanItemSelected${kh}`,(o,a)=>{this.setState(l=>({selected:{...l.selected,[a.kanban]:a.selected}}))}),r&&y(e).on(`kanbanItemHover${kh}`,(o,{kanban:a,hover:l})=>{this.setState({hover:l===void 0?l:`${a}_${l}`})}),i){const o=new ResizeObserver(this._tryUpdateLayout.bind(this));(typeof i!="boolean"?y(i):y(e).parent()).each((l,c)=>{o.observe(c)}),this._rob=o}}}componentWillUnmount(){var t,i;(t=this._moveable)==null||t.destroy(),(i=this._rob)==null||i.disconnect();const e=this._ref.current;e&&y(e).off(kh)}getDefaultState(e){return{linkChanges:void 0}}resetState(e,t){this._kanbanRefs.forEach(i=>{var s;(s=i.current)==null||s.resetState()}),super.resetState(e,t)}getKanban(e){const t=String(e),i=this._kanbanRefs;if(i.has(t))return i.get(t).current;let s=null;const r=Array.from(i.values());for(const o of r){const a=o.current;if(a instanceof Iy&&(s=a.getKanban(e),s))break}return s||null}updateKanban(e,t){const i=this.getKanban(e);return i?i.update(t):Promise.reject(new Error(`[ZUI] Kanban not found: ${e}`))}updateLayout(){const e=this._ref.current;if(!e)return;const t=y(e),i=t.width(),s=t.height();this.setState({width:i,height:s})}updateLink(e,t){return this.changeState(i=>{let s=Array.isArray(e)?e:[e];return t&&(s=s.map(r=>({...r,...t}))),{linkChanges:Mn(i.linkChanges,s,this.props.linkItemKey)}})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}_tryUpdateLayout(){this._layoutTimer&&cancelAnimationFrame(this._layoutTimer),this._layoutTimer=requestAnimationFrame(()=>{this.updateLayout(),this._layoutTimer=0})}_getClassName(e){return["kanban-list",e.className,e.sticky?"has-sticky":"",e.moveable?"is-moveable":"",e.scrollbarHover?"scrollbar-hover":""]}_getProps(e){const{width:t,height:i}=e,s=typeof t=="function"?t.call(this):t,r=typeof i=="function"?i.call(this):i,{width:o,height:a}=this.state??{};return ke(super._getProps(e),{ref:this._ref,style:{width:s,height:r,"--kanban-list-width":`${o||t}px`,"--kanban-list-height":`${a||i}px`}})}_getLinks(e){const{linkChanges:t=[]}=this.state,{links:i=[],getLink:s,linkItemKey:r}=e;return Mn(i,t,this.props.linkItemKey).reduce((o,a)=>{const l=s==null?void 0:s.call(this,a);return l!==!1&&(a=l||a,a.deleted||(a[r]||(a[r]=ti(a)),o.push(a))),o},[])}_renderLinks(e){const t=this._getLinks(e),{editLinks:i}=e;if(!i&&!t.length)return;const{showLinkOnHover:s,showLinkOnSelected:r}=e;let o;if(t.length&&(r||s)){o=[];const{selected:a={},hover:l}=this.state;r&&a&&Object.keys(a).forEach(c=>{const h=a[c];h.length&&o.push(...h.map(u=>`${c}_${u}`))}),s&&l&&o.push(l),o=[...new Set(o)]}return k(Sy,{container:".kanban-list",links:t,filters:o,editLinks:i,onDeleteLink:i?this._onDeleteLink:void 0,onAddLink:i?this._onAddLink:void 0},"links")}_getChildren(e){const{items:t=[],kanbanProps:i,showLinkOnSelected:s,showLinkOnHover:r,selectable:o,editLinks:a}=e,l=this._kanbanRefs,c=new Set(l.keys()),h=[...t.map((p,m)=>{i&&(p=typeof i=="function"?i.call(this,p,m):y.extend({},i,p));const v=String(p.key??m);let b=l.get(v);b||(b=he(),l.set(v,b)),c.delete(v);const C=p.heading!==void 0||p.items;return(s||r||o)&&(C?p.kanbanProps={showLinkOnSelected:s,showLinkOnHover:r,selectable:o,...p.kanbanProps}:p={showLinkOnSelected:s,showLinkOnHover:r,selectable:o,...p}),a&&(C?p.items=(p.items||[]).map(D=>({...D,editLinks:!1})):p={...p,editLinks:!1}),k(C?Iy:Lr,{ref:b,sticky:e.sticky,...p,"z-key":v},v)}),e.children];c.forEach(p=>{l.delete(p)});const u=this._renderLinks(e);return u&&h.push(u),h}};$y.defaultProps={moveable:!0,sticky:!0,responsive:!0,scrollbarHover:!0,linkItemKey:"id"};class Rr extends ve{}Rr.NAME="Kanban",Rr.replace=!0,Rr.Component=Lr,Rr.register();class Or extends ve{update(e,t){if(e=Array.isArray(e)?e:[e],t)return this.render({items:e});const i=this.options.items||[],s=new Map(i.map((o,a)=>[o.key,a])),r=[...i];return e.forEach(o=>{if(s.has(o.key)){const a=s.get(o.key);r[a]={...i[a],...o}}else r.push(o)}),this.render({items:r.filter(o=>!o.deleted)})}}Or.NAME="KanbanList",Or.replace=!0,Or.Component=$y,Or.register();const y$="",v$="",_$="",b$="",w$="",C$="",x$="",S$="",k$="",T$="",WS="nav",Th='[data-toggle="tab"]',VS="active";class Fr extends We{constructor(){super(...arguments),this._timer=0}active(e){const t=this.$element,i=t.find(Th);let s=e?y(e).closest(Th):i.filter(`.${VS}`);if(!s.length&&(s=t.find(Th).first(),!s.length))return;i.removeClass("active"),s.addClass("active");const r=s.attr("href")||s.data("target"),o=s.data("name")||r,a=t.closest(".tabs"),l=a.length?a.find(r):y(r);l.length&&(l.parent().children(".tab-pane").removeClass("active in"),l.addClass("active").trigger("show",[o]),this.emit("show",o),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{l.addClass("in").trigger("shown",[o]),this.emit("shown",o),this._timer=0},10))}}Fr.NAME="Tabs",Fr.toggle={name:"tab",handler(n,e){const t=y(n),i=t.closest(`.${WS}`);i.length&&Fr.ensure(i,e).active(t)}},Fr.register();function KS(n){const[e,t]=n.split(":"),i=e[0]==="-"?{name:e.substring(1),disabled:!0}:{name:e};return t!=null&&t.length&&(i.type="dropdown",i.items=t.split(",").reduce((s,r)=>(r=r.trim(),r.length&&s.push(r[0]==="-"?{name:r.substring(1),disabled:!0}:{name:r}),s),[])),i}const qS=(n,e)=>{var s;n.url&&(n.url=we(n.url,e.row.data));const t={row:e.row.id,col:e.col.name},i=((s=n.dropdown)==null?void 0:s.items)||n.items;return i&&i.forEach(r=>(r.url&&(r.url=we(r.url,e.row.data)),r.data=t,r)),n.data=t,n},Ay=n=>n?(typeof n=="string"&&(n=n.split("|")),n.map(e=>typeof e=="string"?KS(e):e).filter(Boolean)):[],GS=He({name:"actions",colTypes:{actions:{onRenderCell(n,e){var h;const{row:t,col:i}=e,s=Ay(((h=t.data)==null?void 0:h[i.name])||i.setting.actions);if(!s.length)return n;const{actionsSetting:r,actionsMap:o,actionsCreator:a=this.options.actionsCreator,actionItemCreator:l=this.options.actionItemCreator||qS}=i.setting,c={items:(a==null?void 0:a(e))??s.map(u=>{const{name:p,...m}=u;if(o&&p){Object.assign(m,o[p],{...m});const{buildProps:b}=m;typeof b=="function"&&(delete m.buildProps,Object.assign(m,b(n,e)))}const{items:v}=m;if(m.disabled&&(delete m.url,delete m["data-toggle"]),v&&m.type==="dropdown"){const{dropdown:b={placement:"bottom-end"}}=m;b.menu={className:"menu-dtable-actions"},b.items=v.map(C=>{const S=typeof C=="string"?{name:C}:{...C};return S.name&&o&&o[S.name]&&Object.assign(S,o[S.name],{...S}),S.disabled?(delete S.url,delete S["data-toggle"]):S.url&&(S.url=we(S.url,t.data)),S}),m.dropdown=b,delete m.items}return l?l(m,e):m}),btnProps:{btnType:"ghost",size:"sm",className:"text-primary"},...r};return n[0]=k(Be,{...c}),n}}},beforeLayout(n){!Array.isArray(n.data)||!n.data.length||n.cols.forEach((e,t)=>{if(e.type!=="actions"||e.width)return;const{actionsMap:i={}}=e,r=Ay(n.data[0][e.name]).reduce((o,a)=>{const l=a.name?i[a.name]:null;return l&&l.type==="dropdown"&&l.caret&&!l.text?o+16:o+24},24);n.cols[t]={...e,width:r}})}}),YS=He({name:"toolbar",footer:{toolbar(){const{footToolbar:n,showToolbarOnChecked:e}=this.options;return e&&!this.getChecks().length?[]:[n?Be.render(n,[this],{gap:2}):null]}}}),$$="",Ey=function(n,e){var s,r;const{col:t}=e,{sortColFrom:i}=this.state;if(i){i.name===t.name&&n.push({outer:!0,className:"is-sorting-from-col"});const o=(r=(s=this.data.sortColInfo)==null?void 0:s.colOffsetMap)==null?void 0:r[t.name];typeof o=="number"&&n.push({outer:!0,className:"is-sorting-col-move",style:{left:t.left+o}})}return n},XS=He({name:"sort-col",when:n=>!!n.sortCol,plugins:[Nr,wh],resetState:!0,state(){return{colOrders:{},sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0}},events:{mousedown(n){var r;if(this.data.disableSortCol)return;const e=this.getPointerInfo(n);if(!e||e.rowID!=="HEADER")return;const t=this.getColInfo(e.colName);if(!t||((r=this.options.onSortColStart)==null?void 0:r.call(this,t,n))===!1)return;y(n.target).closest("a,button,img").attr("draggable","false").length&&n.preventDefault(),n.preventDefault();const i=n.clientX,{cellElement:s}=e;this.data.sortColInfo={from:t,element:s,offset:i-s.getBoundingClientRect().left,startMouseX:i,lastMouseX:i},y(s).zuiCall("ContextMenu.hide")},document_mouseup(n){var i;const{sortColInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingColState(n);if(t){let s,r;const{from:o,to:a,side:l}=t;if(a){if(o.name===a.name)s={};else if(l){const c=this.layout.cols[o.side].list,h=o.sideIndex,u=a.sideIndex,p=c.splice(h,1);c.splice(u+(l==="after"?1:0),0,p[0]),s={},r=[],c.forEach(({name:m},v)=>{s[m]=v+1,r.push(m)}),((i=this.options.onSortCol)==null?void 0:i.call(this,o,a,l,r))===!1&&(s=void 0,r=void 0)}Math.abs(e.lastMouseX-e.startMouseX)>4&&this.ignoreNextClick()}this.disableAnimation(),this.update({dirtyType:"layout",state:y.extend({sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0},s?{colOrders:{...this.state.colOrders,...s}}:null)},()=>{var c;(c=this.options.onSortColEnd)==null||c.call(this,o,a,l,r)})}this.data.sortColInfo=void 0},document_mousemovesmooth(n){const{sortColInfo:e}=this.data;if(!e)return;const t=this.getSortingColState(n);t&&(e.state||this.startScrollToMouse({side:"x"}),e.lastMouseX=n.clientX,e.state=t,this.setState({sortColFrom:t.from,sortingColPos:t.pos,sortingColTo:t.to,sortingColSide:t.side}))}},methods:{getSortingColState(n){var C;const{disableSortCol:e,sortColInfo:t}=this.data;if(e||!t)return;const{from:i,element:s}=t,o=y(s).closest(".dtable-cells")[0].getBoundingClientRect(),a=n.clientX-o.left,{cols:l,scrollLeft:c}=this.layout,h=l[i.side].list;if(h.length<=1)return t.state;const u=c+a,p=h.find(S=>S.visible&&S.left<=u&&S.left+S.width>u);if(!p)return t.state;const m=u<p.left+p.width/2?"before":"after";return i.side===p.side&&((C=this.options.canSortColTo)==null?void 0:C.call(this,i,p,m))!==!1?{from:i,pos:a+c,to:p,side:i.name!==p.name?m:void 0}:{from:i,pos:a,to:void 0,side:void 0}}},onAddCol(n){const{colOrders:e={}}=this.state,t=e[n.name];t!==void 0&&(n.order=t)},beforeRender(n){const{sortColFrom:e,sortingColTo:t,sortingColSide:i}=this.state;if(e&&t){n.className=V(n.className,"has-sorting-col");const s=[...n.cols[e.side].list],r=e.sideIndex,o=t.sideIndex,a=s.splice(r,1);s.splice(o+(i==="after"?1:0),0,a[0]);let l=0;const c={};s.forEach(h=>{const u=l-h.left;u&&(c[h.name]=u),l+=h.realWidth}),this.data.sortColInfo.colOffsetMap=c}},onRenderHeaderCell(n,e,t,i){const{sortCol:s}=this.options;return s&&(this.layout.cols[e.col.side].list.length>1&&(s===!0||Array.isArray(s)&&s.includes(e.col.name)||typeof s=="function"&&s.call(this,e.col))&&n.push({outer:!0,className:"is-sortable-col"}),n=Ey.call(this,n,e,t,i)),n},onRenderCell:Ey}),E$="";function Ny(n,e,t){const{colResizing:i}=n.state;if(!i)return;const s=Math.round(e.clientX-i.startX);if(!s&&!t)return;const r={};t&&(r.colResizing=void 0);const{colName:o}=i;let a=n.getColInfo(o);if(!a)return n.update({dirtyType:"layout",state:r});r.colsSizes={...n.state.colsSizes,[o]:i.startSize+s},n.update({dirtyType:"layout",state:r},t?()=>{var l;if(a=n.getColInfo(o),a){const c=n.data.colOriginSize.get(o);(l=n.options.onColResize)==null||l.call(n,o,a.width-c,a)}}:void 0),e.stopPropagation(),e.preventDefault()}const My=He({name:"resize",when:n=>!!n.colResize,plugins:[Nr],resetState(n){var e;return{colsSizes:((e=n.cols)==null?void 0:e.reduce((t,i)=>(i.extraWidth!==void 0&&(t[i.name]=i.extraWidth),t),{}))||{}}},state(){var n;return{colsSizes:((n=this.props.cols)==null?void 0:n.reduce((e,t)=>(t.extraWidth!==void 0&&(e[t.name]=t.extraWidth),e),{}))||{}}},data(){return{colOriginSize:new Map}},events:{mousedown(n){const e=n.target.closest(".dtable-col-splitter");if(!e)return;const t=e.closest(".dtable-cell"),i=t==null?void 0:t.dataset.col;if(i)return this.setState({colResizing:{colName:i,startSize:this.state.colsSizes[i]??0,startX:n.clientX}},()=>{y(t).zuiCall("ContextMenu.hide")}),!1},dblclick(n){var s;const e=n.target.closest(".dtable-col-splitter");if(!e)return;const t=(s=e.closest(".dtable-cell"))==null?void 0:s.dataset.col;if(!t)return;const{colsSizes:i}=this.state;i[t]&&(delete i[t],this.update({dirtyType:"layout",state:{colResizing:void 0,colsSizes:{...i}}},()=>{var r;(r=this.options.onColResize)==null||r.call(this,t,0,this.getColInfo(t))}))},document_mouseup(n){if(this.state.colResizing)return Ny(this,n,!0),!1},document_mousemovesmooth(n){if(this.state.colResizing)return Ny(this,n),!1}},methods:{isColResizable(n){if(typeof n=="string"&&(n=this.getColInfo(n)),!n||n.side!=="left"&&n.sideIndex===this.layout.cols[n.side].list.length-1)return;let e=n.setting.colResize??this.options.colResize;return typeof e=="function"&&(e=e.call(this,n.name)),!!e}},onRenderHeaderCell(n,{col:e}){var t;return this.isColResizable(e)&&(n.push({className:"has-col-splitter",children:k("div",{className:"dtable-col-splitter no-cell-event"}),outer:!0}),((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&n.push({className:"has-col-resizing",outer:!0})),n},onRenderCell(n,{col:e}){var t;return((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&n.push({className:"is-col-resizing",outer:!0}),n},onAddCol(n){const e=this.state.colsSizes[n.name]??n.setting.extraWidth;typeof e=="number"&&(this.data.colOriginSize.set(n.name,n.width),n.width=lg(n.width+e,n.setting.minWidth,n.setting.maxWidth))},onRender(){if(this.state.colResizing)return{className:"has-col-resizing"}}}),M$="",QS=He({name:"contextmenu",when:n=>!!n.contextmenu,events:{contextmenu(n){const e=this.getPointerInfo(n);if(!e)return;const t=this.getContextMenuItems(n,e);if(!t||!t.length)return;n.preventDefault();const i=y(e.cellElement).addClass("has-contextmenu-show");e.cellElement.classList.add("active"),As.show({items:t,key:`dtable-ctx-${this.id}`,triggerEvent:n,hideOthers:!0,onHide(){i.removeClass("has-contextmenu-show")}})}},methods:{getContextMenuItems(n,e){const{contextmenu:t}=this.options;if(typeof t=="function")return t.call(this,n,e);if(!t||Array.isArray(t))return t;const{header:i,cell:s}=t;return e.rowID==="HEADER"?typeof i=="function"?i.call(this,n,e):i:typeof s=="function"?s.call(this,n,e):s}}});function Py(n,e){if(typeof e=="string"&&(e=n.getColInfo.call(n,e)),!e)return{};const{colBorders:t}=n.state,{side:i,sideIndex:s}=e,r=n.layout.cols[i].list,o=s>0?r[s-1]:null,a=r[s+1];return{prevName:o==null?void 0:o.name,nextName:a==null?void 0:a.name,prev:o?t[o.name]??o.setting.border:void 0,next:a?t[a.name]??a.setting.border:void 0}}function Es(n,e){return n===e||n===!0}const JS=He({name:"custom-col",when:n=>!!n.customCol,plugins:[QS],resetState:!0,options(n){return n.customCol&&!n.contextmenu&&(n.contextmenu={header:(e,t)=>{var o,a;const i=this.getColBorder(t.colName),s=l=>{const c={width:"12px",margin:"0 2px",height:"12px",border:"1px dotted var(--color-border-strong)"},h="2px solid var(--color-border-strong)";return l==="left"?c.borderLeft=h:l==="right"?c.borderRight=h:l===!0&&(c.borderLeft=h,c.borderRight=h),k("span",{style:c})},r=((o=this.getColInfo(t.colName))==null?void 0:o.setting.required)||!((a=this.options.canSetColVisibility)!=null&&a.call(this,t.colName,!1));return[{icon:s(i),text:this.i18n("setDivider"),items:[{text:this.i18n("leftDivider"),icon:s("left"),selected:i==="left",onClick:()=>this.setColBorder(t.colName,"left")},{text:this.i18n("rightDivider"),icon:s("right"),selected:i==="right",onClick:()=>this.setColBorder(t.colName,"right")},{text:this.i18n("allDivider"),icon:s(!0),selected:i===!0,onClick:()=>this.setColBorder(t.colName,!0)},{text:this.i18n("noDivider"),icon:s(!1),selected:!i,onClick:()=>this.setColBorder(t.colName,!1)}]},{text:this.i18n("hideCol"),icon:"eye-off",disabled:r,onClick:r?void 0:()=>this.setColVisibility(t.colName,!1)}]}}),n},state(){return{colBorders:{},colVisibility:{}}},methods:{getColBorder(n,e=!0){const t=this.getColInfo(n);if(!t)return!1;const{colBorders:i}=this.state,s=i[n]??t.setting.border;if(s===!0||!e)return s;const{prev:r,next:o}=Py(this,t),a=s==="left"||Es(r,"right"),l=s==="right"||Es(o,"left");return a&&l?!0:a?"left":l?"right":!1},setColBorder(n,e){if(this.getColBorder(n,!1)===e)return;const{onSetColBorder:i}=this.options,{prev:s,next:r,prevName:o,nextName:a}=Py(this,n);this.update({dirtyType:"layout",state:l=>{const c={...l.colBorders,[n]:e};return!Es(e,"left")&&Es(s,"right")&&(c[o]=!1),!Es(e,"right")&&Es(r,"left")&&(c[a]=!1),{colBorders:c}}},i?()=>{i.call(this,n,e,this.state.colBorders)}:void 0)},setColVisibility(n,e){const{onSetColVisibility:t}=this.options;this.update({dirtyType:"options",state:i=>({colVisibility:{...i.colVisibility,[n]:e}})},t?()=>{t.call(this,n,e)}:void 0)}},onAddCol(n){const{colBorders:e}=this.state;e[n.name]!==void 0&&(n.border=e[n.name])},beforeLayout(n){const{colVisibility:e}=this.state;Object.keys(e).length&&n.cols&&(n.cols=n.cols.map(t=>(e[t.name]!==void 0&&(t={...t,hidden:!e[t.name]}),t)))},i18n:{zh_cn:{setDivider:"设置分割线",leftDivider:"左侧",rightDivider:"右侧",allDivider:"两侧",noDivider:"无",hideCol:"隐藏此列"},zh_tw:{setDivider:"設置分割線",leftDivider:"左側",rightDivider:"右側",allDivider:"兩側",noDivider:"無",hideCol:"隱藏此列"},en:{setDivider:"Set divider",leftDivider:"Left Side",rightDivider:"Right Side",allDivider:"Both Sides",noDivider:"No Divider",hideCol:"Hide this column"}}}),R$="";function Dh(n,e,t){if(t){if(typeof t=="object"){const i=t[n];return typeof i=="string"?i:typeof i=="object"&&i?i.realname:void 0}if(typeof t=="function")return t(n,e)}}function Ly(n,e,t){let i;if(typeof n=="function"?i=n(e,t):typeof n=="object"&&(i=n[e]),i)return w($e,{className:"dtable-cell-icon",icon:i})}He({name:"zentao",plugins:["group","checkable","nested",GS,YS,vy,XS,My,JS],defaultOptions:{colHover:"header",rowHeight:36,striped:!1,responsive:"window,parent,.search-form,~document_layout",checkable:"auto",nested:"auto",width:"100%",footer:void 0,showToolbarOnChecked:!0,checkOnClickRow:!0,groupDivider:!0,preserveNested:!0,extraHeight:"+",height(n){var r;const e=(r=this.element)==null?void 0:r.closest(".modal-dialog"),t=y(e||"body");let i=this.options.extraHeight;typeof i=="string"&&(i[0]==="+"&&(i=(e?".modal-header,.modal-footer,.search-form,36,#featureBar,":"#header,#mainMenu,#mainNavbar,.search-form,")+i.slice(1)),i=i.split(",")),Array.isArray(i)||(i=[i]);const s=i.reduce((o,a)=>a?typeof a=="number"||/^\d+$/.test(a)?o+Number(a):o+(t.find(a).outerHeight()||0):o,0);return Math.min(n,window.innerHeight-(e?64:1)-s)}},options(n){var l;const{checkable:e,footToolbar:t,footPager:i,footer:s}=n;if(s===void 0){const c=[];if(e&&c.push("checkbox"),t){const h=Array.isArray(t)?{items:t}:t;c.push("toolbar"),h.btnProps=y.extend({btnType:"primary",size:"sm"},h.btnProps),typeof h=="object"&&(typeof h.items=="function"&&(h.items=h.items.call(this)),Array.isArray(h.items)&&h.items.forEach(u=>{if((u==null?void 0:u.type)==="dropdown"){const p=u.menu||u["data-menu"];p&&p.searchBox&&(p.searchPlacement===void 0&&(p.searchPlacement="bottom"),p.maxHeight||(p.maxHeight=480))}})),n.footToolbar=h}e&&c.push("checkedInfo"),i&&c.push("flex","pager"),c.length&&(n.footer=c)}const r={"data-load":"table","data-selector":"dtable","data-target":n.id,...n.loadOptions},o=n.loadPartial||((l=this.parent||this.element)==null?void 0:l.closest(".modal"));o&&(r["data-partial"]=!0),i&&(i.btnProps=y.extend({type:"ghost",size:"sm"},i.btnProps),i.items&&i.items.forEach(c=>{c.type==="size-menu"?y.extend(!0,c,{itemProps:o?{...r,...c.itemProps}:{"data-app":"current",...c.itemProps},placement:"top"}):c.type==="link"&&y.extend(c,r)}));let{sortLink:a}=n;if(a&&(typeof a=="string"&&(a={url:a}),typeof a=="object"&&(a=y.extend(r,a)),n.sortLink=a),n.customCols){n.colResize===void 0&&(n.colResize=!0),n.sortCol===void 0&&(n.sortCol=!0);const c=()=>{this.trySaveColsSetting()};n.sortCol&&!n.onSortColEnd&&(n.onSortColEnd=c),n.colResize&&!n.on&&(n.onColResize=c),n.customCol===void 0&&(n.customCol=!0),n.customCol&&(n.onSetColBorder||(n.onSetColBorder=c),n.onSetColVisibility||(n.onSetColVisibility=c),n.canSetColVisibility||(n.canSetColVisibility=h=>{const u=this.getColInfo(h);return!u||u.side!=="center"?!1:this.layout.cols[u.side].list.length>1}))}return n},i18n:{zh_cn:{unassigned:"未指派"},zh_tw:{unassigned:"未指派"},en:{unassigned:"Unassigned"}},colTypes:{id:{width:60,fixed:"left",align:"center",sortType:!0,maxWidth:120},checkID:{width:80,fixed:"left",align:"left",sortType:!0,checkbox:!0,maxWidth:160},title:{width:.44,fixed:"left",align:"left",sortType:!0,flex:1,hint:!0,maxWidth:600},shortTitle:{width:.2,align:"left",sortType:!0,fixed:"left",checkbox:!0,flex:1,hint:!0,maxWidth:250},nestedTitle:{width:.5,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:650},shortNestedTitle:{width:.33,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:300},status:{width:80,align:"center",sortType:!0,onRenderCell(n,{col:e,row:t}){var o,a;const i=(o=t.data)==null?void 0:o[e.name];let s,r;return typeof i=="string"?(s=i,r=(a=e.setting.statusMap)==null?void 0:a[i]):typeof i=="object"&&i&&({name:s,label:r}=i),n[0]=w("span",{class:`${e.setting.statusClassPrefix??"status-"}${s}`},r??s),n}},user:{width:80,align:"center",sortType:!0,onRenderCell(n,{col:e,row:t,value:i}){const{userMap:s=this.options.userMap,userJoiner:r=" "}=e.setting;if(Array.isArray(i))n[0]=i.map(o=>Dh(o,t,s)).filter(Boolean).join(r);else{const o=Dh(i,t,s);o!==void 0&&(n[0]=o)}return n}},assign:{width:108,align:"left",sortType:!0,cellClass:"px-1.5",onRenderCell(n,e){const{col:t,row:i,value:s}=e,{options:r}=this,{userMap:o=r.userMap,currentUser:a=r.currentUser,assignLink:l,unassignedText:c=r.unassignedText||this.i18n("unassigned")}=t.setting,h=!s,u=s==="closed",p=h?c:Dh(s,i,o)??s;return n[0]=l?gh(l,e,[w("i",{className:"icon icon-hand-right"}),w("span",null,p)],{"data-toggle":u?void 0:"modal",className:`dtable-assign-btn${a===s?" is-me":""}${h?" is-unassigned":""}${u?" disabled":""}`}):p,n}},avatar:{width:44,align:"center",sortType:!0},avatarName:{width:108,align:"left",sortType:!0},avatarBtn:{width:108,align:"left",sortType:!0},category:{width:80,align:"center",flex:1,hint:!0},desc:{width:160,align:"left",flex:1,hint:!0},text:{width:136,align:"left",flex:1,hint:!0},icon:{width:52,align:"center",cellClass:"px-1",onRenderCell(n,{row:e,col:t,value:i}){const{iconRender:s}=t.setting,r=Ly(s,i,e);return r&&(n[0]=r),n}},pri:{width:68,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(n,{col:e,value:t}){const{priList:i=this.options.priList||{}}=e.setting,s=i[t]??t;return n[0]=w(Vg,{pri:t,text:s}),n}},severity:{width:92,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(n,{col:e,value:t}){const{severityList:i=this.options.severityList||{}}=e.setting,s=i[t]??t;return n[0]=w(Kg,{severity:t,text:s}),n}},burn:{width:88,align:"center",onRenderCell(n,{col:e}){const t=n[0];if(!t)return n;const{burn:i}=e.setting,s={data:t,className:"border-b",width:64,height:24,responsive:!1,...i};return n[0]=w(Eu,{...s}),n}},date:{width:96,align:"center",sortType:!0},time:{width:64,align:"center",sortType:!0},datetime:{width:128,align:"center",sortType:!0},progress:{width:64,align:"center",sortType:!0},money:{width:96,align:"right",sortType:!0},count:{width:92,align:"right",sortType:!0},number:{width:64,align:"center",sortType:!0,digits:-1},percent:{width:64,align:"center",sortType:!0,format(n){return typeof n=="string"&&n.endsWith("%")?n:`${n}%`}},actions:{minWidth:120,align:"left",fixed:"right"}},methods:{trySaveColsSetting(){this.data.saveColsSettingTimer&&clearTimeout(this.data.saveColsSettingTimer),this.data.saveColsSettingTimer=window.setTimeout(()=>{this.saveColsSetting(),this.data.saveColsSettingTimer=0},200)},getColsSetting(){const{colOrders:n,colsSizes:e,colBorders:t,colVisibility:i}=this.state,s={},r=(o,a)=>{const l=s[o];l?Object.assign(l,a):s[o]={id:o,...a}};return n&&Object.keys(n).forEach(o=>{r(o,{order:n[o]})}),e&&Object.keys(e).forEach(o=>{r(o,{extraWidth:e[o]})}),t&&Object.keys(t).forEach(o=>{r(o,{border:t[o]})}),i&&Object.keys(i).forEach(o=>{r(o,{show:i[o]})}),Object.values(s)},async saveColsSetting(){const n=this.getColsSetting();if(!n.length)return;const{saveFieldsUrl:e}=this.options.customCols||{};if(!e)return;const t=JSON.stringify(n);t!==this.data.lastSavedColsSetting&&(this.data.lastSavedColsSetting=t,await y.post(e,{fields:t}))}},onRenderCell(n,{row:e,col:t,value:i}){const{iconRender:s}=t.setting;if(s&&t.type!=="icon"){const r=Ly(s,i,e);r&&n.push(r)}return n},onRender(){const{customCols:n}=this.options;if(!n)return;const{custom:e,setGlobal:t,reset:i,resetGlobal:s}=n;return{children:w("div",{className:"absolute gap-1.5 pr-1.5 top-0 right-0 z-20 row items-center",style:"background:var(--dtable-header-bg);height: calc(var(--dtable-header-height) - 2px)"},w("div",{className:"w-px border-l h-5"}),w("a",{className:"btn ghost square size-sm rounded","data-toggle":"dropdown","data-placement":"bottom-end"},w("i",{class:"icon icon-cog-outline"})),w("menu",{class:"dropdown-menu menu"},e&&w("li",{class:"menu-item"},w("a",{href:e.url,"data-toggle":"modal"},e.text)),t&&w("li",{class:"menu-item"},w("a",{class:"ajax-submit",href:t.url},t.text)),i&&w("li",{class:"menu-item"},w("a",{class:"ajax-submit",href:i.url},i.text)),s&&w("li",{class:"menu-item"},w("a",{class:"ajax-submit",href:s.url},s.text))))}},onUpdated(){const{updateCheckedRows:n}=this.options;n&&n!==this.data.updateCheckedRows&&(this.data.updateCheckedRows=n,this.toggleCheckRows(n,!0))}},{buildIn:!0});const F$="",zr=n=>`${n.col.name}[${n.row.id}]`,jr=(n,e,t,i="value")=>{const s=zr(e),r=n.data.formData[s]??e.value;return{[i]:r,className:"form-control",onChange:o=>n.setFormData(s,o instanceof Event?o.currentTarget.value:o),...t}};function Ih(n){const e=zr(n);let t=this.data.pickRefs.get(e);return t||(t=he(),this.data.pickRefs.set(e,t)),jr(this,n,{ref:t},"defaultValue")}const ZS={input:{component:"input",props(n){return jr(this,n,{type:"text"})}},select:{component:function(n){const{items:e,defaultValue:t,...i}=n;return w("select",{...i},e.map(s=>w("option",{key:s.value,value:s.value},s.text)))},props(n){return jr(this,n)}},picker:{component:nn,props:Ih},datePicker:{component:vs,props(n){return jr(this,n,{className:"flex-auto",icon:"calendar"},"defaultValue")}},timePicker:{component:da,props(n){return jr(this,n,{className:"flex-auto",icon:"time"},"defaultValue")}},priPicker:{component:Er,props:Ih},severityPicker:{component:ah,props:Ih}};He({name:"form",plugins:[ly],data(){return{formData:{},pickRefs:new Map}},colTypes:{control:{custom(n){let{control:e}=n.col.setting;if(typeof e=="function"&&(e=e.call(this,n)),!e)return;typeof e=="string"&&(e={type:e});const{controlMap:t}=this.options,{type:i}=e,s={name:zr(n)};let r;if([ZS[i],t==null?void 0:t[i],e].forEach(o=>{if(o){const{props:a}=o;a&&y.extend(s,typeof a=="function"?a.call(this,n):a),r=o.component||r}}),!!r)return{component:r,props:s}}}},methods:{setFormData(n,e,t){var r,o;const{formData:i}=this.data;i[n]=e,t||(r=this.options.onFormChange)==null||r.call(this,n,e,i);const s=this.data.pickRefs.get(n);s&&((o=s.current)==null||o.setValue(e))},getFormData(n=!0){let{formData:e}=this.data;if(!n)return e;const{rows:t,cols:i}=this.layout,s=t.reduce((r,o)=>(i.list.forEach(a=>{var l;a.setting.control&&(r[zr({col:a,row:o})]=(l=o.data)==null?void 0:l[a.name])}),r),{});return e=y.extend(s,e),n===!0?e:e[n]},resetFormData(){this.data.formData={};const{rows:n,cols:e}=this.layout;n.forEach(t=>{e.list.forEach(i=>{var r,o;if(!i.setting.control)return;const s=this.data.pickRefs.get(zr({col:i,row:t}));s&&((o=s.current)==null||o.setValue(((r=t.data)==null?void 0:r[i.name])??""))})})}}});function $h(n,e){return Object.entries(e).reduce((t,[i,s])=>{const r=t[i];return r?s===void 0?delete t[i]:Object.keys(s).forEach(o=>{const a=s[o];a===void 0?delete r[o]:r[o]=a}):s!==void 0&&(t[i]=s),t},n)}function Br(n){return Object.entries(n).reduce((e,[t,i])=>(e&&typeof i=="object"&&(e[t]={...i}),e),{})}const Ry=He({name:"draft",defaultOptions:{draft:!0,selectAllOnFocus:!0,history:20},when:n=>!!n.draft,state(){return{stagingDraft:{},appliedDraft:{}}},methods:{getCellDraftValue(n,e){const t=this.getRowInfo(n);if(!t)return;const i=this.getColInfo(e);if(!i)return;const{id:s}=t,{name:r}=i,o=this.state.stagingDraft[s];if(o&&r in o)return o[r];const a=this.state.appliedDraft[s];return a&&r in a?a[r]:this.getCellValue(t,i)},getRowDraftData(n,e){const t=this.getRowInfo(n);return t?this.layout.cols.list.reduce((i,s)=>{if(!(e!=null&&e.includeIndexCol)&&s.name==="INDEX")return i;const r=this.getCellDraftValue(t,s);return i[s.name]=r===void 0?e==null?void 0:e.emptyCellValue:r,i},{}):{}},getColDraftData(n,e){const t=this.getColInfo(n);return t?this.layout.rows.reduce((i,s)=>{const r=this.getCellDraftValue(s,t);return i[s.id]=r===void 0?e==null?void 0:e.emptyCellValue:r,i},e!=null&&e.includeHeaderRow?{HEADER:this.getCellDraftValue("HEADER",t)}:{}):{}},stageDraft(n,e){var r;const{stagingDraft:t}=this.state;if(((r=this.options.onStageDraft)==null?void 0:r.call(this,n,t))===!1)return;const i=Br(t);$h(t,n);const s=()=>{var o,a;(o=e==null?void 0:e.callback)==null||o.call(e,n),(a=this.options.afterStageDraft)==null||a.call(this,n,this.state.stagingDraft,i,{skipUpdate:!!(e!=null&&e.skipUpdate)})};e!=null&&e.skipUpdate?s():this.update(s)},applyDraft(n,e){const{stagingDraft:t,appliedDraft:i}=this.state,s=Br(i);Object.entries(n).forEach(([o,a])=>{const l=t[o];l&&typeof a=="object"&&(a===null?delete t[o]:Object.keys(a).forEach(h=>{l[h]===a[h]&&delete l[h]}),Object.keys(l).length||delete t[o]);const c=i[o];c?a===null?delete i[o]:Object.assign(c,a):a!==null&&(i[o]=a)});const r=()=>{var o,a;(o=e==null?void 0:e.callback)==null||o.call(e,n),(a=this.options.afterApplyDraft)==null||a.call(this,n,this.state.appliedDraft,s)};e!=null&&e.skipUpdate?r():this.forceUpdate(r)},renderDraftCell(n,{col:e,row:t}){let i=this.getCellDraftValue(t,e)??"";return typeof i=="string"&&!i.length&&t.id==="HEADER"&&(i=e.name),n[0]={children:i,attrs:{title:i}},n}},onRenderCell(n,...e){return this.options.skipRenderDraftCell?n:this.renderDraftCell(n,...e)},onRenderHeaderCell(n,...e){return this.options.skipRenderDraftCell?n:this.renderDraftCell(n,...e)}}),B$="";function Oy(n,e,t){return n.every(i=>e[i]===t[i])}const ek=He({name:"editable",plugins:[Ry],defaultOptions:{editable:!0,selectAllOnFocus:!0,history:20,skipRenderDraftCell:!0,emptyCellValue:""},when:n=>!!n.editable,events:{dblclick(n){this.editCell(this.getPointerInfo(n))},click(n){const e=this.getPointerInfo(n);e&&e.cellElement.classList.contains("is-selected")&&this.editCell(e)}},data(){return{editingInputRef:he()}},methods:{isCellEditing(n,e){const{editingCell:t}=this.state;return!!t&&t.rowID===n&&t.colName===e},editCell(n){const{editable:e,headerEditable:t}=this.options;n&&(typeof e=="function"&&!e(n.rowID,n.colName)||!t&&n.rowID==="HEADER")&&(n=void 0),this.data.editingInputRef.current=null,this.data.needAutoFocus=!0,this.setState({editingCell:n?{colName:n.colName,rowID:n.rowID}:void 0})},deleteCells(n){const e={},{emptyCellValue:t}=this.options;return n.forEach(i=>{const s=e[i.rowID];s?s[i.colName]=t:e[i.rowID]={[i.colName]:t}}),Object.keys(e).length?(this.stageDraft(e),!0):!1},deleteRows(n,e){Array.isArray(n)||(n=[n]);const t=this.layout.cols.list.reduce((u,p)=>(p.name!=="HEADER"&&u.push(p.name),u),[]),i=n.reduce((u,p)=>{const m=this.getRowInfo(p);return m&&m.id!=="HEADER"&&u.push(m),u},[]).sort((u,p)=>u.index-p.index);if(!i.length)return;const s=new Set(i.map(u=>u.index)),r=new Map,o=this.layout.rows,a=o.length,{emptyCellValue:l}=this.options;let c=i[0].index;for(let u=c+1;u<a;u++){if(s.has(u))continue;const p=o[u];r.set(c,this.getRowDraftData(p,{emptyCellValue:l})),c++}const h={};c=i[0].index;for(let u=c;u<a;u++){const p=o[u],m=this.getRowDraftData(p,{emptyCellValue:l}),v=r.get(u)||{};Oy(t,m,v)||(h[p.id]=v)}Object.keys(h).length&&this.stageDraft(h,{skipUpdate:e==null?void 0:e.skipUpdate})},deleteCols(n,e){Array.isArray(n)||(n=[n]);const t=n.reduce((u,p)=>{const m=this.getColInfo(p);return m&&m.name!=="INDEX"&&u.push(m),u},[]).sort((u,p)=>u.index-p.index);if(!t.length)return;const i=new Set(t.map(u=>u.index)),s=new Map,{cols:{list:r}}=this.layout,o=r.length,a=this.layout.rows.reduce((u,p)=>(u.push(p.id),u),["HEADER"]),{emptyCellValue:l}=this.options;let c=t[0].index;for(let u=c+1;u<o;u++){if(i.has(u))continue;const p=r[u];s.set(c,this.getColDraftData(p,{emptyCellValue:l,includeHeaderRow:!0})),c++}const h={};c=t[0].index;for(let u=c;u<o;u++){const p=r[u],m=this.getColDraftData(p,{emptyCellValue:l,includeHeaderRow:!0}),v=s.get(u)||{};if(!Oy(a,m,v))for(const b of a)h[b]||(h[b]={}),h[b][p.name]=v[b]??l}Object.keys(h).length&&this.stageDraft(h,{skipUpdate:e==null?void 0:e.skipUpdate})},handleEditingInputChange(n){var o,a;const e=(o=n.target)==null?void 0:o.value,{editingCell:t}=this.state;if(typeof e!="string"||!t)return;const{rowID:i,colName:s}=t,r=this.getCellDraftValue(i,s);r!==e&&((a=this.options.onEditCell)==null?void 0:a.call(this,{rowID:i,colName:s,value:e,oldValue:r}))!==!1&&this.stageDraft({[i]:{[s]:e}})},handleEditingInputBlur(){this.editCell()},handleEditingKeyDown(n){var e;n.key==="Enter"?(e=this.data.editingInputRef.current)==null||e.blur():n.key==="Esc"&&this.editCell()},renderEditableCell(n,{col:e,row:t},i){const{id:s}=t;if(this.isCellEditing(s,e.name)){const r=`${this.getCellDraftValue(s,e.name)??""}`;return[{outer:!0,className:"is-editing",children:k("input",{ref:this.data.editingInputRef,class:"dtable-editing-input",type:"text",defaultValue:r,style:{textAlign:e.setting.align},onChange:this.handleEditingInputChange,onBlur:this.handleEditingInputBlur,onKeyDown:this.handleEditingKeyDown,onPaste:this.options.onPasteToCell})}]}return this.renderDraftCell(n,{row:t,col:e},i)}},onUpdated(){const n=this.data.editingInputRef.current;n&&this.data.needAutoFocus&&(this.data.needAutoFocus=!1,n.focus({preventScroll:!0}),this.options.selectAllOnFocus&&n.select())},onRender(){return{className:{"dtable-editable":this.options.editable,"dtable-editing":this.state.editingCell}}},onRenderCell(...n){return this.renderEditableCell(...n)},onRenderHeaderCell(...n){return this.renderEditableCell(...n)}}),U$="",tk=/C(\d+)R(\d+)/i,nk=/(?:C(\d+))?(?:R(\d+))?/i;function Fy(n){const e=tk.exec(n);if(!e||e.length<3)return;const[,t,i]=e;return{col:+t,row:+i}}function Ah(n){const e=nk.exec(n);if(!e)return;const[,t=-1,i=-1]=e,s=+t,r=+i;return{col:s,row:r}}function Eh(n){const e=[],t=Ah(n);if(!t)return e;const{col:i,row:s}=t;if(i>=0)if(s>=0)e.push({col:i,row:s});else{const r=this.layout.rows.length;for(let o=0;o<r;o++)e.push({col:i,row:o})}else if(s>=0){const{cols:r}=this.layout,o=r.list.length;for(let a=0;a<o;a++)e.push({col:a,row:s})}return e}function zy(n){const[e,t]=n.split(":");if(e){if(!t)return Eh.call(this,e)}else return t?Eh.call(this,t):[];const i=Ah(e),s=Ah(t);if(!i||!s)return[];const r=Math.min(i.col,s.col),o=Math.max(i.col,s.col),a=Math.min(i.row,s.row),l=Math.max(i.row,s.row),c=[],h=Object.keys(this.layout.cols.map).length;for(let u=r;u<=o;u++)if(a<0||l<0){const p=this.layout.rows.length;for(let m=0;m<p;m++)c.push({col:u,row:m})}else for(let p=a;p<=l;p++)if(u<0)for(let m=0;m<h;m++)c.push({col:m,row:p});else c.push({col:u,row:p});return c}function ik(n){return n.reduce((e,t)=>(typeof t=="object"?e.push(t):t.includes(":")?e.push(...zy.call(this,t)):e.push(...Eh.call(this,t)),e),[])}function Nh(n,e){const{col:t,row:i}=n,s=[];if(t>=0&&s.push(`C${t}`),i>=0&&s.push(`R${i}`),e){const r=Nh(e);r&&s.push(":",r)}return s.join("")}function Mh(n,e){const{selectable:t}=n.options;return typeof t=="function"?t.call(n,e):!!t}function Ph(n,e={}){var p;Array.isArray(n)||(n=[n]);let t=ik.call(this,n);const i=(p=this.options.beforeSelectCells)==null?void 0:p.call(this,t);i&&(t=i);const{clearBefore:s=!0,deselect:r,selecting:o,callback:a}=e,{selectingMap:l,selectedMap:c}=this.state,h=o?l:c;l.clear(),s&&c.clear();let u=!1;return r?t.forEach(m=>{if(!Mh(this,m))return;const{col:v,row:b}=m,C=h.get(v);C&&(C.delete(b),C.size||h.delete(v)),u=!0}):t.forEach(m=>{if(!Mh(this,m))return;const{col:v,row:b}=m,C=h.get(v);C?C.add(b):h.set(v,new Set([b])),u=!0}),u?(this.update({},()=>{var m;a==null||a.call(this,t),(m=this.options.onSelectCells)==null||m.call(this,t)}),t):[]}function sk(n){const{selectedMap:e}=this.state;let t=-1,i=-1;for(const[s,r]of e.entries()){i=i<0?s:Math.min(s,i);const o=Math.min(...r);t=t<0?o:Math.min(o,t)}if(!(t<0||i<0)&&(n==="down"?t++:n==="up"?t--:n==="left"?i--:i++,t>=0&&i>=0&&t<this.layout.rows.length&&i<this.layout.cols.list.length)){const s={col:i,row:t};if(Mh(this,s))return this.scrollTo(s),this.selectCells([s]),s}}function rk(n,e){return Ph.call(this,n,{...e,selecting:!0})}function ok(n,e){return Ph.call(this,n,{...e,deselect:!0})}function ak(){const{cols:n}=this.layout,e=n.list.length,t=this.layout.rows.length,{selectedMap:i}=this.state,s=typeof this.options.selectable=="function"?this.options.selectable:!1;for(let r=0;r<e;r++){let o=i.get(r);o||(o=new Set,i.set(r,o));for(let a=0;a<t;a++)s&&!s({row:a,col:r})||o.add(a)}this.forceUpdate()}function lk(){const{selectedMap:n}=this.state;return n.size?(n.clear(),this.forceUpdate(),!0):!1}function ck(n){var t;const e=typeof n=="string"?Fy(n):n;return e?((t=this.state.selectedMap.get(e.col))==null?void 0:t.has(e.row))??!1:!1}function jy(n,e){for(const[,t]of n.state.selectedMap.entries())if(t.has(e))return!0;for(const[,t]of n.state.selectingMap.entries())if(t.has(e))return!0;return!1}function uk(n){var t;const e=(t=this.getRowInfo(n))==null?void 0:t.index;return typeof e!="number"?!1:this.layout.cols.list.every(i=>i.name==="INDEX"||this.isCellSelected({col:i.index,row:e}))}function hk(n){var i;const e=(i=this.getColInfo(n))==null?void 0:i.index;if(typeof e!="number")return!1;const{rows:t}=this.layout;return t.every(s=>this.isCellSelected({col:e,row:s.index}))}function By(n,e){var t,i;return!!((t=n.state.selectedMap.get(e))!=null&&t.size||(i=n.state.selectingMap.get(e))!=null&&i.size)}function dk(n){var t;const e=typeof n=="string"?Fy(n):n;return e?((t=this.state.selectingMap.get(e.col))==null?void 0:t.has(e.row))??!1:!1}function fk(){const n=[];for(const[e,t]of this.state.selectedMap.entries())for(const i of t)n.push({col:e,row:i});return n}function pk(){const n=[];for(const[t,i]of this.state.selectedMap.entries())i.size&&n.push(t);return[...new Set(n)].map(t=>this.getColInfo(t)).filter(t=>t&&this.isColSelected(t)).sort((t,i)=>t.index-i.index)}function mk(){const n=[];for(const[,t]of this.state.selectedMap.entries())n.push(...t);return[...new Set(n)].map(t=>this.getRowInfo(t)).filter(t=>t&&this.isRowSelected(t)).sort((t,i)=>t.index-i.index)}function gk(){let n=0;for(const e of this.state.selectedMap.values())n+=e.size;return n}function Lh(n,e,t){var c,h;const i=n.getPointerInfo(e);if(!i||i.target.closest("input,textarea,[contenteditable]"))return;const{rowID:s,colName:r}=i,o=((c=n.getColInfo(r))==null?void 0:c.index)??-1;if(o<0)return;const a=s==="HEADER";if(a&&(t!=null&&t.ignoreHeaderCell))return;const l=a?-1:((h=n.getRowInfo(s))==null?void 0:h.index)??-1;return{col:o,row:l}}const yk=He({name:"selectable",defaultOptions:{selectable:!0,markSelectRange:!0},when:n=>!!n.selectable,plugins:[Nr],state(){return{selectedMap:new Map,selectingMap:new Map}},methods:{selectCells:Ph,selectNextCell:sk,selectingCells:rk,deselectCells:ok,isCellSelected:ck,isCellSelecting:dk,isRowSelected:uk,isColSelected:hk,hasCellSelectInRow:jy,hasCellSelectInCol:By,getSelectedCols:pk,getSelectedRows:mk,getSelectedCells:fk,selectAllCells:ak,deselectAllCells:lk,getSelectedCellsSize:gk},events:{mousedown(n){if(this.data.disableSelectable)return;const e=Lh(this,n);n.button!==0&&(!e||this.isCellSelected(e)||e.row<0&&this.isColSelected(e.col)||e.col<1&&this.isRowSelected(e.row))||(this.data.selectingStart=e,this.startScrollToMouse(),e&&n.stopPropagation())},document_mouseup(n){const{selectingStart:e}=this.data;if(this.stopScrollToMouse(),!e)return;this.data.selectingStart=void 0;const t=Lh(this,n);if(t){const i=Nh(e,t);i&&(requestAnimationFrame(()=>this.selectCells(i)),n.stopPropagation())}},document_click(n){const e=n.target;if(!e)return;const{ignoreDeselectOn:t}=this.options;e.closest(`#${this.id}${t?`,${t}`:""}`)||this.deselectAllCells()},mousemovesmooth(n){const e=this,{selectingStart:t}=e.data;if(!t)return;const i=Lh(e,n);if(!i)return;const s=Nh(t,i);s&&(e.selectingCells(s),n.preventDefault(),n.stopPropagation())}},onRender(){if(this.options.selectable)return{className:"dtable-selectable"}},onRenderCell(n,{row:e,col:t}){const i=this.getRowInfo(e.id);if(!i)return n;const s={col:t.index,row:i.index};return this.isCellSelecting(s)?n.push({outer:!0,className:"is-select is-selecting"}):this.isCellSelected(s)&&n.push({outer:!0,className:"is-select is-selected"}),this.options.markSelectRange&&t.name==="INDEX"&&(this.isRowSelected(i)?n.push({outer:!0,className:"is-row-selected has-cell-selected"}):jy(this,i.index)&&n.push({outer:!0,className:"has-cell-selected"})),n},onRenderHeaderCell(n,{col:e}){return this.options.markSelectRange&&e.name!=="INDEX"&&By(this,e.index)&&(n.push({outer:!0,className:"has-cell-selected"}),this.isColSelected(e)&&n.push({outer:!0,className:"is-col-selected"})),n}}),vk=He({name:"hotkey",when:n=>!!n.hotkeys,onMounted(){const{hotkeys:n}=this.options;if(!n)return;const e={};if(Object.keys(n).forEach(i=>{const s=n[i];i.split(",").forEach(r=>{r=r.trim(),r.length&&(e[r]=s)})}),!Object.keys(e).length)return;const t=`dtable_${this.id}`;y(this.element).hotkeys(e,{scope:t}),this.data.hotkeysScope=t},onUnmounted(){this.data.hotkeysScope&&y(this.element).unbindHotkeys(this.data.hotkeysScope)}});function Ga(n,e){const t=new Set([...Object.keys(n),...Object.keys(e)]);return Array.from(t).reduce((i,s)=>{const r=n[s]||{},o=e[s]||{};if(r===o)return i;const a=new Set([...Object.keys(r),...Object.keys(o)]),l={};let c=!1;return a.forEach(h=>{const u=r[h],p=o[h];u!==p&&(l[h]=u,c=!0)}),c&&(i[s]=l),i},{})}const _k=He({name:"history",plugins:[dy,Ry],defaultOptions:{history:!0,historyTarget:"staging",historyThreshold:10},when:n=>!!n.history,options(n){const{afterApplyDraft:e,afterStageDraft:t,historyTarget:i,history:s}=n;return{afterApplyDraft:s&&i==="applied"?(r,o,a)=>{e&&e.call(this,r,o,a),this.addHistory({after:Ga(o,a),before:Ga(a,o)})}:e,afterStageDraft:s&&i!=="applied"?(r,o,a,l)=>{t&&t.call(this,r,o,a,l),this.addHistory({after:Ga(o,a),before:Ga(a,o)})}:t}},data(){return{historyIdx:1}},state(){return{historyCursor:0,historyItems:[]}},methods:{addHistory(n){let{historyCursor:e,historyItems:t}=this.state;e>0&&(t.splice(0,e).forEach(r=>{typeof r=="number"&&this.data.store.session.remove(`HISTORY:${this.id}:${r}`)}),e=0),t=[n,...t];const{historyThreshold:i}=this.options;if(i&&t.length>i)for(let s=i;s<t.length;s++){const r=t[s];if(typeof r=="number")break;const o=this.data.historyIdx++;this.data.store.session.set(`HISTORY:${this.id}:${o}`,r),t[s]=o}this.setState({historyCursor:e,historyItems:t})},getHistory(n){if(typeof n=="object")return n;const{historyCursor:e,historyItems:t}=this.state;n===void 0&&(n=e);const i=t[n];return typeof i=="number"?this.data.store.session.get(`HISTORY:${this.id}:${i}`):i},applyHistory(n,e,t){const i={historyCursor:n},s=this.options.historyTarget==="applied",{appliedDraft:r,stagingDraft:o}=this.state,a=Br((s?r:o)??{});s?i.appliedDraft=$h(r,e):i.stagingDraft=$h(o,e),this.setState(i,()=>{var c;t==null||t();const l=Object.entries(e).reduce((h,[u,p])=>{if(p){const m={};Object.entries(p).forEach(([v,b])=>{m[v]=b===void 0?this.getCellDraftValue(u,v):b}),h[u]=m}return h},{});(c=this.options.onHistoryApplied)==null||c.call(this,l,s?r:o??{},a)})},undoHistory(n){if(!this.canUndoHistory())return!1;const{historyCursor:e}=this.state,t=this.getHistory(e);return t?(this.applyHistory(e+1,Br(t.before),n),!0):!1},redoHistory(n){if(!this.canRedoHistory())return!1;const{historyCursor:e}=this.state,t=this.getHistory(e-1);return t?(this.applyHistory(e-1,Br(t.after),n),!0):!1},canUndoHistory(){const{historyCursor:n,historyItems:e}=this.state;return e.length>0&&n<e.length},canRedoHistory(){return this.state.historyCursor>0}}}),q$="";function bk(n,e){const{colsCount:t,rowsCount:i}=n.getGridSize(),{cols:s=[]}=e,{showRowIndex:r,defaultColWidth:o}=n.options,a=[];r!==!1&&a.push({width:`${i+1}`.length*8+24,name:"INDEX",fixed:"left",align:"right",title:"#",...s.find(l=>l.name==="INDEX")});for(let l=0;l<t;++l){const c=`C${l+1}`,h={name:c,width:o,...s.find(u=>u.name===c)};a.push(h)}return{cols:a,data:i}}function wk(n,e,t){var i,s;return e.name==="INDEX"?n.id==="HEADER"?t:n.index+1:n.id!=="HEADER"?(s=(i=this.options.datasource.data)==null?void 0:i[+n.id])==null?void 0:s[+e.name.replace("C","")-1]:t}function Ya(n,e,t){n.selectNextCell(t)&&(e.preventDefault(),e.stopPropagation())}const Ck={delete(n){y(n.target).is("input,textarea")||this.deleteSelections()},cut(){this.cutSelections()},selectAll(n){this.state.editingCell||(this.selectAllCells(),n.preventDefault())},paste(){this.pasteToSelection()},copy(n){this.copySelections(),n.preventDefault()},focus(){const n=this.getSelectedCells()[0];if(!n)return;const e=this.getColInfo(n.col),t=this.getRowInfo(n.row);!e||!t||this.editCell({rowID:t.id,colName:e.name})},cancel(){this.deselectAllCells()},undo(){this.undoHistory()},redo(){this.redoHistory()},selectRight(n){Ya(this,n,"right")},selectLeft(n){Ya(this,n,"left")},selectDown(n){Ya(this,n,"down")},selectUp(n){Ya(this,n,"up")}};function Hy(n,e){Array.isArray(n)||(n=[n]);let t=0,i=0;const s=e==null?void 0:e.ignoreEmptyCell;return n.forEach(r=>{Object.entries(r).forEach(([o,a])=>{o!=="HEADER"&&(t=Math.max(t,+o+1),i=Math.max(i,...Object.keys(a).map(l=>s&&Uy(a[l])||l[0]!=="C"?0:+l.replace("C",""))))})}),{maxRow:t,maxCol:i}}function xk(){const{minRows:n=1,minCols:e=1,extraRows:t=0,extraCols:i=0,datasource:s}=this.options,{data:r=[],cols:o=[]}=s,{stagingDraft:a,appliedDraft:l}=this.state,{maxRow:c,maxCol:h}=Hy([a,l]);return{rowsCount:Math.max(c,r.length+t,n,this.data.rowsCount??0),colsCount:Math.max(h,e,o.length,r.reduce((u,p)=>Math.max(u,p.length),0)+i,this.data.colsCount??0)}}function Sk(n=1,e){const{rowsCount:t}=this.getGridSize();let i=t;return typeof n=="number"?i=t+Math.max(n,0):Array.isArray(n)&&(i=t+Math.max(n.length,0),this.stageDraft(n.reduce((s,r,o)=>(Array.isArray(r)&&(r=r.reduce((a,l,c)=>(a[`C${c+1}`]=l,a),{})),s[t+o]=r,s),{}),{skipUpdate:!0})),i>t?(this.data.rowsCount=i,e!=null&&e.skipUpdate||this.update({dirtyType:"options"},()=>{(e==null?void 0:e.select)!==!1&&this.selectCells(`R${t}:R${i-1}`),(e==null?void 0:e.autoScroll)!==!1&&this.scrollTo({row:i-1,col:0})}),!0):!1}function kk(n=1,e){const{colsCount:t}=this.getGridSize();let i=t;const{showRowIndex:s}=this.options;return typeof n=="number"?i=t+Math.max(n,0):Array.isArray(n)&&(i=t+Math.max(n.length,0),this.stageDraft(n.reduce((r,o,a)=>(o.forEach((l,c)=>{const h=r[c],u=`C${t+a+(s?1:0)}`;h?h[u]=l:r[c]={[u]:l}}),r),{}),{skipUpdate:!0})),i>t?(this.data.colsCount=i,e!=null&&e.skipUpdate||this.update({dirtyType:"options"},()=>{(e==null?void 0:e.select)!==!1&&this.selectCells(`C${t+(s?1:0)}:C${i-1+(s?1:0)}`),(e==null?void 0:e.autoScroll)!==!1&&this.scrollTo({col:i-(s?0:1),row:0})}),!0):!1}function Tk(n,e){const t=this.getGridSize(),i=Math.max(0,(n.rowsCount??0)-t.rowsCount),s=Math.max(0,(n.colsCount??0)-t.colsCount);return i&&this.appendRows(i,{skipUpdate:!0,select:!1}),s&&this.appendCols(s,{skipUpdate:!0,select:!1}),i||s?(e!=null&&e.skipUpdate||this.update({dirtyType:"options"}),!0):!1}function Uy(n){return n==null||typeof n=="string"&&!n.length}function Wy(n){let e=0,t=0;return n.forEach((i,s)=>{i.forEach((r,o)=>{Uy(r)||(e=Math.max(e,o),t=Math.max(t,s))})}),n.slice(0,t+1).map(i=>i.slice(0,e+1))}He({name:"datagrid",plugins:[ek,yk,vk,My,_k,wh],defaultOptions:{defaultColWidth:80,headerEditable:!0,minRows:20,minCols:10,extraRows:5,extraCols:5,showRowIndex:!0,rowHover:!1,colHover:!1,cellHover:!0,bordered:!0,striped:!1,datagridHotkeys:{},cellValueSplitter:"	",cellValueGetter:wk,hotkeys:{},autoExpandGrid:!0},options(n){const{datagridHotkeys:e,datasource:t,hotkeys:i,editable:s,selectable:r,beforeSelectCells:o,showRowIndex:a,colResize:l,onPasteToCell:c,afterStageDraft:h}=n,u={delete:"Delete,Backspace",selectAll:"$mod+a",paste:"$mod+v",copy:"$mod+c",focus:"Enter",cancel:"Escape",cut:"$mod+x",redo:"$mod+Shift+z",undo:"$mod+z",selectRight:"Tab,ArrowRight",selectLeft:"ArrowLeft",selectDown:"ArrowDown",selectUp:"ArrowUp"};return{hotkeys:{...i,...Object.entries({...u,...e}).reduce((m,[v,b])=>{var C;return b&&(m[b===!0?u[v]:b]=(C=Ck[v])==null?void 0:C.bind(this)),m},{})},colResize:l?m=>(typeof l!="function"||l.call(this,m))&&m!=="INDEX":!1,editable:s?(m,v)=>typeof s=="function"&&!s(m,v)?!1:v!=="INDEX":!1,selectable:r?m=>typeof r=="function"&&!r(m)?!1:m.col>=(a?1:0):!1,beforeSelectCells:a?m=>(m.every(v=>v.col===0)&&(m=zy.call(this,`R${Math.min(...m.map(v=>v.row))}:R${Math.max(...m.map(v=>v.row))}`)),o?o.call(this,m):m):o,...bk(this,t),onPasteToCell:m=>{var b;const v=(b=m.clipboardData)==null?void 0:b.getData("text");typeof v=="string"&&(v.includes("	")||v.includes(`
`))&&this.state.editingCell&&(this.pasteCells(this.state.editingCell,{data:v}),m.preventDefault()),c==null||c.call(this,m)},afterStageDraft:(m,v,b,C)=>{h==null||h.call(this,m,v,b,C);const{autoExpandGrid:S}=this.options;if(!S)return;const{maxCol:D,maxRow:N}=Hy(v,{ignoreEmptyCell:!0}),{extraCols:P=1,extraRows:H=1}=this.options;this.expandGridSize({rowsCount:N+(typeof S=="number"?S:H),colsCount:D+(typeof S=="number"?S:P)},C)}}},methods:{deleteSelections(){const n=[];for(const[e,t]of this.state.selectedMap.entries()){const i=this.getColInfo(e);if(i)for(const s of t){const r=this.getRowInfo(s);r&&n.push({colName:i.name,rowID:r.id})}}return this.deleteCells(n)},deleteSelectedRows(){const n=this.getSelectedRows();return n.length?(this.deleteRows(n),this.deselectAllCells(),!0):!1},deleteSelectedCols(){const n=this.getSelectedCols();return n.length?(this.deleteCols(n),this.deselectAllCells(),!0):!1},copySelectedCols(){const n=this.getSelectedCols();if(!n.length)return!1;const e=this.layout.rows.length,t=[];for(let s=-1;s<e;++s)t.push(n.map(r=>{const o=this.getCellDraftValue(s,r);return s===-1&&o===r.name?"":o}));const i=Wy(t).map(s=>s.join("	")).join(`
`);return navigator.clipboard.writeText(i),!0},clearSelectedCols(){const n=this.getSelectedCols();if(!n.length)return!1;const e={},{emptyCellValue:t}=this.options;return[this.getRowInfo("HEADER"),...this.layout.rows].forEach(i=>{const s={};n.forEach(r=>{const o=this.getCellDraftValue(i,r);o!=null&&o!==t&&(s[r.name]=t)}),Object.keys(s).length&&(e[i.id]=s)}),Object.keys(e).length?(this.stageDraft(e),!0):!1},async pasteToSelectedCol(){const n=this.getSelectedCols();return n.length?await this.pasteCells({colName:n[0].name,rowID:"HEADER"}):!1},cutSelectedCols(){return this.copySelectedCols(),this.clearSelectedCols()},copySelections(){const n=this.getSelectedCells();if(!n.length)return!1;let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER;n.forEach(r=>{e=Math.min(r.col,e),t=Math.min(r.row,t)});const i=[];n.forEach(r=>{const o=this.getCellDraftValue(r.row,r.col);let a=i[r.row-t];a||(a=[],i[r.row-t]=a),a[r.col-e]=o});const s=Wy(i).map(r=>r.join("	")).join(`
`);return navigator.clipboard.writeText(s),!0},cutSelections(){return this.copySelections(),this.deleteSelections()},async pasteCells(n,e){var p,m;let t=-1,i=-1;if("colName"in n){const v=this.getColInfo(n.colName),b=this.getRowInfo(n.rowID);if(!v||!b)return!1;t=v.index,i=b.index}else t=n.col,i=n.row;let s=e==null?void 0:e.data;if(s===void 0)try{const v="clipboard-read";if((await navigator.permissions.query({name:v})).state==="denied")return(p=this.options.onReadClipboardFail)==null||p.call(this),!1;s=await navigator.clipboard.readText()}catch{return(m=this.options.onReadClipboardFail)==null||m.call(this),!1}if(!s.length)return!1;const r={},o=[],a=(e==null?void 0:e.expandCells)!==!1;let l=!1,c=0,h=0;const u=s.split(/\r?\n/);return u.forEach((v,b)=>{var N;if(!v.trim().length&&b===u.length-1)return;const C=b+i;let S=(N=this.getRowInfo(C))==null?void 0:N.id;if(S===void 0){if(!a)return;l=!0,S=`${C}`}let D=r[S];D||(D={},r[S]=D),v.split("	").forEach((P,H)=>{var Q;const q=H+t;let Y=(Q=this.getColInfo(q))==null?void 0:Q.name;if(Y===void 0){if(!a)return;l=!0,Y=`C${q}`}D[Y]=P,o.push({col:q,row:C}),c=Math.max(c,C),h=Math.max(h,q)})}),this.stageDraft(r,{skipUpdate:!0}),(e==null?void 0:e.select)!==!1&&this.selectCells(o),this.update({dirtyType:l?"options":void 0},()=>{e!=null&&e.autoscroll&&this.scrollTo({col:h,row:c})}),!0},pasteToSelection(){const n=this.getSelectedCells();if(!n.length)return Promise.resolve(!1);const e=n[0];return this.pasteCells(e)},getGridSize:xk,appendRows:Sk,appendCols:kk,expandGridSize:Tk},onRender(){return{className:"dtable-datagrid"}}});const Y$="",X$="",Q$="",J$="",Z$="",eA="",tA="",nA="",iA="",sA="",rA="",oA="",aA="",lA="",cA="",uA="";var Vy=11;function Dk(n,e){var t=e.attributes,i,s,r,o,a;if(!(e.nodeType===Vy||n.nodeType===Vy)){for(var l=t.length-1;l>=0;l--)i=t[l],s=i.name,r=i.namespaceURI,o=i.value,r?(s=i.localName||s,a=n.getAttributeNS(r,s),a!==o&&(i.prefix==="xmlns"&&(s=i.name),n.setAttributeNS(r,s,o))):(a=n.getAttribute(s),a!==o&&n.setAttribute(s,o));for(var c=n.attributes,h=c.length-1;h>=0;h--)i=c[h],s=i.name,r=i.namespaceURI,r?(s=i.localName||s,e.hasAttributeNS(r,s)||n.removeAttributeNS(r,s)):e.hasAttribute(s)||n.removeAttribute(s)}}var Xa,Ik="http://www.w3.org/1999/xhtml",Lt=typeof document>"u"?void 0:document,$k=!!Lt&&"content"in Lt.createElement("template"),Ak=!!Lt&&Lt.createRange&&"createContextualFragment"in Lt.createRange();function Ek(n){var e=Lt.createElement("template");return e.innerHTML=n,e.content.childNodes[0]}function Nk(n){Xa||(Xa=Lt.createRange(),Xa.selectNode(Lt.body));var e=Xa.createContextualFragment(n);return e.childNodes[0]}function Mk(n){var e=Lt.createElement("body");return e.innerHTML=n,e.childNodes[0]}function Pk(n){return n=n.trim(),$k?Ek(n):Ak?Nk(n):Mk(n)}function Qa(n,e){var t=n.nodeName,i=e.nodeName,s,r;return t===i?!0:(s=t.charCodeAt(0),r=i.charCodeAt(0),s<=90&&r>=97?t===i.toUpperCase():r<=90&&s>=97?i===t.toUpperCase():!1)}function Lk(n,e){return!e||e===Ik?Lt.createElement(n):Lt.createElementNS(e,n)}function Rk(n,e){for(var t=n.firstChild;t;){var i=t.nextSibling;e.appendChild(t),t=i}return e}function Rh(n,e,t){n[t]!==e[t]&&(n[t]=e[t],n[t]?n.setAttribute(t,""):n.removeAttribute(t))}var Ky={OPTION:function(n,e){var t=n.parentNode;if(t){var i=t.nodeName.toUpperCase();i==="OPTGROUP"&&(t=t.parentNode,i=t&&t.nodeName.toUpperCase()),i==="SELECT"&&!t.hasAttribute("multiple")&&(n.hasAttribute("selected")&&!e.selected&&(n.setAttribute("selected","selected"),n.removeAttribute("selected")),t.selectedIndex=-1)}Rh(n,e,"selected")},INPUT:function(n,e){Rh(n,e,"checked"),Rh(n,e,"disabled"),n.value!==e.value&&(n.value=e.value),e.hasAttribute("value")||n.removeAttribute("value")},TEXTAREA:function(n,e){var t=e.value;n.value!==t&&(n.value=t);var i=n.firstChild;if(i){var s=i.nodeValue;if(s==t||!t&&s==n.placeholder)return;i.nodeValue=t}},SELECT:function(n,e){if(!e.hasAttribute("multiple")){for(var t=-1,i=0,s=n.firstChild,r,o;s;)if(o=s.nodeName&&s.nodeName.toUpperCase(),o==="OPTGROUP")r=s,s=r.firstChild;else{if(o==="OPTION"){if(s.hasAttribute("selected")){t=i;break}i++}s=s.nextSibling,!s&&r&&(s=r.nextSibling,r=null)}n.selectedIndex=t}}},Hr=1,qy=11,Gy=3,Yy=8;function ni(){}function Ok(n){if(n)return n.getAttribute&&n.getAttribute("id")||n.id}function Fk(n){return function(t,i,s){if(s||(s={}),typeof i=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var r=i;i=Lt.createElement("html"),i.innerHTML=r}else i=Pk(i);else i.nodeType===qy&&(i=i.firstElementChild);var o=s.getNodeKey||Ok,a=s.onBeforeNodeAdded||ni,l=s.onNodeAdded||ni,c=s.onBeforeElUpdated||ni,h=s.onElUpdated||ni,u=s.onBeforeNodeDiscarded||ni,p=s.onNodeDiscarded||ni,m=s.onBeforeElChildrenUpdated||ni,v=s.skipFromChildren||ni,b=s.addChild||function(ce,ee){return ce.appendChild(ee)},C=s.childrenOnly===!0,S=Object.create(null),D=[];function N(ce){D.push(ce)}function P(ce,ee){if(ce.nodeType===Hr)for(var Se=ce.firstChild;Se;){var Ce=void 0;ee&&(Ce=o(Se))?N(Ce):(p(Se),Se.firstChild&&P(Se,ee)),Se=Se.nextSibling}}function H(ce,ee,Se){u(ce)!==!1&&(ee&&ee.removeChild(ce),p(ce),P(ce,Se))}function q(ce){if(ce.nodeType===Hr||ce.nodeType===qy)for(var ee=ce.firstChild;ee;){var Se=o(ee);Se&&(S[Se]=ee),q(ee),ee=ee.nextSibling}}q(t);function Y(ce){l(ce);for(var ee=ce.firstChild;ee;){var Se=ee.nextSibling,Ce=o(ee);if(Ce){var Me=S[Ce];Me&&Qa(ee,Me)?(ee.parentNode.replaceChild(Me,ee),Z(Me,ee)):Y(ee)}else Y(ee);ee=Se}}function Q(ce,ee,Se){for(;ee;){var Ce=ee.nextSibling;(Se=o(ee))?N(Se):H(ee,ce,!0),ee=Ce}}function Z(ce,ee,Se){var Ce=o(ee);if(Ce&&delete S[Ce],!Se){var Me=c(ce,ee);if(Me===!1||(Me instanceof HTMLElement&&(ce=Me),n(ce,ee),h(ce),m(ce,ee)===!1))return}ce.nodeName!=="TEXTAREA"?ue(ce,ee):Ky.TEXTAREA(ce,ee)}function ue(ce,ee){var Se=v(ce,ee),Ce=ee.firstChild,Me=ce.firstChild,ri,wt,Pn,Ln,At;e:for(;Ce;){for(Ln=Ce.nextSibling,ri=o(Ce);!Se&&Me;){if(Pn=Me.nextSibling,Ce.isSameNode&&Ce.isSameNode(Me)){Ce=Ln,Me=Pn;continue e}wt=o(Me);var oi=Me.nodeType,yn=void 0;if(oi===Ce.nodeType&&(oi===Hr?(ri?ri!==wt&&((At=S[ri])?Pn===At?yn=!1:(ce.insertBefore(At,Me),wt?N(wt):H(Me,ce,!0),Me=At,wt=o(Me)):yn=!1):wt&&(yn=!1),yn=yn!==!1&&Qa(Me,Ce),yn&&Z(Me,Ce)):(oi===Gy||oi==Yy)&&(yn=!0,Me.nodeValue!==Ce.nodeValue&&(Me.nodeValue=Ce.nodeValue))),yn){Ce=Ln,Me=Pn;continue e}wt?N(wt):H(Me,ce,!0),Me=Pn}if(ri&&(At=S[ri])&&Qa(At,Ce))Se||b(ce,At),Z(At,Ce);else{var fe=a(Ce);fe!==!1&&(fe&&(Ce=fe),Ce.actualize&&(Ce=Ce.actualize(ce.ownerDocument||Lt)),b(ce,Ce),Y(Ce))}Ce=Ln,Me=Pn}Q(ce,Me,wt);var Yr=Ky[ce.nodeName];Yr&&Yr(ce,ee)}var J=t,se=J.nodeType,ye=i.nodeType;if(!C){if(se===Hr)ye===Hr?Qa(t,i)||(p(t),J=Rk(t,Lk(i.nodeName,i.namespaceURI))):J=i;else if(se===Gy||se===Yy){if(ye===se)return J.nodeValue!==i.nodeValue&&(J.nodeValue=i.nodeValue),J;J=i}}if(J===i)p(t);else{if(i.isSameNode&&i.isSameNode(J))return;if(Z(J,i,C),D)for(var _e=0,Ee=D.length;_e<Ee;_e++){var Oe=S[D[_e]];Oe&&H(Oe,Oe.parentNode,!1)}}return!C&&J!==t&&t.parentNode&&(J.actualize&&(J=J.actualize(t.ownerDocument||Lt)),t.parentNode.replaceChild(J,t)),J}}var zk=Fk(Dk);function Oh(n,e,t={}){const i=y(n);if(typeof e=="string"&&!e.length){t.childrenOnly?i.empty():i.replaceWith(document.createTextNode(""));return}if(e===null){i.remove();return}const s="z-zui-inited",{getNodeKey:r,onElUpdated:o,onBeforeElUpdated:a,onBeforeElChildrenUpdated:l,executeScript:c=!0,...h}=t,u=new Set;zk(n,e,{...h,getNodeKey:function(p){const m=r==null?void 0:r(p);if(m!==void 0)return m;if(p instanceof Element&&p.tagName==="BODY")return p.tagName;if(p.getAttribute)return p.getAttribute("zui-key")??p.id},onBeforeElUpdated(p,m){const v=a==null?void 0:a(p,m);if(v!==void 0)return v;if(p.classList.contains("preserve-on-morph"))return!1;if(p.classList.contains("no-morph")||p.hasAttribute("zui-create")!==m.hasAttribute("zui-create")||p.tagName==="IFRAME"&&!p.classList.contains("morph")||p.tagName==="ZEN-EDITOR"||p.tagName.includes("-")&&p.isEqualNode(m))return p.replaceWith(m),!1;if(p.tagName==="SCRIPT"&&c){const C=m.textContent;C&&y(p).addClass("zui-js-run").parent().runJS(C)}const b=y(p);if((p.hasAttribute("zui-create")||p.hasAttribute("data-zui"))&&(!m.childNodes.length||b.zui()instanceof ve)){if(p.isEqualNode(m))u.add(p);else{let C=!0;Array.from(m.attributes).forEach(S=>{const{name:D,value:N}=S;D==="class"?b.addClass(N):p.getAttribute(D)!==N&&((D==="zui-create"||D.startsWith("zui-create-"))&&(C=!1),p.setAttribute(D,N))}),C&&u.add(p)}return!1}return!0},onBeforeElChildrenUpdated(p,m){const v=l==null?void 0:l(p,m);return v!==void 0?v:p.classList.contains("no-morph")?!1:!p.tagName.includes("-")},onElUpdated(p){if(o==null||o(p),p.tagName!=="SCRIPT"){p.hasAttribute(s)&&p.removeAttribute(s);const m=Us(p);Object.values(m).forEach(v=>{if(v instanceof We){const{ATTR_KEY:b,DATA_KEY:C}=v.constructor;p.setAttribute(b,""),p.setAttribute(C,`${v.gid}`)}})}}}),i.zuiInit({update:"reset",beforeCreate:p=>!u.has(p)}),u.forEach(p=>{y(p).trigger("skipMorph")}),c&&i.find("script:not(.zui-js-run)").each((p,m)=>{const v=m.textContent;v&&i.runJS(v)})}y.fn.morph=function(n,e){return this.each((t,i)=>{Oh(i,n,e)})},y.fn.morphInner=function(n,e){return this.each((t,i)=>{Oh(i,n,{...e,childrenOnly:!0})})};function Fh(n){const e=y(n);e.css({minHeight:0}).css({minHeight:Math.max(32,e[0].scrollHeight)})}y.fn.autoHeight=function(){return this.each(function(){const n=y(this);n.data("auto-height")||n.on("input paste change",function(){Fh(this)}).data("auto-height",!0),Fh(n),setTimeout(()=>Fh(n),100)})},y.fn._append=y.fn.append,y.fn._prepend=y.fn.prepend,y.fn._before=y.fn.before,y.fn._after=y.fn.after,y.fn._html=y.fn.html;function Ja(n,e){return typeof e=="string"&&(e.includes("zui-create")||e.includes("zui-init"))&&n.zuiInit(),n}function jk(n){return!!n&&n.nodeType===1}y.extend(y.fn,{append(...n){return Ja(this._append(...n),n.join(""))},prepend(...n){return Ja(this._prepend(...n),n.join(""))},before(...n){const e=this.parent();return this._before(...n),Ja(e,n.join("")),this},after(...n){const e=this.parent();return this._after(...n),Ja(e,n.join("")),this},html(n,e){if(!arguments.length)return this[0]&&this[0].innerHTML;if(n===void 0)return this;const t=/<script[\s>]/.test(n);return typeof e=="boolean"&&(e={zuiInit:e}),this.each((i,s)=>{jk(s)&&(t?y(s).empty()._append(n):s.innerHTML=n,(e==null?void 0:e.zuiInit)!==!1&&y(s).zuiInit())})}});const Bk=Object.freeze(Object.defineProperty({__proto__:null,createLink:Pt,parseLink:bg,parseUrlParams:_g},Symbol.toStringTag,{value:"Module"}));window.$&&Object.assign(window.$,{...Bk,parseRawData:Yl}),$.$=y,$.Ajax=Hs,$.AjaxForm=Ba,$.Avatar=Yc,$.BUILD=1746683036080,$.BUILD_MODE=Bv,$.BatchForm=px,$.BtnGroup=Xc,$.Burn=Nu,$.Bus=bf,$.Card=Wa,$.CardList=fh,$.ColorPicker=ha,$.CommonList=Js,$.Component=We,$.ComponentFromReact=ve,$.Computed=vi,$.ContextMenu=As,$.Custom=jo,$.CustomContent=ge,$.CustomContentClass=np,$.CustomRender=kc,$.DTable=Ri,$.Dashboard=mh,$.DataHub=pp,$.DatePicker=pa,$.DatetimePicker=ma,$.Dexie=ar,$.DocApp=$r,$.Draggable=sr,$.Dropdown=gn,$.Dropmenu=nh,$.ECharts=Rg,$.Editor=rn,$.Entity=Gb,$.FileList=ih,$.FileSelector=ba,$.FormGrid=jg,$.FormSetting=zg,$.Gantt=Bg,$.GlobalSearch=Ha,$.Graph=Wg,$.HElement=Ke,$.HElementSignals=Sc,$.HistoryPanel=Ar,$.HtmlContent=Dn,$.Icon=$e,$.ImageSelector=wa,$.ImgCutter=oh,$.Kanban=Rr,$.KanbanList=Or,$.List=er,$.Mammoth=tS,$.Menu=Ho,$.Messager=Kn,$.Modal=Re,$.ModalBase=bs,$.ModalTrigger=Cs,$.Moveable=rr,$.Nav=wu,$.NestedList=tr,$.PageEditor=za,$.Pager=Cu,$.Pick=ka,$.Picker=Ta,$.Popover=Ht,$.PopoverPanel=Ca,$.Portal=Tc,$.PriPicker=lh,$.ProgressCircle=Ko,$.PropModSymbol=Yb,$.PropModification=Xb,$.RangeSet=Kb,$.ReactComponent=me,$.SearchBox=Da,$.SearchForm=Gt,$.SearchMenu=Uo,$.SearchTree=Du,$.SeverityPicker=ch,$.Sidebar=$a,$.Signal=ct,$.Sortable=qo,$.SortableList=Go,$.SortableTree=Yo,$.Sticky=Ao,$.TIME_DAY=Zi,$.Tabs=Fr,$.TimePicker=fa,$.Toolbar=Tu,$.Tooltip=ks,$.Tree=Aa,$.Upload=Ea,$.UploadImgs=Iu,$.UserAvatar=Ua,$.VERSION=jv,$.Zinbar=dh,$.addDate=Df,$.addQueryToSearchForm=Gg,$.ajaxSubmit=Pi,$.batch=Ys,$.bindCommands=No,$.bindHotkeys=ac,$.bus=un,$.cash=y,$.classes=V,$.clearData=M_,$.cmp=qb,$.computed=je,$.convertBytes=Sn,$.cookie=cp,$.create=Io,$.createDate=Ve,$.createFormData=vo,$.createPortal=sp,$.createRef=he,$.deepCall=Bn,$.deepGet=Bs,$.deepGetPath=Zd,$.defineFn=Y_,$.delay=bi,$.disableScroll=vf,$.dom=cb,$.downloadFile=Ji,$.effect=Qt,$.enterFullscreen=Sf,$.evalValue=_i,$.executeCommand=mc,$.executeCommands=$f,$.fetchData=_t,$.formatBytes=vt,$.formatDate=lt,$.formatDateSpan=sb,$.formatString=we,$.getClassList=Gl,$.getComponent=Vs,$.getFullscreenElement=Do,$.getHotkeysMap=oc,$.getReactComponent=ep,$.getUniqueCode=pc,$.getZData=Xi,$.h=w,$.hotkeys=q_,$.i18n=Ne,$.init=hc,$.initGlobalComponents=uc,$.isDiff=_o,$.isFetchSetting=ql,$.isNotEmptyString=$_,$.isSameDay=Wn,$.isSameMonth=dc,$.isSameWeek=eb,$.isSameYear=Ks,$.isToday=tb,$.isTomorrow=ib,$.isValidDate=fc,$.isYesterday=nb,$.jsRaw=P_,$.liveQuery=Ub,$.mapFormData=Fg,$.mergeProps=ke,$.mergeRanges=Wb,$.morph=Oh,$.nextGid=Tt,$.parseCommand=Eo,$.parseCommands=If,$.parseRawData=Yl,$.parseSize=xi,$.processSubmitResult=sh,$.rangesOverlap=Vb,$.reactComponents=xc,$.readFile=ab,$.registerComponent=kf,$.registerGlobalListener=_f,$.registerReactComponent=tt,$.removeUndefinedProps=ic,$.render=Ci,$.renderCustomContent=zo,$.renderCustomResult=tp,$.replacePrefix=Qb,$.runJS=qs,$.selectFile=ob,$.setFormDataValue=yi,$.setZData=Xl,$.shareData=sf,$.showCommentModal=rh,$.signal=Je,$.store=Xe,$.storeData=bo,$.takeData=Us,$.toCssSize=Ge,$.toggleFullscreen=cc,$.toggleSearchForm=hh,$.uid=Ei,$.unbindCommands=Mo,$.unbindHotkeys=lc,$.untracked=mb,$.updateSearchForm=qg,$.yaml=ym,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
