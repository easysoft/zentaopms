var hu=(N,et,Tt)=>{if(!et.has(N))throw TypeError("Cannot "+Tt)};var St=(N,et,Tt)=>(hu(N,et,"read from private field"),Tt?Tt.call(N):et.get(N)),Ot=(N,et,Tt)=>{if(et.has(N))throw TypeError("Cannot add the same private member more than once");et instanceof WeakSet?et.add(N):et.set(N,Tt)},Bt=(N,et,Tt,Wa)=>(hu(N,et,"write to private field"),Wa?Wa.call(N,Tt):et.set(N,Tt),Tt);var uu=(N,et,Tt)=>(hu(N,et,"access private method"),Tt);(function(N,et){typeof exports=="object"&&typeof module<"u"?et(exports):typeof define=="function"&&define.amd?define(["exports"],et):(N=typeof globalThis<"u"?globalThis:N||self,et(N.zui={}))})(this,function(N){var da,fa,nr,ir,sr,rr,or,ar,pa,tg,ma,ng,Wn,Un;"use strict";const et="",Tt="",Wa="",Lw="",Rw="",Ow="",zw="",Fw="",jw="",Bw="",Hw="",Ww="",ag="3.0.0",lg="production",ln=document,kr=window,pu=ln.documentElement,ei=ln.createElement.bind(ln),mu=ei("div"),Ua=ei("table"),cg=ei("tbody"),gu=ei("tr"),{isArray:Sr,prototype:yu}=Array,{concat:hg,filter:Va,indexOf:_u,map:vu,push:ug,slice:bu,some:Ka,splice:dg}=yu,fg=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,pg=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,mg=/<.+>/,gg=/^\w+$/;function qa(i,e){const t=yg(e);return!i||!t&&!ti(e)&&!nt(e)?[]:!t&&pg.test(i)?e.getElementsByClassName(i.slice(1).replace(/\\/g,"")):!t&&gg.test(i)?e.getElementsByTagName(i):e.querySelectorAll(i)}class Tr{constructor(e,t){if(!e)return;if(Ga(e))return e;let n=e;if(_t(e)){const s=t||ln;if(n=fg.test(e)&&ti(s)?s.getElementById(e.slice(1).replace(/\\/g,"")):mg.test(e)?Tu(e):Ga(s)?s.find(e):_t(s)?y(s).find(e):qa(e,s),!n)return}else if(ni(e))return this.ready(e);(n.nodeType||n===kr)&&(n=[n]),this.length=n.length;for(let s=0,r=this.length;s<r;s++)this[s]=n[s]}init(e,t){return new Tr(e,t)}}const ie=Tr.prototype,y=ie.init;y.fn=y.prototype=ie,ie.length=0,ie.splice=dg,typeof Symbol=="function"&&(ie[Symbol.iterator]=yu[Symbol.iterator]);function Ga(i){return i instanceof Tr}function $i(i){return!!i&&i===i.window}function ti(i){return!!i&&i.nodeType===9}function yg(i){return!!i&&i.nodeType===11}function nt(i){return!!i&&i.nodeType===1}function _g(i){return!!i&&i.nodeType===3}function vg(i){return typeof i=="boolean"}function ni(i){return typeof i=="function"}function _t(i){return typeof i=="string"}function $t(i){return i===void 0}function ds(i){return i===null}function wu(i){return!isNaN(parseFloat(i))&&isFinite(i)}function Ya(i){if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return e===null||e===Object.prototype}y.isWindow=$i,y.isFunction=ni,y.isArray=Sr,y.isNumeric=wu,y.isPlainObject=Ya;function ct(i,e,t){if(t){let n=i.length;for(;n--;)if(e.call(i[n],n,i[n])===!1)return i}else if(Ya(i)){const n=Object.keys(i);for(let s=0,r=n.length;s<r;s++){const o=n[s];if(e.call(i[o],o,i[o])===!1)return i}}else for(let n=0,s=i.length;n<s;n++)if(e.call(i[n],n,i[n])===!1)return i;return i}y.each=ct,ie.each=function(i){return ct(this,i)},ie.empty=function(){return this.each((i,e)=>{for(;e.firstChild;)e.removeChild(e.firstChild)})};function $r(...i){const e=vg(i[0])?i.shift():!1,t=i.shift(),n=i.length;if(!t)return{};if(!n)return $r(e,y,t);for(let s=0;s<n;s++){const r=i[s];for(const o in r)e&&(Sr(r[o])||Ya(r[o]))?((!t[o]||t[o].constructor!==r[o].constructor)&&(t[o]=new r[o].constructor),$r(e,t[o],r[o])):t[o]=r[o]}return t}y.extend=$r,ie.extend=function(i){return $r(ie,i)};const bg=/\S+/g;function Dr(i){return _t(i)?i.match(bg)||[]:[]}ie.toggleClass=function(i,e){const t=Dr(i),n=!$t(e);return this.each((s,r)=>{nt(r)&&ct(t,(o,a)=>{n?e?r.classList.add(a):r.classList.remove(a):r.classList.toggle(a)})})},ie.addClass=function(i){return this.toggleClass(i,!0)},ie.removeAttr=function(i){const e=Dr(i);return this.each((t,n)=>{nt(n)&&ct(e,(s,r)=>{n.removeAttribute(r)})})};function wg(i,e){if(i){if(_t(i)){if(arguments.length<2){if(!this[0]||!nt(this[0]))return;const t=this[0].getAttribute(i);return ds(t)?void 0:t}return $t(e)?this:ds(e)?this.removeAttr(i):this.each((t,n)=>{nt(n)&&n.setAttribute(i,e)})}for(const t in i)this.attr(t,i[t]);return this}}ie.attr=wg,ie.removeClass=function(i){return arguments.length?this.toggleClass(i,!1):this.attr("class","")},ie.hasClass=function(i){return!!i&&Ka.call(this,e=>nt(e)&&e.classList.contains(i))},ie.get=function(i){return $t(i)?bu.call(this):(i=Number(i),this[i<0?i+this.length:i])},ie.eq=function(i){return y(this.get(i))},ie.first=function(){return this.eq(0)},ie.last=function(){return this.eq(-1)};function Cg(i){return $t(i)?this.get().map(e=>nt(e)||_g(e)?e.textContent:"").join(""):this.each((e,t)=>{nt(t)&&(t.textContent=i)})}ie.text=Cg;function cn(i,e,t){if(!nt(i))return;const n=kr.getComputedStyle(i,null);return t?n.getPropertyValue(e)||void 0:n[e]||i.style[e]}function Yt(i,e){return parseInt(cn(i,e),10)||0}function Cu(i,e){return Yt(i,`border${e?"Left":"Top"}Width`)+Yt(i,`padding${e?"Left":"Top"}`)+Yt(i,`padding${e?"Right":"Bottom"}`)+Yt(i,`border${e?"Right":"Bottom"}Width`)}const Qa={};function xg(i){if(Qa[i])return Qa[i];const e=ei(i);ln.body.insertBefore(e,null);const t=cn(e,"display");return ln.body.removeChild(e),Qa[i]=t!=="none"?t:"block"}function xu(i){return cn(i,"display")==="none"}function ku(i,e){const t=i&&(i.matches||i.webkitMatchesSelector||i.msMatchesSelector);return!!t&&!!e&&t.call(i,e)}function Ir(i){return _t(i)?(e,t)=>ku(t,i):ni(i)?i:Ga(i)?(e,t)=>i.is(t):i?(e,t)=>t===i:()=>!1}ie.filter=function(i){const e=Ir(i);return y(Va.call(this,(t,n)=>e.call(t,n,t)))};function kn(i,e){return e?i.filter(e):i}ie.detach=function(i){return kn(this,i).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),this};const kg=/^\s*<(\w+)[^>]*>/,Sg=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,Su={"*":mu,tr:cg,td:gu,th:gu,thead:Ua,tbody:Ua,tfoot:Ua};function Tu(i){if(!_t(i))return[];if(Sg.test(i))return[ei(RegExp.$1)];const e=kg.test(i)&&RegExp.$1,t=Su[e]||Su["*"];return t.innerHTML=i,y(t.childNodes).detach().get()}y.parseHTML=Tu,ie.has=function(i){const e=_t(i)?(t,n)=>qa(i,n).length:(t,n)=>n.contains(i);return this.filter(e)},ie.not=function(i){const e=Ir(i);return this.filter((t,n)=>(!_t(i)||nt(n))&&!e.call(n,t,n))};function hn(i,e,t,n){const s=[],r=ni(e),o=n&&Ir(n);for(let a=0,l=i.length;a<l;a++)if(r){const c=e(i[a]);c.length&&ug.apply(s,c)}else{let c=i[a][e];for(;c!=null&&!(n&&o(-1,c));)s.push(c),c=t?c[e]:null}return s}function $u(i){return i.multiple&&i.options?hn(Va.call(i.options,e=>e.selected&&!e.disabled&&!e.parentNode.disabled),"value"):i.value||""}function Tg(i){return arguments.length?this.each((e,t)=>{const n=t.multiple&&t.options;if(n||zu.test(t.type)){const s=Sr(i)?vu.call(i,String):ds(i)?[]:[String(i)];n?ct(t.options,(r,o)=>{o.selected=s.indexOf(o.value)>=0},!0):t.checked=s.indexOf(t.value)>=0}else t.value=$t(i)||ds(i)?"":i}):this[0]&&$u(this[0])}ie.val=Tg,ie.is=function(i){const e=Ir(i);return Ka.call(this,(t,n)=>e.call(t,n,t))},y.guid=1;function Qt(i){return i.length>1?Va.call(i,(e,t,n)=>_u.call(n,e)===t):i}y.unique=Qt,ie.add=function(i,e){return y(Qt(this.get().concat(y(i,e).get())))},ie.children=function(i){return kn(y(Qt(hn(this,e=>e.children))),i)},ie.parent=function(i){return kn(y(Qt(hn(this,"parentNode"))),i)},ie.index=function(i){const e=i?y(i)[0]:this[0],t=i?this:y(e).parent().children();return _u.call(t,e)},ie.closest=function(i){const e=this.filter(i);if(e.length)return e;const t=this.parent();return t.length?t.closest(i):e},ie.siblings=function(i){return kn(y(Qt(hn(this,e=>y(e).parent().children().not(e)))),i)},ie.find=function(i){return y(Qt(hn(this,e=>qa(i,e))))};const $g=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Dg=/^$|^module$|\/(java|ecma)script/i,Ig=["type","src","nonce","noModule"];function Ng(i,e){const t=y(i);t.filter("script").add(t.find("script")).each((n,s)=>{if(Dg.test(s.type)&&pu.contains(s)){const r=ei("script");r.text=s.textContent.replace($g,""),ct(Ig,(o,a)=>{s[a]&&(r[a]=s[a])}),e.head.insertBefore(r,null),e.head.removeChild(r)}})}function Mg(i,e,t,n,s){n?i.insertBefore(e,t?i.firstChild:null):i.nodeName==="HTML"?i.parentNode.replaceChild(e,i):i.parentNode.insertBefore(e,t?i:i.nextSibling),s&&Ng(e,i.ownerDocument)}function Sn(i,e,t,n,s,r,o,a){return ct(i,(l,c)=>{ct(y(c),(d,u)=>{ct(y(e),(p,g)=>{const b=t?u:g,C=t?g:u,S=t?d:p;Mg(b,S?C.cloneNode(!0):C,n,s,!S)},a)},o)},r),e}ie.after=function(){return Sn(arguments,this,!1,!1,!1,!0,!0)},ie.append=function(){return Sn(arguments,this,!1,!1,!0)};function Eg(i){if(!arguments.length)return this[0]&&this[0].innerHTML;if($t(i))return this;const e=/<script[\s>]/.test(i);return this.each((t,n)=>{nt(n)&&(e?y(n).empty().append(i):n.innerHTML=i)})}ie.html=Eg,ie.appendTo=function(i){return Sn(arguments,this,!0,!1,!0)},ie.wrapInner=function(i){return this.each((e,t)=>{const n=y(t),s=n.contents();s.length?s.wrapAll(i):n.append(i)})},ie.before=function(){return Sn(arguments,this,!1,!0)},ie.wrapAll=function(i){let e=y(i),t=e[0];for(;t.children.length;)t=t.firstElementChild;return this.first().before(e),this.appendTo(t)},ie.wrap=function(i){return this.each((e,t)=>{const n=y(i)[0];y(t).wrapAll(e?n.cloneNode(!0):n)})},ie.insertAfter=function(i){return Sn(arguments,this,!0,!1,!1,!1,!1,!0)},ie.insertBefore=function(i){return Sn(arguments,this,!0,!0)},ie.prepend=function(){return Sn(arguments,this,!1,!0,!0,!0,!0)},ie.prependTo=function(i){return Sn(arguments,this,!0,!0,!0,!1,!1,!0)},ie.contents=function(){return y(Qt(hn(this,i=>i.tagName==="IFRAME"?[i.contentDocument]:i.tagName==="TEMPLATE"?i.content.childNodes:i.childNodes)))},ie.next=function(i,e,t){return kn(y(Qt(hn(this,"nextElementSibling",e,t))),i)},ie.nextAll=function(i){return this.next(i,!0)},ie.nextUntil=function(i,e){return this.next(e,!0,i)},ie.parents=function(i,e){return kn(y(Qt(hn(this,"parentElement",!0,e))),i)},ie.parentsUntil=function(i,e){return this.parents(e,i)},ie.prev=function(i,e,t){return kn(y(Qt(hn(this,"previousElementSibling",e,t))),i)},ie.prevAll=function(i){return this.prev(i,!0)},ie.prevUntil=function(i,e){return this.prev(e,!0,i)},ie.map=function(i){return y(hg.apply([],vu.call(this,(e,t)=>i.call(e,t,e))))},ie.clone=function(){return this.map((i,e)=>e.cloneNode(!0))},ie.offsetParent=function(){return this.map((i,e)=>{let t=e.offsetParent;for(;t&&cn(t,"position")==="static";)t=t.offsetParent;return t||pu})},ie.slice=function(i,e){return y(bu.call(this,i,e))};const Ag=/-([a-z])/g;function Xa(i){return i.replace(Ag,(e,t)=>t.toUpperCase())}ie.ready=function(i){const e=()=>setTimeout(i,0,y);return ln.readyState!=="loading"?e():ln.addEventListener("DOMContentLoaded",e),this},ie.unwrap=function(){return this.parent().each((i,e)=>{if(e.tagName==="BODY")return;const t=y(e);t.replaceWith(t.children())}),this},ie.offset=function(){const i=this[0];if(!i)return;const e=i.getBoundingClientRect();return{top:e.top+kr.pageYOffset,left:e.left+kr.pageXOffset}},ie.position=function(){const i=this[0];if(!i)return;const e=cn(i,"position")==="fixed",t=e?i.getBoundingClientRect():this.offset();if(!e){const n=i.ownerDocument;let s=i.offsetParent||n.documentElement;for(;(s===n.body||s===n.documentElement)&&cn(s,"position")==="static";)s=s.parentNode;if(s!==i&&nt(s)){const r=y(s).offset();t.top-=r.top+Yt(s,"borderTopWidth"),t.left-=r.left+Yt(s,"borderLeftWidth")}}return{top:t.top-Yt(i,"marginTop"),left:t.left-Yt(i,"marginLeft")}};const Du={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};ie.prop=function(i,e){if(i){if(_t(i))return i=Du[i]||i,arguments.length<2?this[0]&&this[0][i]:this.each((t,n)=>{n[i]=e});for(const t in i)this.prop(t,i[t]);return this}},ie.removeProp=function(i){return this.each((e,t)=>{delete t[Du[i]||i]})};const Pg=/^--/;function Za(i){return Pg.test(i)}const Ja={},{style:Lg}=mu,Rg=["webkit","moz","ms"];function Og(i,e=Za(i)){if(e)return i;if(!Ja[i]){const t=Xa(i),n=`${t[0].toUpperCase()}${t.slice(1)}`,s=`${t} ${Rg.join(`${n} `)}${n}`.split(" ");ct(s,(r,o)=>{if(o in Lg)return Ja[i]=o,!1})}return Ja[i]}const zg={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function Iu(i,e,t=Za(i)){return!t&&!zg[i]&&wu(e)?`${e}px`:e}function Fg(i,e){if(_t(i)){const t=Za(i);return i=Og(i,t),arguments.length<2?this[0]&&cn(this[0],i,t):i?(e=Iu(i,e,t),this.each((n,s)=>{nt(s)&&(t?s.style.setProperty(i,e):s.style[i]=e)})):this}for(const t in i)this.css(t,i[t]);return this}ie.css=Fg;function Nu(i,e){try{return i(e)}catch{return e}}const jg=/^\s+|\s+$/;function Mu(i,e){const t=i.dataset[e]||i.dataset[Xa(e)];return jg.test(t)?t:Nu(JSON.parse,t)}function Bg(i,e,t){t=Nu(JSON.stringify,t),i.dataset[Xa(e)]=t}function Hg(i,e){if(!i){if(!this[0])return;const t={};for(const n in this[0].dataset)t[n]=Mu(this[0],n);return t}if(_t(i))return arguments.length<2?this[0]&&Mu(this[0],i):$t(e)?this:this.each((t,n)=>{Bg(n,i,e)});for(const t in i)this.data(t,i[t]);return this}ie.data=Hg;function Eu(i,e){const t=i.documentElement;return Math.max(i.body[`scroll${e}`],t[`scroll${e}`],i.body[`offset${e}`],t[`offset${e}`],t[`client${e}`])}ct([!0,!1],(i,e)=>{ct(["Width","Height"],(t,n)=>{const s=`${e?"outer":"inner"}${n}`;ie[s]=function(r){if(this[0])return $i(this[0])?e?this[0][`inner${n}`]:this[0].document.documentElement[`client${n}`]:ti(this[0])?Eu(this[0],n):this[0][`${e?"offset":"client"}${n}`]+(r&&e?Yt(this[0],`margin${t?"Top":"Left"}`)+Yt(this[0],`margin${t?"Bottom":"Right"}`):0)}})}),ct(["Width","Height"],(i,e)=>{const t=e.toLowerCase();ie[t]=function(n){if(!this[0])return $t(n)?void 0:this;if(!arguments.length)return $i(this[0])?this[0].document.documentElement[`client${e}`]:ti(this[0])?Eu(this[0],e):this[0].getBoundingClientRect()[t]-Cu(this[0],!i);const s=parseInt(n,10);return this.each((r,o)=>{if(!nt(o))return;const a=cn(o,"boxSizing");o.style[t]=Iu(t,s+(a==="border-box"?Cu(o,!i):0))})}});const Au="___cd";ie.toggle=function(i){return this.each((e,t)=>{if(!nt(t))return;const n=xu(t);($t(i)?n:i)?(t.style.display=t[Au]||"",xu(t)&&(t.style.display=xg(t.tagName))):n||(t[Au]=cn(t,"display"),t.style.display="none")})},ie.hide=function(){return this.toggle(!1)},ie.show=function(){return this.toggle(!0)};const Pu="___ce",el=".",tl={focus:"focusin",blur:"focusout"},Lu={mouseenter:"mouseover",mouseleave:"mouseout"},Wg=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function nl(i){return Lu[i]||tl[i]||i}function il(i){const e=i.split(el);return[e[0],e.slice(1).sort()]}ie.trigger=function(i,e){if(_t(i)){const[n,s]=il(i),r=nl(n);if(!r)return this;const o=Wg.test(r)?"MouseEvents":"HTMLEvents";i=ln.createEvent(o),i.initEvent(r,!0,!0),i.namespace=s.join(el),i.___ot=n}i.___td=e;const t=i.___ot in tl;return this.each((n,s)=>{t&&ni(s[i.___ot])&&(s[`___i${i.type}`]=!0,s[i.___ot](),s[`___i${i.type}`]=!1),s.dispatchEvent(i)})};function Ru(i){return i[Pu]=i[Pu]||{}}function Ug(i,e,t,n,s){const r=Ru(i);r[e]=r[e]||[],r[e].push([t,n,s]),i.addEventListener(e,s)}function Ou(i,e){return!e||!Ka.call(e,t=>i.indexOf(t)<0)}function Nr(i,e,t,n,s){const r=Ru(i);if(e)r[e]&&(r[e]=r[e].filter(([o,a,l])=>{if(s&&l.guid!==s.guid||!Ou(o,t)||n&&n!==a)return!0;i.removeEventListener(e,l)}));else for(e in r)Nr(i,e,t,n,s)}ie.off=function(i,e,t){if($t(i))this.each((n,s)=>{!nt(s)&&!ti(s)&&!$i(s)||Nr(s)});else if(_t(i))ni(e)&&(t=e,e=""),ct(Dr(i),(n,s)=>{const[r,o]=il(s),a=nl(r);this.each((l,c)=>{!nt(c)&&!ti(c)&&!$i(c)||Nr(c,a,o,e,t)})});else for(const n in i)this.off(n,i[n]);return this},ie.remove=function(i){return kn(this,i).detach().off(),this},ie.replaceWith=function(i){return this.before(i).remove()},ie.replaceAll=function(i){return y(i).replaceWith(this),this};function Vg(i,e,t,n,s){if(!_t(i)){for(const r in i)this.on(r,e,t,i[r],s);return this}return _t(e)||($t(e)||ds(e)?e="":$t(t)?(t=e,e=""):(n=t,t=e,e="")),ni(n)||(n=t,t=void 0),n?(ct(Dr(i),(r,o)=>{const[a,l]=il(o),c=nl(a),d=a in Lu,u=a in tl;c&&this.each((p,g)=>{if(!nt(g)&&!ti(g)&&!$i(g))return;const b=function(C){if(C.target[`___i${C.type}`])return C.stopImmediatePropagation();if(C.namespace&&!Ou(l,C.namespace.split(el))||!e&&(u&&(C.target!==g||C.___ot===c)||d&&C.relatedTarget&&g.contains(C.relatedTarget)))return;let S=g;if(e){let D=C.target;for(;!ku(D,e);)if(D===g||(D=D.parentNode,!D))return;S=D}Object.defineProperty(C,"currentTarget",{configurable:!0,get(){return S}}),Object.defineProperty(C,"delegateTarget",{configurable:!0,get(){return g}}),Object.defineProperty(C,"data",{configurable:!0,get(){return t}});const x=n.call(S,C,C.___td);s&&Nr(g,c,l,e,b),x===!1&&(C.preventDefault(),C.stopPropagation())};b.guid=n.guid=n.guid||y.guid++,Ug(g,c,l,e,b)})}),this):this}ie.on=Vg;function Kg(i,e,t,n){return this.on(i,e,t,n,!0)}ie.one=Kg;const qg=/\r?\n/g;function Gg(i,e){return`&${encodeURIComponent(i)}=${encodeURIComponent(e.replace(qg,`\r
`))}`}const Yg=/file|reset|submit|button|image/i,zu=/radio|checkbox/i;ie.serialize=function(){let i="";return this.each((e,t)=>{ct(t.elements||[t],(n,s)=>{if(s.disabled||!s.name||s.tagName==="FIELDSET"||Yg.test(s.type)||zu.test(s.type)&&!s.checked)return;const r=$u(s);if(!$t(r)){const o=Sr(r)?r:[r];ct(o,(a,l)=>{i+=Gg(s.name,l)})}})}),i.slice(1)},window.$=y;function Fu(i,e){if(i==null)return[i,void 0];typeof e=="string"&&(e=e.split("."));const t=e.join(".");let n=i;const s=[n];for(;typeof n=="object"&&n!==null&&e.length;){let r=e.shift(),o;const a=r.indexOf("[");if(a>0&&a<r.length-1&&r.endsWith("]")&&(o=r.substring(a+1,r.length-1),r=r.substring(0,a)),n=n[r],s.push(n),o!==void 0)if(typeof n=="object"&&n!==null)n instanceof Map?n=n.get(o):n=n[o],s.push(n);else throw new Error(`Cannot access property "${r}[${o}]", the full path is "${t}".`)}if(e.length)throw new Error(`Cannot access property with rest path "${e.join(".")}", the full path is "${t}".`);return s}function fs(i,e,t){try{const n=Fu(i,e),s=n[n.length-1];return s===void 0?t:s}catch{return t}}function Tn(i,e,t,n){const s=fs(i,e);return typeof s=="function"?s.apply(n||i,t):s}function Ce(i,...e){if(e.length===0)return i;if(e.length===1&&typeof e[0]=="object"&&e[0]){const t=e[0];return Object.keys(t).forEach(n=>{const s=t[n]??"";i=i.replace(new RegExp(`\\{${n}\\}`,"g"),`${s}`)}),i}for(let t=0;t<e.length;t++){const n=e[t]??"";i=i.replace(new RegExp(`\\{${t}\\}`,"g"),`${n}`)}return i}var sl=(i=>(i[i.B=1]="B",i[i.KB=1024]="KB",i[i.MB=1048576]="MB",i[i.GB=1073741824]="GB",i[i.TB=1099511627776]="TB",i))(sl||{});function dt(i,e=2,t){return Number.isNaN(i)?"?KB":(t||(i<1024?t="B":i<1048576?t="KB":i<1073741824?t="MB":i<1099511627776?t="GB":t="TB"),(i/sl[t]).toFixed(e)+t)}const $n=i=>{const e=/^[0-9]*(B|KB|MB|GB|TB)$/;i=i.toUpperCase();const t=i.match(e);if(!t)return 0;const n=t[1];return i=i.replace(n,""),Number.parseInt(i,10)*sl[n]};let rl=(document.documentElement.getAttribute("lang")||"zh_cn").toLowerCase().replace("-","_"),un;function Qg(){return rl}function Xg(i){rl=i.toLowerCase().replace("-","_")}function ju(i,e){un||(un={}),typeof i=="string"&&(i={[i]:e??{}}),y.extend(!0,un,i)}function Ne(i,e,t,n,s,r){Array.isArray(i)?un&&i.unshift(un):i=un?[un,i]:[i],typeof t=="string"&&(r=s,s=n,n=t,t=void 0);const o=s||rl;let a;for(const l of i){if(!l)continue;const c=l[o]||l.default;if(!c)continue;const d=r&&l===un?`${r}.${e}`:e;if(a=fs(c,d),a!==void 0)break}return a===void 0?n:t?Ce(a,...Array.isArray(t)?t:[t]):a}function Zg(i,e,t,n){return Ne(void 0,i,e,t,n)}Ne.addLang=ju,Ne.getLang=Zg,Ne.getCode=Qg,Ne.setCode=Xg,Ne.map=un,ju({zh_cn:{confirm:"确定",save:"保存",cancel:"取消",delete:"删除",reset:"重置",add:"添加",copy:"复制",close:"关闭"},zh_tw:{confirm:"確定",save:"儲存",cancel:"取消",delete:"刪除",reset:"重置",add:"添加",Copy:"複製",close:"關閉"},en:{confirm:"Confirm",save:"Save",cancel:"Cancel",delete:"Delete",reset:"Reset",add:"Add",copy:"Copy",close:"Close"}});function Bu(i,e,t){i instanceof Headers?i.set(e,t):Array.isArray(i)?i.push([e,t]):i[e]=t}function Di(i,e,t){t!=null&&(Array.isArray(t)?t.forEach(n=>Di(i,e,n)):!(t instanceof Blob)&&y.isPlainObject(t)?Object.entries(t).forEach(([n,s])=>{Di(i,`${e}[${n}]`,s)}):i.append(e,t instanceof Blob?t:String(t)))}function Jg(i,e){if(i){const t={text:"text/plain",html:"text/html",json:"application/json",...e};for(const[n,s]of Object.entries(t))if(s.split(",").map(r=>r.trim()).includes(i))return n}return"text"}function Mr(i,e){const t=e||new FormData;return i&&(typeof i=="string"&&(i=new URLSearchParams(i)),i instanceof URLSearchParams?i.forEach((n,s)=>{Di(t,s,n)}):Array.isArray(i)?i.forEach(([n,s])=>{Di(t,n,s)}):i instanceof FormData?i.forEach((n,s)=>{Di(t,s,n)}):y.isPlainObject(i)&&Object.entries(i).forEach(([n,s])=>{Di(t,n,s)})),t}class ps{get completed(){return this.data!==void 0||this.error!==void 0}get[Symbol.toStringTag](){return"Ajax"}constructor(e){this.setting=e,this._controller=new AbortController,this._callbacks={success:[],error:[],complete:[]}}on(e,t){return this._callbacks[e].push(t),this}success(e){return this.on("success",e)}done(e){return this.success(e)}fail(e){return this.on("error",e)}complete(e){return this.on("complete",e)}always(e){return this.complete(e)}then(e,t){return this.completed?t&&this.error?t(this.error):e(this.data):(this.success(n=>e(n)),t&&this.fail(t)),this}catch(e){return this.error?(e(this.error),this):this.on("error",t=>e(t))}finally(e){return this.completed?(e(),this):this.complete(()=>e())}abort(e){return this.completed?!1:(this._abortError=e,this._controller.abort(),!0)}getResponseHeader(e){var t;return(t=this.response)==null?void 0:t.headers.get(e)}_init(){if(this.completed)return;const{url:e,type:t,data:n,processData:s=!0,contentType:r,crossDomain:o,accepts:a,dataType:l,timeout:c,dataFilter:d,beforeSend:u,success:p,error:g,complete:b,...C}=this.setting;t&&(C.method=t);let S=n;S&&(s&&(S=Mr(S)),C.body=S),o&&(C.mode="cors");const x=C.headers||{};Bu(x,"X-Requested-With","XMLHttpRequest"),r&&Bu(x,"Content-Type",r),C.headers=x,C.signal&&C.signal.addEventListener("abort",()=>{this.abort()});const D=[...this.constructor.globalBeforeSends,u];for(const A of D){if(!A)continue;const B=A.call(this,C);if(B===!1)return;B&&Object.assign(C,B)}p&&this.success(p),g&&this.fail(g),b&&this.complete(b),C.signal=this._controller.signal,this.url=e,this.request=C}_emit(e,...t){this._callbacks[e].forEach(n=>{n.call(this,...t)})}async send(){var d;if(this.completed)return[];this._init();const{timeout:e,dataType:t,accepts:n,dataFilter:s,throws:r,jsonParser:o}=this.setting;e&&(this._timeoutID=window.setTimeout(()=>{this.abort(new Error("timeout"))},e));let a,l,c;try{a=await fetch(this.url,this.request),this.response=a;const{statusText:u}=a;if(a.ok){const p=(d=a.headers.get("Content-Disposition"))==null?void 0:d.startsWith("attachment"),g=p?"blob":t||Jg(a.headers.get("Content-Type"),n);p||g==="blob"||g==="file"?c=await a.blob():g==="json"?typeof o=="function"?(c=await a.text(),c=o(c)):c=await a.json():c=await a.text(),this.data=c;const b=(s==null?void 0:s(c,g))??c;this._emit("success",b,u,a)}else throw this.data=await a.text(),new Error(u)}catch(u){this.data===void 0&&c!==void 0&&(this.data=c),l=u;let p=!1;l.name==="AbortError"&&(this._abortError?l=this._abortError:p=!0),this.error=l,p||this._emit("error",l,a==null?void 0:a.statusText,l.message)}if(this._timeoutID&&clearTimeout(this._timeoutID),this._emit("complete",a,a==null?void 0:a.statusText),l&&r)throw l;return[c,l,a]}}ps.globalBeforeSends=[],y.ajax=(i,e)=>{e=e||{},typeof i=="string"?e.url=i:y.extend(e,i);const t=new ps(e);return t.send(),t},y.getJSON=(i,e,t)=>(typeof e=="function"&&(t=e,e=void 0),y.ajax({url:i,data:e,success:t,dataType:"json"})),y.get=(i,e,t,n,s="GET")=>{let r,o;return typeof e=="function"?(r=e,o=void 0):o=e,typeof t=="function"?(r=t,n=void 0):n=t,y.ajax({method:s,url:i,data:o,success:r,dataType:n})},y.post=(i,e,t,n)=>y.get(i,e,t,n,"POST"),y.fn.load=function(i,e,t){typeof e=="function"&&(t=e,e=void 0);const[n,s]=i.split(" ");return y.get(n,e,(r,o,a)=>{s&&(r=y(r).find(s).html()),y(this).html(r).zuiInit(),t==null||t.call(this,r,o,a)},"html"),this};async function zt(i,e=[],t,n,s){const r={throws:!0,dataType:"json"};if(typeof i=="string")r.url=i;else if(typeof i=="object")y.extend(r,i);else if(typeof i=="function"){const l=i.call(n,...e);return l instanceof Promise?await l:l}t&&y.extend(r,typeof t=="function"?t(r):t),r.url&&(r.url=Ce(r.url,...e));const o=new ps(r);s==null||s(o);const[a]=await o.send();return a}function ol(i){return!!(i&&(typeof i=="string"||typeof i=="object"&&i.url||typeof i=="function"))}y.fetch=zt;function ft(){return y.guid++}function Er(i,e){if(i===e)return!1;if(i&&e){const t=typeof i,n=typeof e;if(t!==n)return!0;if(t==="object"&&n==="object"){const s=Array.isArray(i),r=Array.isArray(e);if(s!==r)return!0;if(s&&r){if(i.length!==e.length)return!0;for(let l=0;l<i.length;l++)if(Er(i[l],e[l]))return!0;return!1}const o=Object.keys(i),a=Object.keys(e);if(o.length!==a.length)return!0;for(const l of o)if(Er(i[l],e[l]))return!0;return!1}if(t==="function"&&n==="function")return i.toString()!==e.toString()}return i!==e}class ii{constructor(e,t){this._compute=e,this._dependencies=t}get value(){return this.compute()}get cache(){return this._lastDependencies?this._value:this.compute()}depends(e){return this._dependencies=e,this}forceCompute(e){return this._lastDependencies=void 0,this.compute(e)}compute(e){e!==void 0&&(this._dependencies=e),e=this._dependencies,typeof e=="function"&&(e=e());const t=this._lastDependencies;return(!t||e.some((n,s)=>n instanceof ii?n.value!==t[s]:Er(n,t[s])))&&(this._value=this._compute(),this._lastDependencies=e.map(n=>n instanceof ii?n.cache:n)),this._value}}function al(...i){const e=[],t=new Map,n=(s,r)=>{if(Array.isArray(s)&&(r=s[1],s=s[0]),!s.length)return;const o=t.get(s);typeof o=="number"?e[o][1]=!!r:(t.set(s,e.length),e.push([s,!!r]))};return i.forEach(s=>{typeof s=="function"&&(s=s()),Array.isArray(s)?al(...s).forEach(n):s&&typeof s=="object"?Object.entries(s).forEach(n):typeof s=="string"&&s.split(" ").forEach(r=>n(r,!0))}),e.sort((s,r)=>(t.get(s[0])||0)-(t.get(r[0])||0))}const V=(...i)=>al(...i).reduce((e,[t,n])=>(n&&e.push(t),e),[]).join(" ");y.classes=V,y.fn.setClass=function(i,...e){return this.each((t,n)=>{const s=y(n);i===!0?s.attr("class",V(s.attr("class"),...e)):s.addClass(V(i,...e))})};const Ii=new WeakMap;function Ar(i,e,t){const n=Ii.has(i),s=n?Ii.get(i):{};typeof e=="string"?s[e]=t:e===null?Object.keys(s).forEach(r=>{delete s[r]}):Object.assign(s,e),Object.keys(s).forEach(r=>{s[r]===void 0&&delete s[r]}),Object.keys(s).length?(!n&&i instanceof Element&&Object.assign(s,y(i).dataset(),s),Ii.set(i,s)):Ii.delete(i)}function ms(i,e,t){let n=Ii.get(i)||{};return t&&i instanceof Element&&(n=Object.assign({},y(i).dataset(),n)),e===void 0?n:n[e]}function ey(i){Ii.delete(i)}y.fn.dataset=y.fn.data,y.fn.data=function(...i){const[e,t]=i;return!i.length||i.length===1&&typeof e=="string"?this.length?ms(this[0],e,!0):void 0:this.each((n,s)=>Ar(s,e,t))},y.fn.removeData=function(i=null){return this.each((e,t)=>Ar(t,i))};function si(i,...e){return i.includes("RAWJS")&&(i=i.split('"RAWJS<').join("").split('>RAWJS"').join("").split("<RAWJS_QUOTE>").join('"').split("<RAWJS_LINE>").join(`
`)),new Function(`return ${i}`)(...e)}function ll(i,...e){return i.includes("RAWJS")?si(i,...e):JSON.parse(i)}function Ni(i,e){const t=y(i)[0];if(!t)return;const{prefix:n,getter:s,evalValue:r,json:o=!0,evalArgs:a=[]}={prefix:"z-",...typeof e=="string"?{prefix:e}:e},l=Array.isArray(r)?new Set(r):void 0;return Array.from(t.attributes).reduce((c,d)=>{let{name:u}=d;const{value:p}=d;let g=p;if(u.startsWith(n)){if(u=u.slice(n.length).replace(/-([a-z])/g,b=>b[1].toUpperCase()),s)g=s(u,p);else try{r&&(!l||l.has(u))||r===void 0&&p.includes("RAWJS")?g=si(p,...a):o&&(g=JSON.parse(p))}catch{}c[u]=g}return c},{})}function cl(i,e,t="z-"){const n=y(i);Object.keys(e).forEach(s=>{let r=e[s];typeof r=="function"&&(r=`RAWJS<${r}>RAWJS`),typeof r!="string"&&(r=JSON.stringify(r)),s=s.replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`),n.attr(`${t}${s}`,r)})}function ty(...i){var t;const e=i.length;if(!e)return Ni(this);if(e===1){const[n]=i;return typeof n=="string"?(t=Ni(this))==null?void 0:t[n]:(y.isPlainObject(n)&&cl(this,n),this)}return cl(this,{[i[0]]:i[1]}),this}y.fn.z=ty,y.fn._attr=y.fn.attr,y.fn.extend({attr(...i){const[e,t]=i;return!i.length||i.length===1&&typeof e=="string"?this._attr.apply(this,i):typeof e=="object"?(e&&Object.keys(e).forEach(n=>{const s=e[n];s===null?this.removeAttr(n):this._attr(n,s)}),this):t===null?this.removeAttr(e):this._attr(e,t)}}),y.Event||(y.Event=(i,e)=>{const[t,...n]=i.split("."),s=new Event(t,{bubbles:!0,cancelable:!0});return s.namespace=n.join("."),s.___ot=t,s.___td=e,s});const gs=(i,e)=>new Promise(t=>{const n=window.setTimeout(t,i);e&&e(n)}),Hu={};y.share=Hu;var Pr,Oe,Wu;N.isValidElement=void 0;var ri,Uu,Vu,hl,ul,dl,fl,ys={},Ku=[],ny=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Lr=Array.isArray;function Dn(i,e){for(var t in e)i[t]=e[t];return i}function qu(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function w(i,e,t){var n,s,r,o={};for(r in e)r=="key"?n=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?Pr.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(r in i.defaultProps)o[r]===void 0&&(o[r]=i.defaultProps[r]);return Rr(i,o,n,s,null)}function Rr(i,e,t,n,s){var r={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++Wu,__i:-1,__u:0};return s==null&&Oe.vnode!=null&&Oe.vnode(r),r}function fe(){return{current:null}}function In(i){return i.children}function pe(i,e){this.props=i,this.context=e}function Mi(i,e){if(e==null)return i.__?Mi(i.__,i.__i+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?Mi(i):null}function Gu(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return Gu(i)}}function Yu(i){(!i.__d&&(i.__d=!0)&&ri.push(i)&&!Or.__r++||Uu!==Oe.debounceRendering)&&((Uu=Oe.debounceRendering)||Vu)(Or)}function Or(){var i,e,t,n,s,r,o,a;for(ri.sort(hl);i=ri.shift();)i.__d&&(e=ri.length,n=void 0,r=(s=(t=i).__v).__e,o=[],a=[],t.__P&&((n=Dn({},s)).__v=s.__v+1,Oe.vnode&&Oe.vnode(n),pl(t.__P,n,s,t.__n,t.__P.namespaceURI,32&s.__u?[r]:null,o,r??Mi(s),!!(32&s.__u),a),n.__v=s.__v,n.__.__k[n.__i]=n,ed(o,n,a),n.__e!=r&&Gu(n)),ri.length>e&&ri.sort(hl));Or.__r=0}function Qu(i,e,t,n,s,r,o,a,l,c,d){var u,p,g,b,C,S=n&&n.__k||Ku,x=e.length;for(t.__d=l,iy(t,e,S),l=t.__d,u=0;u<x;u++)(g=t.__k[u])!=null&&(p=g.__i===-1?ys:S[g.__i]||ys,g.__i=u,pl(i,g,p,s,r,o,a,l,c,d),b=g.__e,g.ref&&p.ref!=g.ref&&(p.ref&&ml(p.ref,null,g),d.push(g.ref,g.__c||b,g)),C==null&&b!=null&&(C=b),65536&g.__u||p.__k===g.__k?l=Xu(g,l,i):typeof g.type=="function"&&g.__d!==void 0?l=g.__d:b&&(l=b.nextSibling),g.__d=void 0,g.__u&=-196609);t.__d=l,t.__e=C}function iy(i,e,t){var n,s,r,o,a,l=e.length,c=t.length,d=c,u=0;for(i.__k=[],n=0;n<l;n++)(s=e[n])!=null&&typeof s!="boolean"&&typeof s!="function"?(o=n+u,(s=i.__k[n]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?Rr(null,s,null,null,null):Lr(s)?Rr(In,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?Rr(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=i,s.__b=i.__b+1,r=null,(a=s.__i=sy(s,t,o,d))!==-1&&(d--,(r=t[a])&&(r.__u|=131072)),r==null||r.__v===null?(a==-1&&u--,typeof s.type!="function"&&(s.__u|=65536)):a!==o&&(a==o-1?u--:a==o+1?u++:(a>o?u--:u++,s.__u|=65536))):s=i.__k[n]=null;if(d)for(n=0;n<c;n++)(r=t[n])!=null&&!(131072&r.__u)&&(r.__e==i.__d&&(i.__d=Mi(r)),td(r,r))}function Xu(i,e,t){var n,s;if(typeof i.type=="function"){for(n=i.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=i,e=Xu(n[s],e,t));return e}i.__e!=e&&(e&&i.type&&!t.contains(e)&&(e=Mi(i)),t.insertBefore(i.__e,e||null),e=i.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function zr(i,e){return e=e||[],i==null||typeof i=="boolean"||(Lr(i)?i.some(function(t){zr(t,e)}):e.push(i)),e}function sy(i,e,t,n){var s=i.key,r=i.type,o=t-1,a=t+1,l=e[t];if(l===null||l&&s==l.key&&r===l.type&&!(131072&l.__u))return t;if(n>(l!=null&&!(131072&l.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((l=e[o])&&!(131072&l.__u)&&s==l.key&&r===l.type)return o;o--}if(a<e.length){if((l=e[a])&&!(131072&l.__u)&&s==l.key&&r===l.type)return a;a++}}return-1}function Zu(i,e,t){e[0]==="-"?i.setProperty(e,t??""):i[e]=t==null?"":typeof t!="number"||ny.test(e)?t:t+"px"}function Fr(i,e,t,n,s){var r;e:if(e==="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||Zu(i.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||Zu(i.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")r=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in i||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+r]=t,t?n?t.u=n.u:(t.u=ul,i.addEventListener(e,r?fl:dl,r)):i.removeEventListener(e,r?fl:dl,r);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in i)try{i[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!=="-"?i.removeAttribute(e):i.setAttribute(e,e=="popover"&&t==1?"":t))}}function Ju(i){return function(e){if(this.l){var t=this.l[e.type+i];if(e.t==null)e.t=ul++;else if(e.t<t.u)return;return t(Oe.event?Oe.event(e):e)}}}function pl(i,e,t,n,s,r,o,a,l,c){var d,u,p,g,b,C,S,x,D,A,B,H,G,Y,Z,ee,he=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(d=Oe.__b)&&d(e);e:if(typeof he=="function")try{if(x=e.props,D="prototype"in he&&he.prototype.render,A=(d=he.contextType)&&n[d.__c],B=d?A?A.props.value:d.__:n,t.__c?S=(u=e.__c=t.__c).__=u.__E:(D?e.__c=u=new he(x,B):(e.__c=u=new pe(x,B),u.constructor=he,u.render=oy),A&&A.sub(u),u.props=x,u.state||(u.state={}),u.context=B,u.__n=n,p=u.__d=!0,u.__h=[],u._sb=[]),D&&u.__s==null&&(u.__s=u.state),D&&he.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Dn({},u.__s)),Dn(u.__s,he.getDerivedStateFromProps(x,u.__s))),g=u.props,b=u.state,u.__v=e,p)D&&he.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),D&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(D&&he.getDerivedStateFromProps==null&&x!==g&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(x,B),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(x,u.__s,B)===!1||e.__v===t.__v)){for(e.__v!==t.__v&&(u.props=x,u.state=u.__s,u.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(X){X&&(X.__=e)}),H=0;H<u._sb.length;H++)u.__h.push(u._sb[H]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(x,u.__s,B),D&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(g,b,C)})}if(u.context=B,u.props=x,u.__P=i,u.__e=!1,G=Oe.__r,Y=0,D){for(u.state=u.__s,u.__d=!1,G&&G(e),d=u.render(u.props,u.state,u.context),Z=0;Z<u._sb.length;Z++)u.__h.push(u._sb[Z]);u._sb=[]}else do u.__d=!1,G&&G(e),d=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++Y<25);u.state=u.__s,u.getChildContext!=null&&(n=Dn(Dn({},n),u.getChildContext())),D&&!p&&u.getSnapshotBeforeUpdate!=null&&(C=u.getSnapshotBeforeUpdate(g,b)),Qu(i,Lr(ee=d!=null&&d.type===In&&d.key==null?d.props.children:d)?ee:[ee],e,t,n,s,r,o,a,l,c),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),S&&(u.__E=u.__=null)}catch(X){if(e.__v=null,l||r!=null){for(e.__u|=l?160:128;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else e.__e=t.__e,e.__k=t.__k;Oe.__e(X,e,t)}else r==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=ry(t.__e,e,t,n,s,r,o,l,c);(d=Oe.diffed)&&d(e)}function ed(i,e,t){e.__d=void 0;for(var n=0;n<t.length;n++)ml(t[n],t[++n],t[++n]);Oe.__c&&Oe.__c(e,i),i.some(function(s){try{i=s.__h,s.__h=[],i.some(function(r){r.call(s)})}catch(r){Oe.__e(r,s.__v)}})}function ry(i,e,t,n,s,r,o,a,l){var c,d,u,p,g,b,C,S=t.props,x=e.props,D=e.type;if(D==="svg"?s="http://www.w3.org/2000/svg":D==="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((g=r[c])&&"setAttribute"in g==!!D&&(D?g.localName===D:g.nodeType===3)){i=g,r[c]=null;break}}if(i==null){if(D===null)return document.createTextNode(x);i=document.createElementNS(s,D,x.is&&x),a&&(Oe.__m&&Oe.__m(e,r),a=!1),r=null}if(D===null)S===x||a&&i.data===x||(i.data=x);else{if(r=r&&Pr.call(i.childNodes),S=t.props||ys,!a&&r!=null)for(S={},c=0;c<i.attributes.length;c++)S[(g=i.attributes[c]).name]=g.value;for(c in S)if(g=S[c],c!="children"){if(c=="dangerouslySetInnerHTML")u=g;else if(!(c in x)){if(c=="value"&&"defaultValue"in x||c=="checked"&&"defaultChecked"in x)continue;Fr(i,c,null,g,s)}}for(c in x)g=x[c],c=="children"?p=g:c=="dangerouslySetInnerHTML"?d=g:c=="value"?b=g:c=="checked"?C=g:a&&typeof g!="function"||S[c]===g||Fr(i,c,g,S[c],s);if(d)a||u&&(d.__html===u.__html||d.__html===i.innerHTML)||(i.innerHTML=d.__html),e.__k=[];else if(u&&(i.innerHTML=""),Qu(i,Lr(p)?p:[p],e,t,n,D==="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,o,r?r[0]:t.__k&&Mi(t,0),a,l),r!=null)for(c=r.length;c--;)qu(r[c]);a||(c="value",D==="progress"&&b==null?i.removeAttribute("value"):b!==void 0&&(b!==i[c]||D==="progress"&&!b||D==="option"&&b!==S[c])&&Fr(i,c,b,S[c],s),c="checked",C!==void 0&&C!==i[c]&&Fr(i,c,C,S[c],s))}return i}function ml(i,e,t){try{if(typeof i=="function"){var n=typeof i.__u=="function";n&&i.__u(),n&&e==null||(i.__u=i(e))}else i.current=e}catch(s){Oe.__e(s,t)}}function td(i,e,t){var n,s;if(Oe.unmount&&Oe.unmount(i),(n=i.ref)&&(n.current&&n.current!==i.__e||ml(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(r){Oe.__e(r,e)}n.base=n.__P=null}if(n=i.__k)for(s=0;s<n.length;s++)n[s]&&td(n[s],e,t||typeof i.type!="function");t||qu(i.__e),i.__c=i.__=i.__e=i.__d=void 0}function oy(i,e,t){return this.constructor(i,t)}function oi(i,e,t){var n,s,r,o;Oe.__&&Oe.__(i,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,r=[],o=[],pl(e,i=(!n&&t||e).__k=w(In,null,[i]),s||ys,ys,e.namespaceURI,!n&&t?[t]:s?null:e.firstChild?Pr.call(e.childNodes):null,r,!n&&t?t:s?s.__e:e.firstChild,n,o),ed(r,i,o)}Pr=Ku.slice,Oe={__e:function(i,e,t,n){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(i)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,n||{}),o=s.__d),o)return s.__E=s}catch(a){i=a}throw i}},Wu=0,N.isValidElement=function(i){return i!=null&&i.constructor==null},pe.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Dn({},this.state),typeof i=="function"&&(i=i(Dn({},t),this.props)),i&&Dn(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),Yu(this))},pe.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),Yu(this))},pe.prototype.render=In,ri=[],Vu=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,hl=function(i,e){return i.__v.__b-e.__v.__b},Or.__r=0,ul=0,dl=Ju(!1),fl=Ju(!0);function xe(i,...e){return e.forEach(t=>{!t||typeof t!="object"||Object.keys(t).forEach(n=>{let s=t[n];const r=i[n];s!==r&&(r!==void 0&&(n==="className"||n.endsWith("Class")?s=[r,s]:n==="children"?s=[...zr(r),...zr(s)]:typeof r=="object"&&(n==="style"||n.endsWith("Style")||n==="attrs"||n.endsWith("Attrs")||n==="props")&&(s=y.extend(r,s))),i[n]=s)})}),i}function gl(i){return Object.keys(i).forEach(e=>{i[e]===void 0&&delete i[e]}),i}function nd(i,e=!0){const t=y(i),n=t[0],s="zui-disable-scroll";if(e){if(t.data(s))return;if((t.css("scrollbar-gutter")||"").includes("stable")){t.data(s,{overflow:t.css("overflow")}).css("overflow","hidden");return}const r=n===document.body||t.is("html")?window.innerWidth-document.body.clientWidth:n.offsetWidth-n.clientWidth;if(!r)return;const o=t.css("paddingRight")||"0";t.data(s,{paddingRight:o,overflow:t.css("overflow")}).css({paddingRight:`${r+Number.parseInt(o,10)}px`,overflow:"hidden"})}else{const r=t.data(s);if(!r)return;t.css(r).removeData(s)}}y.fn.disableScroll=function(i=!0){return this.each((e,t)=>{nd(t,i)})},y.fn.enableScroll=function(i=!0){return this.disableScroll(!i)};function yl(i,e,t){if(!(t.on||"click").split(" ").includes(e.type))return;const n=t.selector?y(e.target).closest(t.selector):i;if(!n.length)return;const s=c=>c===""?!0:c,r=c=>{if(typeof c=="string")try{c=JSON.parse(c)}catch{}return c};if(s(t.once)){if(t.onceCalled)return;i.dataset("once-called",!0)}if(s(t.prevent)&&e.preventDefault(),s(t.stop)&&e.stopPropagation(),s(t.self)&&e.currentTarget!==e.target)return;const o=[["$element",i],["event",e],["options",t],["$target",n]],a=c=>typeof c=="function"?c(...o):y.runJS(c,...o);if(t.if!==void 0&&!a(t.if))return;const l=t.call;if(l){let c;if(typeof l=="string"?c=/^[$A-Z_][0-9A-Z_$.]*$/i.test(l)?fs(window,l):a(l):c=l,typeof c=="function"){const d=[],u=t.params;t.params=d,typeof u=="string"&&u.length?u[0]==="["?d.push(...r(u)):d.push(...u.split(", ").map(p=>(p=p.trim(),p==="$element"?i:p==="event"?e:p==="options"?t:p.startsWith("$element.")||p.startsWith("event.")||p.startsWith("options.")?a(p):r(p)))):Array.isArray(u)?d.push(...u):d.push(u),c(...d)}}t.do&&a(t.do)}function ay(i){const e=y(this),t=i.type,n=e.attr("zui-on");if(n){const[o,a]=n.split("~").map(l=>l.trim());o&&o.split(" ").includes(t)&&yl(e,i,y.extend({on:o},a?a.startsWith("{")?si(a):{do:a}:Ni(e,{prefix:"data-",evalValue:["call","if","do"]})))}const s=e.attr(`zui-on-${t}`);s&&yl(e,i,y.extend({on:t},s.startsWith("{")?si(s):{do:s}));const r=e.attr("data-on");r&&r.split(" ").includes(t)&&yl(e,i,Ni(e,{prefix:"data-",evalValue:["call","if","do"]}))}function id(i){y(document).off(".zui.global").on(i.map(e=>`${e}.zui.global`).join(" "),`[zui-on],${i.map(e=>`[zui-on-${e}]`)},[data-on]`,ay)}y(()=>{id(["click","change","inited"])});function ai(i,e){if(typeof i=="function")return ai(i(...e||[]));if(typeof i=="number")return[i];let t=i.match(/(\d+)(%|px)?/);return t?[parseInt(t[1]),t[2]]:(t=i.match(/(\d+)\/(\d+)/),t?[100*parseInt(t[1])/parseInt(t[2]),"%"]:[NaN])}function Be(i,e){if(i==null)return null;const[t,n="px"]=ai(i,e);return Number.isNaN(t)?typeof i=="string"?i:null:`${t}${n}`}async function jr(i,e){var n,s,r;if(i instanceof Blob){const o=document.createElement("a");return o.href=window.URL.createObjectURL(i),e&&(o.download=decodeURIComponent(e)),o.click(),o.remove(),i}if(i instanceof Response){const o=await i.blob();return e=e||((r=(s=(n=i.headers.get("Content-Disposition"))==null?void 0:n.split(";")[1])==null?void 0:s.split("=")[1])==null?void 0:r.replace(/"/g,"")),jr(o,e)}const t=await fetch(i);return jr(t)}class sd{constructor(e){this._$target=y(e)}on(...e){return this._$target.on(...e),this}one(...e){return this._$target.one(...e),this}off(...e){return this._$target.off(...e),this}trigger(...e){return this._$target.trigger(...e),this}}const Xt=new sd(document);y.bus=Xt,y.on=Xt.on.bind(Xt),y.one=Xt.one.bind(Xt),y.off=Xt.off.bind(Xt),y.trigger=Xt.trigger.bind(Xt);var ly=["Shift","Meta","Alt","Control"],rd=typeof navigator=="object"?navigator.platform:"",od=/Mac|iPod|iPhone|iPad/.test(rd),cy=od?"Meta":"Control",hy=rd==="Win32"?["Control","Alt"]:od?["Alt"]:[];function _l(i,e){return typeof i.getModifierState=="function"&&(i.getModifierState(e)||hy.includes(e)&&i.getModifierState("AltGraph"))}function uy(i){return i.trim().split(" ").map(function(e){var t=e.split(/\b\+/),n=t.pop();return[t=t.map(function(s){return s==="$mod"?cy:s}),n]})}function ad(i,e){var t;e===void 0&&(e={});var n=(t=e.timeout)!=null?t:1e3,s=Object.keys(i).map(function(a){return[uy(a),i[a]]}),r=new Map,o=null;return function(a){a instanceof KeyboardEvent&&(s.forEach(function(l){var c=l[0],d=l[1],u=r.get(c)||c;(function(p,g){return!(g[1].toUpperCase()!==p.key.toUpperCase()&&g[1]!==p.code||g[0].find(function(b){return!_l(p,b)})||ly.find(function(b){return!g[0].includes(b)&&g[1]!==b&&_l(p,b)}))})(a,u[0])?u.length>1?r.set(c,u.slice(1)):(r.delete(c),d(a)):_l(a,a.key)||r.delete(c)}),o&&clearTimeout(o),o=setTimeout(r.clear.bind(r),n))}}function dy(i,e,t){var n;t===void 0&&(t={});var s=(n=t.event)!=null?n:"keydown",r=ad(e,t);return i.addEventListener(s,r),function(){i.removeEventListener(s,r)}}function vl(i,e={}){if(!i)return;const t=Object.keys(e).reduce((n,s)=>(e[s].optional||(n[s]={...e[s]}),n),{});return Object.keys(i).forEach(n=>{const s=i[n];s?s===!0?e[n]&&(t[n]={...e[n]}):t[n]=s:delete t[n]}),Object.keys(t).reduce((n,s)=>{const{keys:r,handler:o}=t[s];return typeof r=="string"?n[r]=o:r.forEach(a=>{n[a]=o}),n},{})}function bl(i,e,t){const{timeout:n,event:s="keydown",scope:r,when:o}=t||{},a=ad(e,{timeout:n}),l=`.zui.hotkeys${r?`.${r}`:""}`,c="zui-hotkeys-composing";return y(i).on(`${s}${l}`,function(d){o&&o(d)===!1||y(d.target).data(c)||a(d)}).on(`compositionstart${l}`,d=>{y(d.target).data(c,!0)}).on(`compositionend${l}`,d=>{y(d.target).removeData(c)})}function wl(i,e){return y(i).off(`.zui.hotkeys${e?`.${e}`:""}`)}const fy=dy;y.fn.hotkeys=function(i,e){return bl(this,i,e)},y.fn.unbindHotkeys=function(i){return wl(this,i)},y.hotkeys=function(i,e){bl(window,i,e)},y.unbindHotkeys=function(i){wl(window,i)};function Br(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}async function ld(i){(typeof i=="string"||i instanceof Element||i instanceof y)&&(i={target:i});const{target:e,onError:t,onSuccess:n,afterExit:s,afterEnter:r}=i,o=y(e),a=o[0];if(!a)return;const l=a.requestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen;if(!l){t==null||t.call(a,new Error("[ZUI] The browser does not support full screen feature."));return}try{await l.call(a),n==null||n.call(a),y(a).off(".zui.fullscreen"),s&&o.on("exitFullscreen.zui.fullscreen",s),r&&o.on("enterFullscreen.zui.fullscreen",r)}catch(c){t==null||t.call(a,c)}document.zuiBindFullscreenChange||(document.zuiBindFullscreenChange=!0,y(document).on("fullscreenchange.zui webkitfullscreenchange.zui mozfullscreenchange.zui",c=>{const d=Br();let u=d;d?y(d).addClass("is-in-fullscreen"):(u=y(document).find(".is-in-fullscreen")[0]||document,y(u).removeClass("is-in-fullscreen")),y("body").toggleClass("has-in-fullscreen",!!d);const p={event:c,target:u,fullscreenElement:d};y(u).trigger(d?"enterFullscreen":"exitFullscreen",p).trigger("toggleFullscreen",p)}))}async function Cl(i){const e=Br();return i===!1&&!!e===i?i:e?(document.exitFullscreen(),!1):(await ld(i),!0)}y.fn.fullscreen=function(i){return Cl({target:this,...i})},y.getFullscreenElement=Br,y.toggleFullscreen=Cl;function Nn(i){return!i||i.parentNode===document?!1:i.parentNode?Nn(i.parentNode):!0}y.isDetached=Nn,y.fn.isDetached=function(){const i=this[0];return!i||Nn(i)};const li=class Ym{constructor(e,t){var g;this._inited=!1,this._autoDestory=0,this._destroyed=!1;const{KEY:n,DATA_KEY:s,MULTI_INSTANCE:r,NAME:o,ATTR_KEY:a,ALL:l,TYPED_ALL:c}=this.constructor;if(!o)throw new Error('[ZUI] The component must have a "NAME" static property.');const d=y(e);if(d.data(n)&&!r)throw new Error(`[ZUI] The component "${o}" has been initialized on element.`);const u=d[0],p=ft();if(this._gid=p,this._element=u,this.resetOptions(t),this._key=this.options.key??`__${p}`,l.has(u)?l.get(u).add(this):l.set(u,new Set([this])),c.has(o)?c.get(o).add(this):c.set(o,new Set([this])),d.data(n,this).attr(a,"").attr(s,`${p}`),r){const b=`${n}:ALL`;let C=d.data(b);C||(C=new Map,d.data(b,C)),C.set(this._key,this)}this.init(),(g=this.options.$onCreate)==null||g.call(this),requestAnimationFrame(async()=>{var b;this._inited=!0,await this.afterInit(),this.emit("inited",this.options),(b=this.options.$onInited)==null||b.call(this)})}static get ZUI(){return this.NAME.replace(/(^[A-Z]+)/,e=>e.toLowerCase())}static get KEY(){return`zui.${this.NAME}`}static get NAMESPACE(){return`.zui.${this.ZUI}`}static get DATA_KEY(){return`data-zui-${this.NAME}`}static get ATTR_KEY(){return`z-use-${this.NAME}`}static get SELECTOR(){return`[${this.DATA_KEY}]`}get inited(){return this._inited}get destroyed(){return this._destroyed}get element(){return this._element}get key(){return this._key}get options(){return this._options}get gid(){return this._gid}get $element(){return y(this.element)}get $emitter(){return this.$element}get i18nData(){return[this.options.i18n,this.constructor.i18n]}init(){}afterInit(){}render(e,t){this.setOptions(e,t)}destroy(){var p;const{KEY:e,DATA_KEY:t,ALL:n,TYPED_ALL:s,NAME:r,MULTI_INSTANCE:o,ATTR_KEY:a}=this.constructor,{$element:l,element:c}=this;if(this.emit("destroyed"),this._destroyed=!0,l.off(this.namespace).removeData(e).removeAttr(a).removeAttr(t),o){const g=this.$element.data(`${e}:ALL`);if(g)if(g.delete(this._key),g.size===0)this.$element.removeData(`${e}:ALL`);else{const b=g.values().next().value;l.data(e,b).attr(t,String(b==null?void 0:b.gid))}}const d=n.get(c);d&&(d.delete(this),d.size===0&&n.delete(c));const u=s.get(r);u&&(u.delete(this),u.size===0&&s.delete(r)),(p=this.options.$onDestroy)==null||p.call(this)}autoDestroy(e=100){this._autoDestory&&clearTimeout(this._autoDestory),this._autoDestory=window.setTimeout(()=>{this._autoDestory=0,Nn(this.element)&&this.destroy()},e)}setOptions(e,t){if(t){const n={...this.constructor.DEFAULT,...(e==null?void 0:e.$optionsFromDataset)!==!1?this.$element.dataset():{},...e},{$options:s}=n;if(s){const r=typeof s=="function"?s.call(this,this.element,n):s;r&&y.extend(n,r),delete n.$options}this._options=n}else e&&y.extend(this._options,e);return this._options}resetOptions(e){return this.setOptions(e,!0)}emit(e,...t){const n=y.Event(e);return n.__src=this,this.$emitter.trigger(n,[this,...t]),n}on(e,t,n){const s=this;this.$element[n!=null&&n.once?"one":"on"](this._wrapEvent(e),function(r,o){(!r.__src||r.__src===s)&&t.call(this,r,o)})}one(e,t){this.on(e,t,{once:!0})}off(e){this.$element.off(this._wrapEvent(e))}i18n(e,t,n){const{i18nData:s}=this;return Ne(s,e,t,n,this.options.lang,this.constructor.NAME)??Ne(s,e,t,n,this.options.lang)??`{i18n:${e}}`}get namespace(){return`${this.constructor.NAMESPACE}.${this._key}`}_wrapEvent(e){return e.split(" ").map(t=>t.includes(".")?t:`${t}${this.namespace}`).join(" ")}static get(e,t){const n=y(e);if(this.MULTI_INSTANCE&&t!==void 0){const s=n.data(`${this.KEY}:ALL`);return s?s.get(t):void 0}return n.data(this.KEY)}static isValid(e){return!0}static ensure(e,t){const n=this.get(e,t==null?void 0:t.key);if(n){if(this.isValid(n))return t&&n.setOptions(t),n;n.destroy()}return new this(e,t)}static getAll(e,t){var l;const{SELECTOR:n,ALL:s,TYPED_ALL:r}=this,o=[],a=c=>{c instanceof this&&(!t||t(c)!==!1)&&o.push(c)};return e?y(e).find(n).each((c,d)=>{var u;(u=s.get(d))==null||u.forEach(a)}):this!==Ym?(l=r.get(this.NAME))==null||l.forEach(a):s.forEach(c=>{c.forEach(a)}),o.sort((c,d)=>c.gid-d.gid)}static query(e,t,n){return e===void 0?this.getAll(void 0,n).pop():this.get(y(e).closest(this.SELECTOR),t)}static defineFn(e){let t=e||this.ZUI;y.fn[t]&&(t=`zui${this.NAME}`);const n=this;y.fn.extend({[t](s,...r){const o=typeof s=="object"?s:void 0,a=typeof s=="string"?s:void 0;let l;return this.each((c,d)=>{let u=n.get(d);if(u)o&&u.render(o);else{if(a)return;u=new n(d,o)}if(a){let p=u[a],g=u;p===void 0&&(g=u.$,p=g[a]),typeof p=="function"?l=p.call(g,...r):l=p}}),l!==void 0?l:this}})}static register(e,t){var s,r;e=e||this,t=(t??e.NAME).toLowerCase(),this.map.set(t,e);const n=(r=(s=e.toggle)==null?void 0:s.name)==null?void 0:r.toLowerCase();n&&n!==t&&this.toggleMap.set(n,e)}};li.DEFAULT={},li.MULTI_INSTANCE=!1,li.ALL=new Map,li.TYPED_ALL=new Map,li.map=new Map,li.toggleMap=new Map;let ze=li;function _s(i){return ze.map.get(i.toLowerCase())}function xl(i,e,t={}){let n=_s(i);if(n||(n=kl(i)),!n)return null;const{$update:s,...r}=t;if(!n.MULTI_INSTANCE){const o=n.get(e);if(o)return s&&o.render(r,s==="reset"),o}return new n(e,r)}function py(i,e,t={}){requestAnimationFrame(()=>xl(i,e,t))}function cd(i,e){ze.register(i,e)}function kl(i){const{zui:e}=window;if(e){i=i==null?void 0:i.toLowerCase();for(const t in e){const n=t.toLowerCase()===i;if(i&&!n)continue;const s=e[t];if(!(typeof s!="function"||!s.NAME||!s.ZUI)&&(ze.map.has(t.toLowerCase())||cd(s),n))return s}}}function my(i){var e;i?(e=_s(i))==null||e.defineFn():window._zuiDefined||(kl(),ze.map.forEach(t=>{t.defineFn()}),Object.assign(window,{_zuiDefined:!0}))}function gy(i,e={}){const t=y(i);let n=t.attr("zui-create");const{update:s,onCreate:r}=e,o=(a,l)=>{if(l={$update:s,$optionsFromDataset:!1,...l},r){const d=r(a,l);if(d===!1)return;d&&(l=d)}const c=l.$lib;if(c){delete l.$lib,y.getLib(c).then(()=>xl(a,i,l));return}py(a,i,l)};if(typeof n=="string"){n=n.trim();const a=n.length?n.split(",").map(d=>d.trim()):[],l=Ni(i,{prefix:"zui-create-",evalValue:!0}),c=Object.keys(l);if(!c.length&&a.length===1)o(a[0],t.dataset());else{const d=new Set;[...a,...c].forEach(u=>{if(d.has(u))return;const p=l[u];o(u,p),delete l[u],d.add(u)})}}else{const a=t.dataset(),l=a==null?void 0:a.zui;if(!l)return;console.warn("[ZUI] create component instance with [data-zui] is deprecated, use [zui-create] instead.",{element:i,options:e}),delete a.zui,o(l,a)}}function yy(){y(document).on("click.zui.toggle mouseenter.zui.toggle","[data-toggle],[zui-toggle]",function(i){const e=y(this),t=e.dataset("toggle")||e.attr("zui-toggle");if(!t)return;const n=ze.toggleMap.get(t)||_s(t),s=n==null?void 0:n.toggle;if(!s)return;const{trigger:r="click",skip:o="[disabled],.disabled",check:a}=s,l=i.type==="mouseover"?"hover":"click";if(!r.includes(l)||a&&!a.call(n,this,l,i)||o&&e.is(o))return;const{onGet:c,onCreate:d,setOptions:u=!0,getOptions:p,prevent:g=!0,handler:b,onToggle:C,convertHref:S}=s;let x=e.dataset();const D=e.attr(`zui-toggle-${t}`);if(D&&(x=y.extend(x,si(D))),S&&e.is("a")){const B=e.attr("href");if(B){const H=S===!0?{selector:"target",url:"url"}:S;"#.".includes(B[0])?H.selector&&x[H.selector]===void 0&&(x[H.selector]=B):H.url&&x[H.url]===void 0&&(x[H.url]=B)}}if(p&&(x=p.call(n,this,x,i)),b){b.call(n,this,x,l,i),g&&i.preventDefault();return}let A=c?c.call(n,this):n.get(this);if(A)u&&A.setOptions(x);else{const B=d?d.call(n,this,i,x):new n(this,x);if(!B)return;A=B}if(C){if(C.call(n,A,this,i)===!1)return}else{const{shown:B,show:H,hide:G,toggle:Y}=A;let Z;if(Y?Z=Y:H&&G?B?Z=G:Z=H:H&&(Z=H),Z)Z.call(A);else return}g&&i.preventDefault()})}function _y(i,e){const t=ms(i),n=[];return Object.keys(t).forEach(s=>{if(!s.startsWith("zui."))return;const r=t[s];(e==null?void 0:e(r,s))!==!1&&n.push(t[s])}),n}let Hr=0;function hd(i=100){if(Hr&&clearTimeout(Hr),i){Hr=window.setTimeout(()=>hd(0),i);return}Hr=0,ze.ALL.forEach(e=>{e.forEach(t=>t.autoDestroy())})}function vy(){if(!document.body||ms(document.body,"_autoDestoryMob"))return;const i=new MutationObserver(e=>{let t=!1;for(const n of e)if(n.removedNodes.length){t=!0;break}t&&hd()});i.observe(document.body,{childList:!0,subtree:!0}),Ar(document.body,"_autoDestoryMob",i)}y.fn.zuiInit=function(i){return this.find("[zui-create],[data-zui]").each(function(){var e;((e=i==null?void 0:i.beforeCreate)==null?void 0:e.call(i,this))!==!1&&gy(this,i)}),this.find("[zui-init]").each(function(){this.hasAttribute("z-zui-inited")||(this.setAttribute("z-zui-inited",""),y.runJS(this.getAttribute("zui-init"),["$element",y(this)]))}),this.find(".hide-before-init").removeClass("invisible hidden opacity-0"),this.find(".scroll-into-view").scrollIntoView(),this.find('[data-on="inited"],[zui-on-inited]').each((e,t)=>{const n=y(t);n.zui()||n.trigger("inited")}),this},y.fn.zui=function(i,e){const t=this[0];if(!t)return;if(typeof i!="string"){const s={};let r;return _y(t,(o,a)=>{s[a]=o,(!r||r.gid<o.gid)&&(r=s[a])}),i===!0?s:r}const n=_s(i);return n?e===!0?n.getAll(t):n.query(t,e):y(t).data(`zui.${i}`)},y.fn.zuiCall=function(i,e=[]){return this.each(function(){const t=i.split("."),n=t.length>1?t[0]:void 0,s=t[t.length>1?1:0],r=y(this).zui(n),o=r==null?void 0:r[s];typeof o=="function"&&o.apply(r,e)}),this},y(()=>{y("body").zuiInit({update:!0}),yy(),vy()});class Sl extends ze{init(){const{offset:e=1,side:t,zIndex:n,pinnedClass:s="is-pinned",targets:r,scrollContainer:o}=this.options,{$element:a}=this,l=r?a.find(r):a;if(l.css({position:"sticky",zIndex:n}),t&&l.css(t,-e),o){const c=a.closest(o)[0];if(c){const d=()=>{this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{if(this._raf=0,c.scrollTop===0&&(!t||t==="top")){l.toggleClass(s,!1);return}const u=c.getBoundingClientRect();l.each((p,g)=>{const C=g.getBoundingClientRect()[t||"top"]===u[t||"top"];g.classList.toggle(s,C)})})};this._scrollListener=d,c.addEventListener("scroll",d)}this._container=c}else this._ob=new IntersectionObserver(c=>{c.forEach(d=>{d.target.classList.toggle(s,d.intersectionRatio<e)})},{threshold:[1]}),l.each((c,d)=>this._ob.observe(d))}destroy(){var e;(e=this._ob)==null||e.disconnect(),this._container&&(this._container.removeEventListener("scroll",this._scrollListener),this._raf&&cancelAnimationFrame(this._raf))}}Sl.NAME="Sticky";const Ei=24*60*60*1e3,We=i=>i===void 0?new Date:(i instanceof Date||(typeof i=="string"&&(i=i.trim(),/^\d+$/.test(i)&&(i=Number.parseInt(i,10))),typeof i=="number"&&i<1e10&&(i*=1e3),i=new Date(i)),i),ud=(i,e,t="day")=>{if(typeof e=="string"){const n=Number.parseInt(e,10);t=e.replace(n.toString(),""),e=n}return i=new Date(We(i).getTime()),t==="month"?i.setMonth(i.getMonth()+e):t==="year"?i.setFullYear(i.getFullYear()+e):t==="week"?i.setDate(i.getDate()+e*7):t==="hour"?i.setHours(i.getHours()+e):t==="minute"?i.setMinutes(i.getMinutes()+e):t==="second"?i.setSeconds(i.getSeconds()+e):i.setDate(i.getDate()+e),i},Mn=(i,e=new Date)=>We(i).toDateString()===We(e).toDateString(),vs=(i,e=new Date)=>We(i).getFullYear()===We(e).getFullYear(),Tl=(i,e=new Date)=>(i=We(i),e=We(e),i.getFullYear()===e.getFullYear()&&i.getMonth()===e.getMonth()),by=(i,e=new Date)=>{i=We(i),e=We(e);const t=1e3*60*60*24,n=Math.floor(i.getTime()/t),s=Math.floor(e.getTime()/t);return Math.floor((n+4)/7)===Math.floor((s+4)/7)},wy=(i,e)=>Mn(We(e),i),Cy=(i,e)=>Mn(We(e).getTime()-Ei,i),xy=(i,e)=>Mn(We(e).getTime()+Ei,i),$l=i=>i!=null&&!isNaN(We(i).getTime()),ht=(i,e="yyyy-MM-dd hh:mm",t="")=>{if(i=We(i),!$l(i))return t;if(typeof e=="function")return e(i);const n={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"H+":i.getHours()%12,"m+":i.getMinutes(),"s+":i.getSeconds(),"S+":i.getMilliseconds()};return/(y+)/i.test(e)&&(e.includes("[yyyy-]")&&(e=e.replace("[yyyy-]",vs(i)?"":"yyyy-")),e=e.replace(RegExp.$1,`${i.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(n).forEach(s=>{if(new RegExp(`(${s})`).test(e)){const r=`${n[s]}`;e=e.replace(RegExp.$1,RegExp.$1.length===1?r:`00${r}`.substring(r.length))}}),e},ky=(i,e,t)=>{const n={full:"yyyy-M-d",month:"M-d",day:"d",str:"{0} ~ {1}",...t},s=ht(i,vs(i)?n.month:n.full);if(Mn(i,e))return s;const r=ht(e,vs(i,e)?Tl(i,e)?n.day:n.month:n.full);return n.str.replace("{0}",s).replace("{1}",r)};function Dl(i){let e=0;if(typeof i!="string"&&(i=String(i)),i&&i.length)for(let t=0;t<i.length;++t)e+=(t+1)*i.charCodeAt(t);return e}function Wr(i){if(!i)return;if(typeof i=="object")return i;if(i=i.replace(/^#/,""),!i.length)return;i.startsWith("/")||(i=`/${i}`);const e=new URL(window.location.origin+i),[,t="",...n]=e.pathname.split("/");let s=t.trim();if(!s.length)return;let r="";return s.includes("~")&&([s,r]=s.split("~")),{name:s,scope:r,options:Object.fromEntries([...e.searchParams.entries()].map(([o,a])=>{try{a.includes("%")&&(a=decodeURIComponent(a)),a=JSON.parse(a)}catch{}return[o,a]})),params:n.map(o=>{if(o!=="undefined"){if(o==="null")return null;try{return o.includes("%")&&(o=decodeURIComponent(o)),JSON.parse(o)}catch{return o}}})}}function dd(i){if(Array.isArray(i))return{commands:i.map(Wr).filter(Boolean)};if(typeof i=="object")return i;i=i.replace(/^#!?/,"");const e=i.includes(">"),t=i.split(e?">":"|").map(Wr);return{async:e,commands:t.filter(Boolean)}}function Il(i,e,t){if(typeof i=="string"&&(i=Wr(i)),!i)return;const{execute:n,event:s,scope:r}=e;if(!(r&&i.scope&&i.scope!==r))return n({name:i.name,options:{...e.options,...i.options},event:s,scope:i.scope,prevResult:t},i.params)}async function fd(i,e){const{async:t,commands:n}=dd(i);if(!n.length)return[];const{signal:s}=e;if(t){const o=[];let a;for(const l of n){if(!(s!=null&&s.aborted))break;a=await Il(l,e,a),s!=null&&s.aborted&&(a=void 0),o.push(a)}return o}return await Promise.all(n.map(o=>{if(!(s!=null&&s.aborted))return Il(o,e)}))}const Ai="zui.commands",Pi="z-commands",Sy="zui-commands-proxy",pd="zui-command";function Ur(i,e){typeof e=="string"?e={scope:e}:typeof e=="function"&&(e={onCommand:e});const{scope:t="",events:n="click"}=e??{},s=y(i),r=(s.attr(Pi)||"").split(",");t&&!r.includes(t)&&r.push(t),s.attr(Pi,r.join(",")).data(Ai,{[t]:{...e,scope:t,events:n,gid:ft()},...s.data(Ai)})}function Vr(i,e=!0){const t=y(i);if(e===!0)t.removeAttr(Pi),t.removeData(Ai);else if(e.length){const n=t.data(Ai)||{};e.split(",").forEach(r=>{delete n[r]});const s=Object.keys(n);s.length?t.attr(Pi,s.join(",")).data(Ai,Ur):Vr(t,!0)}}function md(i,e){let t=i.closest(`[${Pi}]`);if(!t.length){const o=i.closest(`[${Sy}]`);o.length&&(t=y(o.data("zui.commandProxy")||o.attr("COMMAND_PROXY_ATTR")).closest(`[${Pi}]`))}if(!t.length)return;const n=t.data(Ai)||{},s=Object.values(n).sort((o,a)=>a.gid-o.gid);let r;return e!=null&&e.length?(r=s.find(o=>o.scope===e),r||(r=s.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped})),r):(r=s.find(o=>{var a;return!((a=o.scope)!=null&&a.length)&&!o.scoped}),r||(r=s.find(o=>!o.scoped)),r?r.element=t[0]:r=md(i.parent(),e),r)}function Ty(i){if(!i.currentTarget)return;const e=y(i.currentTarget);if(e.closest(".disabled,[disabled]").length)return;const t=e.attr(pd)||(e.is('a[href^="#!"]')?e.attr("href"):"");if(!t)return;const n=new AbortController,s=()=>n.abort();fd(t,{signal:n.signal,execute:(r,o)=>{const{scope:a,name:l}=r,c={...r,abort:s};let d;const u=md(e,a);if(u){c.element=u.element;const g=(u.commands?u.commands[`${a}~${l}`]||u.commands[l]:null)||u.onCommand;if(g&&(d=g(c,o),i.commandHandled))return d}const p=[c,o];if(e.trigger("command",p).trigger(`command:${a?`${l}.${a}`:l}`,p),a&&e.trigger(`command:.${a}`,p),i.commandHandled)return d;if(a==="event"){l==="stop"?i.stopPropagation():l==="prevent"?i.preventDefault():Tn(i,l,o);return}return a==="window"?Tn(window,l,o):a==="zui"?Tn(window.zui,l,o):a==="target"?Tn(e[0],l,o):a==="$target"?Tn(e,l,o):a==="$"?Tn(y,l,o):d},event:i})}y.fn.command=function(i,e){return this.on(`command:${i}`,e)},y.fn.offCommand=function(i,e){return this.off(`command:${i}`,e)},y.fn.commands=function(i){return this.each((e,t)=>Ur(t,i)),this},y.fn.unbindCommands=function(i){return this.each((e,t)=>Vr(t,i)),this},y(()=>{y(document).on("click.zui.command",`[${pd}],a[href^="#!"]`,Ty)});function bs(i,e={}){const t=y(i)[0];if(!t)return!1;let{viewport:n}=e;const{left:s,top:r,width:o,height:a}=t.getBoundingClientRect();if(e.checkZeroSize&&!(o*a))return!1;if(!n)if(e.container)n=y(t).closest(e.container)[0].getBoundingClientRect();else{const{innerHeight:b,innerWidth:C}=window,{clientHeight:S,clientWidth:x}=document.documentElement;n={left:0,top:0,width:C||x,height:b||S}}const{left:l,top:c,width:d,height:u}=n;if(e.fullyCheck)return s>=l&&r>=c&&s+o<=d+l&&r+a<=u+c;const p=s<=l+d&&s+o>=l;return r<=c+u&&r+a>=c&&p}y.fn.isVisible=function(i){return bs(this,i)};function Kr(i,e,t=!1){var s;const n=y(i);if(e!==void 0){if(typeof e=="string"&&e.length){const r=`zui-runjs-${ft()}`;n.append(`<script id="${r}">${e}<\/script>`),t&&n.find(`#${r}`).remove()}return}if(n.is("script")){const r=(s=n[0])==null?void 0:s.textContent;r&&Kr(n.parent(),r);return}n.find("script").each((r,o)=>{Kr(n,o.textContent),o.remove()})}y.runJS=(i,...e)=>(i=i.trim(),!i.startsWith("return ")&&!i.endsWith(";")&&(i=`return ${i}`),new Function(...e.map(([n])=>n),i)(...e.map(([,n])=>n))),y.fn.runJS=function(i){return this.each((e,t)=>{Kr(t,i)})};function $y(i,e="both"){return(e==="vert"||e==="both")&&i.clientHeight<i.scrollHeight||(e==="horz"||e==="both")&&i.clientWidth<i.scrollWidth}function gd(i,e){const t=y(i),{ifNeeded:n=!0,container:s,...r}=e||{};return t.each((o,a)=>{if(s){const l=y(a).closest(s);if(!l.length||!$y(l[0]))return}if(n){if(a.scrollIntoViewIfNeeded)return a.scrollIntoViewIfNeeded(r);if(bs(a,{viewport:a.getBoundingClientRect()}))return}a.scrollIntoView(r)}),t}y.fn.scrollIntoView=function(i){return this.each((e,t)=>{gd(t,i)})},y.setLibRoot=function(i){y.libRoot=i},y.registerLib=function(i,e){y.libMap||(y.libMap={}),!e.name&&e.id&&(e.id=`zui-lib-${i}`),y.libMap[i]=e};function yd(i){return new Promise((e,t)=>{typeof i=="string"&&(i={src:i});const{src:n,id:s}=i;if(y(s?`#${s}`:`link[href="${n}"]`).length){e();return}const o=document.createElement("link");o.onload=()=>{e()},o.onerror=()=>{t(new Error(`[ZUI] Failed to load CSS from: ${n}`))},o.rel="stylesheet",o.href=n,s&&(o.id=s),y("head").append(o)})}function _d(i){return new Promise((e,t)=>{typeof i=="string"&&(i={src:i});const{src:n,id:s}=i,r=y(s?`#${s}`:`script[src="${n}"]`);if(r.length){if(r.dataset("loaded"))e();else{const p=r.data("loadCalls")||[];p.push(e),r.data("loadCalls",p)}return}const{async:o=!0,defer:a=!1,noModule:l=!1,type:c,integrity:d}=i,u=document.createElement("script");u.async=o,u.defer=a,u.noModule=l,c&&(u.type=c),d&&(u.integrity=d),u.onload=()=>{e(),(y(u).dataset("loaded",!0).data("loadCalls")||[]).forEach(g=>g()),y(u).removeData("loadCalls")},u.onerror=()=>{t(new Error(`[ZUI] Failed to load JS from: ${n}`))},y("head").append(u),u.src=n})}function vd(i){return new Promise(e=>{typeof i=="string"&&(i={type:"module",src:i});const{src:t,imports:n,srcList:s=[],id:r}=i;t&&s.unshift({src:t,imports:n});const o=s.map(x=>x.src).join(","),a=y(r?`#${r}`:`script[data-src-list="${o}"]`);if(a.length){const x=a.data("module");if(x)e(x);else{const D=a.data("resolves")||[];D.push(e),a.data("resolves",D)}return}const{async:l=!0,defer:c=!1,integrity:d,globalVar:u,resolve:p}=i,g=document.createElement("script"),b=`zui-module-resolve-${y.guid++}`,C=y(g);Object.assign(window,{[b]:x=>{(C.data("module",x).data("resolves")||[]).forEach(A=>A(x)),C.removeData("resolves"),p==null||p(x),e(x),delete window[b]}}),g.async=l,g.defer=c,g.type="module",C.attr("data-src-list",o).attr("data-resolve-id",b);const S=[];g.text=[...s.map(({src:x,imports:D})=>{if(n){if(typeof D=="string")return S.push(D),`import * as ${D} from '${x}';`;if(D)return S.push(...Object.values(D)),`import {${Object.entries(D).map(([A,B])=>`${A} as ${B}`).join(",")}} from '${x}';`}return`import '${x}';`}),`const zuiImportResult = {${S.map(x=>`${x}: ${x},`)}};`,u?`Object.assign(window, ${u===!0?"zuiImportResult":`{${u}: zuiImportResult}`});`:"",`if(window['${b}']) window['${b}'](zuiImportResult);`].join(`
`),d&&(g.integrity=d),y("head").append(g)})}y.getLib=async function(i,e,t){var b;typeof i=="string"&&(i=((b=y.libMap)==null?void 0:b[i])||{src:i});let n=Array.isArray(i)?{src:i}:y.extend({},i);typeof e=="function"?n.success=e:e&&y.extend(n,e),t&&(n.success=t);let{src:s}=n;const{name:r,success:o}=n,a=y.libMap&&r?y.libMap[r]:null;if(a&&(n=y.extend({},a,n),s=a.src||n.src),typeof s=="string"&&(s=[s]),!s||!s.length)throw new Error("[ZUI] No src provided for $.getLib.");let{check:l=!0}=n;l===!0&&r&&(l=r);const c=typeof l=="string"?l:r;let d;const u=()=>c?window[c]||d:void 0;typeof l=="string"&&(l=()=>!!u());const p=()=>(o==null||o(),u());if(typeof l=="function"&&await l())return p();const{root:g=y.libRoot}=n;for(let C of s){typeof C=="string"&&(C={src:C});let{src:S}=C;g&&!/https?:\/\//.test(S)&&(S=`${g}${g.endsWith("/")||S.startsWith("/")?"":"/"}${S}`);const x={...n,...C,src:S};if(C.type==="css"||!C.type&&S.endsWith(".css")){await yd(x);continue}if(x.type==="module"){d=await vd(x);continue}await _d(x)}return p()},y.getScript=y.getLib;function bd(i,e){const t=y(i),n=new ResizeObserver(e);return t.each((s,r)=>{n.observe(r)}),n}y.fn.resize=function(i){return bd(this,i)};const Dy=Object.freeze(Object.defineProperty({__proto__:null,isElementDetached:Nn,isVisible:bs,listenResize:bd,loadCSS:yd,loadJS:_d,loadModule:vd,runJS:Kr,scrollIntoView:gd},Symbol.toStringTag,{value:"Module"}));var Nl,Dt,Ml,wd,Cd=0,xd=[],tt=Oe,kd=tt.__b,Sd=tt.__r,Td=tt.diffed,$d=tt.__c,Dd=tt.unmount,Id=tt.__;function Iy(i,e){tt.__h&&tt.__h(Dt,i,Cd||e),Cd=0;var t=Dt.__H||(Dt.__H={__:[],__h:[]});return i>=t.__.length&&t.__.push({}),t.__[i]}function Nd(i,e){var t=Iy(Nl++,7);return Ey(t.__H,e)&&(t.__=i(),t.__H=e,t.__h=i),t.__}function Ny(){for(var i;i=xd.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(qr),i.__H.__h.forEach(El),i.__H.__h=[]}catch(e){i.__H.__h=[],tt.__e(e,i.__v)}}tt.__b=function(i){Dt=null,kd&&kd(i)},tt.__=function(i,e){i&&e.__k&&e.__k.__m&&(i.__m=e.__k.__m),Id&&Id(i,e)},tt.__r=function(i){Sd&&Sd(i),Nl=0;var e=(Dt=i.__c).__H;e&&(Ml===Dt?(e.__h=[],Dt.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(qr),e.__h.forEach(El),e.__h=[],Nl=0)),Ml=Dt},tt.diffed=function(i){Td&&Td(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(xd.push(e)!==1&&wd===tt.requestAnimationFrame||((wd=tt.requestAnimationFrame)||My)(Ny)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),Ml=Dt=null},tt.__c=function(i,e){e.some(function(t){try{t.__h.forEach(qr),t.__h=t.__h.filter(function(n){return!n.__||El(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],tt.__e(n,t.__v)}}),$d&&$d(i,e)},tt.unmount=function(i){Dd&&Dd(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{qr(n)}catch(s){e=s}}),t.__H=void 0,e&&tt.__e(e,t.__v))};var Md=typeof requestAnimationFrame=="function";function My(i){var e,t=function(){clearTimeout(n),Md&&cancelAnimationFrame(e),setTimeout(i)},n=setTimeout(t,100);Md&&(e=requestAnimationFrame(t))}function qr(i){var e=Dt,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),Dt=e}function El(i){var e=Dt;i.__c=i.__(),Dt=e}function Ey(i,e){return!i||i.length!==e.length||e.some(function(t,n){return t!==i[n]})}var Ay=Symbol.for("preact-signals");function Gr(){if(En>1)En--;else{for(var i,e=!1;ws!==void 0;){var t=ws;for(ws=void 0,Al++;t!==void 0;){var n=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&Ad(t))try{t.c()}catch(s){e||(i=s,e=!0)}t=n}}if(Al=0,En--,e)throw i}}function Yr(i){if(En>0)return i();En++;try{return i()}finally{Gr()}}var Re=void 0;function Py(i){var e=Re;Re=void 0;try{return i()}finally{Re=e}}var ws=void 0,En=0,Al=0,Qr=0;function Ed(i){if(Re!==void 0){var e=i.n;if(e===void 0||e.t!==Re)return e={i:0,S:i,p:Re.s,n:void 0,t:Re,e:void 0,x:void 0,r:e},Re.s!==void 0&&(Re.s.n=e),Re.s=e,i.n=e,32&Re.f&&i.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=Re.s,e.n=void 0,Re.s.n=e,Re.s=e),e}}function it(i){this.v=i,this.i=0,this.n=void 0,this.t=void 0}it.prototype.brand=Ay,it.prototype.h=function(){return!0},it.prototype.S=function(i){this.t!==i&&i.e===void 0&&(i.x=this.t,this.t!==void 0&&(this.t.e=i),this.t=i)},it.prototype.U=function(i){if(this.t!==void 0){var e=i.e,t=i.x;e!==void 0&&(e.x=t,i.e=void 0),t!==void 0&&(t.e=e,i.x=void 0),i===this.t&&(this.t=t)}},it.prototype.subscribe=function(i){var e=this;return dn(function(){var t=e.value,n=Re;Re=void 0;try{i(t)}finally{Re=n}})},it.prototype.valueOf=function(){return this.value},it.prototype.toString=function(){return this.value+""},it.prototype.toJSON=function(){return this.value},it.prototype.peek=function(){var i=Re;Re=void 0;try{return this.value}finally{Re=i}},Object.defineProperty(it.prototype,"value",{get:function(){var i=Ed(this);return i!==void 0&&(i.i=this.i),this.v},set:function(i){if(i!==this.v){if(Al>100)throw new Error("Cycle detected");this.v=i,this.i++,Qr++,En++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Gr()}}}});function It(i){return new it(i)}function Ad(i){for(var e=i.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Pd(i){for(var e=i.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){i.s=e;break}}}function Ld(i){for(var e=i.s,t=void 0;e!==void 0;){var n=e.p;e.i===-1?(e.S.U(e),n!==void 0&&(n.n=e.n),e.n!==void 0&&(e.n.p=n)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=n}i.s=t}function Li(i){it.call(this,void 0),this.x=i,this.s=void 0,this.g=Qr-1,this.f=4}(Li.prototype=new it).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Qr))return!0;if(this.g=Qr,this.f|=1,this.i>0&&!Ad(this))return this.f&=-2,!0;var i=Re;try{Pd(this),Re=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return Re=i,Ld(this),this.f&=-2,!0},Li.prototype.S=function(i){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}it.prototype.S.call(this,i)},Li.prototype.U=function(i){if(this.t!==void 0&&(it.prototype.U.call(this,i),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Li.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;i!==void 0;i=i.x)i.t.N()}},Object.defineProperty(Li.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var i=Ed(this);if(this.h(),i!==void 0&&(i.i=this.i),16&this.f)throw this.v;return this.v}});function Ge(i){return new Li(i)}function Rd(i){var e=i.u;if(i.u=void 0,typeof e=="function"){En++;var t=Re;Re=void 0;try{e()}catch(n){throw i.f&=-2,i.f|=8,Pl(i),n}finally{Re=t,Gr()}}}function Pl(i){for(var e=i.s;e!==void 0;e=e.n)e.S.U(e);i.x=void 0,i.s=void 0,Rd(i)}function Ly(i){if(Re!==this)throw new Error("Out-of-order effect");Ld(this),Re=i,this.f&=-2,8&this.f&&Pl(this),Gr()}function Cs(i){this.x=i,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Cs.prototype.c=function(){var i=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{i()}},Cs.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Rd(this),Pd(this),En++;var i=Re;return Re=this,Ly.bind(this,i)},Cs.prototype.N=function(){2&this.f||(this.f|=2,this.o=ws,ws=this)},Cs.prototype.d=function(){this.f|=8,1&this.f||Pl(this)};function dn(i){var e=new Cs(i);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}var Ll;function Ri(i,e){Oe[i]=e.bind(null,Oe[i]||function(){})}function Xr(i){Ll&&Ll(),Ll=i&&i.S()}function Od(i){var e=this,t=i.data,n=Oy(t);n.value=t;var s=Nd(function(){for(var r=e.__v;r=r.__;)if(r.__c){r.__c.__$f|=4;break}return e.__$u.c=function(){var o;!N.isValidElement(s.peek())&&((o=e.base)==null?void 0:o.nodeType)===3?e.base.data=s.peek():(e.__$f|=1,e.setState({}))},Ge(function(){var o=n.value.value;return o===0?0:o===!0?"":o||""})},[]);return s.value}Od.displayName="_st",Object.defineProperties(it.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Od},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),Ri("__b",function(i,e){if(typeof e.type=="string"){var t,n=e.props;for(var s in n)if(s!=="children"){var r=n[s];r instanceof it&&(t||(e.__np=t={}),t[s]=r,n[s]=r.peek())}}i(e)}),Ri("__r",function(i,e){Xr();var t,n=e.__c;n&&(n.__$f&=-2,(t=n.__$u)===void 0&&(n.__$u=t=function(s){var r;return dn(function(){r=this}),r.c=function(){n.__$f|=1,n.setState({})},r}())),Xr(t),i(e)}),Ri("__e",function(i,e,t,n){Xr(),i(e,t,n)}),Ri("diffed",function(i,e){Xr();var t;if(typeof e.type=="string"&&(t=e.__e)){var n=e.__np,s=e.props;if(n){var r=t.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in n)&&(a.d(),r[o]=void 0)}else t.U=r={};for(var l in n){var c=r[l],d=n[l];c===void 0?(c=Ry(t,l,d,s),r[l]=c):c.o(d,s)}}}i(e)});function Ry(i,e,t,n){var s=e in i&&i.ownerSVGElement===void 0,r=It(t);return{o:function(o,a){r.value=o,n=a},d:dn(function(){var o=r.value.value;n[e]!==o&&(n[e]=o,s?i[e]=o:o?i.setAttribute(e,o):i.removeAttribute(e))})}}Ri("unmount",function(i,e){if(typeof e.type=="string"){var t=e.__e;if(t){var n=t.U;if(n){t.U=void 0;for(var s in n){var r=n[s];r&&r.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}i(e)}),Ri("__h",function(i,e,t,n){(n<3||n===9)&&(e.__$f|=2),i(e,t,n)}),pe.prototype.shouldComponentUpdate=function(i,e){var t=this.__$u;if(!(t&&t.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var n in e)return!0;for(var s in i)if(s!=="__source"&&i[s]!==this.props[s])return!0;for(var r in this.props)if(!(r in i))return!0;return!1};function Oy(i){return Nd(function(){return It(i)},[])}const Rl={};function Xe(i,e){typeof i=="object"?Object.keys(i).forEach(t=>{Xe(t,i[t])}):e&&(Rl[i.toLowerCase()]=e)}function zd(i){return Rl[i.toLowerCase()]}class Fe extends pe{constructor(e){super(e),this._gid=ft(),this.state=this.getDefaultState(e)}get gid(){return this._gid}get element(){return document.querySelector(`[z-gid-${this._gid}]`)}get i18nData(){return[this.props.i18n,this.constructor.i18n]}get commandScope(){return this.constructor.NAME}getDefaultState(e){return{}}resetState(e,t){const n=this.getDefaultState(e);t?this.state=n:this.changeState(n)}i18n(e,t,n){const{i18nData:s}=this;return Ne(s,e,t,n,this.props.lang,this.constructor.NAME)??Ne(s,e,t,n,this.props.lang)??`{i18n:${e}}`}changeState(e,t){return new Promise(n=>{this.setState(e,()=>{t==null||t(),n(this.state)})})}executeCommand(e,t=[]){const{onCommand:n,commands:s}=this.props;let r;typeof e=="string"&&(e={name:e});const{scope:o,name:a}=e,l=s?s[`${o}~${a}`]||s[a]:null;return l?l.call(this,e,t):((!e.scope||e.scope===this.commandScope)&&(r=Tn(this,e.name,t)),n&&(r=n.call(this,e,t)),r)}_getClassName(e){return e.className}_getProps(e){const{className:t,attrs:n,props:s,data:r,forwardRef:o,children:a,component:l,style:c,class:d,commands:u,onCommand:p,...g}=e,b=new Set(this.constructor.customProps),C="dangerouslySetInnerHTML",S=Object.keys(g).reduce((x,D)=>{if(!b.has(D)&&(D===C||/^(on[A-Z]|data-|zui-|z-)[a-zA-Z-]+/.test(D))){const A=g[D];x[D]=D!==C&&A&&typeof A=="object"?JSON.stringify(A):A}return x},{});return{ref:o,className:V(this._getClassName(e),d)||void 0,style:c,[`z-gid-${this._gid}`]:"",...S,...n,...s}}_getComponent(e){const{component:t="div"}=e;return(typeof t=="string"?zd(t):t)||t}_getChildren(e){return e.children}_beforeRender(e){return e}_onRender(e,t,n,s){return[e,t,n]}componentDidMount(){const{commands:e,onCommand:t}=this.props;(e||t)&&Ur(this.element,{commands:e,scope:this.commandScope,onCommand:this.executeCommand.bind(this)})}componentWillUnmount(){const{commands:e,onCommand:t}=this.props;(e||t)&&Vr(this.element,this.commandScope)}render(e){e=this._beforeRender(e)||e;let t=this._getComponent(e),n=this._getChildren(e),s=this._getProps(e);const r=this._onRender(t,s,n,e);return r&&([t,s,n]=r),w(t,s,n)}}Fe.HElement=!0,Fe.customProps=[];class Ol extends Fe{constructor(e){super(e),this.signals={};const{state:t}=this;this.changeState(t),this.state={}}changeState(e,t){return new Promise(n=>{Yr(()=>{typeof e=="function"&&(e=e(this.state));for(const s in e){const r=this.signals[s];r?r.value=e[s]:this.signals[s]=It(e[s])}n(this.state),t==null||t()})})}resetState(e){this.changeState(this.getDefaultState(e))}}Ol.HElementSignals=!0;var zy=0;function k(i,e,t,n,s,r){e||(e={});var o,a,l=e;"ref"in e&&(o=e.ref,delete e.ref);var c={type:i,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--zy,__i:-1,__u:0,__source:s,__self:r};if(typeof i=="function"&&(o=i.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return Oe.vnode&&Oe.vnode(c),c}class fn extends pe{constructor(){super(...arguments),this._ref=fe()}_runJS(){this.props.executeScript&&y(this._ref.current).runJS().zuiInit()}componentDidMount(){this._runJS()}componentDidUpdate(e){this.props.html!==e.html&&this._runJS()}render(e){const{executeScript:t,html:n,...s}=e;return k(Fe,{forwardRef:this._ref,dangerouslySetInnerHTML:{__html:n},...s})}}function Fd(i){const{tag:e,className:t,style:n,renders:s,generateArgs:r=[],generatorThis:o,generators:a,onGenerate:l,onRenderItem:c,...d}=i,u=[t],p={...n},g=[],b=[];return s.forEach(C=>{const S=[];if(typeof C=="string"&&a&&a[C]&&(C=a[C]),typeof C=="function")if(l)S.push(...l.call(o,C,g,...r));else{const x=C.call(o,g,...r);x&&(Array.isArray(x)?S.push(...x):S.push(x))}else S.push(C);S.forEach(x=>{x!=null&&(typeof x=="object"&&!N.isValidElement(x)&&("html"in x||"__html"in x||"className"in x||"style"in x||"attrs"in x||"children"in x)?x.html?g.push(k("div",{className:V(x.className),style:x.style,dangerouslySetInnerHTML:{__html:x.html},...x.attrs??{}})):x.__html?b.push(x.__html):(x.style&&Object.assign(p,x.style),x.className&&u.push(x.className),x.children&&g.push(x.children),x.attrs&&Object.assign(d,x.attrs)):g.push(x))})}),b.length&&Object.assign(d,{dangerouslySetInnerHTML:{__html:b}}),[{className:V(u),style:p,...d},g]}function zl({tag:i="div",...e}){const[t,n]=Fd(e);return w(i,t,...n)}class Zr extends pe{constructor(){super(...arguments),this.state={},this._ref=fe()}async load(e){const{props:t}=this,{fetcher:n,type:s,fetcherArgs:r,fetcherThis:o=this}=t;this.setState({loading:!0,error:void 0,content:void 0});try{const a=await zt(e||n,r,{throws:!0,dataType:s==="custom"?"json":"text"},o,l=>{this._ajax=l});this.setState({content:a,loading:!1})}catch(a){this.setState({error:a,loading:!1})}this._ajax=void 0}componentDidMount(){this.load(),y(this._ref.current).on("loadContent.zui",(e,t)=>{e.stopPropagation(),this.load(t)})}componentDidUpdate(e){(this.props.fetcher!==e.fetcher||this.props.fetcherArgs!==e.fetcherArgs||this.props.fetcherThis!==e.fetcherThis)&&this.load()}componentWillUnmount(){var e;(e=this._ajax)==null||e.abort(),y(this._ref.current).off(".zui")}_renderContent(e,t){const{loading:n,error:s,content:r=""}=this.state,{loadingContent:o,errorText:a,type:l,...c}=t;return n?o:s?a??s.message:l==="html"?k(fn,{html:r,executeScript:!0,...c}):l==="text"?r:k(me,{content:r,...c})}render(e){const{loading:t}=this.state,{id:n,loadingClass:s,loadingIndicator:r,className:o,style:a,attrs:l,loadingText:c,...d}=e;return k("div",{id:n,ref:this._ref,className:V("lazy-content",o,t?s:"",r?"load-indicator":""),"data-loading":c,style:a,...l,children:this._renderContent(e,d)})}}Zr.defaultProps={type:"html",loadingIndicator:!0,loadingClass:"loading"};function Jr(i){const{content:e,generatorArgs:t,generatorThis:n,...s}=i;let r=e;if(typeof r=="function"&&(r=r.call(n,...t||[])),Array.isArray(r))return r.map(o=>Jr({...s,content:o,generatorThis:n,generatorArgs:t}));if(typeof r=="string"||typeof r=="number")return Object.keys(s).length?k("div",{...s,children:r}):r;if(r&&typeof r=="object"&&(typeof r.html=="string"||r.component||r.fetcher)){if(r.fetcher)return k(Zr,{...xe(s,r)});if(r.html)return k(fn,{...xe(s,r)});const{children:o,...a}=r;return o&&(r=xe({children:(Array.isArray(o)?o:[o]).map(l=>Jr({...s,content:l,generatorThis:n,generatorArgs:t}))},a)),k(Fe,{...xe(s,r)})}return N.isValidElement(r)?r:(r&&(console.groupCollapsed("[ZUI] CustomContent format error"),console.trace("content:",r),console.log("props:",i),console.groupEnd()),null)}function me(i){const e=Jr(i);return e==null||typeof e=="boolean"?null:N.isValidElement(e)?e:k(In,{children:e})}const jd=i=>i.startsWith("icon-")?i:`icon-${i}`;function Ie(i){const{icon:e,className:t,...n}=i;if(!e)return null;if(N.isValidElement(e))return e;const s=["icon",t];if(typeof e=="string")s.push(jd(e));else if(typeof e=="object"){const{className:r,icon:o,...a}=e;s.push(r,o?jd(o):""),Object.assign(n,a)}return k("i",{className:V(s),...n})}function Fy(i){return this.getChildContext=()=>i.context,i.children}function Fl(i){const e=this,t=i._container;e.componentWillUnmount=function(){oi(null,e._temp),e._temp=null,e._container=null},e._container&&e._container!==t&&e.componentWillUnmount(),i._vnode?(e._temp||(e._container=t,e._temp={nodeType:1,parentNode:t,childNodes:[],appendChild(n){this.childNodes.push(n),e._container.appendChild(n)},insertBefore(n,s){this.childNodes.push(n),e._container.appendChild(n)},removeChild(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e._container.removeChild(n)}}),oi(w(Fy,{context:e.context},i._vnode),e._temp)):e._temp&&e.componentWillUnmount()}function Bd(i,e){const t=w(Fl,{_vnode:i,_container:e});return t.containerInfo=e,t}Xe({HElement:Fe,element:Fe,HtmlContent:fn,html:fn,CustomContent:me,LazyContent:Zr,custom:me,lazy:Zr,Icon:Ie,Portal:Fl});class _e extends ze{constructor(){super(...arguments),this._ref=fe()}get $(){return this._ref.current}get i18nData(){const{i18n:e,i18nData:t}=this.constructor.Component;return t?[...t,this.constructor.i18n]:[e,...super.i18nData]}afterInit(){this.render()}destroy(){var e,t;(t=(e=this.$)==null?void 0:e.componentWillUnmount)==null||t.call(e),this.element&&(this.element.innerHTML=""),super.destroy()}render(e,t){var u;const{element:n,$:s}=this,{Component:r,replace:o}=this.constructor,{$replace:a=o,$optionsFromDataset:l,...c}=this.setOptions(e,t),d={ref:this._ref,...c};if(t&&((u=s==null?void 0:s.resetState)==null||u.call(s,c)),a&&r.HElement&&(n.tagName.toLowerCase()===a||a===!0)){const p=Array.from(n.attributes).reduce((g,b)=>{const{name:C,value:S}=b;return g[C==="class"?"className":C]=S,g},{});oi(w(r,xe({component:n.tagName.toLowerCase(),attrs:p},d)),n.parentElement,n)}else oi(w(r,d),n)}static renderHTML(e){const t=document.createElement("div");return oi(w(this.Component,e),t),t.innerHTML}}_e.replace=!1;class ke extends Fe{_beforeRender(e){const{text:t,loading:n,loadingText:s,caret:r,icon:o,trailingIcon:a,children:l}=e;this._isEmptyText=t==null||typeof t=="string"&&!t.length||n&&!s,this._onlyCaret=r&&this._isEmptyText&&!o&&!a&&!l&&!n}_getChildren(e){const{loading:t,loadingIcon:n,loadingText:s,icon:r,iconClass:o,text:a,textClass:l,children:c,trailingIcon:d,trailingIconClass:u,caret:p}=e;return[t?k(Ie,{icon:n||"icon-spinner-snake",className:"spin"}):k(Ie,{icon:r,className:o}),this._isEmptyText?null:k("span",{className:V("text",l),children:t?s:a}),t?null:c,t?null:k(Ie,{icon:d,className:u}),t?null:p?k("span",{className:typeof p=="string"?`caret-${p}`:"caret"}):null]}_getClassName(e){const{type:t,className:n,disabled:s,loading:r,active:o,children:a,square:l,size:c,rounded:d}=e;return["btn",t,n,{"btn-caret":this._onlyCaret,disabled:s||r,active:o,loading:r,square:l===void 0?!this._onlyCaret&&!a&&this._isEmptyText:l},c?`size-${c}`:"",typeof d=="string"?`rounded-${d}`:{rounded:d}]}_getComponent(e){return e.component||(e.url?"a":"button")}_getProps(e){const t=this._getComponent(e),{url:n,target:s,disabled:r,btnType:o="button",hint:a,command:l}=e,c=t==="a",d={...super._getProps(e),type:c?void 0:"button",disabled:!c&&r?"":void 0,title:a};return o&&(["button","reset","submit"].includes(o)?t==="button"&&(d.type=o):d.className=V([d.className,o])),r||(n!==void 0&&(d[c?"href":"data-url"]=n),s!==void 0&&(d[c?"target":"data-target"]=s),l&&(d["zui-command"]=l)),d}}Xe(Object.freeze(Object.defineProperty({__proto__:null,Button:ke},Symbol.toStringTag,{value:"Module"})));const Kw="",qw="",Gw="",Yw="",Qw="";let vt=class extends Fe{constructor(e){super(e),this._handleClick=this._handleClick.bind(this)}get name(){return this.props.name||this.constructor.NAME}get itemName(){return this.props.itemName||this.constructor.ITEM_NAME}getItems(){return this._items}getRenderedItem(e){return this._renderedItems.find(t=>t.key===e)}getItem(e){return this._items[this.getItemIndex(e)]}getItemIndex(e){return this._renderedItems.findIndex(t=>t.key===e)}getItemByIndex(e){return this._items[e]}getKey(e){var t,n;return(n=(t=this._renderedItems)==null?void 0:t[e])==null?void 0:n.key}_getItemFromEvent(e,t){var l;const n=(t||e.target).closest("[z-item]");if(!n||!((l=n.parentElement)!=null&&l.hasAttribute(`z-gid-${this._gid}`)))return;const s=+n.getAttribute("z-item"),r=this._items[s];if(!r)return;const o=this.getKey(s);if(o===void 0)return;const a=this._renderedItems[s];return{index:s,item:r,element:n,event:e,key:o,renderedItem:a,relativeTarget:this.props.relativeTarget}}_handleClick(e){var n,s;const t=this._getItemFromEvent(e);if(t)return(n=this.props.onClickItem)==null||n.call(this,t),(s=t.item.onClick)==null||s.call(this,e,t),t}_renderItem(e,t,n){const{beforeRenderItem:s}=e;if(s){const c=s.call(this,t,n);c!==void 0&&(t=c)}const{type:r}=t;let{itemRender:o}=e;if(o&&typeof o=="object"&&(o=o[r]),o){const c=o.call(this,t,n);if(c!==void 0)return k(me,{"z-key":t.key,"z-item":n,"z-type":r,content:c})}const{ItemComponents:a}=this.constructor;let l=a[r];if(!l&&t.component)return k(me,{"z-key":t.key,"z-item":n,"z-type":r,content:{...t}});if(l=l||a.default||Fe,Array.isArray(l)){let c=l[1];typeof c=="function"&&(c=c.call(this,t,e)),t=xe({},c,t),l=l[0]}return k(l,{"z-key":t.key,"z-item":n,"z-type":r,...t})}_getItem(e,t,n){if(!t)return!1;const{itemProps:s,itemPropsMap:r={},getItem:o,itemKey:a}=e,{type:l=this.constructor.defaultItemType}=t,{name:c,itemName:d}=this,{defaultItemProps:u={},defaultItemPropsMap:p={}}=this.constructor;if(t=xe({type:l},u,p[l],s,r[l],{className:[c?`${c}-${l}`:"",d]},t,{_item:t,_index:n,key:String((a?t[a]:t.key)??t.key??n),onClick:void 0}),o){const g=o.call(this,t,n);if(g!==void 0)return g}return t}_getProps(e){const t=super._getProps(e);return{onClick:this._handleClick,...t}}_getClassName(e){return[this.name,e.className]}_getItems(e){let{items:t=[]}=e;typeof t=="function"?t=t.call(this):Array.isArray(t)||(t=[]);const{getItems:n}=e;if(n){const s=n.call(this,t);if(s!==void 0)return s}return t}_renderItems(e,t){return this._renderedItems=t.map((n,s)=>{const r=this._getItem(e,n,s);return r||void 0}),this._renderedItems.reduce((n,s,r)=>(s&&n.push(this._renderItem(e,s,r)),n),[])}_getChildren(e){const t=this._getItems(e);this._items=t;const n=this._renderItems(e,t);return e.children&&n.push(e.children),n}_getComponent(e){return e.component||this.constructor.TAG}};vt.NAME="",vt.ITEM_NAME="item",vt.TAG="ul",vt.ItemComponents={default:Fe,divider:[Fe,{className:"divider"}],space:[Fe,i=>{const{space:e,flex:t,style:n}=i;return{style:{width:e,height:e,flex:t,...n}}}]},vt.defaultItemProps={component:"li"},vt.defaultItemPropsMap={},vt.defaultItemType="item",vt.defaultProps={itemKey:"id"};const jy=Object.freeze(Object.defineProperty({__proto__:null,CommonList:vt},Symbol.toStringTag,{value:"Module"}));class xs extends _e{}xs.NAME="CommonList",xs.Component=vt,xs.replace=vt.TAG,xs.register(),Xe(jy);const Xw="",Zw="",Jw="",e0="",t0="",n0="";function By(i){if(i.indexOf("#")===0&&(i=i.slice(1)),i.length===3&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),i.length!==6)throw new Error(`Invalid HEX color "${i}".`);return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16)]}function Hy(i){const[e,t,n]=typeof i=="string"?By(i):i;return e*.299+t*.587+n*.114>186}function Hd(i,e){return Hy(i)?(e==null?void 0:e.dark)??"#333333":(e==null?void 0:e.light)??"#ffffff"}function Wd(i,e=255){return Math.min(Math.max(i,0),e)}function Wy(i,e,t){i=i%360/360,e=Wd(e),t=Wd(t);const n=t<=.5?t*(e+1):t+e-t*e,s=t*2-n,r=o=>(o=o<0?o+1:o>1?o-1:o,o*6<1?s+(n-s)*o*6:o*2<1?n:o*3<2?s+(n-s)*(2/3-o)*6:s);return[r(i+1/3)*255,r(i)*255,r(i-1/3)*255]}function Uy(i,e){return/^[\u4e00-\u9fa5\s]+$/.test(i)?i.length<=e?i:i.substring(i.length-e):/^[A-Za-z\d\s]+$/.test(i)?i[0].toUpperCase():i.length<=e?i:i.substring(0,e)}let Oi=class extends pe{render(){const{className:e,style:t,size:n="",circle:s,rounded:r,background:o,foreColor:a,icon:l,text:c,code:d,maxTextLength:u=2,src:p,hueDistance:g=43,saturation:b=.4,lightness:C=.6,children:S,...x}=this.props,D=["avatar",e],A={...t,background:o,color:a};let B=32;n&&(typeof n=="number"?(A.width=`${n}px`,A.height=`${n}px`,A.fontSize=`${Math.max(12,Math.round(n/2))}px`,B=n):(D.push(`size-${n}`),B={xs:20,sm:24,lg:48,xl:80}[n])),s?D.push("circle"):r&&(typeof r=="number"?A.borderRadius=`${r}px`:D.push(`rounded-${r}`));let H;if(p)D.push("has-img"),H=k("img",{className:"avatar-img",src:p,alt:c});else if(l)D.push("has-icon"),H=k(Ie,{icon:l});else if(c!=null&&c.length){const G=Uy(c,u),Y=G.length;if(D.push("has-text",`has-text-${Y}`),o===void 0){const ee=d??c,he=(typeof ee=="number"?ee:Dl(ee))*g%360;if(A.background=`hsl(${he},${b*100}%,${C*100}%)`,!a){const X=Wy(he,b,C);A.color=Hd(X)}}else!a&&o&&(A.color=Hd(o));let Z;B&&B<16*Y&&(Z={transform:`scale(${B/(16*Y)})`,whiteSpace:"nowrap"}),H=k("div",{"data-actualSize":B,className:"avatar-text",style:Z,children:G})}return k("div",{className:V(D),style:A,...x,children:[H,S]})}};const Vy=Object.freeze(Object.defineProperty({__proto__:null,Avatar:Oi},Symbol.toStringTag,{value:"Module"}));let Ht=class extends vt{_isBtnType({type:e}){return e==="item"||e==="dropdown"}_getItem(e,t,n){if(!t)return!1;t.type||(t=y.extend({type:t.dropdown||t.items?"dropdown":"item"},t));let s=super._getItem(e,t,n);return s&&(this._isBtnType(s)&&(s=xe({},this._shareBtnProps,s)),s)}_beforeRender(e){const{btnProps:t,btnType:n,size:s}=e;this._shareBtnProps=xe({},t,gl({btnType:n,size:s}))}};Ht.NAME="btn-group",Ht.TAG="nav",Ht.ItemComponents={...vt.ItemComponents,default:ke},Ht.defaultItemProps={component:void 0};const eo=class Qm extends Ht{_getProps(e){const{gap:t}=e,n=super._getProps(e);return t&&(typeof t=="number"?n.className=V(n.className,`gap-${t}`):n.style=y.extend(n.style||{},{gap:t})),n}_getItem(e,t,n){const s=super._getItem(e,t,n);if(!s)return s;const{type:r}=s,o=r==="btn-group"||r==="btnGroup";return o&&(s.btnProps=xe({},this._shareBtnProps,s.btnProps)),(o||r==="dropdown")&&!s.relativeTarget&&(s.relativeTarget=e.relativeTarget),s}static render(e,t,n,s){let r=typeof e=="function"?e.call(s??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),n&&(r=xe(n,r)),k(Qm,{...r})}};eo.NAME="toolbar",eo.defaultProps={btnProps:{btnType:"ghost"}},eo.ItemComponents={...Ht.ItemComponents,btnGroup:Ht,"btn-group":Ht};let He=eo;const Ky=Object.freeze(Object.defineProperty({__proto__:null,Toolbar:He},Symbol.toStringTag,{value:"Module"}));class to extends Fe{constructor(e){super(e),this._handleChange=t=>{const{onChange:n}=this.props,s=t.target.indeterminate?"indeterminate":t.target.checked;n&&n.call(this,t,s),this._controlled||this.setState({checked:s})},this.state={checked:e.checked??e.defaultChecked??!1},this._controlled=e.checked!==void 0}get checked(){return this._controlled?this.props.checked:this.state.checked}_getClassName(e){const{disabled:t,type:n="checkbox"}=e,{checked:s}=this;return[e.className,n==="switch"?n:`${n}-primary`,{disabled:t,checked:s===!0,indeterminate:s==="indeterminate"}]}_getChildren(e){const{name:t,type:n,value:s,id:r,label:o}=e,{checked:a}=this;return[t?k("input",{type:n==="radio"?n:"checkbox",name:t,id:r,value:s,onChange:this._handleChange,indeterminate:a==="indeterminate",checked:typeof a=="boolean"?a:void 0},"input"):null,k("label",{htmlFor:r,children:k(me,{content:o})},"label")]}}class qy extends to{}qy.defaultProps={type:"radio"};class Gy extends to{}Gy.defaultProps={type:"switch"};class Zt extends Fe{_renderLeading(e){const{icon:t,iconClass:n,avatar:s,toggleIcon:r,leading:o,leadingClass:a,checked:l,checkbox:c,multiline:d}=e,u=[];if(r&&u.push(k(me,{content:r},"toggleIcon")),l!==void 0&&u.push(k(to,{className:"item-checkbox",checked:l,...c},"checkbox")),t&&u.push(k(Ie,{className:V("item-icon",n),icon:t},"icon")),s){const g=typeof s=="function"?s.call(this,e):s;g&&(g.className=V("item-avatar",g.className),u.push(k(Oi,{...g},"avatar")))}const p=o?k(me,{content:o},"leading"):null;return p&&u.push(p),d?u.length?[k("div",{className:V("item-leading",a),children:u},"leading")]:[]:u}_renderContent(e,t){const{textClass:n,titleClass:s,titleAttrs:r,subtitle:o,subtitleClass:a,url:l,target:c,content:d,contentClass:u,contentAttrs:p}=e,g=l&&!t,b=g?"a":"div";let{title:C,text:S}=e;return C===void 0&&(C=S,S=null),[k("div",{className:V("item-content",u),...p,children:[C?k(b,{className:V("item-title",s),href:g?l:void 0,target:g?c:void 0,...r,children:k(me,{content:C})},"title"):null,o?k("div",{className:V("item-subtitle",a),children:k(me,{content:o})},"subtitle"):null,S?k("div",{className:V("item-text text",n),children:S},"text"):null,d?k(me,{content:d},"extraContent"):null]},"content")]}_renderTrailing(e){const{multiline:t,trailing:n,trailingClass:s,trailingIcon:r,trailingIconClass:o,actions:a}=e,l=[];r&&l.push(k(Ie,{className:V("item-trailing-icon",o),icon:r},"trailing-icon")),a&&l.push(He.render(a,[e],{key:"actions",className:"item-actions",relativeTarget:e,size:"sm"},this));const c=n?k(me,{content:n},"trailing"):null;return c&&l.push(c),t?l.length?[k("div",{className:V("item-trailing",s),children:[l,c]},"trailing")]:[]:l}_render(e,t){const{innerComponent:n,innerClass:s,innerAttrs:r,url:o,actions:a,target:l,active:c,disabled:d,divider:u,checked:p,multiline:g,title:b,subtitle:C,hint:S,selected:x,command:D}=e,A=n||(o&&!a?"a":"div"),B=A==="a",H=xe({key:"item",title:S,className:V("listitem",s,{active:c,disabled:d,"has-divider":u,selected:x,checked:p,multiline:g??!!(b&&C),state:B&&!d})},D?{"zui-command":D}:null,B?{href:o||"javascript:;",target:l}:null,t,r);return k(A,{...H,children:[this._renderLeading(e),this._renderContent(e,B),this._renderTrailing(e)]})}_onRender(e,t,n,s){const r=Object.keys(t).reduce((o,a)=>(a.startsWith("data-")&&(o[a]=t[a],delete t[a]),o),{});return[e,t,[this._render(s,r),...zr(n)]]}}let ut=class extends vt{constructor(e){super(e),this._activeSet=new ii(()=>{const t=new Set,{active:n}=this.props;Array.isArray(n)?n.forEach(r=>t.add(r)):typeof n=="string"?t.add(n):n&&Object.keys(n).forEach(r=>n[r]&&t.add(r));const{activeMap:s}=this.state;return Object.keys(s).forEach(r=>s[r]?t.add(r):t.delete(r)),t},()=>[this.state.activeMap,this.props.active]),this.state={checked:{},activeMap:{}}}get namespace(){return`.zui.${this.constructor.NAME}.list_${this.gid}`}get isLazyItems(){const{items:e}=this.props;return e&&!Array.isArray(e)}componentDidMount(){this._afterRender(!0),this.tryLoad(),this.props.activeOnHover&&!this.props.multipleActive&&y(this.element).on(`mouseenter${this.namespace}`,"[z-item]",e=>{const t=this._getItemFromEvent(e);t&&t.renderedItem.type==="item"&&!t.renderedItem.disabled&&!this.isActive(t.key)&&this.toggleActive(t.key,!0)})}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e;y(this.element).off(this.namespace),(e=this.props.beforeDestroy)==null||e.call(this)}setItems(e,t){const{onLoadFail:n}=this.props;return this.changeState({loading:!1,items:e||[],loadFailed:t?(typeof n=="function"?n.call(this,t):n)||String(t):void 0})}load(){const{items:e,onLoad:t}=this.props;this._loadedSetting=e,this.setState({loading:!0,items:[]},async()=>{try{const n=await zt(e,[this],{throws:!0});this.setItems((t==null?void 0:t.call(this,n))||n)}catch(n){this.setItems(void 0,n)}})}tryLoad(){const{loading:e}=this.state,{items:t}=this.props;return e||!t||Array.isArray(t)||t===this._loadedSetting?!1:(this.load(),!0)}isChecked(e,t,n=!1){const s=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.state.checked[e]??s.checked??n}isAllChecked(){return this._renderedItems.every(({key:e},t)=>this.isChecked(e,t)===!0)}toggleAllChecked(e){return e===void 0&&(e=!this.isAllChecked()),this.toggleChecked(this._renderedItems.map(t=>t.key),e)}async toggleChecked(e,t){let n;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),n=e.reduce((s,r)=>(s[r]=t,s),{})}else if(typeof e=="object")n=e;else{const s=this.isChecked(e);t===void 0&&(t=!s),n={[e]:t}}Object.keys(n).length&&await this.changeState(s=>({checked:{...s.checked,...n}}),()=>{var r;const s=this.state.checked;(r=this.props.onCheck)==null||r.call(this,n,Object.keys(s).filter(o=>s[o]===!0))})}getChecks(){return this._renderedItems.reduce((e,{key:t},n)=>(t!==void 0&&this.isChecked(t,n)===!0&&e.push(t),e),[])}isActive(e){return typeof e=="object"&&(e=e.key),this._activeSet.cache.has(e)}getActiveKeys(){return[...this._activeSet.value]}getActiveKey(){return this.getActiveKeys()[0]}async toggleActive(e,t){typeof e=="string"&&(e=[e]),e.length&&(t=t??!this.isActive(e[0]),await this.changeState(n=>({activeMap:this.props.multipleActive?e.reduce((r,o)=>(r[o]=t,r),{...n.activeMap}):{[e[0]]:t}}),()=>{var n;(n=this.props.onActive)==null||n.call(this,e,t)}))}getNextItem(e,t,n=1,s=void 0){s=s||this._renderedItems;const r=s.length;if(e===void 0)return s[n?0:r-1];let o=s.findIndex(l=>l.key===e);if(o<0||r<2)return s[n?0:r-1];let a=0;for(t=t||(l=>l.type==="item"&&!l.disabled);a<r;){o=(o+n+r)%r;const l=s[o];if(l&&!l.disabled&&!l.hidden&&t.call(this,l,o))return l;a++}}getPrevItem(e,t){return this.getNextItem(e,t,-1)}activeNext(e,t=1){const n=this.getNextItem(this.getActiveKey(),e,t);n&&this.toggleActive(n.key)}activePrev(e){this.activeNext(e,-1)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_beforeRender(e){var t;return(t=this.props.beforeRender)==null?void 0:t.call(this,e)}_getItems(e){const{items:t}=e,{items:n}=this.state;return n||(Array.isArray(t)?t:[])}_getRenderedItem(e,t,n){const{divider:s,multiline:r}=e;t=xe({},gl({divider:s,multiline:r}),t);const{itemName:o,name:a}=this;if(t.innerClass=[o?`${o}-inner${a?` ${a}-${t.type}-inner`:""}`:"",t.innerClass],t.type==="item"){const{checkbox:l}=e;t.checkbox===!1?t.checked=void 0:(l||t.checkbox)&&(t.checked=this.isChecked(t.key,n,t.checked),typeof l=="object"&&t.checkbox!==!1&&(t.checkbox=t.checkbox?y.extend({},l,t.checkbox):l),e.selectOnChecked&&t.checked===!0&&(t.selected=!0)),t.active===void 0&&this.isActive(t)&&(t.active=!0)}return t.icon&&(this._hasIcons=!0),t.checked!==void 0&&(this._hasCheckbox=!0),t}_getItem(e,t,n){const s=super._getItem(e,t,n);return s&&this._getRenderedItem(e,s,n)}_renderItem(e,t,n){return t.type==="item"&&this._hasIcons&&t.icon===void 0&&(t.icon="EMPTY"),super._renderItem(e,t,n)}_handleClick(e){const t=super._handleClick(e);let{checkOnClick:n}=this.props;if(n==="any"?n=".item-checkbox,.item-content,.item-icon":n===!0&&(n=".item-checkbox"),!n||!t||!t.renderedItem)return t;const s=t.renderedItem,r=s.checkbox;if(r!==!1&&(this.props.checkbox||r||s.checked!==void 0)&&!s.disabled&&t&&e.target.closest(n)){this.toggleChecked(t.key),e.stopPropagation();return}return t}_getClassName(e){const{loading:t,loadFailed:n}=this.state;return[super._getClassName(e),t?"loading":n?"is-load-failed":"",e.hoverItemActions?"with-hover-actions":""]}_getProps(e){const{className:t,...n}=super._getProps(e);return{...n,className:V(t,this._hasIcons?"has-icons":"",this._hasCheckbox?"has-checkbox":"")}}_getChildren(e){this._hasIcons=!1,this._hasCheckbox=!1,this._activeSet.compute();const t=super._getChildren(e),{loadFailed:n}=this.state;return n&&t.push(n),t}};ut.ItemComponents={...vt.ItemComponents,default:Fe,item:Zt,heading:Zt},ut.NAME="list";const jl="```ZUI_STR\n";class ks{constructor(e="",t="local"){this._type=t,this._id=e,this._name=`ZUI_STORE:${this._id}`,this._storage=t==="local"?localStorage:sessionStorage}get type(){return this._type}get session(){return this.type==="session"?this:(this._altStorage||(this._altStorage=new ks(this._id,"session")),this._altStorage)}_getKey(e){return`${this._name}:${e}`}switch(e){this._id=e,this._name=`ZUI_STORE:${this._id}`}get(e,t){const n=this._storage.getItem(this._getKey(e));if(typeof n=="string"){if(n.startsWith(jl))return n.substring(jl.length);try{return JSON.parse(n)}catch{}}return n??t}set(e,t){if(t==null)return this.remove(e);this._storage.setItem(this._getKey(e),typeof t=="string"?`${jl}${t}`:JSON.stringify(t))}remove(e){this._storage.removeItem(this._getKey(e))}each(e){for(let t=0;t<this._storage.length;t++){const n=this._storage.key(t);if(n!=null&&n.startsWith(this._name)){const s=this._storage.getItem(n);typeof s=="string"&&e(n.substring(this._name.length+1),JSON.parse(s))}}}getAll(){const e={};return this.each((t,n)=>{e[t]=n}),e}}const Ze=new ks("DEFAULT");function Yy(i,e="local"){return new ks(i,e)}Object.assign(Ze,{create:Yy});const i0="";function Ud(i,e){const{children:t}=i;t.length&&t.forEach(n=>{e(n),Ud(n,e)})}function Qy(i,e){let t=i.parent;for(;t;)e(t),t=t.parent}function Vd(i){return i.split(":").reduce((e,t,n)=>(e.push(n?e[n-1]+":"+t:t),e),[])}function Bl(i,e,t,n,s=0,r){return i.reduce((o,a,l)=>{if(!a)return o;const c=String((e?a[e]:a.key)??a.key??l),d=r?`${r.keyPath}:${c}`:c,u={key:c,level:s,keyPath:d,parentKey:r==null?void 0:r.keyPath,parent:r,data:a,children:[]};return r&&r.children.push(u),o=t(o,u),Array.isArray(a.items)?Bl(a.items,e,t,o,s+1,u):o},n)}let pn=class extends ut{constructor(e){super(e);const{defaultNestedShow:t,preserve:n,nestedShow:s}=e;if(y.extend(this.state,typeof t=="boolean"?{defaultShow:t,nestedShow:{}}:{nestedShow:t||{}},s!==void 0?{nestedShow:s}:null),n&&s===void 0){this._storeID=`${this.constructor.NAME}:${n}:state`;const r=Ze.get(this._storeID);r&&(this.state.nestedShow=r.nestedShow)}if(!e.level){const r=this.state.nestedShow;r&&Object.keys(r).forEach(o=>{r[o]&&Vd(o).forEach(a=>{r[a]=!0})}),this._needInitChecks=!0}this._renderedItemMap=new Map,this._handleClick=this._handleClick.bind(this),this._beforeRenderNestedItem=this._beforeRenderNestedItem.bind(this),this._handleNestedToggle=this._handleNestedToggle.bind(this),this._handleNestedCheck=this._handleNestedCheck.bind(this),this._preserveState=this._preserveState.bind(this)}get isRoot(){return!this.props.level}get nestedShow(){return this.props.nestedShow??this.state.nestedShow??!1}async setItems(e,t){var s;this.isRoot&&(this._needInitChecks=!0);const n=await super.setItems(e,t);return e&&((s=this.props.parent)==null?void 0:s.checked)===!0?this.toggleChecked(this._renderedItems.map(r=>r.key),!0):e!=null&&e.some(r=>r.checked)&&(this._needInitChecks=!0,this.forceUpdate()),n}getItemMap(e){if(e&&(this._itemMap||this._itemMapCache))return this._itemMap||this._itemMapCache;if(!this._itemMap){let t=!1;const n=Bl(this._items,this.props.itemKey,(s,r)=>(s.set(r.keyPath,r),r.data.items&&!Array.isArray(r.data.items)&&(t=!0),s),new Map);if(t)return this._renderedItemMap.forEach((s,r)=>{n.has(r)||n.set(r,{key:s.key,level:s._level,keyPath:r,parentKey:`${r.split(":").slice(0,-1).join(":")}`,children:[],data:s})}),n.forEach(s=>{const{parentKey:r}=s;if(!r)return;const o=n.get(r);o&&(o.children.push(s),s.parent=o)}),this._itemMapCache=n,n;this._itemMap=n}return this._itemMap}getRenderedItem(e){return this._renderedItemMap.get(e)}getItem(e){var s;const t=this._itemMap||this._itemMapCache;if(t)return(s=t.get(e))==null?void 0:s.data;const n=this.getRenderedItem(e);return n?n._item:super.getItem(e)}isExpanded(e){const{nestedShow:t}=this;return typeof t=="boolean"?t:!!(t[e]??this.state.defaultShow)}async toggle(e,t,n){const s=this.isExpanded(e);if(!n&&t===s)return;t===void 0&&(t=!s);const{nestedShow:r,onToggle:o,accordion:a}=this.props;o&&o.call(this,e,t,n)===!1||r===void 0&&await this.changeState(l=>{let c={...n?{}:l.nestedShow,[e]:t};if(t&&a){let d=`${e.split(":").slice(0,-1).join(":")}`;d.length&&(d+=":"),Object.keys(c).forEach(u=>{u!==e&&u.startsWith(d)&&(c[u]=!1)})}return c=t?Vd(e).reduce((d,u)=>(d[u]=t,d),c):c,{nestedShow:c}},this._preserveState)}toggleAll(e){if(this.props.nestedShow===void 0)return this.setState({nestedShow:{},defaultShow:e},this._preserveState)}getChecks(){return Array.from(this.getItemMap(!0).values()).reduce((e,{keyPath:t,data:n})=>{const s=this.state.checked[t];return(s===!0||n.checked&&s!==!1)===!0&&e.push(t),e},[])}isChecked(e,t,n=!1){const s=(typeof t=="number"?this._items[t]:this.getItem(e))||{};return this.isRoot?this.state.checked[e]??s.checked??n:this.props.checkedState[`${this.props.parentKey}:${e}`]??s.checked??n}async toggleChecked(e,t){let n;if(Array.isArray(e)){if(!e.length)return;t===void 0&&(t=!this.isChecked(e[0])),n=e.reduce((a,l)=>(a[l]=t,a),{})}else typeof e=="object"?n=e:(t===void 0&&(t=!this.isChecked(e)),n={[e]:t});if(!Object.keys(n).length)return;if(this.isRoot){await this.changeState(({checked:a,nestedShow:l})=>{const c=g=>n[g.keyPath]??a[g.keyPath]??g.data.checked??!1,d=this.getItemMap(),u={},{expandChildrenOnCheck:p}=this.props;return Object.keys(n).forEach(g=>{t=n[g];const b=d.get(g);b&&(Ud(b,C=>{c(C)!==t&&(n[C.keyPath]=t)}),Qy(b,C=>{const{children:S}=C,x=S.reduce((D,A)=>(c(A)&&D++,D),0);n[C.keyPath]=x===S.length?!0:x?"indeterminate":!1}),p&&t&&b.data.items&&(u[g]=!0))}),{checked:{...a,...n},nestedShow:{...l,...u}}},()=>{var l;const a=this.state.checked;(l=this.props.onCheck)==null||l.call(this,n,Object.keys(a).filter(c=>a[c]===!0))});return}const{parentKey:s,onCheck:r}=this.props,o=Object.keys(n).reduce((a,l)=>(a[`${s!==void 0?`${s}:`:""}${l}`]=n[l],a),{});r.call(this,o,[])}getKeyPath(e){if(this.isRoot)return e;const t=this.props.parentKey;return e.startsWith(t+":")?e:`${t}:${e}`}isActive(e){if(typeof e=="object"){const t=e._keyPath??e.key;if(t===void 0)return!1;e=t}return this._activeSet.cache.has(this.getKeyPath(e))}async toggleActive(e,t){if(typeof e=="string"&&(e=[e]),e=e.map(n=>this.getKeyPath(n)),this.isRoot){await super.toggleActive(e,t),this.props.toggleOnActive&&e.forEach(n=>{this.isActive(n)&&!this.isExpanded(n)&&this.toggle(n,!0)});return}this.props.onActive.call(this,e,t??!this.isActive(e[0]))}activeNext(e,t=1){const n=this.getNextItem(this.getActiveKey(),e,t);n&&this.toggleActive(n._keyPath)}getNextItem(e,t,n=1,s=void 0){return s=s||Bl(this._items,this.props.itemKey,(r,o)=>(o.data.disabled||r.push({_keyPath:o.keyPath,type:"item",...o.data,...this._renderedItemMap.get(o.keyPath),key:o.keyPath}),r),[]),super.getNextItem(e,t,n,s)}_afterRender(e){if(super._afterRender(e),this._needInitChecks){const t={};this.getItemMap().forEach(s=>{s.data.checked!==void 0&&(t[s.keyPath]=s.data.checked)}),this.toggleChecked(t),this._needInitChecks=!1}}_preserveState(){this._storeID&&Ze.set(this._storeID,{nestedShow:this.state.nestedShow})}_getClassName(e){return[super._getClassName(e),"is-nested",e.level?"is-nested-sub":"is-nested-root"]}_getNestedProps(e,t,n,s){const{parentKey:r,level:o=0}=e,{isRoot:a}=this;return xe(this.constructor.inheritNestedProps.reduce((l,c)=>(l[c]=e[c],l),{}),{key:n.key,level:o+1,className:`is-nested-${s?"expanded":"collapsed"}`,items:t,parent:n,parentKey:r?`${r}:${n.key}`:n.key,nestedShow:this.nestedShow,defaultNestedShow:this.state.defaultShow,checkedState:e.checkedState||this.state.checked,onCheck:a?this._handleNestedCheck:e.onCheck,onToggle:a?this._handleNestedToggle:e.onToggle,beforeRenderItem:a?this._beforeRenderNestedItem:e.beforeRenderItem,active:a?this.getActiveKeys():e.active,onActive:a?this.toggleActive.bind(this):e.onActive},n.listProps)}_renderNestedList(e,t,n,s){if(!s&&!e.renderCollapsedList)return;const r=this._getNestedProps(e,t,n,s),o=this.constructor;return k(o,{...r},`nested:${n.key}`)}_renderNestedToggle(e,t){let n,s="";const{toggleIcons:r={}}=e;return typeof t=="boolean"?(n=t?r.expanded||k("span",{className:"caret-down"}):r.collapsed||k("span",{className:"caret-right"}),s=`state is-${t?"expanded":"collapsed"}`,N.isValidElement(n)||(n=k(Ie,{icon:n}))):(n=k(Ie,{icon:r.normal}),s="is-empty"),k("span",{className:V(`${this.name}-toggle nested-toggle-icon`,s),children:n})}_getItems(e){const t=super._getItems(e);return this.isRoot&&t!==this._items&&(this._itemMap=void 0),t}_getItem(e,t,n){const s=super._getItem(e,t,n)??t;if(!s)return s;const{parentKey:r}=e,o=s.key,a=`${r!==void 0?`${r}:`:""}${o}`;if(s.items){const l=s.expanded??this.isExpanded(a);xe(s,{expanded:l,className:["is-nested",`is-nested-${l?"show":"hide"}`]}),this._hasNestedItems=!0}return xe(s,{_level:e.level,_keyPath:a,parentKey:r})}_beforeRenderNestedItem(e,t){const{beforeRenderItem:n}=this.props;if(n){const s=n.call(this,e,t);s!==void 0&&(e=s)}return this._renderedItemMap.set(e._keyPath,e),e}_renderItem(e,t,n){(this._hasNestedItems||!this.isRoot)&&t.type==="item"&&t.toggleIcon===void 0&&(t.toggleIcon=this._renderNestedToggle(e,t.expanded));const s=t.items?this._renderNestedList(e,t.items,t,t.expanded):null;return t=xe(t,{"z-parent":t.parentKey,"z-key-path":t._keyPath},s?{children:s}:null),this._renderedItemMap.set(t._keyPath,t),super._renderItem(e,t,n)}_getItemFromEvent(e,t){t=t||e.target;let n=super._getItemFromEvent(e,t);if(!n){const r=t.closest("[z-list]");if(r){const o=r.getAttribute("z-list"),a=this.getItem(o),l=this.getRenderedItem(o);if(!a||!l)return;n={target:t,index:l._index,item:a,element:r,event:e,key:o,keyPath:o,renderedItem:l}}return}(e.type==="mouseenter"||e.type==="mouseleave"||e.type==="mouseover")&&(n.hover=e.type!=="mouseleave");const{parentKey:s}=this.props;return{...n,parentKey:s,keyPath:`${s!==void 0?`${s}:`:""}${n.key}`,target:t}}_handleNestedToggle(e,t,n){this.toggle(e,t,n)}_handleClick(e){const t=super._handleClick(e);if(t){const{renderedItem:n,keyPath:s,target:r}=t,{nestedToggle:o}=this.props;if(!n.items||e.defaultPrevented||r.closest(".not-nested-toggle")||o&&!n.disabled&&!r.closest(o)||!o&&!n.disabled&&r.closest("a,.btn,.item-checkbox,.open-url,input,select,textarea")&&!r.closest(".nested-toggle-icon,.item-icon"))return t;this.toggle(s),e.preventDefault()}return t}_handleNestedCheck(e){this.toggleChecked(e)}_getProps(e){const{level:t=0,indent:n=20,parentKey:s}=e,r=xe(super._getProps(e),{"z-level":t,"z-list":s,style:{"--list-nested-indent":`${t*n}px`,"--list-indent":`${n}px`},className:this._hasNestedItems?"has-nested-items":"no-nested-items"});return r.className=V(r.className),r}_beforeRender(e){return this._renderedItemMap.clear(),this._hasIcons=!1,this._hasNestedItems=!1,super._beforeRender(e)}};pn.defaultProps={...ut.defaultProps,defaultNestedShow:!1,level:0,indent:20},pn.inheritNestedProps=["component","name","itemName","itemKey","indent","hover","divider","multiline","toggleIcons","nestedToggle","accordion","itemRender","itemProps","onToggle","checkbox","getItem","getItems","checkOnClick","selectOnChecked","checkedState","onClickItem","activeOnHover","multipleActive","onActive","hoverItemActions"];const Xy=Object.freeze(Object.defineProperty({__proto__:null,List:ut,Listitem:Zt,NestedList:pn},Symbol.toStringTag,{value:"Module"}));class Ss extends _e{}Ss.NAME="List",Ss.Component=ut,Ss.replace=ut.TAG,Ss.register();class Ts extends _e{}Ts.NAME="NestedList",Ts.Component=pn,Ts.replace=pn.TAG,Ts.register(),Xe(Xy);const s0="",r0="",o0="",zi=class Xm extends pn{constructor(e){super(e),this._handleHover=this._handleHover.bind(this)}get isHoverTrigger(){return this.props.nestedTrigger==="hover"}_getClassName(e){return[super._getClassName(e),this._hasNestedItems?"menu-nested":"",e.className,e.wrap?{"scrollbar-thin":e.scrollbarThin,"scrollbar-hover":e.scrollbarHover}:{popup:e.popup,compact:e.compact}]}_getWrapClass(e){return["menu-wrapper",e.wrapClass,{popup:e.popup,compact:e.compact}]}_getWrapperProps(e){const{wrapAttrs:t,height:n,maxHeight:s,parentKey:r}=e,o=xe({"z-list-wrapper":r},t,n||s?{style:{height:n,maxHeight:s}}:null,this.isRoot&&this.isHoverTrigger?{onMouseEnter:this._handleHover,onMouseLeave:this._handleHover,onMouseOver:this._handleHover}:null);return o.className=V(this._getWrapClass(e),o.className),o}_renderWrapperHeader(e){return k(me,{content:e.header,generatorThis:this},"header")}_renderWrapperFooter(e){return k(me,{content:e.footer,generatorThis:this},"footer")}_handleHover(e){const t=e.target;if(!(t instanceof HTMLElement)||!this.isHoverTrigger)return;let n;if(e.type!=="mouseleave"){const c=t.closest("[z-item]");if(c)n=c.getAttribute("z-key-path"),c.classList.contains("is-nested")||(n=c.getAttribute("z-parent"));else{const d=t.closest("[z-list-wrapper]");n=d==null?void 0:d.getAttribute("z-list-wrapper")}}const s=this._hoverInfo,r=s==null?void 0:s.keyPath;if(r===n)return;s!=null&&s.timer&&clearTimeout(s.timer);const o=typeof n=="string",l=o?typeof r=="string"&&(s!=null&&s.shown)?50:200:s!=null&&s.shown?100:200;this._hoverInfo={keyPath:n,timer:window.setTimeout(()=>{o?(this.toggle(n,!0,!0),this._hoverInfo.shown=!0):(this.toggleAll(!1),this._hoverInfo=void 0)},l)}}componentWillUnmount(){var t;super.componentWillUnmount();const e=(t=this._hoverInfo)==null?void 0:t.timer;e&&clearTimeout(e)}render(e){const t=super.render(e);return e.wrap?k("menu",{...this._getWrapperProps(e),children:[this._renderWrapperHeader(e),t,this._renderWrapperFooter(e)]}):t}static render(e,t,n,s){let r=typeof e=="function"?e.call(s??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),n&&(r=xe(n,r)),k(Xm,{...r})}};zi.NAME="menu",zi.TAG="menu",zi.inheritNestedProps=[...pn.inheritNestedProps,"compact"],zi.ItemComponents={...pn.ItemComponents,item:[Zt,{innerComponent:"a"}]},zi.defaultProps={...pn.defaultProps,scrollbarHover:!0};let xt=zi;const a0="",l0="",c0="";let ci=class extends pe{constructor(e){super(e),this._input=fe(),this._timer=0,this._handleClearBtnClick=t=>{t.stopPropagation(),this.clear(t)},this._handleChange=t=>{const n=this.state.value,s=t.target.value,{onChange:r,delay:o}=this.props;this.setState({value:s},()=>{!r||n===s||(o?(this._clearTimer(),this._timer=window.setTimeout(()=>{r(s,t),this._timer=0},o)):r(s,t))})},this._handleFocus=t=>{const n=t.type==="focus";this.setState({focus:n},()=>{const s=n?this.props.onFocus:this.props.onBlur;s==null||s(t)})},this.state={focus:!1,value:e.defaultValue||""},this._gid=e.id||`search-box-${ft()}`}componentDidMount(){const{hotkeys:e}=this.props;if(e){const t=vl(e,{clear:{keys:"Escape",handler:n=>{this.clear(n)}},enter:{keys:"Enter",handler:n=>{var s,r;(r=(s=this.props).onEnter)==null||r.call(s,this.state.value,n)}}});t&&(this._hotkeysScope=`SearchBox_${this._gid}`,y(this.input).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}}componentWillUnmount(){this._hotkeysScope&&y(this.input).unbindHotkeys(this._hotkeysScope)}get id(){return this._gid}get input(){return this._input.current}focus(){var e;(e=this.input)==null||e.focus()}blur(){var e;(e=this.input)==null||e.blur()}clear(e){const t=this.state.value;this.setState({value:""},()=>{const{onChange:n,onClear:s}=this.props;s==null||s(e),this.focus(),t.trim()!==""&&(n==null||n("",e))})}_clearTimer(){this._timer&&clearTimeout(this._timer),this._timer=0}render(e,t){const{style:n,className:s,rootClass:r,rootStyle:o,readonly:a,disabled:l,circle:c,placeholder:d,mergeIcon:u,searchIcon:p,clearIcon:g,value:b,compact:C,prefixClass:S,suffixClass:x}=e,{focus:D,value:A}=t,{id:B}=this,H=b??A,G=typeof H!="string"||!H.trim().length;let Y,Z,ee;return p&&(ee=p===!0?k("span",{class:"magnifier"}):k(Ie,{icon:p})),!u&&p&&(Y=k("label",{for:B,class:V("input-control-prefix",S),children:ee},"prefix")),g&&!G?Z=k("button",{type:"button",class:"btn ghost size-sm square rounded-full",onClick:this._handleClearBtnClick,children:g===!0?k("span",{class:"close"}):k(Ie,{icon:g})}):u&&p&&(Z=ee),Z&&(Z=k("label",{for:B,class:V("input-control-suffix",x),children:Z},"suffix")),k("div",{class:V("search-box input-control",r,{focus:D,empty:G,compact:C,"has-prefix-icon":Y,"has-suffix-icon":Z}),style:o,children:[Y,k("input",{ref:this._input,id:B,type:"text",class:V("form-control",{"rounded-full":c,"size-sm":C},s),style:n,placeholder:d,disabled:l,readonly:a,value:H,onInput:this._handleChange,onChange:this._handleChange,onFocus:this._handleFocus,onBlur:this._handleFocus},"input"),Z]})}};ci.defaultProps={clearIcon:!0,searchIcon:!0,delay:500,hotkeys:!0};const Zy=Object.freeze(Object.defineProperty({__proto__:null,SearchBox:ci},Symbol.toStringTag,{value:"Module"}));let st=class extends xt{constructor(e){super(e),this._handleSearchChange=t=>{const n=this.constructor.getSearchKeys(t);this._searchKeys=n,this.setState({search:n.join(" ")})},this.state.search=e.search??e.defaultSearch,this._searchKeys=this.constructor.getSearchKeys(this.state.search),this._isNestedItemMatch=this._isNestedItemMatch.bind(this)}componentWillUpdate(e){this.isRoot&&e.search!==void 0&&e.search!==this.props.search&&(this._searchKeys=this.constructor.getSearchKeys(e.search))}componentDidMount(){super.componentDidMount(),this._updateMatchedParents()}componentDidUpdate(){super.componentDidUpdate(),this._updateMatchedParents()}isExpanded(e){return this.props.expandOnSearch&&this._searchKeys.length?!0:super.isExpanded(e)}_updateMatchedParents(){var n;if(!this.isRoot)return;const e=y(this.element),t=e.find(".item.is-nested.is-not-match").filter((s,r)=>this._matchedParents.has(r.getAttribute("z-key-path")||"")).addClass("has-match-child");e.parent().toggleClass("no-match-child",!!((n=this._searchKeys)!=null&&n.length)&&!t.length&&!e.children(".item").not(".is-not-match").length)}_isItemMatch(e,t,n,s){const{isItemMatch:r,nestedSearch:o}=e,a=r?r.call(this,t,this._searchKeys,n,s):this.constructor.isItemMatch(t,this._searchKeys,e.searchProps);if(o&&this.isRoot&&a&&s!==void 0){let l="";String(s).split(":").forEach(c=>{l+=`${l.length?":":""}${c}`,this._matchedParents.add(l)})}return a}_isNestedItemMatch(e,t,n,s){return this._isItemMatch(this.props,e,n,s)}_getNestedProps(e,t,n,s){const r=super._getNestedProps(e,t,n,s);return this.isRoot&&e.nestedSearch?(r.isItemMatch=this._isNestedItemMatch,r.search=this._searchKeys.join(" ")):e.nestedSearch||xe(r,{search:void 0,defaultSearch:void 0},n.listProps),r}_getItem(e,t,n){const s=super._getItem(e,t,n);return s&&(this.isRoot&&this.props.limit&&this._showCount>=this.props.limit?!1:(s.hidden=!this._isItemMatch(e,t,n,e.parentKey),s.hidden||this._showCount++,s))}_renderItem(e,t,n){return t.className=[t.className,t.hidden?"is-not-match":""],e.underlineKeys&&this._searchKeys.length&&["text","title","subtitle","content"].forEach(s=>{typeof t[s]=="string"&&(t[s]=this.constructor.underlineKeys(this._searchKeys,[t[s]]))}),super._renderItem(e,t,n)}_getWrapClass(e){const t=this.isRoot&&this._searchKeys.length;return V(super._getWrapClass(e),"search-menu",e.searchBox?`search-menu-on-${e.searchPlacement||"top"}`:"",t?"is-search-mode":"",t&&e.expandOnSearch?"no-toggle-on-search":"")}_getSearchBoxProps(e){const{searchBox:t}=e,n={compact:!0,className:"not-nested-toggle",onChange:this._handleSearchChange};return typeof t=="object"&&xe(n,t),e.search!==void 0&&(n.value=this._searchKeys.join(" "),n.disabled=!0),n}_renderSearchBox(e){const t=this._getSearchBoxProps(e);return k(ci,{...t},"search")}_renderWrapperHeader(e){const t=e.header,{noMatchHint:n,searchBox:s,searchPlacement:r,nestedSearch:o,headerClass:a}=e,l=(!o||this.isRoot)&&s&&r!=="bottom";return!t&&!l&&!n?null:[n?k("div",{className:"search-menu-no-match-hint",children:n},"noMatchHint"):null,t||l?k("header",{className:V("search-menu-header",a),children:[t?super._renderWrapperHeader(e):null,l?this._renderSearchBox(e):null]},"header"):null]}_renderWrapperFooter(e){const t=e.footer,{searchBox:n,searchPlacement:s,nestedSearch:r,footerClass:o,exceedLimitHint:a,limit:l}=e,c=(!r||this.isRoot)&&n&&s==="bottom",d=a&&l&&this._items.length>l;return!t&&!c&&!d?null:k("footer",{className:V("search-menu-footer",o),children:[d?k("div",{className:"search-menu-exceed-limit-hint",children:Ce(a,this._items.length-l)}):null,t?super._renderWrapperFooter(e):null,c?this._renderSearchBox(e):null]},"footer")}_beforeRender(e){return this.isRoot&&(this._matchedParents=new Set,this._showCount=0),super._beforeRender(e)}static isItemMatch(e,t,n=["keys","text","title","subtitle"]){return t.length?t.every(s=>n.some(r=>{const o=typeof r=="function"?r(e):e[r];return typeof o=="string"&&o.length&&o.toLowerCase().includes(s)})):!0}static getSearchKeys(e=""){return y.unique(e.toLowerCase().split(" ").filter(t=>t.length))}static underlineKeys(e,t,n="is-match-keys"){return e.reduce((s,r)=>[...s].reduce((o,a)=>{if(typeof a!="string")return o.push(a),o;const l=a.toLowerCase().split(r);if(l.length===1)return o.push(a),o;let c=0;return l.forEach((d,u)=>{u&&(o.push(k("span",{class:n,children:a.substring(c,c+r.length)})),c+=r.length),o.push(a.substring(c,c+d.length)),c+=d.length}),o},[]),t)}};st.inheritNestedProps=[...xt.inheritNestedProps,"isItemMatch","search","underlineKeys","nestedSearch"],st.defaultProps={...xt.defaultProps,defaultNestedShow:!0,wrap:!0,nestedSearch:!0,underlineKeys:!0};const Jy=Object.freeze(Object.defineProperty({__proto__:null,Menu:xt,SearchMenu:st},Symbol.toStringTag,{value:"Module"}));class no extends _e{}no.NAME="Menu",no.Component=xt,no.replace=xt.TAG;class io extends _e{}io.NAME="SearchMenu",io.Component=st,io.replace=st.TAG,Xe(Jy);const h0="",u0="",d0="",f0="",p0="",m0="",g0="",y0="",_0="",v0="",b0="";function e_({className:i,style:e,actions:t,heading:n,content:s,contentClass:r,children:o,close:a,onClose:l,icon:c,iconClass:d,...u}){let p;a===!0?p=k(ke,{className:"alert-close btn ghost square text-inherit",square:!0,onClick:l,children:k("span",{class:"close"})}):N.isValidElement(a)?p=a:typeof a=="object"&&(p=k(ke,{...a,onClick:l}));const g=He.render(t,[]);return k("div",{className:V("alert",i),style:e,...u,children:[k(Ie,{icon:c,className:V("alert-icon",d)}),typeof s!="string"?k(me,{content:s}):k("div",{className:V("alert-content",r),children:[typeof n!="string"?k(me,{content:n}):n&&k("div",{className:"alert-heading",children:n}),k("div",{className:"alert-text",children:s}),n?g:null]}),n?null:g,p,o]})}function t_(i){if(i==="center")return"fade-from-center";if(i){if(i.includes("top"))return"fade-from-top";if(i.includes("bottom"))return"fade-from-bottom"}return"fade"}let n_=class extends pe{render(e){const{margin:t,type:n,placement:s,animation:r,show:o,className:a,time:l,...c}=e;return typeof c.html=="string"&&(c.content={html:c.html},delete c.html),k(e_,{className:V("messager",a,n,r===!0?t_(s):r,o?"in":""),...c})}};class Hl extends _e{constructor(){super(...arguments),this._show=!1,this._showTimer=0,this._afterRender=({firstRender:e})=>{e&&this.show();const{margin:t}=this.options;t&&this.$element.css("margin",`${t}px`)}}get isShown(){return this._show}afterInit(){this.on("click",e=>{y(e.target).closest('.alert-close,[data-dismiss="messager"]').length&&(e.preventDefault(),e.stopPropagation(),this.hide())})}setOptions(e,t){return e=super.setOptions(e,t),{...e,show:this._show,afterRender:this._afterRender}}show(){this.render(),this.emit("show"),this._resetTimer(()=>{this._show=!0,this.render(),this._resetTimer(()=>{this.emit("shown");const{time:e}=this.options;e&&this._resetTimer(()=>this.hide(),e)})},100)}hide(){this._show&&this._resetTimer(()=>{this.emit("hide"),this._show=!1,this.render(),this._resetTimer(()=>{this.emit("hidden")})},50)}_resetTimer(e,t=200){this._showTimer&&clearTimeout(this._showTimer),this._showTimer=window.setTimeout(()=>{e(),this._showTimer=0},t)}}Hl.NAME="MessagerItem",Hl.Component=n_;const $s=class Zm extends ze{get isShown(){var e;return!!((e=this._item)!=null&&e.isShown)}show(e){this.setOptions(e),this._getItem().show()}hide(){var e;(e=this._item)==null||e.hide()}_getItem(){const e={...this.options};if(this._item)this._item.setOptions(e);else{const t=this._getHolder(),n=new Hl(t,e);n.on("hidden",()=>{n.destroy(),t==null||t.remove(),this._holder=void 0,this._item=void 0}),this._item=n}return this._item}_getHolder(){if(this._holder)return this._holder;const{placement:e="top"}=this.options;let t=this.$element.find(`.messagers-${e}`);t.length||(t=y(`<div class="messagers messagers-${e}"></div>`).appendTo(this.$element));let n=t.find(`#messager-${this.gid}`);return n.length||(n=y(`<div class="messager-holder" id="messager-${this.gid}"></div>`).appendTo(t),this._holder=n[0]),n[0]}static show(e,t){typeof e=="string"&&(e={content:e});const{container:n,...s}=e,r={type:t,key:`messager_${ft()}`,...s};r.type&&y.extend(r,this.TypeOptions[r.type]);const o=Zm.ensure(n||"body",r);return o.hide(),o.show(),o}};$s.NAME="messager",$s.DEFAULT={placement:"top",animation:!0,close:!0,margin:6,time:5e3},$s.MULTI_INSTANCE=!0,$s.TypeOptions={};let An=$s,so=class extends pe{render(e){const{percent:t=50,color:n,background:s=null,height:r,width:o,children:a,className:l,style:c}=e;return k("div",{class:V("progress",l),style:{width:o,height:r,"--progress-bg":s,"--progress-bar-color":n,...c},children:[k("div",{class:"progress-bar",style:{width:`${t}%`}}),a]})}};so.defaultProps={percent:50,height:20,width:"auto"},Xe(Object.freeze(Object.defineProperty({__proto__:null,ProgressBar:so},Symbol.toStringTag,{value:"Module"})));class Wl extends _e{}Wl.NAME="ProgressBar",Wl.Component=so,Wl.register();const C0="",x0="";let ro=class extends pe{render(e){const{percent:t=50,size:n=24,circleBg:s,circleColor:r,text:o,className:a,textStyle:l,textX:c,textY:d,children:u}=e,p=n/2;let{circleWidth:g=.1}=e;g<1&&(g=n*g);const b=(n-g)/2;return k("svg",{className:a,width:n,height:n,children:[k("circle",{cx:p,cy:p,r:b,"stroke-width":g,stroke:s,fill:"transparent"}),k("circle",{cx:p,cy:p,r:b,"stroke-width":g,stroke:r,fill:"transparent","stroke-linecap":"round","stroke-dasharray":Math.PI*b*2,"stroke-dashoffset":Math.PI*b*2*(100-t)/100,style:{transformOrigin:"center",transform:"rotate(-90deg)"}}),o?k("text",{x:c??p,y:d??p+g/2,"dominant-baseline":"middle","text-anchor":"middle",style:l||{fontSize:`${b}px`,stroke:"currentColor"},children:o===!0?Math.round(t):o}):null,u]})}};ro.defaultProps={circleBg:"var(--color-surface)",circleColor:"var(--color-primary-500)",text:!0};class oo extends _e{}oo.NAME="ProgressCircle",oo.Component=ro,oo.register(),Xe(Object.freeze(Object.defineProperty({__proto__:null,ProgressCircle:ro},Symbol.toStringTag,{value:"Module"})));const S0="",T0="",$0="",D0="",I0="",N0="",M0="",E0="",A0="",Ds='[droppable="true"]';class Is extends ze{constructor(){super(...arguments),this._state={dragging:null,dropping:null},this._handleMouseDown=e=>{const{selector:t,handle:n,beforeDrag:s}=this.options,r=y(e.target),o=r.closest(t),a=o[0];!a||n&&!r.closest(n).length||s&&s.call(this,e,a)===!1||(o.attr("draggable","true"),this._setState({dragging:a}))},this._handleDragStart=e=>{const{dragElement:t}=this;if(!t){e.preventDefault();return}const{options:n}=this,{onDragStart:s}=n;if(s&&s.call(this,e,t)===!1){this._clean();return}const{$element:r}=this,{target:o,selector:a,draggingClass:l,droppableClass:c,hasDraggingClass:d,canDrop:u}=n;l&&(this.$element.find(l).removeClass(l),y(t).addClass(l));let p=typeof o=="function"?y(o.call(this,t)):r.find(o||a||Ds);if(u&&(p=p.filter((g,b)=>u.call(this,e,t,b)!==!1)),!p.length){this._clean();return}c&&(r.find(c).removeClass(c),p.addClass(c)),d&&r.addClass(d),r.find(Ds).removeAttr("droppable"),p.attr("droppable","true"),this._$targets=p},this._handleDrag=e=>{var n;const{dragElement:t}=this;t&&(this._setDragEffect(e),(n=this.options.onDrag)==null||n.call(this,e,t))},this._handleDragEnd=e=>{var n;const{dragElement:t}=this;t&&((n=this.options.onDragEnd)==null||n.call(this,e,t)),this._clean()},this._handleDragEnter=e=>{this._handleDragOver(e)},this._handleDragOver=e=>{var o,a;const{dragElement:t}=this,s=y(e.target).closest(Ds)[0];if(!t||!s)return;const r=this.state.dropping;if(e.preventDefault(),this._setDragEffect(e),r!==s){const{droppingClass:l}=this.options;l&&(r&&this._leaveDropElement(e,r),y(s).addClass(l)),this._setState({dropping:s}),(o=this.options.onDragEnter)==null||o.call(this,e,t,s)}(a=this.options.onDragOver)==null||a.call(this,e,t,s)},this._handleDragLeave=e=>{const{dragElement:t}=this,n=y(e.target).filter(Ds)[0];!t||!n||(e.preventDefault(),this._leaveDropElement(e,n),this._setState({dropping:null}))},this._handleDrop=e=>{var n;const t=y(e.target).closest(Ds)[0];t&&(e.preventDefault(),(n=this.options.onDrop)==null||n.call(this,e,this.dragElement,t)),this._needClean=!0,setTimeout(()=>{this._needClean&&this._clean()},50)}}get state(){return this._state}get dragElement(){return this._state.dragging}get dropElement(){return this._state.dropping}async afterInit(){const{namespace:e}=this,{dragContainer:t,dropContainer:n,onDrag:s}=this.options;this._$dragContainer=t?y(t):this.$element,this._$dropContainer=n?y(n):this._$dragContainer,this._$dragContainer.on("mousedown"+e,this._handleMouseDown).on("dragstart"+e,this._handleDragStart).on("dragend"+e,this._handleDragEnd),s&&this._$dragContainer.on("drag"+e,this._handleDrag),this._$dropContainer.on("dragover"+e,this._handleDragOver).on("dragenter"+e,this._handleDragEnter).on("dragleave"+e,this._handleDragLeave).on("drop"+e,this._handleDrop),y(document).on(`mouseup${this.namespace}`,this._clean.bind(this))}destroy(){this._clean(),y(document).off(this.namespace),this._$dragContainer.off(this.namespace),this._$dropContainer.off(this.namespace),super.destroy()}_setState(e){var r;const t=this._state,{dragging:n=t.dragging,dropping:s=t.dropping}=e;n===t.dragging&&s===t.dropping||(this._state={dragging:n,dropping:s},(r=this.options.onChange)==null||r.call(this,this._state,t))}_setDragEffect(e){const{dropEffect:t}=this.options;t&&(e.dataTransfer.dropEffect=t)}_leaveDropElement(e,t){var s;const{droppingClass:n}=this.options;n&&y(t).removeClass(n),(s=this.options.onDragLeave)==null||s.call(this,e,this.dragElement,t)}_clean(){this._needClean=!0;const{draggingClass:e,droppableClass:t,droppingClass:n,hasDraggingClass:s}=this.options;s&&this.$element.removeClass(s);const{dragElement:r}=this;if(r){const a=y(r);e&&a.removeClass(e)}this._setState({dropping:null,dragging:null});const o=this._$targets;o&&(t&&o.removeClass(t),n&&o.removeClass(n),this._$targets=void 0)}}Is.NAME="Draggable",Is.DEFAULT={selector:'[draggable="true"]',dropEffect:"move",hasDraggingClass:"has-dragging",draggingClass:"is-dragging",droppableClass:"is-droppable",droppingClass:"is-dropping"};const i_='[moveable="true"]',Ul=class Jm extends ze{constructor(){super(...arguments),this._handleMouseDown=e=>{const{options:t}=this,{selector:n,handle:s,onMoveStart:r}=t,o=y(e.target),a=n==="self"?this.$element:o.closest(n),l=a[0];if(!l||s&&!o.closest(s).length||r&&r.call(this,e,l)===!1)return;a.attr("moveable","true");const{movingClass:c,hasMovingClass:d}=t;c&&a.addClass(c),d&&this.$element.addClass(d),e.preventDefault(),this._setState(e,l),y(document).off("mousemove mouseup").on(`mousemove${this.namespace}`,this._handleMouseMove.bind(this)).on(`mouseup${this.namespace}`,this._handleMouseUp.bind(this))},this._handleMouseMove=e=>{!this._state||!e.buttons||(e.preventDefault(),this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{var t;this._raf=0,this._setState(e),(t=this.options.onMove)==null||t.call(this,e,this._state)}))},this._handleMouseUp=e=>{var t,n;this._state&&(this._raf&&(cancelAnimationFrame(this._raf),this._raf=0),this._setState(e),(t=this.options.onMove)==null||t.call(this,e,this._state),(n=this.options.onMoveEnd)==null||n.call(this,e,this._state),this._clean())}}get state(){return this._state}get moveElement(){var e;return(e=this._state)==null?void 0:e.target}async afterInit(){this.on("mousedown",this._handleMouseDown)}destroy(){this._clean(),y(document).off(this.namespace),super.destroy()}_setState(e,t){var l;let n={x:e.pageX,y:e.pageY};const s=this._state;if(t){const c=y(t);let d;if(this.options.move===!0){const p=c.css("position");d=p==="fixed"||p==="absolute"||p==="relative"?"position":"transform"}else d=this.options.move||"none";const u=d==="transform"?Jm.getTranslate(t):d==="scroll"?{left:t.scrollLeft,top:t.scrollTop}:c.position();n=y.extend(n,{strategy:d,target:t,startX:n.x,startY:n.y,deltaX:0,deltaY:0,startLeft:u.left,startTop:u.top,left:u.left,top:u.top,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop})}else if(s){const c=n.x-s.startX,d=n.y-s.startY;n=y.extend({},s,n,{deltaX:c,deltaY:d,left:s.startLeft+c,top:s.startTop+d})}this._state=n;const{strategy:r,target:o}=n,a=y(o);r==="position"?a.css({left:n.left,top:n.top}):r==="transform"?a.css("transform",`translate(${n.left}px, ${n.top}px)`):r==="scroll"&&(o.scrollLeft=n.scrollLeft-n.deltaX,o.scrollTop=n.scrollTop-n.deltaY),(l=this.options.onChange)==null||l.call(this,n,s,e)}_clean(){y(document).off("mousemove mouseup");const{hasMovingClass:e,movingClass:t}=this.options;e&&this.$element.removeClass(e);const{moveElement:n}=this;if(n){const s=y(n);t&&s.removeClass(t)}this._state=void 0}static getTranslate(e){const n=window.getComputedStyle(e).getPropertyValue("transform");if(n==="none")return{left:0,top:0};const s=n.match(/^matrix\((.+)\)$/);if(!s)return{left:0,top:0};const r=s[1].split(", ");return{left:parseFloat(r[4]),top:parseFloat(r[5])}}};Ul.NAME="Moveable",Ul.DEFAULT={selector:i_,hasMovingClass:"has-moving",movingClass:"is-moving",move:!0};let Ns=Ul;const Vl=class eg extends ze{async afterInit(){const e=await eg.loadModule(),{options:t}=this;if(t.dragShadow!==void 0&&t.dragShadow!==!0){const{dragShadow:n,onEnd:s,setData:r}=t;t.setData=(o,a)=>{n===!1&&!this._emptyShadow&&(this._emptyShadow=a.cloneNode(!0),this._emptyShadow.classList.add("sortable-empty-shadow"),document.body.appendChild(this._emptyShadow)),o.setDragImage(n===!1?this._emptyShadow:n,0,0),r==null||r(o,a)},t.onEnd=o=>{var a;s==null||s(o),(a=this._emptyShadow)==null||a.remove(),this._emptyShadow=void 0},delete t.dragShadow}this.module=new e(this.element,t)}option(e,t){if(t===void 0)return this.module.option(e);this.module.option(e,t)}closest(e,t){return this.module.closest(e,t)}sort(e,t){this.module.sort(e,t)}save(){this.module.save()}destroy(){super.destroy(),this.module.destroy()}toArray(){return this.module.toArray()}static async loadModule(){return this.Module||(this.Module=await y.getLib("sortablejs")),this.Module}};Vl.NAME="Sortable",Vl.DEFAULT={animation:150};let ao=Vl;y.registerLib("sortablejs",{src:"sortable/sortable.min.js",check:"Sortable"});let Ms=class extends ut{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new ao(this.element,e))}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-list"]}_getSortableOptions(){const{sortable:e,canSortTo:t}=this.props;if(!e)return;const n=typeof e=="object"?e:{};return{group:`SortableList.${this.gid}`,dataIdAttr:"z-key",draggable:".list-item",...n,onSort:s=>{var o,a;const r=this.getOrders();(o=this.props.onSort)==null||o.call(this,s,r),(a=n.onSort)==null||a.call(this,s)},onMove:(s,r)=>{var o;if(t){const a=s.dragged.getAttribute("z-key-path"),l=s.related.getAttribute("z-key-path"),c=this.getItem(a),d=this.getItem(l),u=t.call(this,s,c,d);if(u!==void 0)return u}return(o=n.onMove)==null?void 0:o.call(this,s,r)}}}};Ms.defaultProps={...ut.defaultProps,sortable:!0};let bt=class extends xt{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,n){return this.constructor.getTreeItem(e,super._getItem(e,t,n))}static getTreeItem(e,t){return t&&(t.type==="item"&&(t.icon===void 0&&(t.icon=t.items?t.expanded?e.expandedIcon:e.collapsedIcon:e.normalIcon),t.actions===void 0&&(t.actions=e.itemActions)),t)}};bt.NAME="tree",bt.defaultProps={...xt.defaultProps,indent:12},bt.defaultItemProps={...xt.defaultItemProps,innerComponent:"div"},bt.inheritNestedProps=[...xt.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"];let hi=class extends st{_getClassName(e){return[super._getClassName(e),e.lines?"tree-lines":""]}_getItem(e,t,n){return bt.getTreeItem(e,super._getItem(e,t,n))}};hi.NAME="tree",hi.inheritNestedProps=[...st.inheritNestedProps,"itemActions","expandedIcon","collapsedIcon","normalIcon"],hi.ItemComponents={...st.ItemComponents,item:[Zt,{innerComponent:"div"}]};const s_=Object.freeze(Object.defineProperty({__proto__:null,SearchTree:hi,Tree:bt},Symbol.toStringTag,{value:"Module"}));let Fi=class extends bt{componentDidMount(){super.componentDidMount();const e=this._getSortableOptions();e&&(this._sortable=new ao(this.element,e))}getOrders(){var e;return((e=this._sortable)==null?void 0:e.toArray())||[]}_getClassName(e){return[super._getClassName(e),"sortable-tree"]}_getSortableOptions(){const{sortable:e}=this.props;if(!e)return;const t=typeof e=="object"?e:{},{onSort:n,canSortTo:s,parentKey:r}=this.props;return{group:`SortableTree.${this.gid}`,dataIdAttr:"z-key",draggable:".tree-item",...t,onSort:o=>{var l;const a=this.getOrders();n==null||n.call(this,o,a,r),(l=t.onSort)==null||l.call(this,o)},onMove:(o,a)=>{var l;if(s){const c=o.dragged.getAttribute("z-key-path"),d=o.related.getAttribute("z-key-path"),u=this.getItem(c),p=this.getItem(d),g=s.call(this,o,u,p,r);if(g!==void 0)return g}return(l=t.onMove)==null?void 0:l.call(this,o,a)}}}};Fi.defaultProps={...bt.defaultProps,sortable:!0},Fi.inheritNestedProps=[...bt.inheritNestedProps,"onSort","sortable","canSortTo"];class lo extends _e{}lo.NAME="SortableList",lo.Component=Ms,lo.replace=Ms.TAG;class co extends _e{}co.NAME="SortableTree",co.Component=Fi,co.replace=Fi.TAG;const P0="";/*! js-cookie v3.0.1 | MIT */function ho(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)i[n]=t[n]}return i}var r_={read:function(i){return i[0]==='"'&&(i=i.slice(1,-1)),i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(i){return encodeURIComponent(i).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Kl(i,e){function t(s,r,o){if(!(typeof document>"u")){o=ho({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var l in o)o[l]&&(a+="; "+l,o[l]!==!0&&(a+="="+o[l].split(";")[0]));return document.cookie=s+"="+i.write(r,s)+a}}function n(s){if(!(typeof document>"u"||arguments.length&&!s)){for(var r=document.cookie?document.cookie.split("; "):[],o={},a=0;a<r.length;a++){var l=r[a].split("="),c=l.slice(1).join("=");try{var d=decodeURIComponent(l[0]);if(o[d]=i.read(c,d),s===d)break}catch{}}return s?o[s]:o}}return Object.create({set:t,get:n,remove:function(s,r){t(s,"",ho({},r,{expires:-1}))},withAttributes:function(s){return Kl(this.converter,ho({},this.attributes,s))},withConverter:function(s){return Kl(ho({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(i)}})}var Kd=Kl(r_,{path:"/"});window.$&&Object.assign(window.$,{cookie:Kd});var qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function o_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Gd={exports:{}};(function(i,e){(function(t,n){i.exports=n()})(qd,function(){var t=function(h,f){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,_){m.__proto__=_}||function(m,_){for(var v in _)Object.prototype.hasOwnProperty.call(_,v)&&(m[v]=_[v])})(h,f)},n=function(){return(n=Object.assign||function(h){for(var f,m=1,_=arguments.length;m<_;m++)for(var v in f=arguments[m])Object.prototype.hasOwnProperty.call(f,v)&&(h[v]=f[v]);return h}).apply(this,arguments)};function s(h,f,m){if(m||arguments.length===2)for(var _,v=0,T=f.length;v<T;v++)!_&&v in f||((_=_||Array.prototype.slice.call(f,0,v))[v]=f[v]);return h.concat(_||Array.prototype.slice.call(f))}var r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:qd,o=Object.keys,a=Array.isArray;function l(h,f){return typeof f!="object"||o(f).forEach(function(m){h[m]=f[m]}),h}typeof Promise>"u"||r.Promise||(r.Promise=Promise);var c=Object.getPrototypeOf,d={}.hasOwnProperty;function u(h,f){return d.call(h,f)}function p(h,f){typeof f=="function"&&(f=f(c(h))),(typeof Reflect>"u"?o:Reflect.ownKeys)(f).forEach(function(m){b(h,m,f[m])})}var g=Object.defineProperty;function b(h,f,m,_){g(h,f,l(m&&u(m,"get")&&typeof m.get=="function"?{get:m.get,set:m.set,configurable:!0}:{value:m,configurable:!0,writable:!0},_))}function C(h){return{from:function(f){return h.prototype=Object.create(f.prototype),b(h.prototype,"constructor",h),{extend:p.bind(null,h.prototype)}}}}var S=Object.getOwnPropertyDescriptor,x=[].slice;function D(h,f,m){return x.call(h,f,m)}function A(h,f){return f(h)}function B(h){if(!h)throw new Error("Assertion Failed")}function H(h){r.setImmediate?setImmediate(h):setTimeout(h,0)}function G(h,f){if(typeof f=="string"&&u(h,f))return h[f];if(!f)return h;if(typeof f!="string"){for(var m=[],_=0,v=f.length;_<v;++_){var T=G(h,f[_]);m.push(T)}return m}var $=f.indexOf(".");if($!==-1){var I=h[f.substr(0,$)];return I==null?void 0:G(I,f.substr($+1))}}function Y(h,f,m){if(h&&f!==void 0&&!("isFrozen"in Object&&Object.isFrozen(h)))if(typeof f!="string"&&"length"in f){B(typeof m!="string"&&"length"in m);for(var _=0,v=f.length;_<v;++_)Y(h,f[_],m[_])}else{var T,$,I=f.indexOf(".");I!==-1?(T=f.substr(0,I),($=f.substr(I+1))===""?m===void 0?a(h)&&!isNaN(parseInt(T))?h.splice(T,1):delete h[T]:h[T]=m:Y(I=!(I=h[T])||!u(h,T)?h[T]={}:I,$,m)):m===void 0?a(h)&&!isNaN(parseInt(f))?h.splice(f,1):delete h[f]:h[f]=m}}function Z(h){var f,m={};for(f in h)u(h,f)&&(m[f]=h[f]);return m}var ee=[].concat;function he(h){return ee.apply([],h)}var Cn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(he([8,16,32,64].map(function(h){return["Int","Uint","Float"].map(function(f){return f+h+"Array"})}))).filter(function(h){return r[h]}),X=new Set(Cn.map(function(h){return r[h]})),se=null;function ge(h){return se=new WeakMap,h=function f(m){if(!m||typeof m!="object")return m;var _=se.get(m);if(_)return _;if(a(m)){_=[],se.set(m,_);for(var v=0,T=m.length;v<T;++v)_.push(f(m[v]))}else if(X.has(m.constructor))_=m;else{var $,I=c(m);for($ in _=I===Object.prototype?{}:Object.create(I),se.set(m,_),m)u(m,$)&&(_[$]=f(m[$]))}return _}(h),se=null,h}var be={}.toString;function Me(h){return be.call(h).slice(8,-1)}var Pe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ce=typeof Pe=="symbol"?function(h){var f;return h!=null&&(f=h[Pe])&&f.apply(h)}:function(){return null};function J(h,f){return f=h.indexOf(f),0<=f&&h.splice(f,1),0<=f}var we={};function ve(h){var f,m,_,v;if(arguments.length===1){if(a(h))return h.slice();if(this===we&&typeof h=="string")return[h];if(v=ce(h)){for(m=[];!(_=v.next()).done;)m.push(_.value);return m}if(h==null)return[h];if(typeof(f=h.length)!="number")return[h];for(m=new Array(f);f--;)m[f]=h[f];return m}for(f=arguments.length,m=new Array(f);f--;)m[f]=arguments[f];return m}var Ee=typeof Symbol<"u"?function(h){return h[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ur=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],jt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ur),Vn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function pt(h,f){this.name=h,this.message=f}function vn(h,f){return h+". Errors: "+Object.keys(f).map(function(m){return f[m].toString()}).filter(function(m,_,v){return v.indexOf(m)===_}).join(`
`)}function bn(h,f,m,_){this.failures=f,this.failedKeys=_,this.successCount=m,this.message=vn(h,f)}function wt(h,f){this.name="BulkError",this.failures=Object.keys(f).map(function(m){return f[m]}),this.failuresByPos=f,this.message=vn(h,this.failures)}C(pt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),C(bn).from(pt),C(wt).from(pt);var Kn=jt.reduce(function(h,f){return h[f]=f+"Error",h},{}),sn=pt,de=jt.reduce(function(h,f){var m=f+"Error";function _(v,T){this.name=m,v?typeof v=="string"?(this.message="".concat(v).concat(T?`
 `+T:""),this.inner=T||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=Vn[f]||m,this.inner=null)}return C(_).from(sn),h[f]=_,h},{});de.Syntax=SyntaxError,de.Type=TypeError,de.Range=RangeError;var lr=ur.reduce(function(h,f){return h[f+"Error"]=de[f],h},{}),ga=jt.reduce(function(h,f){return["Syntax","Type","Range"].indexOf(f)===-1&&(h[f+"Error"]=de[f]),h},{});function je(){}function cr(h){return h}function rw(h,f){return h==null||h===cr?f:function(m){return f(h(m))}}function gi(h,f){return function(){h.apply(this,arguments),f.apply(this,arguments)}}function ow(h,f){return h===je?f:function(){var m=h.apply(this,arguments);m!==void 0&&(arguments[0]=m);var _=this.onsuccess,v=this.onerror;this.onsuccess=null,this.onerror=null;var T=f.apply(this,arguments);return _&&(this.onsuccess=this.onsuccess?gi(_,this.onsuccess):_),v&&(this.onerror=this.onerror?gi(v,this.onerror):v),T!==void 0?T:m}}function aw(h,f){return h===je?f:function(){h.apply(this,arguments);var m=this.onsuccess,_=this.onerror;this.onsuccess=this.onerror=null,f.apply(this,arguments),m&&(this.onsuccess=this.onsuccess?gi(m,this.onsuccess):m),_&&(this.onerror=this.onerror?gi(_,this.onerror):_)}}function lw(h,f){return h===je?f:function(m){var _=h.apply(this,arguments);l(m,_);var v=this.onsuccess,T=this.onerror;return this.onsuccess=null,this.onerror=null,m=f.apply(this,arguments),v&&(this.onsuccess=this.onsuccess?gi(v,this.onsuccess):v),T&&(this.onerror=this.onerror?gi(T,this.onerror):T),_===void 0?m===void 0?void 0:m:l(_,m)}}function cw(h,f){return h===je?f:function(){return f.apply(this,arguments)!==!1&&h.apply(this,arguments)}}function Th(h,f){return h===je?f:function(){var m=h.apply(this,arguments);if(m&&typeof m.then=="function"){for(var _=this,v=arguments.length,T=new Array(v);v--;)T[v]=arguments[v];return m.then(function(){return f.apply(_,T)})}return f.apply(this,arguments)}}ga.ModifyError=bn,ga.DexieError=pt,ga.BulkError=wt;var rn=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ym(h){rn=h}var hr={},_m=100,Cn=typeof Promise>"u"?[]:function(){var h=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[h,c(h),h];var f=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[f,c(f),h]}(),ur=Cn[0],jt=Cn[1],Cn=Cn[2],jt=jt&&jt.then,dr=ur&&ur.constructor,$h=!!Cn,fr=function(h,f){pr.push([h,f]),ya&&(queueMicrotask(uw),ya=!1)},Dh=!0,ya=!0,yi=[],_a=[],Ih=cr,qn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:je,pgp:!1,env:{},finalize:je},ue=qn,pr=[],_i=0,va=[];function le(h){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var f=this._PSD=ue;if(typeof h!="function"){if(h!==hr)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Mh(this,this._value))}this._state=null,this._value=null,++f.ref,function m(_,v){try{v(function(T){if(_._state===null){if(T===_)throw new TypeError("A promise cannot be resolved with itself.");var $=_._lib&&ss();T&&typeof T.then=="function"?m(_,function(I,L){T instanceof le?T._then(I,L):T.then(I,L)}):(_._state=!0,_._value=T,bm(_)),$&&rs()}},Mh.bind(null,_))}catch(T){Mh(_,T)}}(this,h)}var Nh={get:function(){var h=ue,f=xa;function m(_,v){var T=this,$=!h.global&&(h!==ue||f!==xa),I=$&&!Yn(),L=new le(function(E,z){Eh(T,new vm(Cm(_,h,$,I),Cm(v,h,$,I),E,z,h))});return this._consoleTask&&(L._consoleTask=this._consoleTask),L}return m.prototype=hr,m},set:function(h){b(this,"then",h&&h.prototype===hr?Nh:{get:function(){return h},set:Nh.set})}};function vm(h,f,m,_,v){this.onFulfilled=typeof h=="function"?h:null,this.onRejected=typeof f=="function"?f:null,this.resolve=m,this.reject=_,this.psd=v}function Mh(h,f){var m,_;_a.push(f),h._state===null&&(m=h._lib&&ss(),f=Ih(f),h._state=!1,h._value=f,_=h,yi.some(function(v){return v._value===_._value})||yi.push(_),bm(h),m&&rs())}function bm(h){var f=h._listeners;h._listeners=[];for(var m=0,_=f.length;m<_;++m)Eh(h,f[m]);var v=h._PSD;--v.ref||v.finalize(),_i===0&&(++_i,fr(function(){--_i==0&&Ah()},[]))}function Eh(h,f){if(h._state!==null){var m=h._state?f.onFulfilled:f.onRejected;if(m===null)return(h._state?f.resolve:f.reject)(h._value);++f.psd.ref,++_i,fr(hw,[m,h,f])}else h._listeners.push(f)}function hw(h,f,m){try{var _,v=f._value;!f._state&&_a.length&&(_a=[]),_=rn&&f._consoleTask?f._consoleTask.run(function(){return h(v)}):h(v),f._state||_a.indexOf(v)!==-1||function(T){for(var $=yi.length;$;)if(yi[--$]._value===T._value)return yi.splice($,1)}(f),m.resolve(_)}catch(T){m.reject(T)}finally{--_i==0&&Ah(),--m.psd.ref||m.psd.finalize()}}function uw(){vi(qn,function(){ss()&&rs()})}function ss(){var h=Dh;return ya=Dh=!1,h}function rs(){var h,f,m;do for(;0<pr.length;)for(h=pr,pr=[],m=h.length,f=0;f<m;++f){var _=h[f];_[0].apply(null,_[1])}while(0<pr.length);ya=Dh=!0}function Ah(){var h=yi;yi=[],h.forEach(function(_){_._PSD.onunhandled.call(null,_._value,_)});for(var f=va.slice(0),m=f.length;m;)f[--m]()}function ba(h){return new le(hr,!1,h)}function qe(h,f){var m=ue;return function(){var _=ss(),v=ue;try{return Qn(m,!0),h.apply(this,arguments)}catch(T){f&&f(T)}finally{Qn(v,!1),_&&rs()}}}p(le.prototype,{then:Nh,_then:function(h,f){Eh(this,new vm(null,null,h,f,ue))},catch:function(h){if(arguments.length===1)return this.then(null,h);var f=h,m=arguments[1];return typeof f=="function"?this.then(null,function(_){return(_ instanceof f?m:ba)(_)}):this.then(null,function(_){return(_&&_.name===f?m:ba)(_)})},finally:function(h){return this.then(function(f){return le.resolve(h()).then(function(){return f})},function(f){return le.resolve(h()).then(function(){return ba(f)})})},timeout:function(h,f){var m=this;return h<1/0?new le(function(_,v){var T=setTimeout(function(){return v(new de.Timeout(f))},h);m.then(_,v).finally(clearTimeout.bind(null,T))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&b(le.prototype,Symbol.toStringTag,"Dexie.Promise"),qn.env=wm(),p(le,{all:function(){var h=ve.apply(null,arguments).map(ka);return new le(function(f,m){h.length===0&&f([]);var _=h.length;h.forEach(function(v,T){return le.resolve(v).then(function($){h[T]=$,--_||f(h)},m)})})},resolve:function(h){return h instanceof le?h:h&&typeof h.then=="function"?new le(function(f,m){h.then(f,m)}):new le(hr,!0,h)},reject:ba,race:function(){var h=ve.apply(null,arguments).map(ka);return new le(function(f,m){h.map(function(_){return le.resolve(_).then(f,m)})})},PSD:{get:function(){return ue},set:function(h){return ue=h}},totalEchoes:{get:function(){return xa}},newPSD:Gn,usePSD:vi,scheduler:{get:function(){return fr},set:function(h){fr=h}},rejectionMapper:{get:function(){return Ih},set:function(h){Ih=h}},follow:function(h,f){return new le(function(m,_){return Gn(function(v,T){var $=ue;$.unhandleds=[],$.onunhandled=T,$.finalize=gi(function(){var I,L=this;I=function(){L.unhandleds.length===0?v():T(L.unhandleds[0])},va.push(function E(){I(),va.splice(va.indexOf(E),1)}),++_i,fr(function(){--_i==0&&Ah()},[])},$.finalize),h()},f,m,_)})}}),dr&&(dr.allSettled&&b(le,"allSettled",function(){var h=ve.apply(null,arguments).map(ka);return new le(function(f){h.length===0&&f([]);var m=h.length,_=new Array(m);h.forEach(function(v,T){return le.resolve(v).then(function($){return _[T]={status:"fulfilled",value:$}},function($){return _[T]={status:"rejected",reason:$}}).then(function(){return--m||f(_)})})})}),dr.any&&typeof AggregateError<"u"&&b(le,"any",function(){var h=ve.apply(null,arguments).map(ka);return new le(function(f,m){h.length===0&&m(new AggregateError([]));var _=h.length,v=new Array(_);h.forEach(function(T,$){return le.resolve(T).then(function(I){return f(I)},function(I){v[$]=I,--_||m(new AggregateError(v))})})})}));var at={awaits:0,echoes:0,id:0},dw=0,wa=[],Ca=0,xa=0,fw=0;function Gn(h,f,m,_){var v=ue,T=Object.create(v);return T.parent=v,T.ref=0,T.global=!1,T.id=++fw,qn.env,T.env=$h?{Promise:le,PromiseProp:{value:le,configurable:!0,writable:!0},all:le.all,race:le.race,allSettled:le.allSettled,any:le.any,resolve:le.resolve,reject:le.reject}:{},f&&l(T,f),++v.ref,T.finalize=function(){--this.parent.ref||this.parent.finalize()},_=vi(T,h,m,_),T.ref===0&&T.finalize(),_}function os(){return at.id||(at.id=++dw),++at.awaits,at.echoes+=_m,at.id}function Yn(){return!!at.awaits&&(--at.awaits==0&&(at.id=0),at.echoes=at.awaits*_m,!0)}function ka(h){return at.echoes&&h&&h.constructor===dr?(os(),h.then(function(f){return Yn(),f},function(f){return Yn(),Ye(f)})):h}function pw(){var h=wa[wa.length-1];wa.pop(),Qn(h,!1)}function Qn(h,f){var m,_=ue;(f?!at.echoes||Ca++&&h===ue:!Ca||--Ca&&h===ue)||queueMicrotask(f?(function(v){++xa,at.echoes&&--at.echoes!=0||(at.echoes=at.awaits=at.id=0),wa.push(ue),Qn(v,!0)}).bind(null,h):pw),h!==ue&&(ue=h,_===qn&&(qn.env=wm()),$h&&(m=qn.env.Promise,f=h.env,(_.global||h.global)&&(Object.defineProperty(r,"Promise",f.PromiseProp),m.all=f.all,m.race=f.race,m.resolve=f.resolve,m.reject=f.reject,f.allSettled&&(m.allSettled=f.allSettled),f.any&&(m.any=f.any))))}function wm(){var h=r.Promise;return $h?{Promise:h,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:h.all,race:h.race,allSettled:h.allSettled,any:h.any,resolve:h.resolve,reject:h.reject}:{}}function vi(h,f,m,_,v){var T=ue;try{return Qn(h,!0),f(m,_,v)}finally{Qn(T,!1)}}function Cm(h,f,m,_){return typeof h!="function"?h:function(){var v=ue;m&&os(),Qn(f,!0);try{return h.apply(this,arguments)}finally{Qn(v,!1),_&&queueMicrotask(Yn)}}}function Ph(h){Promise===dr&&at.echoes===0?Ca===0?h():enqueueNativeMicroTask(h):setTimeout(h,0)}(""+jt).indexOf("[native code]")===-1&&(os=Yn=je);var Ye=le.reject,bi=String.fromCharCode(65535),wn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xm="String expected.",as=[],Sa="__dbnames",Lh="readonly",Rh="readwrite";function wi(h,f){return h?f?function(){return h.apply(this,arguments)&&f.apply(this,arguments)}:h:f}var km={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ta(h){return typeof h!="string"||/\./.test(h)?function(f){return f}:function(f){return f[h]===void 0&&h in f&&delete(f=ge(f))[h],f}}function Sm(){throw de.Type()}function Le(h,f){try{var m=Tm(h),_=Tm(f);if(m!==_)return m==="Array"?1:_==="Array"?-1:m==="binary"?1:_==="binary"?-1:m==="string"?1:_==="string"?-1:m==="Date"?1:_!=="Date"?NaN:-1;switch(m){case"number":case"Date":case"string":return f<h?1:h<f?-1:0;case"binary":return function(v,T){for(var $=v.length,I=T.length,L=$<I?$:I,E=0;E<L;++E)if(v[E]!==T[E])return v[E]<T[E]?-1:1;return $===I?0:$<I?-1:1}($m(h),$m(f));case"Array":return function(v,T){for(var $=v.length,I=T.length,L=$<I?$:I,E=0;E<L;++E){var z=Le(v[E],T[E]);if(z!==0)return z}return $===I?0:$<I?-1:1}(h,f)}}catch{}return NaN}function Tm(h){var f=typeof h;return f!="object"?f:ArrayBuffer.isView(h)?"binary":(h=Me(h),h==="ArrayBuffer"?"binary":h)}function $m(h){return h instanceof Uint8Array?h:ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):new Uint8Array(h)}var Dm=(Ve.prototype._trans=function(h,f,m){var _=this._tx||ue.trans,v=this.name,T=rn&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(h==="readonly"?"read":"write"," ").concat(this.name));function $(E,z,M){if(!M.schema[v])throw new de.NotFound("Table "+v+" not part of transaction");return f(M.idbtrans,M)}var I=ss();try{var L=_&&_.db._novip===this.db._novip?_===ue.trans?_._promise(h,$,m):Gn(function(){return _._promise(h,$,m)},{trans:_,transless:ue.transless||ue}):function E(z,M,F,P){if(z.idbdb&&(z._state.openComplete||ue.letThrough||z._vip)){var O=z._createTransaction(M,F,z._dbSchema);try{O.create(),z._state.PR1398_maxLoop=3}catch(j){return j.name===Kn.InvalidState&&z.isOpen()&&0<--z._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),z.close({disableAutoOpen:!1}),z.open().then(function(){return E(z,M,F,P)})):Ye(j)}return O._promise(M,function(j,R){return Gn(function(){return ue.trans=O,P(j,R,O)})}).then(function(j){if(M==="readwrite")try{O.idbtrans.commit()}catch{}return M==="readonly"?j:O._completion.then(function(){return j})})}if(z._state.openComplete)return Ye(new de.DatabaseClosed(z._state.dbOpenError));if(!z._state.isBeingOpened){if(!z._state.autoOpen)return Ye(new de.DatabaseClosed);z.open().catch(je)}return z._state.dbReadyPromise.then(function(){return E(z,M,F,P)})}(this.db,h,[this.name],$);return T&&(L._consoleTask=T,L=L.catch(function(E){return console.trace(E),Ye(E)})),L}finally{I&&rs()}},Ve.prototype.get=function(h,f){var m=this;return h&&h.constructor===Object?this.where(h).first(f):h==null?Ye(new de.Type("Invalid argument to Table.get()")):this._trans("readonly",function(_){return m.core.get({trans:_,key:h}).then(function(v){return m.hook.reading.fire(v)})}).then(f)},Ve.prototype.where=function(h){if(typeof h=="string")return new this.db.WhereClause(this,h);if(a(h))return new this.db.WhereClause(this,"[".concat(h.join("+"),"]"));var f=o(h);if(f.length===1)return this.where(f[0]).equals(h[f[0]]);var m=this.schema.indexes.concat(this.schema.primKey).filter(function(L){if(L.compound&&f.every(function(z){return 0<=L.keyPath.indexOf(z)})){for(var E=0;E<f.length;++E)if(f.indexOf(L.keyPath[E])===-1)return!1;return!0}return!1}).sort(function(L,E){return L.keyPath.length-E.keyPath.length})[0];if(m&&this.db._maxKey!==bi){var $=m.keyPath.slice(0,f.length);return this.where($).equals($.map(function(E){return h[E]}))}!m&&rn&&console.warn("The query ".concat(JSON.stringify(h)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(f.join("+"),"]"));var _=this.schema.idxByName,v=this.db._deps.indexedDB;function T(L,E){return v.cmp(L,E)===0}var I=f.reduce(function(F,E){var z=F[0],M=F[1],F=_[E],P=h[E];return[z||F,z||!F?wi(M,F&&F.multi?function(O){return O=G(O,E),a(O)&&O.some(function(j){return T(P,j)})}:function(O){return T(P,G(O,E))}):M]},[null,null]),$=I[0],I=I[1];return $?this.where($.name).equals(h[$.keyPath]).filter(I):m?this.filter(I):this.where(f).equals("")},Ve.prototype.filter=function(h){return this.toCollection().and(h)},Ve.prototype.count=function(h){return this.toCollection().count(h)},Ve.prototype.offset=function(h){return this.toCollection().offset(h)},Ve.prototype.limit=function(h){return this.toCollection().limit(h)},Ve.prototype.each=function(h){return this.toCollection().each(h)},Ve.prototype.toArray=function(h){return this.toCollection().toArray(h)},Ve.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ve.prototype.orderBy=function(h){return new this.db.Collection(new this.db.WhereClause(this,a(h)?"[".concat(h.join("+"),"]"):h))},Ve.prototype.reverse=function(){return this.toCollection().reverse()},Ve.prototype.mapToClass=function(h){var f,m=this.db,_=this.name;function v(){return f!==null&&f.apply(this,arguments)||this}(this.schema.mappedClass=h).prototype instanceof Sm&&(function(L,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");function z(){this.constructor=L}t(L,E),L.prototype=E===null?Object.create(E):(z.prototype=E.prototype,new z)}(v,f=h),Object.defineProperty(v.prototype,"db",{get:function(){return m},enumerable:!1,configurable:!0}),v.prototype.table=function(){return _},h=v);for(var T=new Set,$=h.prototype;$;$=c($))Object.getOwnPropertyNames($).forEach(function(L){return T.add(L)});function I(L){if(!L)return L;var E,z=Object.create(h.prototype);for(E in L)if(!T.has(E))try{z[E]=L[E]}catch{}return z}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=I,this.hook("reading",I),h},Ve.prototype.defineClass=function(){return this.mapToClass(function(h){l(this,h)})},Ve.prototype.add=function(h,f){var m=this,_=this.schema.primKey,v=_.auto,T=_.keyPath,$=h;return T&&v&&($=Ta(T)(h)),this._trans("readwrite",function(I){return m.core.mutate({trans:I,type:"add",keys:f!=null?[f]:null,values:[$]})}).then(function(I){return I.numFailures?le.reject(I.failures[0]):I.lastResult}).then(function(I){if(T)try{Y(h,T,I)}catch{}return I})},Ve.prototype.update=function(h,f){return typeof h!="object"||a(h)?this.where(":id").equals(h).modify(f):(h=G(h,this.schema.primKey.keyPath),h===void 0?Ye(new de.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(h).modify(f))},Ve.prototype.put=function(h,f){var m=this,_=this.schema.primKey,v=_.auto,T=_.keyPath,$=h;return T&&v&&($=Ta(T)(h)),this._trans("readwrite",function(I){return m.core.mutate({trans:I,type:"put",values:[$],keys:f!=null?[f]:null})}).then(function(I){return I.numFailures?le.reject(I.failures[0]):I.lastResult}).then(function(I){if(T)try{Y(h,T,I)}catch{}return I})},Ve.prototype.delete=function(h){var f=this;return this._trans("readwrite",function(m){return f.core.mutate({trans:m,type:"delete",keys:[h]})}).then(function(m){return m.numFailures?le.reject(m.failures[0]):void 0})},Ve.prototype.clear=function(){var h=this;return this._trans("readwrite",function(f){return h.core.mutate({trans:f,type:"deleteRange",range:km})}).then(function(f){return f.numFailures?le.reject(f.failures[0]):void 0})},Ve.prototype.bulkGet=function(h){var f=this;return this._trans("readonly",function(m){return f.core.getMany({keys:h,trans:m}).then(function(_){return _.map(function(v){return f.hook.reading.fire(v)})})})},Ve.prototype.bulkAdd=function(h,f,m){var _=this,v=Array.isArray(f)?f:void 0,T=(m=m||(v?void 0:f))?m.allKeys:void 0;return this._trans("readwrite",function($){var E=_.schema.primKey,I=E.auto,E=E.keyPath;if(E&&v)throw new de.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==h.length)throw new de.InvalidArgument("Arguments objects and keys must have the same length");var L=h.length,E=E&&I?h.map(Ta(E)):h;return _.core.mutate({trans:$,type:"add",keys:v,values:E,wantResults:T}).then(function(O){var M=O.numFailures,F=O.results,P=O.lastResult,O=O.failures;if(M===0)return T?F:P;throw new wt("".concat(_.name,".bulkAdd(): ").concat(M," of ").concat(L," operations failed"),O)})})},Ve.prototype.bulkPut=function(h,f,m){var _=this,v=Array.isArray(f)?f:void 0,T=(m=m||(v?void 0:f))?m.allKeys:void 0;return this._trans("readwrite",function($){var E=_.schema.primKey,I=E.auto,E=E.keyPath;if(E&&v)throw new de.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==h.length)throw new de.InvalidArgument("Arguments objects and keys must have the same length");var L=h.length,E=E&&I?h.map(Ta(E)):h;return _.core.mutate({trans:$,type:"put",keys:v,values:E,wantResults:T}).then(function(O){var M=O.numFailures,F=O.results,P=O.lastResult,O=O.failures;if(M===0)return T?F:P;throw new wt("".concat(_.name,".bulkPut(): ").concat(M," of ").concat(L," operations failed"),O)})})},Ve.prototype.bulkUpdate=function(h){var f=this,m=this.core,_=h.map(function($){return $.key}),v=h.map(function($){return $.changes}),T=[];return this._trans("readwrite",function($){return m.getMany({trans:$,keys:_,cache:"clone"}).then(function(I){var L=[],E=[];h.forEach(function(M,F){var P=M.key,O=M.changes,j=I[F];if(j){for(var R=0,W=Object.keys(O);R<W.length;R++){var U=W[R],K=O[U];if(U===f.schema.primKey.keyPath){if(Le(K,P)!==0)throw new de.Constraint("Cannot update primary key in bulkUpdate()")}else Y(j,U,K)}T.push(F),L.push(P),E.push(j)}});var z=L.length;return m.mutate({trans:$,type:"put",keys:L,values:E,updates:{keys:_,changeSpecs:v}}).then(function(M){var F=M.numFailures,P=M.failures;if(F===0)return z;for(var O=0,j=Object.keys(P);O<j.length;O++){var R,W=j[O],U=T[Number(W)];U!=null&&(R=P[W],delete P[W],P[U]=R)}throw new wt("".concat(f.name,".bulkUpdate(): ").concat(F," of ").concat(z," operations failed"),P)})})})},Ve.prototype.bulkDelete=function(h){var f=this,m=h.length;return this._trans("readwrite",function(_){return f.core.mutate({trans:_,type:"delete",keys:h})}).then(function($){var v=$.numFailures,T=$.lastResult,$=$.failures;if(v===0)return T;throw new wt("".concat(f.name,".bulkDelete(): ").concat(v," of ").concat(m," operations failed"),$)})},Ve);function Ve(){}function mr(h){function f($,I){if(I){for(var L=arguments.length,E=new Array(L-1);--L;)E[L-1]=arguments[L];return m[$].subscribe.apply(null,E),h}if(typeof $=="string")return m[$]}var m={};f.addEventType=T;for(var _=1,v=arguments.length;_<v;++_)T(arguments[_]);return f;function T($,I,L){if(typeof $!="object"){var E;I=I||cw;var z={subscribers:[],fire:L=L||je,subscribe:function(M){z.subscribers.indexOf(M)===-1&&(z.subscribers.push(M),z.fire=I(z.fire,M))},unsubscribe:function(M){z.subscribers=z.subscribers.filter(function(F){return F!==M}),z.fire=z.subscribers.reduce(I,L)}};return m[$]=f[$]=z}o(E=$).forEach(function(M){var F=E[M];if(a(F))T(M,E[M][0],E[M][1]);else{if(F!=="asap")throw new de.InvalidArgument("Invalid event config");var P=T(M,cr,function(){for(var O=arguments.length,j=new Array(O);O--;)j[O]=arguments[O];P.subscribers.forEach(function(R){H(function(){R.apply(null,j)})})})}})}}function gr(h,f){return C(f).from({prototype:h}),f}function ls(h,f){return!(h.filter||h.algorithm||h.or)&&(f?h.justLimit:!h.replayFilter)}function Oh(h,f){h.filter=wi(h.filter,f)}function zh(h,f,m){var _=h.replayFilter;h.replayFilter=_?function(){return wi(_(),f())}:f,h.justLimit=m&&!_}function $a(h,f){if(h.isPrimKey)return f.primaryKey;var m=f.getIndexByKeyPath(h.index);if(!m)throw new de.Schema("KeyPath "+h.index+" on object store "+f.name+" is not indexed");return m}function Im(h,f,m){var _=$a(h,f.schema);return f.openCursor({trans:m,values:!h.keysOnly,reverse:h.dir==="prev",unique:!!h.unique,query:{index:_,range:h.range}})}function Da(h,f,m,_){var v=h.replayFilter?wi(h.filter,h.replayFilter()):h.filter;if(h.or){var T={},$=function(I,L,E){var z,M;v&&!v(L,E,function(F){return L.stop(F)},function(F){return L.fail(F)})||((M=""+(z=L.primaryKey))=="[object ArrayBuffer]"&&(M=""+new Uint8Array(z)),u(T,M)||(T[M]=!0,f(I,L,E)))};return Promise.all([h.or._iterate($,m),Nm(Im(h,_,m),h.algorithm,$,!h.keysOnly&&h.valueMapper)])}return Nm(Im(h,_,m),wi(h.algorithm,v),f,!h.keysOnly&&h.valueMapper)}function Nm(h,f,m,_){var v=qe(_?function(T,$,I){return m(_(T),$,I)}:m);return h.then(function(T){if(T)return T.start(function(){var $=function(){return T.continue()};f&&!f(T,function(I){return $=I},function(I){T.stop(I),$=je},function(I){T.fail(I),$=je})||v(T.value,T,function(I){return $=I}),$()})})}var Cn=Symbol(),Fh=(Mm.prototype.execute=function(h){var f=(f=this.replacePrefix)===null||f===void 0?void 0:f[0];return f&&typeof h=="string"&&h.startsWith(f)?this.replacePrefix[1]+h.substring(f.length):h},Mm);function Mm(h){Object.assign(this,h)}var mw=(Ae.prototype._read=function(h,f){var m=this._ctx;return m.error?m.table._trans(null,Ye.bind(null,m.error)):m.table._trans("readonly",h).then(f)},Ae.prototype._write=function(h){var f=this._ctx;return f.error?f.table._trans(null,Ye.bind(null,f.error)):f.table._trans("readwrite",h,"locked")},Ae.prototype._addAlgorithm=function(h){var f=this._ctx;f.algorithm=wi(f.algorithm,h)},Ae.prototype._iterate=function(h,f){return Da(this._ctx,h,f,this._ctx.table.core)},Ae.prototype.clone=function(h){var f=Object.create(this.constructor.prototype),m=Object.create(this._ctx);return h&&l(m,h),f._ctx=m,f},Ae.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ae.prototype.each=function(h){var f=this._ctx;return this._read(function(m){return Da(f,h,m,f.table.core)})},Ae.prototype.count=function(h){var f=this;return this._read(function(m){var _=f._ctx,v=_.table.core;if(ls(_,!0))return v.count({trans:m,query:{index:$a(_,v.schema),range:_.range}}).then(function($){return Math.min($,_.limit)});var T=0;return Da(_,function(){return++T,!1},m,v).then(function(){return T})}).then(h)},Ae.prototype.sortBy=function(h,f){var m=h.split(".").reverse(),_=m[0],v=m.length-1;function T(L,E){return E?T(L[m[E]],E-1):L[_]}var $=this._ctx.dir==="next"?1:-1;function I(L,E){return L=T(L,v),E=T(E,v),L<E?-$:E<L?$:0}return this.toArray(function(L){return L.sort(I)}).then(f)},Ae.prototype.toArray=function(h){var f=this;return this._read(function(m){var _=f._ctx;if(_.dir==="next"&&ls(_,!0)&&0<_.limit){var v=_.valueMapper,T=$a(_,_.table.core.schema);return _.table.core.query({trans:m,limit:_.limit,values:!0,query:{index:T,range:_.range}}).then(function(I){return I=I.result,v?I.map(v):I})}var $=[];return Da(_,function(I){return $.push(I)},m,_.table.core).then(function(){return $})},h)},Ae.prototype.offset=function(h){var f=this._ctx;return h<=0||(f.offset+=h,ls(f)?zh(f,function(){var m=h;return function(_,v){return m===0||(m===1?--m:v(function(){_.advance(m),m=0}),!1)}}):zh(f,function(){var m=h;return function(){return--m<0}})),this},Ae.prototype.limit=function(h){return this._ctx.limit=Math.min(this._ctx.limit,h),zh(this._ctx,function(){var f=h;return function(m,_,v){return--f<=0&&_(v),0<=f}},!0),this},Ae.prototype.until=function(h,f){return Oh(this._ctx,function(m,_,v){return!h(m.value)||(_(v),f)}),this},Ae.prototype.first=function(h){return this.limit(1).toArray(function(f){return f[0]}).then(h)},Ae.prototype.last=function(h){return this.reverse().first(h)},Ae.prototype.filter=function(h){var f;return Oh(this._ctx,function(m){return h(m.value)}),(f=this._ctx).isMatch=wi(f.isMatch,h),this},Ae.prototype.and=function(h){return this.filter(h)},Ae.prototype.or=function(h){return new this.db.WhereClause(this._ctx.table,h,this)},Ae.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ae.prototype.desc=function(){return this.reverse()},Ae.prototype.eachKey=function(h){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(m,_){h(_.key,_)})},Ae.prototype.eachUniqueKey=function(h){return this._ctx.unique="unique",this.eachKey(h)},Ae.prototype.eachPrimaryKey=function(h){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(m,_){h(_.primaryKey,_)})},Ae.prototype.keys=function(h){var f=this._ctx;f.keysOnly=!f.isMatch;var m=[];return this.each(function(_,v){m.push(v.key)}).then(function(){return m}).then(h)},Ae.prototype.primaryKeys=function(h){var f=this._ctx;if(f.dir==="next"&&ls(f,!0)&&0<f.limit)return this._read(function(_){var v=$a(f,f.table.core.schema);return f.table.core.query({trans:_,values:!1,limit:f.limit,query:{index:v,range:f.range}})}).then(function(_){return _.result}).then(h);f.keysOnly=!f.isMatch;var m=[];return this.each(function(_,v){m.push(v.primaryKey)}).then(function(){return m}).then(h)},Ae.prototype.uniqueKeys=function(h){return this._ctx.unique="unique",this.keys(h)},Ae.prototype.firstKey=function(h){return this.limit(1).keys(function(f){return f[0]}).then(h)},Ae.prototype.lastKey=function(h){return this.reverse().firstKey(h)},Ae.prototype.distinct=function(){var h=this._ctx,h=h.index&&h.table.schema.idxByName[h.index];if(!h||!h.multi)return this;var f={};return Oh(this._ctx,function(v){var _=v.primaryKey.toString(),v=u(f,_);return f[_]=!0,!v}),this},Ae.prototype.modify=function(h){var f=this,m=this._ctx;return this._write(function(_){var v,T,$;$=typeof h=="function"?h:(v=o(h),T=v.length,function(R){for(var W=!1,U=0;U<T;++U){var K=v[U],q=h[K],Q=G(R,K);q instanceof Fh?(Y(R,K,q.execute(Q)),W=!0):Q!==q&&(Y(R,K,q),W=!0)}return W});function I(R,K){var U=K.failures,K=K.numFailures;O+=R-K;for(var q=0,Q=o(U);q<Q.length;q++){var re=Q[q];P.push(U[re])}}var L=m.table.core,E=L.schema.primaryKey,z=E.outbound,M=E.extractKey,F=f.db._options.modifyChunkSize||200,P=[],O=0,j=[];return f.clone().primaryKeys().then(function(R){function W(U){var K=Math.min(F,R.length-U);return L.getMany({trans:_,keys:R.slice(U,U+K),cache:"immutable"}).then(function(q){for(var Q=[],re=[],te=z?[]:null,ne=[],oe=0;oe<K;++oe){var ae=q[oe],ye={value:ge(ae),primKey:R[U+oe]};$.call(ye,ye.value,ye)!==!1&&(ye.value==null?ne.push(R[U+oe]):z||Le(M(ae),M(ye.value))===0?(re.push(ye.value),z&&te.push(R[U+oe])):(ne.push(R[U+oe]),Q.push(ye.value)))}var Se=ls(m)&&m.limit===1/0&&(typeof h!="function"||h===jh)&&{index:m.index,range:m.range};return Promise.resolve(0<Q.length&&L.mutate({trans:_,type:"add",values:Q}).then(function(De){for(var Te in De.failures)ne.splice(parseInt(Te),1);I(Q.length,De)})).then(function(){return(0<re.length||Se&&typeof h=="object")&&L.mutate({trans:_,type:"put",keys:te,values:re,criteria:Se,changeSpec:typeof h!="function"&&h}).then(function(De){return I(re.length,De)})}).then(function(){return(0<ne.length||Se&&h===jh)&&L.mutate({trans:_,type:"delete",keys:ne,criteria:Se}).then(function(De){return I(ne.length,De)})}).then(function(){return R.length>U+K&&W(U+F)})})}return W(0).then(function(){if(0<P.length)throw new bn("Error modifying one or more objects",P,O,j);return R.length})})})},Ae.prototype.delete=function(){var h=this._ctx,f=h.range;return ls(h)&&(h.isPrimKey||f.type===3)?this._write(function(m){var _=h.table.core.schema.primaryKey,v=f;return h.table.core.count({trans:m,query:{index:_,range:v}}).then(function(T){return h.table.core.mutate({trans:m,type:"deleteRange",range:v}).then(function($){var I=$.failures;if($.lastResult,$.results,$=$.numFailures,$)throw new bn("Could not delete some values",Object.keys(I).map(function(L){return I[L]}),T-$);return T-$})})}):this.modify(jh)},Ae);function Ae(){}var jh=function(h,f){return f.value=null};function gw(h,f){return h<f?-1:h===f?0:1}function yw(h,f){return f<h?-1:h===f?0:1}function Rt(h,f,m){return h=h instanceof Am?new h.Collection(h):h,h._ctx.error=new(m||TypeError)(f),h}function cs(h){return new h.Collection(h,function(){return Em("")}).limit(0)}function Ia(h,f,m,_){var v,T,$,I,L,E,z,M=m.length;if(!m.every(function(O){return typeof O=="string"}))return Rt(h,xm);function F(O){v=O==="next"?function(R){return R.toUpperCase()}:function(R){return R.toLowerCase()},T=O==="next"?function(R){return R.toLowerCase()}:function(R){return R.toUpperCase()},$=O==="next"?gw:yw;var j=m.map(function(R){return{lower:T(R),upper:v(R)}}).sort(function(R,W){return $(R.lower,W.lower)});I=j.map(function(R){return R.upper}),L=j.map(function(R){return R.lower}),z=(E=O)==="next"?"":_}F("next"),h=new h.Collection(h,function(){return Xn(I[0],L[M-1]+_)}),h._ondirectionchange=function(O){F(O)};var P=0;return h._addAlgorithm(function(O,j,R){var W=O.key;if(typeof W!="string")return!1;var U=T(W);if(f(U,L,P))return!0;for(var K=null,q=P;q<M;++q){var Q=function(re,te,ne,oe,ae,ye){for(var Se=Math.min(re.length,oe.length),De=-1,Te=0;Te<Se;++Te){var Gt=te[Te];if(Gt!==oe[Te])return ae(re[Te],ne[Te])<0?re.substr(0,Te)+ne[Te]+ne.substr(Te+1):ae(re[Te],oe[Te])<0?re.substr(0,Te)+oe[Te]+ne.substr(Te+1):0<=De?re.substr(0,De)+te[De]+ne.substr(De+1):null;ae(re[Te],Gt)<0&&(De=Te)}return Se<oe.length&&ye==="next"?re+ne.substr(re.length):Se<re.length&&ye==="prev"?re.substr(0,ne.length):De<0?null:re.substr(0,De)+oe[De]+ne.substr(De+1)}(W,U,I[q],L[q],$,E);Q===null&&K===null?P=q+1:(K===null||0<$(K,Q))&&(K=Q)}return j(K!==null?function(){O.continue(K+z)}:R),!1}),h}function Xn(h,f,m,_){return{type:2,lower:h,upper:f,lowerOpen:m,upperOpen:_}}function Em(h){return{type:1,lower:h,upper:h}}var Am=(Object.defineProperty(lt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),lt.prototype.between=function(h,f,m,_){m=m!==!1,_=_===!0;try{return 0<this._cmp(h,f)||this._cmp(h,f)===0&&(m||_)&&(!m||!_)?cs(this):new this.Collection(this,function(){return Xn(h,f,!m,!_)})}catch{return Rt(this,wn)}},lt.prototype.equals=function(h){return h==null?Rt(this,wn):new this.Collection(this,function(){return Em(h)})},lt.prototype.above=function(h){return h==null?Rt(this,wn):new this.Collection(this,function(){return Xn(h,void 0,!0)})},lt.prototype.aboveOrEqual=function(h){return h==null?Rt(this,wn):new this.Collection(this,function(){return Xn(h,void 0,!1)})},lt.prototype.below=function(h){return h==null?Rt(this,wn):new this.Collection(this,function(){return Xn(void 0,h,!1,!0)})},lt.prototype.belowOrEqual=function(h){return h==null?Rt(this,wn):new this.Collection(this,function(){return Xn(void 0,h)})},lt.prototype.startsWith=function(h){return typeof h!="string"?Rt(this,xm):this.between(h,h+bi,!0,!0)},lt.prototype.startsWithIgnoreCase=function(h){return h===""?this.startsWith(h):Ia(this,function(f,m){return f.indexOf(m[0])===0},[h],bi)},lt.prototype.equalsIgnoreCase=function(h){return Ia(this,function(f,m){return f===m[0]},[h],"")},lt.prototype.anyOfIgnoreCase=function(){var h=ve.apply(we,arguments);return h.length===0?cs(this):Ia(this,function(f,m){return m.indexOf(f)!==-1},h,"")},lt.prototype.startsWithAnyOfIgnoreCase=function(){var h=ve.apply(we,arguments);return h.length===0?cs(this):Ia(this,function(f,m){return m.some(function(_){return f.indexOf(_)===0})},h,bi)},lt.prototype.anyOf=function(){var h=this,f=ve.apply(we,arguments),m=this._cmp;try{f.sort(m)}catch{return Rt(this,wn)}if(f.length===0)return cs(this);var _=new this.Collection(this,function(){return Xn(f[0],f[f.length-1])});_._ondirectionchange=function(T){m=T==="next"?h._ascending:h._descending,f.sort(m)};var v=0;return _._addAlgorithm(function(T,$,I){for(var L=T.key;0<m(L,f[v]);)if(++v===f.length)return $(I),!1;return m(L,f[v])===0||($(function(){T.continue(f[v])}),!1)}),_},lt.prototype.notEqual=function(h){return this.inAnyRange([[-1/0,h],[h,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},lt.prototype.noneOf=function(){var h=ve.apply(we,arguments);if(h.length===0)return new this.Collection(this);try{h.sort(this._ascending)}catch{return Rt(this,wn)}var f=h.reduce(function(m,_){return m?m.concat([[m[m.length-1][1],_]]):[[-1/0,_]]},null);return f.push([h[h.length-1],this.db._maxKey]),this.inAnyRange(f,{includeLowers:!1,includeUppers:!1})},lt.prototype.inAnyRange=function(W,f){var m=this,_=this._cmp,v=this._ascending,T=this._descending,$=this._min,I=this._max;if(W.length===0)return cs(this);if(!W.every(function(U){return U[0]!==void 0&&U[1]!==void 0&&v(U[0],U[1])<=0}))return Rt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",de.InvalidArgument);var L=!f||f.includeLowers!==!1,E=f&&f.includeUppers===!0,z,M=v;function F(U,K){return M(U[0],K[0])}try{(z=W.reduce(function(U,K){for(var q=0,Q=U.length;q<Q;++q){var re=U[q];if(_(K[0],re[1])<0&&0<_(K[1],re[0])){re[0]=$(re[0],K[0]),re[1]=I(re[1],K[1]);break}}return q===Q&&U.push(K),U},[])).sort(F)}catch{return Rt(this,wn)}var P=0,O=E?function(U){return 0<v(U,z[P][1])}:function(U){return 0<=v(U,z[P][1])},j=L?function(U){return 0<T(U,z[P][0])}:function(U){return 0<=T(U,z[P][0])},R=O,W=new this.Collection(this,function(){return Xn(z[0][0],z[z.length-1][1],!L,!E)});return W._ondirectionchange=function(U){M=U==="next"?(R=O,v):(R=j,T),z.sort(F)},W._addAlgorithm(function(U,K,q){for(var Q,re=U.key;R(re);)if(++P===z.length)return K(q),!1;return!O(Q=re)&&!j(Q)||(m._cmp(re,z[P][1])===0||m._cmp(re,z[P][0])===0||K(function(){M===v?U.continue(z[P][0]):U.continue(z[P][1])}),!1)}),W},lt.prototype.startsWithAnyOf=function(){var h=ve.apply(we,arguments);return h.every(function(f){return typeof f=="string"})?h.length===0?cs(this):this.inAnyRange(h.map(function(f){return[f,f+bi]})):Rt(this,"startsWithAnyOf() only works with strings")},lt);function lt(){}function on(h){return qe(function(f){return yr(f),h(f.target.error),!1})}function yr(h){h.stopPropagation&&h.stopPropagation(),h.preventDefault&&h.preventDefault()}var _r="storagemutated",Bh="x-storagemutated-1",Zn=mr(null,_r),_w=(an.prototype._lock=function(){return B(!ue.global),++this._reculock,this._reculock!==1||ue.global||(ue.lockOwnerFor=this),this},an.prototype._unlock=function(){if(B(!ue.global),--this._reculock==0)for(ue.global||(ue.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var h=this._blockedFuncs.shift();try{vi(h[1],h[0])}catch{}}return this},an.prototype._locked=function(){return this._reculock&&ue.lockOwnerFor!==this},an.prototype.create=function(h){var f=this;if(!this.mode)return this;var m=this.db.idbdb,_=this.db._state.dbOpenError;if(B(!this.idbtrans),!h&&!m)switch(_&&_.name){case"DatabaseClosedError":throw new de.DatabaseClosed(_);case"MissingAPIError":throw new de.MissingAPI(_.message,_);default:throw new de.OpenFailed(_)}if(!this.active)throw new de.TransactionInactive;return B(this._completion._state===null),(h=this.idbtrans=h||(this.db.core||m).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=qe(function(v){yr(v),f._reject(h.error)}),h.onabort=qe(function(v){yr(v),f.active&&f._reject(new de.Abort(h.error)),f.active=!1,f.on("abort").fire(v)}),h.oncomplete=qe(function(){f.active=!1,f._resolve(),"mutatedParts"in h&&Zn.storagemutated.fire(h.mutatedParts)}),this},an.prototype._promise=function(h,f,m){var _=this;if(h==="readwrite"&&this.mode!=="readwrite")return Ye(new de.ReadOnly("Transaction is readonly"));if(!this.active)return Ye(new de.TransactionInactive);if(this._locked())return new le(function(T,$){_._blockedFuncs.push([function(){_._promise(h,f,m).then(T,$)},ue])});if(m)return Gn(function(){var T=new le(function($,I){_._lock();var L=f($,I,_);L&&L.then&&L.then($,I)});return T.finally(function(){return _._unlock()}),T._lib=!0,T});var v=new le(function(T,$){var I=f(T,$,_);I&&I.then&&I.then(T,$)});return v._lib=!0,v},an.prototype._root=function(){return this.parent?this.parent._root():this},an.prototype.waitFor=function(h){var f,m=this._root(),_=le.resolve(h);m._waitingFor?m._waitingFor=m._waitingFor.then(function(){return _}):(m._waitingFor=_,m._waitingQueue=[],f=m.idbtrans.objectStore(m.storeNames[0]),function T(){for(++m._spinCount;m._waitingQueue.length;)m._waitingQueue.shift()();m._waitingFor&&(f.get(-1/0).onsuccess=T)}());var v=m._waitingFor;return new le(function(T,$){_.then(function(I){return m._waitingQueue.push(qe(T.bind(null,I)))},function(I){return m._waitingQueue.push(qe($.bind(null,I)))}).finally(function(){m._waitingFor===v&&(m._waitingFor=null)})})},an.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new de.Abort))},an.prototype.table=function(h){var f=this._memoizedTables||(this._memoizedTables={});if(u(f,h))return f[h];var m=this.schema[h];if(!m)throw new de.NotFound("Table "+h+" not part of transaction");return m=new this.db.Table(h,m,this),m.core=this.db.core.table(h),f[h]=m},an);function an(){}function Hh(h,f,m,_,v,T,$){return{name:h,keyPath:f,unique:m,multi:_,auto:v,compound:T,src:(m&&!$?"&":"")+(_?"*":"")+(v?"++":"")+Pm(f)}}function Pm(h){return typeof h=="string"?h:h?"["+[].join.call(h,"+")+"]":""}function Wh(h,f,m){return{name:h,primKey:f,indexes:m,mappedClass:null,idxByName:(_=function(v){return[v.name,v]},m.reduce(function(v,T,$){return $=_(T,$),$&&(v[$[0]]=$[1]),v},{}))};var _}var vr=function(h){try{return h.only([[]]),vr=function(){return[[]]},[[]]}catch{return vr=function(){return bi},bi}};function Uh(h){return h==null?function(){}:typeof h=="string"?(f=h).split(".").length===1?function(m){return m[f]}:function(m){return G(m,f)}:function(m){return G(m,h)};var f}function Lm(h){return[].slice.call(h)}var vw=0;function br(h){return h==null?":id":typeof h=="string"?h:"[".concat(h.join("+"),"]")}function bw(h,f,L){function _(R){if(R.type===3)return null;if(R.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var P=R.lower,O=R.upper,j=R.lowerOpen,R=R.upperOpen;return P===void 0?O===void 0?null:f.upperBound(O,!!R):O===void 0?f.lowerBound(P,!!j):f.bound(P,O,!!j,!!R)}function v(F){var P,O=F.name;return{name:O,schema:F,mutate:function(j){var R=j.trans,W=j.type,U=j.keys,K=j.values,q=j.range;return new Promise(function(Q,re){Q=qe(Q);var te=R.objectStore(O),ne=te.keyPath==null,oe=W==="put"||W==="add";if(!oe&&W!=="delete"&&W!=="deleteRange")throw new Error("Invalid operation type: "+W);var ae,ye=(U||K||{length:1}).length;if(U&&K&&U.length!==K.length)throw new Error("Given keys array must have same length as given values array.");if(ye===0)return Q({numFailures:0,failures:{},results:[],lastResult:void 0});function Se(Ct){++Gt,yr(Ct)}var De=[],Te=[],Gt=0;if(W==="deleteRange"){if(q.type===4)return Q({numFailures:Gt,failures:Te,results:[],lastResult:void 0});q.type===3?De.push(ae=te.clear()):De.push(ae=te.delete(_(q)))}else{var ne=oe?ne?[K,U]:[K,null]:[U,null],$e=ne[0],gt=ne[1];if(oe)for(var yt=0;yt<ye;++yt)De.push(ae=gt&&gt[yt]!==void 0?te[W]($e[yt],gt[yt]):te[W]($e[yt])),ae.onerror=Se;else for(yt=0;yt<ye;++yt)De.push(ae=te[W]($e[yt])),ae.onerror=Se}function Ha(Ct){Ct=Ct.target.result,De.forEach(function(ki,cu){return ki.error!=null&&(Te[cu]=ki.error)}),Q({numFailures:Gt,failures:Te,results:W==="delete"?U:De.map(function(ki){return ki.result}),lastResult:Ct})}ae.onerror=function(Ct){Se(Ct),Ha(Ct)},ae.onsuccess=Ha})},getMany:function(j){var R=j.trans,W=j.keys;return new Promise(function(U,K){U=qe(U);for(var q,Q=R.objectStore(O),re=W.length,te=new Array(re),ne=0,oe=0,ae=function(De){De=De.target,te[De._pos]=De.result,++oe===ne&&U(te)},ye=on(K),Se=0;Se<re;++Se)W[Se]!=null&&((q=Q.get(W[Se]))._pos=Se,q.onsuccess=ae,q.onerror=ye,++ne);ne===0&&U(te)})},get:function(j){var R=j.trans,W=j.key;return new Promise(function(U,K){U=qe(U);var q=R.objectStore(O).get(W);q.onsuccess=function(Q){return U(Q.target.result)},q.onerror=on(K)})},query:(P=E,function(j){return new Promise(function(R,W){R=qe(R);var U,K,q,ne=j.trans,Q=j.values,re=j.limit,ae=j.query,te=re===1/0?void 0:re,oe=ae.index,ae=ae.range,ne=ne.objectStore(O),oe=oe.isPrimaryKey?ne:ne.index(oe.name),ae=_(ae);if(re===0)return R({result:[]});P?((te=Q?oe.getAll(ae,te):oe.getAllKeys(ae,te)).onsuccess=function(ye){return R({result:ye.target.result})},te.onerror=on(W)):(U=0,K=!Q&&"openKeyCursor"in oe?oe.openKeyCursor(ae):oe.openCursor(ae),q=[],K.onsuccess=function(ye){var Se=K.result;return Se?(q.push(Q?Se.value:Se.primaryKey),++U===re?R({result:q}):void Se.continue()):R({result:q})},K.onerror=on(W))})}),openCursor:function(j){var R=j.trans,W=j.values,U=j.query,K=j.reverse,q=j.unique;return new Promise(function(Q,re){Q=qe(Q);var oe=U.index,te=U.range,ne=R.objectStore(O),ne=oe.isPrimaryKey?ne:ne.index(oe.name),oe=K?q?"prevunique":"prev":q?"nextunique":"next",ae=!W&&"openKeyCursor"in ne?ne.openKeyCursor(_(te),oe):ne.openCursor(_(te),oe);ae.onerror=on(re),ae.onsuccess=qe(function(ye){var Se,De,Te,Gt,$e=ae.result;$e?($e.___id=++vw,$e.done=!1,Se=$e.continue.bind($e),De=(De=$e.continuePrimaryKey)&&De.bind($e),Te=$e.advance.bind($e),Gt=function(){throw new Error("Cursor not stopped")},$e.trans=R,$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=function(){throw new Error("Cursor not started")},$e.fail=qe(re),$e.next=function(){var gt=this,yt=1;return this.start(function(){return yt--?gt.continue():gt.stop()}).then(function(){return gt})},$e.start=function(gt){function yt(){if(ae.result)try{gt()}catch(Ct){$e.fail(Ct)}else $e.done=!0,$e.start=function(){throw new Error("Cursor behind last entry")},$e.stop()}var Ha=new Promise(function(Ct,ki){Ct=qe(Ct),ae.onerror=on(ki),$e.fail=ki,$e.stop=function(cu){$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=Gt,Ct(cu)}});return ae.onsuccess=qe(function(Ct){ae.onsuccess=yt,yt()}),$e.continue=Se,$e.continuePrimaryKey=De,$e.advance=Te,yt(),Ha},Q($e)):Q(null)},re)})},count:function(j){var R=j.query,W=j.trans,U=R.index,K=R.range;return new Promise(function(q,Q){var re=W.objectStore(O),te=U.isPrimaryKey?re:re.index(U.name),re=_(K),te=re?te.count(re):te.count();te.onsuccess=qe(function(ne){return q(ne.target.result)}),te.onerror=on(Q)})}}}var T,$,I,z=($=L,I=Lm((T=h).objectStoreNames),{schema:{name:T.name,tables:I.map(function(F){return $.objectStore(F)}).map(function(F){var P=F.keyPath,R=F.autoIncrement,O=a(P),j={},R={name:F.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:P==null,compound:O,keyPath:P,autoIncrement:R,unique:!0,extractKey:Uh(P)},indexes:Lm(F.indexNames).map(function(W){return F.index(W)}).map(function(q){var U=q.name,K=q.unique,Q=q.multiEntry,q=q.keyPath,Q={name:U,compound:a(q),keyPath:q,unique:K,multiEntry:Q,extractKey:Uh(q)};return j[br(q)]=Q}),getIndexByKeyPath:function(W){return j[br(W)]}};return j[":id"]=R.primaryKey,P!=null&&(j[br(P)]=R.primaryKey),R})},hasGetAll:0<I.length&&"getAll"in $.objectStore(I[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),L=z.schema,E=z.hasGetAll,z=L.tables.map(v),M={};return z.forEach(function(F){return M[F.name]=F}),{stack:"dbcore",transaction:h.transaction.bind(h),table:function(F){if(!M[F])throw new Error("Table '".concat(F,"' not found"));return M[F]},MIN_KEY:-1/0,MAX_KEY:vr(f),schema:L}}function ww(h,f,m,_){var v=m.IDBKeyRange;return m.indexedDB,{dbcore:(_=bw(f,v,_),h.dbcore.reduce(function(T,$){return $=$.create,n(n({},T),$(T))},_))}}function Na(h,_){var m=_.db,_=ww(h._middlewares,m,h._deps,_);h.core=_.dbcore,h.tables.forEach(function(v){var T=v.name;h.core.schema.tables.some(function($){return $.name===T})&&(v.core=h.core.table(T),h[T]instanceof h.Table&&(h[T].core=v.core))})}function Ma(h,f,m,_){m.forEach(function(v){var T=_[v];f.forEach(function($){var I=function L(E,z){return S(E,z)||(E=c(E))&&L(E,z)}($,v);(!I||"value"in I&&I.value===void 0)&&($===h.Transaction.prototype||$ instanceof h.Transaction?b($,v,{get:function(){return this.table(v)},set:function(L){g(this,v,{value:L,writable:!0,configurable:!0,enumerable:!0})}}):$[v]=new h.Table(v,T))})})}function Vh(h,f){f.forEach(function(m){for(var _ in m)m[_]instanceof h.Table&&delete m[_]})}function Cw(h,f){return h._cfg.version-f._cfg.version}function xw(h,f,m,_){var v=h._dbSchema;m.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=Wh("$meta",Om("")[0],[]),h._storeNames.push("$meta"));var T=h._createTransaction("readwrite",h._storeNames,v);T.create(m),T._completion.catch(_);var $=T._reject.bind(T),I=ue.transless||ue;Gn(function(){return ue.trans=T,ue.transless=I,f!==0?(Na(h,m),E=f,((L=T).storeNames.includes("$meta")?L.table("$meta").get("version").then(function(z){return z??E}):le.resolve(E)).then(function(z){return F=z,P=T,O=m,j=[],z=(M=h)._versions,R=M._dbSchema=Aa(0,M.idbdb,O),(z=z.filter(function(W){return W._cfg.version>=F})).length!==0?(z.forEach(function(W){j.push(function(){var U=R,K=W._cfg.dbschema;Pa(M,U,O),Pa(M,K,O),R=M._dbSchema=K;var q=Kh(U,K);q.add.forEach(function(oe){qh(O,oe[0],oe[1].primKey,oe[1].indexes)}),q.change.forEach(function(oe){if(oe.recreate)throw new de.Upgrade("Not yet support for changing primary key");var ae=O.objectStore(oe.name);oe.add.forEach(function(ye){return Ea(ae,ye)}),oe.change.forEach(function(ye){ae.deleteIndex(ye.name),Ea(ae,ye)}),oe.del.forEach(function(ye){return ae.deleteIndex(ye)})});var Q=W._cfg.contentUpgrade;if(Q&&W._cfg.version>F){Na(M,O),P._memoizedTables={};var re=Z(K);q.del.forEach(function(oe){re[oe]=U[oe]}),Vh(M,[M.Transaction.prototype]),Ma(M,[M.Transaction.prototype],o(re),re),P.schema=re;var te,ne=Ee(Q);return ne&&os(),q=le.follow(function(){var oe;(te=Q(P))&&ne&&(oe=Yn.bind(null,null),te.then(oe,oe))}),te&&typeof te.then=="function"?le.resolve(te):q.then(function(){return te})}}),j.push(function(U){var K,q,Q=W._cfg.dbschema;K=Q,q=U,[].slice.call(q.db.objectStoreNames).forEach(function(re){return K[re]==null&&q.db.deleteObjectStore(re)}),Vh(M,[M.Transaction.prototype]),Ma(M,[M.Transaction.prototype],M._storeNames,M._dbSchema),P.schema=M._dbSchema}),j.push(function(U){M.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(M.idbdb.version/10)===W._cfg.version?(M.idbdb.deleteObjectStore("$meta"),delete M._dbSchema.$meta,M._storeNames=M._storeNames.filter(function(K){return K!=="$meta"})):U.objectStore("$meta").put(W._cfg.version,"version"))})}),function W(){return j.length?le.resolve(j.shift()(P.idbtrans)).then(W):le.resolve()}().then(function(){Rm(R,O)})):le.resolve();var M,F,P,O,j,R}).catch($)):(o(v).forEach(function(z){qh(m,z,v[z].primKey,v[z].indexes)}),Na(h,m),void le.follow(function(){return h.on.populate.fire(T)}).catch($));var L,E})}function kw(h,f){Rm(h._dbSchema,f),f.db.version%10!=0||f.objectStoreNames.contains("$meta")||f.db.createObjectStore("$meta").add(Math.ceil(f.db.version/10-1),"version");var m=Aa(0,h.idbdb,f);Pa(h,h._dbSchema,f);for(var _=0,v=Kh(m,h._dbSchema).change;_<v.length;_++){var T=function($){if($.change.length||$.recreate)return console.warn("Unable to patch indexes of table ".concat($.name," because it has changes on the type of index or primary key.")),{value:void 0};var I=f.objectStore($.name);$.add.forEach(function(L){rn&&console.debug("Dexie upgrade patch: Creating missing index ".concat($.name,".").concat(L.src)),Ea(I,L)})}(v[_]);if(typeof T=="object")return T.value}}function Kh(h,f){var m,_={del:[],add:[],change:[]};for(m in h)f[m]||_.del.push(m);for(m in f){var v=h[m],T=f[m];if(v){var $={name:m,def:T,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(T.primKey.keyPath||"")||v.primKey.auto!==T.primKey.auto)$.recreate=!0,_.change.push($);else{var I=v.idxByName,L=T.idxByName,E=void 0;for(E in I)L[E]||$.del.push(E);for(E in L){var z=I[E],M=L[E];z?z.src!==M.src&&$.change.push(M):$.add.push(M)}(0<$.del.length||0<$.add.length||0<$.change.length)&&_.change.push($)}}else _.add.push([m,T])}return _}function qh(h,f,m,_){var v=h.db.createObjectStore(f,m.keyPath?{keyPath:m.keyPath,autoIncrement:m.auto}:{autoIncrement:m.auto});return _.forEach(function(T){return Ea(v,T)}),v}function Rm(h,f){o(h).forEach(function(m){f.db.objectStoreNames.contains(m)||(rn&&console.debug("Dexie: Creating missing table",m),qh(f,m,h[m].primKey,h[m].indexes))})}function Ea(h,f){h.createIndex(f.name,f.keyPath,{unique:f.unique,multiEntry:f.multi})}function Aa(h,f,m){var _={};return D(f.objectStoreNames,0).forEach(function(v){for(var T=m.objectStore(v),$=Hh(Pm(E=T.keyPath),E||"",!0,!1,!!T.autoIncrement,E&&typeof E!="string",!0),I=[],L=0;L<T.indexNames.length;++L){var z=T.index(T.indexNames[L]),E=z.keyPath,z=Hh(z.name,E,!!z.unique,!!z.multiEntry,!1,E&&typeof E!="string",!1);I.push(z)}_[v]=Wh(v,$,I)}),_}function Pa(h,f,m){for(var _=m.db.objectStoreNames,v=0;v<_.length;++v){var T=_[v],$=m.objectStore(T);h._hasGetAll="getAll"in $;for(var I=0;I<$.indexNames.length;++I){var L=$.indexNames[I],E=$.index(L).keyPath,z=typeof E=="string"?E:"["+D(E).join("+")+"]";!f[T]||(E=f[T].idxByName[z])&&(E.name=L,delete f[T].idxByName[z],f[T].idxByName[L]=E)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(h._hasGetAll=!1)}function Om(h){return h.split(",").map(function(f,m){var _=(f=f.trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(_)?_.match(/^\[(.*)\]$/)[1].split("+"):_;return Hh(_,v||null,/\&/.test(f),/\*/.test(f),/\+\+/.test(f),a(v),m===0)})}var Sw=(La.prototype._parseStoresSpec=function(h,f){o(h).forEach(function(m){if(h[m]!==null){var _=Om(h[m]),v=_.shift();if(v.unique=!0,v.multi)throw new de.Schema("Primary key cannot be multi-valued");_.forEach(function(T){if(T.auto)throw new de.Schema("Only primary key can be marked as autoIncrement (++)");if(!T.keyPath)throw new de.Schema("Index must have a name and cannot be an empty string")}),f[m]=Wh(m,v,_)}})},La.prototype.stores=function(m){var f=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,m):m;var m=f._versions,_={},v={};return m.forEach(function(T){l(_,T._cfg.storesSource),v=T._cfg.dbschema={},T._parseStoresSpec(_,v)}),f._dbSchema=v,Vh(f,[f._allTables,f,f.Transaction.prototype]),Ma(f,[f._allTables,f,f.Transaction.prototype,this._cfg.tables],o(v),v),f._storeNames=o(v),this},La.prototype.upgrade=function(h){return this._cfg.contentUpgrade=Th(this._cfg.contentUpgrade||je,h),this},La);function La(){}function Gh(h,f){var m=h._dbNamesDB;return m||(m=h._dbNamesDB=new xn(Sa,{addons:[],indexedDB:h,IDBKeyRange:f})).version(1).stores({dbnames:"name"}),m.table("dbnames")}function Yh(h){return h&&typeof h.databases=="function"}function Qh(h){return Gn(function(){return ue.letThrough=!0,h()})}function Xh(h){return!("from"in h)}var mt=function(h,f){if(!this){var m=new mt;return h&&"d"in h&&l(m,h),m}l(this,arguments.length?{d:1,from:h,to:1<arguments.length?f:h}:{d:0})};function wr(h,f,m){var _=Le(f,m);if(!isNaN(_)){if(0<_)throw RangeError();if(Xh(h))return l(h,{from:f,to:m,d:1});var v=h.l,_=h.r;if(Le(m,h.from)<0)return v?wr(v,f,m):h.l={from:f,to:m,d:1,l:null,r:null},zm(h);if(0<Le(f,h.to))return _?wr(_,f,m):h.r={from:f,to:m,d:1,l:null,r:null},zm(h);Le(f,h.from)<0&&(h.from=f,h.l=null,h.d=_?_.d+1:1),0<Le(m,h.to)&&(h.to=m,h.r=null,h.d=h.l?h.l.d+1:1),m=!h.r,v&&!h.l&&Cr(h,v),_&&m&&Cr(h,_)}}function Cr(h,f){Xh(f)||function m(_,L){var T=L.from,$=L.to,I=L.l,L=L.r;wr(_,T,$),I&&m(_,I),L&&m(_,L)}(h,f)}function Ra(h,f){var m=Zh(f),_=m.next();if(_.done)return!1;for(var v=_.value,T=Zh(h),$=T.next(v.from),I=$.value;!_.done&&!$.done;){if(Le(I.from,v.to)<=0&&0<=Le(I.to,v.from))return!0;Le(v.from,I.from)<0?v=(_=m.next(I.from)).value:I=($=T.next(v.from)).value}return!1}function Zh(h){var f=Xh(h)?null:{s:0,n:h};return{next:function(m){for(var _=0<arguments.length;f;)switch(f.s){case 0:if(f.s=1,_)for(;f.n.l&&Le(m,f.n.from)<0;)f={up:f,n:f.n.l,s:1};else for(;f.n.l;)f={up:f,n:f.n.l,s:1};case 1:if(f.s=2,!_||Le(m,f.n.to)<=0)return{value:f.n,done:!1};case 2:if(f.n.r){f.s=3,f={up:f,n:f.n.r,s:0};continue}case 3:f=f.up}return{done:!0}}}}function zm(h){var f,m,_=(((f=h.r)===null||f===void 0?void 0:f.d)||0)-(((m=h.l)===null||m===void 0?void 0:m.d)||0),v=1<_?"r":_<-1?"l":"";v&&(f=v=="r"?"l":"r",m=n({},h),_=h[v],h.from=_.from,h.to=_.to,h[v]=_[v],m[v]=_[f],(h[f]=m).d=Fm(m)),h.d=Fm(h)}function Fm(m){var f=m.r,m=m.l;return(f?m?Math.max(f.d,m.d):f.d:m?m.d:0)+1}function Oa(h,f){return o(f).forEach(function(m){h[m]?Cr(h[m],f[m]):h[m]=function _(v){var T,$,I={};for(T in v)u(v,T)&&($=v[T],I[T]=!$||typeof $!="object"||X.has($.constructor)?$:_($));return I}(f[m])}),h}function Jh(h,f){return h.all||f.all||Object.keys(h).some(function(m){return f[m]&&Ra(f[m],h[m])})}p(mt.prototype,((jt={add:function(h){return Cr(this,h),this},addKey:function(h){return wr(this,h,h),this},addKeys:function(h){var f=this;return h.forEach(function(m){return wr(f,m,m)}),this}})[Pe]=function(){return Zh(this)},jt));var Ci={},eu={},tu=!1;function za(h){Oa(eu,h),tu||(tu=!0,setTimeout(function(){tu=!1,nu(eu,!(eu={}))},0))}function nu(h,f){f===void 0&&(f=!1);var m=new Set;if(h.all)for(var _=0,v=Object.values(Ci);_<v.length;_++)jm($=v[_],h,m,f);else for(var T in h){var $,I=/^idb\:\/\/(.*)\/(.*)\//.exec(T);I&&(T=I[1],I=I[2],($=Ci["idb://".concat(T,"/").concat(I)])&&jm($,h,m,f))}m.forEach(function(L){return L()})}function jm(h,f,m,_){for(var v=[],T=0,$=Object.entries(h.queries.query);T<$.length;T++){for(var I=$[T],L=I[0],E=[],z=0,M=I[1];z<M.length;z++){var F=M[z];Jh(f,F.obsSet)?F.subscribers.forEach(function(R){return m.add(R)}):_&&E.push(F)}_&&v.push([L,E])}if(_)for(var P=0,O=v;P<O.length;P++){var j=O[P],L=j[0],E=j[1];h.queries.query[L]=E}}function Tw(h){var f=h._state,m=h._deps.indexedDB;if(f.isBeingOpened||h.idbdb)return f.dbReadyPromise.then(function(){return f.dbOpenError?Ye(f.dbOpenError):h});f.isBeingOpened=!0,f.dbOpenError=null,f.openComplete=!1;var _=f.openCanceller,v=Math.round(10*h.verno),T=!1;function $(){if(f.openCanceller!==_)throw new de.DatabaseClosed("db.open() was cancelled")}function I(){return new le(function(F,P){if($(),!m)throw new de.MissingAPI;var O=h.name,j=f.autoSchema||!v?m.open(O):m.open(O,v);if(!j)throw new de.MissingAPI;j.onerror=on(P),j.onblocked=qe(h._fireOnBlocked),j.onupgradeneeded=qe(function(R){var W;z=j.transaction,f.autoSchema&&!h._options.allowEmptyDB?(j.onerror=yr,z.abort(),j.result.close(),(W=m.deleteDatabase(O)).onsuccess=W.onerror=qe(function(){P(new de.NoSuchDatabase("Database ".concat(O," doesnt exist")))})):(z.onerror=on(P),R=R.oldVersion>Math.pow(2,62)?0:R.oldVersion,M=R<1,h.idbdb=j.result,T&&kw(h,z),xw(h,R/10,z,P))},P),j.onsuccess=qe(function(){z=null;var R,W,U,K,q,Q=h.idbdb=j.result,re=D(Q.objectStoreNames);if(0<re.length)try{var te=Q.transaction((K=re).length===1?K[0]:K,"readonly");if(f.autoSchema)W=Q,U=te,(R=h).verno=W.version/10,U=R._dbSchema=Aa(0,W,U),R._storeNames=D(W.objectStoreNames,0),Ma(R,[R._allTables],o(U),U);else if(Pa(h,h._dbSchema,te),((q=Kh(Aa(0,(q=h).idbdb,te),q._dbSchema)).add.length||q.change.some(function(ne){return ne.add.length||ne.change.length}))&&!T)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Q.close(),v=Q.version+1,T=!0,F(I());Na(h,te)}catch{}as.push(h),Q.onversionchange=qe(function(ne){f.vcFired=!0,h.on("versionchange").fire(ne)}),Q.onclose=qe(function(ne){h.on("close").fire(ne)}),M&&(q=h._deps,te=O,Q=q.indexedDB,q=q.IDBKeyRange,Yh(Q)||te===Sa||Gh(Q,q).put({name:te}).catch(je)),F()},P)}).catch(function(F){switch(F==null?void 0:F.name){case"UnknownError":if(0<f.PR1398_maxLoop)return f.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),I();break;case"VersionError":if(0<v)return v=0,I()}return le.reject(F)})}var L,E=f.dbReadyResolve,z=null,M=!1;return le.race([_,(typeof navigator>"u"?le.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(F){function P(){return indexedDB.databases().finally(F)}L=setInterval(P,100),P()}).finally(function(){return clearInterval(L)}):Promise.resolve()).then(I)]).then(function(){return $(),f.onReadyBeingFired=[],le.resolve(Qh(function(){return h.on.ready.fire(h.vip)})).then(function F(){if(0<f.onReadyBeingFired.length){var P=f.onReadyBeingFired.reduce(Th,je);return f.onReadyBeingFired=[],le.resolve(Qh(function(){return P(h.vip)})).then(F)}})}).finally(function(){f.openCanceller===_&&(f.onReadyBeingFired=null,f.isBeingOpened=!1)}).catch(function(F){f.dbOpenError=F;try{z&&z.abort()}catch{}return _===f.openCanceller&&h._close(),Ye(F)}).finally(function(){f.openComplete=!0,E()}).then(function(){var F;return M&&(F={},h.tables.forEach(function(P){P.schema.indexes.forEach(function(O){O.name&&(F["idb://".concat(h.name,"/").concat(P.name,"/").concat(O.name)]=new mt(-1/0,[[[]]]))}),F["idb://".concat(h.name,"/").concat(P.name,"/")]=F["idb://".concat(h.name,"/").concat(P.name,"/:dels")]=new mt(-1/0,[[[]]])}),Zn(_r).fire(F),nu(F,!0)),h})}function iu(h){function f(T){return h.next(T)}var m=v(f),_=v(function(T){return h.throw(T)});function v(T){return function(L){var I=T(L),L=I.value;return I.done?L:L&&typeof L.then=="function"?L.then(m,_):a(L)?Promise.all(L).then(m,_):m(L)}}return v(f)()}function Fa(h,f,m){for(var _=a(h)?h.slice():[h],v=0;v<m;++v)_.push(f);return _}var $w={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(h){return n(n({},h),{table:function(f){var m=h.table(f),_=m.schema,v={},T=[];function $(M,F,P){var O=br(M),j=v[O]=v[O]||[],R=M==null?0:typeof M=="string"?1:M.length,W=0<F,W=n(n({},P),{name:W?"".concat(O,"(virtual-from:").concat(P.name,")"):P.name,lowLevelIndex:P,isVirtual:W,keyTail:F,keyLength:R,extractKey:Uh(M),unique:!W&&P.unique});return j.push(W),W.isPrimaryKey||T.push(W),1<R&&$(R===2?M[0]:M.slice(0,R-1),F+1,P),j.sort(function(U,K){return U.keyTail-K.keyTail}),W}f=$(_.primaryKey.keyPath,0,_.primaryKey),v[":id"]=[f];for(var I=0,L=_.indexes;I<L.length;I++){var E=L[I];$(E.keyPath,0,E)}function z(M){var F,P=M.query.index;return P.isVirtual?n(n({},M),{query:{index:P.lowLevelIndex,range:(F=M.query.range,P=P.keyTail,{type:F.type===1?2:F.type,lower:Fa(F.lower,F.lowerOpen?h.MAX_KEY:h.MIN_KEY,P),lowerOpen:!0,upper:Fa(F.upper,F.upperOpen?h.MIN_KEY:h.MAX_KEY,P),upperOpen:!0})}}):M}return n(n({},m),{schema:n(n({},_),{primaryKey:f,indexes:T,getIndexByKeyPath:function(M){return(M=v[br(M)])&&M[0]}}),count:function(M){return m.count(z(M))},query:function(M){return m.query(z(M))},openCursor:function(M){var F=M.query.index,P=F.keyTail,O=F.isVirtual,j=F.keyLength;return O?m.openCursor(z(M)).then(function(W){return W&&R(W)}):m.openCursor(M);function R(W){return Object.create(W,{continue:{value:function(U){U!=null?W.continue(Fa(U,M.reverse?h.MAX_KEY:h.MIN_KEY,P)):M.unique?W.continue(W.key.slice(0,j).concat(M.reverse?h.MIN_KEY:h.MAX_KEY,P)):W.continue()}},continuePrimaryKey:{value:function(U,K){W.continuePrimaryKey(Fa(U,h.MAX_KEY,P),K)}},primaryKey:{get:function(){return W.primaryKey}},key:{get:function(){var U=W.key;return j===1?U[0]:U.slice(0,j)}},value:{get:function(){return W.value}}})}}})}})}};function su(h,f,m,_){return m=m||{},_=_||"",o(h).forEach(function(v){var T,$,I;u(f,v)?(T=h[v],$=f[v],typeof T=="object"&&typeof $=="object"&&T&&$?(I=Me(T))!==Me($)?m[_+v]=f[v]:I==="Object"?su(T,$,m,_+v+"."):T!==$&&(m[_+v]=f[v]):T!==$&&(m[_+v]=f[v])):m[_+v]=void 0}),o(f).forEach(function(v){u(h,v)||(m[_+v]=f[v])}),m}function ru(h,f){return f.type==="delete"?f.keys:f.keys||f.values.map(h.extractKey)}var Dw={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(h){return n(n({},h),{table:function(f){var m=h.table(f),_=m.schema.primaryKey;return n(n({},m),{mutate:function(v){var T=ue.trans,$=T.table(f).hook,I=$.deleting,L=$.creating,E=$.updating;switch(v.type){case"add":if(L.fire===je)break;return T._promise("readwrite",function(){return z(v)},!0);case"put":if(L.fire===je&&E.fire===je)break;return T._promise("readwrite",function(){return z(v)},!0);case"delete":if(I.fire===je)break;return T._promise("readwrite",function(){return z(v)},!0);case"deleteRange":if(I.fire===je)break;return T._promise("readwrite",function(){return function M(F,P,O){return m.query({trans:F,values:!1,query:{index:_,range:P},limit:O}).then(function(j){var R=j.result;return z({type:"delete",keys:R,trans:F}).then(function(W){return 0<W.numFailures?Promise.reject(W.failures[0]):R.length<O?{failures:[],numFailures:0,lastResult:void 0}:M(F,n(n({},P),{lower:R[R.length-1],lowerOpen:!0}),O)})})}(v.trans,v.range,1e4)},!0)}return m.mutate(v);function z(M){var F,P,O,j=ue.trans,R=M.keys||ru(_,M);if(!R)throw new Error("Keys missing");return(M=M.type==="add"||M.type==="put"?n(n({},M),{keys:R}):n({},M)).type!=="delete"&&(M.values=s([],M.values,!0)),M.keys&&(M.keys=s([],M.keys,!0)),F=m,O=R,((P=M).type==="add"?Promise.resolve([]):F.getMany({trans:P.trans,keys:O,cache:"immutable"})).then(function(W){var U=R.map(function(K,q){var Q,re,te,ne=W[q],oe={onerror:null,onsuccess:null};return M.type==="delete"?I.fire.call(oe,K,ne,j):M.type==="add"||ne===void 0?(Q=L.fire.call(oe,K,M.values[q],j),K==null&&Q!=null&&(M.keys[q]=K=Q,_.outbound||Y(M.values[q],_.keyPath,K))):(Q=su(ne,M.values[q]),(re=E.fire.call(oe,Q,K,ne,j))&&(te=M.values[q],Object.keys(re).forEach(function(ae){u(te,ae)?te[ae]=re[ae]:Y(te,ae,re[ae])}))),oe});return m.mutate(M).then(function(K){for(var q=K.failures,Q=K.results,re=K.numFailures,K=K.lastResult,te=0;te<R.length;++te){var ne=(Q||R)[te],oe=U[te];ne==null?oe.onerror&&oe.onerror(q[te]):oe.onsuccess&&oe.onsuccess(M.type==="put"&&W[te]?M.values[te]:ne)}return{failures:q,results:Q,numFailures:re,lastResult:K}}).catch(function(K){return U.forEach(function(q){return q.onerror&&q.onerror(K)}),Promise.reject(K)})})}}})}})}};function Bm(h,f,m){try{if(!f||f.keys.length<h.length)return null;for(var _=[],v=0,T=0;v<f.keys.length&&T<h.length;++v)Le(f.keys[v],h[T])===0&&(_.push(m?ge(f.values[v]):f.values[v]),++T);return _.length===h.length?_:null}catch{return null}}var Iw={stack:"dbcore",level:-1,create:function(h){return{table:function(f){var m=h.table(f);return n(n({},m),{getMany:function(_){if(!_.cache)return m.getMany(_);var v=Bm(_.keys,_.trans._cache,_.cache==="clone");return v?le.resolve(v):m.getMany(_).then(function(T){return _.trans._cache={keys:_.keys,values:_.cache==="clone"?ge(T):T},T})},mutate:function(_){return _.type!=="add"&&(_.trans._cache=null),m.mutate(_)}})}}}};function Hm(h,f){return h.trans.mode==="readonly"&&!!h.subscr&&!h.trans.explicit&&h.trans.db._options.cache!=="disabled"&&!f.schema.primaryKey.outbound}function Wm(h,f){switch(h){case"query":return f.values&&!f.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Nw={stack:"dbcore",level:0,name:"Observability",create:function(h){var f=h.schema.name,m=new mt(h.MIN_KEY,h.MAX_KEY);return n(n({},h),{transaction:function(_,v,T){if(ue.subscr&&v!=="readonly")throw new de.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ue.querier));return h.transaction(_,v,T)},table:function(_){var v=h.table(_),T=v.schema,$=T.primaryKey,M=T.indexes,I=$.extractKey,L=$.outbound,E=$.autoIncrement&&M.filter(function(P){return P.compound&&P.keyPath.includes($.keyPath)}),z=n(n({},v),{mutate:function(P){function O(ae){return ae="idb://".concat(f,"/").concat(_,"/").concat(ae),K[ae]||(K[ae]=new mt)}var j,R,W,U=P.trans,K=P.mutatedParts||(P.mutatedParts={}),q=O(""),Q=O(":dels"),re=P.type,oe=P.type==="deleteRange"?[P.range]:P.type==="delete"?[P.keys]:P.values.length<50?[ru($,P).filter(function(ae){return ae}),P.values]:[],te=oe[0],ne=oe[1],oe=P.trans._cache;return a(te)?(q.addKeys(te),(oe=re==="delete"||te.length===ne.length?Bm(te,oe):null)||Q.addKeys(te),(oe||ne)&&(j=O,R=oe,W=ne,T.indexes.forEach(function(ae){var ye=j(ae.name||"");function Se(Te){return Te!=null?ae.extractKey(Te):null}function De(Te){return ae.multiEntry&&a(Te)?Te.forEach(function(Gt){return ye.addKey(Gt)}):ye.addKey(Te)}(R||W).forEach(function(Te,gt){var $e=R&&Se(R[gt]),gt=W&&Se(W[gt]);Le($e,gt)!==0&&($e!=null&&De($e),gt!=null&&De(gt))})}))):te?(ne={from:te.lower,to:te.upper},Q.add(ne),q.add(ne)):(q.add(m),Q.add(m),T.indexes.forEach(function(ae){return O(ae.name).add(m)})),v.mutate(P).then(function(ae){return!te||P.type!=="add"&&P.type!=="put"||(q.addKeys(ae.results),E&&E.forEach(function(ye){var Se=P.values.map(function(Te){return ye.extractKey(Te)}),De=ye.keyPath.findIndex(function(Te){return Te===$.keyPath});ae.results.forEach(function(Te){return Se[De]=Te}),O(ye.name).addKeys(Se)})),U.mutatedParts=Oa(U.mutatedParts||{},K),ae})}}),M=function(O){var j=O.query,O=j.index,j=j.range;return[O,new mt((O=j.lower)!==null&&O!==void 0?O:h.MIN_KEY,(j=j.upper)!==null&&j!==void 0?j:h.MAX_KEY)]},F={get:function(P){return[$,new mt(P.key)]},getMany:function(P){return[$,new mt().addKeys(P.keys)]},count:M,query:M,openCursor:M};return o(F).forEach(function(P){z[P]=function(O){var j=ue.subscr,R=!!j,W=Hm(ue,v)&&Wm(P,O)?O.obsSet={}:j;if(R){var U=function(ne){return ne="idb://".concat(f,"/").concat(_,"/").concat(ne),W[ne]||(W[ne]=new mt)},K=U(""),q=U(":dels"),j=F[P](O),R=j[0],j=j[1];if((P==="query"&&R.isPrimaryKey&&!O.values?q:U(R.name||"")).add(j),!R.isPrimaryKey){if(P!=="count"){var Q=P==="query"&&L&&O.values&&v.query(n(n({},O),{values:!1}));return v[P].apply(this,arguments).then(function(ne){if(P==="query"){if(L&&O.values)return Q.then(function(Se){return Se=Se.result,K.addKeys(Se),ne});var oe=O.values?ne.result.map(I):ne.result;(O.values?K:q).addKeys(oe)}else if(P==="openCursor"){var ae=ne,ye=O.values;return ae&&Object.create(ae,{key:{get:function(){return q.addKey(ae.primaryKey),ae.key}},primaryKey:{get:function(){var Se=ae.primaryKey;return q.addKey(Se),Se}},value:{get:function(){return ye&&K.addKey(ae.primaryKey),ae.value}}})}return ne})}q.add(m)}}return v[P].apply(this,arguments)}}),z}})}};function Um(h,f,m){if(m.numFailures===0)return f;if(f.type==="deleteRange")return null;var _=f.keys?f.keys.length:"values"in f&&f.values?f.values.length:1;return m.numFailures===_?null:(f=n({},f),a(f.keys)&&(f.keys=f.keys.filter(function(v,T){return!(T in m.failures)})),"values"in f&&a(f.values)&&(f.values=f.values.filter(function(v,T){return!(T in m.failures)})),f)}function ou(h,f){return m=h,((_=f).lower===void 0||(_.lowerOpen?0<Le(m,_.lower):0<=Le(m,_.lower)))&&(h=h,(f=f).upper===void 0||(f.upperOpen?Le(h,f.upper)<0:Le(h,f.upper)<=0));var m,_}function Vm(h,f,F,_,v,T){if(!F||F.length===0)return h;var $=f.query.index,I=$.multiEntry,L=f.query.range,E=_.schema.primaryKey.extractKey,z=$.extractKey,M=($.lowLevelIndex||$).extractKey,F=F.reduce(function(P,O){var j=P,R=O.type==="add"||O.type==="put"?O.values.filter(function(q){return q=z(q),I&&a(q)?q.some(function(Q){return ou(Q,L)}):ou(q,L)}).map(function(q){return q=ge(q),T&&Object.freeze(q),q}):[];switch(O.type){case"add":j=P.concat(f.values?R:R.map(function(Q){return E(Q)}));break;case"put":var W=new mt().addKeys(O.values.map(function(Q){return E(Q)})),j=P.filter(function(Q){return Q=f.values?E(Q):Q,!Ra(new mt(Q),W)}).concat(f.values?R:R.map(function(Q){return E(Q)}));break;case"delete":var U=new mt().addKeys(O.keys);j=P.filter(function(Q){return Q=f.values?E(Q):Q,!Ra(new mt(Q),U)});break;case"deleteRange":var K=O.range;j=P.filter(function(Q){return!ou(E(Q),K)})}return j},h);return F===h?h:(F.sort(function(P,O){return Le(M(P),M(O))||Le(E(P),E(O))}),f.limit&&f.limit<1/0&&(F.length>f.limit?F.length=f.limit:h.length===f.limit&&F.length<f.limit&&(v.dirty=!0)),T?Object.freeze(F):F)}function Km(h,f){return Le(h.lower,f.lower)===0&&Le(h.upper,f.upper)===0&&!!h.lowerOpen==!!f.lowerOpen&&!!h.upperOpen==!!f.upperOpen}function Mw(h,f){return function(m,_,v,T){if(m===void 0)return _!==void 0?-1:0;if(_===void 0)return 1;if((_=Le(m,_))===0){if(v&&T)return 0;if(v)return 1;if(T)return-1}return _}(h.lower,f.lower,h.lowerOpen,f.lowerOpen)<=0&&0<=function(m,_,v,T){if(m===void 0)return _!==void 0?1:0;if(_===void 0)return-1;if((_=Le(m,_))===0){if(v&&T)return 0;if(v)return-1;if(T)return 1}return _}(h.upper,f.upper,h.upperOpen,f.upperOpen)}function Ew(h,f,m,_){h.subscribers.add(m),_.addEventListener("abort",function(){var v,T;h.subscribers.delete(m),h.subscribers.size===0&&(v=h,T=f,setTimeout(function(){v.subscribers.size===0&&J(T,v)},3e3))})}var Aw={stack:"dbcore",level:0,name:"Cache",create:function(h){var f=h.schema.name;return n(n({},h),{transaction:function(m,_,v){var T,$,I=h.transaction(m,_,v);return _==="readwrite"&&($=(T=new AbortController).signal,v=function(L){return function(){if(T.abort(),_==="readwrite"){for(var E=new Set,z=0,M=m;z<M.length;z++){var F=M[z],P=Ci["idb://".concat(f,"/").concat(F)];if(P){var O=h.table(F),j=P.optimisticOps.filter(function(ye){return ye.trans===I});if(I._explicit&&L&&I.mutatedParts)for(var R=0,W=Object.values(P.queries.query);R<W.length;R++)for(var U=0,K=(re=W[R]).slice();U<K.length;U++)Jh((te=K[U]).obsSet,I.mutatedParts)&&(J(re,te),te.subscribers.forEach(function(ye){return E.add(ye)}));else if(0<j.length){P.optimisticOps=P.optimisticOps.filter(function(ye){return ye.trans!==I});for(var q=0,Q=Object.values(P.queries.query);q<Q.length;q++)for(var re,te,ne,oe=0,ae=(re=Q[q]).slice();oe<ae.length;oe++)(te=ae[oe]).res!=null&&I.mutatedParts&&(L&&!te.dirty?(ne=Object.isFrozen(te.res),ne=Vm(te.res,te.req,j,O,te,ne),te.dirty?(J(re,te),te.subscribers.forEach(function(ye){return E.add(ye)})):ne!==te.res&&(te.res=ne,te.promise=le.resolve({result:ne}))):(te.dirty&&J(re,te),te.subscribers.forEach(function(ye){return E.add(ye)})))}}}E.forEach(function(ye){return ye()})}}},I.addEventListener("abort",v(!1),{signal:$}),I.addEventListener("error",v(!1),{signal:$}),I.addEventListener("complete",v(!0),{signal:$})),I},table:function(m){var _=h.table(m),v=_.schema.primaryKey;return n(n({},_),{mutate:function(T){var $=ue.trans;if(v.outbound||$.db._options.cache==="disabled"||$.explicit)return _.mutate(T);var I=Ci["idb://".concat(f,"/").concat(m)];return I?($=_.mutate(T),T.type!=="add"&&T.type!=="put"||!(50<=T.values.length||ru(v,T).some(function(L){return L==null}))?(I.optimisticOps.push(T),T.mutatedParts&&za(T.mutatedParts),$.then(function(L){0<L.numFailures&&(J(I.optimisticOps,T),(L=Um(0,T,L))&&I.optimisticOps.push(L),T.mutatedParts&&za(T.mutatedParts))}),$.catch(function(){J(I.optimisticOps,T),T.mutatedParts&&za(T.mutatedParts)})):$.then(function(L){var E=Um(0,n(n({},T),{values:T.values.map(function(P,M){var F,P=(F=v.keyPath)!==null&&F!==void 0&&F.includes(".")?ge(P):n({},P);return Y(P,v.keyPath,L.results[M]),P})}),L);I.optimisticOps.push(E),queueMicrotask(function(){return T.mutatedParts&&za(T.mutatedParts)})}),$):_.mutate(T)},query:function(T){if(!Hm(ue,_)||!Wm("query",T))return _.query(T);var $=((E=ue.trans)===null||E===void 0?void 0:E.db._options.cache)==="immutable",M=ue,I=M.requery,L=M.signal,E=function(O,j,R,W){var U=Ci["idb://".concat(O,"/").concat(j)];if(!U)return[];if(!(j=U.queries[R]))return[null,!1,U,null];var K=j[(W.query?W.query.index.name:null)||""];if(!K)return[null,!1,U,null];switch(R){case"query":var q=K.find(function(Q){return Q.req.limit===W.limit&&Q.req.values===W.values&&Km(Q.req.query.range,W.query.range)});return q?[q,!0,U,K]:[K.find(function(Q){return("limit"in Q.req?Q.req.limit:1/0)>=W.limit&&(!W.values||Q.req.values)&&Mw(Q.req.query.range,W.query.range)}),!1,U,K];case"count":return q=K.find(function(Q){return Km(Q.req.query.range,W.query.range)}),[q,!!q,U,K]}}(f,m,"query",T),z=E[0],M=E[1],F=E[2],P=E[3];return z&&M?z.obsSet=T.obsSet:(M=_.query(T).then(function(O){var j=O.result;if(z&&(z.res=j),$){for(var R=0,W=j.length;R<W;++R)Object.freeze(j[R]);Object.freeze(j)}else O.result=ge(j);return O}).catch(function(O){return P&&z&&J(P,z),Promise.reject(O)}),z={obsSet:T.obsSet,promise:M,subscribers:new Set,type:"query",req:T,dirty:!1},P?P.push(z):(P=[z],(F=F||(Ci["idb://".concat(f,"/").concat(m)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[T.query.index.name||""]=P)),Ew(z,P,I,L),z.promise.then(function(O){return{result:Vm(O.result,T,F==null?void 0:F.optimisticOps,_,z,$)}})}})}})}};function ja(h,f){return new Proxy(h,{get:function(m,_,v){return _==="db"?f:Reflect.get(m,_,v)}})}var xn=(Qe.prototype.version=function(h){if(isNaN(h)||h<.1)throw new de.Type("Given version is not a positive number");if(h=Math.round(10*h)/10,this.idbdb||this._state.isBeingOpened)throw new de.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,h);var f=this._versions,m=f.filter(function(_){return _._cfg.version===h})[0];return m||(m=new this.Version(h),f.push(m),f.sort(Cw),m.stores({}),this._state.autoSchema=!1,m)},Qe.prototype._whenReady=function(h){var f=this;return this.idbdb&&(this._state.openComplete||ue.letThrough||this._vip)?h():new le(function(m,_){if(f._state.openComplete)return _(new de.DatabaseClosed(f._state.dbOpenError));if(!f._state.isBeingOpened){if(!f._state.autoOpen)return void _(new de.DatabaseClosed);f.open().catch(je)}f._state.dbReadyPromise.then(m,_)}).then(h)},Qe.prototype.use=function(h){var f=h.stack,m=h.create,_=h.level,v=h.name;return v&&this.unuse({stack:f,name:v}),h=this._middlewares[f]||(this._middlewares[f]=[]),h.push({stack:f,create:m,level:_??10,name:v}),h.sort(function(T,$){return T.level-$.level}),this},Qe.prototype.unuse=function(h){var f=h.stack,m=h.name,_=h.create;return f&&this._middlewares[f]&&(this._middlewares[f]=this._middlewares[f].filter(function(v){return _?v.create!==_:!!m&&v.name!==m})),this},Qe.prototype.open=function(){var h=this;return vi(qn,function(){return Tw(h)})},Qe.prototype._close=function(){var h=this._state,f=as.indexOf(this);if(0<=f&&as.splice(f,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}h.isBeingOpened||(h.dbReadyPromise=new le(function(m){h.dbReadyResolve=m}),h.openCanceller=new le(function(m,_){h.cancelOpen=_}))},Qe.prototype.close=function(m){var f=(m===void 0?{disableAutoOpen:!0}:m).disableAutoOpen,m=this._state;f?(m.isBeingOpened&&m.cancelOpen(new de.DatabaseClosed),this._close(),m.autoOpen=!1,m.dbOpenError=new de.DatabaseClosed):(this._close(),m.autoOpen=this._options.autoOpen||m.isBeingOpened,m.openComplete=!1,m.dbOpenError=null)},Qe.prototype.delete=function(h){var f=this;h===void 0&&(h={disableAutoOpen:!0});var m=0<arguments.length&&typeof arguments[0]!="object",_=this._state;return new le(function(v,T){function $(){f.close(h);var I=f._deps.indexedDB.deleteDatabase(f.name);I.onsuccess=qe(function(){var L,E,z;L=f._deps,E=f.name,z=L.indexedDB,L=L.IDBKeyRange,Yh(z)||E===Sa||Gh(z,L).delete(E).catch(je),v()}),I.onerror=on(T),I.onblocked=f._fireOnBlocked}if(m)throw new de.InvalidArgument("Invalid closeOptions argument to db.delete()");_.isBeingOpened?_.dbReadyPromise.then($):$()})},Qe.prototype.backendDB=function(){return this.idbdb},Qe.prototype.isOpen=function(){return this.idbdb!==null},Qe.prototype.hasBeenClosed=function(){var h=this._state.dbOpenError;return h&&h.name==="DatabaseClosed"},Qe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Qe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Qe.prototype,"tables",{get:function(){var h=this;return o(this._allTables).map(function(f){return h._allTables[f]})},enumerable:!1,configurable:!0}),Qe.prototype.transaction=function(){var h=(function(f,m,_){var v=arguments.length;if(v<2)throw new de.InvalidArgument("Too few arguments");for(var T=new Array(v-1);--v;)T[v-1]=arguments[v];return _=T.pop(),[f,he(T),_]}).apply(this,arguments);return this._transaction.apply(this,h)},Qe.prototype._transaction=function(h,f,m){var _=this,v=ue.trans;v&&v.db===this&&h.indexOf("!")===-1||(v=null);var T,$,I=h.indexOf("?")!==-1;h=h.replace("!","").replace("?","");try{if($=f.map(function(E){if(E=E instanceof _.Table?E.name:E,typeof E!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return E}),h=="r"||h===Lh)T=Lh;else{if(h!="rw"&&h!=Rh)throw new de.InvalidArgument("Invalid transaction mode: "+h);T=Rh}if(v){if(v.mode===Lh&&T===Rh){if(!I)throw new de.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");v=null}v&&$.forEach(function(E){if(v&&v.storeNames.indexOf(E)===-1){if(!I)throw new de.SubTransaction("Table "+E+" not included in parent transaction.");v=null}}),I&&v&&!v.active&&(v=null)}}catch(E){return v?v._promise(null,function(z,M){M(E)}):Ye(E)}var L=(function E(z,M,F,P,O){return le.resolve().then(function(){var j=ue.transless||ue,R=z._createTransaction(M,F,z._dbSchema,P);if(R.explicit=!0,j={trans:R,transless:j},P)R.idbtrans=P.idbtrans;else try{R.create(),R.idbtrans._explicit=!0,z._state.PR1398_maxLoop=3}catch(K){return K.name===Kn.InvalidState&&z.isOpen()&&0<--z._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),z.close({disableAutoOpen:!1}),z.open().then(function(){return E(z,M,F,null,O)})):Ye(K)}var W,U=Ee(O);return U&&os(),j=le.follow(function(){var K;(W=O.call(R,R))&&(U?(K=Yn.bind(null,null),W.then(K,K)):typeof W.next=="function"&&typeof W.throw=="function"&&(W=iu(W)))},j),(W&&typeof W.then=="function"?le.resolve(W).then(function(K){return R.active?K:Ye(new de.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):j.then(function(){return W})).then(function(K){return P&&R._resolve(),R._completion.then(function(){return K})}).catch(function(K){return R._reject(K),Ye(K)})})}).bind(null,this,T,$,v,m);return v?v._promise(T,L,"lock"):ue.trans?vi(ue.transless,function(){return _._whenReady(L)}):this._whenReady(L)},Qe.prototype.table=function(h){if(!u(this._allTables,h))throw new de.InvalidTable("Table ".concat(h," does not exist"));return this._allTables[h]},Qe);function Qe(h,f){var m=this;this._middlewares={},this.verno=0;var _=Qe.dependencies;this._options=f=n({addons:Qe.addons,autoOpen:!0,indexedDB:_.indexedDB,IDBKeyRange:_.IDBKeyRange,cache:"cloned"},f),this._deps={indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange},_=f.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var v,T,$,I,L,E={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:je,dbReadyPromise:null,cancelOpen:je,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:f.autoOpen};E.dbReadyPromise=new le(function(M){E.dbReadyResolve=M}),E.openCanceller=new le(function(M,F){E.cancelOpen=F}),this._state=E,this.name=h,this.on=mr(this,"populate","blocked","versionchange","close",{ready:[Th,je]}),this.on.ready.subscribe=A(this.on.ready.subscribe,function(M){return function(F,P){Qe.vip(function(){var O,j=m._state;j.openComplete?(j.dbOpenError||le.resolve().then(F),P&&M(F)):j.onReadyBeingFired?(j.onReadyBeingFired.push(F),P&&M(F)):(M(F),O=m,P||M(function R(){O.on.ready.unsubscribe(F),O.on.ready.unsubscribe(R)}))})}}),this.Collection=(v=this,gr(mw.prototype,function(W,R){this.db=v;var P=km,O=null;if(R)try{P=R()}catch(U){O=U}var j=W._ctx,R=j.table,W=R.hook.reading.fire;this._ctx={table:R,index:j.index,isPrimKey:!j.index||R.schema.primKey.keyPath&&j.index===R.schema.primKey.name,range:P,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:O,or:j.or,valueMapper:W!==cr?W:null}})),this.Table=(T=this,gr(Dm.prototype,function(M,F,P){this.db=T,this._tx=P,this.name=M,this.schema=F,this.hook=T._allTables[M]?T._allTables[M].hook:mr(null,{creating:[ow,je],reading:[rw,cr],updating:[lw,je],deleting:[aw,je]})})),this.Transaction=($=this,gr(_w.prototype,function(M,F,P,O,j){var R=this;this.db=$,this.mode=M,this.storeNames=F,this.schema=P,this.chromeTransactionDurability=O,this.idbtrans=null,this.on=mr(this,"complete","error","abort"),this.parent=j||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new le(function(W,U){R._resolve=W,R._reject=U}),this._completion.then(function(){R.active=!1,R.on.complete.fire()},function(W){var U=R.active;return R.active=!1,R.on.error.fire(W),R.parent?R.parent._reject(W):U&&R.idbtrans&&R.idbtrans.abort(),Ye(W)})})),this.Version=(I=this,gr(Sw.prototype,function(M){this.db=I,this._cfg={version:M,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(L=this,gr(Am.prototype,function(M,F,P){if(this.db=L,this._ctx={table:M,index:F===":id"?null:F,or:P},this._cmp=this._ascending=Le,this._descending=function(O,j){return Le(j,O)},this._max=function(O,j){return 0<Le(O,j)?O:j},this._min=function(O,j){return Le(O,j)<0?O:j},this._IDBKeyRange=L._deps.IDBKeyRange,!this._IDBKeyRange)throw new de.MissingAPI})),this.on("versionchange",function(M){0<M.newVersion?console.warn("Another connection wants to upgrade database '".concat(m.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(m.name,"'. Closing db now to resume the delete request.")),m.close({disableAutoOpen:!1})}),this.on("blocked",function(M){!M.newVersion||M.newVersion<M.oldVersion?console.warn("Dexie.delete('".concat(m.name,"') was blocked")):console.warn("Upgrade '".concat(m.name,"' blocked by other connection holding version ").concat(M.oldVersion/10))}),this._maxKey=vr(f.IDBKeyRange),this._createTransaction=function(M,F,P,O){return new m.Transaction(M,F,P,m._options.chromeTransactionDurability,O)},this._fireOnBlocked=function(M){m.on("blocked").fire(M),as.filter(function(F){return F.name===m.name&&F!==m&&!F._state.vcFired}).map(function(F){return F.on("versionchange").fire(M)})},this.use(Iw),this.use(Aw),this.use(Nw),this.use($w),this.use(Dw);var z=new Proxy(this,{get:function(M,F,P){if(F==="_vip")return!0;if(F==="table")return function(j){return ja(m.table(j),z)};var O=Reflect.get(M,F,P);return O instanceof Dm?ja(O,z):F==="tables"?O.map(function(j){return ja(j,z)}):F==="_createTransaction"?function(){return ja(O.apply(this,arguments),z)}:O}});this.vip=z,_.forEach(function(M){return M(m)})}var Ba,jt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Pw=(au.prototype.subscribe=function(h,f,m){return this._subscribe(h&&typeof h!="function"?h:{next:h,error:f,complete:m})},au.prototype[jt]=function(){return this},au);function au(h){this._subscribe=h}try{Ba={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{Ba={indexedDB:null,IDBKeyRange:null}}function qm(h){var f,m=!1,_=new Pw(function(v){var T=Ee(h),$,I=!1,L={},E={},z={get closed(){return I},unsubscribe:function(){I||(I=!0,$&&$.abort(),M&&Zn.storagemutated.unsubscribe(P))}};v.start&&v.start(z);var M=!1,F=function(){return Ph(O)},P=function(j){Oa(L,j),Jh(E,L)&&F()},O=function(){var j,R,W;!I&&Ba.indexedDB&&(L={},j={},$&&$.abort(),$=new AbortController,W=function(U){var K=ss();try{T&&os();var q=Gn(h,U);return q=T?q.finally(Yn):q}finally{K&&rs()}}(R={subscr:j,signal:$.signal,requery:F,querier:h,trans:null}),Promise.resolve(W).then(function(U){m=!0,f=U,I||R.signal.aborted||(L={},function(K){for(var q in K)if(u(K,q))return;return 1}(E=j)||M||(Zn(_r,P),M=!0),Ph(function(){return!I&&v.next&&v.next(U)}))},function(U){m=!1,["DatabaseClosedError","AbortError"].includes(U==null?void 0:U.name)||I||Ph(function(){I||v.error&&v.error(U)})}))};return setTimeout(F,0),z});return _.hasValue=function(){return m},_.getValue=function(){return f},_}var xi=xn;function lu(h){var f=Jn;try{Jn=!0,Zn.storagemutated.fire(h),nu(h,!0)}finally{Jn=f}}p(xi,n(n({},ga),{delete:function(h){return new xi(h,{addons:[]}).delete()},exists:function(h){return new xi(h,{addons:[]}).open().then(function(f){return f.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(h){try{return f=xi.dependencies,m=f.indexedDB,f=f.IDBKeyRange,(Yh(m)?Promise.resolve(m.databases()).then(function(_){return _.map(function(v){return v.name}).filter(function(v){return v!==Sa})}):Gh(m,f).toCollection().primaryKeys()).then(h)}catch{return Ye(new de.MissingAPI)}var f,m},defineClass:function(){return function(h){l(this,h)}},ignoreTransaction:function(h){return ue.trans?vi(ue.transless,h):h()},vip:Qh,async:function(h){return function(){try{var f=iu(h.apply(this,arguments));return f&&typeof f.then=="function"?f:le.resolve(f)}catch(m){return Ye(m)}}},spawn:function(h,f,m){try{var _=iu(h.apply(m,f||[]));return _&&typeof _.then=="function"?_:le.resolve(_)}catch(v){return Ye(v)}},currentTransaction:{get:function(){return ue.trans||null}},waitFor:function(h,f){return f=le.resolve(typeof h=="function"?xi.ignoreTransaction(h):h).timeout(f||6e4),ue.trans?ue.trans.waitFor(f):f},Promise:le,debug:{get:function(){return rn},set:function(h){ym(h)}},derive:C,extend:l,props:p,override:A,Events:mr,on:Zn,liveQuery:qm,extendObservabilitySet:Oa,getByKeyPath:G,setByKeyPath:Y,delByKeyPath:function(h,f){typeof f=="string"?Y(h,f,void 0):"length"in f&&[].map.call(f,function(m){Y(h,m,void 0)})},shallowClone:Z,deepClone:ge,getObjectDiff:su,cmp:Le,asap:H,minKey:-1/0,addons:[],connections:as,errnames:Kn,dependencies:Ba,cache:Ci,semVer:"4.0.4",version:"4.0.4".split(".").map(function(h){return parseInt(h)}).reduce(function(h,f,m){return h+f/Math.pow(10,2*m)})})),xi.maxKey=vr(xi.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Zn(_r,function(h){Jn||(h=new CustomEvent(Bh,{detail:h}),Jn=!0,dispatchEvent(h),Jn=!1)}),addEventListener(Bh,function(h){h=h.detail,Jn||lu(h)}));var hs,Jn=!1,Gm=function(){};return typeof BroadcastChannel<"u"&&((Gm=function(){(hs=new BroadcastChannel(Bh)).onmessage=function(h){return h.data&&lu(h.data)}})(),typeof hs.unref=="function"&&hs.unref(),Zn(_r,function(h){Jn||hs.postMessage(h)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(h){if(!xn.disableBfCache&&h.persisted){rn&&console.debug("Dexie: handling persisted pagehide"),hs!=null&&hs.close();for(var f=0,m=as;f<m.length;f++)m[f].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(h){!xn.disableBfCache&&h.persisted&&(rn&&console.debug("Dexie: handling persisted pageshow"),Gm(),lu({all:new mt(-1/0,[[]])}))})),le.rejectionMapper=function(h,f){return!h||h instanceof pt||h instanceof TypeError||h instanceof SyntaxError||!h.name||!lr[h.name]?h:(f=new lr[h.name](f||h.message,h),"stack"in h&&b(f,"stack",{get:function(){return this.inner.stack}}),f)},ym(rn),n(xn,Object.freeze({__proto__:null,Dexie:xn,liveQuery:qm,Entity:Sm,cmp:Le,PropModSymbol:Cn,PropModification:Fh,replacePrefix:function(h,f){return new Fh({replacePrefix:[h,f]})},default:xn,RangeSet:mt,mergeRanges:Cr,rangesOverlap:Ra}),{default:xn}),xn})})(Gd);var a_=Gd.exports;const ql=o_(a_),Yd=Symbol.for("Dexie"),Es=globalThis[Yd]||(globalThis[Yd]=ql);if(ql.semVer!==Es.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ql.semVer} and ${Es.semVer}`);const{liveQuery:l_,mergeRanges:c_,rangesOverlap:h_,RangeSet:u_,cmp:d_,Entity:f_,PropModSymbol:p_,PropModification:m_,replacePrefix:g_}=Es;class Pn{}Pn.TABLE={name:"cache",schema:"++id, type, key, data, createTime, updateTime, [type+key]",version:1},Pn.DEFAULT_TYPE="cache";const Qd=Object.freeze(Object.defineProperty({__proto__:null,CacheData:Pn},Symbol.toStringTag,{value:"Module"})),y_=Object.values(Qd).reduce((i,e)=>Math.max(e.TABLE.version,i),1),__=Object.values(Qd).reduce((i,{TABLE:e})=>(i[e.name]=e.schema,i),{});class Xd extends Es{constructor(e="DataHub"){super(e),this.version(y_).stores(__),this.cache.mapToClass(Pn)}async getCache(e,t=Pn.DEFAULT_TYPE){return this.cache.where("[type+key]").equals([t,e]).first()}async getCacheData(e,t=Pn.DEFAULT_TYPE){const n=await this.getCache(e,t);return n==null?void 0:n.data}async setCacheData(e,t,n,s=Pn.DEFAULT_TYPE){if(t===null)return this.deleteCacheData(e,s);const r=await this.getCache(e,s);return n=n||Date.now(),r?(await this.cache.update(r.id,{data:t,updateTime:n}),r.id):await this.cache.add({key:e,data:t,type:s,createTime:n,updateTime:n})}async deleteCacheData(e,t=Pn.DEFAULT_TYPE){return typeof e=="number"?this.cache.delete(e):this.cache.where("[type+key]").equals([t,e]).delete()}async getPageData(e,t,n){const{currentModule:s,currentMethod:r}=window.config;return this.getCacheData(e,`PAGE_${t||s}_${n||r}`)}setPageData(e,t,n,s){const{currentModule:r,currentMethod:o}=window.config;return this.setCacheData(e,t,void 0,`PAGE_${n||r}_${s||o}`)}}Object.defineProperty(window.$,"db",{get(){var i;return this._db||(window.parent!==window?this._db=window.parent.$.db:this._db=new Xd(`zentao_${((i=window.config)==null?void 0:i.account)||""}`)),this._db}});class Gl extends _e{}Gl.NAME="Avatar",Gl.Component=Oi,Xe(Vy);const L0="",R0="",O0="",z0="";class Yl extends _e{}Yl.NAME="BtnGroup",Yl.Component=Ht,Xe(Object.freeze(Object.defineProperty({__proto__:null,BtnGroup:Ht},Symbol.toStringTag,{value:"Module"})));const j0="",B0="",Zd=Symbol("EVENT_PICK");class uo extends pe{constructor(e){super(e),this._handleClick=this._handleClick.bind(this),this._hasInput=!!y(`#${e.id}`).length}get hasInput(){return this._hasInput}_handleClick(e){const{togglePop:t,clickType:n,onClick:s}=this.props;let r=n==="open"?!0:void 0;const o=y(e.target),a=s==null?void 0:s(e);if(!e.defaultPrevented){if(typeof a=="boolean")r=a;else{if(o.closest('[data-dismiss="pick"]').length){t(!1);return}if(o.closest("a,input").length)return}requestAnimationFrame(()=>t(r))}}_getClass(e){const{state:t,className:n,disabled:s,readonly:r,pickerName:o,empty:a}=e,{open:l}=t;return V("pick",n,o?`${o}-pick`:"",l&&"is-open focus",s&&"disabled",r&&"readonly",a?"is-empty-value":"")}_getProps(e){const{id:t,style:n,attrs:s}=e;return{id:`pick-${t}`,className:this._getClass(e),style:n,tabIndex:-1,onClick:this._handleClick,...s}}_renderTrigger(e){const{children:t,state:n}=e;return t??n.value}_renderValue(e){const{name:t,state:{value:n=""},disabled:s,readonly:r,id:o}=e;if(t)if(this._hasInput)y(`#${o}`).val(n);else return k("input",{id:o,type:"hidden",className:"pick-value",name:t,value:n,readonly:r,disabled:s});return null}componentDidMount(){const{id:e}=this.props;y(`#${e}`).on(`change.zui.pick.${e} syncValue.zui.pick.${e}`,(t,n)=>{if(typeof n=="symbol")return;const s=t.target.value;this._skipTriggerChange=s,this.props.changeState({value:s})})}componentWillUnmount(){const{id:e}=this.props;y(`#${e}`).off(`change.zui.pick.${e}`)}componentDidUpdate(e){const{id:t,state:n,name:s}=this.props;s&&e.state.value!==n.value&&(this._skipTriggerChange!==n.value&&y(`#${t}`).trigger("change",Zd),this._skipTriggerChange=!1)}render(e){return w(e.tagName||"div",this._getProps(e),this._renderTrigger(e),this._renderValue(e))}}const Ln=Math.min,Nt=Math.max,fo=Math.round,po=Math.floor,Jt=i=>({x:i,y:i}),v_={left:"right",right:"left",bottom:"top",top:"bottom"},b_={start:"end",end:"start"};function Ql(i,e,t){return Nt(i,Ln(e,t))}function ji(i,e){return typeof i=="function"?i(e):i}function Rn(i){return i.split("-")[0]}function Bi(i){return i.split("-")[1]}function Jd(i){return i==="x"?"y":"x"}function Xl(i){return i==="y"?"height":"width"}function ui(i){return["top","bottom"].includes(Rn(i))?"y":"x"}function Zl(i){return Jd(ui(i))}function w_(i,e,t){t===void 0&&(t=!1);const n=Bi(i),s=Zl(i),r=Xl(s);let o=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=mo(o)),[o,mo(o)]}function C_(i){const e=mo(i);return[Jl(i),e,Jl(e)]}function Jl(i){return i.replace(/start|end/g,e=>b_[e])}function x_(i,e,t){const n=["left","right"],s=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(i){case"top":case"bottom":return t?e?s:n:e?n:s;case"left":case"right":return e?r:o;default:return[]}}function k_(i,e,t,n){const s=Bi(i);let r=x_(Rn(i),t==="start",n);return s&&(r=r.map(o=>o+"-"+s),e&&(r=r.concat(r.map(Jl)))),r}function mo(i){return i.replace(/left|right|bottom|top/g,e=>v_[e])}function S_(i){return{top:0,right:0,bottom:0,left:0,...i}}function ef(i){return typeof i!="number"?S_(i):{top:i,right:i,bottom:i,left:i}}function go(i){const{x:e,y:t,width:n,height:s}=i;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function tf(i,e,t){let{reference:n,floating:s}=i;const r=ui(e),o=Zl(e),a=Xl(o),l=Rn(e),c=r==="y",d=n.x+n.width/2-s.width/2,u=n.y+n.height/2-s.height/2,p=n[a]/2-s[a]/2;let g;switch(l){case"top":g={x:d,y:n.y-s.height};break;case"bottom":g={x:d,y:n.y+n.height};break;case"right":g={x:n.x+n.width,y:u};break;case"left":g={x:n.x-s.width,y:u};break;default:g={x:n.x,y:n.y}}switch(Bi(e)){case"start":g[o]-=p*(t&&c?-1:1);break;case"end":g[o]+=p*(t&&c?-1:1);break}return g}const T_=async(i,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:i,floating:e,strategy:s}),{x:d,y:u}=tf(c,n,l),p=n,g={},b=0;for(let C=0;C<a.length;C++){const{name:S,fn:x}=a[C],{x:D,y:A,data:B,reset:H}=await x({x:d,y:u,initialPlacement:n,placement:p,strategy:s,middlewareData:g,rects:c,platform:o,elements:{reference:i,floating:e}});d=D??d,u=A??u,g={...g,[S]:{...g[S],...B}},H&&b<=50&&(b++,typeof H=="object"&&(H.placement&&(p=H.placement),H.rects&&(c=H.rects===!0?await o.getElementRects({reference:i,floating:e,strategy:s}):H.rects),{x:d,y:u}=tf(c,p,l)),C=-1)}return{x:d,y:u,placement:p,strategy:s,middlewareData:g}};async function ec(i,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:r,rects:o,elements:a,strategy:l}=i,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:p=!1,padding:g=0}=ji(e,i),b=ef(g),S=a[p?u==="floating"?"reference":"floating":u],x=go(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(S)))==null||t?S:S.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),D=u==="floating"?{x:n,y:s,width:o.floating.width,height:o.floating.height}:o.reference,A=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),B=await(r.isElement==null?void 0:r.isElement(A))?await(r.getScale==null?void 0:r.getScale(A))||{x:1,y:1}:{x:1,y:1},H=go(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:D,offsetParent:A,strategy:l}):D);return{top:(x.top-H.top+b.top)/B.y,bottom:(H.bottom-x.bottom+b.bottom)/B.y,left:(x.left-H.left+b.left)/B.x,right:(H.right-x.right+b.right)/B.x}}const $_=i=>({name:"arrow",options:i,async fn(e){const{x:t,y:n,placement:s,rects:r,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:d=0}=ji(i,e)||{};if(c==null)return{};const u=ef(d),p={x:t,y:n},g=Zl(s),b=Xl(g),C=await o.getDimensions(c),S=g==="y",x=S?"top":"left",D=S?"bottom":"right",A=S?"clientHeight":"clientWidth",B=r.reference[b]+r.reference[g]-p[g]-r.floating[b],H=p[g]-r.reference[g],G=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let Y=G?G[A]:0;(!Y||!await(o.isElement==null?void 0:o.isElement(G)))&&(Y=a.floating[A]||r.floating[b]);const Z=B/2-H/2,ee=Y/2-C[b]/2-1,he=Ln(u[x],ee),X=Ln(u[D],ee),se=he,ge=Y-C[b]-X,be=Y/2-C[b]/2+Z,Me=Ql(se,be,ge),Pe=!l.arrow&&Bi(s)!=null&&be!==Me&&r.reference[b]/2-(be<se?he:X)-C[b]/2<0,ce=Pe?be<se?be-se:be-ge:0;return{[g]:p[g]+ce,data:{[g]:Me,centerOffset:be-Me-ce,...Pe&&{alignmentOffset:ce}},reset:Pe}}}),D_=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var t,n;const{placement:s,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:C=!0,...S}=ji(i,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const x=Rn(s),D=ui(a),A=Rn(a)===a,B=await(l.isRTL==null?void 0:l.isRTL(c.floating)),H=p||(A||!C?[mo(a)]:C_(a)),G=b!=="none";!p&&G&&H.push(...k_(a,C,b,B));const Y=[a,...H],Z=await ec(e,S),ee=[];let he=((n=r.flip)==null?void 0:n.overflows)||[];if(d&&ee.push(Z[x]),u){const be=w_(s,o,B);ee.push(Z[be[0]],Z[be[1]])}if(he=[...he,{placement:s,overflows:ee}],!ee.every(be=>be<=0)){var X,se;const be=(((X=r.flip)==null?void 0:X.index)||0)+1,Me=Y[be];if(Me)return{data:{index:be,overflows:he},reset:{placement:Me}};let Pe=(se=he.filter(ce=>ce.overflows[0]<=0).sort((ce,J)=>ce.overflows[1]-J.overflows[1])[0])==null?void 0:se.placement;if(!Pe)switch(g){case"bestFit":{var ge;const ce=(ge=he.filter(J=>{if(G){const we=ui(J.placement);return we===D||we==="y"}return!0}).map(J=>[J.placement,J.overflows.filter(we=>we>0).reduce((we,ve)=>we+ve,0)]).sort((J,we)=>J[1]-we[1])[0])==null?void 0:ge[0];ce&&(Pe=ce);break}case"initialPlacement":Pe=a;break}if(s!==Pe)return{reset:{placement:Pe}}}return{}}}};async function I_(i,e){const{placement:t,platform:n,elements:s}=i,r=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=Rn(t),a=Bi(t),l=ui(t)==="y",c=["left","top"].includes(o)?-1:1,d=r&&l?-1:1,u=ji(e,i);let{mainAxis:p,crossAxis:g,alignmentAxis:b}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof b=="number"&&(g=a==="end"?b*-1:b),l?{x:g*d,y:p*c}:{x:p*c,y:g*d}}const N_=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var t,n;const{x:s,y:r,placement:o,middlewareData:a}=e,l=await I_(e,i);return o===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:r+l.y,data:{...l,placement:o}}}}},M_=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x,y:D}=S;return{x,y:D}}},...l}=ji(i,e),c={x:t,y:n},d=await ec(e,l),u=ui(Rn(s)),p=Jd(u);let g=c[p],b=c[u];if(r){const S=p==="y"?"top":"left",x=p==="y"?"bottom":"right",D=g+d[S],A=g-d[x];g=Ql(D,g,A)}if(o){const S=u==="y"?"top":"left",x=u==="y"?"bottom":"right",D=b+d[S],A=b-d[x];b=Ql(D,b,A)}const C=a.fn({...e,[p]:g,[u]:b});return{...C,data:{x:C.x-t,y:C.y-n,enabled:{[p]:r,[u]:o}}}}}},E_=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(e){var t,n;const{placement:s,rects:r,platform:o,elements:a}=e,{apply:l=()=>{},...c}=ji(i,e),d=await ec(e,c),u=Rn(s),p=Bi(s),g=ui(s)==="y",{width:b,height:C}=r.floating;let S,x;u==="top"||u==="bottom"?(S=u,x=p===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(x=u,S=p==="end"?"top":"bottom");const D=C-d.top-d.bottom,A=b-d.left-d.right,B=Ln(C-d[S],D),H=Ln(b-d[x],A),G=!e.middlewareData.shift;let Y=B,Z=H;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(Z=A),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(Y=D),G&&!p){const he=Nt(d.left,0),X=Nt(d.right,0),se=Nt(d.top,0),ge=Nt(d.bottom,0);g?Z=b-2*(he!==0||X!==0?he+X:Nt(d.left,d.right)):Y=C-2*(se!==0||ge!==0?se+ge:Nt(d.top,d.bottom))}await l({...e,availableWidth:Z,availableHeight:Y});const ee=await o.getDimensions(a.floating);return b!==ee.width||C!==ee.height?{reset:{rects:!0}}:{}}}};function yo(){return typeof window<"u"}function Hi(i){return nf(i)?(i.nodeName||"").toLowerCase():"#document"}function Mt(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function en(i){var e;return(e=(nf(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function nf(i){return yo()?i instanceof Node||i instanceof Mt(i).Node:!1}function Wt(i){return yo()?i instanceof Element||i instanceof Mt(i).Element:!1}function tn(i){return yo()?i instanceof HTMLElement||i instanceof Mt(i).HTMLElement:!1}function sf(i){return!yo()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Mt(i).ShadowRoot}function As(i){const{overflow:e,overflowX:t,overflowY:n,display:s}=Ut(i);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(s)}function A_(i){return["table","td","th"].includes(Hi(i))}function _o(i){return[":popover-open",":modal"].some(e=>{try{return i.matches(e)}catch{return!1}})}function tc(i){const e=nc(),t=Wt(i)?Ut(i):i;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function P_(i){let e=On(i);for(;tn(e)&&!Wi(e);){if(tc(e))return e;if(_o(e))return null;e=On(e)}return null}function nc(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Wi(i){return["html","body","#document"].includes(Hi(i))}function Ut(i){return Mt(i).getComputedStyle(i)}function vo(i){return Wt(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function On(i){if(Hi(i)==="html")return i;const e=i.assignedSlot||i.parentNode||sf(i)&&i.host||en(i);return sf(e)?e.host:e}function rf(i){const e=On(i);return Wi(e)?i.ownerDocument?i.ownerDocument.body:i.body:tn(e)&&As(e)?e:rf(e)}function Ps(i,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=rf(i),r=s===((n=i.ownerDocument)==null?void 0:n.body),o=Mt(s);if(r){const a=ic(o);return e.concat(o,o.visualViewport||[],As(s)?s:[],a&&t?Ps(a):[])}return e.concat(s,Ps(s,[],t))}function ic(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function of(i){const e=Ut(i);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=tn(i),r=s?i.offsetWidth:t,o=s?i.offsetHeight:n,a=fo(t)!==r||fo(n)!==o;return a&&(t=r,n=o),{width:t,height:n,$:a}}function sc(i){return Wt(i)?i:i.contextElement}function Ui(i){const e=sc(i);if(!tn(e))return Jt(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:r}=of(e);let o=(r?fo(t.width):t.width)/n,a=(r?fo(t.height):t.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const L_=Jt(0);function af(i){const e=Mt(i);return!nc()||!e.visualViewport?L_:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function R_(i,e,t){return e===void 0&&(e=!1),!t||e&&t!==Mt(i)?!1:e}function di(i,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=i.getBoundingClientRect(),r=sc(i);let o=Jt(1);e&&(n?Wt(n)&&(o=Ui(n)):o=Ui(i));const a=R_(r,t,n)?af(r):Jt(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,d=s.width/o.x,u=s.height/o.y;if(r){const p=Mt(r),g=n&&Wt(n)?Mt(n):n;let b=p,C=ic(b);for(;C&&n&&g!==b;){const S=Ui(C),x=C.getBoundingClientRect(),D=Ut(C),A=x.left+(C.clientLeft+parseFloat(D.paddingLeft))*S.x,B=x.top+(C.clientTop+parseFloat(D.paddingTop))*S.y;l*=S.x,c*=S.y,d*=S.x,u*=S.y,l+=A,c+=B,b=Mt(C),C=ic(b)}}return go({width:d,height:u,x:l,y:c})}function rc(i,e){const t=vo(i).scrollLeft;return e?e.left+t:di(en(i)).left+t}function lf(i,e,t){t===void 0&&(t=!1);const n=i.getBoundingClientRect(),s=n.left+e.scrollLeft-(t?0:rc(i,n)),r=n.top+e.scrollTop;return{x:s,y:r}}function O_(i){let{elements:e,rect:t,offsetParent:n,strategy:s}=i;const r=s==="fixed",o=en(n),a=e?_o(e.floating):!1;if(n===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=Jt(1);const d=Jt(0),u=tn(n);if((u||!u&&!r)&&((Hi(n)!=="body"||As(o))&&(l=vo(n)),tn(n))){const g=di(n);c=Ui(n),d.x=g.x+n.clientLeft,d.y=g.y+n.clientTop}const p=o&&!u&&!r?lf(o,l,!0):Jt(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+d.x+p.x,y:t.y*c.y-l.scrollTop*c.y+d.y+p.y}}function z_(i){return Array.from(i.getClientRects())}function F_(i){const e=en(i),t=vo(i),n=i.ownerDocument.body,s=Nt(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=Nt(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+rc(i);const a=-t.scrollTop;return Ut(n).direction==="rtl"&&(o+=Nt(e.clientWidth,n.clientWidth)-s),{width:s,height:r,x:o,y:a}}function j_(i,e){const t=Mt(i),n=en(i),s=t.visualViewport;let r=n.clientWidth,o=n.clientHeight,a=0,l=0;if(s){r=s.width,o=s.height;const c=nc();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:r,height:o,x:a,y:l}}function B_(i,e){const t=di(i,!0,e==="fixed"),n=t.top+i.clientTop,s=t.left+i.clientLeft,r=tn(i)?Ui(i):Jt(1),o=i.clientWidth*r.x,a=i.clientHeight*r.y,l=s*r.x,c=n*r.y;return{width:o,height:a,x:l,y:c}}function cf(i,e,t){let n;if(e==="viewport")n=j_(i,t);else if(e==="document")n=F_(en(i));else if(Wt(e))n=B_(e,t);else{const s=af(i);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return go(n)}function hf(i,e){const t=On(i);return t===e||!Wt(t)||Wi(t)?!1:Ut(t).position==="fixed"||hf(t,e)}function H_(i,e){const t=e.get(i);if(t)return t;let n=Ps(i,[],!1).filter(a=>Wt(a)&&Hi(a)!=="body"),s=null;const r=Ut(i).position==="fixed";let o=r?On(i):i;for(;Wt(o)&&!Wi(o);){const a=Ut(o),l=tc(o);!l&&a.position==="fixed"&&(s=null),(r?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||As(o)&&!l&&hf(i,o))?n=n.filter(d=>d!==o):s=a,o=On(o)}return e.set(i,n),n}function W_(i){let{element:e,boundary:t,rootBoundary:n,strategy:s}=i;const o=[...t==="clippingAncestors"?_o(e)?[]:H_(e,this._c):[].concat(t),n],a=o[0],l=o.reduce((c,d)=>{const u=cf(e,d,s);return c.top=Nt(u.top,c.top),c.right=Ln(u.right,c.right),c.bottom=Ln(u.bottom,c.bottom),c.left=Nt(u.left,c.left),c},cf(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function U_(i){const{width:e,height:t}=of(i);return{width:e,height:t}}function V_(i,e,t){const n=tn(e),s=en(e),r=t==="fixed",o=di(i,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=Jt(0);if(n||!n&&!r)if((Hi(e)!=="body"||As(s))&&(a=vo(e)),n){const p=di(e,!0,r,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else s&&(l.x=rc(s));const c=s&&!n&&!r?lf(s,a):Jt(0),d=o.left+a.scrollLeft-l.x-c.x,u=o.top+a.scrollTop-l.y-c.y;return{x:d,y:u,width:o.width,height:o.height}}function oc(i){return Ut(i).position==="static"}function uf(i,e){if(!tn(i)||Ut(i).position==="fixed")return null;if(e)return e(i);let t=i.offsetParent;return en(i)===t&&(t=t.ownerDocument.body),t}function df(i,e){const t=Mt(i);if(_o(i))return t;if(!tn(i)){let s=On(i);for(;s&&!Wi(s);){if(Wt(s)&&!oc(s))return s;s=On(s)}return t}let n=uf(i,e);for(;n&&A_(n)&&oc(n);)n=uf(n,e);return n&&Wi(n)&&oc(n)&&!tc(n)?t:n||P_(i)||t}const K_=async function(i){const e=this.getOffsetParent||df,t=this.getDimensions,n=await t(i.floating);return{reference:V_(i.reference,await e(i.floating),i.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function q_(i){return Ut(i).direction==="rtl"}const G_={convertOffsetParentRelativeRectToViewportRelativeRect:O_,getDocumentElement:en,getClippingRect:W_,getOffsetParent:df,getElementRects:K_,getClientRects:z_,getDimensions:U_,getScale:Ui,isElement:Wt,isRTL:q_};function Y_(i,e){let t=null,n;const s=en(i);function r(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),r();const{left:c,top:d,width:u,height:p}=i.getBoundingClientRect();if(a||e(),!u||!p)return;const g=po(d),b=po(s.clientWidth-(c+u)),C=po(s.clientHeight-(d+p)),S=po(c),D={rootMargin:-g+"px "+-b+"px "+-C+"px "+-S+"px",threshold:Nt(0,Ln(1,l))||1};let A=!0;function B(H){const G=H[0].intersectionRatio;if(G!==l){if(!A)return o();G?o(!1,G):n=setTimeout(()=>{o(!1,1e-7)},1e3)}A=!1}try{t=new IntersectionObserver(B,{...D,root:s.ownerDocument})}catch{t=new IntersectionObserver(B,D)}t.observe(i)}return o(!0),r}function ff(i,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=sc(i),d=s||r?[...c?Ps(c):[],...Ps(e)]:[];d.forEach(x=>{s&&x.addEventListener("scroll",t,{passive:!0}),r&&x.addEventListener("resize",t)});const u=c&&a?Y_(c,t):null;let p=-1,g=null;o&&(g=new ResizeObserver(x=>{let[D]=x;D&&D.target===c&&g&&(g.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var A;(A=g)==null||A.observe(e)})),t()}),c&&!l&&g.observe(c),g.observe(e));let b,C=l?di(i):null;l&&S();function S(){const x=di(i);C&&(x.x!==C.x||x.y!==C.y||x.width!==C.width||x.height!==C.height)&&t(),C=x,b=requestAnimationFrame(S)}return t(),()=>{var x;d.forEach(D=>{s&&D.removeEventListener("scroll",t),r&&D.removeEventListener("resize",t)}),u==null||u(),(x=g)==null||x.disconnect(),g=null,l&&cancelAnimationFrame(b)}}const ac=N_,lc=M_,cc=D_,pf=E_,Q_=$_,hc=(i,e,t)=>{const n=new Map,s={platform:G_,...t},r={...s.platform,_c:n};return T_(i,e,{...s,platform:r})};class uc extends pe{constructor(e){super(e),this._ref=fe(),this._handleDocClick=t=>{const{state:{open:n},id:s,togglePop:r}=this.props,o=y(t.target);n!=="closing"&&!o.closest(`#pick-${s},#pick-pop-${s}`).length&&o.parent().length&&r(!1)},this._handleClick=this._handleClick.bind(this)}get trigger(){return y(`#pick-${this.props.id}`)[0]}get element(){var e;return(e=this._ref)==null?void 0:e.current}get container(){return this._container}_handleClick(e){const{togglePop:t,onClickItem:n,state:s}=this.props,r=y(e.target),o=r.closest("[data-pick-value]");if(n&&n(e,s.value),o.length)return e.stopPropagation(),t(!1,{value:`${o.dataset("pickValue")}`});if(r.closest('[data-dismiss="pick"]').length)return t(!1)}_getClass(e){const{className:t,state:n,pickerName:s,empty:r}=e,{open:o}=n;return V("pick-pop",s?`${s}-pick-pop`:"",t,o===!0&&"in",r?"is-empty-value":"")}_getProps(e){const{id:t,style:n,maxHeight:s,maxWidth:r,minHeight:o,minWidth:a}=e,l=y.extend({maxHeight:s,maxWidth:r,minHeight:o,minWidth:a},n);return{id:`pick-pop-${t}`,className:this._getClass(e),style:l,ref:this._ref,onClick:this._handleClick}}_getContainer(e){if(!this._container){const t=y(e.container||"body");let n=t.find(".pick-container");n.length||(n=y("<div>").addClass("pick-container").appendTo(t)),this._container=n[0]}return this._container}_render(e){return k("div",{...this._getProps(e),children:this._renderPop(e)})}_renderPop(e){return e.children}_getStyle(e={},t){var c;const n=(c=this.trigger)==null?void 0:c.getBoundingClientRect();if(!n)return{};const{width:s,minWidth:r,maxWidth:o,maxHeight:a}=this.props,l=n.width;if(typeof s=="function"?e.width=s():s==="100%"?e.width=l:s&&(e.width=Be(s)),r==="100%"&&(e.minWidth=l),o==="100%"&&(e.maxWidth=l),this.props.limitInScreen&&t&&(!a||a==="auto"||typeof a=="number")){let d;if(t.includes("bottom"))d=window.innerHeight-n.bottom-2;else{const u=this.element.getBoundingClientRect().height;d=n.top,u>d&&typeof e.top=="number"&&(e.top+=u-d)}d&&(e.maxHeight=typeof a=="number"?Math.min(d,a):d)}else a&&(e.maxHeight=a);return e}layout(){const{element:e,trigger:t,props:n}=this,{state:s}=n;if(!e||!t||!s.open){this._layoutWatcher&&(this._layoutWatcher(),this._layoutWatcher=void 0);return}this._layoutWatcher||(this._layoutWatcher=ff(t,e,()=>{const{placement:r,width:o}=n;hc(t,e,{placement:!r||r==="auto"?"bottom-start":r,middleware:[r==="auto"?cc():null,lc(),ac(1)].filter(Boolean)}).then(({x:a,y:l,placement:c})=>{var d,u;if(Nn(t)||!bs(t)){y(e).css({display:"none"});return}y(e).css(this._getStyle({left:a,top:l},c)),(u=(d=this.props).onLayout)==null||u.call(d,e)}),o==="100%"&&y(e).css(this._getStyle())}))}componentDidMount(){var e,t;this.layout(),y(document).on("click",this._handleDocClick),(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!0})}componentDidUpdate(){var e,t;(t=(e=this.props).afterRender)==null||t.call(e,{firstRender:!1})}componentWillUnmount(){var t,n;y(document).off("click",this._handleDocClick);const e=this._layoutWatcher;e&&(e(),this._layoutWatcher=void 0),this._container=void 0,this._ref=void 0,y(`#pick-pop-${this.props.id}`).remove(),(n=(t=this.props).beforeDestroy)==null||n.call(t)}render(e){return Bd(this._render(e),this._getContainer(e))}}const H0="";let rt=class extends pe{constructor(e){super(e),this._toggleTimer=0,this._pop=fe(),this._trigger=fe(),this.toggle=async(t,n)=>{(this.props.disabled||this.props.readonly)&&(t=!1);const{state:s}=this;if(typeof t=="boolean"&&t===(!!s.open&&s.open!=="closing"))return n&&await this.changeState(n),this.state;this._toggleTimer&&(clearTimeout(this._toggleTimer),this._toggleTimer=0);let r=await this.changeState(a=>(t=t??!a.open,{open:t?"opening":"closing",...n}));const{open:o}=r;return o==="closing"?(await gs(200,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!1})):o==="opening"&&(await gs(50,a=>{this._toggleTimer=a}),this._toggleTimer=0,r=await this.changeState({open:!0})),r},this._id=e.id??`_pick${ft()}`,this.changeState=this.changeState.bind(this),this.state=this.getDefaultState(e)}get id(){return this._id}get pop(){return this._pop.current}get trigger(){return this._trigger.current}get value(){return this.state.value}getDefaultState(e){return{value:String((e||this.props).defaultValue??""),open:!1}}resetState(e,t){const n=this.getDefaultState(e);t?this.state=n:this.changeState(n)}changeState(e,t){return new Promise(n=>{this.setState(e,()=>{t==null||t(),n(this.state)})})}open(e){return this.toggle(!0,e)}close(e){return this.toggle(!1,e)}_getTriggerProps(e,t){return{id:this.id,ref:this._trigger,state:t,className:e.className,pickerName:e.pickerName,style:e.style,name:e.name,tagName:e.tagName,attrs:e.attrs,disabled:e.disabled,readonly:e.readonly,clickType:e.clickType,onClick:e.onClick,changeState:this.changeState,togglePop:this.toggle}}_getPopProps(e,t){return{id:this.id,state:t,className:e.popClass,pickerName:e.pickerName,style:e.popStyle,disabled:e.disabled,readonly:e.readonly,changeState:this.changeState,togglePop:this.toggle,placement:e.popPlacement,container:e.popContainer,width:e.popWidth,height:e.popHeight,minHeight:e.popMinHeight,maxHeight:e.popMaxHeight,maxWidth:e.popMaxWidth,minWidth:e.popMinWidth,limitInScreen:e.limitPopInScreen,onClickItem:e.onClickItem}}_renderTrigger(e,t){return null}_renderPop(e,t){return null}_afterRender(e=!1){var t;(t=this.props.afterRender)==null||t.call(this,{firstRender:e})}_getPop(e){return e.Pop||this.constructor.Pop}_getTrigger(e){return e.Trigger||this.constructor.Trigger}_isEmptyValue(){const{value:e}=this.state;return e==null||e===""}_handleChange(e,t){const{onChange:n}=this.props;n&&n.call(this,e,t)}_handlePopToggle(e){const{onPopShown:t,onPopHidden:n}=this.props;e===!0&&t?t.call(this):!e&&n&&n.call(this)}setValue(e,t){if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.changeState({value:e})}componentDidMount(){this._afterRender(!0)}componentWillUpdate(e,t){const{open:n}=this.state,{open:s}=t;if(!n==!s)return;const{onPopShow:r,onPopHide:o}=this.props;s&&r?r.call(this):!s&&o&&o.call(this)}componentDidUpdate(e,t){const{open:n,value:s}=this.state,{open:r,value:o}=t;!!n!=!!r&&this._handlePopToggle(!!n),s!==o&&this._handleChange(s,o),this._afterRender()}componentWillUnmount(){var t;(t=this.props.beforeDestroy)==null||t.call(this),this._toggleTimer&&clearTimeout(this._toggleTimer);const e=this._pop.current;e&&e.componentWillUnmount&&e.componentWillUnmount()}render(e,t){const{open:n}=t,s=this._getTrigger(e);let r;if(n&&(!e.hidePopWhenEmpty||!this._isEmptyValue())){const o=this._getPop(e);r=k(o,{ref:this._pop,...this._getPopProps(e,t),children:this._renderPop(e,t)},"pop")}return k(In,{children:[k(s,{...this._getTriggerProps(e,t),children:this._renderTrigger(e,t)},"pick"),r]})}};rt.Trigger=uo,rt.Pop=uc,rt.defaultProps={popContainer:"body",popClass:"popup",popWidth:"100%",popPlacement:"auto",popMinWidth:50,popMinHeight:32,popMaxHeight:300,limitPopInScreen:!0,clickType:"open"};let mf=class extends rt{getDefaultState(e){const t=super.getDefaultState(e);return t.value===void 0&&(e||this.props).required&&(t.value=this.getColors()[0]),t}getColors(){const{colors:e}=this.props;return typeof e=="string"?e.split(","):e||[]}componentDidMount(){this.syncColor()}syncColor(){const{syncBackground:e,syncBorder:t,syncColor:n,syncValue:s}=this.props,r=this.state.value||"";if(e&&y(e).css("backgroundColor",r),t&&y(t).css("borderColor",r),n&&y(n).css("color",r),s){const o=y(s);o.is("input,textarea,select")?o.val(r):o.text(r)}}_handleChange(e,t){this.props.disabled||(super._handleChange(e,t),this.syncColor())}_renderTrigger(e,t){const{icon:n}=e,{value:s}=t;return[n?k(Ie,{icon:n},"icon"):k("span",{class:"color-picker-item bg-current ring ring-gray ring-inset",style:{background:s}})]}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return n.style=y.extend({color:t.value},n.style),n.className=V("color-picker",n.className,{disabled:e.disabled}),n}_renderPop(e,t){const{closeBtn:n,heading:s}=e,r=this.getColors(),{value:o}=t;let a;return s&&(a=k("div",{className:"color-picker-heading",children:[s,n?k("button",{className:"btn ghost square rounded size-sm","data-dismiss":"pick",children:k("span",{class:"close"})}):null]},"heading")),[a,k("div",{className:"color-picker-row",children:[r.map(l=>k("button",{className:"btn color-picker-item",style:{backgroundColor:l},"data-pick-value":l,children:o===l?k(Ie,{icon:"check"}):null},l)),k("button",{className:"btn color-picker-item","data-pick-value":"",children:k(Ie,{className:"text-fore",icon:"trash"})})]},"row")]}};mf.defaultProps={...rt.defaultProps,className:"rounded btn square size-sm ghost",popClass:"color-picker-pop popup",colors:["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#14b8a6","#0ea5e9","#6366f1","#a855f7","#d946ef","#ec4899"],closeBtn:!0,popWidth:"auto",popMinWidth:184};class dc extends _e{}dc.NAME="ColorPicker",dc.Component=mf;const W0="";class gf extends pe{constructor(){super(...arguments),this._ref=fe(),this._handleClickItem=(e,t)=>{var n,s;(s=(n=this.props).onChange)==null||s.call(n,e,+t.item.key)}}componentDidMount(){setTimeout(()=>{y(this._ref.current).find(".menu-item>.active").scrollIntoView({container:".menu"})},100)}render(e){const{minuteStep:t=5,hour:n,minute:s}=e,r=[],o=[];for(let l=0;l<24;++l)r.push({key:String(l),text:l<10?`0${l}`:l,active:n===l});for(let l=0;l<60;l+=t)o.push({key:String(l),text:l<10?`0${l}`:l,active:s===l});const a="col w-10 max-h-full overflow-y-auto scrollbar-thin scrollbar-hover";return k("div",{className:"time-picker-menu row",ref:this._ref,children:[k(xt,{className:a,items:r,onClickItem:this._handleClickItem.bind(this,"hour")}),k(xt,{className:a,items:o,onClickItem:this._handleClickItem.bind(this,"minute")})]})}}const U0="",yf=i=>{if(!i)return;const e=We(`1999-01-01 ${i}`);if(!Number.isNaN(e.getDay()))return e};let bo=class extends rt{constructor(){super(...arguments),this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setTime(e.target.value)},this._handleSetTime=(e,t)=>{this.setTime({[e]:String(t)})},this._handleClearBtnClick=()=>{this.setTime("")}}getDefaultState(e){const t=super.getDefaultState(e);return t.value==="now"&&(t.value=ht(new Date,(e||this.props).format)),t}setTime(e,t){if(!t&&(this.props.disabled||this.props.readonly))return;let n="";if(typeof e=="string")n=e;else{const[c,d]=(this.state.value||"00:00").split(":"),{hour:u=+c,minute:p=+d}=e;n=`${u}:${p}`}const s=yf(n),{onInvalid:r,required:o,defaultValue:a,format:l}=this.props;return this.changeState({value:s?ht(s,l):o?a:""},()=>{!s&&r&&r(n)})}setValue(e,t){if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.setTime(e,!0)}getTime(){const e=yf(this.state.value);return e?[e.getHours(),e.getMinutes()]:null}_renderTrigger(e,t){const{placeholder:n,icon:s,required:r,disabled:o,readonly:a}=e,{value:l="",open:c}=t,d=`time-picker-${this.id}`;let u;return c&&!r&&l.length?u=k("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:k("span",{className:"close"})}):s&&(s===!0?u=k("i",{class:"i-time"}):u=k(Ie,{icon:s})),[k("input",{id:d,type:"text",className:"form-control",placeholder:n,value:l,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),u?k("label",{for:d,className:"input-control-suffix",children:u},"icon"):null]}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return{...n,className:V(n.className,"time-picker input-control has-suffix-icon")}}_renderPop(e){const[t,n]=this.getTime()||[];return k(gf,{hour:t,minute:n,minuteStep:e.minuteStep,onChange:this._handleSetTime})}};bo.defaultProps={...rt.defaultProps,popWidth:"auto",popMaxHeight:320,minuteStep:5,format:"hh:mm",icon:!0};function X_(i,e,t){return e&&i<e?e:t&&i>t?t:i}function Ls(i){if(i==null)return null;if(typeof i=="function"&&(i=i()),typeof i=="string"&&i.startsWith("today")){const e=new Date;i.length>6?i=ud(e,i.substring(5).replace("+","")):i=e}else i=We(i);return $l(i)?i:null}const V0="";Ne.addLang({zh_cn:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},zh_tw:{today:"今天",yearFormat:"{0}年",weekNames:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},en:{today:"Today",yearFormat:"{0}",weekNames:["SUN","MON","TUE","WED","THU","FRI","SAT"],monthNames:["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sept.","Oct.","Nov.","Dec."]}});const Z_=(i,e,t=0)=>{const n=new Date(i,e-1,1),s=n.getDay(),r=n.getTime()-(7+s-t)%7*Ei;return{days:7*5,startTime:r,firstDay:n.getTime()}},_f=(i,e)=>new Set((Array.isArray(i)?i:[i]).map(t=>ht(t,e)));class J_ extends pe{constructor(){super(...arguments),this._handleClickDate=e=>{const{onClickDate:t}=this.props;if(!t)return;const n=y(e.target).closest(".mini-calendar-day").dataset("date");n&&t(n)}}render(e){var he,X;const t=new Date,{weekStart:n=1,weekNames:s=Ne.getLang("weekNames"),monthNames:r=Ne.getLang("monthNames"),year:o=t.getFullYear(),month:a=t.getMonth()+1,highlights:l=[],selections:c=[],maxDate:d,minDate:u,isAllowDate:p}=e,g=[],b="btn ghost square rounded-full";for(let se=0;se<7;se++){const ge=(n+se)%7;g.push(k("div",{className:V("col mini-calendar-day",{"is-weekend":ge===0||ge===6}),children:k("div",{children:s?s[ge]:ge})},se))}const{startTime:C,days:S,firstDay:x}=Z_(o,a,n),D=x+S*Ei;let A=C;const B=[],H="yyyy-MM-dd",G=_f(l,H),Y=_f(c,H),Z=((he=d?We(d):null)==null?void 0:he.getTime())??Number.MAX_SAFE_INTEGER,ee=((X=u?We(u):null)==null?void 0:X.getTime())??0;for(;A<=D;){const se=[];for(let ge=0;ge<7;ge++){const be=new Date(A);let Me=(p==null?void 0:p(be))??!0;typeof Me=="boolean"&&(Me={allow:Me});const Pe=be.getDate(),ce=ht(be,H),J=be.getDay(),we=Tl(be,x),ve=V("col mini-calendar-day",{active:G.has(ce),selected:Y.has(ce),"is-first":Pe===1,"is-in-month":we,"is-out-month":!we,"is-today":Mn(be,t),"is-weekend":J===0||J===6,disabled:!Me.allow||(A>Z||A<ee)&&!Mn(be,Z)&&!Mn(be,ee)});se.push(k("div",{className:ve,"data-date":ce,children:k("button",{type:"button",className:b,onClick:this._handleClickDate,title:Me.hint,children:Pe===1&&r?r[be.getMonth()]:be.getDate()})},ce)),A+=Ei}B.push(k("div",{className:"row",children:se},A))}return k("div",{className:"mini-calendar",children:[k("div",{className:"row",children:g}),B]})}}class vf extends pe{constructor(){super(...arguments);Ot(this,da,fe());Ot(this,fa,t=>{const{onChange:n}=this.props;if(!n)return;const r=y(t.target).closest("[data-value]").dataset("value");r&&(n(+r),t.stopPropagation())})}render(t){const{className:n,max:s,min:r,value:o}=t,a=[],l=new Date().getFullYear();for(let c=r;c<=s;++c)a.push(k(ke,{type:"ghost","data-value":c,active:c===o,className:V(l===c?"is-current":""),onClick:St(this,fa),children:c},c));return k("div",{className:n,ref:St(this,da),children:a})}}da=new WeakMap,fa=new WeakMap;class ev extends pe{constructor(t){super(t);Ot(this,pa);Ot(this,ma);Ot(this,nr,void 0);Ot(this,ir,void 0);Ot(this,sr,void 0);Ot(this,rr,void 0);Ot(this,or,void 0);Ot(this,ar,void 0);Bt(this,nr,fe()),Bt(this,ir,r=>{const o=y(r.target).closest("[data-set-date]");o.length&&this.changeDate(o.dataset("set-date"))}),Bt(this,sr,()=>{const{year:r,month:o}=this.state;o===1?this.setState({year:r-1,month:12}):this.setState({month:o-1})}),Bt(this,rr,()=>{const{year:r,month:o}=this.state;o===12?this.setState({year:r+1,month:1}):this.setState({month:o+1})}),Bt(this,or,r=>{this.setState({year:r,select:"day"})}),Bt(this,ar,r=>{this.setState({month:r,select:"day"})}),this.changeDate=r=>{var o,a;(a=(o=this.props).onChange)==null||a.call(o,r)};const{date:n}=t,s=Ls(n)||new Date;this.state={select:"day",year:s.getFullYear(),month:s.getMonth()+1}}_showSelect(t){this.setState(n=>n.select===t?{select:"day"}:{select:t})}render(t,n){const{date:s,yearText:r=Ne.getLang("yearFormat")||"{0}",weekNames:o=Ne.getLang("weekNames"),monthNames:a=Ne.getLang("monthNames"),minDate:l,maxDate:c,weekStart:d}=t,u=Ls(s),{year:p,month:g,select:b}=n,C=b==="day",S=l||We("1970-1-1"),x=c||We("2099-12-31");return k("div",{className:"date-picker-menu row",ref:St(this,nr),onClick:St(this,ir),children:[uu(this,pa,tg).call(this,t),k("div",{className:"cell",style:"width: 312px",children:[k("div",{className:"row p-2",children:[k(ke,{type:b==="year"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"year"),children:Ce(r,p)}),k(ke,{type:b==="month"?"primary-pale":"ghost",size:"sm",caret:!0,onClick:this._showSelect.bind(this,"month"),children:a?a[g-1]:g}),k("div",{className:"flex-auto"}),C?k("div",{children:[k(ke,{type:"ghost",size:"sm",square:!0,onClick:St(this,sr),children:k("i",{className:"chevron-left"})}),k(ke,{type:"ghost",size:"sm",square:!0,onClick:St(this,rr),children:k("i",{className:"chevron-right"})})]}):null]}),C?k(J_,{weekStart:d,weekNames:o,monthNames:a,maxDate:x,minDate:S,year:p,month:g,selections:u||[],onClickDate:this.changeDate,isAllowDate:t.isAllowDate}):null,b==="year"?k(vf,{className:"date-pick-menu-years overflow-y-auto scrollbar-hover scrollbar-thin",value:p,min:S.getFullYear(),max:x.getFullYear(),onChange:St(this,or)}):b==="month"?k(vf,{className:"date-pick-menu-month overflow-y-auto scrollbar-hover scrollbar-thin",value:g,min:1,max:12,onChange:St(this,ar)}):null,C?uu(this,ma,ng).call(this,t):null]})]})}}nr=new WeakMap,ir=new WeakMap,sr=new WeakMap,rr=new WeakMap,or=new WeakMap,ar=new WeakMap,pa=new WeakSet,tg=function(t){return xt.render(t.menu,[],{onClickItem:n=>{const s=n.item.value;typeof s=="string"&&this.changeDate(s)}},this)},ma=new WeakSet,ng=function(t){let{actions:n}=t;const{todayText:s=Ne.getLang("today"),clearText:r}=t;return n===void 0&&(n=[{text:s,"data-set-date":ht(new Date,"yyyy-MM-dd")}]),Array.isArray(n)&&(n={items:n}),k("div",{className:"date-picker-menu-footer",children:[k(He,{btnProps:{className:"ghost text-primary"},...n}),r?k(ke,{type:"ghost text-link","data-set-date":"",children:r}):null]})};const K0="";let Vi=class extends rt{constructor(){super(...arguments),this.setDate=(e,t)=>{const{disabled:n,readonly:s}=this.props;if(!t&&(n||s))return;const r=this._calcValue(e);return this.changeState({value:r},()=>{this._afterSetDate()})},this._handleInputFocus=()=>{this.toggle(!0)},this._handleInputChange=e=>{this.setDate(e.target.value)},this._handleClearBtnClick=()=>{this.setDate("")},this._handleSetDate=e=>{this.setDate(e)}}getDefaultState(e){const t=super.getDefaultState(e);return{...t,value:this._calcValue(t.value)}}getDate(){return this._date}setValue(e,t){if(t){const n=this._trigger.current;n&&(n._skipTriggerChange=e)}return this.setDate(e,!0)}_calcValue(e){const{onInvalid:t,defaultValue:n="",required:s,allowInvalid:r,format:o}=this.props;let a=this._parseDate(e);if(!a&&t){const l=t(e);l&&(a=this._parseDate(l))}return this._date=a,a?ht(a,o):r?e:s?n:""}_getDateRange(e){const{minDate:t,maxDate:n}=this.props;return[Ls(typeof t=="function"?t(e):t),Ls(typeof n=="function"?n(e):n)]}_parseDate(e){const t=Ls(e);return t&&this._isAllowDate(t)?X_(t,...this._getDateRange(e)):null}_afterSetDate(){this.toggle(!1)}_renderTrigger(e,t){const{placeholder:n,icon:s,required:r,disabled:o,readonly:a,display:l}=e,{value:c="",open:d}=t,u=`date-picker-${this.id}`;let p;d&&!r&&c.length?p=k("button",{type:"button",className:"btn size-sm square ghost",onClick:this._handleClearBtnClick,children:k("span",{className:"close"})}):s&&(s===!0?p=k("i",{class:"i-calendar"}):p=k(Ie,{icon:s}));const g=d?c:l?l(c,this._date):c;return[k("input",{id:u,type:"text",className:"form-control",placeholder:n,value:g,disabled:o,readOnly:a,autoComplete:"off",onFocus:this._handleInputFocus,onChange:this._handleInputChange},"input"),p?k("label",{for:u,className:"input-control-suffix",children:p},"icon"):null]}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return{...n,className:V(n.className,"date-picker input-control has-suffix-icon")}}_getPopProps(e,t){const n=super._getPopProps(e,t);return{...n,className:V(n.className,"popup")}}_isAllowDate(e){var n;const t=((n=this.props.isAllowDate)==null?void 0:n.call(this,e))??!0;return t===!0||typeof t=="object"&&t&&t.allow}_renderPop(e,t){const{weekNames:n,monthNames:s,weekStart:r,yearText:o,todayText:a,clearText:l,menu:c,actions:d,required:u,isAllowDate:p}=e,[g,b]=this._getDateRange(t.value);return k(ev,{onChange:this._handleSetDate,date:this._date,weekNames:n,monthNames:s,weekStart:r,yearText:o,todayText:a,clearText:u?"":l,menu:c,actions:d,minDate:g,maxDate:b,isAllowDate:p?this._isAllowDate.bind(this):void 0})}};Vi.defaultProps={...rt.defaultProps,popWidth:"auto",popMaxHeight:320,format:"yyyy-MM-dd",icon:!0,limitPopInScreen:!1};let fc=class extends Vi{constructor(){super(...arguments),this._handleSetDate=e=>{const t=We(e),n=this.getDate()||new Date;t.setHours(n.getHours()),t.setMinutes(n.getMinutes()),this.setDate(ht(t,this.props.format))},this._handleSetTime=(e,t)=>{const n=this.getDate()||new Date;e==="hour"?n.setHours(t):n.setMinutes(t),this.setDate(ht(n,this.props.format))}}getTime(){const e=this.getDate();return e?[e.getHours(),e.getMinutes()]:null}_afterSetDate(){}_renderPop(e,t){const[n,s]=this.getTime()||[];return k("div",{className:"datetime-picker-menu row",children:[super._renderPop(e,t),k("div",{className:"divider"}),k(gf,{hour:n,minute:s,minuteStep:e.minuteStep,onChange:this._handleSetTime})]})}};fc.defaultProps={...Vi.defaultProps,popMaxHeight:310,format:"yyyy-MM-dd hh:mm",minuteStep:5};class wo extends _e{}wo.NAME="TimePicker",wo.Component=bo,wo.register();class Co extends _e{}Co.NAME="DatePicker",Co.Component=Vi,Co.register();class xo extends _e{}xo.NAME="DatetimePicker",xo.Component=fc,xo.register();const q0="",bf="show",pc="in",tv='[data-dismiss="modal"]',ko="modal-hide",Ki=class Si extends ze{constructor(){super(...arguments),this._timer=0,this._handleClick=e=>{const t=e.target,n=t.closest(".modal");!n||n!==this.modalElement||(t.closest(tv)||this.options.backdrop===!0&&t===n)&&(e.preventDefault(),this.hide())}}static get SELECTOR(){return".modal"}get modalElement(){return this.element}get shown(){return this._shown}get dialog(){return this.modalElement.querySelector(".modal-dialog")}get rob(){return this._rob}_observeResize(){var e;if(this.options.responsive&&typeof ResizeObserver<"u"){(e=this._rob)==null||e.disconnect();const{dialog:t}=this;if(t){const n=new ResizeObserver(()=>{if(!this._shown)return;const s=t.clientWidth,r=t.clientHeight,[o,a]=this._lastDialogSize||[];(o!==s||a!==r)&&(this._lastDialogSize=[s,r],this.layout())});n.observe(t),this._rob=n}}}afterInit(){this.on("click",this._handleClick),this.options.show&&this.show(),this._observeResize(),this.on("hidden",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();e.target.closest(".modal")===t&&!Si.getAll().some(n=>n.shown)&&y("html").enableScroll()}),this.on("show",e=>{const{modalElement:t}=this;if(!t.parentNode)return this.destroy();e.target.closest(".modal")===t&&y("html").disableScroll()}),this.shown&&y("html").disableScroll()}destroy(){super.destroy(),this._rob&&(this._rob.disconnect(),this._rob=void 0)}show(e){var c;const{modalElement:t}=this,n=y(t);if(this._shown&&n.hasClass(pc))return n.removeClass(ko).css("z-index",`${Si.zIndex++}`),!1;this._shown=!0,this.setOptions(e);const{animation:s,backdrop:r,className:o,style:a}=this.options;n.setClass({"modal-trans":s,"modal-no-backdrop":!r,[ko]:!1},bf,o).css({zIndex:`${Si.zIndex++}`,...a});const l=this.constructor;return l.hideOthers&&this.options.hideOthers!==!1&&l.getAll().forEach(d=>{d!==this&&d.shown&&!n.closest(d.modalElement).length&&d.hideForOther()}),this.options.closeOthers&&l.getAll().forEach(d=>{d!==this&&!n.closest(d.modalElement).length&&d.hide()}),this.layout(),(c=this.options.onShow)==null||c.call(this),this.emit("show"),this._setTimer(()=>{n.addClass(pc),this._setTimer(()=>{var d,u;(d=n.find("[autofocus]")[0])==null||d.focus(),(u=this.options.onShown)==null||u.call(this),this.emit("shown")})},50),!0}hideForOther(){y(this.modalElement).addClass(ko)}hide(){var t;if(!this._shown)return!1;this._shown=!1,y(this.modalElement).removeClass(pc),(t=this.options.onHide)==null||t.call(this),this.emit("hide"),this._setTimer(()=>{var n;y(this.modalElement).removeClass(bf),(n=this.options.onHidden)==null||n.call(this),this.emit("hidden")});const e=this.constructor;return e.hideOthers&&this.options.hideOthers!==!1&&e.getAll().forEach(n=>{n.shown&&n!==this&&y(n.modalElement).removeClass(ko)}),!0}layout(e,t){if(!this._shown)return;const{dialog:n}=this;if(!n)return;const s=y(n);if(t=t??this.options.size,t){s.removeAttr("data-size");const d={width:"",height:""};typeof t=="object"?(d.width=t.width,d.height=t.height):typeof t=="string"&&["md","sm","lg","full"].includes(t)?s.attr("data-size",t):t&&(d.width=t),s.css(d)}e=e??this.options.position??"fit";const r=n.clientWidth,o=n.clientHeight;this._lastDialogSize=[r,o],typeof e=="function"&&(e=e({width:r,height:o}));const a={left:null,bottom:null,right:null};let l=null,c="center";typeof e=="number"?(c="flex-start",l=e):typeof e=="object"&&e?(Object.assign(a,e),l=a.top??l,c=a.alignSelf??"flex-start"):e==="fit"?(c="flex-start",l=`${Math.max(0,Math.floor((window.innerHeight-o)/3))}px`):e==="bottom"?c="flex-end":e==="top"?c="flex-start":e!=="center"&&typeof e=="string"&&(c="flex-start",l=e),a.top=l,a.alignSelf=c,s.css(a),y(this.modalElement).css("justifyContent",a.left?"flex-start":"center")}_setTimer(e,t){this._timer&&(clearTimeout(this._timer),this._timer=0),e&&(this.options.animation?this._timer=window.setTimeout(e,t??this.options.transTime):e())}static last(e){return Si.query(e,void 0,t=>t.shown)}static hide(e){var t;(t=Si.last(e))==null||t.hide()}static show(e){var t;(t=Si.query(e,void 0,n=>!n.shown))==null||t.show()}};Ki.NAME="Modal",Ki.MULTI_INSTANCE=!0,Ki.DEFAULT={position:"fit",show:!0,keyboard:!0,animation:!0,backdrop:!0,responsive:!0,transTime:300},Ki.hideOthers=!0,Ki.zIndex=1500;let qi=Ki;y(window).on(`resize.${qi.NAMESPACE}`,()=>{qi.getAll().forEach(i=>{const e=i;e.shown&&e.options.responsive&&e.layout()})});class wf extends pe{constructor(e){super(e),this._ref=fe(),this.state={showed:!e.waitShowEvent}}componentDidMount(){const{waitShowEvent:e,afterRender:t}=this.props;t==null||t.call(this,{firstRender:!0}),e&&y(this._ref.current).on(e,()=>{this.setState({showed:!0})})}componentDidUpdate(){var e;(e=this.props.afterRender)==null||e.call(this,{firstRender:!1})}componentWillUnmount(){var e;(e=this.props.beforeDestroy)==null||e.call(this)}renderHeader(){const{header:e,headerClass:t,title:n}=this.props;return N.isValidElement(e)?e:e===!1||!n?null:e?k(me,{className:V("modal-header",t),content:e}):k("div",{className:V("modal-header",t),children:k("div",{className:"modal-title",children:n})})}renderActions(){const{actions:e,closeBtn:t}=this.props;return!t&&!e?null:N.isValidElement(e)?e:k("div",{className:"modal-actions",children:[e?k(He,{...e}):null,t?k("button",{type:"button",class:"btn square ghost","data-dismiss":"modal",children:k("span",{class:"close"})}):null]})}renderBody(){const{body:e,bodyClass:t}=this.props;return e?N.isValidElement(e)?e:k(me,{className:V("modal-body",t),content:e}):null}renderFooter(){const{footer:e,footerClass:t,footerActions:n}=this.props;return N.isValidElement(e)?e:e===!1||!n?null:e?k(me,{className:V("modal-footer",t),content:e}):k("div",{className:V("modal-footer",t),children:n?k(He,{...n}):null})}render(){const{className:e,style:t,contentClass:n,children:s,waitShowEvent:r}=this.props,o=r&&!this.state.showed;return k("div",{ref:r?this._ref:void 0,className:V("modal-dialog",e,o?"loading":""),style:t,children:[k("div",{className:V("modal-content",n),children:[this.renderHeader(),this.renderActions(),this.renderBody(),s,this.renderFooter()]}),o?k("div",{class:"load-indicator loading"}):null]})}}wf.defaultProps={closeBtn:!0};class mc extends pe{constructor(){super(...arguments),this._ref=fe(),this.state={},this._handleIframeLoad=()=>{const e=this.iframeDoc;if(!e)return;const{iframeBodyClass:t,watchHeight:n}=this.props;n&&this._watchIframeHeight(),t&&e.body.classList.add(t),y(this._ref.current).trigger("modal-iframe-loaded")}}get iframeDoc(){var e,t;return(t=(e=this._ref.current)==null?void 0:e.contentWindow)==null?void 0:t.document}componentDidMount(){this.props.watchHeight&&this._watchIframeHeight()}componentWillUnmount(){var e;(e=this._rob)==null||e.disconnect()}_watchIframeHeight(){const e=this.iframeDoc;if(!e)return;let t=this._rob;t==null||t.disconnect(),t=new ResizeObserver(()=>{const n=e.body,s=e.documentElement,r=Math.ceil(Math.max(n.scrollHeight,n.offsetHeight,s.offsetHeight));this.setState({height:r})}),t.observe(e.body),t.observe(e.documentElement),this._rob=t}render(){return k("iframe",{className:"modal-iframe",style:this.state,src:this.props.url,ref:this._ref,onLoad:this._handleIframeLoad})}}mc.defaultProps={watchHeight:!0};var gc=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Vt=(i,e,t)=>(gc(i,e,"read from private field"),t?t.call(i):e.get(i)),Rs=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Gi=(i,e,t,n)=>(gc(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),So=(i,e,t)=>(gc(i,e,"access private method"),t),mn,Os,gn,To,yc,$o,_c;function nv(i,e){const{custom:t,title:n,content:s}=e;return{body:s,title:n,...typeof t=="function"?t():t}}async function iv(i,e){const{dataType:t="html",url:n,request:s,custom:r,title:o,replace:a=!0,executeScript:l=!0}=e,c=await y.ajax({url:n,headers:{"X-ZUI-Modal":"true"},...s});if(t!=="html")try{const d=JSON.parse(c);return{title:o,...r,...d}}catch{}return a!==!1&&t==="html"?[c]:{title:o,...r,body:t==="html"?k(fn,{className:"modal-body",html:c,executeScript:l}):c}}async function sv(i,e){const{url:t,custom:n,title:s,size:r}=e,o=typeof r=="object"&&typeof r.height=="number";return{title:s,...n,waitShowEvent:"modal-iframe-loaded",body:k(mc,{url:t,watchHeight:!o})}}const rv={custom:nv,ajax:iv,iframe:sv},Cf="loading",xf=class Ti extends qi{constructor(){super(...arguments),Rs(this,To),Rs(this,$o),Rs(this,mn,void 0),Rs(this,Os,void 0),Rs(this,gn,void 0)}get id(){return Vt(this,Os)}get loading(){var e;return(e=Vt(this,mn))==null?void 0:e.classList.contains(Cf)}get shown(){var e;return!!((e=Vt(this,mn))!=null&&e.classList.contains("show"))}get modalElement(){let e=Vt(this,mn);if(!e){const{options:t}=this;let n=Vt(this,Os);n||(n=t.id||`modal-${ft()}`,Gi(this,Os,n));const{$element:s}=this;if(e=s.find(`#${n}`)[0],e)y(e).data(this.constructor.KEY,this);else{const r=this.key;e=y("<div>").attr({id:n,"data-key":r}).data(this.constructor.KEY,this).css(t.style||{}).setClass("modal modal-async load-indicator",t.className).appendTo(s)[0]}Gi(this,mn,e)}return e}get $emitter(){const e=Vt(this,mn);return e?y(e):this.$element}afterInit(){super.afterInit(),this.options.destroyOnHide&&this.options.type!=="static"&&this.on("hidden",e=>{y(e.target).data("key")===this.key&&this.destroy()})}show(e){return super.show(e)?(this.buildDialog(),!0):!1}destroy(){super.destroy();const e=Vt(this,mn);e&&(y(e).removeData(this.constructor.KEY).remove(),Gi(this,mn,void 0))}render(e){return super.render(e),this.buildDialog()}async buildDialog(){if(this.loading)return!1;Vt(this,gn)&&clearTimeout(Vt(this,gn));const{modalElement:e,options:t}=this,n=y(e),{type:s,loadTimeout:r,loadingClass:o=Cf,loadingText:a=null}=t;if(!s||s==="static")return!0;const l=rv[s];if(!l)return console.warn(`Modal: Cannot build modal with type "${s}"`),!1;n.attr("data-loading",a).addClass(o),r&&Gi(this,gn,window.setTimeout(()=>{Gi(this,gn,0),So(this,$o,_c).call(this,this.options.timeoutTip)},r));const c=await l.call(this,e,t);return this._destroyed?!1:(c===!1?await So(this,$o,_c).call(this,this.options.failedTip):c&&typeof c=="object"&&await So(this,To,yc).call(this,c),Vt(this,gn)&&(clearTimeout(Vt(this,gn)),Gi(this,gn,0)),this.layout(),await gs(100),n.removeClass(o),!0)}static isValid(e){return!y.isDetached(e.modalElement)}static open(e){return new Promise(t=>{const{container:n=document.body,ref:s,...r}=e,o={show:!0,...r};!o.type&&o.url&&(o.type="ajax"),!o.type&&e.id&&(o.type="static"),o.key===void 0&&(o.key=o.id);const a=Ti.ensure(n,o);s&&(s.current=a);const l=`${Ti.NAMESPACE}.open${ft()}`;a.on(`hidden${l}`,()=>{a.off(l),t(a)}),a.show()})}static async alert(e){typeof e=="string"&&(e={message:e});const{type:t,message:n,icon:s,iconClass:r="icon-lg muted",actions:o="confirm",onClickAction:a,custom:l,key:c="__alert",...d}=e,u=(typeof l=="function"?l():l)||{};let p=typeof n=="object"&&n.html?k("div",{dangerouslySetInnerHTML:{__html:n.html}}):k("div",{children:n});s?p=k("div",{className:V("modal-body row gap-4 items-center",u.bodyClass),children:[k("div",{className:`icon ${s} ${r}`}),p]}):p=k("div",{className:V("modal-body",u.bodyClass),children:p});const g=[];(Array.isArray(o)?o:[o]).forEach(S=>{S={...typeof S=="string"?{key:S}:S},typeof S.key=="string"&&(S.text||(S.text=Ne.getLang(S.key,S.key)),S.btnType||(S.btnType=`btn-wide ${S.key==="confirm"?"primary":"btn-default"}`)),S&&g.push(S)},[]);let b;const C=g.length?{gap:4,items:g,onClickItem:({item:S,event:x})=>{const D=Ti.query(x.target);if(!D||D.key!==c)return;b=S.key,(a==null?void 0:a(S,D))!==!1&&D&&D.hide()}}:void 0;return await Ti.open({key:c,type:"custom",size:400,className:"modal-alert",content:p,modal:!0,backdrop:"static",hideOthers:!1,custom:{footerActions:C,...u},...d}),b}static async confirm(e){typeof e=="string"&&(e={message:e});const{onClickAction:t,onResult:n,...s}=e;return await Ti.alert({actions:["confirm","cancel"],onClickAction:(o,a)=>{n==null||n(o.key==="confirm",a),t==null||t(o,a)},...s})==="confirm"}static async prompt(e){typeof e=="string"&&(e={message:e});const{defaultValue:t="",placeholder:n,onResult:s,onShown:r,message:o,content:a,bodyClass:l,custom:c,...d}=e;let u=t,p=!1;const g=fe();return await Ti.confirm({...d,custom:{closeBtn:!1,...c},message:o,ref:g,content:k("div",{className:V("modal-body",l),children:[k(me,{content:o}),k("input",{type:"text",className:"modal-prompt-input form-control mt-3",autoFocus:!0,placeholder:n,defaultValue:t,onChange:C=>{u=C.target.value},onKeyDown:C=>{var S,x;C.key==="Enter"?(p=!0,C.preventDefault(),(S=g.current)==null||S.hide()):C.key==="Escape"&&((x=g.current)==null||x.hide())}}),a]})})||p?u:null}};mn=new WeakMap,Os=new WeakMap,gn=new WeakMap,To=new WeakSet,yc=function(i){return new Promise(e=>{if(Array.isArray(i))return y(this.modalElement).html(i[0]).zuiInit(),this.layout(),this._observeResize(),e();const{afterRender:t,...n}=i;i={afterRender:s=>{this.layout(),t==null||t(s),this._observeResize(),e()},...n},oi(k(wf,{...i}),this.modalElement)})},$o=new WeakSet,_c=function(i){if(i)return So(this,To,yc).call(this,{body:k("div",{className:"modal-load-failed",children:i})})},xf.DEFAULT={...qi.DEFAULT,loadTimeout:1e4,destroyOnHide:!0};let Ue=xf;Ue.register();class Yi extends ze{get modal(){return this._modal}get container(){const{container:e}=this.options;return typeof e=="string"?document.querySelector(e):e instanceof HTMLElement?e:document.body}show(){var e;return(e=this._initModal())==null?void 0:e.show()}hide(){var e;return(e=this._modal)==null?void 0:e.hide()}_getBuilderOptions(){const{container:e,...t}=this.options,n=t,s=this.$element.attr("href")||"";return n.type||(n.target||s[0]==="#"?n.type="static":n.type=n.type||(n.url||s?"ajax":"custom")),!n.url&&(n.type==="iframe"||n.type==="ajax")&&s[0]!=="#"&&(n.url=s),n.key===void 0&&(n.key=`${this._key}`),n}_initModal(){const e=this._getBuilderOptions();let t=this._modal;if(t)return t.setOptions(e),t;if(e.type==="static"){const n=this._getStaticModalElement();if(!n)return;t=qi.ensure(n,e)}else t=Ue.ensure(this.container,e);return this._modal=t,t.on("destroyed",()=>{this._modal=void 0}),t}_getStaticModalElement(){let e=this.options.target;if(!e){const{$element:t}=this;if(t.is("a")){const n=t.attr("href");n!=null&&n.startsWith("#")&&(e=n)}}return this.container.querySelector(e||".modal")}}Yi.NAME="ModalTrigger",Yi.toggle={name:"modal",skip:"[disabled],.disabled,.open-in-parent",convertHref:!0,onGet(i){return Yi.get(i)},onCreate(i,e,t){return new Yi(i,t)}},Yi.register();const ov={zh_cn:{selectFile:"选择文件",fileSelectTip:"（不超过 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超过了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超过了总大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超过了数量 {maxFileCount} 的限制。"},zh_tw:{selectFile:"選擇文件",fileSelectTip:"（不超過 {maxFileSize}）",removeFile:"移除文件",renameFile:"重命名",duplicatedTip:"文件 “{name}”（{size}） 已存在。",exceededSizeTip:"文件 “{name}”（{size}） 超過了 {maxFileSize} 的限制。",exceededTotalSizeTip:"文件 “{name}”（{size}） 超過了總大小 {totalFileSize} 的限制。",exceededCountTip:"文件 “{name}”（{size}） 超過了數量 {maxFileCount} 的限制。"},en:{selectFile:"Select File",fileSelectTip:"(Not exceeding {maxFileSize})",removeFile:"Remove File",renameFile:"Rename",duplicatedTip:"File “{name}” ({size}) already exists.",exceededSizeTip:"File “{name}” ({size}) exceeds the limit of {maxFileSize}.",exceededTotalSizeTip:"File “{name}” ({size}) exceeds the total size limit of {totalFileSize}.",exceededCountTip:"File “{name}” ({size}) exceeds the limit of {maxFileCount}."}};let zn=class extends Fe{constructor(e){if(e.totalFileSize){const{maxFileSize:t="100MB",totalFileSize:n}=e,s=typeof t=="number"?t:$n(t),r=typeof n=="number"?n:$n(n);e.maxFileSize=s>r?n:t}e.maxFileSize||(e.maxFileSize="100MB"),super(e),this._input=fe(),this._file=fe(),this._id=`file-selector-input-${ft()}`,this._data=new DataTransfer,this.stopRenameFile=()=>{const{renaming:t,newName:n}=this.state;this.cancelRenameFile(),!(!t||!n)&&this.renameFile(t,n)},this.cancelRenameFile=()=>{this.setState({renaming:""})},this._handleChange=t=>{const n=t.target;n.files&&(this.selectFiles(n.files),this.setState({inputKey:ft()}))},this._handleDragOver=t=>{t.preventDefault(),this.state.dragging||this.setState({dragging:!0})},this._handleDragLeave=t=>{t.preventDefault(),this.setState({dragging:!1})},this._handleDrop=t=>{var s;this._handleDragLeave(t);const n=this.constructor.filterFiles(((s=t.dataTransfer)==null?void 0:s.files)||[],this.props.accept);n.length&&(this.selectFiles(n),this.setState({inputKey:ft()}))},this._handleRenameChange=t=>{this.setState({newName:t.target.value})},this._handleClick=t=>{if(this.props.disabled)return;const s=y(t.target).closest("[data-remove-file],[data-rename-file]");if(!s.length)return;const r=s.data();r.renameFile?this.startRenameFile(r.renameFile):r.removeFile&&this.removeFile(r.removeFile)},this.state={files:(e.defaultFiles||[]).map(t=>this.constructor.getInfo(t)),inputKey:0}}get size(){return this.state.files.reduce((e,t)=>e+t.size,0)}get count(){return this.state.files.length}get multiple(){const{multiple:e,maxFileCount:t,name:n=""}=this.props;return!!(t!==1&&(e??n.endsWith("[]")))}get info(){const{maxFileSize:e=0,maxFileCount:t=Number.MAX_SAFE_INTEGER}=this.props;return{size:dt(this.size,1),maxFileSize:dt(typeof e=="string"?$n(e):e,1),maxFileCount:t,count:this.count}}get files(){return this._data.files}componentDidMount(){const e=this.state.files.reduce((t,n)=>(n.file&&t.push(n.file),t),[]);e.length&&(e.forEach(t=>this._data.items.add(t)),this._syncFiles())}getFile(e){return this.state.files.find(t=>t.id===e)}getFileByName(e){return this.state.files.find(t=>t.name===e)}select(){var e;(e=this._input.current)==null||e.click()}async selectFiles(e){var t;if(((t=this.props.onSelect)==null?void 0:t.call(this,e))!==!1){this._skipAddMore=!1;for(let n=0;n<e.length&&(await this.addFile(e[n]),!this._skipAddMore);n++);}}async _checkDuplicated(e){const{allowSameName:t,onDuplicated:n,duplicatedTip:s=this.i18n("duplicatedTip")}=this.props,{name:r}=e,o=t?this.getFile(e.id):this.getFileByName(r);return o?((n==null?void 0:n.call(this,r,e,o))===!0||s&&await this._showAlert(s,{name:r,size:dt(e.size,1)}),!0):!1}async _checkExceededSize(e){const{maxFileSize:t,onExceededSize:n,exceededSizeTip:s=this.i18n("exceededSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?$n(t):t;return e.size<=r?!1:((n==null?void 0:n.call(this,r,e))===!0||s&&await this._showAlert(s,{name:e.name,size:dt(e.size,1),maxFileSize:t}),!0)}async _checkTotalSize(e){const{totalFileSize:t,onExceededTotalSize:n,exceededTotalSizeTip:s=this.i18n("exceededTotalSizeTip")}=this.props;if(!t)return!1;const r=typeof t=="string"?$n(t):t,o=e.size+this.size;return o<=r?!1:((n==null?void 0:n.call(this,r,e))===!0||s&&await this._showAlert(s,{name:e.name,size:dt(e.size,1),totalSize:dt(o,1)}),!0)}async _checkExceededCount(e){const{maxFileCount:t=0,onExceededCount:n,exceededCountTip:s=this.i18n("exceededCountTip")}=this.props;if(!t)return!1;const r=this.count+1;return r<=t?!1:((n==null?void 0:n.call(this,t,e))===!0||s&&await this._showAlert(s,{name:e.name,size:dt(e.size,1),exceededCount:r}),!0)}async addFile(e){const{onAdd:t,disabled:n}=this.props;if(n)return!1;const s=this.constructor.getInfo(e);return await this._checkExceededCount(s)?(this._skipAddMore=!0,!1):await this._checkDuplicated(s)?!1:await this._checkExceededSize(s)?(this._skipAddMore=!0,!1):await this._checkTotalSize(s)?(this._skipAddMore=!0,!1):t&&t.call(this,s)===!1?!1:(this._data.items.add(e),this._syncFiles(!0),await this.changeState(c=>({files:[...c.files,s]})),!0)}startRenameFile(e){this.setState({renaming:e,newName:void 0},()=>{const t=y(this._file.current).closest(".file-selector").find(".file-selector-rename-input")[0];t&&(t.select(),t.focus())})}async renameFile(e,t){const n=this.getFile(e);if(!n||n.name===t)return;const{onRename:s}=this.props;if(s&&await s.call(this,t,n.name,n)===!1)return;const r=n.file;if(r){const l=new File([r],t,{type:r.type,lastModified:r.lastModified}),c=Array.from(this._data.files).indexOf(r);c>=0&&this._data.items.remove(c),this._data.items.add(l),this._syncFiles(!0),n.file=l}n.name=t,n.ext=this.constructor.getExt(t);const{files:o}=this.state,a=o.indexOf(n);a>=0?o.splice(a,1,n):o.push(n),this.setState({files:[...o]})}async removeFile(e){const t=this.getFile(e);if(!t)return;const{onRemove:n,removeConfirm:s}=this.props;if(s){let o=s;if(typeof o=="string"&&(o={message:o}),typeof o.message=="string"&&(o.message=Ce(o.message,{name:t.name,size:dt(t.size,1)})),!await Ue.confirm(o))return}if(n&&await n.call(this,t)===!1)return;if(t.file){const o=Array.from(this._data.files).indexOf(t.file);o>=0&&this._data.items.remove(o)}const r=this.state.files.indexOf(t);r>=0&&(this.state.files.splice(r,1),this.setState({files:this.state.files}),this._syncFiles(!0))}_syncFiles(e=!1){const t=this._data.files,n=this._file.current;n.files=t,e&&y(n).trigger("change",{files:t})}_showAlert(e,t){return typeof e=="string"&&(e={message:e}),typeof e.message=="string"&&(e.message=Ce(e.message,{...this.info,...t})),Ue.alert(e)}_getTip(e){return typeof e=="string"?Ce(e,this.info):e}_renderInput(e){return k("input",{id:this._id,multiple:this.multiple,accept:e.accept,style:"display:none",type:"file",ref:this._input,onChange:this._handleChange},`input${this.state.inputKey}`)}_getDraggableProps(){const e={};return this.props.draggable&&!this.props.disabled&&(e.onDragOver=this._handleDragOver,e.onDragLeave=this._handleDragLeave,e.onDrop=this._handleDrop),e}_renderUpload(e){const{mode:t,disabled:n,tip:s=this.i18n("fileSelectTip"),uploadBtn:r}=e,o=xe({component:"label",attrs:{for:n?void 0:this._id},disabled:n,text:this.i18n("selectFile")},typeof r=="object"?r:typeof r=="string"?{text:r}:{}),a=k("div",{className:"file-selector-tip",children:k(me,{content:this._getTip(s),generatorThis:this,generatorArgs:[this.state]})}),l=t==="grid",c=l?{}:this._getDraggableProps();return l||t==="box"?k(ke,{...o,...c,className:V(l?"file-selector-grid-btn":"file-selector-box",o.className),children:a},"upload"):k("div",{className:"file-selector-btn",...c,children:[k(ke,{rounded:"full",size:"sm",...o}),a]},"upload")}_renderForForm(e){const{name:t,accept:n,onChange:s}=e;return k("input",{ref:this._file,type:"file",name:t,multiple:this.multiple,accept:n,style:"display:none",onChange:s},"form")}_getIcon(e){let{fileIcons:t}=this.props;if(t)return typeof t=="string"&&(t={default:t}),t[e.ext]??t.default}_getThumbnail(e){if((e.file||e.url)&&this.props.thumbnail&&this.constructor.isImage(e))return e.url||URL.createObjectURL(e.file)}_getAvatar(e){const t=this._getThumbnail(e);let n;if(t)n={src:t};else{const s=this._getIcon(e);s&&(n={icon:s})}return n&&{size:this.props.mode==="grid"?void 0:"sm",...n}}_getFileActions(e){if(this.props.disabled)return;let{removeBtn:t,renameBtn:n}=this.props;typeof t=="function"&&(t=t.call(this,e)),typeof t=="string"?t={text:t}:t===!0&&(t={hint:this.i18n("removeFile"),icon:"trash"}),typeof n=="function"&&(n=n.call(this,e)),typeof n=="string"?n={text:n}:n===!0&&(n={hint:this.i18n("renameFile"),icon:"edit"});const s=[];return n&&s.push({"data-rename-file":e.id,...n}),t&&s.push({"data-remove-file":e.id,...t}),s}_renderFile(e){let{itemProps:t}=this.props;return t=xe({className:this.props.mode==="grid"?"file-selector-grid-item":"file-selector-item",multiline:!1,title:e.name,subtitle:dt(e.size,1),avatar:this._getAvatar(e),actions:this._getFileActions(e),"z-id":e.id},typeof t=="function"?t.call(this,e):t),k(Zt,{...t},e.id)}_renderFileRename(e){let{itemProps:t}=this.props;if(typeof t=="function")t=t.call(this,e);else{const{newName:n=e.name}=this.state,s=this.props.mode==="grid",r=k("div",{className:"file-selector-rename-text",children:[k("div",{className:"form-control size-sm",children:n}),k("input",{type:"text",defaultValue:e.name,className:"form-control size-sm select-all file-selector-rename-input",autofocus:!0,onBlur:s?this.stopRenameFile:void 0,onChange:this._handleRenameChange,onInput:this._handleRenameChange})]});t=xe({className:`${s?"file-selector-grid-item":"file-selector-item"} is-renaming`,multiline:!1,avatar:this._getAvatar(e),"z-id":e.id,contentClass:"file-selector-rename",content:s?r:[r,k(ke,{icon:"check",text:this.i18n("confirm"),type:"primary-pale",size:"sm",onClick:this.stopRenameFile}),k(ke,{icon:"close",text:this.i18n("cancel"),type:"gray-pale",size:"sm",onClick:this.cancelRenameFile})]},t)}return k(Zt,{...t},e.id)}_renderList(e){const{files:t,renaming:n}=this.state;return k("div",{className:`file-selector-list${t.length?"":" is-empty"}`,onClick:this._handleClick,children:t.map(s=>s.id===n?this._renderFileRename(s):this._renderFile(s))},"list")}_renderGrid(e){const t=this._getDraggableProps(),{gridWidth:n=120,gridHeight:s=148,gridGap:r=12}=e,o={"--file-selector-grid-width":Be(n),"--file-selector-grid-height":Be(s),"--file-selector-grid-gap":Be(r)},{files:a,renaming:l}=this.state;return k("div",{className:"file-selector-grid",style:o,onClick:this._handleClick,...t,children:[a.map(c=>c.id===l?this._renderFileRename(c):this._renderFile(c)),this._renderUpload(e)]},"grid")}_getClassName(e){return["file-selector",`is-mode-${e.mode}`,e.className,this.state.dragging?"is-dragging":""]}_getChildren(e){const t=e.mode==="grid";return[t?null:this._renderUpload(e),t?this._renderGrid(e):this._renderList(e),this._renderInput(e),this._renderForForm(e)]}static getExt(e){return(e.split(".").pop()||"").toLowerCase()}static getInfo(e){const{name:t,size:n,type:s}=e;if(e instanceof File)return{name:t,size:n,type:s,file:e,id:[t,n].join(":"),ext:this.getExt(t)};const r=typeof n=="string"?$n(n):n;return{name:t,size:r,id:e.id??[t,r].join(":"),type:s??"",ext:this.getExt(t),file:e.file,url:e.url}}static isAccept(e,t){return!t||!t.length?!0:(Array.isArray(t)?t:t.split(",")).some(s=>e.type&&s===e.type?!0:s.startsWith(".")?e.name.endsWith(s):s.endsWith("/*")?e.type.startsWith(s.slice(0,-1)):!1)}static isImage(e){return this.isAccept(e,this.imageAccepts)}static filterFiles(e,t){if(!t||!t.length)return e;e instanceof FileList&&(e=Array.from(e));const n=t.split(",");return e.filter(s=>this.isAccept(s,n))}};zn.defaultProps={mode:"button",fileIcons:"file",renameBtn:!0,removeBtn:!0,draggable:!0,thumbnail:!0,maxFileCount:0},zn.i18n=ov,zn.imageAccepts="image/*,.png,.jpg,.jpeg,.gif";let vc=class extends zn{};vc.defaultProps={...zn.defaultProps,mode:"grid",accept:zn.imageAccepts};const av=Object.freeze(Object.defineProperty({__proto__:null,FileSelector:zn,ImageSelector:vc},Symbol.toStringTag,{value:"Module"}));class Do extends _e{}Do.NAME="FileSelector",Do.Component=zn,Do.replace=!0;class Io extends _e{}Io.NAME="ImageSelector",Io.Component=vc,Io.replace=!0,Xe(av);const G0="",bc=class ig extends ut{_getClassName(e){const{type:t,stacked:n}=e;return[super._getClassName(e),t?`nav-${t}`:"",n?"nav-stacked":""]}static render(e,t,n,s){let r=typeof e=="function"?e.call(s??this,...t):e;if(r)return Array.isArray(r)&&(r={items:r}),n&&(r=xe(n,r)),w(ig,{...r})}};bc.NAME="nav",bc.defaultItemProps={component:"li",innerComponent:"a"};let kf=bc;const lv=Object.freeze(Object.defineProperty({__proto__:null,Nav:kf},Symbol.toStringTag,{value:"Module"}));class wc extends _e{}wc.NAME="Nav",wc.Component=kf,Xe(lv);const Y0="",Q0="",X0="",Z0="",J0="",eC="",tC="",nC="",iC="",sC="",rC="",oC="",aC="";function zs(i,e){const t=i.pageTotal||Math.ceil(i.recTotal/i.recPerPage);return typeof e=="string"&&(e==="first"?e=1:e==="last"?e=t:e==="prev"?e=i.page-1:e==="next"?e=i.page+1:e==="current"?e=i.page:e=Number.parseInt(e,10)),e=e!==void 0?Math.max(1,Math.min(e<0?t+e:e,t)):i.page,{...i,pageTotal:t,page:e}}function Sf({key:i,type:e,btnType:t,page:n,format:s,pagerInfo:r,linkCreator:o,...a}){const l=zs(r,n);return a.text===void 0&&!a.icon&&s&&(a.text=typeof s=="function"?s(l):Ce(s,l)),a.url===void 0&&o&&(a.url=typeof o=="function"?o(l):Ce(o,l)),a.disabled===void 0&&(a.disabled=n!==void 0&&l.page===r.page),k(ke,{type:t,"z-go-to-page":l.page,...a})}function Tf({key:i,type:e,page:t,text:n="",pagerInfo:s,children:r,...o}){const a=zs(s,t);return n=typeof n=="function"?n(a):Ce(n,a),k(Fe,{...o,children:[r,n]})}function cv({type:i,btnType:e,count:t=12,pagerInfo:n,linkCreator:s,...r}){if(!n.pageTotal)return;const o={...r,square:!0},a=()=>(o.text="",o.icon="icon-ellipsis-h",o.disabled=!0,k(ke,{type:e,...o})),l=(d,u)=>{const p=[];for(let g=d;g<=u;g++){o.text=g,delete o.icon,o.disabled=!1;const b=zs(n,g);s&&(o.url=typeof s=="function"?s(b):Ce(s,b)),p.push(k(ke,{type:e,...o}))}return p};let c=[];return c=[...l(1,1)],n.pageTotal<=1||(n.pageTotal<=t?c=[...c,...l(2,n.pageTotal)]:n.page<t-2?c=[...c,...l(2,t-2),a(),...l(n.pageTotal,n.pageTotal)]:n.page>n.pageTotal-t+3?c=[...c,a(),...l(n.pageTotal-t+3,n.pageTotal)]:c=[...c,a(),...l(n.page-Math.ceil((t-4)/2),n.page+Math.floor((t-4)/2)),a(),...l(n.pageTotal,n.pageTotal)]),c}const lC="";let hv=class extends pe{render(e){const{id:t,popup:n,title:s,content:r,style:o,className:a,closeBtn:l,arrow:c,headingClass:d,titleClass:u,contentClass:p,arrowStyle:g,onlyInner:b,footer:C,footerClass:S}=e;let x=k(me,{content:r},"content");(p||s)&&(x=k("div",{className:p,children:x},"content"));let D=k(me,{content:C},"footer");(S||s)&&(D=k("div",{className:S,children:D},"footer"));const A=[],B=l?k("button",{className:"btn ghost square size-sm btn-close","data-dismiss":"popover",children:k("span",{className:"close"})}):null;return s?A.push(k("div",{className:d,children:[s?k(me,{className:u,content:s}):null,B]},"heading")):A.push(B),A.push(x,D),c&&A.push(k("div",{className:typeof c=="string"?c:"arrow",style:g},"arrow")),b?A:k("div",{id:t,className:V("popover",a,{popup:n,"has-heading":s}),style:o,children:A})}};class No extends _e{}No.NAME="PopoverPanel",No.Component=hv;const $f="show",Df="in",Qi=class sg extends ze{constructor(){super(...arguments),this._getClickBounding=()=>{const e=this._triggerEvent;return{x:e.clientX,y:e.clientY,left:e.clientX,top:e.clientY,width:0,height:0,bottom:e.clientY,right:e.clientX}}}get shown(){return this._shown}get id(){return this._id}get zIndex(){return this._zIndex}get trigger(){return this._triggerElement}get target(){return this._targetElement}afterInit(){const{trigger:e,id:t,triggerEvent:n}=this.options;this._triggerEvent=n,this._id=t||`popover_${this.gid}`;const s=this.getTriggerElement();if(s instanceof HTMLElement){const o=y(s),{namespace:a}=this;if(e){const l=()=>{let c=o.dataset();const d=o.attr(`zui-toggle-${this.constructor.ZUI}`);d&&(c=y.extend(c,si(d))),this.setOptions(c)};e==="hover"?o.on(`pointerenter${a}`,c=>{o.is("[disabled],.disabled")||(l(),this.show({delay:!0,event:c}))}).on(`pointerleave${a} pointercancel${a}`,()=>{this.delayHide()}):o.on(`${e}${a}`,c=>{o.is("[disabled],.disabled")||(this.shown||l(),this.toggle({event:c,delay:!0}),c.preventDefault())})}}const{show:r}=this.options;r&&this.show({delay:typeof r=="number"?r:!1})}getTriggerElement(){if(!this._triggerElement){let{element:e=this.element}=this.options;e===document.body&&(e={getBoundingClientRect:this._getClickBounding}),this._triggerElement=e,this._virtual=!(e instanceof HTMLElement)}return this._triggerElement}initTarget(){let e=this.options.target;return this._dynamic=!e,e?(typeof e=="function"&&(e=e()),typeof e=="string"&&(e==="$next"?e=y(this._triggerElement).next():e.startsWith("$target:")&&(e=y(this._triggerElement).closest(e.slice(8)))),y(e)[0]):this._createTarget()}show(e){const{delay:t,event:n,hideOthers:s=this.options.hideOthers}=e||{};if(n&&(this._triggerEvent=n),t)return this._resetTimer(()=>{this.show()},t===!0?this.options.delay:t);if(!this.inited){this.setOptions({show:!0});return}if(this._shown)return;const r=this.initTarget();if(!r)return;this._targetElement=r;const o=y(r),{animation:a,onShow:l,onShown:c,trigger:d,elementShowClass:u}=this.options,{SHOWN_POPOVERS:p}=this.constructor;o.addClass($f),a&&o.addClass(a===!0?"fade":a),this._zIndex=sg.Z_INDEX++,this._shown=!0,this.render(),p.set(this.gid,this),l==null||l.call(this),this.emit("show"),s&&p.forEach(b=>{b!==this&&b.hide()});const{namespace:g}=this;d==="hover"&&(this._clearDelayHide(),o.off(g).on(`pointerenter${g}`,()=>{this._clearDelayHide()}).on(`pointerleave${g}`,()=>{this.delayHide()})),this._virtual||(o.attr("zui-commands-proxy","").data("zui.commandProxy",this._triggerElement),u&&y(this._triggerElement).addClass(u)),this._resetTimer(()=>{o.addClass(Df),this._resetTimer(()=>{c==null||c.call(this),this.emit("shown")},200)},50)}hide(e){(!this._shown||!this._targetElement)&&this._resetTimer();const{destroyOnHide:t,animation:n,onHide:s,onHidden:r,trigger:o,hideNewOnHide:a,elementShowClass:l}=this.options,c=y(this._targetElement),{SHOWN_POPOVERS:d}=this.constructor;if(this._shown=!1,d.delete(this.gid),s==null||s.call(this),this.emit("hide"),c.removeClass(Df),o==="hover"&&(this._clearDelayHide(),c.off(this.namespace)),!this._virtual){const u=y(this._triggerElement);u.removeAttr("zui-commands-proxy").removeData("zui.commandProxy"),l&&u.removeClass(l).removeAttr("data-pop-placement")}a&&d.forEach(u=>{u!==this&&u.zIndex>this.zIndex&&u.hide()}),this._resetTimer(()=>{r==null||r.call(this),this.emit("hidden"),c.removeClass($f),(t||e)&&this._resetTimer(()=>{this.destroy()},!e&&typeof t=="number"?t:0),this._destoryTarget()},n&&!e?200:0)}toggle(e){this._shown?this.hide():this.show(e)}destroy(){if(super.destroy(),!this._virtual){const{namespace:e}=this;y(this._triggerElement).off(e)}this._resetTimer(),this._destoryTarget(),this._clearDelayHide()}layout(){const e=this._triggerElement,t=this._targetElement,n=this._layoutWatcher;if(!t||!e||!this._shown){n&&(n(),this._layoutWatcher=void 0);return}n||(this._layoutWatcher=ff(e,t,()=>{if(this.destroyed||!this._shown)return;const{animation:s,name:r="popover",minWidth:o,minHeight:a,maxWidth:l,maxHeight:c,limitInScreen:d,onLayout:u}=this.options;if(!this._virtual){const p={minWidth:Be(o),minHeight:Be(a),maxWidth:Be(l),maxHeight:Be(c)},{width:g,height:b}=this.options;g&&(p.width=typeof g=="function"?g():g==="100%"?y(e).outerWidth():g),b&&(p.height=typeof b=="function"?b():b),Object.keys(p).length&&y(t).css(p)}hc(...this._getLayoutOptions()).then(({x:p,y:g,middlewareData:b,placement:C,strategy:S})=>{if(e instanceof HTMLElement&&Nn(e)){this.hide(!0);return}const x={position:S,left:p,top:g},D=y(t).css(x);d&&D.css({top:Math.max(0,Math.min(window.innerHeight-D.outerHeight(),g)),left:Math.max(0,Math.min(window.innerWidth-D.outerWidth(),p))});const A=C.split("-")[0],B={top:"bottom",right:"left",bottom:"top",left:"right"}[A],H=b.arrow;H&&D.attr("data-pop-placement",A).find(".arrow").css({left:H.x,top:H.y}).attr("class",`arrow ${r}-arrow arrow-${B}`),s===!0&&D.attr("class",`${D.attr("class").split(" ").filter(G=>G!=="fade"&&!G.startsWith("fade-from")).join(" ")} fade-from-${B}`),this._virtual||y(this._triggerElement).attr("data-pop-placement",A),u&&u.call(this,{target:t,trigger:e,popSide:A,arrowSide:B,x:p,y:g,placement:C,strategy:S})})}))}render(e){super.render(e);const t=this._targetElement;if(!t)return;const n=this._getRenderOptions(),s=y(t);if(s.z("popover",this.gid).toggleClass("popup",n.popup).css(n.style),n.className&&s.setClass(n.className),this._dynamic){let r=this._panel;r&&r.element!==t&&(r.destroy(),r=void 0),r?r.render(n):(r=new No(t,n),r.on("inited",()=>this.layout())),this._panel=r}else n.arrow&&(s.find(".arrow").length||s.append(y('<div class="arrow"></div>').css(n.arrowStyle))),this.layout()}handleClickOutside(e){if(this.options.mask){const t=this._triggerElement;t instanceof HTMLElement&&y(e.target).closest(t).length||this.hide()}}handleClickTarget(e){}delayHide(e=100){this._resetTimer(),this._clearDelayHide(),this._hideTimer=window.setTimeout(()=>{this._hideTimer=0,this.hide()},e)}_clearDelayHide(){this._hideTimer&&(clearTimeout(this._hideTimer),this._hideTimer=0)}_getLayoutOptions(){const e=this._triggerElement,t=this._targetElement,{placement:n,flip:s,limitSize:r,shift:o,offset:a,arrow:l,strategy:c}=this.options,d=l?t.querySelector(".arrow"):null,u=d?typeof l=="number"?l:5:0,p=()=>typeof a=="function"?a:typeof a=="object"?{mainAxis:(a.mainAxis||0)+u,...a}:(a||0)+u;return[e,t,{placement:n,strategy:c,middleware:[s?cc():null,o?lc(typeof o=="object"?o:void 0):null,a||u?ac(p()):null,l?Q_({element:d}):null,r?pf({apply({availableWidth:g,availableHeight:b,placement:C}){y(t).css({maxHeight:b-(["top","bottom"].includes(C.split("-")[0])?u:0)-2,maxWidth:g-2})}}):null].filter(Boolean)}]}_getRenderOptions(){const{name:e="popover"}=this.options,{popup:t,title:n,content:s,headingClass:r=`${e}-heading`,titleClass:o=`${e}-title`,contentClass:a=`${e}-content`,style:l,className:c=e,closeBtn:d,arrow:u,footer:p,footerClass:g=`${e}-footer`}=this.options;return{popup:t,title:n,titleClass:o,headingClass:r,contentClass:a,content:s,style:{zIndex:this._zIndex,...l},className:c,closeBtn:d,arrow:u?`arrow ${e}-arrow`:!1,arrowStyle:{"--arrow-size":`${typeof u=="number"?u:5}px`},onlyInner:!0,footer:p,footerClass:g}}_destoryTarget(){var e,t,n;(e=this._layoutWatcher)==null||e.call(this),this._layoutWatcher=void 0,this._dynamic&&((t=this._panel)==null||t.destroy(),(n=this._targetElement)==null||n.remove(),this._panel=void 0,this._targetElement=void 0)}_resetTimer(e,t=0){this._timer&&clearTimeout(this._timer),e&&(this._timer=window.setTimeout(()=>{this._timer=0,e()},t))}_createTarget(){const{container:e="body"}=this.options,t=y(e);let n=t.find(`#${this._id}`);return n.length||(n=y("<div />").attr({id:this._id,class:"popover"}).appendTo(t)),n[0]}static show(e){const{element:t,event:n,...s}=e,r=t||(n==null?void 0:n.currentTarget);return this.ensure(r instanceof HTMLElement?r:document.body,{element:r,show:!0,destroyOnHide:!0,triggerEvent:n,...s})}};Qi.NAME="Popover",Qi.Z_INDEX=1700,Qi.MULTI_INSTANCE=!0,Qi.DEFAULT={placement:"top",strategy:"absolute",flip:!0,arrow:!0,offset:1,trigger:"click",mask:!0,delay:0,animation:!0,closeBtn:!0,popup:!0,elementShowClass:"with-popover-show",hideNewOnHide:!0},Qi.SHOWN_POPOVERS=new Map;let Et=Qi;Et.toggle={trigger:["click","hover"],convertHref:{selector:"target"},check(i,e){const t=y(i);return t.data(this.KEY)?!1:e==="hover"?(t.dataset("trigger")||this.DEFAULT.trigger)==="hover":!0},getOptions(i,e,t){return{triggerEvent:t,...e}},onToggle(i,e,t){i.toggle({event:t})}},Et.register(),y(()=>{y(document).on(`click.${Et.NAMESPACE}`,i=>{const{SHOWN_POPOVERS:e}=Et;if(!e.size)return;const t=y(i.target),n=t.closest("[z-popover]"),s=n.length?n.z("popover"):0,r=s?e.get(s):null;if(r){const a=r.options.name??r.constructor.ZUI;if(t.closest(`[data-dismiss="popover"],[data-dismiss="${a}"]`).length){r.hide();return}if(r.handleClickTarget(i))return}const o=[...e.values()].sort((a,l)=>l.zIndex-a.zIndex);for(const a of o)if(a!==r&&a.handleClickOutside(i))return})}),Object.assign(window,{Popover:Et});const cC="";class nn extends Et{handleClickTarget(e){const t=y(e.target),{notHideOnClick:n}=this.options;return(!n||!t.closest(n).length)&&this.hide(),!0}_getMenuOptions(){const{items:e,placement:t,menu:n,tree:s,onClickItem:r,relativeTarget:o=this._triggerElement}=this.options;return{items:e,placement:t,tree:s,onClickItem:r,nestedToggle:".item",accordion:!0,relativeTarget:{target:o,event:this.options.triggerEvent,dropdown:this},dropdown:this,popup:!0,...n}}_getRenderOptions(){const e=super._getRenderOptions();return this._dynamic?{...e,contentClass:"",popup:!1,content:w(Mo,this._getMenuOptions())}:e}}nn.NAME="Dropdown",nn.DEFAULT={...Et.DEFAULT,name:"dropdown",placement:"bottom-start",arrow:!1,closeBtn:!1,animation:"fade",limitSize:!0,notHideOnClick:".not-hide-menu,.form-control,input,label,.nested-toggle-icon"},nn.toggle={...Et.toggle,getOptions(i,e,t){return e=Et.toggle.getOptions.call(this,i,e,t),!e.target&&!e.items&&!e.menu&&(e.target=y(i).next(".dropdown-menu")),e}},nn.register();class Xi extends ke{constructor(){super(...arguments),this._ref=fe()}get triggerElement(){return this._ref.current}_updateData(){const{dropdown:e,menu:t,items:n,onClickItem:s,relativeTarget:r=this.triggerElement}=this.props,o=nn.get(this.triggerElement),a={items:n,onClickItem:s,menu:t,relativeTarget:r,...y(this.triggerElement).dataset(),...e};o?o.setOptions(a):new nn(this.triggerElement,a)}componentDidMount(){this._updateData()}componentDidUpdate(){this._updateData()}componentWillUnmount(){var e;(e=nn.get(this.triggerElement))==null||e.destroy()}_getProps(e){const{trigger:t,placement:n}=e;return{...super._getProps(e),"data-toggle":"dropdown","data-trigger":t,"data-placement":n,ref:this._ref}}}Xi.defaultProps={caret:!0},Object.assign(Ht.ItemComponents,{dropdown:Xi}),Object.assign(He.ItemComponents,{dropdown:Xi});class Mo extends st{constructor(){super(...arguments),this._handleSearchFocus=()=>{this._searchFocused=!0},this._handleSearchBlur=()=>{this._searchFocused=!1}}get isHoverTrigger(){const{nestedTrigger:e,tree:t}=this.props;return e?e==="hover":!t}get dropdown(){return this.props.dropdown}layout(){var d;if(this.props.tree||this.isRoot)return;const e=(d=this.element)==null?void 0:d.parentElement,t=y(e);e&&this._searchFocused&&this._position&&t.css(this._position);const r=t.parent().children(".dropdown-menu").children(`[z-key-path="${this.props.parentKey}"]`)[0];if(!e||!r)return;let{maxHeight:o}=this.props;const{flip:a,shift:l,offset:c}=this.props;hc(r,e,{placement:this.props.placement,middleware:[a?cc():null,l?lc(typeof l=="object"?l:void 0):null,ac(c),pf({apply({availableWidth:u,availableHeight:p}){if(o){const[g,b]=ai(o);o=Math.min(b==="%"?g*window.innerHeight:g,p-2)}else o=p;t.css({maxHeight:o,maxWidth:u-2})}})]}).then(({x:u,y:p})=>{t.css({left:u,top:p}),this._position={left:u,top:p,width:e.offsetWidth,height:e.offsetHeight}})}_getClassName(e){return["dropdown-menu scrollbar-hover scrollbar-thin",super._getClassName(e)]}_afterRender(e){super._afterRender(e),this.layout()}_getNestedProps(e,t,n,s){return xe(this.isHoverTrigger?{"z-key":n.key,"z-hover":this.props.parentKey??"root",onMouseEnter:this._handleHover,onMouseLeave:this._handleHover}:{},super._getNestedProps(e,t,n,s))}_getItemFromEvent(e){const t=super._getItemFromEvent(e);if(t)return t;const n=y(e.target).closest(".dropdown-menu[z-key]");if(n.length){const s=n.attr("z-key"),r=n.parent().parent().children(".dropdown-menu").children(`[z-key="${s}"]`);if(r.length)return super._getItemFromEvent(e,r[0])}}_renderNestedList(e,t,n,s){const r=super._renderNestedList(e,t,n,s);if(this.props.tree)return r;this._nestedContextMenu.push(r)}_getWrapClass(e){return[super._getWrapClass(e),e.tree?"is-tree":this.isRoot?"is-contextmenu":"is-contextmenu popup"]}_renderWrapperFooter(e){const t=super._renderWrapperFooter(e),n=this._nestedContextMenu;return this.props.tree||!n.length?t:[t,...n]}_renderNestedToggle(e,t){if(this.props.tree)return super._renderNestedToggle(e,t);if(typeof t=="boolean")return k("span",{className:`${this.name}-toggle nested-toggle-icon`,children:k("span",{className:"caret-right"})})}_getSearchBoxProps(e){return{...super._getSearchBoxProps(e),onFocus:this._handleSearchFocus,onBlur:this._handleSearchBlur}}_beforeRender(e){return this._nestedContextMenu=[],super._beforeRender(e)}}Mo.defaultProps={...st.defaultProps,searchBox:!1,placement:"right-start",defaultNestedShow:!1,expandOnSearch:!1,nestedSearch:!1,flip:!1,shift:!0,offset:1},Mo.inheritNestedProps=[...st.inheritNestedProps,"container","tree"];const uv=Object.freeze(Object.defineProperty({__proto__:null,DropdownButton:Xi,DropdownMenu:Mo},Symbol.toStringTag,{value:"Module"}));function dv({type:i,pagerInfo:e,linkCreator:t,items:n=[5,10,15,20,25,30,35,40,45,50,100,200,500,1e3,2e3],dropdown:s={},menu:r,itemProps:o,...a}){var c;s.items=n.map(d=>{const u={...e,recPerPage:d};return{...o,key:d,text:`${d}`,active:d===e.recPerPage,url:t?typeof t=="function"?t(u):Ce(t,u):void 0,"z-change-page-size":d}});const{text:l=""}=a;return a.text=typeof l=="function"?l(e):Ce(l,e),s.menu={...r,...s.menu,className:V((c=s.menu)==null?void 0:c.className,"pager-size-menu")},k(Xi,{dropdown:s,...a})}function If({key:i,page:e,type:t,btnType:n,pagerInfo:s,size:r,onClick:o,onChange:a,linkCreator:l,...c}){const d={...c};let u;const p=C=>{var S;u=Number((S=C.target)==null?void 0:S.value)||1,u=u>s.pageTotal?s.pageTotal:u},g=C=>{if(!(C!=null&&C.target))return;u=u<=s.pageTotal?u:s.pageTotal;const S=zs(s,u);a&&!a({info:S,event:C})||(C.target.href=d.url=typeof l=="function"?l(S):Ce(l,S))},b=zs(s,e||0);return d.url=typeof l=="function"?l(b):Ce(l,b),k("div",{className:V("input-group","pager-goto-group",r?`size-${r}`:""),children:[k("input",{type:"number",class:"form-control",max:s.pageTotal,min:"1",onInput:p}),k(ke,{type:n,...d,onClick:g})]})}const Eo=class du extends He{constructor(){super(...arguments),this._pagerChanges=It({}),this._changedPager=Ge(()=>du.format({...this.props,...this._pagerChanges.value})),this._changeEffect=dn(()=>{const{onChangePageInfo:e}=this.props,t=this._changedPager.value;e&&this._changeEvent&&(e(t,this._changeEvent),this._changeEvent=void 0)}),this._handleClickLink=e=>{const t=y(e.currentTarget);if(t.is(".disabled"))return;const n=t.z("goToPage");typeof n=="number"&&(this._changeEvent=e,this._pagerChanges.value={...this._pagerChanges.value,page:n})},this._handleClickSizeMenu=e=>{const{item:t}=e,n=t["z-change-page-size"];typeof n=="number"&&!t.disabled&&(this._changeEvent=e.event,this._pagerChanges.value={...this._pagerChanges.value,recPerPage:n})}}_isBtnType(e){const{type:t}=e;return super._isBtnType(e)||["link","nav","size-menu","goto"].includes(t)}componentDidUpdate(e){if(this.props.useState)this.props.recTotal!==e.recTotal&&(this._pagerChanges.value={...this._pagerChanges.value,recTotal:this.props.recTotal});else{const{page:t,recTotal:n,recPerPage:s}=this.props;(t!==e.page||n!==e.recTotal||s!==e.recPerPage)&&(this._pagerChanges.value={})}}componentWillUnmount(){this._changeEffect()}_beforeRender(e){return this._pagerInfo=e.useState?this._changedPager.value:du.format(e),super._beforeRender(e)}_getItem(e,t,n){const s=super._getItem(e,t,n);if(!s)return!1;const{type:r="item"}=t,o=this._pagerInfo;return r==="info"?y.extend(s,{pagerInfo:o}):(r==="link"||r==="size-menu"||r==="nav"||r==="goto")&&y.extend(s,{pagerInfo:o,linkCreator:e.linkCreator}),r==="size-menu"&&(s.menu={onClickItem:this._handleClickSizeMenu,...s.menu}),r==="link"&&(s.onClick=this._handleClickLink),s}static format(e){const{page:t=1,recTotal:n=0,recPerPage:s=10}=e,r=Math.max(0,+n),o=Math.max(1,+s),a=o?Math.ceil(r/o):0;return{page:Math.min(Math.max(1,+t),a),recTotal:r,recPerPage:o,pageTotal:a}}};Eo.NAME="pager",Eo.ItemComponents={...He.ItemComponents,info:Tf,link:Sf,nav:cv,"size-menu":dv,goto:If},Eo.defaultItemProps={btnType:"ghost",size:"sm"};let Ao=Eo;class Cc extends _e{}Cc.NAME="Pager",Cc.Component=Ao,Xe(Object.freeze(Object.defineProperty({__proto__:null,Pager:Ao,PagerGoto:If,PagerInfoItem:Tf,PagerLink:Sf},Symbol.toStringTag,{value:"Module"})));const uC="",dC="";class Po extends _e{}Po.NAME="Pick",Po.Component=rt,Po.replace=!0;const fC="",pC="",mC="",gC="";class xc extends pe{constructor(e){super(e),this._searchInput=fe(),this._measure=fe(),this._changeTimer=0,this._handleChange=t=>{const n=t.target.value;this.setState({search:n},()=>{const{onSearch:s}=this.props;s&&(this._changeTimer&&clearTimeout(this._changeTimer),this._changeTimer=window.setTimeout(()=>{this._changeTimer=0,s(n)},this.props.debounce||300))}),t.stopPropagation()},this._handleClear=t=>{t.stopPropagation(),this.clear()},this.state={search:e.defaultSearch??""}}get $pop(){return y(`#pick-pop-${this.props.id}`)}focus(){var e;(e=this._searchInput.current)==null||e.focus()}clear(){var e,t;(t=(e=this.props).onClear)==null||t.call(e),this.setState({search:""},()=>this.focus())}componentDidMount(){this.focus();const{hotkeys:e}=this.props;if(e){const t=vl(e,{clear:{keys:"Escape",handler:()=>{this.state.search.trim().length?this.clear():this.$pop.trigger("hidePop")}},enter:{keys:"Enter",handler:n=>{n.preventDefault(),this.$pop.trigger("selectActive"),this.clear()}},activeNext:{keys:"ArrowDown",handler:()=>{this.$pop.trigger("activeNext")}},activePrev:{keys:"ArrowUp",handler:()=>{this.$pop.trigger("activePrev")}}});t&&(this._hotkeysScope=`PickerSearch_${ft()}`,y(this._searchInput.current).hotkeys(t,{scope:this._hotkeysScope,event:"keydown"}))}}componentDidUpdate(){const{inline:e}=this.props;if(e){const{current:t}=this._measure,{current:n}=this._searchInput;if(t&&n){const s=y(n).parent();s.width(Math.ceil(Math.min(t.clientWidth,s.closest(".picker").outerWidth()-32)))}}}componentWillUnmount(){clearTimeout(this._changeTimer),this._hotkeysScope&&y(this._searchInput.current).unbindHotkeys(this._hotkeysScope)}render(e,t){const{placeholder:n,inline:s}=e,{search:r}=t,o=r.trim().length>0;let a;return s?a=k("div",{className:"picker-search-measure",ref:this._measure,children:r}):o?a=k("button",{type:"button",className:"btn picker-search-clear square size-sm ghost",onClick:this._handleClear,children:k("span",{className:"close"})}):a=k("span",{className:"magnifier"}),k("div",{className:`picker-search${s?" is-inline":""}`,children:[k("input",{className:"form-control picker-search-input",type:"text",placeholder:n,value:r,autoComplete:"off",onChange:this._handleChange,onInput:this._handleChange,ref:this._searchInput}),a]})}}class Nf extends uo{constructor(){super(...arguments),this._search=fe(),this._handleDeselectClick=e=>{const{onDeselect:t,state:{selections:n}}=this.props,s=y(e.target).closest(".picker-deselect-btn").attr("data-value");t&&n.length&&typeof s=="string"&&t(s),e.stopPropagation()},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})},this._renderSelection=e=>{const{text:t}=e;return k("div",{className:"picker-multi-selection",title:typeof t=="string"?t:void 0,children:[k("span",{className:"text",children:k(me,{content:t})}),this.props.disabled||this.props.readonly?null:k("div",{className:"picker-deselect-btn btn size-xs ghost",onClick:this._handleDeselectClick,"data-value":e.value,children:k("span",{className:"close"})})]},e.value)}}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return V(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-multi form-control")}_renderSearch(e){const{state:{search:t},searchHint:n,hotkeys:s}=e;return k(xc,{inline:!0,id:e.id,ref:this._search,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:n,hotkeys:s})}_renderTrigger(e){const{state:{selections:t=[],open:n,value:s},search:r,placeholder:o,display:a,valueList:l,children:c,caretClass:d}=this.props,u=n&&r;let p;const g=!u&&!t.length;return a&&(!g||o===void 0)?(typeof a=="function"?p=a.call(this,l,t):typeof a=="string"&&(p=Ce(a,{value:s,values:l,count:l.length})),p=k("div",{className:"picker-multi-selections",children:p},"selections")):g?p=k("span",{className:"picker-select-placeholder",children:o},"selections"):p=k("div",{className:"picker-multi-selections",children:[t.map(this._renderSelection),u?this._renderSearch(e):null]},"selections"),[p,c,k("span",{class:V("caret",d)},"caret")]}_renderValue(e){const{name:t,state:{value:n=""},disabled:s,readonly:r,id:o,valueList:a,emptyValue:l}=e;if(t)if(this.hasInput)y(`#${o}`).val(n);else{const c=a.length?a:[l];return k("select",{id:o,multiple:!0,className:"pick-value",name:t.endsWith("[]")?t:`${t}[]`,disabled:s,readonly:r,style:{display:"none"},children:c.map(d=>k("option",{value:d,children:d},d))})}return null}componentDidMount(){super.componentDidMount();const{id:e,valueList:t,emptyValue:n}=this.props;y(`#${e}`).val(t.length?t:[n])}componentDidUpdate(e){const{id:t,state:n,name:s,valueList:r,emptyValue:o}=this.props;if(s&&e.state.value!==n.value){const a=y(`#${t}`).val(r.length?r:[o]);this._skipTriggerChange!==n.value&&a.trigger("change",Zd),this._skipTriggerChange=!1}}}class Mf extends uo{constructor(){super(...arguments),this._search=fe(),this._handleDeselectClick=e=>{this.props.disabled||(this.props.onClear(),e.stopPropagation())},this._handleSearch=e=>{this.props.changeState({search:e})},this._handleSearchClear=()=>{this.props.togglePop(!0,{search:""})}}_getSearchPlaceholder(){const{searchHint:e,state:{value:t,selections:n}}=this.props;let s=e;if(s===void 0){const r=n.find(o=>o.value===t);r&&typeof r.text=="string"&&(s=r.text)}return s}_handleClick(e){var t;super._handleClick(e),(t=this._search.current)==null||t.focus()}_getClass(e){return V(super._getClass(e),e.search?"":"picker-no-search","picker-select picker-select-single form-control")}_renderSearch(e){const{state:{search:t},hotkeys:n}=e;return k(xc,{ref:this._search,id:e.id,defaultSearch:t,onSearch:this._handleSearch,onClear:this._handleSearchClear,placeholder:this._getSearchPlaceholder(),hotkeys:n})}_renderTrigger(e){const{children:t,state:{selections:n=[],value:s,open:r},placeholder:o,search:a,disabled:l,readonly:c,clearable:d,display:u,caretClass:p}=e,[g]=n,b=r&&a;let C;if(b)C=this._renderSearch(e);else if(g||o===void 0&&u){const{text:D}=g||{text:"",value:""};typeof u=="function"?C=u.call(this,s,n):typeof u=="string"?C=Ce(u,g):C=k(me,{content:D}),C=k("span",{className:"picker-single-selection",title:typeof D=="string"?D:void 0,children:C},"main")}else C=k("span",{className:"picker-select-placeholder",children:o},"main");const S=d&&!b?k("button",{type:"button",className:"btn picker-deselect-btn size-xs square ghost",disabled:l,readonly:c,onClick:this._handleDeselectClick,children:k("span",{className:"close"})},"deselect"):null,x=b?null:k("span",{className:V("caret flex-none",p)},"caret");return[C,t,S,x]}}function Ef(i,e){return i.reduce((t,n)=>(Array.isArray(n.items)&&Ef(n.items,t),typeof n.value=="string"&&t.set(n.value,n),t),e||new Map)}class Af extends uc{constructor(){super(...arguments),this._menu=fe(),this._disabledSet=new Set,this._getItem=(e,t)=>{var c;if(e.parentKey!==void 0)return e;const n=new Set(this.props.valueList);let s=e.items,r=!1,o=!1;Array.isArray(s)&&(r=!0,s=s.reduce((d,u,p)=>{const g=this._getItem(u,p);return g&&(g.selected?o=!0:r=!1,d.push(g)),d},[]));const a=r||n.has(e.value);e={selected:a,hint:typeof e.text=="string"?e.text:void 0,...e,checked:this._hasCheckbox||typeof e.checked=="boolean"?r?!0:o?"indeterminate":a:void 0,className:V(e.className,{hover:e.value!==void 0&&e.value===this.props.state.hoverItem}),items:s},a&&!e.disabled&&this._firstSelected===void 0&&(this._firstSelected=e.key),e.content&&e.text&&delete e.text;const l=((c=this._getItemCallback)==null?void 0:c.call(this,e,t))??e;return l&&(l.disabled&&this._disabledSet.add(l.value),l)},this._beforeRenderItem=(e,t)=>{var n;return(n=this._renderItemCallback)==null?void 0:n.call(this,e,t)},this._handleItemClick=({item:e,event:t})=>{const n=e.value,s=t.target;if(e.disabled||n===void 0||s.closest(".item-icon,.nested-toggle-icon,.disabled")||Array.isArray(e.items)&&e.items.every(d=>this._disabledSet.has(d.value)))return;const{multiple:r,onToggleValue:o,onSelect:a,togglePop:l,onDeselect:c}=this.props;if(r)if(e.items){const u=[...Ef(e.items).values()].filter(p=>!p.items&&!this._disabledSet.has(p.value)).map(p=>p.value);y(s).closest(".item").children(".item-inner.selected").length?c(u):a(u)}else o(n);else a(n),l(!1,{search:""})}}get menu(){return this._menu.current}get picker(){return this.props.picker}componentDidMount(){var e,t;super.componentDidMount(),this._firstSelected===void 0?(e=this.menu)==null||e.activeNext():(t=this.menu)==null||t.toggleActive(this._firstSelected,!0),y(this.element).on("activeNext.zui.Picker",()=>{var n;(n=this.menu)==null||n.activeNext()}).on("activePrev.zui.Picker",()=>{var n;(n=this.menu)==null||n.activePrev()}).on("selectActive.zui.Picker",()=>{const n=this.menu;if(!n)return;const s=n.getActiveKey();if(s!==void 0){const r=n.getRenderedItem(s);r&&y(this.element).find(`.item[z-key-path="${r._keyPath}"]`).trigger("click")}}).on("hidePop.zui.Picker",()=>{this.props.togglePop(!1)}),setTimeout(()=>{var n;y((n=this.menu)==null?void 0:n.element).find(".menu-item>.active").scrollIntoView({container:".menu"})},100)}componentWillUnmount(){super.componentWillUnmount(),y(this.element).off(".zui.Picker")}_getClass(e){return V(super._getClass(e),"picker-menu")}_getMenuProps(e){const{menu:t,tree:n,state:s,checkbox:r,header:o,footer:a,noMatchHint:l,maxItemsCount:c,exceedLimitHint:d}=e,{items:u,search:p}=s;return xe({ref:this._menu,className:"picker-menu-list",underlineKeys:!0,limit:c,items:u,defaultNestedShow:!0,activeOnHover:!0,search:p,exceedLimitHint:d,onClickItem:this._handleItemClick,nestedToggle:".nested-toggle-icon,.item-icon",checkbox:r,searchProps:["keys","text","title","subtitle","value"],header:o,footer:a,noMatchHint:l,relativeTarget:this},t,n)}_renderPop(e){const{tree:t}=e;this._firstSelected=void 0,this._disabledSet.clear();const n=this._getMenuProps(e);return this._hasCheckbox=!!n.checkbox,this._getItemCallback=n.getItem,this._renderItemCallback=n.beforeRenderItem,n.getItem=this._getItem,n.beforeRenderItem=this._beforeRenderItem,t?k(hi,{...n}):k(st,{...n})}}function fi(i,e){return i.reduce((t,n)=>(Array.isArray(n.items)&&fi(n.items,t),t.set(n.value===void 0?"":String(n.value),n),t),e||new Map)}let Kt=class extends rt{constructor(e){super(e),this._updateTimer=0,this.toggleValue=(t,n)=>{if(!this.props.multiple)return n||t!==this.value?this.setValue(t):this.setValue();const{valueList:s}=this,r=s.indexOf(t);if(n!==r>=0)return r>-1?s.splice(r,1):s.push(t),this.setValue(s)},this.deselect=(t=[])=>{const{valueList:n}=this,s=new Set(this.formatValueList(t)),r=n.filter(o=>!s.has(o));this.setValue(r)},this.clear=()=>{this.setValue()},this.select=t=>{const n=this.formatValueList(t),s=this.props.multiple?[...this.valueList,...n]:n[0];return this.setValue(s)},this.isSelected=t=>this.valueList.includes(t),this.setValue=this.setValue.bind(this),this.isEmptyValue=this.isEmptyValue.bind(this)}get valueList(){return this.formatValueList(this.state.value)}get firstEmptyValue(){return this._emptyValueSet.values().next().value}getDefaultState(e){const{items:t,valueSplitter:n=",",emptyValue:s=""}=e||this.props,r={...super.getDefaultState(e),loading:!1,search:"",items:t,selections:[]};if(this._emptyValueSet=new Set(typeof s=="string"?s.split(n):[]),Array.isArray(t)&&t.length){const{limitValueInList:o,required:a,multiple:l}=this.props;if(t.forEach(c=>{typeof c.value=="number"&&(c.value=String(c.value))}),o){const c=fi(t);r.value=this.formatValueList(r.value,n).filter(d=>c.has(d)).join(n)}!this.formatValueList(r.value,n).length&&a&&!l&&(r.value=t[0].value??"")}return r}isEmptyValue(e){return this._emptyValueSet.has(e)}deselectAll(){this.setValue([])}selectAll(){const{items:e}=this.state;if(!Array.isArray(e))return;const n=[...fi(e).values()].reduce((s,r)=>(r.disabled||s.push(r.value),s),[]);return this.select(n)}isSelectedAll(){const{items:e}=this.state;if(!Array.isArray(e))return!1;const t=fi(e),n=new Set(this.valueList);return[...t.values()].every(s=>s.disabled||n.has(s.value))}async load(){let e=this._abort;e&&e.abort(),e=new AbortController,this._abort=e;const{items:t=[],searchDelay:n}=this.props,{search:s=""}=this.state;let r=[];if(Array.isArray(t))r=t;else{if(await gs(n||500),this._abort!==e)return r;let o=t;if(typeof o=="string"&&(o={url:o}),typeof o=="object"&&o.url&&(o={...o,url:Ce(o.url,{search:encodeURIComponent(s)})}),r=await zt(o,[this,s],{signal:e.signal}),this._abort!==e)return r}return this._abort=void 0,r}changeState(e,t){return super.changeState(n=>{const s=typeof e=="function"?e(n):e;if(s.value!==void 0&&s.value!==n.value||s.items&&s.items!==n.items){const r=s.items||n.items,o=new Map;Array.isArray(n.items)&&n.items!==s.items&&fi(n.items,o),fi(r,o),s.selections=this.formatValueList(s.value??n.value).reduce((a,l)=>(this.isEmptyValue(l)||a.push(o.get(l)||{value:l,text:l}),a),[])}return s},t)}async update(e){const{state:t,props:n}=this,s=this._itemsCacheInfo||{},r={};if(this._itemsCacheInfo=s,!t.loading&&(e||s.search!==t.search||n.items!==s.items)){await this.changeState({loading:!0});let a=await this.load();a=a.filter(l=>(l.key=l.key??l.value,typeof l.value=="number"&&(l.value=String(l.value)),!this.isEmptyValue(l.value))),r.loading=!1,r.items=a,s.items=n.items,s.search=t.search}else s.items&&!t.open&&n.cache===!1&&!Array.isArray(n.items)&&(s.items=void 0);(e||s.value!==t.value)&&(s.value=t.value);const o=r.items;n.required&&!n.multiple&&this.isEmptyValue(this.state.value)&&Array.isArray(o)&&o.length&&(r.value=o[0].value),Object.keys(r).length&&await this.changeState(r)}async tryUpdate(){this._updateTimer&&clearTimeout(this._updateTimer),this._updateTimer=window.setTimeout(()=>{this._updateTimer=0,this.update()},50)}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.tryUpdate()}componentDidMount(){super.componentDidMount(),this.tryUpdate()}componentWillUnmount(){var e;(e=this._abort)==null||e.abort(),this._abort=void 0,this._itemsCacheInfo=void 0,clearTimeout(this._updateTimer),super.componentWillUnmount()}_handleChange(e,t){if(super._handleChange(e,t),e!==t){const{onDeselect:n,onSelect:s,onClear:r,multiple:o}=this.props,a=this.formatValueList(t),l=this.valueList;if(r&&!l.length&&a.length&&r.call(this),n){const c=a.filter(d=>!l.includes(d));c.length&&n.call(this,o?c:c[0])}if(s){const c=l.filter(d=>!a.includes(d));c.length&&s.call(this,o?c:c[0])}}}_getTriggerProps(e,t){return{...super._getTriggerProps(e,t),multiple:e.multiple,hotkeys:e.hotkeys,placeholder:e.placeholder,search:e.search,display:e.display,searchHint:e.searchHint,caretClass:e.caretClass,clearable:!!this.valueList.length&&!e.required,valueList:this.valueList,emptyValue:this.firstEmptyValue,onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue}}_getPopProps(e,t){return{...super._getPopProps(e,t),picker:this,menu:e.menu,tree:e.tree,checkbox:e.checkbox,multiple:e.multiple,search:e.search,maxItemsCount:e.maxItemsCount,footer:this._renderToolbar(),valueList:this.valueList,noMatchHint:t.loading?Ne.getLang("loadingHint"):e.searchEmptyHint??Ne.getLang("searchEmptyHint"),exceedLimitHint:e.exceedLimitHint??Ne.getLang("exceedLimitHint"),onDeselect:this.deselect,onSelect:this.select,onClear:this.clear,onToggleValue:this.toggleValue,onSetValue:this.setValue}}_getTrigger(e){return e.Trigger||(e.multiple?Nf:Mf)}_renderToolbar(){let{toolbar:e}=this.props;return e?(e===!0&&(e=[{key:"selectAll",text:Ne.getLang("selectAll")},{key:"cancelSelect",text:Ne.getLang("cancelSelect")}]),He.render(e,[],{size:"sm",relativeTarget:this,getItem:t=>(t.onClick||(t.key==="selectAll"?(t.onClick=this.selectAll.bind(this),t.disabled=this.isSelectedAll()):t.key==="cancelSelect"&&(t.onClick=this.deselectAll.bind(this),t.disabled=!this.valueList.length)),t)},this)):null}formatValueList(e,t){let n;return typeof e=="string"&&e.length?n=e.split(t??this.props.valueSplitter??","):Array.isArray(e)?n=e:n=[e],y.unique(n).reduce((s,r)=>(r==null||(r=typeof r!="string"?String(r):r,this.isEmptyValue(r)||s.push(r)),s),[])}formatValue(e){const t=this.formatValueList(e);return t.length?t.join(this.props.valueSplitter??","):this.firstEmptyValue}setValue(e=[],t){let n=this.formatValueList(e);if(n.length){const{items:r,limitValueInList:o}=this.props;if(o){const a=fi(Array.isArray(r)?r:this.state.items);n=n.filter(l=>a.has(l))}}const s=this.formatValue(n);return super.setValue(s,t)}};Kt.defaultProps={...rt.defaultProps,className:"picker",valueSplitter:",",limitValueInList:!0,search:!0,emptyValue:"",cache:!0,hotkeys:!0},Kt.Pop=Af;const fv=Object.freeze(Object.defineProperty({__proto__:null,Picker:Kt,PickerMenu:Af,PickerMultiSelect:Nf,PickerSearch:xc,PickerSingleSelect:Mf},Symbol.toStringTag,{value:"Module"}));class Lo extends _e{}Lo.NAME="Picker",Lo.Component=Kt,Lo.register(),Ne.addLang({zh_cn:{selectAll:"全选",cancelSelect:"取消选择",searchEmptyHint:"无匹配选项",loadingHint:"正在加载...",exceedLimitHint:"还有 {0} 个选项没有显示，可尝试搜索来查找"},zh_tw:{selectAll:"全選",cancelSelect:"取消選擇",searchEmptyHint:"無匹配選項",loadingHint:"正在載入...",exceedLimitHint:"還有 {0} 個選項沒有顯示，可嘗試搜索來查找"},en:{selectAll:"Select All",cancelSelect:"Cancel Select",searchEmptyHint:"No matching options",loadingHint:"Loading...",exceedLimitHint:"There are {0} items not displayed, try searching to find"}}),Xe(fv);class Ro extends _e{}Ro.NAME="SearchBox",Ro.Component=ci,Ro.register(),Xe(Zy);const yC="";function kc(i,e){const[t,n]=ai(i);return n==="%"?e*t/100:t}const Pf="is-sidebar-resizing",Lf="has-sidebar-animation",Sc="is-animating",Oo=".sidebar-gutter";class zo extends ze{get side(){return this._side}get width(){return this._width}get $parent(){const{parent:e}=this.options;return e?y(e):this.$element.parent()}afterInit(){const{$element:e}=this,t=e.parent(),n=t[0],s=t.width();this._container=n;const{preserve:r,side:o=e.hasClass("sidebar-right")?"right":"left",animation:a,dragToResize:l,width:c,minWidth:d=0,maxWidth:u=Number.MAX_SAFE_INTEGER,toggleBtn:p,dbclick:g}=this.options;this._storeID=r?`SIDEBAR:${r}:width`:"",this._side=o,this._minWidth=kc(d,s),this._maxWidth=kc(u,s),this._defaultWidth=Math.max(this._minWidth,Math.min(this._maxWidth,kc(c||e.width(),s))),this._width=(r?Ze.get(this._storeID):null)??this._defaultWidth,this.render(),p&&e.on(`click${this.namespace}`,".gutter-toggle",()=>this.toggle()),g&&e.on(`dblclick${this.namespace}`,Oo,()=>{g==="reset"?this.update(this._defaultWidth):this.toggle()}).on("mousedown",Oo,b=>{b.preventDefault()}),l&&(this._moveable=new Ns(e,{selector:Oo,move:!1,onMoveStart:()=>{this._startWidth=this._width,this.$parent.addClass(Pf).removeClass(Lf)},onMove:(b,C)=>{const{deltaX:S}=C;Math.abs(S)<10||this.update(this._startWidth+S*(o==="left"?1:-1))},onMoveEnd:()=>{a&&this.$parent.addClass(Lf),this.$parent.removeClass(Pf)}})),a&&this.on("transitionend",b=>{b.target===e[0]&&b.propertyName==="width"&&e.removeClass(Sc)})}destroy(){var e;super.destroy(),this._raf&&cancelAnimationFrame(this._raf),(e=this._moveable)==null||e.destroy()}toggle(e){e=e??!!this._width,e&&(this._widthBack=this._width),this.update(e?0:this._widthBack||this._defaultWidth)}update(e,t){if(!t){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0,this.update(e,!0)});return}const{preserve:n,toggleBtn:s,onResize:r,onToggle:o,animation:a}=this.options;if(e=e<this._minWidth?s?0:this._minWidth:Math.min(this._maxWidth,e,this._container.clientWidth),e===this._width)return;const l=!this._width,c=!e;this._width=e,n&&Ze.set(this._storeID,e),this.render(),r==null||r(e),l!==c&&(l&&a&&this.$element.addClass(Sc),o==null||o(c)),this.emit("sidebarResize",e)}render(){var d;const{side:e,width:t,$element:n,$parent:s}=this,r=!t,{toggleBtn:o,gutterWidth:a=ai(n.parent().css("gap"))[0]||1,animation:l}=this.options;n.addClass(`sidebar-${e}`).toggleClass("is-collapsed",r).toggleClass("is-expanded",!r).css({"--gutter-width":`${a}px`,width:`var(--sidebar-${e}-width)`,"--sidebar-duration":typeof l=="number"?`${l}ms`:null});let c=n.find(Oo);c.length||(c=y('<div class="sidebar-gutter gutter gutter-horz"></div>').appendTo(n)),o?c.children(".gutter-toggle").length||c.append(`<button class="gutter-toggle" type="button"><span class="chevron-${e}"></span></button>`):c.children(".gutter-resize-handler").length||c.append('<div class="gutter-resize-handler"></div>'),s.addClass(`has-sidebar-${e}`).css(`--sidebar-${e}-width`,`${t}px`).toggleClass(`is-sidebar-${e}-collapsed`,r),(d=this._moveable)!=null&&d.state&&n.removeClass(Sc)}}zo.NAME="Sidebar",zo.DEFAULT={minWidth:40,toggleBtn:!0,animation:!0,dragToResize:!0,dbclick:"reset"};const _C="",vC="",bC="";class Tc extends _e{}Tc.NAME="Toolbar",Tc.Component=He,Xe(Ky);const wC="";class Zi extends Et{_getRenderOptions(){const{type:e,className:t,title:n,content:s}=this.options;let r=n,o=s;return o===void 0&&(o=r,r=void 0),{...super._getRenderOptions(),title:r,content:o,className:V("tooltip",e,t,r?"tooltip-has-title":""),contentClass:r?"tooltip-content":""}}}Zi.NAME="Tooltip",Zi.DEFAULT={...Et.DEFAULT,trigger:"hover",delay:500,closeBtn:!1,popup:!1,name:"tooltip",animation:"fade",destroyOnHide:5e3,hideOthers:!0,hideNewOnHide:!1},Zi.register();const CC="",xC="",kC="";class Fo extends _e{}Fo.NAME="Tree",Fo.Component=bt,Fo.replace=bt.TAG;class $c extends _e{}$c.NAME="SearchTree",$c.Component=hi,Xe(s_);const SC="",TC="",$C="",DC="";class jo extends ze{init(){const{multiple:e,defaultFileList:t,limitSize:n}=this.options;this.fileMap=new Map,this.renameMap=new Map,this.itemMap=new Map,this.dataTransfer=new DataTransfer,this.limitBytes=n?$n(n):Number.MAX_VALUE,this.currentBytes=0,e||(this.options.limitCount=1),this.$element.addClass("upload"),this.initFileInputCash(),this.initUploadCash(),t&&this.addFileItem(t)}initUploadCash(){const{name:e,uploadText:t,uploadIcon:n,listPosition:s,btnClass:r,tip:o,draggable:a}=this.options;this.$list=y('<ul class="file-list py-1"></ul>');const l=y(`<span class="upload-tip">${o}</span>`);if(!a){if(this.$label=y(`<label class="btn ${r}" for="${e}">${t}</label>`),n){const p=y(`<i class="icon icon-${n}"></i>`);this.$label.prepend(p)}const u=s==="bottom"?[this.$label,l,this.$list]:[this.$list,this.$label,l];this.$element.append(this.$input,...u);return}const c=y(`<span class="text-primary">${t}</span>`);if(n){const u=y(`<i class="icon icon-${n} mr-1"></i>`);c.prepend(u)}this.$label=y(`<label class="draggable-area col justify-center items-center cursor-pointer block w-full h-16" for="${e}"></label>`).append(c).append(l),this.bindDragEvent();const d=s==="bottom"?[this.$label,this.$list]:[this.$list,this.$label];this.$element.append(this.$input,...d)}bindDragEvent(){this.$label.on("dragover",e=>{e.preventDefault(),this.$label.hasClass("border-primary")||(this.$label.removeClass("border-gray"),this.$label.addClass("border-primary")),this.$label.hasClass("dragover")||this.$label.addClass("dragover")}).on("dragleave",e=>{e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover")}).on("drop",e=>{var n;e.preventDefault(),this.$label.removeClass("border-primary"),this.$label.addClass("border-gray"),this.$label.removeClass("dragover");const t=Array.from(((n=e.dataTransfer)==null?void 0:n.files)??[]);console.log(e.dataTransfer.files),this.addFileItem(t)})}initFileInputCash(){const{name:e,multiple:t,accept:n}=this.options;this.$input=y("<input />").addClass("hidden").prop("type","file").prop("name",e).prop("id",e).prop("multiple",t).on("change",s=>{const r=s.target.files;if(!r)return;const o=[...r];this.addFileItem(o)}),n&&this.$input.prop("accept",n)}addFile(e){const{multiple:t,onSizeChange:n}=this.options;t||(this.renameMap.clear(),this.fileMap.clear(),this.dataTransfer.items.clear(),this.currentBytes=e.size),this.renameMap.set(e.name,e.name),this.fileMap.set(e.name,e),this.dataTransfer.items.add(e),this.$input.prop("files",this.dataTransfer.files),this.currentBytes+=e.size,n==null||n(this.currentBytes)}renameDuplicatedFile(e){if(!this.fileMap.has(e.name))return e;const t=e.name.lastIndexOf(".");if(t===-1)return this.renameDuplicatedFile(new File([e],`${e.name}(1)`));const n=e.name.substring(0,t),s=e.name.substring(t);return this.renameDuplicatedFile(new File([e],`${n}(1)${s}`))}filterFiles(e){const{accept:t}=this.options;if(!t)return e;const n=t.replace(/\s/g,"").split(","),s=[],r=[],o=[];return n.forEach(a=>{a.endsWith("/*")?r.push(a.substring(0,a.length-1)):a.includes("/")?s.push(a):a.startsWith(".")&&o.push(a)}),e.filter(a=>s.includes(a.type)||r.some(l=>a.type.startsWith(l))||o.some(l=>a.name.endsWith(l)))}addFileItem(e){e=this.filterFiles(e);const{multiple:t,limitCount:n,exceededSizeHint:s,onExceededSize:r,exceededCountHint:o,onExceededCount:a,onAdd:l}=this.options;if(t){for(let p of e){if(n&&this.fileMap.size>=n){a==null||a(n),o&&alert(o);return}if(this.currentBytes+p.size>this.limitBytes){r==null||r(this.limitBytes),s&&alert(s);return}p=this.renameDuplicatedFile(p);const g=l==null?void 0:l(p);if(!g)continue;p=g;const b=this.createFileItem(p);this.itemMap.set(p.name,b),this.$list.append(b)}return}if(e.length===0||e[0].size>this.limitBytes)return;let c=this.renameDuplicatedFile(e[0]);const d=l==null?void 0:l(c);if(!d)return;c=d;const u=this.createFileItem(c);this.itemMap.clear(),this.itemMap.set(c.name,u),this.$list.empty().append(u)}deleteFileItem(e){var l,c;const t=this.renameMap.get(e)??e;this.renameMap.delete(e);const n=this.fileMap.get(t);if(!n)return;const{onDelete:s,onSizeChange:r}=this.options,o=this.itemMap.get(n.name);this.itemMap.delete(n.name),o==null||o.addClass("hidden");const a=(l=o==null?void 0:o.find(".file-delete"))==null?void 0:l.data("tooltip");a&&(a.destroy(),(c=a.tooltip)==null||c.remove()),setTimeout(()=>o==null?void 0:o.remove(),3e3),s==null||s(n),this.fileMap.delete(n.name),this.currentBytes-=n.size,r==null||r(this.currentBytes),this.dataTransfer=new DataTransfer,this.fileMap.forEach(d=>this.dataTransfer.items.add(d)),this.$input.prop("files",this.dataTransfer.files)}renameFileItem(e,t){var r,o;const n=this.renameMap.get(e.name);this.renameMap.set(e.name,t),n&&(e=this.fileMap.get(n)??e);const s=this.itemMap.get(e.name);s&&(this.itemMap.set(t,s).delete(e.name),(o=(r=this.options).onRename)==null||o.call(r,t,e.name),this.fileMap.delete(e.name),this.dataTransfer=new DataTransfer,e=new File([e],t),this.fileMap.set(t,e).forEach(a=>this.dataTransfer.items.add(a)),this.$input.prop("files",this.dataTransfer.files))}createFileItem(e){const{showIcon:t}=this.options;return this.addFile(e),y('<li class="file-item my-1 flex items-center gap-2"></li>').append(t?this.fileIcon():null).append(this.createFileInfo(e)).append(this.createRenameContainer(e))}fileIcon(){const{icon:e}=this.options;return y(`<i class="icon icon-${e}"></i>`)}fileRenameBtn(){const{useIconBtn:e,renameText:t,renameIcon:n,renameClass:s}=this.options;if(e){const r=y(`<button class="btn btn-link h-5 w-5 p-0 ${s}"><i class="icon icon-${n}"></i></button>`).prop("type","button").addClass("file-action file-rename");return new Zi(r,{title:t}),r}return y("<button />").prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-rename ${s}`).html(t)}fileDeleteBtn(){const{useIconBtn:e,deleteText:t,deleteIcon:n,deleteClass:s}=this.options;if(e){const r=y(`<button class="btn btn-link h-5 w-5 p-0 ${s}"><i class="icon icon-${n}"></i></button>`).prop("type","button").addClass("file-action file-delete");return r.data("tooltip",new Zi(r,{title:t})),r}return y("<button />").html(t).prop("type","button").addClass(`btn size-sm rounded-sm text-primary canvas file-action file-delete ${s}`)}fileName(e){return y(`<span class="file-name">${e}</span>`)}fileSize(e){return y(`<span class="file-size text-gray">${dt(e)}</span>`)}createFileInfo(e){const{renameBtn:t,deleteBtn:n,showSize:s}=this.options,r=y('<div class="file-info flex items-center gap-2"></div>');return r.append(this.fileName(e.name)),s&&r.append(this.fileSize(e.size)),t&&r.append(this.fileRenameBtn().on("click",o=>{r.addClass("hidden").closest(".file-item").find(".input-rename-container.hidden").removeClass("hidden");const a=y(o.target).closest("li").find("input")[0];a.focus(),a.value.lastIndexOf(".")!==-1&&a.setSelectionRange(0,a.value.lastIndexOf("."))})),n&&r.append(this.fileDeleteBtn().on("click",()=>this.deleteFileItem(e.name))),r}createRenameContainer(e){const{confirmText:t,cancelText:n,duplicatedHint:s,onDuplicated:r}=this.options,o=y('<div class="input-group input-rename-container hidden"></div>'),a=y("<input />").addClass("form-control").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).on("keydown",u=>{if(u.key==="Enter"){const p=o.closest(".file-item"),g=p.find(".file-name");if(g.html()===a.val()){o.addClass("hidden"),p.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),s&&alert(s);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),p.find(".file-info.hidden").removeClass("hidden"),g.html(a.val())}else u.key==="Escape"&&(a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden"))}),l=y("<button />").addClass("btn primary rename-confirm-btn").prop("type","button").html(t).on("click",()=>{const u=o.closest(".file-item"),p=u.find(".file-name");if(p.html()===a.val()){o.addClass("hidden"),u.find(".file-info.hidden").removeClass("hidden");return}if(this.fileMap.has(a.val())){r==null||r(a.val()),s&&alert(s);return}this.renameFileItem(e,a.val()),o.addClass("hidden"),u.find(".file-info.hidden").removeClass("hidden"),p.html(a.val())}),c=y("<button />").prop("type","button").addClass("btn rename-cancel-btn").html(n).on("click",()=>{a.val(e.name),o.addClass("hidden").closest(".file-item").find(".file-info.hidden").removeClass("hidden")}),d=y('<div class="btn-group"></div').append(l).append(c);return o.append(a).append(d)}}jo.NAME="Upload",jo.DEFAULT={uploadText:"上传文件",confirmText:"确定",cancelText:"取消",useIconBtn:!0,renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!0,multiple:!0,listPosition:"bottom",limitSize:!1,icon:"file-o",btnClass:"",tip:"",draggable:!1,showSize:!0,onAdd:i=>i};const IC="";class Dc extends jo{init(){this.initUploadButtonItemCash(),this.options.onSizeChange=()=>{this.$uploadInfo.html(this.options.totalCountText.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.fileMap.size>0?(this.$tip.remove(),this.$list.append(this.$uploadButtonItem)):(this.$uploadButtonItem.remove(),this.$label.append(this.$tip))},super.init(),this.$list.addClass("flex")}initUploadButtonItemCash(){this.$uploadButtonItem=y(`<label class="upload-button-item order-last" for="${this.options.name}" />`).addClass("flex justify-center items-center cursor-pointer").css({width:120,height:120,background:"var(--color-slate-100)"}).append(y('<i class="icon icon-plus" />'))}initUploadCash(){const{name:e,tip:t,uploadText:n,uploadIcon:s,totalCountText:r}=this.options;this.$list=y('<ul class="file-list py-1 flex-wrap gap-x-4 gap-y-4"></ul>'),this.$label=y('<div class="draggable-area relative block w-full border border-dashed border-gray"></div>').css({minHeight:64});const o=y(`<label for="${e}" class="text-primary cursor-pointer">${n}</label>`);if(s){const a=y(`<i class="icon icon-${s} mr-1"></i>`);o.prepend(a)}this.$tip=y('<div class="absolute inset-0 col justify-center items-center"></div>').append(o),t&&this.$tip.append(y(`<span class="upload-tip">${t}</span>`)),this.$label.append(this.$tip),this.$label.append(this.$input,this.$list),this.bindDragEvent(),this.$element.append(this.$label),this.$uploadInfo=y('<div class="py-1" />').css({color:"var(--color-slate-500)"}).html(r.replace("%s",this.fileMap.size.toString()).replace("%s",this.fileMap.size.toString())),this.$element.append(this.$uploadInfo)}filterFiles(e){const{accept:t}=this.options;if(t==="image/*")return e.filter(s=>s.type.includes("image"));const n=t.replace(/\s/g,"").replace(/\./g,"image/").split(",");return e.filter(s=>n.includes(s.type))}createFileItem(e){const t=super.createFileItem(e).addClass("relative").removeClass("flex items-center gap-2 my-1");this.setImageUrl(e,t);const{deleteBtn:n,showSize:s}=this.options;return n&&t.append(this.fileDeleteBtn().addClass("absolute right-0 top-0 text-white").css({background:"var(--color-slate-500)"}).on("click",()=>this.deleteFileItem(e.name))),s&&t.append(this.fileSize(e.size).addClass("file-size label text-white circle darker absolute px-1 hidden").removeClass("text-gray").css({top:96,left:4})),t}setImageUrl(e,t){const n=new FileReader;n.onload=()=>{y('<div class="img flex-none" />').addClass("rounded").css({backgroundImage:`url(${n.result})`,backgroundSize:"cover"}).prependTo(t)},n.readAsDataURL(e)}createFileInfo(e){const t=this.fileRenameBtn().addClass("flex-none").on("click",s=>{const r=y(s.target).closest(".file-item");r.find(".file-info").addClass("hidden"),r.find(".input-rename-container").removeClass("hidden");const o=r.find("input")[0];o.focus(),o.value.lastIndexOf(".")!==-1&&o.setSelectionRange(0,o.value.lastIndexOf("."))});return y('<div class="file-info flex justify-between items-center"></div>').css({width:120}).append(y(`<div class="file-name py-1 ellipsis">${e.name}</div>`)).append(t)}createRenameContainer(e){const{duplicatedHint:t,onDuplicated:n}=this.options,s=y("<input />").addClass("input-rename-container border-primary border hidden").prop("type","text").prop("autofocus",!0).prop("defaultValue",e.name).css({width:120}).on("keydown",r=>{if(r.key==="Enter"){const o=s.closest(".file-item").find(".file-name");if(o.html()===s.val()){s.addClass("hidden"),o.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(s.val())){n==null||n(s.val()),t&&alert(t);return}this.renameFileItem(e,s.val()),s.addClass("hidden"),o.html(s.val()).closest(".file-info").removeClass("hidden")}else r.key==="Escape"&&s.val(e.name).addClass("hidden").closest(".file-item").find(".file-name").removeClass("hidden")}).on("blur",()=>{const r=s.closest(".file-item").find(".file-name");if(r.html()===s.val()){s.addClass("hidden"),r.closest(".file-info").removeClass("hidden");return}if(this.fileMap.has(s.val())){n==null||n(s.val()),t&&alert(t);return}this.renameFileItem(e,s.val()),s.addClass("hidden"),r.html(s.val()).closest(".file-info").removeClass("hidden")});return s}}Dc.NAME="UploadImgs",Dc.DEFAULT={uploadText:"添加文件",renameBtn:!0,renameText:"重命名",renameIcon:"edit",renameClass:"",deleteBtn:!0,deleteText:"删除",deleteIcon:"trash",deleteClass:"",showIcon:!1,multiple:!0,limitSize:!1,btnClass:"",draggable:!0,accept:"image/jpg, image/jpeg, image/gif, image/png",showSize:!0,useIconBtn:!0,totalCountText:'共 <span class="font-bold text-black">%s</span> 个文件 <span class="font-bold text-black">%s</span> 个文件等待上传。'};const Ic=Symbol("batch-form"),Nc=class fu extends ze{constructor(){super(...arguments),this._actions=null,this._cols=[],this._idSeed=0,this._rows=[]}afterInit(){var s;const e=y(this.element),t=e.find(".form-batch-table").addClass("borderless");let n=t.find("tbody");n.length||(n=y("<tbody/>").appendTo(t)),this.$tbody=n,this._template=(s=e.find(".form-batch-template").get(0))==null?void 0:s.innerHTML,this._cols=[],t.find("thead>tr>.form-batch-head").each((r,o)=>{const a=y(o),l=a.data();l&&(l.hidden=a.hasClass("hidden"),this._cols.push(l))}),e.on("click",r=>{const o=y(r.target).closest(".form-batch-btn");if(!o.length)return;const a=o.dataset("type"),c=o.closest("tr").dataset("index");a==="add"?this.addRow(c):a==="delete"?this.deleteRow(c):a==="ditto"&&this.toggleDitto(o)}).on("change",".form-batch-input,.pick-value",r=>{const o=y(r.target);r.___td===Ic||o.hasClass("pick-value")&&!r.___td||this.syncDitto(o)}).on("change",'[type="radio"],[type="checkbox"]',r=>{fu.updateCheckValues(y(r.target))}),this.options.sortable&&(this._sortable=new ao(n,{draggable:"tr",handle:'.form-batch-btn[data-type="sort"]',dataIdAttr:"data-gid",ghostClass:"bg-primary-50",onSort:()=>{this._rows=this._sortable.toArray().map(Number),this.render()},dragShadow:!1})),this.render()}destroy(){y(this.element).off("click change"),this.$tbody=void 0,this._template=void 0,this._cols.length=0,this._rows.length=0}render(e,t){super.render(e,t),!t&&this._rows.length?this._renderRows():(this._actions=null,this._initRows())}addRow(e){const t=this._idSeed++;typeof e=="number"&&e>=0&&e<=this._rows.length?this._rows.splice(e+1,0,t):(e=this._rows.length,this._rows.push(t)),this._renderRows(void 0,e)}deleteRow(e){var n;if(this._rows.length<=1||typeof e!="number"||e<0||e>=this._rows.length)return!1;const t=this._rows[e];this._rows.splice(e,1),(n=this.$tbody)==null||n.children(`[data-gid="${t}"]`).remove(),this._renderRows(void 0,e)}deleteRowByGid(e){return this.deleteRow(this._rows.indexOf(e))}toggleDitto(e,t){const n=e.closest("td");t=t??n.attr("data-ditto")!=="on",n.attr("data-ditto",t?"on":"off"),t&&n.closest("tr").prev("tr").find(`td[data-name="${n.data("name")}"]`).find(".form-batch-input,.pick-value").each((o,a)=>{this.syncDitto(y(a),!1)})}syncDitto(e,t=!0,n=!1){const s=e.closest("td");t&&s.attr("data-ditto","off");const r=s.data("name"),a=(e.hasClass("pick-value")?e.closest(".form-group-wrapper"):e).attr("data-name"),l=`td[data-name="${r}"][data-ditto="on"]`,c=e.val();let d=e.closest("tr").next("tr"),u=d.find(l);for(;u.length;){const p=u.find(`.form-batch-input[data-name="${a}"]`);if(p.length&&p.val()!==c)p.val(c).trigger("change",Ic);else{const g=u.find(".pick").parent().zui();g&&g.$&&g.$element.attr("data-name")===a&&g.$.value!==c&&g.$.setValue(c,!0).then(()=>{g.$element.find(".pick-value").trigger("change",Ic)})}if(n)break;d=d.next("tr"),u=d.find(l)}}toggleCols(e,t){const n=this.$element.find(".form-batch-table").find("th.form-batch-head,td.form-batch-control");n.length&&(typeof e=="string"&&(e=[e]),e.forEach(s=>{const r=this._cols.find(o=>o.name===s);r&&(r.hidden=!t,n.filter(`[data-name="${s}"]`).toggleClass("hidden",!t),t&&requestAnimationFrame(()=>{n.filter(".form-batch-ditto-control").each((o,a)=>{const l=y(a),c=l.find(".form-batch-ditto-btn");l.css("--form-batch-ditto-width",`${c.outerWidth()}px`)})}))}))}_initRows(){const e=this.$tbody;if(!this._template||!(e!=null&&e.length))return;const{data:t=[],minRows:n,maxRows:s,mode:r,rowsCount:o=r==="add"?Math.min(Math.max(1,s??100),Math.max(1,n??(r==="add"?10:1),t.length)):t.length}=this.options;this._rows=Array(o).fill(0).map((a,l)=>l),this._idSeed=this._rows.length,this._renderRows(t)}_renderRows(e=[],t=0){var s;const n=this._rows.length;for(let r=t;r<n;r++)this._renderRow(r,e[r]);(s=this.$tbody)==null||s.attr("data-count",`${n}`)}_renderActions(e){let t=this._actions;if(!t){const{addRowIcon:n="icon-plus",deleteRowIcon:s="icon-trash",sortRowIcon:r="icon-move",sortable:o}=this.options;t=new DocumentFragment;const a='<button type="button" data-type="{type}" class="form-batch-btn btn square ghost size-sm" title="{text}"><i class="icon {icon}"></i></button>';r!==!1&&o&&t.append(y(Ce(a,{type:"sort",icon:r,text:this.i18n("sort")})).addClass("cursor-move")[0]),n!==!1&&t.append(y(Ce(a,{type:"add",icon:n,text:this.i18n("add")}))[0]),s!==!1&&t.append(y(Ce(a,{type:"delete",icon:s,text:this.i18n("delete")}))[0]),this._actions=t,this.$element.find('.form-batch-head[data-name="ACTIONS"]').attr("data-action-count",t.children.length+"")}e.empty().append(t.cloneNode(!0))}_renderRow(e,t){const n=this.$tbody,s=String(this._rows[e]),{idKey:r="id",mode:o,onRenderRowCol:a,onRenderRow:l}=this.options,c=o==="add",d=String(t&&t[r]!==void 0?t[r]:e+1);let u=n.children(`[data-gid="${s}"]`),p=!1;if(u.length){if(!t&&u.dataset("index")===e)return}else{p=!0;let S=this._template;if((S.includes(" zui-create ")||S.includes(" zui-create="))&&(S=S.replace(/(id|for)="([\\$a-z_]+)"/g,`$1="$2_${s}"`)),S.includes("<script>")&&S.includes('zui.create("')){const x=[];S=S.replace(/(zui\.create\("[a-zA-Z]+","#)(\w+)(",)/g,(D,A,B,H)=>(x.push(B),`${A}${B}_${s}${H}`)),x.forEach(D=>{const A=`${D}_${s}`;S=S.replace(`id="${D}"`,`id="${A}"`)})}S=S.replaceAll("{GID}",s),u=y(S.trim()).attr("data-gid",s),u.find('[type="radio"],[type="checkbox"]').each((x,D)=>{const A=y(D),B=A.attr("id"),H=`${B}_${s}`;A.attr("id",H),u.find(`label[for="${B}"]`).attr("for",H)}),u.zuiInit({onCreate:(x,D)=>(typeof D.name=="string"&&(D.name=`${D.name}[${d}]`),D)})}const g=this._rows[e-1],b=n.children(`[data-gid="${g}"]`);u.attr("data-index",`${e}`),u.find("textarea").autoHeight(),u.on("inited",(S,[x])=>{let D=x.options.name;if(D){const A=D.split("[");A.length>1&&A.pop(),D=A.join("[");const B=x.$element.closest("td");if(x.$element.attr("data-name",D),b.length&&B.data("ditto")==="on"){const H=b.find(`td[data-name="${B.data("name")}"]`);this.syncDitto(H.find(`[data-name="${D}"] .pick-value`),!1,!0)}else t&&t[D]!==void 0&&x.$.setValue(t[D],!0)}}),t&&u.data("data",t),e?b.length?b.after(u):u.appendTo(n):u.prependTo(n),p&&u.find("script").remove();const C=t||u.data("data");this._cols.forEach(S=>{let x=u.find(`td[data-name="${S.name}"]`);if(x.length||(x=y(`<td data-name="${S.name}"></td>`).appendTo(u)),S.index){x.find(".form-control-static").text(d).attr("id",`${S.name}_${s}`),a==null||a.call(this,x,S,C,e);return}if(x.toggleClass("hidden",!!S.hidden),!x.data("init")||t){if(S.name==="ACTIONS"){if(x.addClass("form-batch-row-actions"),!c)return;this._renderActions(x);return}x.data("init",1).find("[name],.form-control-static").each((A,B)=>{const H=y(B);if(H.hasClass("form-control-static")){const G=H.attr("data-name");t&&H.text(String(t[G]??""))}else{const G=H.attr("name"),Y=`${G}[${d}]`;if(H.attr({name:Y,"data-name":G}).addClass("form-batch-input"),t&&t[G]!==void 0){const Z=String(t[G]??"");if(H.is('[type="radio"]'))H.prop("checked",Z===H.val());else if(H.is('[type="checkbox"]')){const ee=new Set(Z.split(","));H.prop("checked",ee.has(H.val()))}else H.val(Z)}}}),x.find('[type="radio"],[type="checkbox"]').each((A,B)=>{const H=y(B);typeof H.attr("data-name")!="string"||H.attr("data-val")!==void 0||fu.updateCheckValues(H,x,d)})}else x.find("[name]").each((A,B)=>{const H=y(B),G=H.attr("data-name");if(G.startsWith(`${G}[`)){if(H.attr("name",`${G}[${d}]`),H.is('[type="radio"]'))H.prop("checked",H.val()===H.attr("data-val"));else if(H.is('[type="checkbox"]')){const Y=new Set(H.attr("data-val").split(","));Y.size>1&&H.attr("name",`${G}[${d}][]`),H.prop("checked",Y.has(H.val()))}}}),x.find(".pick").each((A,B)=>{var G;const H=y(B).parent();(G=H.zui())==null||G.render({name:`${H.data("name")}[${d}]`})});if(S.ditto){x.addClass("form-batch-ditto");let A=x.find(".form-batch-ditto-btn");if(e){const{defaultDitto:B="on"}=S;if(x.attr("data-ditto",B),!A.length){A=y(`<button type="button" class="btn ghost form-batch-btn form-batch-ditto-btn" data-type="ditto">${this.i18n("ditto")}</button>`);let H=x.children(".form-batch-ditto-wrapper");H.length||(H=y('<div class="form-batch-ditto-wrapper"></div>').append(x.children()).appendTo(x)),H.append(A)}requestAnimationFrame(()=>x.css("--form-batch-ditto-width",`${A.outerWidth()}px`)),B==="on"&&b.find(`td[data-name="${S.name}"]`).find(".form-batch-input").each((G,Y)=>{this.syncDitto(y(Y),!1,!0)})}else x.attr("data-ditto",""),A.remove()}const D=!!(S.ditto&&e);x.toggleClass("form-batch-ditto-control",D),x.find(".form-batch-ditto-btn").toggle(D),a==null||a.call(this,x,S,C,e)}),l==null||l.call(this,u,e,C)}static updateCheckValues(e,t,n){const s=e.attr("data-name");if(typeof s!="string")return;const r=e.attr("type");t=t||e.closest("td");const o=t.find(`[type="${r}"][data-name="${s}"]`);n!==void 0&&r==="checkbox"&&o.length>1&&o.attr("name",`${s}[${n}][]`);const a=[];o.filter(":checked").each((c,d)=>{a.push(y(d).val())});const l=r==="radio"?a[0]:a.join(",");o.attr("data-val",l)}};Nc.NAME="BatchForm",Nc.DEFAULT={mode:"add",idKey:"id",i18n:{zh_cn:{ditto:"同上",delete:"删除",add:"添加",sort:"排序"},zh_tw:{ditto:"同上",delete:"刪除",add:"添加",sort:"排序"},en:{ditto:"Ditto",delete:"Delete",add:"Add",sort:"Sort"}}};let pv=Nc;const NC="";function mv(i){return typeof i=="string"?i.split(",").map(e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t}):i}let Mc=class extends pe{constructor(){super(...arguments),this._canvas=fe(),this._timer=0,this._needDraw=!1}componentDidMount(){var t;this.tryDraw=this.tryDraw.bind(this),this.tryDraw();const e=(t=this._canvas.current)==null?void 0:t.parentElement;if(this.props.responsive!==!1){if(e&&typeof ResizeObserver<"u"){const n=new ResizeObserver(this.tryDraw);n.observe(e),this._rob=n}this._rob||window.addEventListener("resize",this.tryDraw)}if(e&&typeof IntersectionObserver<"u"){const n=new IntersectionObserver(s=>{this._needDraw&&s.some(r=>r.isIntersecting)&&this.tryDraw()});n.observe(e),this._iob=n}}componentDidUpdate(){this.tryDraw()}componentWillUnmount(){var e;(e=this._rob)==null||e.disconnect(),window.removeEventListener("resize",this.tryDraw)}tryDraw(){this._timer&&cancelAnimationFrame(this._timer),this._timer=requestAnimationFrame(()=>{this.draw(),this._timer=0})}draw(){const e=this._canvas.current;if(!e)return;const t=e.parentElement,{width:n,height:s,responsive:r=!0}=this.props;let o=n||t.clientWidth,a=s||t.clientHeight;if(n&&s&&r&&(o=t.clientWidth,a=Math.floor(s*o/n)),e.style.width=`${o}px`,e.style.height=`${a}px`,o=o*(window.devicePixelRatio||1),a=a*(window.devicePixelRatio||1),e.width=o,e.height=a,!y(t).isVisible()&&this._iob){this._needDraw=!0;return}const{lineSize:l=1,scaleLine:c=!1,scaleLineSize:d,scaleLineGap:u=1,scaleLineDash:p,referenceLine:g,referenceLineSize:b,referenceLineDash:C,color:S="#2c78f1",fillColor:x=["rgba(46, 127, 255, 0.3)","rgba(46, 127, 255, 0.05)"],lineDash:D=[],bezier:A}=this.props,B=mv(this.props.data);if(!B.length)return;const H=Math.floor(o/(B.length-1)),G=Math.max(...B.filter(he=>he!==null)),Y=B.map((he,X)=>{const se=typeof he!="number";return{x:X*H,y:se?a:Math.round((1-he/G)*(a-l)),empty:se}});let Z=Y[0];const ee=e.getContext("2d");if(c){const he=typeof c=="string"?c:"rgba(100,100,100,.1)";ee.strokeStyle=he,ee.lineWidth=d||l,p&&ee.setLineDash(p);for(let X=0;X<Y.length;++X){if(X%u!==0)continue;const se=Y[X];ee.moveTo(se.x,0),ee.lineTo(se.x,a)}ee.stroke()}if(g&&Y.length>1){const he=typeof g=="string"?g:"rgba(100,100,100,.2)",X=Y[Y.length-1];ee.moveTo(X.x,a),ee.strokeStyle=he,ee.lineWidth=b||l,ee.lineTo(Z.x,Z.y),C&&ee.setLineDash(C),ee.stroke()}for(ee.setLineDash(D);Y.length&&Y[Y.length-1].empty;)Y.pop();if(x){const he=Y[Y.length-1];if(ee.beginPath(),ee.moveTo(0,a),ee.lineTo(Z.x,Z.y),A){const X=Math.round(H/2);for(let se=1;se<Y.length;++se){const ge=Y[se],be=Math.round((ge.y-Z.y)/5);ee.bezierCurveTo(Z.x+X,Z.y+be,ge.x-X,ge.y-be,ge.x,ge.y),Z=ge}}else for(let X=1;X<Y.length;++X)Z=Y[X],ee.lineTo(Z.x,Z.y);if(ee.lineTo(he.x,a),Array.isArray(x)){const X=ee.createLinearGradient(0,0,0,a);for(let se=0;se<x.length;++se)X.addColorStop(se/(x.length-1),x[se]);ee.fillStyle=X}else ee.fillStyle=x;ee.fill()}if(Z=Y[0],ee.beginPath(),ee.moveTo(Z.x,Z.y),A){const he=Math.round(H/2);for(let X=1;X<Y.length;++X){const se=Y[X],ge=Math.round((se.y-Z.y)/5);ee.bezierCurveTo(Z.x+he,Z.y+ge,se.x-he,se.y-ge,se.x,se.y),Z=se}}else for(let he=1;he<Y.length;++he)Z=Y[he],ee.lineTo(Z.x,Z.y);ee.strokeStyle=S,ee.lineWidth=l,ee.stroke()}render(){const{style:e,className:t,canvasClass:n}=this.props;return w("div",{class:"center burn-chart",className:t,style:e},w("canvas",{className:n,ref:this._canvas}))}};Mc.defaultProps={responsive:!0,lineSize:1,scaleLine:!1,scaleLineSize:1,bezier:!0};class Ec extends _e{}Ec.NAME="Burn",Ec.Component=Mc;class Rf extends Fe{_getClassName(e){return["datalist",e.className]}_getProps(e){return xe(super._getProps(e),e.labelWidth?{style:{"--datalist-label-width":Be(e.labelWidth)}}:null)}_getChildren(){const{items:e=[]}=this.props;return e.map((t,n)=>{const{key:s=n,className:r,label:o,labelStyle:a,labelClass:l,labelAttrs:c,content:d,contentStyle:u,contentClass:p,contentAttrs:g,...b}=t;return w("div",{key:s,className:V("datalist-item",r),...b},w("div",{className:V("datalist-item-label",l),style:a,...c},w(me,{content:o})),w("div",{className:V("datalist-item-content",p),style:u,...g},w(me,{content:d})))})}}Xe(Object.freeze(Object.defineProperty({__proto__:null,Datalist:Rf},Symbol.toStringTag,{value:"Module"})));const EC="",gv="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Bo=(i=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(i));for(;i--;)e+=gv[t[i]&63];return e};const AC="";class Of extends pe{constructor(t){super(t);Ot(this,Wn,void 0);Ot(this,Un,void 0);Bt(this,Wn,0),Bt(this,Un,null),this._handleWheel=n=>{const{wheelContainer:s}=this.props,r=n.target;if(!(!r||!s)&&(typeof s=="string"&&r.closest(s)||typeof s=="object")){const o=(this.props.type==="horz"?n.deltaX:n.deltaY)*(this.props.wheelSpeed??1);this.scrollOffset(o)&&n.preventDefault()}},this._handleMouseMove=n=>{const{dragStart:s}=this.state;s&&(St(this,Wn)&&cancelAnimationFrame(St(this,Wn)),Bt(this,Wn,requestAnimationFrame(()=>{const r=this.props.type==="horz"?n.clientX-s.x:n.clientY-s.y;this.scroll(s.offset+r*this.props.scrollSize/this.props.clientSize),Bt(this,Wn,0)})),n.preventDefault())},this._handleMouseUp=()=>{this.state.dragStart&&this.setState({dragStart:!1})},this._handleMouseDown=n=>{this.state.dragStart||this.setState({dragStart:{x:n.clientX,y:n.clientY,offset:this.scrollPos}}),n.preventDefault(),n.stopPropagation()},this._handleClick=n=>{const s=n.currentTarget;if(!s)return;const r=s.getBoundingClientRect(),{type:o,clientSize:a,scrollSize:l}=this.props,c=(o==="horz"?n.clientX-r.left:n.clientY-r.top)-this.barSize/2;this.scroll(c*l/a),n.preventDefault()},this.state={scrollPos:this.props.defaultScrollPos??0,dragStart:!1}}get scrollPos(){return this.props.scrollPos??this.state.scrollPos}get controlled(){return this.props.scrollPos!==void 0}get maxScrollPos(){const{scrollSize:t,clientSize:n}=this.props;return Math.max(0,t-n)}get barSize(){const{clientSize:t,scrollSize:n,size:s=12,minBarSize:r=3*s}=this.props;return Math.max(Math.round(t*t/n),r)}componentDidMount(){document.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp);const{wheelContainer:t}=this.props;t&&(Bt(this,Un,typeof t=="string"?document:t.current),St(this,Un).addEventListener("wheel",this._handleWheel,{passive:!1}))}componentWillUnmount(){document.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),St(this,Un)&&St(this,Un).removeEventListener("wheel",this._handleWheel)}scroll(t){return t=Math.max(0,Math.min(Math.round(t),this.maxScrollPos)),t===this.scrollPos?!1:(this.controlled?this._afterScroll(t):this.setState({scrollPos:t},this._afterScroll.bind(this,t)),!0)}scrollOffset(t){return this.scroll(this.scrollPos+t)}_afterScroll(t){const{onScroll:n}=this.props;n&&n(t,this.props.type??"vert")}render(){const{clientSize:t,type:n,size:s=12,className:r,style:o,left:a,top:l,bottom:c,right:d}=this.props,{maxScrollPos:u,scrollPos:p}=this,{dragStart:g}=this.state,b={left:a,top:l,bottom:c,right:d,...o},C={};return n==="horz"?(b.height=s,b.width=t,C.width=this.barSize,C.left=Math.round(Math.min(u,p)*(t-C.width)/u)):(b.width=s,b.height=t,C.height=this.barSize,C.top=Math.round(Math.min(u,p)*(t-C.height)/u)),k("div",{className:V("scrollbar",r,{"is-vert":n==="vert","is-horz":n==="horz","is-dragging":g}),style:b,onMouseDown:this._handleClick,children:k("div",{className:"scrollbar-bar",style:C,onMouseDown:this._handleMouseDown})})}}Wn=new WeakMap,Un=new WeakMap;const Ho=new Map,Wo=[];function zf(i,e){const{name:t}=i;if(!(e!=null&&e.override)&&Ho.has(t))throw new Error(`DTable: Plugin with name ${t} already exists`);Ho.set(t,i),e!=null&&e.buildIn&&!Wo.includes(t)&&Wo.push(t)}function Ke(i,e){zf(i,e);const t=n=>{if(!n)return i;const{defaultOptions:s,...r}=i;return{...r,defaultOptions:{...s,...n}}};return t.plugin=i,t}function Ff(i){return Ho.delete(i)}function yv(i){if(typeof i=="string"){const e=Ho.get(i);return e||console.warn(`DTable: Cannot found plugin "${i}"`),e}if(typeof i=="function"&&"plugin"in i)return i.plugin;if(typeof i=="object")return i;console.warn("DTable: Invalid plugin",i)}function jf(i,e,t){return e.forEach(n=>{var r;if(!n)return;const s=yv(n);s&&(t.has(s.name)||((r=s.plugins)!=null&&r.length&&jf(i,s.plugins,t),i.push(s),t.add(s.name)))}),i}function _v(i=[],e=!0){if(e&&Wo.length&&i.unshift(...Wo),!(i!=null&&i.length))return[];const t=jf([],i,new Set),n=[],s=t.reduce((r,o,a)=>{var l;return r.set(o.name,a*1e3),(l=o.requireAfter)!=null&&l.length&&n.push(o),r},new Map);return n.length&&(n.forEach(r=>{const o=r.requireAfter.reduce((a,l)=>(s.has(l)&&a.push(s.get(l)),a),[]);o.length&&s.set(r.name,Math.max(...o)+1)}),t.sort((r,o)=>s.get(r.name)-s.get(o.name))),t}function Bf(){return{cols:[],data:[],rowKey:"id",width:"100%",height:"auto",rowHeight:35,defaultColWidth:80,minColWidth:24,maxColWidth:9999,header:!0,footer:void 0,headerHeight:0,footerHeight:0,rowHover:!0,colHover:!1,cellHover:!1,bordered:!1,striped:!0,responsive:!1,scrollbarHover:!0,horzScrollbarPos:"outside"}}function Hf(i,e,t){return i&&(e&&(i=Math.max(e,i)),t&&(i=Math.min(t,i))),i}function Wf(i,e){return typeof i=="string"&&(i=i.endsWith("%")?parseFloat(i)/100:parseFloat(i)),typeof e=="number"&&(typeof i!="number"||isNaN(i))&&(i=e),i}function Ac(i,e=!1,t=0){if(!i.list.length)return;if(e&&i.widthSetting&&(i.widthSetting=Math.min(i.widthSetting,i.width)),t&&(!i.widthSetting||i.widthSetting>t)&&i.width>t&&(i.widthSetting=t),i.widthSetting&&i.width!==i.widthSetting){i.width=i.widthSetting;const s=i.width-i.totalWidth;if(!e&&s>0||e&&s!==0){const r=i.flexList.length?i.flexList:i.list,o=r.reduce((a,l)=>a+(l.flex||1),0);r.forEach(a=>{const l=Math[s<0?"max":"min"](s,Math.ceil(s*((a.flex||1)/o)));a.realWidth=a.width+l})}}let n=0;i.list.forEach((s,r)=>{s.realWidth||(s.realWidth=s.width),s.left=n,s.sideIndex=r,n+=s.realWidth})}function Uf(i){return i?i==="left"?"left":"right":"center"}function vv(i,e,t,n){const{defaultColWidth:s,minColWidth:r,maxColWidth:o,fixedLeftWidth:a=0,fixedRightWidth:l=0}=e,c=B=>(typeof B=="function"&&(B=B.call(i)),B=Wf(B,0),B<1&&(B=Math.round(B*n)),B),d={width:0,list:[],flexList:[],widthSetting:0,totalWidth:0},u={...d,list:[],flexList:[],widthSetting:c(a)},p={...d,list:[],flexList:[],widthSetting:c(l)},g={left:u,center:d,right:p},b=[],C={};let S=!1;const x=[],D={};if(t.forEach(B=>{const{colTypes:H,onAddCol:G}=B;H&&Object.entries(H).forEach(([Y,Z])=>{D[Y]||(D[Y]=[]),D[Y].push(Z)}),G&&x.push(G)}),e.cols.forEach((B,H)=>{if(B.hidden)return;const{type:G="",name:Y}=B,Z={fixed:!1,flex:!1,width:s,minWidth:r,maxWidth:o,...B,type:G},ee={name:Y,type:G,setting:Z,flex:0,left:0,width:0,realWidth:0,visible:!0,index:H,side:Uf(Z.fixed),sideIndex:0,order:Z.order,border:Z.border},he=D[G];he&&he.forEach(Pe=>{const ce=typeof Pe=="function"?Pe.call(i,Z):Pe;ce&&Object.assign(Z,ce,B)});const{flex:X,minWidth:se=r,maxWidth:ge=o}=Z,be=Wf(Z.width||s,s);ee.flex=X===!0?1:typeof X=="number"?X:0,ee.width=Hf(be<1?Math.round(be*n):be,se,ge),ee.side=Uf(Z.fixed),x.forEach(Pe=>Pe.call(i,ee)),b.push(ee),C[ee.name]=ee;const Me=g[ee.side];Me.list.push(ee),Me.totalWidth+=ee.width,Me.width=Me.totalWidth,ee.flex&&Me.flexList.push(ee),typeof ee.order=="number"&&(S=!0)}),S){const B=(H,G)=>(H.order??H.index)-(G.order??G.index);b.sort(B),u.list.sort(B),d.list.sort(B),p.list.sort(B)}Ac(p,!0);const A=n-p.width-Math.max(40,r);return Ac(u,!0,A),d.widthSetting=n-u.width-p.width,Ac(d),{list:b,map:C,...g}}function bv(i){var ce;const{col:e,className:t,height:n,row:s,onRenderCell:r,style:o,outerStyle:a,children:l,outerClass:c,width:d,left:u,top:p,...g}=i,b={left:u??e.left,top:p??s.top,width:d??e.realWidth,height:n,...a},{align:C,cellStyle:S,cellClass:x,className:D}=e.setting,A={justifyContent:C?C==="left"?"start":C==="right"?"end":C:void 0,...S,...o},{name:B,border:H}=e,G=["dtable-cell",c,t,D,{"has-border-left":H===!0||H==="left","has-border-right":H===!0||H==="right"}],Y=["dtable-cell-content",x],Z=(ce=s.data)==null?void 0:ce[B],ee=[l??Z??""],he=r?r(ee,{row:s,col:e,value:Z},i,w):ee,X=[],se=[],ge={},be={};let Me="div";he==null||he.forEach(J=>{if(typeof J=="object"&&J&&!N.isValidElement(J)&&("html"in J||"className"in J||"style"in J||"attrs"in J||"children"in J||"tagName"in J)){const we=J.outer?X:se;J.html?we.push(k("div",{className:V("dtable-cell-html",J.className),style:J.style,dangerouslySetInnerHTML:{__html:J.html},...J.attrs??{}})):(J.style&&Object.assign(J.outer?b:A,J.style),J.className&&(J.outer?G:Y).push(J.className),J.children&&we.push(J.children),J.attrs&&Object.assign(J.outer?ge:be,J.attrs)),J.tagName&&!J.outer&&(Me=J.tagName)}else(typeof J!="object"||N.isValidElement(J))&&se.push(J)});const Pe=Me;return k("div",{className:V(G),style:b,"data-col":B,"data-row":s.id,"data-type":e.type||null,...g,...ge,children:[se.length>0&&k(Pe,{className:V(Y),style:A,...be,children:se}),X]})}function Pc({rows:i=[],cols:e,rowHeight:t,scrollLeft:n=0,scrollTop:s=0,left:r=0,top:o=0,width:a,height:l="100%",className:c,CellComponent:d=bv,cellClass:u,onRenderCell:p}){var S;const g=Array.isArray(i)?i:[i],b=((S=g[0])==null?void 0:S.top)??0,C=g.length;return k("div",{className:V("dtable-cells",c),style:{top:o,left:r,width:a,height:l},children:k("div",{className:"dtable-cells-container",style:{left:-n,top:-s+b},children:g.reduce((x,D,A)=>{const B=e.length;return e.forEach((H,G)=>{x.push(k(d,{className:V(`is-${D.index%2?"odd":"even"}-row`,G?"":"is-first-in-row",G===B-1?"is-last-in-row":"",A?"":"is-first-row",A===C-1?"is-last-row":"",u),col:H,row:D,top:D.top-b,height:t,onRenderCell:p},`${D.index}:${H.name}`))}),x},[])})})}function Vf({top:i,height:e,rowHeight:t,rows:n,cols:{left:s,center:r,right:o},scrollLeft:a,scrollTop:l,className:c,cellClass:d,style:u,onRenderCell:p,children:g}){let b=null;s.list.length&&(b=k(Pc,{className:"dtable-fixed-left",rows:n,scrollTop:l,cols:s.list,width:s.width,rowHeight:t,cellClass:d,onRenderCell:p},"left"));let C=null;r.list.length&&(C=k(Pc,{rows:n,className:"dtable-scroll-center",scrollLeft:a,scrollTop:l,cols:r.list,left:s.width,width:r.width,rowHeight:t,cellClass:d,onRenderCell:p},"center"));let S=null;return o.list.length&&(S=k(Pc,{className:"dtable-fixed-right",rows:n,scrollTop:l,cols:o.list,left:s.width+r.width,width:o.width,rowHeight:t,cellClass:d,onRenderCell:p},"right")),k("div",{className:V("dtable-block",c),style:{...u,top:i,height:e},children:[b,C,S,g]})}var Kf=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Je=(i,e,t)=>(Kf(i,e,"read from private field"),t?t.call(i):e.get(i)),ot=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},At=(i,e,t)=>(Kf(i,e,"access private method"),t),Fn,Fs,js,Lc,qf,Rc,Gf,Oc,Yf,zc,Qf,Uo,Fc,Vo,Ko,jc,Bc,Hc,Wc,Bs,qo,Go,Uc,Vc,Xf,Kc,Zf;let Hs=class extends pe{constructor(e){super(e),ot(this,Lc),ot(this,Rc),ot(this,Oc),ot(this,zc),ot(this,Uo),ot(this,Bs),ot(this,Go),ot(this,Vc),ot(this,Kc),this.ref=fe(),this._rafId=0,this._needRender=!1,this._plugins=[],this._lastUsedPlugins=new Map,this._events=new Map,this._data={},this._i18nMaps=[],this._hover={in:!1},this.updateLayout=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const{element:t}=this;t&&!Nn(t)&&this.update({dirtyType:"layout"}),this._rafId=0})},ot(this,Fn,(t,n)=>{n=n||t.type;const s=this._events.get(n);if(s!=null&&s.length){for(const r of s)if(r.call(this,t)===!1){t.stopPropagation(),t.preventDefault();break}}}),ot(this,Fs,t=>{Je(this,Fn).call(this,t,`window_${t.type}`)}),ot(this,js,t=>{Je(this,Fn).call(this,t,`document_${t.type}`)}),ot(this,Vo,(t,n,s,r)=>{const{row:o,col:a}=n;n.value=this.getCellValue(o,a),t[0]=n.value;const l=o.id==="HEADER"?"onRenderHeaderCell":"onRenderCell";return a.setting[l]&&(t=a.setting[l].call(this,t,n,s,r)),this._plugins.forEach(c=>{c[l]&&(t=c[l].call(this,t,n,s,r))}),this.options[l]&&(t=this.options[l].call(this,t,n,s,r)),t}),ot(this,Ko,(t,n)=>{n==="horz"?this.scroll({scrollLeft:t}):this.scroll({scrollTop:t})}),ot(this,jc,t=>{var a,l,c;const n=this.getPointerInfo(t);if(!n)return;const{rowID:s,colName:r,cellElement:o}=n;if(s==="HEADER")o&&((a=this.options.onHeaderCellClick)==null||a.call(this,t,{colName:r,element:o}),this._plugins.forEach(d=>{var u;(u=d.onHeaderCellClick)==null||u.call(this,t,{colName:r,element:o})}));else{const d=this.layout.visibleRows.find(u=>u.id===s);if(o){if(((l=this.options.onCellClick)==null?void 0:l.call(this,t,{colName:r,rowID:s,rowInfo:d,element:o}))===!0)return;for(const u of this._plugins)if(((c=u.onCellClick)==null?void 0:c.call(this,t,{colName:r,rowID:s,rowInfo:d,element:o}))===!0)return}}}),ot(this,Bc,t=>{const n=t.key.toLowerCase();if(["pageup","pagedown","home","end"].includes(n))return!this.scroll({to:n.replace("page","")})}),ot(this,Hc,t=>{const n=y(t.target).closest(".dtable-cell");if(!n.length)return At(this,Bs,qo).call(this,!1);At(this,Bs,qo).call(this,[n.attr("data-row"),n.attr("data-col")])}),ot(this,Wc,()=>{At(this,Bs,qo).call(this,!1)}),this._id=e.id??`dtable-${ft()}`,this.state={scrollTop:0,scrollLeft:0,renderCount:0},this._allPlugins=Object.freeze(_v(e.plugins)),this._allPlugins.forEach(t=>{const{methods:n,data:s,state:r}=t;n&&Object.entries(n).forEach(([o,a])=>{typeof a=="function"&&Object.assign(this,{[o]:a.bind(this)})}),s&&Object.assign(this._data,s.call(this)),r&&Object.assign(this.state,r.call(this))}),At(this,Go,Uc).call(this),this._plugins.forEach(t=>{var n;(n=t.onCreate)==null||n.call(this,t)})}get options(){var e;return((e=this._layout)==null?void 0:e.options)||this._options||Bf()}get plugins(){return this._plugins}get layout(){return this._layout}get id(){return this._id}get data(){return this._data}get element(){return this.ref.current}get parent(){var e;return this.props.parent??((e=this.element)==null?void 0:e.parentElement)}get hoverInfo(){return this._hover}componentWillReceiveProps(){this._options=void 0}shouldComponentUpdate(){return!0}componentDidMount(){this._needRender?this.forceUpdate():At(this,Uo,Fc).call(this),this.on("click",Je(this,jc)),this.on("keydown",Je(this,Bc));const{options:e}=this;(e.rowHover||e.colHover)&&(this.on("mouseover",Je(this,Hc)),this.on("mouseleave",Je(this,Wc)));let{responsive:t}=e;if(t){t===!0&&(t="window,parent");const n=t.split(",");if(typeof ResizeObserver<"u"){const s=[],r=new ResizeObserver(this.updateLayout);this._rob=r;const{parent:o}=this;n.forEach(a=>{a!=="window"&&(a==="parent"?o&&r.observe(o):a[0]==="~"?s.push(a.slice(1)):y(a).each((l,c)=>r.observe(c)))}),s.length&&this.on(s.join(" "),this.updateLayout)}n.includes("window")&&this.on("window_resize",this.updateLayout)}this._checkPluginsState()}componentDidUpdate(){At(this,Uo,Fc).call(this),this._checkPluginsState(),this._plugins.forEach(e=>{var t;(t=e.onUpdated)==null||t.call(this)})}componentWillUnmount(){var t;(t=this._rob)==null||t.disconnect();const{element:e}=this;if(e)for(const n of this._events.keys())n.startsWith("window_")?window.removeEventListener(n.replace("window_",""),Je(this,Fs)):n.startsWith("document_")?document.removeEventListener(n.replace("document_",""),Je(this,js)):e.removeEventListener(n,Je(this,Fn));this._plugins.forEach(n=>{var s;(s=n.onUnmounted)==null||s.call(this)}),this._allPlugins.forEach(n=>{var s;(s=n.onDestory)==null||s.call(this)}),this._data={},this._events.clear(),this._noAnimation&&clearTimeout(this._noAnimation),this._rafId&&cancelAnimationFrame(this._rafId)}resetState(e,t){this._options=void 0,this._layout=void 0,e=e||this.props;const n={};this._plugins.forEach(s=>{const{resetState:r,state:o}=s;r&&(typeof r=="function"?Object.assign(n,r.call(this,e)):o&&Object.assign(n,o.call(this)))}),Object.keys(n).length&&this.setState(n)}on(e,t,n){var r;n&&(e=`${n}_${e}`);const s=this._events.get(e);s?s.push(t):(this._events.set(e,[t]),e.startsWith("window_")?window.addEventListener(e.replace("window_",""),Je(this,Fs)):e.startsWith("document_")?document.addEventListener(e.replace("document_",""),Je(this,js)):(r=this.element)==null||r.addEventListener(e,Je(this,Fn)))}off(e,t,n){var o;n&&(e=`${n}_${e}`);const s=this._events.get(e);if(!s)return;const r=s.indexOf(t);r>=0&&s.splice(r,1),s.length||(this._events.delete(e),e.startsWith("window_")?window.removeEventListener(e.replace("window_",""),Je(this,Fs)):e.startsWith("document_")?document.removeEventListener(e.replace("document_",""),Je(this,js)):(o=this.element)==null||o.removeEventListener(e,Je(this,Fn)))}emitCustomEvent(e,t){Je(this,Fn).call(this,t instanceof Event?t:new CustomEvent(e,{detail:t}),e)}disableAnimation(e=200){var t;this._noAnimation&&clearTimeout(this._noAnimation),(t=this.element)==null||t.classList.add("no-animation"),this._noAnimation=window.setTimeout(()=>{var n;this._noAnimation=void 0,(n=this.element)==null||n.classList.remove("no-animation")},e)}scroll(e,t){const{scrollLeft:n,scrollTop:s,rowsHeightTotal:r,rowsHeight:o,rowHeight:a,cols:{center:{totalWidth:l,width:c}}}=this.layout,{to:d}=e;let{scrollLeft:u,scrollTop:p}=e;if(d==="up"||d==="down")p=s+(d==="down"?1:-1)*Math.floor(o/a)*a;else if(d==="left"||d==="right")u=n+(d==="right"?1:-1)*c;else if(d==="top")p=0;else if(d==="bottom")p=r-o;else if(d==="begin")u=0;else if(d==="end")u=l-c;else{const{offsetLeft:b,offsetTop:C}=e;typeof b=="number"&&(u=n+b),typeof C=="number"&&(p=s+C)}const g={};return typeof u=="number"&&(u=Math.max(0,Math.min(u,l-c)),u!==n&&(g.scrollLeft=u)),typeof p=="number"&&(p=Math.max(0,Math.min(p,r-o)),p!==s&&(g.scrollTop=p)),Object.keys(g).length?(this.setState(g,()=>{var b;(b=this.options.onScroll)==null||b.call(this,g),t==null||t.call(this,!0)}),!0):(t==null||t.call(this,!1),!1)}getColInfo(e){if(e===void 0)return;if(typeof e=="object")return e;const{cols:t}=this.layout;return typeof e=="number"?t.list[e]:t.map[e]}getRowInfo(e){if(e===void 0)return;if(typeof e=="object")return e;if(e===-1||e==="HEADER")return{id:"HEADER",index:-1,top:0};const{rows:t,rowsMap:n,allRows:s}=this.layout;return typeof e=="number"?t[e]:n[e]||s.find(r=>r.id===e)}getCellValue(e,t){var a;const n=typeof e=="object"?e:this.getRowInfo(e);if(!n)return;const s=typeof t=="object"?t:this.getColInfo(t);if(!s)return;let r=n.id==="HEADER"?s.setting.title:(a=n.data)==null?void 0:a[s.name];const{cellValueGetter:o}=this.options;return o&&(r=o.call(this,n,s,r)),r}getRowInfoByIndex(e){return this.layout.rows[e]}update(e={},t){if(!this._options)return;typeof e=="function"&&(t=e,e={});const{dirtyType:n,state:s}=e;if(n==="layout")this._layout=void 0;else if(n==="options"){if(this._options=void 0,!this._layout)return;this._layout=void 0}this.setState(s||(r=>({renderCount:r.renderCount+1})),t)}getPointerInfo(e){const t=e.target;if(!t||t.closest(".no-cell-event"))return;const n=y(t).closest(".dtable-cell");if(!n.length)return;const s=n.attr("data-row"),r=n.attr("data-col");if(!(typeof r!="string"||typeof s!="string"))return{cellElement:n[0],colName:r,rowID:s,target:t}}componentDidCatch(e,t){console.error(`[ZUI] DTable ${this.id} Error:`,e,t)}i18n(e,t,n){return Ne(this._i18nMaps,e,t,n,this.options.lang)??`{i18n:${e}}`}getPlugin(e){return this.plugins.find(t=>t.name===e)}_checkPluginsState(){const e=new Set(this._lastUsedPlugins.keys());this._plugins.forEach(t=>{var s;if(e.has(t.name)){e.delete(t.name);return}let{events:n}=t;n&&(typeof n=="function"&&(n=n.call(this)),Object.entries(n).forEach(([r,o])=>{o&&this.on(r,o)})),(s=t.onMounted)==null||s.call(this),this._lastUsedPlugins.set(t.name,t)}),e.size&&e.forEach(t=>{var s;const n=this._lastUsedPlugins.get(t);(s=n==null?void 0:n.onUnmounted)==null||s.call(this),this._lastUsedPlugins.delete(t)})}render(){let e=At(this,Kc,Zf).call(this);const{className:t,rowHover:n,colHover:s,cellHover:r,bordered:o,striped:a,scrollbarHover:l,beforeRender:c,emptyTip:d,style:u}=this.options,p={...u},g=["dtable",t,{"dtable-hover-row":n,"dtable-hover-col":s,"dtable-hover-cell":r,"dtable-bordered":o,"dtable-striped":a,"scrollbar-hover":l,"no-animation":this._noAnimation}],b=[];if(e){const C=!e.rows.length;if(c){const S=c.call(this,e);S&&(e=S)}this._plugins.forEach(S=>{var D;const x=(D=S.beforeRender)==null?void 0:D.call(this,e);x&&(e=x)}),p.width=e.width,p.height=e.height,p["--dtable-row-height"]=`${e.rowHeight}px`,p["--dtable-header-height"]=`${e.headerHeight}px`,g.push(e.className,C?"dtable-is-empty":"",{"dtable-has-scroll-y":e.rowsHeightTotal>e.rowsHeight,"dtable-scrolled-down":e.scrollTop>0,"dtable-scrolled-bottom":e.scrollTop>=e.rowsHeightTotal-e.rowsHeight,"dtable-scrolled-right":e.scrollLeft>0,"dtable-scrolled-end":e.scrollLeft>=e.cols.center.totalWidth-e.cols.center.width}),e.children&&b.push(...e.children),C&&d?(delete p.height,b.push(k("div",{className:"dtable-empty-tip",children:k(me,{content:d,generatorThis:this,generatorArgs:[e]})},"empty-tip"))):(b.push(At(this,Lc,qf).call(this,e),At(this,Rc,Gf).call(this,e),At(this,Oc,Yf).call(this,e)),e.scrollable&&b.push(At(this,zc,Qf).call(this,e))),this._plugins.forEach(S=>{var D;const x=(D=S.onRender)==null?void 0:D.call(this,e);x&&(x.style&&Object.assign(p,x.style),x.className&&g.push(x.className),x.children&&b.push(x.children))})}return k("div",{id:this._id,className:V(g),style:p,ref:this.ref,tabIndex:-1,children:b})}};Fn=new WeakMap,Fs=new WeakMap,js=new WeakMap,Lc=new WeakSet,qf=function(i){const{header:e,cols:t,headerHeight:n,scrollLeft:s,headerChildren:r}=i;if(!e)return null;if(e===!0)return k(Vf,{className:"dtable-header",cols:t,height:n,scrollLeft:s,rowHeight:n,scrollTop:0,cellClass:"dtable-header-cell",rows:{id:"HEADER",index:-1,top:0},top:0,onRenderCell:Je(this,Vo),children:r},"header");const o=Array.isArray(e)?e:[e];return k(zl,{className:"dtable-header",style:{height:n},renders:o,generateArgs:[i],generatorThis:this,children:r},"header")},Rc=new WeakSet,Gf=function(i){const{headerHeight:e,rowsHeight:t,visibleRows:n,rowHeight:s,cols:r,scrollLeft:o,scrollTop:a,bodyChildren:l}=i;return k(Vf,{className:"dtable-body",top:e,height:t,rows:n,rowHeight:s,scrollLeft:o,scrollTop:a,cols:r,onRenderCell:Je(this,Vo),children:l},"body")},Oc=new WeakSet,Yf=function(i){let{footer:e}=i;if(typeof e=="function"&&(e=e.call(this,i)),!e)return null;const t=Array.isArray(e)?e:[e];return k(zl,{className:"dtable-footer",style:{height:i.footerHeight,top:i.rowsHeight+i.headerHeight},renders:t,generateArgs:[i],generatorThis:this,generators:i.footerGenerators,children:i.footerChildren},"footer")},zc=new WeakSet,Qf=function(i){const e=[],{scrollLeft:t,cols:{left:{width:n},center:{width:s,totalWidth:r}},scrollTop:o,rowsHeight:a,rowsHeightTotal:l,footerHeight:c,headerHeight:d}=i,{scrollbarSize:u=12,horzScrollbarPos:p,vertScrollbarPos:g}=this.options;return r>s&&e.push(k(Of,{type:"horz",scrollPos:t,scrollSize:r,clientSize:s,onScroll:Je(this,Ko),left:n,bottom:(p==="inside"?0:-u)+c,size:u,wheelContainer:this.ref},"horz"),k("div",{className:"dtable-scroll-shadow is-left",style:{left:n,height:d+a}}),k("div",{className:"dtable-scroll-shadow is-right",style:{left:n+s,height:d+a}})),l>a&&e.push(k(Of,{type:"vert",scrollPos:o,scrollSize:l,clientSize:a,onScroll:Je(this,Ko),right:g==="outside"?-u:0,size:u,top:d,wheelContainer:this.ref},"vert")),e.length?e:null},Uo=new WeakSet,Fc=function(){var i;this._needRender=!1,this._plugins.forEach(e=>{var t;return(t=e.afterRender)==null?void 0:t.call(this)}),(i=this.options.afterRender)==null||i.call(this)},Vo=new WeakMap,Ko=new WeakMap,jc=new WeakMap,Bc=new WeakMap,Hc=new WeakMap,Wc=new WeakMap,Bs=new WeakSet,qo=function(i){const{element:e,options:t}=this;if(!e)return;const n=y(e),s=i?{in:!0,row:i[0],col:i[1]}:{in:!1};t.colHover==="header"&&s.row!=="HEADER"&&(s.col=void 0);const r=this._hover;s.in!==r.in&&n.toggleClass("dtable-hover",s.in),s.row!==r.row&&(n.find(".is-hover-row").removeClass("is-hover-row"),s.row&&n.find(`.dtable-cell[data-row="${s.row}"]`).addClass("is-hover-row")),s.col!==r.col&&(n.find(".is-hover-col").removeClass("is-hover-col"),s.col&&n.find(`.dtable-cell[data-col="${s.col}"]`).addClass("is-hover-col")),this._hover=s},Go=new WeakSet,Uc=function(){if(this._options)return!1;const e={...Bf(),...this._allPlugins.reduce((t,n)=>{const{defaultOptions:s}=n;return s&&Object.assign(t,s),t},{}),...this.props};return this._options=e,this._plugins=this._allPlugins.reduce((t,n)=>{const{options:s}=n;let r=e;return s&&(r=Object.assign({...r},typeof s=="function"?s.call(this,e):s)),r!==e&&Object.assign(e,r),t.push(n),t},[]).filter(t=>{const{when:n}=t;return!n||n.call(this,e)}),this._i18nMaps=[this.options.i18n,...this.plugins.map(t=>t.i18n)].filter(Boolean),!0},Vc=new WeakSet,Xf=function(){var ee,he;const{plugins:i}=this;let e=this._options;const t={flex:k("div",{style:"flex:auto"}),divider:k("div",{style:"width:1px;margin:var(--space);background:var(--color-border);height:50%"})};i.forEach(X=>{var ge;const se=(ge=X.beforeLayout)==null?void 0:ge.call(this,e);se&&(e={...e,...se}),Object.assign(t,X.footer)});let n=e.width,s=0;if(typeof n=="function"&&(n=n.call(this)),n==="100%"){const{parent:X}=this;if(X)s=X.clientWidth;else{this._needRender=!0;return}}const r=vv(this,e,i,s),{data:o,rowKey:a="id",rowHeight:l=35,rowConverter:c}=e,d=[],u=(X,se,ge)=>{var Pe,ce;const be=ge??{[a]:X},Me={data:c?c.call(this,be,se):be,id:X,index:d.length,top:0};if(ge||(Me.lazy=!0),d.push(Me),((Pe=e.onAddRow)==null?void 0:Pe.call(this,Me,se))!==!1){for(const J of i)if(((ce=J.onAddRow)==null?void 0:ce.call(this,Me,se))===!1)return}};if(typeof o=="number")for(let X=0;X<o;X++)u(`${X}`,X);else Array.isArray(o)&&o.forEach((X,se)=>{typeof X=="object"?u(`${X[a]??""}`,se,X):u(`${X??""}`,se)});let p=d;const g={};if(e.onAddRows){const X=e.onAddRows.call(this,p,r);X&&(p=X)}for(const X of i){const se=(ee=X.onAddRows)==null?void 0:ee.call(this,p,r);se&&(p=se)}p.forEach((X,se)=>{g[X.id]=X,X.index=se,X.top=X.index*l});const{header:b,footer:C}=e,S=b?e.headerHeight||l:0,x=C?e.footerHeight||l:0;let D=e.height,A=0;const B=p.length*l,H=S+x+B;if(typeof D=="function"&&(D=D.call(this,H)),D==="auto")A=H;else if(typeof D=="object")A=Math.min(D.max,Math.max(D.min,H));else if(D==="100%"){const{parent:X}=this;if(X)A=X.clientHeight;else{A=0,this._needRender=!0;return}}else A=D;const G=A-S-x,Y={options:e,allRows:d,width:s,height:A,rows:p,rowsMap:g,rowHeight:l,rowsHeight:G,rowsHeightTotal:B,header:b,footer:C,footerGenerators:t,headerHeight:S,footerHeight:x,cols:r},Z=(he=e.onLayout)==null?void 0:he.call(this,Y);Z&&Object.assign(Y,Z),i.forEach(X=>{if(X.onLayout){const se=X.onLayout.call(this,Y);se&&Object.assign(Y,se)}}),this._layout=Y},Kc=new WeakSet,Zf=function(){(At(this,Go,Uc).call(this)||!this._layout)&&At(this,Vc,Xf).call(this);const{layout:i}=this;if(!i)return;const{cols:{center:e}}=i;let{scrollLeft:t}=this.state;t=Math.min(Math.max(0,e.totalWidth-e.width),t);let n=0;e.list.forEach(b=>{b.left=n,n+=b.realWidth,b.visible=b.left+b.realWidth>=t&&b.left<=t+e.width});const{rowsHeightTotal:s,rowsHeight:r,rows:o,rowHeight:a}=i,l=Math.min(Math.max(0,s-r),this.state.scrollTop),c=Math.floor(l/a),d=l+r,u=Math.min(o.length,Math.ceil(d/a)),p=[],{rowDataGetter:g}=this.options;for(let b=c;b<u;b++){const C=o[b];C.lazy&&g&&(C.data=g([C.id])[0],C.lazy=!1),p.push(C)}return Object.assign(i,{visibleRows:p,scrollTop:l,scrollLeft:t,headerChildren:[],bodyChildren:[],footerChildren:[],children:[],className:"",scrollable:!0}),i},Hs.addPlugin=zf,Hs.removePlugin=Ff;class wv extends pe{constructor(){super(...arguments),this._dtablePlugins=["sort","zentao","resize","pager"],this._dtable=fe(),this._handleClickCell=(e,t)=>{var s,r,o;if(["id","actions","collects"].includes(t.colName)||e.target.closest(".btn,[zui-command]"))return;const{onClickDoc:n}=this.props;if(n){const a=(s=t.rowInfo)==null?void 0:s.data;a&&((o=(r=this.props).onClickDoc)==null||o.call(r,a))}},this._createActionItem=(e,t)=>{var n,s;return e.command=e.command.replace("{id}",String(t.row.data.id)),e.key==="move"&&((s=(n=this.props).canMoveDoc)==null?void 0:s.call(n,t.row.data))===!1&&(e.disabled=!0),e},this._getToolbar=e=>{const{getActions:t}=this.props,n=t==null?void 0:t("doc-table",{ui:"table-foot-toolbar",dtable:e});if(n)return{btnProps:{size:"sm",btnType:"secondary"},items:n}}}_getCols(){const e={edit:{hint:"编辑",icon:"edit",command:"startEditDoc/{id}",key:"edit"},move:{hint:"移动",icon:"folder-move",command:"moveDoc/{id}",key:"move"},delete:{hint:"删除",icon:"trash",command:"deleteDoc/{id}",key:"trash"}},{searchKeys:t=[]}=this.props;return[{name:"id",title:"ID",type:"checkID",sort:"number"},{name:"title",title:"标题",type:"title",onRenderCell:(r,o)=>{const a=o.row.data,l=a.title;return r[0]=w("a",{title:l,href:"javascript:void(0)",className:"doc-list-item-title text-primary"},t.length?st.underlineKeys(t,[l]):l),r.unshift(w(Ie,{icon:a.icon??this.props.docIcon,className:a.icon?"":"text-special"})),a.status==="draft"&&r.push(w("div",{className:"label special-pale size-sm rounded-full ml-1 flex-none"},"草稿")),r},sort:!0},{name:"collects",title:"收藏数",onRenderCell:(r,o)=>{const a=o.row.data;return[w(ke,{type:"ghost",size:"sm",text:a.collects||0,icon:a.isCollector?"star text-warning":"star-empty text-gray","zui-command":`collectDoc/${o.row.id}`})]},sort:"number",cellClass:"px-2",fixed:"left"},{name:"views",title:"浏览数",sort:"number",align:"center"},{name:"addedBy",title:"创建者",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"editedBy",title:"修改者",type:"user",sort:!0},{name:"editedDate",title:"修改日期",type:"date",sort:!0},{name:"actions",title:"操作",type:"actions",width:96,minWidth:96,actionsMap:e,actions:["edit","move","delete"],actionItemCreator:this._createActionItem}]}_getTableOptions(e){const{docs:t,userMap:n,getTableOptions:s,app:r,orderBy:o}=e;let a="",l="";typeof o=="string"&&o&&([a,l]=o.split("_"));const c=t.map(u=>u.data);["order","id"].includes(a)&&l&&(l==="asc"?c.sort((u,p)=>u.order-p.order):c.sort((u,p)=>p.order-u.order));const d={width:"100%",height(u){var g;const p=(g=this.element)==null?void 0:g.parentElement;return p?Math.min(u,p.clientHeight):u},cols:this._getCols(),checkable:!0,sort:!0,plugins:this._dtablePlugins,data:c,onCellClick:this._handleClickCell,userMap:n,colResize:!0,footToolbar:this._getToolbar,footer:["checkbox","toolbar","checkedInfo","flex","pager"],localPager:!0,emptyTip:w("div",{className:"center gap-4"},w("div",{className:"text-gray"},r.getLang("noDocs","没有文档")),He.render({items:r.getActions("doc-list",{ui:"doc-list-empty"})},[])),footPager:{items:r.getPagerItems()}};return(s==null?void 0:s(d,{type:"doc-list"}))??d}render(e){return w("div",{class:V("doc-list h-full col",e.className)},w(Hs,{ref:this._dtable,...this._getTableOptions(e)}))}}const Ji=class extends ut{_getFileIcon(e,t){if(!t)return null;const n=typeof t;return n==="string"?t:(t=t||this.props.fileIcon,n==="function"?t.call(this,e):t[e.extension]||"file")}_getItems(e){const t=super._getItems(e),{fileIcon:n,fileSizeFormat:s,itemProps:r,heading:o,fileUrl:a,fileActions:l}=e,c=t.map(d=>{let u=null;return typeof d.size=="number"&&(u=dt(d.size),s&&(u=Ce(s,{size:u}))),{key:`${d.id}`,icon:this.constructor.getFileIcon(d,n),iconClass:"text-gray",title:d.title,subtitle:u,multiline:!1,url:typeof a=="function"?a.call(this,d):a?Ce(a,d):void 0,actions:l?l.call(this,d):void 0,...r}});return o&&c.unshift({key:"heading",titleClass:"font-bold",type:"heading",...o}),c}_getRenderedItem(e,t){return t}static getFileIcon(e,t){if(!t)return null;const n=typeof t;return n==="string"?t:n==="function"?t.call(this,e):t[e.extension]||"file"}static getDefaultIconMap(){return[["file-image",["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]],["file-audio",["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac"]],["file-video",["mp4","avi","mkv","mov","flv","wmv","webm"]],["file-archive",["zip","rar","7z","tar","gz","bz2","xz"]],["file-code",["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown"]],["file-pdf",["pdf"]],["file-log",["log"]],["markdown",["md"]],["file-word",["doc","docx"]],["file-excel",["xls","xlsx"]],["file-powerpoint",["ppt","pptx"]],["file-text",["txt","csv"]]].reduce((t,[n,s])=>(s.forEach(r=>{t[r]=n}),t),{})}};Ji.NAME="file-list",Ji.defaultProps={...ut.defaultProps,fileSizeFormat:"({size})",fileIcon:Ji.getDefaultIconMap()},Ji.TAG="div",Ji.defaultItemProps={component:"div"};let Yo=Ji;function Jf(i){i=i||location.search,i[0]==="?"&&(i=i.substring(1));try{const e=new URLSearchParams(i),t={};for(const n of e.keys())t[n]=e.getAll(n).join(",");return t}catch{return{}}}function ep(i){if(!i)return{url:i};const{config:e}=window;if(/^https?:\/\//.test(i)){const l=window.location.origin;if(!i.includes(l))return{external:!0,url:i};i=(e.webRoot.endsWith("/")?"/":"")+i.substring((l+e.webRoot).length)}const t=i.split("#"),n=t[0].split("?"),s=n[1],r=s?Jf(s):{};let o=n[0];const a={url:i,isOnlyBody:r.onlybody==="yes",vars:[],hash:t[1]||"",params:r,tid:r.tid||""};if(e.requestType==="GET"){a.moduleName=r[e.moduleVar]||"index",a.methodName=r[e.methodVar]||"index",a.viewType=r[e.viewVar]||e.defaultView;for(const l in r)l!==e.moduleVar&&l!==e.methodVar&&l!==e.viewVar&&l!=="onlybody"&&l!=="tid"&&a.vars.push([l,r[l]])}else{let l=o.lastIndexOf("/");l===o.length-1&&(o=o.substring(0,l),l=o.lastIndexOf("/")),l>=0&&(o=o.substring(l+1));const c=o.lastIndexOf(".");c>=0?(a.viewType=o.substring(c+1),o=o.substring(0,c)):a.viewType=e.defaultView;const d=o.split(e.requestFix);if(a.moduleName=d[0]||"index",a.methodName=d[1]||"index",d.length>2)for(let u=2;u<d.length;u++)a.vars.push(["",d[u]]),r["$"+(u-1)]=d[u]}return a}function yn(i,e,t,n,s,r){if(typeof i=="object")return yn(i.moduleName,i.methodName,i.vars,i.viewType,i.hash,i.params);const o=window.config||{};if(t){typeof t=="string"&&(t=t.split("&"));for(let c=0;c<t.length;c++){const d=t[c];if(typeof d=="string"){const u=d.split("=");t[c]=[u.shift(),u.join("=")]}}}const a=[],l=o.requestType==="GET";if(l){if(a.push(o.router,"?",o.moduleVar,"=",i,"&",o.methodVar,"=",e),t)for(let c=0;c<t.length;c++)a.push("&",t[c][0],"=",t[c][1]);n&&n!==o.defaultView&&a.push("&",o.viewVar,"=",n)}else{if(o.requestType=="PATH_INFO"&&a.push(o.webRoot,i,o.requestFix,e),o.requestType=="PATH_INFO2"&&a.push(o.webRoot,"index.php/",i,o.requestFix,e),t)for(let c=0;c<t.length;c++)a.push(o.requestFix+t[c][1]);n=n||o.defaultView,n&&a.push(".",n)}return r&&Object.keys(r).forEach(c=>{const d=r[c];c[0]!=="$"&&a.push(!l&&!a.includes("?")?"?":"&",c,"=",d)}),typeof s=="string"&&a.push(s.startsWith("#")?"":"#",s),a.join("")}const qc=class us extends pe{constructor(){super(...arguments),this._files=It(),this._loadID="",this._timer=0,this._handleChangePager=e=>{this.props.app.resetPager("files",{...e})}}_filterFiles(e){if(!(e!=null&&e.length))return e;const{currentUser:t,onGetUser:n,searchKeys:s=[],filterType:r}=this.props,o=r&&r!=="all";if(!o&&!s.length)return e;const a=["title","id","addedBy","addedDate","extension","objectType","sourceName",l=>`.${l.extension}`,n?l=>n(l.addedBy).realname:null].filter(Boolean);return e.filter(l=>!(o&&!us.isFileMatchFilter(l,r,t)||s.length&&!st.isItemMatch(l,s,a)))}_getCols(){const{searchKeys:e=[],fileUrl:t,app:n}=this.props,s=l=>typeof t=="function"?t.call(this,l):t?Ce(t,l):void 0;return[{name:"id",title:"ID",type:"id",sort:"number"},{name:"title",title:"附件名称",type:"title",width:300,onRenderCell:(l,c)=>{var b;const d=c.row.data,u=us.getFilterTypeFromExt(d.extension),p=u?(b=us.filterTypeConfig[u])==null?void 0:b.iconClass:void 0,g=d.title;return l[0]=w("a",{title:g,href:s(d),target:"_blank",className:"doc-list-item-title text-primary"},e.length?st.underlineKeys(e,[g]):g),l.unshift(w(Ie,{icon:Yo.getFileIcon(d,Yo.getDefaultIconMap())||"file",className:p})),l},sort:!0},{name:"objectName",title:"来源",type:"text",sort:!0,width:400,flex:1,cellClass:"px-2",onRenderCell:(l,c)=>{const d=c.row.data,{objectType:u,objectID:p,sourceName:g}=d;if(!u||!p)return l;const b=yn(u,"view",`${u}ID=${p}`),C=`#${p} ${g}`,S=u==="doc";return l.push(w("a",{"data-toggle":S?void 0:"modal","data-size":S?void 0:"lg",href:b,title:`${d.objectName??""}${C}`},C)),l}},{name:"extension",title:"类型",sort:!0,align:"center"},{name:"size",title:"大小",format:dt,sort:"number"},{name:"addedBy",title:"由谁添加",type:"user",sort:!0},{name:"addedDate",title:"创建日期",type:"date",sort:!0},{name:"actions",title:"操作",fixed:"right",width:64,minWidth:64,onRenderCell:(l,c)=>{const d=c.row.data;return l[0]=w(ke,{type:"ghost",className:"text-primary",size:"sm",icon:"download",hint:n.getLang("downloadFile","下载文件"),target:"_blank",url:s(d)}),l}}]}async loadFiles(){const{filesFetcher:e,objectID:t,objectType:n}=this.props;this._files.value=void 0,this._loadID=[n,t].join();const s=await zt(e,[{objectID:+t,objectType:n}]);[this.props.objectType,this.props.objectID].join()===this._loadID&&(this._files.value=s||[])}tryLoadFiles(){this._loadID!==[this.props.objectType,this.props.objectID].join()&&(this._timer&&clearTimeout(this._timer),this._timer=window.setTimeout(()=>{this._timer=0,this._loadID!==[this.props.objectType,this.props.objectID].join()&&this.loadFiles()},100))}componentDidMount(){this.tryLoadFiles()}componentDidUpdate(){this.tryLoadFiles()}componentWillUnmount(){this._timer&&clearTimeout(this._timer)}_getTableOptions(e,t){const{app:n}=e,s={width:"100%",height(r){var a;const o=(a=this.element)==null?void 0:a.parentElement;return o?Math.min(r,o.clientHeight):r},cols:this._getCols(),checkable:!1,className:"h-full",sort:!0,sortBy:{name:"id",order:"asc"},plugins:["sort","zentao","resize","pager"],data:t||[],userMap:e.userMap,colResize:!0,localPager:!0,emptyTip:t?w("div",{className:"center gap-4 text-gray"},n.getLang("noFiles","没有文件")):null,footPager:{items:n.getPagerItems(),onChangePageInfo:this._handleChangePager}};return n.getTableOptions(s,{type:"file-list"})??s}render(e){const t=this._filterFiles(this._files.value),n=this._getTableOptions(e,t);return w("div",{className:`doc-lib-files h-full col load-indicator${t?"":" loading"}`,"data-loading":e.app.getLang("loadingFilesTip","正在加载文件...")},w(Hs,{...n}))}static getFilterTypeFromExt(e){const[t]=Object.entries(us.filterExtensions).find(([,n])=>n.has(e))||[];return t}static isFileMatchFilter(e,t,n){if(t==="addedByMe")return e.addedBy===n;if(t==="bug"||t==="story"||t==="task")return e.objectType===t;const{filterExtensions:s}=us,{extension:r}=e;if(t==="other")return Object.values(s).every(a=>!a.has(r));const o=s[t];return o==null?void 0:o.has(r)}};qc.filterTypeConfig={all:{text:"全部",icon:"file-alt",iconClass:"text-gray"},story:{text:"需求",icon:"lightbulb",iconClass:"text-primary"},bug:{text:"Bug",icon:"bug",iconClass:"text-danger"},task:{text:"任务",icon:"checkbox",iconClass:"text-secondary"},office:{text:"Office",icon:"file-word",iconClass:"text-primary"},doc:{text:"文档",icon:"file-text",iconClass:"text-secondary"},image:{text:"图片",icon:"file-image",iconClass:"text-warning"},av:{text:"音视频",icon:"file-video",iconClass:"text-danger"},archive:{text:"压缩包",icon:"file-archive",iconClass:"text-important"},code:{text:"代码",icon:"file-code",iconClass:"text-success"},other:{text:"其他",icon:"file",iconClass:"text-gray"},addedByMe:{text:"由我添加",icon:"person",iconClass:"text-primary"}},qc.filterExtensions={av:new Set(["mp3","wav","flac","ogg","m4a","wma","aac","aiff","alac","mp4","avi","mkv","mov","flv","wmv","webm"]),image:new Set(["png","jpg","jpeg","gif","bmp","webp","tiff","ico","svg"]),code:new Set(["js","ts","jsx","tsx","html","css","scss","less","json","xml","yml","yaml","toml","ini","markdown","log"]),doc:new Set(["pdf","txt","md"]),office:new Set(["doc","docx","xls","xlsx","ppt","pptx"]),archive:new Set(["zip","rar","7z","tar","gz","bz2","xz","exe","dmg"])};let Gc=qc;class Cv extends pe{constructor(){super(...arguments),this.state={},this._menu=fe(),this._ref=fe(),this._getTreeItem=e=>{const t=e.data.id;if(e.type==="doc")return{className:"item tree-item",type:"item",key:e.key,icon:e.data.icon??this.props.docIcon,iconClass:e.data.icon?"":"text-special",selected:t===this.props.docID,text:e.data.title,hint:e.data.title,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions("doc",e.data,"sidebar"),_data:e};const{moduleIcon:n,libIcon:s,moduleID:r,lib:o,docID:a,app:l}=this.props,c=l.props.libColors,{modules:d=[],docs:u=[]}=e,p=e.type==="lib",g={className:"item tree-item",type:"item",key:e.key,text:e.data.name,icon:e.data.icon||(p?typeof s=="string"&&c?{icon:s,style:{color:c[t%c.length]}}:s:n),items:p?void 0:[...d,...u],iconClass:p?"gray-pale w-5 h-5 center rounded-lg":"text-warning",selected:!1,innerClass:"group",innerComponent:"div",actions:this.props.app.getItemActions(e.type,e.data,"sidebar"),hint:e.data.name,_data:e};if(!a){const b=o==null?void 0:o.data.id;p&&!r?g.selected=t===b:!p&&r&&(g.selected=t===r)}return g},this._toggleSearchBox=()=>{this.setState({search:!this.state.search})},this._handleToggleTree=()=>{const{nestedShow:e,defaultShow:t}=this._menu.current.state,n=(!e||!Object.keys(e))&&!t;this.setState({isExpandAll:n})},this._toggleTree=()=>{var t;const{isExpandAll:e}=this.state;(t=this._menu.current)==null||t.toggleAll(!this.state.isExpandAll),this.setState({isExpandAll:!e})},this._handleClickItem=e=>{var n,s,r,o,a,l,c,d;if(e.event.target.closest(".item-icon,.nested-toggle-icon"))return;const t=e.renderedItem._data;t&&(t.type==="doc"?(s=(n=this.props).onSelectDoc)==null||s.call(n,t.data):t.type==="lib"?(o=(r=this.props).onSelectLib)==null||o.call(r,t.data.id):t.type==="files"?(l=(a=this.props).onShowFiles)==null||l.call(a):(d=(c=this.props).onSelectLib)==null||d.call(c,t.data.lib,t.data.id))},this._handleClickFileFilter=e=>{const{filesFilterType:t}=this.props;t&&(t.value=e.item.key)}}_renderFooterToolbar(e){var n,s;const t=(s=(n=this.props).getActions)==null?void 0:s.call(n,e,"current","sidebar-toolbar");if(t!=null&&t.length)return He.render({items:t},[],{type:"ghost",size:"sm"})}_renderFooter(e){let t="";const{space:n,spaceType:s,lib:r,showFiles:o,app:a}=this.props;if(n){const l=a.getLang("colon",": ");t=`${a.getLang(["spaceTypeNames",s],[],{custom:"空间",mine:"空间",product:"产品",project:"项目"}[s]||s)}${l}${n.name}`,r?t+=` ${a.getLang("libNamePrefix","库")}${l}${r.data.name}`:o&&(t+=` ${a.getLang("libNamePrefix","库")}${l}${a.getLang("filesLib","附件库")}`)}return w("div",{key:"actions",className:"doc-tree-actions row items-center flex-none surface-light h-9 border-t pl-2 pr-1"},w("div",{className:"flex-auto text-gray text-clip overflow-hidden whitespace-nowrap",title:t},t),this._renderFooterToolbar(e))}_renderLibList(e){const{libs:t,app:n,space:s}=e;if(!(t!=null&&t.length))return w("div",{key:"empty",className:"center gap-4 h-full"},w("div",{className:"text-gray"},n.getLang("noLibs","没有文档库")),He.render({items:n.getActions("space",{ui:"sidebar-no-lib",data:s})},[]));const r=e.libTypes?[...e.libTypes]:[],o=[];let a=!1;const l=new Map;let c=!1;const d=t.reduce((C,S)=>{const{type:x=""}=S.data,D=C.get(x)||[];if(D.push(S),C.set(x,D),x.length&&(a=!0),x==="execution"){const A=S.data.execution;l.has(A)?(l.get(A).push(S),c=!0):l.set(A,[S])}return C},new Map);let u;if(e.onShowFiles){const{libFilesIcon:C="annex-lib"}=e;u={key:"project-files",text:n.getLang("filesLib","附件库"),icon:C,iconClass:"success-pale w-5 h-5 center rounded-lg",actions:!1,selected:e.showFiles,_data:{type:"files"}}}if(a&&r.length){const C=r.reduce((S,x)=>(S.set(x.type,x.name),S),new Map);d.forEach((S,x="")=>{C.has(x)||(C.set(x,x),r.push({type:x,name:x}))}),r.forEach((S,x)=>{const D=d.get(S.type)||[];if(D.length)if(o.push({key:`lib-type-${S.type}`,type:"heading",text:S.name,content:w("span",{className:"label size-sm rounded-full gray-pale"},D.length+(u&&!x?1:0)),icon:S.icon,actions:!1,className:x&&o.length>1?"mt-1.5 pt-1 border-t":""}),c){const A=new Set,B=D.reduce((H,G)=>{const Y=G.data.execution,Z=Y?l.get(Y):null;if(Z&&Z.length>1){if(A.has(Y))return H;A.add(Y),H.push({className:"item tree-item",type:"item",key:`e${Y}`,text:G.data.executionName??G.data.name,innerComponent:"div",icon:"run",iconClass:"text-gray",items:Z.map(ee=>({...this._getTreeItem(ee),text:ee.data.originName}))})}else H.push(this._getTreeItem(G));return H},[]);o.push(...B)}else o.push(...D.map(A=>this._getTreeItem(A)));!x&&u&&o.push(u)})}else o.push(...t.map(C=>this._getTreeItem(C))),u&&o.push(u);const p=e.app.getSortableOptions("lib");return w("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},c?w(p?Fi:bt,{ref:this._menu,wrapClass:"doc-lib-list doc-lib-tree px-1",className:"p-2",items:o,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...p}):w(p?Ms:ut,{className:"doc-lib-list p-2",itemKey:"key",items:o,activeOnHover:!1,hoverItemActions:!0,onClickItem:this._handleClickItem,itemProps:{titleClass:"text-clip"},...p}))}_renderModuleTree(e){const{lib:t,app:n}=e,s=t?[...t.modules,...t.docs].filter(a=>!a.data.deleted):[];if(!s.length)return w("div",{key:"empty",className:"center gap-4 h-full"},w("div",{className:"text-gray"},n.getLang("noModules","没有目录")),He.render({items:n.getActions("lib",{ui:"sidebar-no-module",data:t})},[]));const r=e.app.getSortableOptions("doc-module");return w("div",{key:"list",className:"doc-tree flex-auto min-w-0 overflow-y-auto scrollbar-hover"},w(r?Fi:bt,{ref:this._menu,wrapClass:"doc-lib-list doc-lib-tree px-1",className:V("p-2",t?"":"pl-3"),items:s,activeOnHover:!1,defaultNestedShow:!0,hoverItemActions:!0,itemKey:"key",lines:!0,nestedToggle:".item-icon,.nested-toggle-icon",getItem:this._getTreeItem,onToggle:this._handleToggleTree,onClickItem:this._handleClickItem,...r}))}_renderFileFilterList(e){var s;const t=["all","story","bug","task","office","doc","image","av","archive","code","other"].map(r=>({key:r,...Gc.filterTypeConfig[r]}));e.currentUser&&t.push({key:"addedByMe",...Gc.filterTypeConfig.addedByMe});const n=(s=e.filesFilterType)==null?void 0:s.value;return w(ut,{className:"doc-file-filter-list py-2 px-3",itemKey:"key",items:t.map(r=>({...r,selected:r.key===n})),activeOnHover:!1,onClickItem:this._handleClickFileFilter})}_scrollToSelected(){const e=this._ref.current.querySelector(".item>.selected");e&&y(e).scrollIntoView({behavior:"smooth"})}componentDidMount(){this._sidebar=new zo(this._ref.current,{width:240,minWidth:64,maxWidth:400,parent:".doc-app",side:"left",preserve:this.props.preserve}),this._scrollToSelected()}componentDidUpdate(e){(e.moduleID!==this.props.moduleID||e.docID!==this.props.docID)&&this._scrollToSelected()}componentWillUnmount(){var e;(e=this._sidebar)==null||e.destroy()}render(e){const{className:t,lib:n,showFiles:s,app:r}=e,o=!n||s;return w("div",{className:V("doc-sidebar sidebar border-r flex-none z-50 col",t),ref:this._ref},r.renderCustom("sidebar-before",this),o?this._renderLibList(e):this._renderModuleTree(e),r.renderCustom("sidebar-after",this),this._renderFooter(o?"space":"lib"))}}function xv(i,e,t){const n=new Map,s=new Map,r=new Map,o=[];if(e){const{libs:a=[],docs:l=[],modules:c=[]}=e;for(const u of a){if(u.deleted||u.space!==i&&!t)continue;const g={type:"lib",key:`l${u.id}`,docs:[],modules:[],data:u};n.set(u.id,g),o.push(g)}const d=[];for(const u of c){if(u.deleted)continue;const p=`m${u.id}`,g=n.get(u.lib);if(!g)continue;const b={type:"module",key:p,docs:[],modules:[],data:u,parent:g};s.set(u.id,b),u.parent?d.push(b):g.modules.push(b)}if(d.length)for(const u of d){const p=s.get(u.data.parent);p&&(p.modules.push(u),u.parent=p)}for(const u of l){const p=`${u.id}`,g=n.get(u.lib);if(!g&&u.lib!==i)continue;const b={type:"doc",key:p,data:u,parent:g};r.set(u.id,b);const C=s.get(u.module);C?(C.docs.push(b),b.parent=C):g&&g.docs.push(b)}}return{libs:n,modules:s,docs:r,libList:o}}function tp(i,e=[],t){if(e.push(...t?i.docs.map(n=>n.data):i.docs),i.modules)for(const n of i.modules)tp(n,e,t);return e}const np=1e9;let kv=np;function Sv(){return kv++}function ip(i){return i>=np}function Tv(i){const{link:e,itemProps:t={},typeIconMap:n={},labelMap:s={},searchKeys:r,active:o,itemType:a="",checkIcon:l,hideDirIcon:c}=this,{id:d,keys:u,text:p,className:g,type:b,url:C,items:S,icon:x,label:D,...A}=i;let{type:B}=i;B=B==="item"?a:B||a;let H=S?D??(s[B]||B):null,G;typeof H=="string"&&H.length&&(G=H,H=w("span",{class:"label rounded-full gray-pale size-sm ml-1"},H));let Y=C;Y===void 0&&e&&(typeof e=="function"?Y=e(i):typeof e=="object"?(Y=e[B],Y&&(Y=Ce(Y,i))):S||(Y=Ce(e,i)));let Z=x;Z===void 0&&(!c||Y)&&(Z=n[B]),typeof Z=="string"&&(Z={icon:Z},G&&y.extend(Z,{"data-toggle":"tooltip","data-title":G}));let ee=p??(s[B]||B);r!=null&&r.length&&(ee=hi.underlineKeys(r,[ee]));const he=String(o)===String(d);return{type:"item",key:d,content:H,icon:Z,trailingIcon:l&&he?{icon:"check",className:"mx-1 text-primary"}:void 0,items:S,"data-url":Y,"data-type":B,title:ee,selected:he,hint:p,...t,...A,className:V("dropmenu-item tree-item",g,t.className,S?"is-dir":"is-item"),innerClass:Y?"is-link open-url":"is-toggle",active:!1}}function sp(i){const{className:e,items:t,tree:n,onClickItem:s}=i;return w(bt,{items:t,getItem:Tv.bind(i),className:V(e,"dropmenu-tree"),defaultNestedShow:!0,onClickItem:s,...n})}const $v=(i,e)=>{const{keys:t="",text:n}=i;return!e.length||e.every(s=>t.toLowerCase().includes(s)||typeof n=="string"&&n.toLowerCase().includes(s))},rp=(i,e,t=0)=>(i=i.reduce((n,s)=>{const{items:r}=s;if(r){if(r.length){const[o,a]=rp(r,e);o.length&&(n.push({...s,items:o}),t+=a)}}else $v(s,e)&&(n.push(s),t++);return n},[]),[i,t]);class Dv extends uc{constructor(e){super(e),this._searchbox=fe(),this._list=fe(),this._handleSearch=t=>{this.setState({search:t})},this._handleExpandBtnClick=()=>{this.expand()},this._handleItemClick=({item:t,event:n})=>{const s=y(n.target);!s.closest(".tree-toggle").length&&s.closest(".is-link").length&&(this.props.togglePop(!1,{text:t.text??`${t.type}:${t.id}`}),this.props.changeState({text:t.text??`${t.type||""}:${t.id}`,value:t.id}))},this._scrollToActive=()=>{requestAnimationFrame(()=>{const t=this._list.current;t&&y(t).find(".tree-item-inner.active").scrollIntoView()})},this.activeTab=t=>{this.setState({active:t})},this.expand=t=>{this.setState({expanded:t??!this.state.expanded})},this.state={search:"",data:e.data,expanded:!1,loading:!!e.fetcher&&!e.data}}async load(){var n,s;let{fetcher:e}=this.props;if(!e)return this._scrollToActive();if(typeof e=="string"&&(e={url:e}),typeof e=="object"){const{url:r,...o}=e;e=()=>y.ajax({url:r,dataType:"json",jsonParser:ll,...o})}this.setState({loading:!0});let t=await e();t.result&&(t=t.data),t={...this.props.data,...t},this.setState({data:t,loading:!1},this._scrollToActive),(s=(n=this.props).onCacheData)==null||s.call(n,t)}componentDidMount(){var e;super.componentDidMount(),this.props.data||this.load(),(e=this._searchbox.current)==null||e.focus(),this._scrollToActive()}_getTreeProps(e){const{data:{labelMap:t,link:n,typeIconMap:s,typeLabelMap:r,itemProps:o,tree:a,itemType:l,checkIcon:c,hideDirIcon:d=!0}={},search:u}=this.state;return{items:e.items,labelMap:t,typeIconMap:{execution:"run",project:"project",product:"product",program:"cards-view",...s},hideDirIcon:d,typeLabelMap:r,itemProps:o,itemType:l,checkIcon:c,onClickItem:this._handleItemClick,tree:a,link:n,active:this.props.state.value,searchKeys:y.unique(u.toLowerCase().split(" ").filter(p=>p.length))}}_getData(){const{data:e={},search:t,active:n}=this.state,{tabs:s=[{name:"other"}],expandName:r}=e;let{data:o=[]}=e;Array.isArray(o)&&(o={other:o});const a={},l=y.unique(t.toLowerCase().split(" ").filter(p=>p.length));let c,d;Object.keys(o).forEach(p=>{const g=r===p,b=s.find(B=>B.name===p)||{name:p},C=o[p]||[],S=(n===p||b.active&&n===void 0)&&!g,[x,D]=rp(C,l),A={name:p,items:x,text:b.text,active:S,count:D};g?c=A:(a[p]=A,S&&(d=A))});const u=s.reduce((p,{name:g})=>(g!==r&&p.push(a[g]||{name:g,items:[]}),p),[]);return!d&&u.length&&(d=u[0]),{tabs:u,expandData:c,activeTab:d}}_renderList(e,t,n){const s=t.name,{expanded:r,data:o={}}=this.state;let{hideSingleTab:a=!0}=o;return a=e.length===1&&a,w(In,null,a?null:w("div",{className:"dropmenu-nav"},w("ul",{key:"nav",className:"nav nav-secondary"},e.map(({name:l,text:c,count:d})=>w("li",{className:"nav-item"},w("a",{className:`${s===l?" active":""}`,onClick:this.activeTab.bind(this,l)},c||l,d?w("span",{className:"label gray-pale rounded-full size-sm font-normal"},d):null))))),w("div",{key:"tab",className:"flex-auto dropmenu-list scrollbar-hover"},w(sp,{...this._getTreeProps(t)})),n?w("div",{key:"foot",className:"dropmenu-foot flex-none toolbar justify-between border-t"},o.footToolbar?He.render(o.footToolbar,[]):w("div",{className:"flex-auto"}),w(ke,{type:"ghost text-dark rounded gap-0.5 px-1.5",trailingIcon:`angle-${this.state.expanded?"left":"right"} opacity-60`,onClick:this._handleExpandBtnClick},n.text||n.name," ",n.count&&r?w("span",{className:"ml-1 label gray-pale rounded-full size-sm font-normal"},n.count):null)):null)}_renderExpand(e){return w("div",{className:"col w-1/2 dropmenu-list scrollbar-hover"},w(sp,{...this._getTreeProps(e)}))}_renderPop(){const{expanded:e,data:t={}}=this.state,{searchHint:n,search:s=!0,title:r}=t,{expandData:o,tabs:a,activeTab:l}=this._getData(),c=e&&o;return w(In,null,s?w("div",{key:"search",className:"p-3 flex-none"},w(ci,{ref:this._searchbox,className:"size-md",placeholder:n,onChange:this._handleSearch})):null,r?w("div",{className:"dropmenu-title"},r):null,w("div",{class:"row flex-auto min-h-0",ref:this._list},w("div",{class:`col w-${c?"1/2":"full"}`},this._renderList(a,l,o)),c?w("div",{class:"w-px bg-gray opacity-10"}):null,e&&o&&this._renderExpand(o)))}_getClass(e){const{expanded:t,loading:n,data:s={}}=this.state;return V("dropmenu load-indicator col",super._getClass(e),t&&"is-expanded",n&&"loading",s.search!==!1&&"has-search",s.title?"has-title":"")}_getStyle(e={},t){e=super._getStyle(e,t);const{width:n=248}=this.props;return typeof n=="number"&&(e.width=n*(this.state.expanded?2:1)),e}_getProps(e){const{style:t,...n}=super._getProps(e),s=this.trigger,r=s==null?void 0:s.getBoundingClientRect();return{...n,style:{...t,...this._getStyle(),maxHeight:r?Math.max(r.top-8,window.innerHeight-r.bottom-8):t.maxHeight}}}}class Iv extends uo{_getProps(e){const t=super._getProps(e);return{type:"button","data-value":e.state.value,...t}}_renderTrigger(e){const{text:t,state:n,children:s,caret:r,leadingAngle:o}=e,a=n.text??t??s;return[o&&w(Ie,{icon:"angle-right",className:"is-leading"}),w("span",{key:"text",className:"text",title:typeof a=="string"?a:void 0},a),r&&w("div",{key:"caret",class:"is-caret"},w("span",{className:"caret"}))]}}let Ws=class extends rt{constructor(){super(...arguments),this._setCacheData=e=>{const{cache:t}=this.props;t&&(this._cacheData=e,typeof t=="number"&&(this._cacheTimer&&clearTimeout(this._cacheTimer),this._cacheTimer=window.setTimeout(()=>{this._cacheData=void 0,this._cacheTimer=0},t)))}}getDefaultState(e){return{...super.getDefaultState(e),text:void 0}}componentWillUnmount(){super.componentWillUnmount(),this._cacheTimer&&clearTimeout(this._cacheTimer)}componentWillReceiveProps(e){(this.props.data!==e.data||this.props.fetcher!==e.fetcher)&&(this._cacheData=void 0)}_getTriggerProps(e,t){const{className:n,...s}=super._getTriggerProps(e,t),{value:r=""}=t;return{...s,className:V(n,{"has-value":r.length}),text:e.text,caret:e.caret,maxWidth:e.maxWidth,leadingAngle:e.leadingAngle}}_getPopProps(e,t){return{...super._getPopProps(e,t),data:this._cacheData||e.data,fetcher:e.fetcher,cache:!!e.cache,onCacheData:this._setCacheData,onClickItem:e.onClickItem}}};Ws.defaultProps={...rt.defaultProps,popWidth:248,popMaxHeight:800,maxWidth:160,className:"dropmenu-btn btn ghost",tagName:"button",clickType:"toggle",leadingAngle:!0,caret:!0,cache:60*1e3*4},Ws.Pop=Dv,Ws.Trigger=Iv;class Nv extends pe{constructor(){super(...arguments),this._handleClickItem=(e,t)=>{var n,s;(s=(n=this.props).onSelect)==null||s.call(n,+t,!0)}}render(e){const{space:t,fetcher:n}=e;return w(Ws,{text:t==null?void 0:t.name,defaultValue:t==null?void 0:t.id.toString(),onClickItem:this._handleClickItem,fetcher:n,leadingAngle:!1})}}class op extends pe{constructor(){super(...arguments),this._picker=fe(),this._getItems=()=>{const{spaces:e=[],spaceIcon:t}=this.props;return e.map(n=>({id:n.id,icon:t,text:n.name,value:n.id,className:"group"}))},this._renderCurrent=()=>{const{space:e}=this.props;return w("div",{class:"row items-center"},w("div",{className:"text-md flex-none"},e==null?void 0:e.name),w("span",{className:"caret"}))},this._handleClick=e=>{var t,n,s;!this.props.noClickTrigger&&!e.target.closest(".doc-space-picker-toggle")&&((s=(n=this.props).onSelect)==null||s.call(n,((t=this.props.space)==null?void 0:t.id)||0,!0),e.preventDefault())},this._handleItemClick=e=>{var s,r;const t=this._picker.current;if(!t)return;const n=e.item.value;(r=(s=this.props).onSelect)==null||r.call(s,n,!0),t.select(n),t.close()}}render(e){const{getSpaceFetcher:t,spaceID:n,space:s,spaceType:r,onSelect:o}=e;if(t){const u=t(r,n);if(u)return w(Nv,{fetcher:u,space:s,onSelect:o})}const{spaces:a=[],searchBox:l=!0}=e,c=s||a[0],d={searchBox:l,search:void 0,onClickItem:this._handleItemClick};return w(Kt,{ref:this._picker,className:"doc-space-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-space-picker-menu",style:{maxWidth:200},items:this._getItems,defaultValue:c?String(c.id):"",required:!0,search:!1,cache:!1,caretClass:"hidden",menu:d,popMinWidth:200,display:this._renderCurrent,onClick:this._handleClick})}}op.defaultProps={noClickTrigger:!0};class Qo extends pe{constructor(){super(...arguments),this._picker=fe(),this._getItems=()=>{const{items:e=[],icon:t,current:n,getItems:s}=this.props,r=e.filter(o=>!o.data.deleted).map(o=>({id:o.data.id,icon:t,text:this._getItemText(o),value:o.data.id,selected:(n==null?void 0:n.key)===o.key}));return s?s(r):r},this._renderCurrent=()=>{const{current:e,placeholder:t,type:n,suffixIcon:s,children:r}=this.props,o=n==="lib";return w("div",{class:V("row items-center",o?"gap-2":"gap-1")},w("div",{className:V("row items-center",o?"text-md":"",e?"":"text-gray")},e?this._getItemText(e):t,w("span",{className:"caret"})),r,s?w(Ie,{icon:s}):null)},this._handleClick=e=>{var t,n,s;!this.props.noClickTrigger&&!e.target.closest(".doc-path-picker-toggle")&&((s=(n=this.props).onSelect)==null||s.call(n,((t=this.props.current)==null?void 0:t.data.id)||0,this.props.type),e.preventDefault())},this._handleItemClick=e=>{var s,r;const t=this._picker.current;if(!t)return;const n=e.item.value;(r=(s=this.props).onSelect)==null||r.call(s,parseInt(n,10),e.item.dataType),t.select(n),t.close()}}_getItemText(e){return e?e.type==="doc"?e.data.title:e.data.name:""}render(e){const{current:t,type:n,maxWidth:s,display:r,searchBox:o=!0}=e,a={searchBox:o,search:void 0,onClickItem:this._handleItemClick};return w(Kt,{ref:this._picker,className:"doc-path-picker ring-transparent cursor-pointer state bg-transparent w-auto",popClass:"popup doc-path-picker-menu",style:{maxWidth:s},items:this._getItems,defaultValue:t?String(t.data.id):"",search:!1,cache:!1,caretClass:"hidden",menu:a,popMinWidth:200,required:n!=="lib",display:r??this._renderCurrent,onClick:this._handleClick})}}Qo.defaultProps={type:"module",maxWidth:160,noClickTrigger:!0};class Mv extends pe{constructor(){super(...arguments),this._handleSelectModule=e=>{var t,n;(n=(t=this.props).onSelectModule)==null||n.call(t,e,!0)},this._handleSelectLib=(e,t)=>{var n,s;t==="files"?this.props.app.showFiles():(s=(n=this.props).onSelectLib)==null||s.call(n,e,0)},this._unselectLib=()=>{var e,t;(t=(e=this.props).onSelectLib)==null||t.call(e,0,0)},this._handleSelectVersion=e=>{var t,n;(n=(t=this.props).onSelectDocVersion)==null||n.call(t,e.item.version)},this._getLibItems=e=>{const{app:t,libIcon:n,showFiles:s}=this.props;return t.canShowLibFiles?[...e,{text:t.getLang("filesLib","附件库"),icon:n,key:"files",dataType:"files",selected:!!s}]:e}}_renderAngle(e){return w("div",{key:e,class:"doc-path-picker-angle chevron-right scale-75 opacity-75 flex-none"})}_renderModulePickers(e){const{module:t}=e;if(!t)return[];let n=t;const s=[];for(;n;){const{parent:o}=n;if(s.push(n),o.type!=="module")break;n=o}const r=[];return s.reverse().forEach((o,a)=>{if(s.length>3&&a>0&&a<s.length-1){a===1&&r.push(["module-ellipsis",w("div",{key:"module-ellipsis",class:"doc-path-picker-angle mx-1 opacity-50"},w("div",{className:"more"}))]);return}const{key:l}=o;r.push([`${l}-angle`,w(Qo,{key:l,icon:e.moduleIcon,current:o,items:o.parent.modules,searchBox:{placeholder:this.props.app.getLang("searchModulePlaceholder","searchModulePlaceholder")},onSelect:this._handleSelectModule})])}),r}_renderCurrent(e){var l;const{doc:t,creatingDoc:n,editingDoc:s,docIcon:r,onSelectDoc:o,app:a}=e;if(n)return w(ke,{key:"doc",type:"ghost",icon:e.docIcon,className:"mr-4 min-w-0 justify-start"},w("span",{className:"text-gray min-w-0 overflow-hidden"},n.title),w("span",{className:"label size-sm rounded-full primary-pale flex-none"},a.getLang("newDocLabel","新文档")));if(s)return w(ke,{key:"doc",type:"ghost",icon:e.docIcon,className:"mr-4 min-w-0 justify-start"},w("span",{className:"text-gray min-w-0 overflow-hidden"},s.title),w("span",{className:"label size-sm rounded-full primary-pale flex-none"},a.getLang("editingDocLabel","编辑中")));if(t){const{version:c=1}=t.data,d=e.docVersion||c;return[w(Qo,{key:"doc",type:"doc",icon:r,current:t,items:(l=t.parent)==null?void 0:l.docs,onSelect:o,searchBox:{placeholder:a.getLang("searchDocPlaceholder","搜索文档")},maxWidth:300,suffixIcon:s?"draft-edit":void 0}),c>1?w("div",{key:"version",className:"hint mx-1","data-hint":a.getLang("currentDocVersionHint","当前版本，点击切换")},w(Xi,{text:`#${d}`,size:"xs",type:"gray-pale",rounded:"full",className:"h-4",items:Array(c).fill(0).map((u,p)=>({text:`#${c-p}`,version:c-p,selected:d===c-p})),menu:{onClickItem:this._handleSelectVersion}})):null,t.data.status==="draft"?w("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},"草稿"):null,t.data.views?w("div",{key:"views",className:"text-gray ml-3 text-sm hint","data-hint":a.getLang("viewsCount","阅读次数")},w(Ie,{icon:"eye"})," ",t.data.views):null]}return null}_renderLibPicker(e){const{lib:t,libs:n,libIcon:s,libPlaceholder:r,showFiles:o,app:a}=e;return!t&&!o?null:w(Qo,{key:"lib",type:"lib",icon:s,current:t,items:n,getItems:this._getLibItems,display:o?()=>w("div",{class:"row items-center gap-2"},w("div",{class:"text-md"},a.getLang("filesLib","附件库")),w("span",{className:"caret"})):void 0,placeholder:r,searchBox:{placeholder:a.getLang("searchLibPlaceholder","搜索库")},onSelect:this._handleSelectLib})}render(e){const{spaceIcon:t,space:n,spaces:s,onSelectSpace:r,children:o,homeName:a,noSpace:l,getSpaceFetcher:c,spaceID:d,spaceType:u,app:p}=e;let g;l?g=w(ke,{icon:n?t:"home",type:"ghost",iconClass:"w-4 h-4 center rounded-md primary flex-none",textClass:"text-md",text:n==null?void 0:n.name,onClick:this._unselectLib}):n&&(g=w(op,{key:"space",spaceIcon:t,space:n,spaces:s,searchBox:{placeholder:p.getLang("searchSpacePlaceholder","搜索空间")},onSelect:r,getSpaceFetcher:c,spaceType:u,spaceID:d}));const b=this._renderLibPicker(e),C=this._renderModulePickers(e),S=this._renderCurrent(e);let x=[];a!==!1&&x.push(["home",w(ke,{key:"home-btn",icon:"home",size:"md",type:"ghost text-primary",hint:typeof a=="string"?a:void 0,command:"goHome",...typeof a=="object"?a:{}})]),x.push(["space",g]),b&&x.push(["lib",b]),C&&x.push(...C),S&&x.push(["current",S]);const D=p.getCustomRender("app-nav");return D&&(x=D.call(p,x,this)||x),w("div",{className:"doc-app-nav row items-center flex-auto min-w-0"},x.reduce((A,[B,H],G)=>(H==null||(Array.isArray(H)?A.push(...H):A.push(H),G<x.length-1&&A.push(this._renderAngle(B+"-angle"))),A),[]),o)}}const Yc=class xr extends ze{constructor(){super(...arguments),this._lastChangeContent="",this._assetsMap=new Map}get collection(){return this._collection}get schema(){return this._schema}get doc(){return this._doc}get editor(){return this._editor}async afterInit(){const{presets:e,store:t,blocks:n}=await xr.loadModule(this.options.onLoadingLibChange);if(this.destroyed)return;const{schema:s,collection:r,content:o,mode:a}=this.options;this._uid=this.options.uid||Bo(13),this._schema=s||new t.Schema().register(n.AffineSchemas),["affine:embed-linked-doc","affine:embed-youtube","affine:embed-figma","affine:embed-github","affine:embed-loom"].forEach(l=>this._schema.flavourSchemaMap.delete(l)),this._collection=r||new t.DocCollection({schema:this._schema,blobSources:this.getBlockSources()}),this._collection.meta.initialize(),a==="full"?this._editor=new e.AffineEditorContainer:a==="edgeless"?this._editor=new e.EdgelessEditor:this._editor=new e.PageEditor,await this.updateDoc(o),await this.syncData(!0),this.element.appendChild(this._editor),this.$element.on("syncData",()=>this.syncData())}getBlockSources(){const{uploadUrl:e}=this.options;if(!e)return;const t=this._assetsMap;return{main:{name:this._uid,readonly:!1,get:async n=>{const s=this.options.downloadUrl;if(s&&t.get(n)===null)try{const o=await(await fetch(Ce(s,{title:btoa(n),extra:"editor"}))).blob();t.set(n,o)}catch(r){console.error("[ZUI] download file failed",r)}return t.get(n)||null},set:async(n,s)=>{t.set(n,s);try{const r=await y.post(Ce(e,{uid:encodeURIComponent(this._uid),extra:"editor",field:"imgFile"}),{imgFile:s,"labels[]":[n]},"json");if(!r.error&&r.id){const o=`${r.id}`;return t.set(o,s),o}}catch(r){console.error("[ZUI] update file failed",r)}return n},delete:async n=>{t.delete(n)},list:async()=>Array.from(t.keys())}}}render(e,t){super.render(e,t),t&&this.updateDoc(this.options.content)}async updateDoc(e=""){this._doc&&this._doc.dispose();const{store:t}=xr.Module,n=this._collection;if(e===""){const o=n.createDoc();o.load();const a=o.addBlock("affine:page",void 0);o.addBlock("affine:surface",void 0,a);const l=o.addBlock("affine:note",void 0,a);o.addBlock("affine:paragraph",void 0,l),this._doc=o}else{for(;typeof e=="string";)e=JSON.parse(e);const o=e,a=new t.Job({collection:n}),l=this._assetsMap;xr.forEachBlock(o.blocks,c=>{c.props.sourceId&&l.set(c.props.sourceId,null)});try{this._doc=await a.snapshotToDoc(o)}catch(c){console.error("[ZUI] parse doc content error:",c),this._doc=n.createDoc()}this._lastChangeContent=typeof e=="string"?e:JSON.stringify(o)}const{readonly:s,name:r}=this.options;if(s){const{id:o}=this._doc;n.awarenessStore.setReadonly(n.getBlockCollection(o),!0)}if(r){const o=(a,l)=>{const c=document.createElement("input");return c.type="hidden",c.name=a,c.value=l||"",this.element.appendChild(c),c};this._input||(this._input=o(r)),this._uidInput||(this._uidInput=o("uid",this._uid)),this._input.value=JSON.stringify(e)}return this._editor.doc=this._doc,this._doc.slots.blockUpdated.on(()=>{this.trySyncData()}),this._doc}trySyncData(){this._updateTimer=window.setTimeout(()=>{this.syncData()},200)}async syncData(e){var s,r;const t=await this.toSnapshot();if(!t)return this._lastChangeContent="",!1;const n=JSON.stringify(t);if(this._lastChangeContent===n)return!1;this._lastChangeContent=n,this._input&&(this._input.value=n),e||(r=(s=this.options).onChange)==null||r.call(s,{content:n,title:t.meta.title},t)}async getData(){const e=await this.toSnapshot();return e?{content:JSON.stringify(e),title:e.meta.title,uid:this._uid}:{content:"",title:"",uid:this._uid}}async toSnapshot(){const e=this._doc;if(!e)return;const{collection:t}=e;return await new xr.Module.store.Job({collection:t}).docToSnapshot(e)}destroy(){var e,t,n,s;super.destroy(),(e=this._doc)==null||e.dispose(),(t=this._editor)==null||t.remove(),(n=this._input)==null||n.remove(),(s=this._uidInput)==null||s.remove(),this._updateTimer&&clearTimeout(this._updateTimer)}static async loadModule(e){return this.Module||(e==null||e(!0),this.Module=await y.getLib("blocksuite"),e==null||e(!1)),this.Module}static forEachBlock(e,t){t(e);for(const n of e.children)t(n),this.forEachBlock(n,t)}};Yc.NAME="Editor",Yc.DEFAULT={mode:"page"};let Xo=Yc;const ap=Ne.getCode();y.registerLib("blocksuite",{src:[`editor/blocksuite/editor${ap!=="zh_cn"?`.${ap}`:""}.umd.cjs`,"editor/blocksuite/editor.css"],check:"BlockSuite"}),Xo.register();class Zo extends Xo{}Zo.NAME="PageEditor",Zo.DEFAULT={mode:"page"},Zo.register();class lp extends pe{constructor(){super(...arguments),this._ref=fe()}get element(){return this._ref.current}get $(){return this._editor}init(e){var u;const{className:t,style:n,rootProps:s,ref:r,children:o,jsx:a,key:l,autoInit:c,...d}=this.props;return e={...d,...e},(u=this._editor)==null||u.destroy(),y(this.element).empty(),this._editor=new Xo(this.element,e),this._editor}update(e){var t;(t=this._editor)==null||t.render(e)}getData(){var e;return(e=this._editor)==null?void 0:e.getData()}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){var e;(e=this._editor)==null||e.destroy()}render(e){const{className:t,style:n,rootProps:s,children:r}=e;return w("div",{ref:this._ref,className:V("editor",t),style:n,...s},r)}}lp.defaultProps={autoInit:!0};const cp=class rg extends pe{constructor(e){super(e),this._editorRoot=fe(),this._titleEle=fe(),this._handleChange=()=>{var t,n;(n=(t=this.props).onChange)==null||n.call(t,this.data)},this._uid=e.uid??Bo(13).replaceAll("-","_")}get data(){var e,t,n;return{title:((e=this._titleEle.current)==null?void 0:e.value)??"",content:((n=(t=this._editorRoot.current)==null?void 0:t.querySelector("zen-editor"))==null?void 0:n.value)??"",uid:this._uid}}_loadLib(){return y.getLib("zeneditor",{type:"module"})}async init(e){var l,c,d,u;customElements.get("zen-editor")||((c=(l=this.props).onLoadingLibChange)==null||c.call(l,!0),await this._loadLib(),(u=(d=this.props).onLoadingLibChange)==null||u.call(d,!1));const{readonly:t,content:n,markdown:s,placeholder:r,uploadUrl:o=""}={...this.props,...e},a=[];a.push(`<zen-editor class="p-0 w-full h-full" upload-url="${Ce(o,{uid:encodeURIComponent(this._uid),extra:"",field:"imgFile"})}"${t?" readonly hide-ui":""} fullscreenable expose-editor${s?" markdown":""}${r?` placeholder="${r}"`:""} size="auto" menubar-mode="compact" css="${rg.injectCSS()}">`,`  <article slot="content">${n}</article>`,"</zen-editor>",`<textarea rows="1" style="display: none">${n}</textarea>`,`<input type="hidden" name="uid" value="${this._uid}" />`),y(this._editorRoot.current).html(a.join(`
`))}async getData(){return Promise.resolve(this.data)}update(e){this.init(e)}componentDidMount(){this.props.autoInit&&this.init()}componentWillUnmount(){const e=this._editorRoot.current;e&&(e.innerHTML="")}_renderTitle(e){const{readonly:t,title:n,mode:s}=e;return s!=="full"?null:t?w("h1",{class:"zen-editor-title",style:"font-size: 40px"},n):w("input",{ref:this._titleEle,class:"zen-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:n,onChange:this._handleChange})}render(e){const{className:t,readonly:n}=e;return w("div",{className:V("zen-editor-container",t)},this._renderTitle(e),w("div",{ref:this._editorRoot,className:V("zen-editor p-px mt-px rounded relative",n?"is-readonly":""),onChange:this._handleChange}))}static injectCSS(){return[".editor {border: unset; border-radius: unset; color: var(--color-fore)}",".editor.size-auto {min-height: 0;}","zen-editor-menu-item > .menu-item {color: #9ea3b0!important;}","zen-editor-menu-item > .menu-item:hover {color: var(--color-primary-400)!important; background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active {color: var(--color-primary-400)!important; background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300);}","zen-editor-menu-item > .menu-item.is-active:hover {background-color: var(--color-gray-200)!important;}","zen-editor-menu-item > .menu-item.is-active:not(:hover) {background-color: transparent!important;}","zen-editor-menu-item > .menu-item:has(.color):hover, zen-editor-menu-item > .menu-item:has(.color).is-active {background-color: transparent!important; box-shadow: inset 0 0 0 1px var(--color-primary-300)!important;}",".menubar {border-bottom: 1px solid #d8dbde!important; padding: 0.25rem;}",".editor__content {padding: 0!important}",".tippy-content > div {border: 1px solid #d8dbde!important;}",".tippy-content zen-editor-menu-item {line-height: normal;}",".tippy-content zen-editor-menu-item .label {all: unset;}",".tiptap.ProseMirror {padding-top: 0.5rem;}",".tiptap.ProseMirror p {margin: 0;}"].join(`
`)}};cp.defaultProps={autoInit:!0};let Ev=cp;y.registerLib("zeneditor",{src:"zen-editor/zen-editor.esm.js",type:"module"});class Av extends pe{constructor(e){super(e),this._editor=fe(),this._titleEle=fe(),this._isLoadingLib=It(!1),this._gid=ft(),this._handleChange=t=>{const n=t.content;n!==this._data.content&&(this._data.content=n,this._callChange())},this._handleKeywordsChange=t=>{const s=t.target.value.split(/,|，/).map(r=>r.trim()).filter(Boolean).join(", ");s!==this._data.keywords&&(this._data.keywords=s,this._callChange())},this._handleTitleChange=t=>{const n=t.target.value;n!==this._data.title&&(this._data.title=n,this._callChange())},this._handleLoadingLibChange=t=>{this._isLoadingLib.value=t},this._data={title:e.doc.title,content:e.doc.content??""}}get editor(){return this._editor.current}getData(){var e;return(e=this._editor.current)==null?void 0:e.getData()}focusTitle(){var e;(e=this._titleEle.current)==null||e.focus()}async triggerChange(){var t;const e=await this.getData();e&&((t=this._handleChange)==null||t.call(this,e))}_callChange(){var t,n;const{doc:e}=this.props;(n=(t=this.props).onChange)==null||n.call(t,{id:e.id,...this._data})}_renderTitle(e){const{doc:{title:t,deleted:n},readonly:s,app:r}=e;return s?n?w("div",{class:"flex gap-2 items-center"},w("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t),w("span",{class:"label danger"},r.getLang("deleted","已删除"))):w("h1",{key:"title",class:"doc-editor-title",style:"font-size: 40px"},t):w("input",{key:"title",ref:this._titleEle,type:"text",class:"doc-editor-title w-full font-bold",style:"font-size: 40px",defaultValue:t,onChange:this._handleTitleChange,placeholder:r.getLang("docTitlePlaceholder","请输入文档标题")})}_renderKeywords(e){const{doc:{keywords:t},readonly:n,app:s}=e,r=(t==null?void 0:t.split(/,|，/).map(a=>a.trim()).filter(Boolean))??[];if(n)return w("div",{key:"kw",title:s.getLang("keywords","关键字"),class:`doc-editor-keywords row gap-2 px-1 my-2${r.length?"":" hidden"}`},r.map(a=>w("span",{className:"label label-sm secondary-outline"},a.trim())));const o=`doc-app-kw-${this._gid}`;return w("div",{key:"kw",className:"input-control has-prefix-icon my-2 doc-editor-keywords"},w("input",{key:"kw",type:"text",id:o,class:"form-control ring-0 shadow-none",defaultValue:r.join(", "),onChange:this._handleKeywordsChange,placeholder:s.getLang("keywordsPlaceholder","关键字，使用逗号分隔")}),w("label",{for:o,class:"input-control-prefix"},w("i",{className:"icon icon-tag"})))}render(e){const{className:t,doc:n,belowTitle:s,readonly:r,uploadUrl:o,downloadUrl:a,app:l}=e,c=n.contentType==="doc"?lp:Ev,d=n.content===void 0||n.content===null,u=this._isLoadingLib.value,p=d||u;return w("div",{class:V("doc-editor load-indicator",p?"loading":""),"data-loading":d?l.getLang("loadingDocTip","正在加载文档内容..."):l.getLang("loadingEditorTip","正在加载编辑器...")},this._renderTitle(e),this._renderKeywords(e),s,!p&&w(c,{ref:this._editor,key:`editor-${n.id}${r?"-r":""}-${n.currentVersion||n.version}`,className:t,mode:"page",autoInit:!0,readonly:r,uploadUrl:o,downloadUrl:a,uid:n.uid??`doc${n.id}`,content:n.content??"",markdown:n.contentType==="markdown",placeholder:o?l.getLang("pasteImageTip","可以在编辑器直接贴图。"):"",onChange:this._handleChange,onLoadingLibChange:this._handleLoadingLibChange}))}}let Qc=class extends Fe{get actions(){return this.state.actions||this.props.actions||[]}getDefaultState(e){e=e||this.props;let{preserve:t,defaultReversed:n}=e;return t===!0&&(t=""),n===void 0&&typeof t=="string"&&(this._preserveID=`HistoryPanel.reversed${t.length?`:${t}`:""}`,n=Ze.get(this._preserveID)),{actions:e.actions,expandMap:{},reversed:n}}resetState(e,t){const n=this.getDefaultState(e);t?this.state=n:this.changeState(n)}componentDidMount(){y.on(`load.HistoryPanel.${this.gid}.zt`,(e,{objectType:t,objectID:n})=>{t===this.props.objectType&&String(n)===String(this.props.objectID)&&this.load()}),this.state.actions||this.load()}componentWillUnmount(){y.off(`.HistoryPanel.${this.gid}.zt`)}componentDidUpdate(){(!this.state.actions||this._currentLoadID!==[this.props.objectType,this.props.objectID].join())&&!this.state.loading&&this.load()}async load(){const{objectType:e,objectID:t,fetcher:n=yn("action","ajaxGetList",`objectType=${e}&objectID=${t}`)}=this.props,s=[e,t].join();if(this.state.loading)return;await this.changeState({loading:!0});const o={actions:await zt(n,[{objectType:e,objectID:t}])||[],loading:!1},a=[this.props.objectType,this.props.objectID].join();a!==s?delete o.actions:this._currentLoadID=a,await this.changeState(o)}reverse(e){return e===void 0&&(e=!this.state.reversed),this.changeState({reversed:e},()=>{typeof this._preserveID=="string"&&Ze.set(this._preserveID,e)})}toggle(e,t){return this.changeState(n=>{const{expandMap:s}=n;return t===void 0&&(t=!s[e]),{expandMap:{...s,[e]:t}}})}isAllExpanded(){const{expandMap:e}=this.state;return this.actions.every(t=>{const{history:n,historyChanges:s}=t;return!(n&&n.length||typeof s=="string"&&s.length)||e[t.id]})}toggleAll(e){return e===void 0&&(e=!this.isAllExpanded()),this.changeState({expandMap:e?this.actions.reduce((t,n)=>({...t,[n.id]:e}),{}):{}})}_getClassName(e){return[super._getClassName(e),"history-panel",e.panel?"panel":""]}_getChildren(e){const t=this._buildHeader(e),n=this._buildBody(e);return e.panel?[t?w("div",{key:"heading",className:"panel-heading"},t):null,w("div",{key:"body",className:"panel-body"},n)]:[t,n]}_buildAction(e,t,n,s){const{history:r,historyChanges:o}=e,a=r&&r.length||typeof o=="string"&&o.length,l=typeof e.comment=="string"&&e.comment.length,c=`${t+1}`,d={component:"li",key:String(e.id),"data-id":e.id,"data-action":e.action,className:["history-panel-action list-item item",a?n?"is-expanded":"is-collapsed":""],innerClass:"item-inner list-item-inner",avatar:{className:"text-gray ring canvas",background:"",size:16,circle:!0,...e.action==="finished"?{icon:{icon:"check",className:"text-success"}}:{children:w("span",{style:c.length>1?{transform:`scale(${1-c.length*.1})`}:void 0},c)}},title:{html:e.content},text:a?w(ke,{icon:n?"minus":"plus",type:"ghost",size:"xs",className:"history-panel-action-toggle ring text-gray scale-75",onClick:this.toggle.bind(this,e.id,void 0)}):null,children:a&&n||l?w("div",{className:"history-panel-action-content pl-6 col gap-1 mb-1"},a&&n?typeof o=="string"&&o.length?w("div",{key:"history",className:"history-panel-action-history pl-1",dangerouslySetInnerHTML:{__html:o}}):w("ul",{key:"history",className:"history-panel-action-history col pl-1"},r.map(u=>w("li",{key:u.id,className:"history-panel-history-item",dangerouslySetInnerHTML:{__html:u.content}}))):null,e.comment?w("div",{key:"comment",className:"article-content history-panel-action-comment px-3 py-2 surface relative"},e.commentEditable?w(ke,{key:"btn",type:"ghost",icon:"pencil",size:"sm",className:"comment-btn hover:text-primary absolute top-1 right-1","data-toggle":"comment","data-action-ID":e.id,url:s.editCommentUrl?s.editCommentUrl.replace("{actionID}",String(e.id)):void 0}):null,w("div",{key:"comment",dangerouslySetInnerHTML:{__html:e.comment}})):null):null};return w(Zt,{...d})}_buildBody(e){const{actions:t}=this,{loading:n,expandMap:s,reversed:r}=this.state;return w("ul",{key:"actions",className:V("list history-panel-body load-indicator",{loading:n},r?"col-reverse":"col",e.bodyClass)},t.map((o,a)=>this._buildAction(o,a,s[o.id],e)))}_buildHeader(e){let{header:t}=e;if(!t)return null;const{title:n="History",toolbar:s=!0,commentBtn:r=!0}=e,o=[];if(s){const{reversed:a}=this.state,l=this.isAllExpanded(),{actions:c}=this,d={key:"toolbar",className:"history-panel-toolbar",gap:1,items:[c.length>1?{icon:a?"arrow-down":"arrow-up",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.reverse.bind(this,void 0)}:null,c.some(u=>{const{history:p,historyChanges:g}=u;return p&&p.length||typeof g=="string"&&g.length})?{icon:l?"minus":"plus",type:"ghost",size:"xs",className:"ring text-gray scale-75",onClick:this.toggleAll.bind(this,void 0)}:null].filter(Boolean)};typeof s=="object"&&Object.assign(d,s),d.items&&(!Array.isArray(d.items)||d.items.length)&&o.push(w(He,{...d}))}if(r){const a={key:"commentBtn",type:"ghost",className:"comment-btn text-gray",size:"sm",url:e.commentUrl,icon:{icon:"message",className:"icon-sm text-primary"},"data-toggle":"comment","data-object-ID":e.objectID,"data-object-type":e.objectType};typeof r=="object"?Object.assign(a,r):typeof r=="string"&&(a.text=r),o.push(w(ke,{...a}))}return t={key:"header",className:"history-panel-header",title:n,titleClass:"font-bold mr-1",content:o,contentClass:"flex items-center flex-auto gap-2",...typeof t=="object"?t:{}},w(Zt,{...t})}};Qc.defaultProps={header:!0,panel:!0,preserve:!0};class Us extends pe{constructor(){super(...arguments),this._ref=fe(),this._timer=0,this._editorSelector="page-editor,zen-editor,.doc-editor-content",this.state={},this._getItem=e=>{var t;return e.innerClass=(t=e.text)!=null&&t.length?"":"hidden",e},this._handleClickItem=e=>{this.scrollIntoDoc(e.item)}}update(){var l,c;const e=this.props.container||((l=this._ref.current)==null?void 0:l.closest(".doc-view"));if(!e)return;this._container!==e&&(this._container&&y(this._container).off(".doc-outline"),this._container=e,y(e).on("docChange.doc-outline",()=>{this.tryUpdate()}));const n=y(e).find(this._editorSelector)[0];if(!n)return;const s=n.tagName.toLowerCase(),r=s==="zen-editor"?"zen":s==="page-editor"?"blocksuite":"html";this._editorType=r;const o=r==="blocksuite"?Us.getBlocksuiteHeadings(n):Us.getEditorHeadings(n),a=Us.formHeadings(o);this._lastDocID=(c=this.props.doc)==null?void 0:c.id,this.setState({items:a})}tryUpdate(){var e;this._timer&&clearTimeout(this._timer),this._lastDocID!==((e=this.props.doc)==null?void 0:e.id)&&this.setState({items:void 0}),this._timer=window.setTimeout(()=>{this.update(),this._timer=0},1e3)}scrollIntoDoc(e){var s,r,o,a;const t=this._container;if(!t)return;const n=y(t).find(this._editorSelector)[0];if(n)if(this._editorType==="blocksuite")(s=n.querySelector(`affine-paragraph[data-block-id="${e.id}"]`))==null||s.scrollIntoView({behavior:"smooth",block:"start"});else{const c=(((a=(o=(r=n.shadowRoot)==null?void 0:r.querySelector("zen-editor-core"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector("zen-editor-content"))||n).querySelectorAll("h1,h2,h3,h4,h5,h6");if(!c)return;const{text:d,level:u}=e;let p=e.index!==void 0?c[e.index]:void 0;(!p||p.textContent!==d||p.tagName!==`H${u}`)&&(p=Array.from(c).find(g=>g.textContent===d&&g.tagName===`H${u}`)),p&&p.scrollIntoView({behavior:"smooth",block:"start"})}}componentDidMount(){this.tryUpdate()}componentDidUpdate(e){this.props.doc!==e.doc&&this.tryUpdate()}componentWillUnmount(){this._container&&y(this._container).off(".doc-outline"),this._timer&&clearTimeout(this._timer)}render(e,t){const{items:n}=t;return w("div",{className:"doc-outline",ref:this._ref},n?n.length?w(bt,{items:n,defaultNestedShow:!0,getItem:this._getItem,nestedToggle:".tree-toggle",onClickItem:this._handleClickItem}):w("div",{className:"text-gray p-2"},e.app.getLang("noOutline","没有大纲")):w("div",{className:"text-gray p-1"},e.app.getLang("loading","加载中...")))}static formHeadings(e){let t,n=e.reduce((s,r)=>{r.text=r.text.trim();const{level:o}=r;if(!r.text.length&&(o===1||t&&t.level===o))return s;if(o>1){t||(t={level:1,text:"",id:"",items:[]},s.push(t));let a;if(t.level===o-1)a=t;else if(t.level>=o){for(;t.level>=o;)t.parent&&(t=t.parent);a=t}else{for(;t.level<o-1;){const l={level:t.level+1,text:"",id:"",items:[],parent:t};t.items.push(l),t=l}a=t}r.parent=a,a.items.push(r)}else s.push(r);return t=r,s},[]);return n.length===1&&n[0].text===""&&(n=n[0].items),n}static getBlocksuiteHeadings(e){const t=[],n=(s,r)=>{var a;const o=((a=s.querySelector("v-text"))==null?void 0:a.textContent)??"";t.push({id:s.closest("affine-paragraph").dataset.blockId??`${r}_${o}`,text:o,level:r,items:[]})};return e.querySelectorAll(".affine-paragraph-rich-text-wrapper").forEach(s=>{const r=s.classList;let o=0;r.contains("h1")?o=1:r.contains("h2")?o=2:r.contains("h3")?o=3:r.contains("h4")?o=4:r.contains("h5")?o=5:r.contains("h6")&&(o=6),o&&n(s,o)}),t}static getEditorHeadings(e){var s,r,o;const t=[],n=((o=(r=(s=e.shadowRoot)==null?void 0:s.querySelector("zen-editor-core"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector("zen-editor-content"))||e;return n&&n.querySelectorAll("h1,h2,h3,h4,h5,h6").forEach(a=>{const l=a.textContent||"",c=a.id,d=parseInt(a.tagName[1]);l.length&&d<7&&t.push({index:t.length,level:d,text:l,id:c,items:[]})}),t}}class Pv extends pe{constructor(e){super(e),this._ref=fe(),this._handleNavClick=n=>{var o;const r=(o=n.target.closest("[z-type]"))==null?void 0:o.getAttribute("z-type");r&&(this._status.value=this._status.value===r?!1:r)};const{defaultStatus:t="info"}=e;this._status=e.status||It(t),this.close=this.close.bind(this)}close(){this._status.value=!1}_renderContent(e,t,n){var o;if(!e||!n)return null;const{doc:s,app:r}=t;if(n.render)return w(me,{content:n.render(s)});if(e==="info"){const{creator:a,modifier:l}=t,c=[{label:r.getLang("docStatus","状态"),content:s.status==="draft"?w("div",{key:"status",className:"label special-pale size-sm rounded-full ml-1"},r.getLang("draft","草稿")):r.getLang("released","已发布")},{label:r.getLang("creator","创建者"),content:a.realname},{label:r.getLang("createDate","创建时间"),content:ht(s.addedDate)},{label:r.getLang("modifier","修改者"),content:l==null?void 0:l.realname},{label:r.getLang("editDate","修改时间"),content:ht(s.addedDate)},{label:r.getLang("viewsCount","阅读次数"),content:s.views},{label:r.getLang("collectCount","收藏次数"),content:[s.collects,s.isCollector?w("span",{className:"label side-sm rounded-full warning-pale"},r.getLang("collected","已收藏")):null]}];return w("div",{className:"col gap-2"},w("div",{className:"font-bold px-1"},r.getLang("docInfo","文档信息")),w(Rf,{items:c}))}if(e==="outline")return w("div",{className:"col gap-2"},w("div",{className:"font-bold px-1"},n.title??r.getLang("docOutline","文档大纲")),w(Us,{app:r,container:(o=this._ref.current)==null?void 0:o.closest(".doc-view"),doc:s}));if(e==="history")return w("div",{style:"margin-top: -6px"},w(Qc,{panel:!1,title:n.title??r.getLang("history","历史记录"),objectType:"doc",objectID:s.id,fetcher:t.historyFetcher}))}_renderNav(e,t,n){const{fullscreen:s,onToggleFullscreen:r,app:o}=t;return w("menu",{key:"nav",className:"doc-view-sidebar-nav nav nav-stacked gap-1 p-1 flex-none rounded-lg",onClick:this._handleNavClick},n.map(({icon:a,title:l,key:c})=>w("li",{class:"nav-item item hint-left","data-hint":l,key:c},w("a",{className:`rounded-lg${e===c?" active":""}`,"z-type":c},w(Ie,{icon:a})))),n.length?w("li",{key:"divider",class:"nav-divider divider"}):null,w("li",{class:"nav-item item hint-left","data-hint":s?o.getLang("exitFullscreen","退出全屏"):o.getLang("enterFullscreen","进入全屏")},w("a",{className:"rounded-lg",onClick:r},w(Ie,{icon:s?"fullscreen-exit":"fullscreen"}))),e?w("li",{class:"nav-item item hint-left","data-hint":o.getLang("collapse","收起")},w("a",{className:"rounded-lg",onClick:this.close},w(Ie,{icon:"icon-menu-arrow-right"}))):null)}render(e){var l;const{className:t,app:n,doc:s}=e;let r=this._status.value;r&&ip(e.doc.id)&&(r="outline");const o=((l=n.props.getDocViewSidebarTabs)==null?void 0:l.call(n,s,{isNewDoc:ip(e.doc.id),mode:n.mode}))||[{icon:"list-box",title:n.getLang("docOutline","文档大纲"),key:"outline"}],a=o==null?void 0:o.find(c=>c.key===r);return w("div",{className:V("doc-view-sidebar flex-none z-50 sticky top-3 right-1 self-start",t),ref:this._ref},w("div",{className:"doc-view-sidebar-container border shadow rounded-lg row items-stretch mb-3"},w("div",{key:"content",className:"doc-view-sidebar-content p-2 border-r flex-auto overflow-y-auto scrollbar-hover"},this._renderContent(r,e,a)),this._renderNav(r,e,o)))}}class Lv extends pe{constructor(e){super(e),this._editorRef=fe(),this._ref=fe(),this._currentDocID=It(""),this._modeChangeEffect=dn(()=>{this.props.app.mode!=="view"&&(this._currentDocID.value="")}),this._docChangeEffect=dn(()=>{const{docID:s,docVersion:r}=this.props.app.signals,o=[s,r].join();o!==this._currentDocID.value&&(this._currentDocID.value=o,this.tryLoadDoc())}),this._handleChange=s=>{const{doc:r,mode:o="view",onChange:a}=this.props;a==null||a(s,o,r),y(this.element).trigger("docChange",[s,o,r])};const{preserve:t}=e,n=t?`${t}-expanded`:null;this._fullscreen=e.fullscreen||It(!1),this._status=It(n?Ze.get(n,!1):!1),this.toggleFullscreen=this.toggleFullscreen.bind(this),n&&this._status.subscribe(s=>{Ze.set(n,s)})}get editor(){return this._editorRef.current}get element(){return this._ref.current}toggleFullscreen(){const e=this._ref.current;e&&y.toggleFullscreen({target:e,afterEnter:()=>{this._fullscreen.value=!0},afterExit:()=>{this._fullscreen.value=!1}})}tryLoadDoc(){const e=this._currentDocID.value;if(e){const[t,n]=e.split(",").map(s=>+s);this.props.app.loadDoc(t,n)}}componentWillUnmount(){this._modeChangeEffect(),this._docChangeEffect()}_renderEditor(e){const{doc:t,mode:n="view",uploadUrl:s,downloadUrl:r,app:o}=e,a=o.renderCustom("editor");return a!==void 0?a:w(Av,{app:o,ref:this._editorRef,className:(t.content??"")===""&&n==="view"?"is-empty hidden":"",readonly:n==="view",doc:t,uploadUrl:s?Ce(s,{objectID:n==="create"?0:t.id,objectType:"doc",api:t.contentType==="doc"?"true":"",extra:t.contentType==="doc"?"editor":""}):void 0,downloadUrl:r?Ce(r,{id:0,objectID:0,objectType:"doc"}):void 0,onChange:this._handleChange})}render(e){var g;const{doc:t,fileActions:n,fileIcon:s,fileUrl:r,creator:o,modifier:a,onGetUser:l,historyFetcher:c,highlight:d,app:u}=e,p=this._status.value;return w("div",{className:V("doc-view absolute inset-0 overflow-auto scrollbar-hover canvas z-10 row",`is-sidebar-${p?"opened":"closed"}`,d?"highlight":""),ref:this._ref},w("div",{class:"doc-view-content mx-auto col gap-4 flex-auto"},this._renderEditor(e),(g=t.files)!=null&&g.length?w(Yo,{className:"doc-files my-4 px-3 py-2 surface rounded-lg",heading:{icon:"paper-clip",title:u.getLang("attachment","附件")},items:t.files,fileActions:n,fileIcon:s,fileUrl:r,itemProps:{target:"_blank"},hoverItemActions:!0}):null),w(Pv,{app:u,doc:t,creator:o,modifier:a,status:this._status,fullscreen:this._fullscreen.value,historyFetcher:c,onGetUser:l,onToggleFullscreen:this.toggleFullscreen}))}}let Jo=class extends pe{render(e){const{avatar:t,account:n,realname:s,user:r,...o}=e,a={code:r?r.account:n,text:r?r.realname??r.account:s??n,src:r?r.avatar:t,...o};return w(Oi,{...a})}};Jo.defaultProps={size:24,circle:!0};function hp(i,e="yyyy年M月d日 hh:mm",t="M月d日 hh:mm"){const n=We(i);return vs(n,new Date)?ht(n,t):ht(n,e)}function Rv(i){const{createDate:e,editDate:t,users:n,app:s}=i,[r,o]=n.value;return w("div",{className:"doc-users-bar avatar-group state rounded-lg"},w("div",{className:"relative",style:"z-index: 1",title:e?s.getLang("createdByUserAt",[{name:r.realname,time:hp(e)}],"由 {name} 创建于 {time}"):r.realname},w(Jo,{size:"xs",user:r,className:"ring ring-canvas hover:scale-110 transition-transform"})),o?w("div",{className:"relative",title:t?s.getLang("editedByUserAt",[{name:o.realname,time:hp(t)}],"由 {name} 编辑于 {time}"):o.realname},w(Jo,{size:"xs",user:o,className:"ring ring-canvas hover:scale-110 transition-transform"})):null)}function Ov(i,e){const{page:t,recPerPage:n}={page:1,recTotal:i.length,pageTotal:Math.ceil(i.length/20),recPerPage:20,...e},s=(t-1)*n,r=t*n;return i.slice(s,r)}class zv extends pe{constructor(e){var n;super(e),this._libsMap=It({}),this._filterType=It(),this._currentFilterType=Ge(()=>{const{app:s}=this.props,r=this._filterType.value,o=s.spaceType;return r||(o==="product"||o==="project"?"mine":"all")}),this._spaceList=Ge(()=>{const{app:s}=this.props;let r=s.signals.spaces.value;const o=this._currentFilterType.value,a=s.spaceType,l=s.props.isMatchFilter;return o&&l&&(r=r.filter(c=>l.call(s,a,o,c))),r.sort((c,d)=>c.order-d.order)}),this._pagedSpaceList=Ge(()=>{const s=this._spaceList.value;return Ov(s,this.props.app.signals.pager.value)}),this._autoLoadLibs=dn(()=>{const s=this._spaceList.value;this.loadLibs(s.map(r=>r.id))}),this._handleFilterTypeClick=s=>{const o=s.target.getAttribute("data-type");o&&(this._filterType.value=o)},this._handleLibClick=s=>{const r=y(s.target);if(r.closest(".toolbar").length)return;const o=r.closest("[z-lib]").z("lib"),a=r.closest("[z-space]").z("space");!o||!a||this.props.app.selectSpace(a,+o)},this._handleChangePager=s=>{this.props.app.resetPager("home",{...s})};const t=e.app.getFilterTypes("home")||[];this._filterType.value=(n=t[0])==null?void 0:n[0]}get app(){return this.props.app}async loadLibs(e){e=e||this._spaceList.value.map(r=>r.id);const{libSummariesFetcher:t}=this.app.props;if(!t)return;const n=typeof t=="object"&&(t.method||"").toLowerCase()==="post"?{data:JSON.stringify(e.join(",")),processData:!1}:void 0,s=await zt(t,[{spaceList:e,spaceType:this.app.spaceType}],n);this._libsMap.value={...this._libsMap.value,...e.reduce((r,o)=>(r[o]=[],r),{}),...s}}_getToolbarActions(e){return e.app.getActions("home",{ui:"toolbar"})}_renderHeader(e){const{app:t}=e,s=this._spaceList.value.length,r=t.getFilterTypes("home")||[],o=this._currentFilterType.value;return w("div",{key:"header",class:"doc-app-header flex-none surface-light row items-center border-b py-2 pl-1 pr-2 flex-none"},w("menu",{className:"nav nav-compact ml-2",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},r.map(([a,l])=>w("li",{key:a,className:"nav-item item"},w("a",{className:a===o?"active rounded":"rounded","data-type":a},l,a===o&&s?w("span",{className:"label size-sm canvas ring-0 rounded-md"},s):null)))),w("div",{className:"flex-auto"}),w(He,{className:"doc-app-toolbar",gap:2,size:"md",items:this._getToolbarActions(e)}))}_getSpaceLibs(e){const{app:t}=this.props,s=this._libsMap.value[e];if(s)return s;const r=[],o=t.signals.docs.value,a=t.signals.libs.value,{maxHomeLibsOfSpace:l=5}=t.props,c=new Map;for(const d of o){const u=d.lib,p=c.get(u)||0;c.set(u,p+1)}for(let d=0;d<a.length;d++){const u=a[d];if(!(u.deleted||u.space!==e)&&(r.push({id:u.id,name:u.name,docs:c.get(u.id)||0}),l&&r.length>=l))break}return r}_renderSpace(e,t){var c;const{app:n}=t,s=n.getItemActions("space",e,"space-card"),r=[{text:n.getLang("enterSpace","进入空间"),textClass:"text-primary",command:`selectSpace/${e.id}/true`},...s];let o=this._getSpaceLibs(e.id);const a=n.props.libColors;let l;return o?o.length?(o.length>5&&(o=o.slice(0,5)),l=w("div",{class:"row"},o.map(d=>{const u=n.getItemActions("lib",d,"space-card");return w("div",{className:"doc-space-card-lib px-2 w-1/5 group"},w("div",{class:"canvas border rounded py-2 px-3 col gap-1 hover:shadow-lg hover:border-primary relative cursor-pointer",onClick:this._handleLibClick,"z-lib":d.id,"z-space":e.id},w(Ie,{icon:"doclib text-2xl",style:a?{color:a[d.id%a.length]}:null}),w("div",{class:"font-bold text-clip",title:d.name},d.name),w("div",{class:"text-gray text-sm"},d.docs?n.getLang("docsTotalInfo",[d.docs],"共 {0} 个文档"):n.getLang("noDocs","没有文档")),u!=null&&u.length?He.render({items:u},[],{size:"sm",type:"ghost",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100"}):null))}))):l=w("div",{className:"center gap-4 py-3"},w("div",{className:"text-gray"},n.getLang("noLibs","没有文档库")),(c=n.props.privs)!=null&&c.createLib?w(ke,{type:"primary-pale",icon:"plus",command:`createLib/${e.id}`},n.getLang("createLib","创建文档库")):null):l=w("div",{className:"relative load-indicator loading center gap-4 h-4 py-3"}),w("div",{class:"doc-space-card ring rounded surface-light",key:e.id},w("header",{class:"row items-center justify-between gap-2 px-2.5 py-1 border-b"},w("div",{class:"row items-center gap-2 flex-none cursor-pointer hover:text-primary","zui-command":`selectSpace/${e.id}/true`},w(Ie,{icon:"docspace",className:"w-4 h-4 center rounded-md text-gray-600 flex-none"}),w("div",{className:"min-w-0 flex-auto"},w("strong",null,e.name))),w(He,{size:"md",items:r})),w("div",{class:"doc-space-card-libs py-3 px-1.5",style:"min-height: 118px"},l))}_renderBody(e){const t=this._pagedSpaceList.value;return w("div",{key:"body",class:"doc-app-body flex-auto min-h-0 col gap-4 p-4 items-stretch overflow-auto scrollbar-hover"},t.map(n=>this._renderSpace(n,e)),t.length===0?w("div",{className:"center text-gray h-full"},e.app.getLang("noDataYet","暂无数据")):null)}_renderFooter(e){const t=e.app.getPagerOptions({className:"flex-none",...e.app.signals.pager.value,recTotal:this._spaceList.value.length,onChangePageInfo:this._handleChangePager},{type:"home"});return w("div",{key:"footer",class:"doc-app-footer surface-light row items-center border-t py-1.5 px-2"},w("div",{class:"flex-auto"}),w(Ao,{...t}))}componentDidMount(){this.props.app.resetPager("home",{recTotal:this._spaceList.value.length})}componentWillUnmount(){this._autoLoadLibs()}render(e){return[this._renderHeader(e),this._renderBody(e),this._renderFooter(e)]}}let Xc=class extends Ol{constructor(e){super(e),this._loadingDocs=new Map,this._viewRef=fe(),this._homeRef=fe(),this._treeMap=Ge(()=>{const{spaceID:t,libs:n,modules:s,docs:r}=this.signals;return xv(t.value,{libs:n.value,modules:s.value,docs:r.value},this.props.noSpace)}),this._space=Ge(()=>{const{spaces:t,spaceID:n}=this.signals,s=n.value;return t.value.find(r=>r.id===s)}),this._spaceList=Ge(()=>{const{spaces:t,spaceType:n}=this.signals,s=n.value;return t.value.filter(r=>!r.deleted&&r.type===s)}),this._libList=Ge(()=>this._treeMap.value.libList),this._docList=Ge(()=>{const t=this._module.value||this._lib.value;return t?this._filterDocs(tp(t,[],!0)):this._filterDocs()}),this._doc=Ge(()=>this._treeMap.value.docs.get(this.signals.docID.value)),this._viewingDoc=Ge(()=>{const t=this._doc.value,n=this.signals.docVersion.value;return!t||!n||n===t.data.version||!t.data.versions?t:{...t,data:{...t.data,...t.data.versions[n]||{content:null},currentVersion:n}}}),this._module=Ge(()=>{var n;const t=((n=this._doc.value)==null?void 0:n.data.module)||this.signals.moduleID.value;return this._treeMap.value.modules.get(t)}),this._lib=Ge(()=>{var n;const t=((n=this._module.value)==null?void 0:n.data.lib)||this.signals.libID.value;return this._treeMap.value.libs.get(t)}),this._viewType=Ge(()=>this._viewInfo.value[0]),this._viewInfo=Ge(()=>{var o;const t=this.signals.mode.value;let n;const s=this.signals.creatingDoc.value,r=this.signals.editingDoc.value;return t==="create"?n=s:t==="edit"?n=r:t==="view"&&(n=((o=this._viewingDoc.value)==null?void 0:o.data)||n),[t,n]}),this._docUsers=Ge(()=>{const t=this._doc.value;if(!t)return[];const{addedBy:n,editedBy:s}=t.data;return[this.getUserInfo(n),s?this.getUserInfo(s):void 0]}),this._hasEditingDoc=Ge(()=>{const[t,n]=this._viewInfo.value;return n&&(t==="edit"||t==="create")}),this._canShowLibFiles=Ge(()=>{const t=this.signals.spaceType.value;let{showLibFiles:n}=this.props;return typeof n=="function"?n=n.call(this,t):Array.isArray(n)&&(n=n.includes(t)),n}),this._location=Ge(()=>{var u;const{spaceType:t,spaceID:n,libID:s,moduleID:r,docID:o,pager:a,searchKeys:l,docVersion:c,mode:d}=this.signals;return{mode:d.value,spaceType:t.value,spaceID:n.value,libID:s.value,moduleID:r.value,docID:o.value,docVersion:c.value,search:(u=l.value)==null?void 0:u.join(" "),filterType:d.value==="files"?this.signals.filesFilterType.value:this.signals.listFilterType.value,pager:a.value,noSpace:this.props.noSpace,orderBy:""}}),this._viewEffect=dn(()=>{var l,c,d,u;const{libID:t,moduleID:n,docID:s}=this.signals,r=s.value?"doc":n.value?"module":t.value?"lib":"space",o=s.value?(l=this._doc.value)==null?void 0:l.data:n.value?(c=this._module.value)==null?void 0:c.data:t.value?(d=this._lib.value)==null?void 0:d.data:this._space.value,a=this.signals.mode.value;(u=this.props.onSwitchView)==null||u.call(this,a,this._location.value,{type:r,title:o?r==="doc"?o.title:o.name:"",data:o})}),this._handleDocChange=(t,n)=>{if(n==="create"){const s=this.signals.creatingDoc.value;s&&(s.title!==t.title||s.content!==t.content||s.keywords!==t.keywords)&&(this.signals.creatingDoc.value={...s,...t,changed:!0})}else if(n==="edit"){const s=this.signals.editingDoc.value;s&&(s.title!==t.title||s.content!==t.content||s.keywords!==t.keywords)&&(this.signals.editingDoc.value={...s,...t,changed:!0})}},this._getFileActions=t=>{var n;return this.getActions("file",{ui:"doc-view",data:t,doc:(n=this.doc)==null?void 0:n.data})},this._handleSearch=t=>{this.signals.searchKeys.value=st.getSearchKeys(t)},this._handleFilterTypeClick=t=>{const n=t.target,s=n.getAttribute("data-type");s&&(n.getAttribute("data-view")==="files"?this.signals.filesFilterType.value=s:this.signals.listFilterType.value=s)},this.selectSpace=this.selectSpace.bind(this),this.selectDoc=this.selectDoc.bind(this),this.selectLib=this.selectLib.bind(this),this.selectModule=this.selectModule.bind(this),this.getUserInfo=this.getUserInfo.bind(this),this.selectDocVersion=this.selectDocVersion.bind(this),this.showFiles=this.showFiles.bind(this),this.getActions=this.getActions.bind(this),this.getItemActions=this.getItemActions.bind(this),this.executeCommand=this.executeCommand.bind(this),this.getTableOptions=this.getTableOptions.bind(this)}get spaceType(){return this.signals.spaceType.value}get spaceID(){return this.signals.spaceID.value}get libID(){return this.signals.libID.value}get moduleID(){return this.signals.moduleID.value}get docID(){return this.signals.docID.value}get docVersion(){return this.signals.docVersion.value}get space(){return this._space.value}get lib(){return this._lib.value}get module(){return this._module.value}get doc(){return this._doc.value}get treeMap(){return this._treeMap.value}get docList(){return this._docList.value}get docUsers(){return this._docUsers.value}get viewInfo(){return this._viewInfo.value}get libList(){return this._libList.value}get spaceList(){return this._spaceList.value}get mode(){return this.signals.mode.value}get canShowLibFiles(){return this._canShowLibFiles.value}get hasEditingDoc(){return this._hasEditingDoc.value}get location(){return this._location.value}_filterDocs(e){if(e=e||this.signals.docs.value,e.length){const t=this.signals.searchKeys.value||[],n=this.signals.listFilterType.value,s="key"in e[0],{currentUser:r,isMatchFilter:o,noSpace:a}=this.props,l=o?o.bind(this,"doc",n):p=>n==="createdByMe"?p.addedBy===r:n==="editedByMe"?p.editedBy===r:n==="draft"?p.status==="draft":n==="collected"?p.isCollector:!0;if(s&&!t.length)return n!=="all"&&n?e.filter(p=>l(p.data)):e;const c=this.signals.spaceID.value,d=this._treeMap.value,u=["id","title","keywords","addedBy","editedBy",p=>this.getUserInfo(p.addedBy).realname,p=>{const g=p.editedBy;return g?this.getUserInfo(g).realname:void 0}];return e.reduce((p,g)=>{const b=s?g.data:g;if(b.deleted||n&&!l(b)||t.length&&!st.isItemMatch(b,t,u))return p;const C=d.libs.get(b.lib);return(a||b.lib===c||C&&C.data.space===c)&&p.push(s?g:d.docs.get(b.id)),p},[])}return[]}loadHomeLibs(){var e;(e=this._homeRef.current)==null||e.loadLibs()}toggleFullscreen(){var e;(e=this._viewRef.current)==null||e.toggleFullscreen()}getDefaultState(e){e=e||this.props;const{data:t,fetcher:n,mode:s="home",filterType:r="all",pager:o,search:a,docVersion:l=0,defaultState:c}=e,d=this.formatData({libTypes:e.libTypes||[],...t},e);return{loading:!!(!t&&n),editingDoc:void 0,creatingDoc:void 0,searchKeys:st.getSearchKeys(a),fullscreen:!1,listFilterType:r,filesFilterType:r,docVersion:l,mode:s,highlightView:!1,pager:o,...c,...d}}resetState(e){super.resetState(e),requestAnimationFrame(()=>this._afterReset())}getDataSignal(e){const{signals:t}=this;return e==="doc"?t.docs:e==="module"?t.modules:e==="lib"?t.libs:t.spaces}getCurrentItem(e){var t,n,s;return e==="doc"?(t=this._doc.value)==null?void 0:t.data:e==="module"?(n=this._module.value)==null?void 0:n.data:e==="lib"?(s=this._lib.value)==null?void 0:s.data:this._space.value}getSpace(e){return e?this.signals.spaces.value.find(t=>t.id===e):this._space.value}getLib(e){return e?this.treeMap.libs.get(e):this._lib.value}getDoc(e){var t,n;return e=e||((t=this._doc.value)==null?void 0:t.data),typeof e=="number"&&(e=(n=this._treeMap.value.docs.get(e))==null?void 0:n.data),e}getUserInfo(e){const{userMap:t={}}=this.props,n=t[e];return n?typeof n=="string"?{account:e,realname:n}:{...n,account:e}:{account:e,realname:e}}async switchView(e,t){if(!await this.checkEditingDoc())return;t=t||this.mode;const{spaceType:n,spaceID:s,libID:r,moduleID:o,docID:a}=e,{fetchOnChangeSpace:l,fetcher:c}=this.props,d=n&&this.signals.spaceType.value!==n||s!==void 0&&this.signals.spaceID.value!==s,u=l&&c&&d;return this.changeState({...n?{spaceType:n}:null,...s!==void 0?{spaceID:s}:null,...r!==void 0?{libID:r}:null,...o!==void 0?{moduleID:o}:null,...a!==void 0?{docID:a}:null,mode:t},async()=>{u&&await this.load(c,this.signals.spaceType.value,s),a&&t==="edit"?this.startEditDoc(a):t==="create"?this.startCreateDoc():t==="files"?this.showFiles():t==="home"&&this.goHome()})}getLang(e,t=[],n){const{langData:s}=this.props;let r;if(typeof t=="string"?(n=t,r=[]):r=Array.isArray(t)?t:[t],!s)return n??(Array.isArray(e)?e.join("."):e);const o=Array.isArray(e)?fs(s,e):s[e]??n;return typeof o=="function"?o.call(this,...r):typeof o=="string"&&r.length?Ce(o,...r):o}getActions(e,t){const{getActions:n}=this.props,s=n?n.call(this,e,t):[];return s!=null&&s.length&&t.ui?s.filter(r=>r&&(!r.ui||r.ui.split(",").includes(t.ui))):s||[]}getFilterTypes(e){const{getFilterTypes:t}=this.props;return t?t.call(this,e):[["all","All"]]}getTableOptions(e,t){const{getTableOptions:n}=this.props;return n?n.call(this,e,t):e}getPagerItems(){return[{type:"info",text:this.getLang("recTotalFormat","共 {recTotal} 项")},{type:"size-menu",text:this.getLang("recPerPageFormat","每页 {recPerPage} 项"),placement:"top",caret:"up"},{type:"link",page:"first",hint:this.getLang("firstPage","第一页"),icon:"icon-first-page"},{type:"link",page:"prev",hint:this.getLang("prevPage","上一页"),icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",hint:this.getLang("nextPage","icon-angle-right"),icon:"icon-angle-right"},{type:"link",page:"last",hint:this.getLang("lastPage","最后一页"),icon:"icon-last-page"}]}getPagerOptions(e,t){const{getPagerOptions:n}=this.props,s=n?n.call(this,e,t):e;return s.items||(s.items=this.getPagerItems()),s}getSortableOptions(e){const{getSortableOptions:t}=this.props;return t==null?void 0:t.call(this,e)}getItemActions(e,t,n){const s=t==="current"?this.getCurrentItem(e):typeof t=="number"?this.getDataSignal(e).value.find(r=>r.id===t):t;return s?this.getActions(e,{ui:n,data:s}):(console.warn(`[ZUI] getItemActions: ${e} data with ID "${t}" not found.`),[])}async selectSpace(e,t){var a;if(!await this.checkEditingDoc())return;const{fetchOnChangeSpace:n,fetcher:s,autoSelectLib:r}=this.props,o=n&&s&&(this.signals.spaceID.value!==e||typeof t=="number"&&t!==this.signals.libID.value);if(!(this.signals.spaceID.value===e&&!t))return this.changeState({spaceID:e,mode:"list",...t?{libID:typeof t=="number"?t:r?((a=this.libList[0])==null?void 0:a.data.id)??0:0,moduleID:0,docID:0}:null,...o?{data:void 0,loading:!0}:null},()=>{o&&this.load(s,this.signals.spaceType.value,e)})}async selectDoc(e){if(!await this.checkEditingDoc())return;typeof e=="number"&&(e=this.getDoc(e));const t=e?e.id:0;return this.changeState({mode:"view",docID:t,...t!==this.signals.docID.value?{docVersion:0}:null,...e?{libID:e.lib,moduleID:e.module}:null})}goHome(){return this.changeState({libID:0,moduleID:0,docID:0,mode:"home"})}getDefaultPager(e){const{getDefaultPager:t,preserve:n}=this.props,s=n?Ze.get(`${n}:pager:${e}`):null;return t?t.call(this,e):{page:1,recTotal:0,recPerPage:typeof s=="number"?s:20,pageTotal:0}}resetPager(e,t){const n={...this.getDefaultPager(e),...this.signals.pager.value,...t};this.signals.pager.value=n;const{preserve:s}=this.props;s&&Ze.set(`${s}:pager:${e}`,n.recPerPage)}async showFiles(){if(this.canShowLibFiles&&await this.checkEditingDoc())return this.changeState({libID:0,moduleID:0,docID:0,mode:"files",pager:this.getDefaultPager("files")})}async selectLib(e,t){if(!await this.checkEditingDoc())return;const n=this._module.value;n&&t===void 0&&n.data.lib!==e&&(t=0),t===void 0&&(t=this.signals.moduleID.value);const s=e?this.treeMap.libs.get(e):null;if(!(e&&!s||t&&!this.treeMap.modules.get(t)))return this.changeState({libID:e,moduleID:t,mode:"list",docID:0})}selectDocVersion(e,t){const n=this.signals.docID.value;t=t||n;const s=this.getDoc(t);s&&(e=Math.max(0,Math.min(e,s.version??0)),!(t===n&&e===this.signals.docVersion.value)&&this.changeState({docID:t,docVersion:e}))}async selectModule(e,t){if(!await this.checkEditingDoc())return;const n=this._doc.value;return this.changeState({moduleID:e,...t||n&&e!==n.data.id?{docID:0,mode:"list"}:null})}setData(e,t){var r;const{signals:n}=this,s=this.formatData(e,{spaceType:n.spaceType.value,spaceID:n.spaceID.value,libID:n.libID.value,moduleID:n.moduleID.value,docID:n.docID.value});return this.changeState({...s,...t,libTypes:(r=s.libTypes)!=null&&r.length?s.libTypes:n.libTypes.value})}async checkEditingDoc(){if(this._hasEditingDoc.value){const[,e]=this._viewInfo.value;if(e!=null&&e.changed){this.signals.highlightView.value=!0;const t=await Ue.confirm(this.getLang("leaveEditingConfirm","文档编辑中，确定要离开吗？"));if(this.signals.highlightView.value=!1,!t)return!1}await this.changeState({editingDoc:void 0,creatingDoc:void 0,docVersion:0})}return!0}async load(e,t,n,s){if(e=e||this.props.fetcher,e){const{signals:r}=this;t=t||r.spaceType.value,n=n||r.spaceID.value;const{noLoading:o=!1,picks:a=[]}=s||{},l=typeof a=="string"?[a]:a;await this.changeState({loading:!o,spaceType:t,spaceID:n});const c=await zt(e,[{spaceType:t,spaceID:n,picks:l,noSpace:!!this.props.noSpace}],void 0,this);await this.setData(l?{spaces:r.spaces.value,libs:r.libs.value,modules:r.modules.value,docs:r.docs.value,spaceID:r.spaceID.value,libTypes:r.libTypes.value,...c}:c,o?void 0:{loading:!1})}}async loadDoc(e,t,n){n=n||this.props.docFetcher,n||(n=()=>({content:""}));let s=this.getDoc(e);if(!s)return;const r=this._loadingDocs;if(r.has(e))return new Promise(c=>{r.get(e).push(c)});r.set(e,[]),t=t||s.version||0;const o=!t||t===s.version||!s.version,a=await zt(n,[{docID:e,version:t}],void 0,this),l=o?{...s,...a,id:e}:{...s,versions:{...s.versions,[t]:this.formatDataItem("doc",a)}};return s=this.update("doc",l),r.get(e).forEach(c=>c(s)),r.delete(e),s}formatDataItem(e,t,n,s){if(e==="module")t.lib=+(t.lib??t.root),t.parent=+(t.parent??0);else if(e==="lib"){const o=t;o.space=o.space??n,o.space=String(+o.space)===String(o.space)?+o.space:o.space}else e==="space"&&(t.type=t.type??s);if(t.id=String(+t.id)===String(t.id)?+t.id:t.id,t.deleted=typeof t.deleted=="string"?!!JSON.parse(t.deleted):t.deleted,e==="doc"){const o=t;if(o.files){!Array.isArray(o.files)&&typeof o.files=="object"&&(o.files=Object.values(o.files));for(const a of o.files)a.id=+a.id,a.size=+a.size,a.downloads=a.downloads?+a.downloads:0,a.deleted=typeof a.deleted=="string"?!!JSON.parse(a.deleted):a.deleted}o.product=+(o.product??0),o.project=+(o.project??0),o.execution=+(o.execution??0),o.version=+(o.version??0),o.views=+(o.views??0),o.module=+(o.module??0),o.lib=+(o.lib??0),o.collects=+(o.collects??0),!o.collects&&o.isCollector&&(o.collects=1),o.editedBy===o.addedBy&&o.editedDate===o.addedDate&&(delete o.editedBy,delete o.editedDate)}typeof t.order!="number"&&typeof t.id=="number"&&(t.order=t.id);const{formatDataItem:r}=this.props;return r?r.call(this,e,t,n,s):t}formatData(e,t){let{libID:n=0,moduleID:s=0,docID:r,spaceID:o=0}=t;const{spaceType:a}=t,{libs:l=[],modules:c=[],docs:d=[],spaces:u=[],spaceID:p,libTypes:g=[]}=e||{};let b,C,S,x;return p&&(o=+p),l.forEach(D=>{this.formatDataItem("lib",D,p)}),l.sort((D,A)=>D.order-A.order),u.forEach(D=>{this.formatDataItem("space",D,p,a)}),c.forEach(D=>{this.formatDataItem("module",D,p)}),d.forEach(D=>{this.formatDataItem("doc",D,p)}),r?b=d.find(D=>D.id===r):r=0,b&&!s&&(s=b.module),s&&(C=c.find(D=>D.id===s)),n=C?C.lib:n,!n&&this.props.autoSelectLib&&(S=l[0],n=S?S.id:0),n&&(!S||S.id!==n)&&(S=l.find(D=>D.id===n)),o=S?S.space:o,!this.props.noSpace&&u.length&&(x=u.find(D=>D.id===o)),o||(x=u[0],o=x?x.id:o),!o&&l.length&&(o=l[0].space),{spaceType:(x?x.type:a)||"mine",libs:l,modules:c,docs:d,spaces:u,spaceID:o,libID:n,moduleID:s,docID:r,libTypes:g}}batchUpdate(e,t){Yr(()=>{Object.keys(e).forEach(n=>{const s=e[n];this.update(n,s)}),t&&this.changeState(t)})}update(e,t){const n=!Array.isArray(t),s=n?[t]:t,r=this.getDataSignal(e),o=[],a=r.value,l=this.signals.spaceID.value;return s.forEach(c=>{const d=+c.id,u=a.findIndex(g=>g.id===d),p=u>=0?{...a[u],...c}:c;this.formatDataItem(e,p,l),p.deleted?u>=0&&(a[u]=p):u>=0?a[u]=p:a.push(p),o.push(p)}),r.value=[...a],n?o[0]:o}delete(e,t){Array.isArray(t)||(t=[t]);const n=new Set(t);if(!n.size)return!1;const s=this.getDataSignal(e),r=s.value;return!r||!Array.isArray(r)||!r.length?!1:(Yr(()=>{const o=new Set;(e==="module"||e==="lib")&&t.forEach(a=>{const l=e==="module"?this.treeMap.modules.get(a):this.treeMap.libs.get(a);l&&l.docs.forEach(c=>o.add(c.data.id))}),s.value=r.filter(a=>!n.has(a.id)),o.size&&this.delete("doc",[...o])}),!0)}startCreateDoc(e,t,n){e=e??this.signals.libID.value,t=t??this.signals.moduleID.value;const s=this.signals.creatingDoc.value;if(!(s&&s.lib===e&&s.module===t))return this.changeState({creatingDoc:this._getCreatingDoc(n),mode:"create"})}cancelCreateDoc(){return this.changeState({creatingDoc:void 0,mode:"list"})}async saveNewDoc(e){var l,c,d,u,p;await((c=(l=this._viewRef.current)==null?void 0:l.editor)==null?void 0:c.triggerChange());const{signals:t}=this,n=t.creatingDoc.value;if(!n)return;if(n.title.trim()===""){await Ue.alert(this.getLang("docTitleRequired","文档标题不能为空。")),(u=(d=this._viewRef.current)==null?void 0:d.editor)==null||u.focusTitle();return}const s=t.spaceID.value,r=t.libID.value,o=t.moduleID.value,a=await((p=this.props.onCreateDoc)==null?void 0:p.call(this,{...n,status:e||"normal",lib:t.libID.value,module:t.moduleID.value},s,r,o));return a?this.changeState({docs:[...t.docs.value,a],docID:a.id,libID:a.lib,moduleID:a.module,creatingDoc:void 0,mode:"view"}):Ue.alert(this.getLang("saveDocFailed","文档保存失败，请稍后重试"))}async startEditDoc(e){var t;e=e||((t=this._doc.value)==null?void 0:t.data),typeof e=="number"&&(e=this.getDoc(e)),e&&((e.content===void 0||e.content===null)&&(e=await this.loadDoc(e.id),!e)||await this.changeState({docID:e.id,libID:e.lib,moduleID:e.module,editingDoc:{...e,changed:!1},mode:"edit"}))}cancelEditDoc(e){this.changeState({mode:"view",editingDoc:void 0,docVersion:0,...e})}async saveDoc(e){var o,a,l;await((a=(o=this._viewRef.current)==null?void 0:o.editor)==null?void 0:a.triggerChange());const t=this.signals.editingDoc.value;if(!t)return this.cancelEditDoc();const n=this.getDoc(t.id);if(n&&n.title===t.title&&n.content===t.content&&n.keywords===t.keywords)return this.cancelEditDoc();const s={...n,...t,status:e||"normal"},r=await((l=this.props.onSaveDoc)==null?void 0:l.call(this,s));r!==!1&&(r&&r!==!0&&(Object.assign(s,r),this.update("doc",s)),this.cancelEditDoc())}_afterReset(){const{fetcher:e,data:t,mode:n,docID:s}=this.props,r=()=>{n==="edit"&&s?this.startEditDoc(s):n==="create"?this.startCreateDoc():n==="files"&&this.showFiles()};e&&!t?this.load().then(r):r()}componentDidMount(){var e;super.componentDidMount(),this._afterReset(),(e=this.props.onMounted)==null||e.call(this)}componentDidUpdate(e){var o;const{fetcher:t,data:n,spaceID:s,spaceType:r}=this.props;t&&!n&&(e.spaceType!==r||e.spaceID!==s)&&this.load(),(o=this.props.onUpdated)==null||o.call(this)}componentWillUnmount(){var e;this._viewEffect(),(e=this.props.onUnmounted)==null||e.call(this)}_getCreatingDoc(e="doc"){return{id:Sv(),lib:this.signals.libID.value,module:this.signals.moduleID.value,title:"",content:"",contentType:e,addedBy:this.props.currentUser||"",addedDate:ht(new Date,"yyyy-MM-dd HH:mm:ss"),uid:Bo(13).replaceAll("-","_"),order:0}}_getClassName(e){return["doc-app",e.className,this._viewType.value!=="list"?"has-show-view":"",this.signals.fullscreen.value?"is-enter-fullscreen":"",`doc-app-mode-${this.mode}`]}_getProps(e){return{...super._getProps(e),style:{width:Be(e.width),height:Be(e.height)},"data-view":this._viewType.value}}_renderSidebar(e){var l,c;const{libIcon:t,preserve:n,moduleIcon:s,docIcon:r,currentUser:o}=e,a=this.spaceType;return w(Cv,{key:"sidebar",app:this,className:"surface-light",preserve:n?`${n}-sidebar`:void 0,currentUser:o,libIcon:t,moduleIcon:s,docIcon:r,spaceType:a,space:this._space.value,libs:this._libList.value,lib:this._lib.value,libTypes:this.signals.libTypes.value,showFiles:this.signals.mode.value==="files",filesFilterType:this.signals.filesFilterType,moduleID:((l=this._module.value)==null?void 0:l.data.id)||0,docID:((c=this._doc.value)==null?void 0:c.data.id)||0,getActions:this.getItemActions,onSelectDoc:this.selectDoc,onSelectLib:this.selectLib,onShowFiles:this.canShowLibFiles?this.showFiles:void 0})}_renderFiles(){const e=this.renderCustom("files");if(e!==void 0)return e;const{currentUser:t,fileUrl:n,filesFetcher:s,userMap:r}=this.props;return w(Gc,{key:"files",app:this,userMap:r,objectType:this.spaceType,objectID:this.spaceID,filterType:this.signals.filesFilterType.value,currentUser:t,onGetUser:this.getUserInfo,fileUrl:n,searchKeys:this.signals.searchKeys.value,filesFetcher:s})}_renderList(e){var c;if(this.signals.mode.value==="files")return this._renderFiles();const t=this.renderCustom("list");if(t!==void 0)return t;const{libIcon:n,moduleIcon:s,docIcon:r,userMap:o,canMoveDoc:a}=e,l=this.signals.searchKeys.value;return w(wv,{key:"list",app:this,libIcon:n,moduleIcon:s,docIcon:r,userMap:o,searchKeys:l,docs:this._docList.value,onClickDoc:this.selectDoc,canMoveDoc:a,getActions:this.getActions,getTableOptions:this.getTableOptions,orderBy:(c=this._lib.value)==null?void 0:c.data.orderBy})}_renderView(e){const t=this.renderCustom("view");if(t!==void 0)return t;const[n,s]=this._viewInfo.value;if(!s)return null;const{fileIcon:r,fileUrl:o,preserve:a,historyFetcher:l,uploadUrl:c,downloadUrl:d}=e,[u,p]=this._docUsers.value;return w(Lv,{ref:this._viewRef,app:this,key:n,doc:s,mode:n,onChange:this._handleDocChange,fileIcon:r,fileActions:this._getFileActions,fileUrl:o,creator:u,modifier:p,uploadUrl:c,downloadUrl:d,preserve:a?`${a}-view`:void 0,onGetUser:this.getUserInfo,historyFetcher:l,highlight:this.signals.highlightView.value})}_renderMain(e){const t=this._renderView(e);return w("div",{key:"main",className:`doc-main flex-auto relative min-w-0${t?" show-view":""}`},this._renderList(e),t)}_renderSearchBox(e){let t={rootClass:"doc-app-search w-40 ml-1 mr-3",defaultValue:(this.signals.searchKeys.value||[]).join(" "),onChange:this._handleSearch};const{getSearchBoxOptions:n}=this.props;return n&&(t=n.call(this,t,{type:e})),w(ci,{...t})}_renderFilters(){var a;const e=this.renderCustom("filters");if(e!==void 0)return e;const t=this._viewType.value;if(t!=="list"&&t!=="files")return null;const n=this.getFilterTypes(t),s=t==="list",r=s?this.signals.listFilterType.value:this.signals.filesFilterType.value,o=s?(a=this._docList.value)==null?void 0:a.length:0;return w("div",{className:"row items-center flex-auto justify-end"},n.length?w("menu",{className:"nav nav-compact",style:"--nav-active-bg: var(--color-primary-100); --nav-active-color: var(--color-fore); --nav-item-height: 24px; --nav-divider-margin: 8px",onClick:this._handleFilterTypeClick},n.map(([l,c])=>w("li",{key:l,className:"nav-item item"},w("a",{className:l===r?"active rounded-full":"rounded-full","data-type":l,"data-view":t},c,l===r&&o?w("span",{className:"label size-sm canvas ring-0 rounded-full"},o):null)))):null,this._renderSearchBox(t))}_renderToolbar(){var s;const e=this.renderCustom("toolbar");if(e!==void 0)return e;const t=this._viewType.value,n=[];if(t==="list")n.push(...this.getActions("doc-list",{ui:"toolbar"}));else if(t==="view"){const r=(s=this._doc.value)==null?void 0:s.data;r&&(n.push({component:Rv,props:{app:this,users:this._docUsers,createDate:r.addedDate,editDate:r.editedDate}}),r.deleted||n.push(...this.getActions("doc",{ui:"toolbar",data:r})))}else t==="edit"?n.push(...this.getActions("doc-edit",{ui:"toolbar",data:this.signals.editingDoc.value})):t==="create"&&n.push(...this.getActions("doc-create",{ui:"toolbar",data:this.signals.creatingDoc.value}));return w(He,{className:"doc-app-toolbar",gap:2,size:"md",items:n})}_renderHeader(e){const t=this.renderCustom("header");return t!==void 0?t:w("div",{key:"header",class:"doc-app-header surface-light row items-center border-b py-1.5 pl-1 pr-2"},w(Mv,{app:this,spaceIcon:e.spaceIcon,libIcon:e.libIcon,moduleIcon:e.moduleIcon,libFilesIcon:e.libFilesIcon,noSpace:e.noSpace,docIcon:e.docIcon,spaces:this._spaceList.value,space:this._space.value,libs:this._libList.value,lib:this._lib.value,doc:this._doc.value,docVersion:this.signals.docVersion.value,creatingDoc:this.signals.creatingDoc.value,editingDoc:this.signals.editingDoc.value,showFiles:this.signals.mode.value==="files",module:this._module.value,libPlaceholder:"所有库",onSelectDocVersion:this.selectDocVersion,onSelectLib:this.selectLib,onSelectSpace:this.selectSpace,onSelectModule:this.selectModule,onSelectDoc:this.selectDoc,homeName:e.homeName,getSpaceFetcher:e.getSpaceFetcher,spaceType:this.spaceType,spaceID:this.spaceID},this._renderFilters()),this._renderToolbar())}_renderBody(e){return w("div",{key:"body",class:"doc-app-body flex-auto min-h-0 row items-stretch"},this._renderSidebar(e),this._renderMain(e))}_renderHome(){const e=this.renderCustom("home");return e!==void 0?e:w(zv,{ref:this._homeRef,app:this})}_getChildren(e){return this.signals.mode.value==="home"?this._renderHome():this.signals.loading.value?w("div",{key:"loading",class:"doc-loading relative center h-full load-indicator loading tex-gray","data-loading":this.getLang("loadingDocsData","正在加载文档数据...")}):this._space.value?[this._renderHeader(e),this._renderBody(e)]:w("div",{key:"empty-tip",class:"doc-empty-tip center h-full gap-8"},w("div",{className:"relative text-primary"},w(Ie,{icon:"file-alt",className:"opacity-10",style:"font-size: 72px; transform: rotate(-30deg); transform-origin: 0 72px;"}),w(Ie,{icon:"file-alt",className:"opacity-30 absolute left-0 top-0",style:"font-size: 72px; transform: rotate(-15deg); transform-origin: 0 72px;"}),w(Ie,{icon:"file-text",className:"absolute left-0 top-0",style:"font-size: 72px; transform: rotate(0deg); transform-origin: 0 72px;"})),w("div",{className:"text-gray text-lg"},this.getLang("noSpaceTip","这里什么也没有，先创建一个空间再使用吧！")),w(ke,{icon:"plus",text:this.getLang("createSpace","创建空间"),type:"primary",size:"lg"}))}getCustomRender(e){var t;return(t=this.props.customRenders)==null?void 0:t[e]}renderCustom(e,...t){let n=this.getCustomRender(e);if(typeof n=="function"&&(n=n.call(this,...t)),n!==void 0)return w(me,{key:e,content:n,generatorArgs:t,generatorThis:this})}};Xc.NAME="DocApp",Xc.defaultProps={spaceIcon:"docspace",libIcon:"doclib",moduleIcon:"folder-o",docIcon:"doc",libFilesIcon:"annex-lib",fetchOnChangeSpace:!0,preserve:"doc-app",commands:{},showLibFiles:["product","project","execution"],libColors:["secondary","primary","warning","success","special"].map(i=>`var(--color-${i}-500)`)};class ea extends _e{}ea.NAME="DocApp",ea.Component=Xc,ea.register();const PC="",LC="",RC="",OC="",zC="",FC="",jC="",BC="";class Zc extends _e{}Zc.NAME="Dropmenu",Zc.Component=Ws;class up extends ze{init(){const{echarts:e}=window;if(!e){console.warn("ZUI: ECharts is not loaded.");return}const{responsive:t=!0,theme:n,...s}=this.options,r=e.init(this.element,n);r.setOption(s),t&&y(window).on(`resize.${this.gid}.ECharts.zt`,r.resize),this.chart=r}destroy(){var n;const{echarts:e}=window;if(!e){super.destroy();return}const{responsive:t=!0}=this.options;t&&y(window).off(`resize.${this.gid}.ECharts.zt`),(n=this.chart)==null||n.dispose(),super.destroy()}}up.NAME="ECharts";const HC="";let Jc=class extends _e{};Jc.NAME="FileList",Jc.Component=Yo;const WC="",dp=i=>i.replace(/([[\]])/g,"\\$1");class ta extends ze{constructor(){super(...arguments),this._disabled=!1,this._timer=0}init(){this.$element.on("submit",this.onSubmit.bind(this)).on("input mousedown change",this.onInput.bind(this))}enable(e=!0,t=0){if(this._resetTimer(),t){this._timer=window.setTimeout(()=>{this.enable(e),this._timer=0},t);return}this.$element.toggleClass("loading",!e),this.$element.find('.btn-submit,button[type="submit"]').toggleClass("disabled",!e).prop("disabled",!e),this._disabled=!e}disable(){this.enable(!1)}onInput(e){const t=y(e.target).closest(".has-error");if(!t.length)return;let n=t.attr("name");n||(n=t.find(".pick-value").attr("name"));const s=n?`#${n.split("[")[0]}Tip,#${dp(n)}Tip`:".form-tip";t.removeClass("has-error"),t.closest(".form-group,.form-batch-control").find(s).remove()}onSubmit(e){var o;if(e.preventDefault(),this._disabled)return;const{element:t}=this,n=y.extend({},this.options);this.emit("before",e,t,n);const s=()=>{this.$element.find(".ajax-form-tip").each(function(){const l=y(this);l.closest(".form-group,.form-batch-control").find(".has-error").removeClass("has-error"),l.remove()}),this.disable();const a=this._processData();this._send(a)},r=(o=n.beforeSubmit)==null?void 0:o.call(n,e,t,n);if(r!==!1){if(r instanceof Promise){r.then(a=>a&&s());return}s()}}submit(){this.element.submit()}reset(){this.element.reset()}destroy(){this._resetTimer()}_resetTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=0)}_processData(){const{$element:e,options:t}=this;let n=new FormData(this.element),{submitEmptySelectValue:s="",submitNoValueChecks:r}=t;const{submitDisabledValue:o=!0}=t;s!==!1&&(typeof s!="boolean"&&(s=""),e.find("select").each((l,c)=>{const d=y(c),u=d.attr("name");d.is("[disabled]")&&!o||n.has(u)||n.append(u,typeof s=="object"?s[u]:s)})),o&&e.find("[disabled][name]").each((l,c)=>{const d=y(c);if(d.hasClass("not-submit-disabled-value"))return;const u=d.attr("name");n.has(u)||n.append(u,d.val())}),r&&(r=typeof r=="string"?r:"",e.find('[type="checkbox"],[type="radio"]').not(":checked").each((l,c)=>{const d=y(c),u=d.attr("name");n.has(u)||d.is("[disabled]")&&!o||n.append(u,d.data("notCheckedValue")??r)}));const{beforeSend:a}=t;if(a){const l=a(n);l instanceof FormData&&(n=l)}return this.emit("send",n),n}_send(e){const{$element:t,options:n}=this;let s,r;const o=n.url||t.attr("action"),a={method:t.attr("method")||"POST",data:e,headers:t.closest(".modal").length?{"X-ZUI-Modal":"true"}:void 0,dataType:"json",jsonParser:JSON.parse},{optionsModifiers:l}=this.constructor;l.length&&l.forEach(d=>{const u=d.call(this,a);u&&u!==a&&y.extend(!0,a,u)});const c=y.ajax(o,a).success((d,u,p)=>{var g,b,C;d instanceof Blob?(jr(d,(C=(b=(g=p.headers.get("Content-Disposition"))==null?void 0:g.split(";")[1])==null?void 0:b.split("=")[1])==null?void 0:C.replace(/"/g,"")),r={result:"success"}):(r=d,(!r||typeof r!="object")&&(s=new Error("Invalid json format")))}).fail(d=>{s=d}).complete(()=>{var d,u;if(s)this.emit("error",s),console.warn("ZUI: send ajax form failed",s),n.onError?n.onError(s):Ue.showError({size:"lg",error:[`<b>POST:</b> ${o}`,`<b>Error:</b> ${s.message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}`,`<b>Response:</b> ${c.data}`].join("<br>")});else{const p=(d=n.onResult)==null?void 0:d.call(this,r);if(p===!1)return;p&&(r=y.extend(r,p)),this._handleResult(r)}this.emit("complete",r,s),(u=n.onComplete)==null||u.call(n,r,s),this.enable(!0,s||(r==null?void 0:r.result)!=="success"?0:5e3)})}_showValidateMessage(e){var n;let t;Object.entries(e).forEach(([s,r])=>{Array.isArray(r)&&(r=r.join(""));const o=dp(s),{$element:a}=this;let l=a.find(`#${o}`);if(l.length||(l=a.find(`[name="${o}"]`)),!l.length&&!s.includes("[")&&(l=a.find(`[name="${o}[]"]`)),!l.length){Ue.alert(r);return}l.hasClass("pick-value")&&(l=l.closest(".pick")),l.addClass("has-error");const c=l.closest(".form-group,.form-batch-control,td");if(c.length){let d=c.find(`#${o}Tip`);d.length||(d=y(`<div class="form-tip ajax-form-tip text-danger pre-line" id="${s}Tip"></div>`).appendTo(c)),d.empty().text(r)}else Ue.alert(r);t||(t=l)}),t&&((n=t[0])==null||n.focus())}_handleResult(e){var l,c;const{options:t}=this,{message:n}=e,s=e.result==="success";if(s){if(this.emit("success",e),((l=t.onSuccess)==null?void 0:l.call(t,e))===!1)return;typeof n=="string"&&n.length&&An.show({content:n,type:"success"})}else{if(this.emit("fail",e),((c=t.onFail)==null?void 0:c.call(t,e))===!1)return;n&&(typeof n=="string"&&n.length?Ue.alert(n):typeof n=="object"&&this._showValidateMessage(n))}const r=t.closeModal??e.closeModal;r&&(r!=="onlySuccess"||s)&&Ue.hide(typeof r=="string"&&r!=="onlySuccess"?r:void 0);const o=t.callback??e.callback;if(o){const d=[["options",t],["result",e]];if(typeof o=="string"){const u=y.runJS(o,...d);typeof u=="function"&&!o.endsWith(";")&&u(e)}else if(typeof o=="object"){const u=y.runJS(o.name,...d);typeof u=="function"&&u.apply(this,Array.isArray(o.params)?o.params:[o.params])}}const a=t.load??e.load??e.locate;a&&this.$element.trigger("locate.zt",a)}}ta.NAME="AjaxForm",ta.optionsModifiers=[];function eh(i,e){var a,l;const t=i.result==="success";if(t){if(((a=e.onSuccess)==null?void 0:a.call(e,i))===!1)return}else if(((l=e.onFail)==null?void 0:l.call(e,i))===!1)return;const{message:n}=i;n&&(e.onMessage?e.onMessage(n,i):typeof n=="string"&&n.length&&(t?An.show({content:n,type:"success"}):Ue.alert(n)));const s=e.closeModal??i.closeModal;s&&Ue.hide(typeof s=="string"?s:void 0);const r=e.callback??i.callback;if(r){const c=[["options",e],["result",i]];if(typeof r=="string"){const d=y.runJS(r,...c);typeof d=="function"&&!r.endsWith(";")&&d(i)}else if(typeof r=="object"){const d=y.runJS(r.name,...c);typeof d=="function"&&d.apply(null,Array.isArray(r.params)?r.params:[r.params])}}const o=e.load??i.load??i.locate;o&&y(e.element||document).trigger("locate.zt",o)}function fp(i){return typeof i=="string"&&(i=i.split(",").reduce((e,t)=>{const[n,s]=t.trim().split(":");return e[n.trim()]=s.trim(),e},{})),Object.keys(i).reduce((e,t)=>{const n=t.endsWith("?"),s=n?t.substring(0):t;let r=i[s];if(typeof r=="string"){const[o,a]=r.split("~"),l=y(o);if(!l.length)return e;a==="checkedIDList"?r=l.closest("[data-zui-dtable]").dtable("getChecks"):l[0].hasAttribute("data-map-value")?r=l.dataset("mapValue"):l.closest(".pick").length?r=l.closest(".pick").find(".pick-value").val():l.is("input,select,textarea")?r=l.val():r=l.text()}return(n||r!=null&&r!==""&&(!Array.isArray(r)||r.length))&&(e[s]=r),e},{})}async function pi(i){if(i.confirm)return await Ue.confirm(i.confirm)?pi({...i,confirm:void 0}):[void 0,new Error("canceled")];if(i={...ta.DEFAULT,...i},i.beforeSubmit&&await i.beforeSubmit(i)===!1)return[void 0,new Error("canceled")];const{loadingClass:e,element:t}=i;t&&e&&y(t).addClass(e);const{data:n,dataMap:s}=i;let r;n&&(r=Mr(n)),s&&(r=Mr(fp(s),r));const{beforeSend:o}=i;if(o){const d=o(r);d instanceof FormData&&(r=d)}let a,l;return await new ps({url:i.url,method:i.method||"POST",body:r,headers:i.headers,dataType:"json"}).success(d=>{l=d,(!l||typeof l!="object")&&(a=new Error("Invalid json format"))}).fail(d=>{a=d,console.warn("ZUI: cannot submit ajax form",d)}).complete(()=>{var d,u,p;if(a)(d=i.onError)==null||d.call(i,a);else{const g=(u=i.onResult)==null?void 0:u.call(null,l);if(g===!1)return;g&&(l=y.extend(l,g)),eh(l,i)}(p=i.onComplete)==null||p.call(i,l,a),t&&e&&y(t).removeClass(e)}).send(),[l,a]}y.extend(y,{ajaxSubmit:pi}),y(document).on("click.ajaxSubmit.zui",".ajax-submit",function(i){i.preventDefault();const e=y(this);if(e.is("[disabled],.disabled"))return;const t=e.data();!t.url&&e.is("a")&&(t.url=e.attr("href")||""),t.url&&(t.element=this[0],pi(t))});class Fv extends pe{constructor(e){super(e),this.state={pinnedList:e.pinnedList||[]}}_handlePinnedChange(e){const{pinnedList:t}=this.state;t.includes(e)?t.splice(t.indexOf(e),1):t.push(e),this.setState({pinnedList:t})}_handleSave(){var e,t;(t=(e=this.props).onSave)==null||t.call(e,this.state.pinnedList)}render(e,t){const{tip:n,items:s,saveText:r=Ne.getLang("save"),resetText:o=Ne.getLang("reset"),cancelText:a=Ne.getLang("cancel"),pinnedIcon:l="pinned",unpinnedIcon:c="unpinned"}=e,{pinnedList:d}=t,u=new Set(d);return w("form",{className:"form-setting-form w-80 col gap-3"},w("div",{className:"text-gray mt-2"},n),w("div",{className:"divider opacity-5"}),w("div",{className:"row flex-wrap"},s.map(({text:p,value:g})=>{const b=u.has(g);return w("label",{className:"state size-sm ghost w-1/2 pl-1 pr-2 py-1 flex flex-nowrap gap-2 items-center rounded",onClick:this._handlePinnedChange.bind(this,g)},w(Ie,{icon:b?l:c,className:b?"text-primary":"text-gray-400"}),w("div",{className:`flex-auto text-clip${b?"":" text-gray"}`},p))})),w("div",{className:"row flex-nowrap gap-4 mt-2"},w(ke,{size:"md",className:"btn-wide",type:"primary",onClick:this._handleSave.bind(this)},r),w(ke,{size:"md",className:"btn-wide","data-dismiss":"popover"},a),w(ke,{size:"md",type:"primary-ghost",disabled:!d.length,onClick:()=>this.setState({pinnedList:[]})},o)))}}class pp extends Et{_getFormItems(){const e=this.$element.closest("form"),t=[],n=[];return e.find(".form-group.is-foldable[data-name]").each((s,r)=>{if(y(r).hasClass("hidden"))return;const o=y(r),a=o.data("name"),l=o.find(".form-label").first();let c=o.data("label");if(c===void 0){const d=l.find(".text");d.length&&(c=d.text())}c===void 0&&(c=l.text().trim()),t.push({value:a,text:c||a}),o.hasClass("is-pinned")&&n.push(a)}),{items:t,pinnedList:n}}_handleSave(e){const{customUrl:t,onSave:n}=this.options,s=()=>{(n==null?void 0:n(e))!==!1&&this.hide();const r=this.$element.closest("form");r.find(".form-group.is-foldable[data-name]").each((o,a)=>{const l=y(a),c=l.data("name");l.toggleClass("is-pinned",e.includes(c))}),r.toggleClass("no-foldable-items",!r.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)};t?pi({url:t,data:{"fields[]":e},onSuccess:r=>{delete r.callback,s()}}):s()}_getRenderOptions(){const{title:e,tip:t,className:n,saveText:s,resetText:r,cancelText:o}=this.options,{items:a,pinnedList:l}=this._getFormItems();return{...super._getRenderOptions(),title:e,headingClass:"popover-heading transparent px-4 pt-4",contentClass:"px-4 pb-4",titleClass:"text-lg font-bold",content:w(Fv,{tip:t,saveText:s,resetText:r,cancelText:o,items:a,pinnedList:l,onSave:this._handleSave.bind(this),onCancel:this.hide.bind(this)}),className:V("form-setting-popover",n)}}}pp.NAME="FormSetting";class mp extends ze{get mode(){return this.$container.hasClass("is-full")?"full":"lite"}get shownFoldItems(){return this.$container.hasClass("show-fold-items")}get $container(){let e=this._$container;if(!e){const{$element:t}=this;e=t.closest(".panel-form,.page-form"),e.length||(e=t),this._$container=e}return e}afterInit(){super.afterInit();const e=[],{$element:t}=this;t.children(".form-group[data-name]").each((a,l)=>{e.push(y(l).attr("data-name"))}),this._fields=e;const{fullModeOrders:n}=this.options;this._fullModefields=typeof n=="string"?[n]:n;let{preserve:s}=this.options;(s===!0||s===void 0)&&(s=t.attr("id")),this._preserveID=s||!1;const r=this.options.mode||(this._preserveID?Ze.get(`FormGrid:${this._preserveID}:mode`,this.mode):this.mode);this.toggleMode(r,!1,!0);const{namespace:o}=this;this.$container.on(`click${o}`,".btn-full-form",()=>this.toggleMode("full")).on(`click${o}`,".btn-lite-form",()=>this.toggleMode("lite")).on(`click${o}`,".btn-toggle-fold",()=>this.toggleFold()),t.on(`change${o}`,"[name]",this._handleChange.bind(this)),t.toggleClass("no-foldable-items",!t.find(".form-group.is-foldable").not(".is-pinned,.hidden").length)}getField(e){const{$element:t}=this;let n=t.children(`.form-group[data-name="${e}"]`);if(!n.length)return;const s=t.children(`[data-wrap-before="${e}"]`),r=t.children(`[data-wrap-after="${e}"]`);let o=y();return s.length&&(o=o.add(s)),n.find("script").remove(),n=t.children(`.form-group[data-name="${e}"]`),o=o.add(n),r.length&&(o=o.add(r)),{name:e,wrapBefore:!!s.length,wrapAfter:!!r.length,foldable:n.hasClass("is-foldable"),$ele:n,$group:o}}destroy(){super.destroy(),this.$container.off(this.namespace)}toggleFold(e){e=e??!this.shownFoldItems,this.$container.toggleClass("show-fold-items",e)}openSetting(){this.$container.find(".btn-custom-form").trigger("click")}toggleMode(e,t,n){const s=this.mode;e=e||(s==="full"?"lite":"full"),!(s===e&&!t)&&(this.$container.toggleClass("is-full",e==="full").toggleClass("is-lite",e==="lite"),!n&&this._preserveID&&Ze.set(`FormGrid:${this._preserveID}:mode`,e),this.updateOrders())}updateOrders(e,t){e&&(this._fields=e),t&&(this._fullModefields=typeof t=="string"?[t]:t);const{mode:n}=this;n==="full"?(t=this._fullModefields,Array.isArray(t)&&t.forEach(s=>{this.sortFields(s)})):this.sortFields()}sortFields(e){e=e||this._fields,typeof e=="string"&&(e=e.split(","));let t;e.forEach(r=>{const o=this.getField(r);if(o){if(t){const a=t.$group.last();if(o.$group.first()[0]===a[0])return;o.$group.insertAfter(a)}t=o}});const n=this.$element.children(".form-group.is-foldable").first(),s=this.$element.children(`[data-wrap-before="${n.attr("data-name")}"]`);this.$element.children(".panel-form-divider").insertBefore(s.length?s:n)}_handleChange(e){const{autoLoad:t,loadUrl:n}=this.options;if(!t)return;const s=y(e.target).closest("[name]");Object.keys(t).forEach(r=>{const o=t[r];".[#".includes(r[0])||(r=`[name="${r}"]`),s.closest(r).length&&window.loadForm(y.extend({url:n,target:s},typeof o=="string"?{items:o}:o))})}}mp.NAME="FormGrid";const UC="";class gp extends ze{init(){const{initGantt:e}=this.options;typeof e=="function"&&e()}destroy(){const{destroyGantt:e}=this.options;typeof e=="function"&&e(),super.destroy()}}gp.NAME="Gantt";const VC="";Xe(uv);const KC="";let yp=class extends rt{constructor(){super(...arguments),this._searchBox=fe(),this._menu=fe(),this._handleChange=e=>{this.setState({value:e.trim()})},this._handleFocus=()=>{this.toggle(!0)},this._handleEenter=()=>{var t;const e=(t=this._menu.current)==null?void 0:t.getActiveKey();e&&this.search(e)},this._handleClickItem=e=>{this.search(e.item.key)}}search(e){var t,n;(t=this.props.onSearch)==null||t.call(this,e,this.state.value),this.toggle(!1,{value:""}),(n=this._searchBox.current)==null||n.blur()}componentDidUpdate(e,t){var s;super.componentDidUpdate(e,t);const n=this._menu.current;this.state.open&&n&&n.getActiveKey()===void 0&&((s=this._menu.current)==null||s.activeNext())}_getHotkeys(){return this._hotkeys||(this._hotkeys={activeNext:{keys:"ArrowDown",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activeNext()}},activePrev:{keys:"ArrowUp",handler:()=>{var e;return(e=this._menu.current)==null?void 0:e.activePrev()}},enter:!0}),this._hotkeys}_renderTrigger(e){return w(ci,{delay:0,ref:this._searchBox,placeholder:e.searchHint,onChange:this._handleChange,onFocus:this._handleFocus,hotkeys:this._getHotkeys(),onEnter:this._handleEenter,...e.searchBox})}_getItems(e,t){var p;const{items:n}=e,{value:s}=t,r=Number.isInteger(+s),o=(p=e.getSearchType)==null?void 0:p.call(this,s),a=[],l=n.reduce((g,b)=>(g.set(b.key,b),g),new Map),c="search",d=g=>{var b;return{html:((b=g.text)==null?void 0:b.replace("{0}",s))??s}};if(o&&r){const g=l.get(o);g&&a.push({...g,className:V(g.className,"w-full"),text:d(g)})}const u=l.get(c);return a.push({...u,className:V(u==null?void 0:u.className,"w-full"),text:u?d(u):s}),r&&n.forEach(g=>{g.key===c||g.key===o||a.push({...g,className:V(g.className,"w-1/2"),text:d(g)})}),a}_renderPop(e,t){return w(xt,{className:"row flex-wrap overflow-auto scrollbar-hover",items:this._getItems(e,t),onClickItem:this._handleClickItem,ref:this._menu,activeOnHover:!0,...e.menu})}};yp.defaultProps={...rt.defaultProps,pickerName:"global-search",hidePopWhenEmpty:!0};class na extends _e{}na.NAME="GlobalSearch",na.Component=yp,na.replace=!0;function jv(i,e=1e3){let t=null;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>{i(...n),t=null},e)}}const _p=class og extends ze{static async loadModule(){return this.Module||(this.Module=await y.getLib("g6")),this.Module}async afterInit(){const e=await og.loadModule();if(this.destroyed)return;const{type:t="TreeGraph",width:n=this.$element.width(),height:s=this.$element.height()||500,responsive:r=!1,data:o,nodeFn:a,edgeFn:l,comboFn:c,...d}=this.options,u=new e[t]({container:this.element,width:n,height:s,...d});a&&u.node(a),l&&u.edge(l),c&&u.combo(c),u.data(o),u.render(),this.instance=u,r&&this.initResizeObserver()}initResizeObserver(){const e=jv(()=>{this.instance.changeSize(this.$element.width(),this.$element.height()),this.instance.render()},500);this.resizeObserver=new ResizeObserver(()=>{e()}),this.resizeObserver.observe(this.element)}destroy(){var e;this.options.responsive&&((e=this.resizeObserver)==null||e.disconnect()),this.instance.destroy(),super.destroy()}};_p.NAME="Graph";let vp=_p;y.registerLib("g6",{src:"graph/g6.min.js",check:"G6"}),vp.register();class Vs extends _e{static update(e){y.trigger("load.HistoryPanel",e)}}Vs.NAME="HistoryPanel",Vs.Component=Qc,Vs.replace=!0,Vs.register();function th(i){const{objectType:e,objectID:t,actionID:n,url:s,...r}=i;let o=s;return!o&&(n||e&&t)&&(o=yn("action",n?"editComment":"comment",n?`actionID=${n}`:`objectType=${e}&objectID=${t}`)),Ue.open({id:`modal-comment-${n?`edit-${n}`:`${e}-${t}`}`,url:o,hideOthers:!1,...r})}y(document).on("click.zt",'[data-toggle="comment"]',i=>{i.preventDefault();const e=y(i.currentTarget);if(e.is(".disabled,:disabled"))return;const t=e.data();if(e.is("a")){const n=e.attr("href");n&&(t.url=n)}t.objectId?(t.objectID=+t.objectId,delete t.objectId):t.actionId&&(t.actionID=+t.actionId,delete t.actionId),delete t.toggle,th(t)}),Object.assign(Ue,{comment:th});const qC="",GC="";class nh extends ze{init(){this.clipWidth=this.options.defaultWidth,this.clipHeight=this.options.defaultHeight,this.initDom(),this.initSize(),this.bindEvents()}initDom(){this.$canvas=this.$element.find(".canvas"),this.$img=this.$canvas.find("img"),this.$btn=this.$element.find("button");const e=this.$img.prop("src"),{coverColor:t,coverOpacity:n}=this.options;this.$canvas.append([`<div class="cover" style="background: ${t}; opacity: ${n};"></div>`,`<div class="controller" style="width: ${this.clipWidth}px; height: ${this.clipHeight}px">`,["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"].map(s=>`<div class="control" data-type="${s}"></div>`).join(""),"</div>",'<div class="cliper">',`<img src="${e}"/>`,"</div>"].join("")),this.$controller=this.$canvas.find(".controller"),this.$cliper=this.$canvas.find(".cliper"),this.$chipImg=this.$cliper.find("img")}resetImage(e){this.$img.prop("src",e),this.$chipImg.prop("src",e),this.imgWidth=0,this.left=-1,this.initSize()}initSize(){const{minWidth:e,minHeight:t,ready:n,onSizeError:s}=this.options;if(this.imgWidth)return;const r=a=>{this.imgWidth=a.width,this.imgHeight=a.height,(a.width<e||a.height<t)&&(s==null||s({width:a.width,height:a.height}),this.options.minWidth=Math.min(a.width,e),this.options.minHeight=Math.min(a.height,t)),n==null||n(),this.width=Math.min(this.imgWidth,this.$element.width()),this.$canvas.css("width",this.width),this.height=this.$canvas.height(),(this.left===void 0||this.left<0)&&(this.left=Math.floor((this.width-this.$controller.width())/2),this.top=Math.floor((this.height-this.$controller.height())/2)),this.refreshSize()},o=this.$img[0];o.complete?r(o):o.onload=()=>{r(o)}}refreshSize(e){const{minWidth:t,minHeight:n,fixedRatio:s,defaultWidth:r,defaultHeight:o}=this.options;this.clipWidth=Math.max(t,Math.min(this.width,this.clipWidth)),this.clipHeight=Math.max(n,Math.min(this.height,this.clipHeight)),s&&(e&&e==="height"?(this.clipWidth=Math.max(t,Math.min(this.width,this.clipHeight*r/o)),this.clipHeight=this.clipWidth*o/r):(this.clipHeight=Math.max(n,Math.min(this.height,this.clipWidth*o/r)),this.clipWidth=this.clipHeight*r/o)),this.left=Math.min(this.width-this.clipWidth,Math.max(0,this.left)),this.top=Math.min(this.height-this.clipHeight,Math.max(0,this.top)),this.right=this.left+this.clipWidth,this.bottom=this.top+this.clipHeight,this.$controller.css({left:this.left,top:this.top,width:this.clipWidth,height:this.clipHeight}),this.$cliper.css("clip",`rect(${this.top}px, ${this.left+this.clipWidth}px, ${this.top+this.clipHeight}px, ${this.left}px)`)}getData(){return{originWidth:this.imgWidth,originHeight:this.imgHeight,scaleWidth:this.width,scaleHeight:this.height,width:this.right-this.left,height:this.bottom-this.top,left:this.left,top:this.top,right:this.right,bottom:this.bottom,scaled:this.imgWidth!==this.width||this.imgHeight!==this.height}}bindEvents(){this.$element.on("resize",this.initSize.bind(this)),this.$btn.on("click",e=>{var t,n;(n=(t=this.options).handleBtnClick)==null||n.call(t,e,this.getData())}),this.moveable=new Ns(this.$controller,{selector:".control,.controller",move:!1,onMoveStart:()=>{this.startLeft=this.left,this.startTop=this.top,this.startClipWidth=this.clipWidth,this.startClipHeight=this.clipHeight},onMove:(e,t)=>{const n=y(t.target);if(n.is(".controller"))this.left=this.startLeft+t.deltaX,this.top=this.startTop+t.deltaY,this.refreshSize();else{const s=n.data("type");let r=!1;const{minWidth:o,minHeight:a}=this.options;switch(s){case"left":case"top-left":case"bottom-left":this.left=Math.min(this.right-o,Math.max(0,this.startLeft+t.deltaX)),this.clipWidth=this.right-this.left;break;case"right":case"top-right":case"bottom-right":this.clipWidth=Math.min(this.width-this.left,Math.max(o,this.startClipWidth+t.deltaX));break}switch(s){case"top":case"top-left":case"top-right":this.top=Math.min(this.bottom-a,Math.max(0,this.startTop+t.deltaY)),this.clipHeight=this.bottom-this.top,r=!0;break;case"bottom":case"bottom-left":case"bottom-right":this.clipHeight=Math.min(this.height-this.top,Math.max(a,this.startClipHeight+t.deltaY)),r=!0;break}this.refreshSize(r)}}})}destroy(){var e;(e=this.moveable)==null||e.destroy(),super.destroy()}}nh.NAME="ImgCutter",nh.DEFAULT={coverColor:"#000",coverOpacity:.6,defaultWidth:128,defaultHeight:128,minWidth:48,minHeight:48,fixedRatio:!0};const mi=class{static get images(){var e;return(e=this.Module)==null?void 0:e.images}static async loadModule(){return this.Module||(this.Module=await y.getLib("mammoth")),this.Module}};mi.convertToHtml=async function(i,e){const{convertToHtml:t}=await mi.loadModule();return t(i,e)},mi.extractRawText=async function(i){const{extractRawText:e}=await mi.loadModule();return e(i)},mi.embedStyleMap=async function(i,e){const{embedStyleMap:t}=await mi.loadModule();return t(i,e)};let Bv=mi;y.registerLib("mammoth",{src:["mammoth/mammoth.browser.min.js"],check:"mammoth",type:"module"});const YC="";Object.assign(An.TypeOptions,{success:{key:"zt-messager-success",icon:"check-circle",type:"success",close:!1},danger:{icon:"exclamation-sign",type:"danger",close:!1}}),Object.assign(An,{success(i){return An.show(i,"success")},fail(i){return An.show(i,"danger")}}),Object.assign(An.DEFAULT,{time:3e3,className:"messager-lite"});const QC="";function Hv(i){return Ue.confirm({iconClass:"warning rounded-full center w-8 h-8 flex-none",type:"custom",custom:{className:"modal-reconfirm",closeBtn:!1},...i})}async function Wv(i){const{sortable:e={},onSort:t,items:n,itemProps:s={icon:"move muted",innerClass:"border rounded px-2 canvas cursor-move hover:shadow"},list:r,header:o,message:a,footer:l,...c}=i;let d;const u=(g,b)=>{d=b,t==null||t(g,b)};if(await Ue.confirm({type:"custom",content:w("div",{className:"modal-body sort-view col gap-2"},w(me,{className:"sort-view-header",content:o}),w(me,{className:"sort-view-message muted",content:a}),w(Ms,{className:"space-y-2",sortable:e,items:n,itemProps:s,onSort:u,...r}),w(me,{className:"sort-view-footer",content:l})),...c}))return d}Ne.addLang({zh_cn:{occurredError:"发生了错误"},zh_tw:{occurredError:"發生了錯誤"},en:{occurredError:"An error occurred"}});async function Uv(i){const{title:e,mono:t,html:n=!0,copyBtn:s=!0,basePath:r,contentClass:o,error:a,...l}=i;let c=typeof a=="string"?a:(a==null?void 0:a.message)??"",d=t,u=e;n&&(r&&(c=c.split(r).join('<i class="icon icon-file-text opacity-50"></i>/')),c.startsWith(`<br />
`)&&(c=c.replace(`<br />
`,"")),c.startsWith("<!DOCTYPE html")&&(d===void 0&&(d=!1),u===void 0&&(u=y(c).filter("title").text())));const p=fe();return await Ue.confirm({title:u??Ne.getLang("occurredError"),message:"",type:"custom",custom:{className:"backdrop-blur border-2 border-canvas bg-opacity-80 rounded-xl",headerClass:"text-danger"},content:w("div",{ref:p,className:V("modal-body",d!==!1?" font-mono":"",o),style:{whiteSpace:d!==!1?"pre-line":"normal"},dangerouslySetInnerHTML:{__html:c}}),actions:[s?{key:"confirm",text:typeof s=="string"?s:Ne.getLang("copy"),icon:"copy",onClick:()=>{const b=p.current;if(navigator.clipboard)navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([b.innerText],{type:"text/plain"}),"text/html":new Blob([b.innerHTML],{type:"text/html"})})]);else{const C=document.createRange();C.selectNode(b),window.getSelection().removeAllRanges(),window.getSelection().addRange(C),document.execCommand("copy"),window.getSelection().removeAllRanges()}}}:null,{key:"cancel",text:Ne.getLang("close")}].filter(Boolean),...l})}Object.assign(Ue,{reconfirm:Hv,sortView:Wv,showError:Uv}),Ue.DEFAULT.backdrop="static",Ue.DEFAULT.request={dataFilter:i=>{if(i[0]==="{")try{const e=JSON.parse(i);if(e.result)return eh(e,{closeModal:!0}),setTimeout(()=>{y(".modal").each(function(){const t=y(this);t.text().trim().length||t.modal("hide")})},200),""}catch{}return i}},mc.defaultProps.iframeBodyClass="body-modal";function bp({pri:i="",text:e,className:t}){return i=`${i}`.trim(),e===void 0&&(e=i==="0"||i===""?"":i),w("span",{className:V(`pri-${i}`,t)},e)}let Ks=class extends rt{constructor(){super(...arguments),this._handleClearBtnClick=e=>{this.setValue(""),e.preventDefault()}}getDefaultState(e){const t=super.getDefaultState(e);if(t.value===void 0&&(e||this.props).required){const n=this._getItems().shift();n&&(t.value=n.value)}return t}_getTriggerProps(e,t){const n=super._getTriggerProps(e,t);return e.disabled&&(n.className=V(n.className,"disabled")),n}_renderTrigger(e,t){var l;const{value:n}=t,{placeholder:s,required:r}=e,o=n===void 0||n==="",a=!o&&!r;return[w("div",{className:"text"},o?w("span",{class:"placeholder"},s):this._renderItem(t.value,(l=this._getItems().find(({value:c})=>c===n))==null?void 0:l.text,"pri")),a?w(ke,{type:"button",class:"btn square btn-close size-xs ghost rounded-full",onClick:this._handleClearBtnClick},w("span",{class:"close"})):null,a?null:w("span",{key:"caret",class:"caret"})]}_getItems(){let{items:e=["",1,2,3,4]}=this.props;return Array.isArray(e)?e=e.map((t,n)=>typeof t=="object"?t:t?{text:`${t}`,value:`${n}`}:{text:"",value:""}):typeof e=="object"&&(e=Object.keys(e).map(t=>({value:t,text:e[t]}))),e=e.filter(({value:t})=>t!==""),e.sort((t,n)=>+t.value-+n.value),e}_renderItem(e,t,n){return w(bp,{key:n,pri:e,text:t})}_renderPop(){const{value:e}=this.state;return w("div",{className:"pick-pri-list"},this._getItems().map(({value:t,text:n})=>w("button",{key:t,type:"button",class:`btn w-full ${e===t?"primary-pale":"ghost"}`,"data-pick-value":t},this._renderItem(t,n))))}};Ks.defaultProps={...rt.defaultProps,items:["",1,2,3,4],className:"pick-pri form-control",popClass:"pick-pri-pop popup",popWidth:"auto",popMinWidth:56};function wp({severity:i="",text:e,className:t}){i=`${i}`.trim(),e===void 0&&(e=i==="0"||i===""?"":i);const n=`${+e}`!=`${i}`;return w("span",{className:V(`severity${n?" severity-label":""}`,t),"data-severity":i},n?e:"")}let ih=class extends Ks{_renderItem(e,t,n){return w(wp,{key:n,severity:e,text:t})}};ih.defaultProps={...Ks.defaultProps,items:["",1,2,3,4]};class sh extends _e{}sh.NAME="PriPicker",sh.Component=Ks;class rh extends _e{}rh.NAME="SeverityPicker",rh.Component=ih;const XC="",ZC="";let Cp=class extends Fe{constructor(e){super(e),this._syncPickerData=()=>{const n=this.getFormData();y(this.element).find(".pick-value[name]").each((s,r)=>{const o=y(r),a=o.attr("name"),l=n[a];o.val(l).trigger("syncValue")})},this._handleDeleteQueryClick=(n,s)=>{s.stopPropagation(),this.deleteQuery(n)},this._handleChange=n=>{const s=y(n.target),r=s.attr("name");r&&this.changeData(r,s.val())},this._handleSubmit=n=>{n.preventDefault(),this.submit()};const{setting:t}=e;this.state={showQueryPanel:!1,setting:t&&t.conditions?t:void 0},this.submit=this.submit.bind(this),this.reset=this.reset.bind(this)}get showMore(){var e;return this.state.more??((e=this.state.setting)==null?void 0:e.more)}get isShow(){return this.state.show??this.props.show}get loaded(){return!!this.state.setting}get groupItemCount(){var e;return((e=this.state.setting)==null?void 0:e.groupItemCount)||3}componentDidMount(){this.props.show&&this.show(),y.on("update.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.load(t.reset??!0)}),y.on("addQuery.SearchForm.zt",(e,t)=>{t&&t.module===this.props.module&&this.addQuery(t.id,t.text)})}componentDidUpdate(e,t){const{container:n}=this.props;if(n){const s=y(n),r=this.state.show!==t.show;r&&s.toggleClass("show-search-form",this.state.show),(r||this.state.more!==t.more)&&s.trigger("layout.SearchForm.zt",this)}}componentWillUnmount(){y.off(".SearchForm.zt")}async load(e){if(this.state.loading)return;await this.changeState({loading:!0,...e?{data:void 0}:null});const t=this.props.url||yn("search","buildForm",`module=${this.props.module}`);try{const n=await zt(t);await this.changeState({setting:n,loading:!1,clickedReset:!1})}catch{await this.changeState({loading:!1,clickedReset:!1})}e&&this._syncPickerData()}async show(){await this.changeState({show:!0}),this.loaded||await this.load()}toggleQueryPanel(e){return e===void 0&&(e=!this.state.showQueryPanel),this.changeState({showQueryPanel:e})}toggle(e){return e===void 0&&(e=!this.isShow),e?this.show():this.hide()}toggleMore(e){return e===void 0&&(e=!this.showMore),this.changeState({more:e})}hide(){return this.changeState({show:!1})}getFormData(e){var s;e=e||this.state.setting;const t={groupAndOr:"or"},n=this.groupItemCount*2;for(let r=1;r<=n;r++)t[`field${r}`]=((s=this._conditionList[r-1])==null?void 0:s.value)??"",t[`operator${r}`]="=",t[`value${r}`]="",t[`andOr${r}`]="and";return{...t,...e.defaultData,...this.state.data}}getSubmitData(){const e=this._data;return{module:this.props.module,actionURL:this.state.setting.actionURL,groupItems:this.groupItemCount,formType:this.showMore?"more":"lite",...e}}submit(){var n;let e=this.getSubmitData();if(!e)return;const t=(n=this.props.beforeSearch)==null?void 0:n.call(this,e);t!==!1&&(t&&(e=t),pi({url:this.props.searchUrl||yn("search","buildQuery"),data:e,onSuccess:s=>{var r;return((r=this.props.onSearch)==null?void 0:r.call(this,s))===!1||this._handleSearch(y.extend({success:()=>this.load()},typeof s.load=="string"?{url:s.load}:s.load)),!1}}))}reset(){return this.changeState(e=>{const t=new Array(this.groupItemCount*2).fill(0).reduce((n,s,r)=>(n[`value${r+1}`]="",n),{});return{clickedReset:!0,data:{...e.data,...t}}},this._syncPickerData)}applyQuery(e){var s;const{actionURL:t}=this.state.setting,n=t.replace("myQueryID",String(e));((s=this.props.onSearch)==null?void 0:s.call(this,{result:"success",load:n}))!==!1&&this._handleSearch({url:n,success:()=>this.load(!0)})}deleteQuery(e,t){const{deleteQueryConfirm:n,canDeleteQuery:s}=this.state.setting;if(!t&&n){Ue.confirm(n).then(o=>{o&&this.deleteQuery(e,!0)});return}const r=typeof s=="string"?s.replace("{id}",`${e}`):yn("search","deleteQuery",`queryID=${e}`);pi({url:r,onSuccess:()=>{const o=this.state.setting,{savedQueryList:a=[]}=o;return this.changeState({setting:{...o,savedQueryList:a.filter(l=>l.id!==e)}}),!1}})}addQuery(e,t){const n=this.state.setting,{savedQueryList:s=[]}=n;s.some(r=>r.id===e)||this.changeState({showQueryPanel:!0,setting:{...n,savedQueryList:[{id:e,text:t},...s]}})}changeData(e,t){const n={[e]:t};if(e.startsWith("field")){const s=t,r=+e.substring(5),{defaultOperator:o,defaultValue:a=""}=this._conditionMap[s];o&&(n[`operator${r}`]=o),n[`value${r}`]=a}else if(e.startsWith("value")){const s=this.getFormData(),r=+e.substring(5),o=s[`field${r}`],{control:a}=this._conditionMap[o];if(a==="date"){const l=t.startsWith("$"),c=s[`operator${r}`];l&&c!=="between"?n[`operator${r}`]="between":!l&&c==="between"&&(n[`operator${r}`]="<=")}}this.changeState(s=>({data:{...s.data,...n}}),this._syncPickerData)}_handleSearch(e){const t=this.element.closest(".modal");let{searchLoader:n=t?{load:"modal",target:t}:"table"}=this.props;const s=y(this.element);let r=s.closest(".tab-pane");typeof n=="string"?(n={load:n},r.length||(r=s.closest("#main"))):t&&(r.length||(r=y(t)));const o=r.find("[data-zui-dtable]");return o.length&&(n.load="table",n.target=o.children(".dtable").attr("id")),typeof e=="string"?n.url=e:typeof e=="object"&&(n={...n,...e}),y.trigger("locate.zt",n),!1}_renderOperators(e,t){var s;const n=this._operatorList;return w(Kt,{name:e,items:n,required:!0,defaultValue:t??((s=n[0])==null?void 0:s.value),search:!1})}_renderControl(e,t,n,s){const r=this._conditionMap[e]||{},{control:o="text"}=r,{controlRenders:a}=this.constructor,l=a[o]||a.text;return o==="date"&&r.datePeriods===void 0&&s.datePeriods&&(r.datePeriods=s.datePeriods),l.call(this,r,t,n??"")}_renderField(e,t,n,s,r){var d;const{conditions:o}=s,a=t*n+e+1,l=!e;this._conditionList||(this._conditionList=o.map(({text:u,name:p})=>({text:u??p,value:p})));const c=r[`field${a}`]??((d=o[a])==null?void 0:d.name);return w("tr",{key:a,className:"search-form-field"},w("td",{className:V("is-andOr",l?"font-bold text-right nowrap":void 0)},l?(s.groupTitles||[])[t]:this._renderAndOrSelect(`andOr${a}`,r[`andOr${a}`],s)),w("td",{className:"is-condition"},w(Kt,{name:`field${a}`,items:this._conditionList,required:!0,defaultValue:c,popMinWidth:"100%",popWidth:"auto"})),w("td",{className:"is-operator"},this._renderOperators(`operator${a}`,r[`operator${a}`])),w("td",{className:"is-control",key:`${c}:${a}`},this._renderControl(c,`value${a}`,r[`value${a}`],s)))}_renderGroup(e,t,n){const{groupItemCount:s}=this,{showMore:r}=this,o=[],a=r?s:1;for(let l=0;l<a;l++)o.push(this._renderField(l,e,s,t,n));return w("div",{className:"search-form-group flex-1",key:e},w("table",{className:"table-fixed w-full"},w("tbody",null,o)))}_renderAndOrSelect(e,t,n){const{andText:s="And",orText:r="Or"}=n;return w(Kt,{name:e,items:[{value:"and",text:s},{value:"or",text:r}],defaultValue:t,required:!0,search:!1})}_renderForm(e,t){this._conditionMap={},this._conditionList=e.conditions.map(u=>{const{name:p,text:g}=u;return this._conditionMap[p]=u,{text:g??p,value:p}});const{showMore:n}=this;this._operatorList=(e.operators||"=,!=,>,>=,<,<=".split(",")).map(u=>typeof u=="string"?{text:u,value:u}:u);const s=this.getFormData(e);this._data=s;const{searchBtnText:r="Search",resetBtnText:o="Reset",saveQueryBtnText:a="Save",canSaveQuery:l}=e,{simple:c,noMore:d}=t;return w("form",{key:"form",className:"search-form-wrapper flex-auto py-3 px-2",onSubmit:this._handleSubmit},w("div",{className:"row items-center",onChange:this._handleChange},this._renderGroup(0,e,s),w("div",{className:"col flex-none items-center justify-center px-4 w-24"},this._renderAndOrSelect("groupAndOr",s.groupAndOr,e)),this._renderGroup(1,e,s)),w("div",{className:`toolbar gap-4 justify-center flex-nowrap ${c?"ml-4":"mt-3"}`},w(ke,{key:"submit",type:"primary",btnType:"submit"},r),c?null:w(ke,{key:"reset",onClick:this.reset},o),c&&d?null:w("div",{className:c?"":"absolute top-0 right-0"},c?null:w(ke,{key:"saveQuery",type:"ghost",className:"text-primary","data-toggle":"modal",disabled:!l||this.state.clickedReset,url:l?typeof l=="string"?l:yn("search","saveQuery",`module=${t.module}`):void 0,"data-title":a},a),d?null:w(ke,{key:"toggle",type:"ghost",className:"text-primary",icon:n?"chevron-double-up":"chevron-double-down",onClick:this.toggleMore.bind(this,void 0)}))))}_renderQueryPanel(e,t){const{savedQueryList:n=[],saveQueryPanelWidth:s=200,saveQueryPanelTitle:r="Saved queries",canDeleteQuery:o}=t;return w("div",{key:"panel",className:V("search-form-query sidebar sidebar-right pt-3 transition-none",e?"is-expanded":"is-collapsed"),style:{minHeight:100,width:e?Be(s):0,transition:"none"}},w("div",{class:"sidebar-gutter gutter gutter-border gutter-horz border-default",onClick:this.toggleQueryPanel.bind(this,void 0)},w("button",{class:"gutter-toggle",type:"button"},w("span",{class:"chevron-right"}))),e?w("div",{className:"search-form-query-panel pl-3 h-full col"},w("div",{className:"search-form-query-title font-bold mb-1.5 flex-none"},r),w("ul",{className:"search-form-query-list col items-start gap-1 overflow-auto scrollbar-hover pr-3 pb-2 pt-px pl-0"},n.map(({id:a,text:l,noDelete:c})=>w("li",{key:a,className:`search-form-query-item label gray-pale rounded-full state pl-2 hover:text-primary hover:primary-pale inline-flex gap-1 max-w-full ${o&&!c?"pr-0":"pr-2"}`,onClick:this.applyQuery.bind(this,a)},w("span",{className:"min-w-0 flex-auto overflow-hidden nowrap"},l),o&&!c?w(ke,{type:"ghost",className:"size-xs rounded-full flex-none"},w("i",{className:"close",onClick:this._handleDeleteQueryClick.bind(this,a)})):null)))):null)}_getProps(e){return{...super._getProps(e),"data-module":e.module}}_getClassName(e){const t=super._getClassName(e);if(!this.isShow)return[t,"search-form","hidden"];const{setting:n,showQueryPanel:s}=this.state,{showMore:r}=this,o=n==null?void 0:n.savedQueryList;return[t,"search-form",n?"is-loaded":"is-empty",{"is-lite":!r,"is-more":r,"is-simple":e.simple,"show-save-query":o&&s}]}_getChildren(e){if(!this.isShow)return null;const{setting:t,showQueryPanel:n,loading:s}=this.state,r=!e.simple&&t&&t.savedQueryList;return w("div",{className:V(`search-form-container row gap-3 load-indicator${s?" loading":""}`,e.innerClass),style:`max-height: ${76+44*(this.showMore?this.groupItemCount:1)}px`},t?this._renderForm(t,e):null,r?this._renderQueryPanel(n,t):null)}};Cp.controlRenders={text:(i,e,t)=>w("input",{className:"form-control",type:"text",name:e,value:t,placeholder:i.placeholder,...i.controlProps}),select:(i,e,t)=>{const{items:n=[]}=i;return w(Kt,{name:e,items:n,defaultValue:t,placeholder:i.placeholder,popMinWidth:"100%",popWidth:"auto",...i.controlProps})},date:(i,e,t)=>{const{datePeriods:n}=i,s={};return n&&(s.menu=[...n],s.allowInvalid=!0,s.display=r=>{const o=n.find(a=>a.value===r);return o?o.text:r}),w(Vi,{name:e,defaultValue:t,placeholder:i.placeholder,...s,...i.controlProps})},time:(i,e,t)=>w(bo,{name:e,defaultValue:t,placeholder:i.placeholder,...i.controlProps}),datetime:(i,e,t)=>w(fc,{name:e,defaultValue:t,placeholder:i.placeholder,...i.controlProps})};class Ft extends _e{}Ft.NAME="SearchForm",Ft.Component=Cp,Ft.replace=!0,Ft.toggleForm=oh,Ft.update=xp,Ft.addQuery=kp,Ft.toggle={convertHref:!0,getOptions(i,e){const t=y(i);if(t.is("a")){const n=t.attr("href");n&&(!e.target&&"#.".includes(n[0])?e.target=n:e.url||(e.url=n))}return e},handler(i,e){oh({container:y(i).closest(e.container||".modal,#main"),...e})}},Ft.register();function oh(i){typeof i=="string"?i={module:i}:i||(i={module:window.config.currentModule});const e=y(i.container||".modal,#main").first();if(!e.length)return;i.module||(i.module=window.config.currentModule);let t;if(i.target?t=y(i.target,e):(t=e.find(`[${Ft.DATA_KEY}],.search-form`),i.module&&(t=t.filter(`[data-module="${i.module}"]`))),!t.length){let s=e.closest(".modal").find(".modal-body");s.length||(s=e.find(".main-content-cell")),s.length||(s=e.find("#mainContent")),t=y("<div/>").attr({"zui-key":"searchForm","data-module":i.module}).prependTo(s.length?s.first():e)}let n=t.zui(Ft.NAME);return n?n.$.toggle(i.show):n=new Ft(t,{container:e,show:!0,...i}),n}function xp(i,e){y.trigger("update.SearchForm.zt",{module:i,reset:e})}function kp(i){y.trigger("addQuery.SearchForm.zt",i)}const JC="";class ia extends _e{}ia.NAME="UserAvatar",ia.Component=Jo,ia.register();const Vv={1:"error",2:"warning",4:"parse",8:"notice",16:"core-error",32:"core-warning",64:"compile-error",128:"compile-warning",256:"user-error",512:"user-warning",1024:"user-notice",2048:"strict",4096:"recoverable-error",8192:"deprecated",16384:"user-deprecated",32767:"all"};function Sp(i){return typeof i=="number"&&(i=Vv[i]),i}function Tp(i){return i=Sp(i),i.includes("error")?"error":i.includes("warning")?"warning":"info"}function Kv({errors:i,...e}){const t=i.reduce((n,s)=>(n[Tp(s.level)]++,n),{error:0,warning:0,info:0});return w("div",{class:"row items-stretch text-sm","data-hint":"PHP errors",...e},t.error?w("button",{type:"button",class:"state font-bold px-0.5 danger"},w("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"ERR"),t.error):null,t.warning?w("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-90"},w("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"WAR"),t.warning):null,t.info?w("button",{type:"button",class:"state font-bold px-0.5 danger bg-opacity-80"},w("span",{class:"scale-95 font-bold inline-block text-opacity-70 text-canvas"},"INF"),t.info):null)}function Pt(i,e,t,n){console.groupCollapsed(`%c${i} %c${e}`,"color: #fff; background-color: #9333ea; padding: 0 0.1em 0 0.25em; border-radius: 0.25em 0 0 0.25em;","color: #9333ea; background-color: #e9d5ff; padding: 0 0.5em; border-radius: 0 0.25em 0.25em 0;",n),console.table(t),console.groupEnd()}function jn(i,e=400,t=100){return i<t?"success":i<e?"warning":"danger"}function qt(i){return i<1e3?`${i.toFixed(0)}ms`:`${(i/1e3).toFixed(2)}s`}function $p({perf:i,guardState:e,guardData:t}){var l;const n=i.id==="page"?"页面":i.id==="#dtable"?"表格":"部分",s=[],{trace:r,xhprof:o}=i,a=r==null?void 0:r.request;if(e){const c=e==="sending"?"发送中":e==="error"?"发送失败，点击查看":"已发送",d=e==="sending"?"text-warning":e==="error"?"text-danger":"text-success",u=t?`${t.request.module}-${t.request.method}#${t.requestId}`:"",p=Pt.bind(null,"Perf Guard Data",e===!0?"sended":e||"null",t,t==null?void 0:t.requestId);s.push(w("div",{onClick:p,class:`px-0.5 state ${d}`,"data-hint":`性能门禁数据${t?`（${u}）`:""}：${c}`},w("i",{class:e==="sending"?"icon icon-spinner-indicator spin":e===!0?"icon-shield-check":"icon-shield"})),w("div",{class:"muted"},"/"))}if(i.requestEnd){i.clientCache&&s.push(w("div",{class:"px-0.5 state text-success","data-hint":`使用本地缓存渲染：${i.clientCache}`},w("i",{class:"icon-check-circle"})),w("div",{class:"muted"},"/"));const c=i.requestEnd-i.requestBegin;if(s.push(w("div",{class:`px-0.5 state text-${jn(c,500,300)}`,"data-hint":"总加载时间 (好<300ms≤正常<500ms≤差)",onClick:Pt.bind(null,"Trace","Perf",i,i.id)},w("i",{class:"icon-history"})," ",qt(c))),a){const u=a.timeUsed;s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${jn(u)}`,"data-hint":"服务器耗时 (好<300≤正常<500≤差)",onClick:Pt.bind(null,"Trace","Request",a,i.id)},w("span",{class:"scale-95 font-bold inline-block"},"S"),qt(u)))}if(i.dataSize){if(a){const u=c-a.timeUsed;s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${jn(u,600,200)}`,"data-hint":"网络用时 (好<200≤正常<600≤差)",onClick:Pt.bind(null,"Trace","Request",a,i.id)},w("span",{class:"scale-95 font-bold inline-block"},"N"),qt(u)))}if(s.push(w("div",{class:"px-0.5 state","data-hint":"下载大小",onClick:Pt.bind(null,"Trace","Perf",i,i.id)},w("span",{class:"muted"},w("i",{class:"icon icon-cube"})," ",dt(i.dataSize,1)))),a){const u=c-a.timeUsed,p=1e3*i.dataSize/u;s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${p<102400?"danger":p<1024e3?"warning":"success"}`,"data-hint":"下载速度(B<100KB≤正常<1MB≤G)",onClick:Pt.bind(null,"Trace","Request",a,i.id)},w("i",{class:"icon icon-arrow-down"}),dt(p,1),"/s"))}}if(i.renderEnd&&i.renderBegin){const u=i.renderEnd-i.renderBegin,p=jn(u,200,50);s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${p}`,"data-hint":"浏览器渲染用时 (好<50≤正常<200≤差)",onClick:Pt.bind(null,"Trace","Perf",i,i.id)},w("i",{class:`icon-${p==="danger"?"frown":p==="warning"?"meh":"smile"}`}),qt(u)))}if(a){const{memory:u,querys:p}=a;typeof u=="number"&&s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${jn(u,1024e3,102400)}`,"data-hint":"服务器内存占用 (好<10KB≤正常<100KB≤差)",onClick:Pt.bind(null,"Trace","Request",a,i.id)},w("span",{class:"scale-95 font-bold inline-block"},"M"),dt(u))),typeof p=="number"&&s.push(w("div",{class:"muted"},"/"),w("div",{class:`px-0.5 state text-${jn(p,30,10)}`,"data-hint":"SQL执行次数 (好<30≤正常<10≤差)",onClick:Pt.bind(null,"SQL Query",`${((l=r.sqlQuery)==null?void 0:l.length)??0} queries`,r.sqlQuery,i.id)},w("span",{class:"scale-95 font-bold inline-block"},"Q"),p))}r!=null&&r.files&&s.push(w("div",{class:"muted"},"/"),w("div",{class:"px-0.5 state","data-hint":"服务器加载PHP文件数目",onClick:Pt.bind(null,"Trace",`${r.files.length} php files`,r.files,i.id)},w("span",{class:"muted"},w("i",{class:"icon-file icon-sm scale-75"}),r.files.length)));const d=r==null?void 0:r.profiles;if(d!=null&&d.length){let u=0,p={Duration:0};if(d.forEach(g=>{g.Duration>.3&&u++,g.Duration>p.Duration&&(p=g)}),s.push(w("div",{class:`px-0.5 state text-${jn(u,3,1)}`,"data-hint":"服务器最慢SQL数 (好<3≤正常<1≤差)",onClick:Pt.bind(null,"SQL Query",`${d.length} SQL profiles`,d,i.id)},w("span",{class:"scale-95 font-bold inline-block"},"LQ"),u)),p.Duration){const g=p.Duration*1e3;s.push(w("div",{class:`px-0.5 state text-${jn(g,600,300)}`,"data-hint":"服务器最慢SQL耗时 (好<600≤正常<300≤差)",onClick:Pt.bind(null,"SQL Query",`Slowest SQL query: ${g}ms`,p,i.id)},w("span",{class:"scale-95 font-bold inline-block"},"MLQ"),qt(g)))}}}else s.push(w("div",{class:"muted px-0.5"},"loading..."));return w("div",{class:"zin-perf-btn-list row items-center bg-black text-sm"},w("div",{class:"px-1 bg-canvas bg-opacity-20 self-stretch flex items-center","data-hint":`请求 ${i.id} URL: ${i.url}`},w("span",{class:"muted"},n)),s,o?w("a",{class:"state text-secondary px-0.5",href:o,target:"_blank","data-hint":"打开 xhprof 报告"},"XHP"):null)}function qv(i){Pt("Trace","Error",i,i.message),navigator.clipboard.writeText(`vim +${i.line} ${i.file}`)}function Gv({errors:i=[],show:e,basePath:t}){i.length||(e=!1);const n=i.map(s=>{const r=Sp(s.level),o=Tp(r),a=o==="error"?"danger":o==="info"?"important":"warning";return w("div",{class:`zin-error-item state ${a}-pale text-fore px-2 py-1 ring ring-darker`,onClick:qv.bind(null,s)},w("div",{class:"zin-error-msg font-bold text-base"},w("strong",{class:`text-${a}`,style:"text-transform: uppercase;"},r)," ",s.message),w("div",{class:"zin-error-info text-sm opacity-60 break-all"},w("strong",null,"vim +",s.line)," ",w("span",{className:"underline"},t?s.file.substring(t.length):s.file)))});return w("div",{class:`zin-errors-panel canvas absolute bottom-full left-0 mono shadow-xl ring rounded fade-from-bottom ${e?"in":"events-none"}`},n)}const ex="";function Yv(){const i=navigator.userAgent;let e="Unknown",t="Unknown";return i.indexOf("Chrome")>-1?(e="Chrome",t=i.substring(i.indexOf("Chrome")+7)):i.indexOf("Firefox")>-1?(e="Firefox",t=i.substring(i.indexOf("Firefox")+8)):i.indexOf("Safari")>-1?(e="Safari",t=i.substring(i.indexOf("Safari")+7),i.indexOf("Version")>-1&&(t=i.substring(i.indexOf("Version")+8))):window.StyleMedia&&(e="Edge",t=i.substring(i.indexOf("Edge")+5)),t=t.split(" ")[0],t=t.split(";")[0],t=t.split(")")[0],{name:e,version:t}}let Qv=class extends pe{constructor(e){var t,n;super(e),this._timer=0,this._browser=Yv(),this._guardData={},this.state={showPanel:e.defaultShow??!0,showZinbar:!!((n=(t=e.defaultData)==null?void 0:t.errors)!=null&&n.length||!Ze.get("Zinbar:hidden")),...e.defaultData},this.togglePanel=this.togglePanel.bind(this),this.sendGuardData=this.sendGuardData.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this)}componentDidMount(){document.addEventListener("click",this.handleClickOutside)}componentDidUpdate(){var o,a,l,c;const{pagePerf:e}=this.state;let t="",n="";const s=(a=(o=e==null?void 0:e.trace)==null?void 0:o.sqlQuery)==null?void 0:a.length,r=(c=(l=e==null?void 0:e.trace)==null?void 0:l.request)==null?void 0:c.timeUsed;if(r&&e.renderEnd){const d=e.renderEnd-e.renderBegin,u=r+d,p=[];let g="",b="";u>=500?(g="danger",p.push(`处理时间${qt(u)}超过500ms（后端${qt(r)}，前端${qt(d)}）`)):u>=300&&(g="warning",p.push(`处理时间${qt(u)}超过300ms（后端${qt(r)}，前端${qt(d)}）`)),s&&(s>=60?(b="danger",p.push(`SQL查询超过60次（实际${s}）`)):s>=40&&(b="warning",p.push(`SQL查询超过40次（实际${s}）`))),(g||b)&&(t=g==="danger"||b==="danger"?"danger":"warning",n=[t==="danger"?"页面有性能问题":"页面有优化空间",...p].join("，"))}y("body").z({perf:t,perfMessage:n})}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}handleClickOutside(e){const t=e.target;this.state.showPanel&&!t.closest(".zinbar")&&this.setState({showPanel:!1})}async sendGuardData(e=180){var g,b;const{guardApi:t}=this.props;if(!t)return;this._timer&&clearTimeout(this._timer);const{pagePerf:n}=this.state;if(!(n!=null&&n.renderEnd))return;if(e){this._timer=window.setTimeout(()=>{this.sendGuardData(0)},e);return}const s=ep(n.url);if(!(s!=null&&s.moduleName))return;this.setState({guardState:"sending"});const{author:r="anonymous",email:o,host:a=location.origin}=this.props,{profiles:l=[],sqlQuery:c=[],request:d}=n.trace||{};l.forEach(C=>{C.Duration=1e3*C.Duration});const u=c.findIndex(C=>C.includes("SET profiling = ")),p=u>=0?c.length-u-1:c.length;this._guardData={timestamp:Date.now(),identifier:r,email:o,requestId:Bo(),dataVer:2,request:{host:a,url:/https?:/.test(n.url)?n.url:`${a}${n.url}`,module:s.moduleName,method:s.methodName,xhprof:n.xhprof?/https?:/.test(n.xhprof)?n.xhprof:`${a}${n.xhprof}`:null,php:d==null?void 0:d.php},userEnv:{system:navigator.userAgentData?navigator.userAgentData.platform:navigator.platform,userAgent:navigator.userAgent,browser:[this._browser.name,this._browser.version].join(" ")},metrics:{frontend:{renderTime:Math.round(n.renderEnd-n.renderBegin),downloadSize:n.dataSize},backend:{totalTime:d==null?void 0:d.timeUsed,sqlTime:l.reduce((C,S)=>C+S.Duration,0),sqlCount:Math.max(l.length||0,p),sqlDetails:l,phpFileLoaded:((g=n.trace)==null?void 0:g.files.length)||0,phpFiles:(b=n.trace)==null?void 0:b.files,requestMemory:d==null?void 0:d.memory}}};try{const C=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this._guardData),mode:"no-cors"});this._guardData.$response=await C.text(),this.setState({guardState:!0})}catch(C){this._guardData.$error=C,console.error("[ZUI] Send guard data failed:",C,this),this.setState({guardState:"error"})}}update(e,t,n){this.setState(s=>{const r=!(e!=null&&e.id)||e.id==="page",o={};return r?(e&&(o.pagePerf={...s.pagePerf,...e}),t&&(o.errors=t),e!=null&&e.requestEnd||(o.guardState=!1)):(e&&(o.partPerf={...s.partPerf,...e}),t&&(o.errors=[...s.errors??[],...t??[]])),n&&(o.basePath=n),o},this.props.guardApi?this.sendGuardData:void 0)}togglePanel(){this.setState({showPanel:!this.state.showPanel})}toggleZinbar(){const e=!this.state.showZinbar;this.setState({showZinbar:e},()=>{Ze.set("Zinbar:hidden",!e)})}render(){const{errors:e,pagePerf:t,partPerf:n,showZinbar:s,basePath:r,guardState:o}=this.state,{fixed:a}=this.props,l=e==null?void 0:e.length;return w("div",{className:V("zinbar row h-5 items-stretch gap-px inverse bg-opacity-50",a?"relative":"fixed right-0 bottom-0",{collapse:!s}),style:{zIndex:9999}},w("button",{type:"button","data-hint":s?"折叠":"展开",className:`w-4 ${l&&!s?"danger":"bg-inverse"} flex items-center justify-center`,style:{marginLeft:-15},onClick:this.toggleZinbar.bind(this)},w("span",{class:s?"caret-right":"caret-left"})),l?w(Kv,{errors:e,onClick:this.togglePanel}):null,t?w($p,{perf:t,guardState:o,guardData:this._guardData}):null,n?w($p,{perf:n}):null,w(Gv,{show:this.state.showPanel,basePath:r,errors:e}))}};class ah extends _e{}ah.NAME="Zinbar",ah.Component=Qv;let Dp=class extends Fe{_renderContent(e){const{subtitle:t,subtitleClass:n,content:s,contentClass:r}=e;if(!(!t&&!s))return[k("div",{className:V("card-content",r),children:[t?k("div",{className:V("card-subtitle",n),children:k(me,{content:t})},"subtitle"):null,s?k(me,{content:s},"extraContent"):null]},"content")]}_renderHeading(e){const{icon:t,prefix:n,prefixClass:s,title:r,titleClass:o,titleUrl:a,titleAttrs:l,suffix:c,suffixClass:d,heading:u,headingClass:p}=e;if(!t&&!n&&!r&&!c&&!u)return;const g=a?"a":"span";return k("div",{className:V("card-heading",p),children:[t?k(Ie,{className:"card-icon",icon:t},"icon"):null,n?k(me,{className:V("card-prefix",s),content:n},"prefix"):null,r?k(g,{className:V("card-title",o),href:a,...l,children:k(me,{content:r})},"title"):null,c?k(me,{className:V("card-suffix",d),content:c},"suffix"):null,u?k(me,{content:u},"extraHeading"):null]})}_renderHeader(e){const{header:t,headerClass:n}=e;if(t)return k("div",{className:V("card-header",n),children:k(me,{content:t},"header")})}_renderFooter(e){const{footer:t,footerClass:n,footActions:s}=e;if(t||s)return k("div",{className:V("card-footer",n),children:[k(me,{content:t},"footer"),He.render(s,[e],{key:"foot-actions",relativeTarget:e,className:"card-foot-actions",size:"sm"},this)]})}_renderActions(e){return He.render(e.actions,[e],{key:"actions",relativeTarget:e,className:"card-actions",size:"sm"},this)}_renderList(e){const{items:t}=e;if(!t)return;const n=xe({key:"list",className:"card-list"},typeof t=="object"?t:{items:t});return k(ut,{...n})}_renderAvatar(e){const{avatar:t}=e;if(t){const n=typeof t=="function"?t.call(this,e):t;if(n)return n.className=V("item-avatar",n.className),k(Oi,{...n},"avatar")}}_getClassName(e){return["card",e.className,e.selected?"selected":""]}_getChildren(e){return[this._renderActions(e),this._renderHeader(e),this._renderAvatar(e),this._renderHeading(e),this._renderContent(e),this._renderList(e),this._renderFooter(e),e.children]}};class Ip extends Dp{_getClassName(e){return e.className}_getChildren(e){const{innerAttrs:t,innerClass:n,selected:s,innerComponent:r="div"}=e,o=xe({className:V("card",n,s?"selected":"")},t);return k(r,{...o,children:super._getChildren(e)})}}let es=class extends ut{_getClassName(e){return[super._getClassName(e),e.countPerRow?"card-grid":""]}_getProps(e){const{gap:t,countPerRow:n}=e;return xe({style:{"--list-gap":t?Be(t):void 0,"--list-count-per-row":n}},super._getProps(e))}_getRenderedItem(e,t){return t}};es.NAME="card-list",es.TAG="div",es.ItemComponents={...ut.ItemComponents,default:Ip,item:Ip},es.defaultItemProps={component:"div"};class sa extends _e{}sa.NAME="Card",sa.Component=Dp,sa.replace=!0;class lh extends _e{}lh.NAME="CardList",lh.Component=es;const tx="",nx="";class ts extends nn{_getLayoutOptions(){const e=super._getLayoutOptions();return this.options.element||(e[0]={getBoundingClientRect:this._getClickBounding}),e}}ts.NAME="ContextMenu",ts.DEFAULT={...nn.DEFAULT,name:"contextmenu",trigger:"contextmenu"},ts.register();const ix="",sx="";function Xv(i){const{left:e,className:t,top:n,id:s,onMenuBtnClick:r,title:o,width:a,height:l,content:c,loading:d,draggable:u=!0}=i;return k("div",{class:"dashboard-block-cell",style:{left:e,top:n,width:a,height:l},children:k("div",{className:V("dashboard-block load-indicator",d&&!c?"loading":"",r?"has-more-menu":"",t),draggable:u,"data-id":s,children:[k("div",{class:"dashboard-block-header",children:[k("div",{class:"dashboard-block-title",children:o}),r?k("div",{class:"dashboard-block-actions toolbar",children:k("button",{class:"toolbar-item dashboard-block-action btn square ghost rounded size-sm","data-type":"more",onClick:r,children:k("div",{class:"more-vert"})})}):null]}),y.isPlainObject(c)&&c.html?k(fn,{className:"dashboard-block-body",executeScript:!0,...c}):k("div",{class:"dashboard-block-body",children:c})]})})}const rx="",ox="",ch=([i,e,t,n],[s,r,o,a])=>!(i+t<=s||s+o<=i||e+n<=r||r+a<=e),Np=(i,e)=>i[1]===e[1]?i[0]-e[0]:i[1]-e[1],ra="Dashboard:Block.cache:";let Mp=class extends pe{constructor(e){super(e),this._ref=fe(),this._loadTimer=0,this._map=new Map,this._oldMap=new Map,this.tryLoadNext=()=>{clearTimeout(this._loadTimer),this._loadTimer=window.setTimeout(()=>this.loadNext(),100)},this._checkLayout=()=>{const{onLayoutChange:t}=this.props;if(!t)return;const{blocks:n}=this.state,s={};let r=!1;n.forEach(o=>{const[a,l,c,d]=this._map.get(o.id),u=this._oldMap.get(o.id);(!u||u[0]!==a||u[1]!==l||u[2]!==c||u[3]!==d)&&(r=!0,s[o.id]={left:a,top:l,width:c,height:d},this._oldMap.set(o.id,[a,l,c,d]))}),r&&t(s)},this._handleMenuClick=t=>{const n=t.target.closest(".dashboard-block");if(!n)return;const s=n.dataset.id;if(!s)return;const r=this.getBlock(s);if(!r||!r.menu)return;const{menu:o}=r,{onClickMenu:a}=this.props;ts.show({triggerEvent:t,element:t.currentTarget,placement:"bottom-end",menu:{onClickItem:l=>{var c;((c=l.item.data)==null?void 0:c.type)==="refresh"&&this.load(s),a&&a.call(this,l,r)},...o}})},this.state={blocks:this._initBlocks(e.blocks)}}getBlock(e){return this.state.blocks.find(t=>t.id===e)}update(e,t){const{id:n}=e,{blocks:s}=this.state,r=s.findIndex(a=>a.id===n);if(r<0)return;const o=s[r];e.fetch&&e.fetch!==o.fetch&&e.needLoad===void 0&&(e.needLoad=!0),s[r]={...o,...e},this.setState({blocks:s},t)}delete(e){const{blocks:t}=this.state,n=t.findIndex(s=>s.id===e);n<0||(t.splice(n,1),this.setState({blocks:t}))}add(e){e=Array.isArray(e)?e:[e],this.setState({blocks:[...this.state.blocks,...this._initBlocks(e)]})}load(e,t){const n=this.getBlock(e);!n||n.loading||(t=t||n.fetch,t&&this.update({id:e,loading:!0,needLoad:!1},async()=>{try{const s=await y.fetch(t,[e,n],({url:r})=>({url:Ce(r,n),dataType:"html"}));this.update({id:e,loading:!1,content:{html:s}},()=>{var r;this._setCache(e,s),(r=this.props.onLoad)==null||r.call(this,n)})}catch(s){const r=k("div",{class:"panel center text-danger p-5",children:["Error: ",s.message]});this.update({id:e,loading:!1,content:r},()=>{var o;(o=this.props.onLoadFail)==null||o.call(this,s,n)})}}))}reset(e){this.setState({blocks:this._initBlocks(e)})}loadNext(){const{blocks:e}=this.state;let t="";for(const n of e){if(n.loading)return;if(!n.visible&&this._isVisible(n.id))return this.update({id:n.id,visible:!0});if(n.needLoad&&n.visible){t=n.id;break}}t.length&&requestAnimationFrame(()=>this.load(t))}_isVisible(e){return!this.props.onlyLoadVisible||!!y(this._ref.current).find(`.dashboard-block[data-id="${e}"]`).isVisible()}_setCache(e,t){const{cache:n}=this.props;if(n)try{typeof n=="string"?Ze.set(`${ra}${n}:${e}`,t):Ze.session.set(`${ra}${e}`,t)}catch(s){console.warn("ZUI: Failed to cache block content.",{id:e,html:t,error:s})}}_getCache(e){const{cache:t}=this.props;if(!t)return;const n=typeof t=="string"?Ze.get(`${ra}${t}:${e}`):Ze.session.get(`${ra}${e}`);if(n)return{html:n}}_initBlocks(e){const{blockFetch:t,blockMenu:n,grid:s}=this.props;return e.map(o=>{const{id:a,size:l,width:c,height:d,left:u=-1,top:p=-1,fetch:g=t,menu:b=n,content:C,...S}=o,[x,D]=this._getBlockSize(c&&d?{width:c,height:d}:l);return{id:`${a}`,width:x,height:D,left:Math.min(u,s-x),top:p,fetch:g,menu:b,content:C??this._getCache(`${a}`),loading:!1,needLoad:!!g,...S}})}_getBlockSize(e){const{blockDefaultSize:t,blockSizeMap:n}=this.props;return e=e??t,typeof e=="string"&&(e=n[e]),e=e||t,Array.isArray(e)||(e=[e.width,e.height]),e}_layout(){const{blocks:e,dragging:t,dropping:n}=this.state,s=this._map;if(s.size){const a=[0,0,0,0];e.sort((l,c)=>Np(s.get(l.id)||a,s.get(c.id)||a))}s.clear(),t&&n&&s.set(t,n),e.forEach(a=>{a.id!==t&&this._layoutBlock(a)});const r=Array.from(s.entries());r.sort((a,l)=>Np(a[1],l[1]));let o=0;return r.forEach(([a,l])=>{let c=l[1]-1;for(;c>=0&&this._canMove([l[0],c,l[2],l[3]],a);)c--;c++,l[1]=c,o=Math.max(o,c+l[3])}),n&&(o=Math.max(o,n[1]+n[3])),{blocks:e,height:o}}_initDraggable(){const e=this._ref.current;this._draggable=new Is(e,{selector:".dashboard-block",target:()=>e,beforeDrag:(t,n)=>{const s=n.getBoundingClientRect();if(t.clientY-s.top>48)return t.preventDefault(),!1;this._dragOffset=[t.clientX-s.left,t.clientY-s.top]},onDragStart:(t,n)=>{const s=n.dataset.id;s!==void 0&&(this._dragging=this._map.get(s),this.setState({dragging:s}))},onDragOver:t=>{const{cellHeight:n,grid:s}=this.props,r=e.getBoundingClientRect(),[,,o,a]=this._dragging,[l,c]=this._dragOffset,d=Math.min(s-o,Math.max(0,Math.round((t.clientX-r.left-l)/(r.width/s)))),u=Math.max(0,Math.round((t.clientY-r.top-c)/n)),p=this.state.dropping;p&&p[0]===d&&p[1]===u||this.setState({dropping:[d,u,o,a]})},onDragEnd:()=>{const{dragging:t,dropping:n}=this.state,s={dragging:void 0,dropping:void 0},r={};if(t&&n){const{blocks:o}=this.state;o.forEach((a,l)=>{const[c,d]=t===a.id?n:this._map.get(a.id);(a.left!==c||a.top!==d)&&(o[l]={...a,left:c,top:d},r[a.id]={left:c,top:d})}),s.blocks=o}this.setState(s,this._checkLayout),this._dragging=void 0,this._dragOffset=void 0}})}_layoutBlock(e){const{id:t,left:n,top:s,width:r,height:o}=e,a=[n,s,r,o];n<0||s<0?this._appendBlock(t,a):this._insertBlock(t,a)}_canMove(e,t){const{dropping:n}=this.state;if(n&&ch(e,n))return!1;for(const[s,r]of this._map.entries())if(s!==t&&ch(r,e))return!1;return!0}_canPlace(e){const{dragging:t}=this.state;return this._canMove(e,t)}_insertBlock(e,t){const{dropping:n}=this.state;for(n&&ch(t,n)&&(t[1]=n[1]+n[3]);!this._canPlace(t);)t[1]=t[1]+1;this._map.set(e,t)}_appendBlock(e,t){const[n,s,r,o]=t;let a=s;if(n>=0&&s>=0){if(this._canPlace(t)){this._map.set(e,[n,s,r,o]);return}a=-1}let l=n<0?0:n,c=a<0?0:a,d=!1;const u=this.props.grid;for(;!d;){if(this._canPlace([l,c,r,o])){d=!0;break}n<0?(l+=1,l+r>u&&(l=0,c+=1)):c+=1}this._map.set(e,[l,c,r,o])}componentDidMount(){this.loadNext(),y(window).on("scroll",this.tryLoadNext),this._initDraggable();for(const[e,t]of this._map.entries())this._oldMap.set(e,[...t])}componentDidUpdate(e){e.blocks!==this.props.blocks?this.setState({blocks:this._initBlocks(this.props.blocks)}):this.loadNext()}componentWillUnmount(){clearTimeout(this._loadTimer),y(window).off("scroll",this.tryLoadNext),this._draggable.destroy()}render(){const{blocks:e,height:t}=this._layout(),{cellHeight:n,grid:s,emptyBlockContent:r}=this.props,{dropping:o,dragging:a}=this.state,l=this._map;return k("div",{class:"dashboard",children:k("div",{class:"dashboard-blocks",style:{height:t*n},ref:this._ref,children:[o?k("div",{className:"dashboard-drop-shadow",style:{left:`${100*o[0]/s}%`,top:n*o[1],width:`${100*o[2]/s}%`,height:n*o[3]}},"dropping"):null,e.map((c,d)=>{const{id:u,menu:p,content:g,title:b}=c,[C,S,x,D]=u===a&&o?o:l.get(u)||[0,0,c.width,c.height];return k(Xv,{id:u,index:d,left:`${100*C/s}%`,top:n*S,width:`${100*x/s}%`,height:n*D,content:g??r,title:b,className:V(c.needLoad?"need-load":"",g?"has-content":""),onMenuBtnClick:p?this._handleMenuClick:void 0},c.id)})]})})}};Mp.defaultProps={responsive:!1,cache:!0,blocks:[],grid:3,gap:16,cellHeight:64,blockDefaultSize:[1,3],blockMenu:{items:[{text:"Refresh",data:{type:"refresh"}}]},onlyLoadVisible:!0,blockSizeMap:{xs:[1,3],sm:[1,4],md:[1,5],lg:[1,6],xl:[1,8],xsWide:[2,3],smWide:[2,4],mdWide:[2,5],lgWide:[2,6],xlWide:[2,8],xsLong:[3,3],smLong:[3,4],mdLong:[3,5],lgLong:[3,6],xlLong:[3,8]}};class hh extends _e{}hh.NAME="Dashboard",hh.Component=Mp;function uh(i,e,t,n){if(typeof i=="function"&&(i=i(e)),typeof i=="string"&&i.length&&(i={url:i}),!i)return t;const{url:s,...r}=i,{setting:o}=e.col,a={};return o&&Object.keys(o).forEach(l=>{l.startsWith("data-")&&(a[l]=o[l])}),k("a",{href:Ce(s,e.row.data),...n,...r,...a,children:t})}function dh(i,e,t){if(i==null)return;const n=e.row.data;return t=t??(n==null?void 0:n[e.col.name]),typeof i=="function"?i(t,e):Ce(i,{...n,0:t})}function Ep(i,e,t,n){var s;return t?(t=t??((s=e.row.data)==null?void 0:s[e.col.name]),t==="0000-00-00 00:00:00"||t==="0000-00-00"?n??"":i===!1?t:(i===!0&&(i="[yyyy-]MM-dd hh:mm"),typeof i=="function"&&(i=i(t,e)),ht(t,i,n??t))):n??t}function Ap(i,e){const{link:t}=e.col.setting,n=uh(t,e,i[0]);return n&&(i[0]=n),i}function Pp(i,e){const{format:t,digits:n}=e.col.setting;let s=i[0];return typeof n=="number"&&!Number.isNaN(Number(s))&&(s=Number(s),n>=0&&(s=s.toFixed(n))),t&&(s=dh(t,e,s)),i[0]=s,i}function Lp(i,e){const{map:t,mapSplitter:n=",",mapJoiner:s}=e.col.setting;if(t){let r=i[0];typeof r=="string"&&n&&(r=r.split(n)),typeof t=="function"?i[0]=t(r,e):typeof t=="object"&&(Array.isArray(r)||(r=[r]),i[0]=r.map(o=>t[o]??o).join(s??n))}return i}function Rp(i,e,t){const n={};return typeof i=="function"?Object.assign(n,i(t)):Object.keys(i).forEach(s=>{var o;const r=(o=t.row.data)==null?void 0:o[i[s]];r!==void 0&&(n[s]=r)}),Object.keys(n).length&&e.push({style:n}),e}function Op(i,e,t="[yyyy-]MM-dd hh:mm"){const{formatDate:n=t,invalidDate:s}=e.col.setting;return i[0]=Ep(n,e,i[0],s),i}function fh(i,e,t=!1){const{html:n=t}=e.col.setting;if(n===!1)return i;const s=i[0],r=n===!0?s:dh(n,e,s);return i[0]={html:r},i}const Zv=Ke({name:"rich",colTypes:{html:{onRenderCell(i,e){return fh(i,e,!0)}},progress:{align:"center",onRenderCell(i,{col:e}){const{progressType:t,barColor:n,barBgColor:s,barHeight:r=6,barWidth:o=64,circleSize:a=24,circleBorderSize:l=1,circleBgColor:c="var(--color-border)",circleColor:d="var(--color-success-500)"}=e.setting,u=i[0];return i[0]=t==="bar"?k(so,{className:"rounded-full",width:o,height:r,color:n||d,background:s,percent:u}):k(ro,{percent:u,size:a,circleWidth:l,circleBg:c,circleColor:d,text:!0}),i}},datetime:{formatDate:"[yyyy-]MM-dd hh:mm"},date:{formatDate:"yyyy-MM-dd"},time:{formatDate:"hh:mm"}},onRenderCell(i,e){const{formatDate:t,html:n,hint:s,styleMap:r}=e.col.setting;if(t&&(i=Op(i,e,t)),i=Lp(i,e),i=Pp(i,e),n?i=fh(i,e):i=Ap(i,e),s){let o=e.value;typeof s=="function"?o=s.call(this,e):typeof s=="string"?o=Ce(s,e.row.data):typeof i[0]=="string"&&(o=i[0]),i.push({attrs:{title:o}})}return r&&(i=Rp(r,i,e)),i}},{buildIn:!0}),Jv={default:(i,e,t)=>{var r,o;const n=(r=i.data)==null?void 0:r[t.name],s=(o=e.data)==null?void 0:o[t.name];return n===s?0:n==null?1:String(n).localeCompare(String(s))},date:(i,e,t)=>{var r,o;const n=We(((r=i.data)==null?void 0:r[t.name])??0),s=We(((o=e.data)==null?void 0:o[t.name])??0);return n.getTime()-s.getTime()},number:(i,e,t)=>{var r,o;const n=(r=i.data)==null?void 0:r[t.name],s=(o=e.data)==null?void 0:o[t.name];return Number.parseFloat(n)-Number.parseFloat(s)}},eb=Ke({name:"sort",defaultOptions:{sort:!1},when:i=>!!i.sort,onCreate(){const{sortBy:i}=this.options;i&&(this.state.sortBy=Array.isArray(i)?i:[i])},onAddRows(i,e){const{sortBy:t}=this.state;if(!t||!t.length)return;const{sort:n}=this.options,s={...Jv,...typeof n=="function"?{default:n}:typeof n=="object"?n:{}};return[...i].sort((r,o)=>{for(const{name:a,order:l}of t){const c=e.map[a];if(!c)continue;let d=c.setting.sort;if(d===!0?d=s.default:typeof d=="string"&&(d=s[d]),!d)continue;const u=d.call(this,r,o,c);if(u)return l==="asc"?u:-u}return 0})},onHeaderCellClick(i,e){if(!i.target.closest(".dtable-sort-link"))return;const t=this.getColInfo(e.colName);if(!t||!t.setting.sort)return;const{sortBy:n=[]}=this.state,s=n.findIndex(a=>a.name===t.name),{multiSort:r}=this.options;let o="asc";if(s>=0){const a=n[s].order;a==="asc"?o="desc":a==="desc"&&(o="none"),r&&n.splice(s,1)}r||(n.length=0),this.update({dirtyType:"layout",state:{sortBy:[{name:e.colName,order:o},...n].filter(a=>a.order!=="none")}})},onRenderHeaderCell(i,e){var l;const{col:t}=e,{sortBy:n}=this.state;if(!t.setting.sort)return i;const o=((l=n==null?void 0:n.find(c=>c.name===t.name))==null?void 0:l.order)||"none",a=k("div",{className:`dtable-sort dtable-sort-${o}`});return i[0]=k("a",{className:"dtable-sort-link",href:"javascript:;",children:[i[0],a]}),i.push({outer:!0,attrs:{"data-sort":o}}),i}},{buildIn:!0}),tb={html:{component:fn}},zp=Ke({name:"custom",onRenderCell(i,e){const{col:t}=e;let{custom:n}=t.setting;if(typeof n=="function"&&(n=n.call(this,e)),!n)return i;const s=Array.isArray(n)?n:[n],{customMap:r}=this.options;return s.forEach(o=>{let a;typeof o=="string"?a=o.startsWith("<")?{component:fn,props:{html:Ce(o,{value:e.value,...e.row.data,$value:e.value})}}:{component:o}:a=o;let{component:l}=a;const c=[a];typeof l=="string"&&c.unshift(tb[l],r==null?void 0:r[l]);const d={};c.forEach(p=>{if(p){const{props:g}=p;g&&y.extend(d,typeof g=="function"?g.call(this,e):g),l=p.component||l}},{props:{}});const u=l;i[0]={outer:!0,className:"dtable-custom-cell",children:k(u,{...d})}}),i}}),hx="";function nb(i,e){var a,l;typeof i=="boolean"&&(e=i,i=void 0);const t=this.state.checkedRows,n={},{canRowCheckable:s,allowCheckDisabled:r}=this.options,o=(c,d)=>{const u=s?s.call(this,c):!0;!u||!r&&u==="disabled"||!!t[c]===d||(d?t[c]=!0:delete t[c],n[c]=d)};if(i===void 0?(e===void 0&&(e=!Fp.call(this)),(a=this.layout)==null||a.allRows.forEach(({id:c})=>{o(c,!!e)})):(Array.isArray(i)||(i=[i]),i.forEach(c=>{o(c,e??!t[c])})),Object.keys(n).length){const c=(l=this.options.beforeCheckRows)==null?void 0:l.call(this,i,n,t);c&&Object.keys(c).forEach(d=>{const u=s?s.call(this,d):!0;!u||!r&&u==="disabled"||(c[d]?t[d]=!0:delete t[d])}),this.setState({checkedRows:{...t}},()=>{var d;(d=this.options.onCheckChange)==null||d.call(this,n)})}return n}function ib(i){return this.state.checkedRows[i]??!1}function Fp(){var s,r;const i=(s=this.layout)==null?void 0:s.allRows.length;if(!i)return!1;const e=this.getChecks().length,{canRowCheckable:t,allowCheckDisabled:n}=this.options;return t?e===((r=this.layout)==null?void 0:r.allRows.reduce((o,a)=>{const l=t?t.call(this,a.id):!0;return o+(!l||!n&&l==="disabled"?0:1)},0)):e===i}function sb(){var e;const i=new Set((e=this.layout)==null?void 0:e.allRows.map(t=>t.id));return Object.keys(this.state.checkedRows).filter(t=>i.has(t))}function rb(i){const{checkable:e}=this.options;i===void 0&&(i=!e),e!==i&&this.setState({forceCheckable:i})}function jp(i,e,t=!1,n=void 0){return k(to,{className:"dtable-checkbox",checked:i,disabled:t,label:n})}const Bp='input[type="checkbox"],.dtable-checkbox',ob=Ke({name:"checkable",defaultOptions:{checkable:"auto",checkboxRender:jp},when:i=>!!i.checkable,options(i){const{forceCheckable:e}=this.state;return e!==void 0?i.checkable=e:i.checkable==="auto"&&(i.checkable=!!i.cols.some(t=>t.checkbox)),i},state(){return{checkedRows:{}}},methods:{toggleCheckRows:nb,isRowChecked:ib,isAllRowChecked:Fp,getChecks:sb,toggleCheckable:rb},i18n:{zh_cn:{checkedCountInfo:"已选择 {selected} 项",totalCountInfo:"共 {total} 项"},zh_tw:{checkedCountInfo:"已選擇 {selected} 項",totalCountInfo:"共 {total} 項"},en:{checkedCountInfo:"Selected {selected} items",totalCountInfo:"Total {total} items"}},footer:{checkbox(){const i=this.isAllRowChecked();return[k("div",{style:{paddingRight:"calc(3*var(--space))",display:"flex",alignItems:"center"},onClick:()=>this.toggleCheckRows(),children:jp(i,void 0,!1,this.options.checkboxLabel)})]},checkedInfo(i,e){const t=this.getChecks(),{checkInfo:n}=this.options;if(n)return[k(me,{className:"dtable-check-info",content:n.call(this,t)})];const s=t.length,r=[];return s&&r.push(this.i18n("checkedCountInfo",{selected:s})),r.push(this.i18n("totalCountInfo",{total:e.allRows.length})),[k("div",{className:"dtable-check-info",children:r.join(", ")})]}},onCreate(){const{checkedRows:i}=this.options;i&&this.setState(e=>({checkedRows:{...e.checkedRows,...i.reduce((t,n)=>(t[n]=!0,t),{})}}))},onRenderCell(i,{row:e,col:t}){var c;const{id:n}=e,{canRowCheckable:s}=this.options,r=s?s.call(this,n):!0;if(!r)return i;const{checkbox:o}=t.setting,a=typeof o=="function"?o.call(this,n):o,l=this.isRowChecked(n);if(a){const d=(c=this.options.checkboxRender)==null?void 0:c.call(this,l,n,r==="disabled");i.push(d,{outer:!0,className:"has-checkbox"})}return l&&i.push({outer:!0,className:"is-checked"}),i},onRenderHeaderCell(i,{row:e,col:t}){var o;const{id:n}=e,{checkbox:s}=t.setting;if(typeof s=="function"?s.call(this,n):s){const a=this.isAllRowChecked(),l=(o=this.options.checkboxRender)==null?void 0:o.call(this,a,n);i.push(l,{outer:!0,className:"has-checkbox"})}return i},onHeaderCellClick(i){if(this.data.disableCheckable)return;const e=i.target;if(!e)return;const t=e.closest(Bp);t&&this.toggleCheckRows(t.checked)},onCellClick(i,{rowID:e}){if(this.data.disableCheckable)return;const t=y(i.target);if(!t.length||t.closest("btn,a,button.not-checkable,.form-control,.btn").length)return;(t.closest(Bp).not(".disabled").length||this.options.checkOnClickRow)&&this.toggleCheckRows(e)}}),ab=Ke({name:"store",defaultOptions:{store:!0},when:i=>!!i.store,data(){return{store:new ks(`DTable:${this.id}`)}}}),fx="",px="";var Hp=(i=>(i.unknown="",i.collapsed="collapsed",i.expanded="expanded",i.hidden="hidden",i.normal="normal",i))(Hp||{});function oa(i){const e=this.data.nestedMap.get(i);if(!e||e.state!=="")return e??{state:"normal",level:-1};if(!e.parent&&!e.children)return e.state="normal",e;const t=e.children&&this.state.nestedState[i];let n=!1,{parent:s}=e;for(;s;){const r=oa.call(this,s);if(r.state!=="expanded"){n=!0;break}s=r.parent}return e.state=n?"hidden":t?"collapsed":e.children?"expanded":"normal",e.level=e.parent?oa.call(this,e.parent).level+1:0,e}function lb(i){return i!==void 0?oa.call(this,i):this.data.nestedMap}function cb(i,e){let{nestedState:t}=this.state;const{nestedMap:n}=this.data;if(i==="HEADER")if(e===void 0&&(e=!Wp.call(this)),e){const s=n.entries();for(const[r,o]of s)o.state==="expanded"&&(t[r]=!0)}else t={};else{const s=Array.isArray(i)?i:[i];e===void 0&&(e=!t[s[0]]),s.forEach(r=>{const o=n.get(r);e&&(o!=null&&o.children)?t[r]=!0:delete t[r]})}this.update({dirtyType:"layout",state:{nestedState:{...t}}},()=>{const{onNestedChange:s,preserveNested:r}=this.options;s==null||s.call(this),r&&this.data.store.set("nestedState",t)})}function Wp(){const i=this.data.nestedMap.values();for(const e of i)if(e.state==="expanded")return!1;return!0}function Up(i,e=1,t,n=0){var s;t||(t=[...i.keys()]);for(const r of t){const o=i.get(r);o&&(o.level===n&&(o.order=e++),(s=o.children)!=null&&s.length&&(e=Up(i,e,o.children,n+1)))}return e}function Vp(i,e,t,n){const s=i.getNestedRowInfo(e);return!s||s.state===""||!s.children||s.children.forEach(r=>{n[r]=t,Vp(i,r,t,n)}),s}function Kp(i,e,t,n,s){var a;const r=i.getNestedRowInfo(e);if(!r||r.state==="")return;((a=r.children)==null?void 0:a.every(l=>{const c=!!(n[l]!==void 0?n[l]:s[l]);return t===c}))&&(n[e]=t),r.parent&&Kp(i,r.parent,t,n,s)}const aa="dtable-nested-toggle",hb=Ke({name:"nested",plugins:[ab],requireAfter:["sortable"],defaultOptions:{nested:"auto",nestedParentKey:"parent",asParentKey:"asParent",nestedIndent:20,canSortTo(i,e){const{nestedMap:t}=this.data,n=t.get(i.id),s=t.get(e.id);return(n==null?void 0:n.parent)===(s==null?void 0:s.parent)},beforeCheckRows(i,e,t){if(!this.options.checkable||!(i!=null&&i.length)||this.options.noNestedCheck)return;const n={};return Object.entries(e).forEach(([s,r])=>{const o=Vp(this,s,r,n);o!=null&&o.parent&&Kp(this,o.parent,r,n,t)}),n}},options(i){return i.nested==="auto"&&(i.nested=!!i.cols.some(e=>e.nestedToggle)),i},when:i=>!!i.nested,data(){return{nestedMap:new Map,nestedRowMap:new Map}},state(){return{nestedState:{}}},methods:{getNestedInfo:lb,toggleRow:cb,isAllCollapsed:Wp,getNestedRowInfo:oa},onCreate(){let{defaultNestedState:i}=this.options;if(this.options.preserveNested){const e=this.data.store.get("nestedState");e&&(i=e)}this.state.nestedState=i||{}},beforeLayout(){this.data.nestedMap.clear(),this.data.nestedRowMap.clear()},onAddRow(i){this.data.nestedRowMap.set(i.id,i)},onAddRows(i){const{nestedMap:e,nestedRowMap:t}=this.data;i.forEach(r=>{var c,d;const o=e.get(r.id)??{state:"",level:0};let a=((c=r.data)==null?void 0:c[this.options.nestedParentKey??"parent"])??[];Array.isArray(a)||(a=[a]);let l;for(a=[...a];a.length;){let u=a.pop();if(u===void 0)continue;if(u=String(u),t.get(u)){l=u;break}}if(o.parent=l==="0"?void 0:l,(d=r.data)!=null&&d[this.options.asParentKey??"asParent"]&&(o.children=[]),e.set(r.id,o),l){let u=e.get(l);u||(u={state:"",level:0},e.set(l,u)),u.children||(u.children=[]),u.children.push(r.id)}});const n=new Map,s=i.length*100;return i=i.filter(r=>{const o=this.getNestedRowInfo(r.id);return n.set(r.id,o),o.state!=="hidden"}),Up(n),i.sort((r,o)=>{const a=n.get(r.id),l=n.get(o.id);return((a==null?void 0:a.order)??s+r.index)-((l==null?void 0:l.order)??s+o.index)}),i},onRenderCell(i,e){var c;const{row:t,col:n}=e,{id:s,data:r}=t,{nestedToggle:o,childLabel:a}=n.setting,l=this.getNestedRowInfo(s);if(a){const d=Number(r[this.options.nestedParentKey||"parent"]);if(!Number.isNaN(d)&&d>0){let u;typeof a=="string"?u=k("span",{className:"dtable-child-label label rounded-full size-sm gray-pale",children:Ce(a,r)}):u=k(me,{className:"dtable-child-label",content:a,generatorThis:e}),i.unshift(u)}}if(o&&(l.children||l.parent)&&i.push(((c=this.options.onRenderNestedToggle)==null?void 0:c.call(this,l,s,n,r))??k("a",{className:`${aa} state${l.children?"":" is-no-child"}`,children:k("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${l.state}`}),l.level){let{nestedIndent:d=o}=n.setting;d&&(d===!0&&(d=this.options.nestedIndent??12),i.push(k("div",{className:"dtable-nested-indent",style:{width:d*l.level+"px"}})))}return i},onRenderHeaderCell(i,{row:e,col:t}){var s;const{id:n}=e;return t.setting.nestedToggle&&i.push(((s=this.options.onRenderNestedToggle)==null?void 0:s.call(this,void 0,n,t,void 0))??k("a",{className:`${aa} state`,children:k("span",{className:"toggle-icon"})}),{outer:!0,className:`is-${this.isAllCollapsed()?"collapsed":"expanded"}`}),i},onHeaderCellClick(i){const e=i.target;if(!(!e||!e.closest(`.${aa}`)))return this.toggleRow("HEADER"),!0},onCellClick(i,{rowID:e}){const t=i.target;if(!(!t||!this.getNestedRowInfo(e).children||!t.closest(`.${aa}`)))return this.toggleRow(e),!0}});function ph(i,{row:e,col:t}){const{data:n}=e,s=n?n[t.name]:void 0;if(!(s!=null&&s.length))return i;const{avatarClass:r="rounded-full",avatarKey:o=`${t.name}Avatar`,avatarCodeKey:a,avatarNameKey:l=`${t.name}Name`}=t.setting;let{avatarProps:c={}}=t.setting;typeof c=="function"&&(c=c(t,e));const d=(n?n[l]:s)||i[0],u={size:"xs",src:n?n[o]:void 0,text:d,code:a?n?n[a]:void 0:s,...c,className:V(r,c.className,"flex-none")};if(i[0]=k(Oi,{...u}),t.type==="avatarBtn"){const{avatarBtnProps:p}=t.setting,g=typeof p=="function"?p(t,e):p;i[0]=k("button",{type:"button",className:"btn btn-avatar",...g,children:[i[0],k("div",{children:d})]})}else t.type==="avatarName"&&(i[0]=k("div",{className:"flex items-center gap-1",children:[i[0],k("span",{children:d})]}));return i}const ub=Ke({name:"avatar",colTypes:{avatar:{onRenderCell:ph},avatarBtn:{onRenderCell:ph},avatarName:{onRenderCell:ph}}},{buildIn:!0}),db=Ke({name:"sort-type",defaultOptions:{sortType:!0},when:i=>!!i.sortType&&!i.sort,onRenderHeaderCell(i,e){const{col:t}=e,{setting:n}=t;let{sortType:s}=n;if(t.setting.sort!==void 0||s===!1)return i;const{sortLink:r,orderBy:o}=this.options;if(o&&o[t.name]!==void 0&&(s=o[t.name]),s){const a=s===!0?"none":s,l=k("div",{className:`dtable-sort dtable-sort-${a}`});i.push({outer:!0,attrs:{"data-sort":a}});let{sortLink:c=r}=n;if(c){const d=a==="asc"?"desc":"asc";typeof c=="function"&&(c=c.call(this,t,d,a)),typeof c=="string"&&(c={url:c});const{url:u,...p}=c;i[0]=k("a",{className:"dtable-sort-link",href:Ce(u,{...n,sortType:d}),...p,children:[typeof i[0]!="object"||N.isValidElement(i[0])?i[0]:t.name,l]})}else i.push(l)}return i}},{buildIn:!0}),mh=i=>{i.length!==1&&i.forEach((e,t)=>{!t||e.border!==void 0||e.setting.group===i[t-1].setting.group||(e.border="left")})},fb=Ke({name:"group",defaultOptions:{groupDivider:!0},when:i=>!!i.groupDivider,onLayout(i){if(!this.options.groupDivider)return;const{cols:e}=i;mh(e.left.list),mh(e.center.list),mh(e.right.list)}}),vx="",pb=Ke({name:"header-group",defaultOptions:{headerGroup:!0},data(){return{headerGroups:new Map}},when:i=>!!i.headerGroup,beforeLayout(i){const{headerGroups:e}=this.data;e.clear();const{cols:t}=i;if(!(t!=null&&t.length))return;const n={};return t.forEach((s,r)=>{const{headerGroup:o}=s;if(!o){n[s.name]=r;return}let a=e.get(o);a?a.cols.push(s.name):(a={cols:[s.name],index:r},e.set(o,a)),n[s.name]=a.index+a.cols.length/t.length}),t.sort((s,r)=>n[s.name]-n[r.name]),{headerHeight:!i.headerHeight&&i.rowHeight?i.rowHeight*2:void 0,cols:t}},onRenderHeaderCell(i,{col:e}){const{headerGroup:t}=e.setting;if(t){const n=this.data.headerGroups.get(t),s=this.layout.headerHeight/2;if(e.name===n.cols[0]){const r=n.cols.reduce((a,l)=>{var c;return a+(((c=this.getColInfo(l))==null?void 0:c.realWidth)??0)},0),o={height:s-1,width:r-1};i.push(k("div",{class:"dtable-header-group",style:o,children:t}))}i.push({className:"dtable-header-as-group",style:{paddingTop:s}})}return i}}),mb=Ke({name:"cellspan",when:i=>!!i.getCellSpan,data(){return{cellSpanMap:new Map,overlayedCellSet:new Set}},onLayout(i){const{getCellSpan:e}=this.options;if(!e)return;const{cellSpanMap:t,overlayedCellSet:n}=this.data,{rows:s,cols:r,rowHeight:o}=i;t.clear(),n.clear();const a=(l,c,d)=>{const{index:u}=c;l.forEach((p,g)=>{const{index:b}=p,C=`C${b}R${u}`;if(n.has(C))return;const S=e.call(this,{row:c,col:p});if(!S)return;const x=Math.min(S.colSpan||1,l.length-g),D=Math.min(S.rowSpan||1,s.length-d);if(x<=1&&D<=1)return;let A=0;for(let B=0;B<x;B++){A+=l[g+B].realWidth;for(let H=0;H<D;H++){const G=`C${b+B}R${u+H}`;G!==C&&n.add(G)}}t.set(C,{colSpan:x,rowSpan:D,width:A,height:o*D})})};s.forEach((l,c)=>{["left","center","right"].forEach(d=>{a(r[d].list,l,c)})})},onRenderCell(i,{row:e,col:t}){const n=`C${t.index}R${e.index}`;if(this.data.overlayedCellSet.has(n))i.push({outer:!0,style:{display:"none",className:"cellspan-overlayed-cell"}});else{const s=this.data.cellSpanMap.get(n);s&&i.push({outer:!0,style:{width:s.width,height:s.height}})}return i}}),la=Ke({name:"mousemove",events:{click(i){this.data.ignoreNextClick&&(i.preventDefault(),this.data.ignoreNextClick=void 0)},mousedown(){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick)},mousemove(i){this.data.mmRafID&&cancelAnimationFrame(this.data.mmRafID),this.data.mmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("mousemovesmooth",i),this.data.mmRafID=0}),i.preventDefault()},document_mousemove(i){this.data.dmmRafID&&cancelAnimationFrame(this.data.dmmRafID),this.data.dmmRafID=requestAnimationFrame(()=>{this.emitCustomEvent("document_mousemovesmooth",i),this.data.mmRafID=0})}},methods:{ignoreNextClick(i=10){this.data.ignoreNextClick&&clearTimeout(this.data.ignoreNextClick),this.data.ignoreNextClick=window.setTimeout(()=>{this.data.ignoreNextClick=void 0},i)}}});function gb(){var A,B,H,G;const{scrollToMouse:i}=this.data;if(!i)return this.stopScrollToMouse();const{position:e,startTime:t,delay:n}=i;if(!e||Date.now()-t<n)return;const s=(B=(A=this.ref.current)==null?void 0:A.querySelector(".dtable-body"))==null?void 0:B.getBoundingClientRect();if(!s)return;const r=(G=(H=this.ref.current)==null?void 0:H.querySelector(".dtable-scroll-center"))==null?void 0:G.getBoundingClientRect(),{maxStep:o,detectPadding:a,speed:l,side:c}=i,{x:d,y:u}=e,{top:p,bottom:g}=s,{left:b,right:C}=r||s;let S=0;d<b-a?S=-Math.max(o,b-a-d):d>C-a&&(S=Math.max(o,d-(C-a)));let x=0;if(u<p-a?x=-Math.max(o,p-a-u):u>g-a&&(x=Math.max(o,u-(g-a))),c){const Y=new Set((Array.isArray(c)?c:[c]).reduce((Z,ee)=>(ee==="x"?Z.push("left","right"):ee==="y"?Z.push("top","bottom"):Z.push(ee),Z),[]));(!Y.has("left")&&S<0||!Y.has("right")&&S>0)&&(S=0),(!Y.has("top")&&x<0||!Y.has("bottom")&&x>0)&&(x=0)}const D={};S!==0&&(D.scrollLeft=this.layout.scrollLeft+l*S),x!==0&&(D.scrollTop=this.layout.scrollTop+l*x),this.scroll(D)}const qp=Ke({name:"autoscroll",plugins:[la],events:{document_mousemovesmooth(i){if(!this.data.scrollToMouse)return;const{clientX:e,clientY:t}=i;this.data.scrollToMouse.position={x:e,y:t}}},methods:{scrollTo({col:i,row:e,extra:t=2}){const n=this.getColInfo(i),s=this.getRowInfo(e);if(!n&&!s)return!1;const r={},{layout:o}=this;if(n){const{scrollLeft:a,cols:l}=o,c=n.left+n.realWidth;n.left<a?r.scrollLeft=n.left-t:c>l.center.width+a&&(r.scrollLeft=c-l.center.width+t)}if(s){const{scrollTop:a,rowHeight:l,rowsHeight:c}=o,d=s.top+l;s.top<a?r.scrollTop=s.top-t:d>c+a&&(r.scrollTop=d-c+t)}return this.scroll(r),!0},startScrollToMouse(i){const e={interval:60,speed:.5,delay:200,maxStep:this.options.rowHeight,onlyInside:!1,detectPadding:30,startTime:Date.now(),...i};this.data.scrollToMouse=e,clearInterval(this.data.scrollToTimer),this.data.scrollToTimer=window.setInterval(gb.bind(this),e.interval)},stopScrollToMouse(){clearInterval(this.data.scrollToTimer),this.data.scrollToMouse=void 0}},onUnmounted(){clearInterval(this.data.scrollToTimer)}}),kx="",yb=Ke({name:"sortable",defaultOptions:{sortable:!0},when:i=>!!i.sortable,plugins:[la,qp],resetState:!0,state(){return{rowOrders:void 0,sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0}},events:{click(i){i.target.closest(".dtable-sort-link")&&(this.state.rowOrders=void 0)},mousedown(i){var a;if(this.data.disableSortable)return;const{sortHandler:e=".dtable-cell"}=this.options;if(!y(i.target).closest(e).length)return;const s=this.getPointerInfo(i);if(!s||s.rowID==="HEADER")return;const r=this.getRowInfo(s.rowID);if(!r||((a=this.options.onSortStart)==null?void 0:a.call(this,r,i))===!1)return;i.preventDefault();const o=i.clientY;this.data.sortableInfo={from:r,offset:o-s.cellElement.getBoundingClientRect().top,startMouseY:o,lastMouseY:o}},document_mouseup(i){var n;const{sortableInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingState(i);if(t){let s,r;const{sortingFrom:o,sortingTo:a,sortingSide:l}=t;if(a&&l){const c=this.layout.rows.map(g=>g.id),d=[...c],u=o.index,p=a.index;if(!(u===p+1&&l==="after")&&!(u===p-1&&l==="before")){const g=c.splice(u,1);c.splice(p,0,g[0]),s={},r=[],c.forEach((b,C)=>{s[b]=C,r.push(b)}),(d.join()===r.join()||((n=this.options.onSort)==null?void 0:n.call(this,o,a,l,r))===!1)&&(s=void 0,r=void 0)}}(a||Math.abs(e.lastMouseY-e.startMouseY)>4)&&this.ignoreNextClick(),this.disableAnimation(),this.update({dirtyType:"layout",state:c=>y.extend({sortingFrom:void 0,sortingPos:void 0,sortingTo:void 0,sortingSide:void 0},s?{rowOrders:{...c.rowOrders,...s}}:null)},()=>{var c;(c=this.options.onSortEnd)==null||c.call(this,o,a,l,r),setTimeout(()=>{this.data.disableCheckable=void 0},50)})}this.data.sortableInfo=void 0},document_mousemovesmooth(i){const{sortableInfo:e}=this.data;if(!e)return;const t=this.getSortingState(i);t&&(e.state||(this.startScrollToMouse({side:"y"}),this.data.disableCheckable=!0),e.lastMouseY=i.clientY,e.state=t,this.setState(t))}},methods:{getSortingState(i){var G;const{disableSortable:e,sortableInfo:t}=this.data;if(e||!t)return;const{headerHeight:n,footerHeight:s,visibleRows:r,scrollTop:o,rowHeight:a}=this.layout,l=this.element.getBoundingClientRect(),c=l.width,d=l.height-n-s,u=i.clientX-l.left,p=i.clientY-l.top-n;if(u<0||u>c||p<0||p>d)return t.state;const g=p+o,b=r.find(Y=>Y.top<=g&&Y.top+a>g);if(!b)return t.state;const C=t.from,S=b.id!==C.id?b.id:void 0,x=S?this.getRowInfo(S):void 0,D=p,A=g<b.top+a/2?"before":"after";return x&&((G=this.options.canSortTo)==null?void 0:G.call(this,C,x,A))!==!1?{sortingFrom:C,sortingPos:D,sortingTo:x,sortingSide:A}:{sortingFrom:C,sortingPos:D,sortingTo:void 0,sortingSide:void 0}}},onAddRows(i){const{rowOrders:e}=this.state;if(!e)return;const t=i.length*100;return i=i.sort((n,s)=>{const r=e[n.id]??t+n.index,o=e[s.id]??t+s.index;return r-o}),i},beforeRender(i){const{sortingFrom:e}=this.state,{visibleRows:t}=i;e&&(t.some(n=>n.id===e.id)||(i.visibleRows=[...t,e]),i.className=V(i.className,"dtable-sorting"))},onRenderCell(i,e,t){const{sortingFrom:n,sortingPos:s,sortingTo:r,sortingSide:o}=this.state;if(!n)return i;const a=e.row,l={},c=[];if(n.id===a.id)l.top=s-this.data.sortableInfo.offset+((t.top??a.top)-(a.top-this.layout.scrollTop)),c.push("is-sorting-from");else if(r){const d=r.id===a.id;d&&c.push(`text-primary is-sorting-to is-sorting-to-${o}`),n.index>a.index&&(d&&o==="before"||a.index>r.index)?c.push("is-sorting-before"):n.index<a.index&&(d&&o==="after"||a.index<r.index)&&c.push("is-sorting-after")}return c.length&&i.push({outer:!0,style:l,className:c}),i}}),Gp=Ke({name:"pager",state(){const i=this.props.localPager;if(i){const{page:e=1,recTotal:t=0,recPerPage:n=20,pageTotal:s=1}=this.props.footPager||{};return{pager:{page:e,recTotal:t,recPerPage:n,pageTotal:s,...typeof i=="object"?i:null}}}return{}},footer:{pager(){let{footPager:i}=this.options;const{localPager:e}=this.options;return i?(i={items:[{type:"link",page:"first",icon:"icon-first-page"},{type:"link",page:"prev",icon:"icon-angle-left"},{type:"info",text:"{page}/{pageTotal}"},{type:"link",page:"next",icon:"icon-angle-right"},{type:"link",page:"last",icon:"icon-last-page"}],...i},Array.isArray(i.items)&&i.items.forEach(t=>{t.type==="size-menu"&&t.caret===void 0&&(t.caret="up")}),this.options.localPager&&(Object.assign(i,{...typeof e=="object"?e:null,...this.state.pager,recTotal:this.layout.allRows.length,useState:!0}),i.onChangePageInfo=t=>{this.update({dirtyType:"layout",state:n=>({pager:{...n.pager,...t}})})}),[k(Ao,{...i})]):[]}},onAddRows(i){const{localPager:e}=this.options;if(e){const{page:t=1,recPerPage:n=20}={...typeof e=="object"?e:null,...this.state.pager},s=(t-1)*n,r=Math.min(t*n,i.length);return i.slice(s,r)}}}),_b=Object.freeze(Object.defineProperty({__proto__:null,NestedRowState:Hp,avatar:ub,cellspan:mb,checkable:ob,custom:zp,group:fb,headerGroup:pb,nested:hb,pager:Gp,renderDatetime:Ep,renderDatetimeCell:Op,renderFormat:dh,renderFormatCell:Pp,renderHtmlCell:fh,renderLink:uh,renderLinkCell:Ap,renderMapCell:Lp,renderStyleMapCell:Rp,rich:Zv,sort:eb,sortType:db,sortable:yb},Symbol.toStringTag,{value:"Module"}));class ns extends _e{setOptions(e,t){return e=super.setOptions(e,t),e.parent||(e.parent=this.element),e}}ns.NAME="DTable",ns.Component=Hs,ns.definePlugin=Ke,ns.removePlugin=Ff,ns.plugins=_b;const $x="",Dx="",Ix="",Nx="",Mx="",Ex="",Ax="";class gh extends Fe{_getClassName(e){return["kanban-header-col",e.className,e.subCols?"has-subs":"",e.parentName!==void 0?"is-sub":""]}_getProps(e){const{width:t,color:n,name:s,gapLeft:r,gapRight:o}=e;return xe(super._getProps(e),{style:{"--kanban-col-color":n,"--kanban-col-width":Be(t),"--kanban-col-gap-left":Be(r),"--kanban-col-gap-right":Be(o)},"z-col":s})}_getChildren(e){const{prefix:t,prefixClass:n,title:s,titleClass:r,titleAlign:o="center",subtitle:a,subtitleClass:l,icon:c,trailingIcon:d,actions:u,subCols:p}=e;return[k("div",{className:`kanban-header-col-wrapper is-align-${o}`,children:[k("div",{className:"kanban-header-title",children:[c?k(Ie,{className:"as-leading-icon",icon:c},"icon"):null,t?k("span",{className:V("as-prefix",n),children:k(me,{content:t})},"prefix"):null,s?k("span",{className:V("as-title",r),title:typeof s=="string"?s:void 0,children:k(me,{content:s})},"title"):null,a?k("span",{className:V("as-subtitle",l),children:k(me,{content:a})},"subtitle"):null,d?k(Ie,{className:"as-trailing-icon",icon:d},"trailingIcon"):null]},"title"),He.render(u,[e],{key:"actions",className:"kanban-header-col-actions",size:"sm"},this)]},"wrapper"),p?k("div",{className:"kanban-header-sub-cols",children:p.map((g,b)=>k(gh,{index:b,...g},g.name))},"subs"):null]}}class vb extends pe{constructor(){super(...arguments),this._ref=fe()}componentDidMount(){this._ref.current&&(this._sticky=Sl.ensure(this._ref.current,{scrollContainer:".kanban-list"}))}componentWillUnmount(){var e;(e=this._sticky)==null||e.destroy()}render(e){return k("div",{className:"kanban-header",ref:this._ref,children:[k("div",{className:"kanban-header-lane-name"},"name"),k("div",{className:"kanban-header-cols",children:e.cols.map((t,n)=>k(gh,{index:n,...t},t.name))},"cols")]})}}class Yp extends pe{constructor(){super(...arguments),this._listRef=fe(),this._renderItem=e=>{const{itemRender:t,lane:n,name:s}=this.props;return t.call(this,{item:e,lane:n,col:s})},this._handleScroll=e=>{const{current:t}=this._listRef;t&&y(t).trigger("laneColScroll",e)}}componentDidMount(){const{current:e}=this._listRef;e&&(this._ob=new ResizeObserver(t=>{y(this._listRef.current).trigger("laneColResize",t[0])}),this._ob.observe(e))}componentWillUnmount(){var e;(e=this._ob)==null||e.disconnect()}render(e){const{items:t}=e,{width:n,color:s,content:r,contentClass:o,itemRender:a,itemGap:l,watchSize:c,name:d,lane:u,itemCountPerRow:p,gapLeft:g,gapRight:b,laneColClass:C}=e,S={"--kanban-col-color":s,"--kanban-col-width":Be(n),"--kanban-col-gap-left":Be(g),"--kanban-col-gap-right":Be(b)};return k("div",{className:V("kanban-lane-col",C),style:S,"z-lane":u,"z-col":d,children:[r?k("div",{className:V("kanban-col-content",o),children:k(me,{content:r,generatorThis:this,generatorArgs:[e]})}):null,k("div",{className:"kanban-items scrollbar-thin scrollbar-hover",onScroll:this._handleScroll,children:k(es,{forwardRef:c?this._listRef:void 0,itemProps:{className:"kanban-item card-list-item"},items:t,itemRender:a?this._renderItem:void 0,countPerRow:p,gap:l},"list")})]})}}Yp.defaultProps={watchSize:!0};class bb extends Fe{_getClassName(e){const{className:t,index:n,maxHeight:s,height:r}=e;return["kanban-lane",t,{"is-first":!n,"is-auto-height":!s&&(!r||r==="auto")}]}_getProps(e){const{height:t,minHeight:n,maxHeight:s,color:r,name:o,gapTop:a,gapBottom:l}=e;return xe(super._getProps(e),{style:{"--kanban-lane-color":r,height:Be(t),minHeight:Be(n),maxHeight:Be(s),"--kanban-col-gap-top":Be(a),"--kanban-col-gap-bottom":Be(l)},"z-lane":o})}_renderCol(e,t,n,s,r){if(r){const o=r(e,t);o&&(t={...t,...o})}return k(Yp,{itemRender:n,lane:e.name,items:s[t.name],...t},t.name)}_getChildren(e){const{title:t,titleClass:n,actions:s,cols:r,items:o={},hideName:a,itemRender:l,getLaneCol:c}=e;return[a?null:k("div",{className:"kanban-lane-name",children:[He.render(s,[e],{key:"actions",className:"kanban-lane-actions",size:"sm"},this),k("div",{className:V("kanban-lane-title",n),title:typeof t=="string"?t:void 0,children:k(me,{content:t})},"title")]},"name"),k("div",{className:"kanban-lane-cols",children:r.reduce((d,u)=>(u.subCols?u.subCols.forEach(p=>{d.push(this._renderCol(e,p,l,o,c))}):d.push(this._renderCol(e,u,l,o,c)),d),[])},"cols")]}}function wb(i){const{lanes:e,cols:t,items:n={},itemRender:s,hideLaneName:r,getLaneCol:o}=i;return k("div",{className:"kanban-body",children:e.map((a,l)=>k(bb,{index:l,cols:t,items:n[a.name],hideName:r,itemRender:s,getLaneCol:o,...a},a.name))})}const Lt=12,Cb={left:"right",right:"left",top:"bottom",bottom:"top","":""},Bn=({from:i,to:e,fromKanban:t,toKanban:n})=>`${t?`${t}_`:""}${i}-${n?`${n}_`:""}${e}`;function Qp(i,e){return e==="top"?{x:i.x+i.width/2,y:i.y}:e==="left"?{x:i.x,y:i.y+i.height/2}:e==="right"?{x:i.x+i.width,y:i.y+i.height/2}:{x:i.x+i.width/2,y:i.y+i.height}}function xb(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function kb(i,e,t,n){const s=t?[t]:["left","right","top","bottom"],r=n?[n]:["left","right","top","bottom"];let o=Number.MAX_SAFE_INTEGER,a={x:0,y:0},l={x:0,y:0};return s.forEach(c=>{r.forEach(d=>{const u=Qp(i,c),p=Qp(e,d),g=xb(u,p)*(Cb[c]===d?1:2);g<o&&(o=g,t=c,n=d,a=u,l=p)})}),{fromSide:t,toSide:n,fromPos:a,toPos:l}}function Sb(i,e){return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}function Xp(i,e){return{x:Math.min(i.x,e.x),y:Math.min(i.y,e.y),width:Math.abs(i.x-e.x),height:Math.abs(i.y-e.y)}}function Zp(i,e,t){const n={id:`marker-${e}-${t}-${i}`,orient:"auto",markerUnits:"strokeWidth",refX:e==="start"?0:6,refY:3,markerWidth:6,markerHeight:6,path:{d:"",fill:"currentColor"}};return i==="arrow"?e==="start"?n.path.d="M6,0 L6,6 L0,3 z":n.path.d="M0,0 L0,6 L6,3 z":i==="dot"?n.path.d="M3,3 m-3,0 a 3,3 0 1,1 6,0 a 3,3 0 1,1 -6,0":i==="square"?n.path.d="M0,0 L0,6 L6,6 L6,0 z":i==="diamond"&&(n.path.d="M3,0 L6,3 L3,6 L0,3 z"),n}function Tb(i,e,t,n,s="curve",r=2,o=1){const{x:a,y:l,width:c,height:d}=Xp(i,e),u=Lt-a,p=Lt-l;if(s==="curve"){const g=c*(1+Math.max(-.3,Math.min(.3,1-c/50)))*o,b=d*(1+Math.max(-.3,Math.min(.3,1-d/50)))*o,C=r*5,S={a1x:i.x+(t==="left"?-C:t==="right"?C:0),a1y:i.y+(t==="top"?-C:t==="bottom"?C:0),ax:i.x+(t==="left"?-g:t==="right"?g:0),ay:i.y+(t==="top"?-b:t==="bottom"?b:0),bx:e.x+(n==="left"?-(g-C):n==="right"?g-C:0),by:e.y+(n==="top"?-(b-C):n==="bottom"?b-C:0),b1x:e.x+(n==="left"?-C:n==="right"?C:0),b1y:e.y+(n==="top"?-C:n==="bottom"?C:0)};return`M ${i.x+u} ${i.y+p} L ${S.a1x+u} ${S.a1y+p} C ${S.ax+u} ${S.ay+p} ${S.bx+u} ${S.by+p} ${S.b1x+u} ${S.b1y+p} L ${e.x+u} ${e.y+p}`}if(s==="fold"){const g=Sb(i,e),b=c/2,C=d/2,S={ax:i.x+(t==="left"?-b:t==="right"?b:0),ay:i.y+(t==="top"?-C:t==="bottom"?C:0),bx:e.x+(n==="left"?-b:n==="right"?b:0),by:e.y+(n==="top"?-C:n==="bottom"?C:0)};return`M ${i.x+u} ${i.y+p} L ${S.ax+u} ${S.ay+p} L ${g.x+u} ${g.y+p} L ${S.bx+u} ${S.by+p} L ${e.x+u} ${e.y+p}`}return`M ${i.x+u} ${i.y+p} L ${e.x+u} ${e.y+p}`}function $b(i){const{fromRect:e,toRect:t}=i,n=Bn(i),s={x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top},r={x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top},{fromSide:o,toSide:a,fromPos:l,toPos:c}=kb(s,r),d=Xp(l,c),{x:u,y:p,width:g,height:b}=d;l.x+=Lt-u,l.y+=Lt-p,c.x+=Lt-u,c.y+=Lt-p;const{weight:C=1.5,fromPoint:S,toPoint:x="arrow"}=i,D={left:`${0-Lt}px`,top:`${0-Lt}px`,width:`${g+2*Lt}px`,height:`${b+2*Lt}px`},A={"stroke-width":C,fill:"transparent",stroke:"currentColor","stroke-linejoin":"round","marker-start":S&&S!=="none"?`url(#marker-start-${n}-${S})`:void 0,"marker-end":x&&x!=="none"?`url(#marker-end-${n}-${x})`:void 0,d:Tb(l,c,o,a,i.shape,C)},B={"stroke-width":C+5,"stroke-linejoin":"round",fill:"transparent",stroke:"currentColor",d:A.d,class:"opacity-0"},H={width:g+2*Lt,height:b+2*Lt},G=[];return i.lineStyle==="dashed"?A["stroke-dasharray"]=`${C*3} ${C*3}`:i.lineStyle==="dotted"&&(A["stroke-dasharray"]=`${C} ${C}`),S&&S!=="none"&&G.push(Zp(S,"start",n)),x&&x!=="none"&&G.push(Zp(x,"end",n)),{x:u,y:p,width:g,height:b,fromSide:o,toSide:a,fromPos:l,toPos:c,nodeStyle:D,svgPathProps:A,svgPathBackProps:B,svgProps:H,markers:G,padding:Lt}}class Jp extends pe{constructor(){super(...arguments),this.state={},this._handleMouseHover=e=>{this.setState({hover:e.type==="mouseenter"})},this._onDelete=()=>{var e;(e=this.props.onDelete)==null||e.call(this,this.props)}}render(e,t){const{text:n,textSize:s,color:r,onDelete:o,weight:a=1.5,from:l,to:c}=e,{hover:d}=t,{x:u,y:p,padding:g,width:b,height:C,svgProps:S,markers:x,svgPathProps:D,svgPathBackProps:A,fromPos:B}=$b(e);return k("div",{className:V("kanban-link",d?"is-hover":""),style:{left:u,top:p,width:b,height:C,color:r,"--kanban-link-weight":a},"z-from":l,"z-to":c,onMouseEnter:o?this._handleMouseHover:void 0,onMouseLeave:o?this._handleMouseHover:void 0,children:[k("svg",{...S,xmlns:"http://www.w3.org/2000/svg",version:"1.1",children:[x.length?k("defs",{children:x.map(({path:H,id:G,...Y})=>k("marker",{...Y,id:G,children:k("path",{...H})},G))}):null,k("path",{...A}),k("path",{...D})]}),k("div",{className:"kanban-link-start-point",style:{left:B.x-g,top:B.y-g}}),o?k("div",{className:"kanban-link-delete-btn",children:k("button",{type:"button",className:"btn rounded-full size-sm square primary",onClick:this._onDelete,children:k("i",{className:"close"})})}):null,n?k("div",{className:"kanban-link-text",style:{fontSize:`${s||12}px`},children:n}):null]})}}const qs=".kanban";class Db extends pe{constructor(){super(...arguments),this._ref=fe(),this.state={}}componentDidMount(){const e=this._ref.current,{container:t=".kanban"}=this.props,n=e.closest(t),s=y(n);this._container=n,this._multiKanban=s.find(".kanban").length>1;const r=".kanban-item,.kanban-link-editor-from";s.on(`mouseenter${qs}`,r,o=>{if(this.state.dragPos)return;clearTimeout(this._leaveTimer);const a=y(o.target).closest(r),l=a.z("key");this.state.from===l||a.hasClass("is-dragging")||this.setState({from:l,fromKanban:this._multiKanban?a.closest(".kanban").z("key"):void 0,to:void 0,fromRect:this._getRect(a.children()[0]),dragPos:void 0})}).on(`mouseleave${qs}`,r,()=>{this.state.dragPos||(clearTimeout(this._leaveTimer),this._leaveTimer=window.setTimeout(()=>{this._cancelHover(),this._leaveTimer=0},200))}).on(`dragstart${qs}`,".kanban-item",()=>{this.state.dragPos||this._cancelHover()}).on(`laneColScroll${qs}`,o=>{const{from:a}=this.state;a&&this.setState({fromRect:this._getRect(y(o.target).find(`.kanban-item[z-key="${a}"]`).children()[0])})}),this._moveable=new Ns(e,{selector:".kanban-link-editor-point",move:"none",onMoveStart:()=>{if(!this.state.from)return!1;s.addClass("is-adding-link")},onMove:o=>{const{top:a,left:l}=n.getBoundingClientRect(),c={left:o.clientX-l+n.scrollLeft,top:o.clientY-a+n.scrollTop};let d,u,p;const g=y(o.target).closest(r);g.length&&d!==this.state.from&&(d=g.attr("z-key"),p=this._multiKanban?g.closest(".kanban").z("key"):void 0,u=this._getRect(g.children()[0])),this.setState({dragPos:c,to:d,toKanban:p,toRect:u})},onMoveEnd:()=>{const{from:o,fromKanban:a,to:l,toKanban:c}=this.state,{onAddLink:d}=this.props;(o!==l||a!==c)&&d&&o!==void 0&&l!==void 0&&(d==null||d.call(this,{from:o,fromKanban:a,to:l,toKanban:c})),this._cancelHover(),s.removeClass("is-adding-link")}})}componentWillUnmount(){var t;const e=(t=this._ref.current)==null?void 0:t.closest(".kanban");e&&y(e).off(qs),this._raf&&cancelAnimationFrame(this._raf)}_getRect(e){const t=e.getBoundingClientRect(),n=this._container,{top:s,left:r}=n.getBoundingClientRect();return{left:t.left-r+n.scrollLeft,top:t.top-s+n.scrollTop,width:t.width,height:t.height}}_cancelHover(){this.setState({from:void 0,to:void 0,fromRect:void 0,dragPos:void 0})}_renderLink(e){const{fromRect:t,toRect:n,from:s,to:r="",dragPos:o}=e;if(!t||!s||!o)return null;const a=n?{left:n.left,top:n.top,right:n.left+n.width,bottom:n.top+n.height}:{left:o.left,top:o.top,right:o.left,bottom:o.top};return k(Jp,{from:s,to:r,lineStyle:"dotted",color:"var(--color-primary-500)",fromRect:{left:t.left,top:t.top,right:t.left+t.width,bottom:t.top+t.height},toRect:a},"link")}render(e,t){const{from:n,fromRect:s,to:r,toRect:o}=t;let a,l;return n&&s&&(a=k("div",{className:"kanban-link-editor-from not-moveable","z-key":n,style:s,children:[k("div",{className:"kanban-link-editor-point is-left"}),k("div",{className:"kanban-link-editor-point is-top"}),k("div",{className:"kanban-link-editor-point is-right"}),k("div",{className:"kanban-link-editor-point is-bottom"})]})),r&&o&&(l=k("div",{className:"kanban-link-editor-to","z-key":r,style:o})),k("div",{className:V("kanban-link-editor"),ref:this._ref,children:[a,l,this._renderLink(t)]})}}const yh=".kanban";class em extends pe{constructor(){super(...arguments),this._ref=fe(),this._watchSet=new Set,this.state={layout:{},scrollTop:0,scrollLeft:0}}componentDidMount(){var s;const{container:e=".kanban"}=this.props,t=(s=this._ref.current)==null?void 0:s.closest(e),n=y(t);this._multiKanban=n.find(".kanban").length>1,n.on(`laneColResize${yh} laneColScroll${yh}`,()=>{this._tryUpdateLayout()}),this._container=t,this._tryUpdateLayout()}componentWillUnmount(){const e=this._container;e&&y(e).off(yh),this._raf&&cancelAnimationFrame(this._raf)}componentDidUpdate(e){(e.links!==this.props.links||e.filters!==this.props.filters)&&this._tryUpdateLayout()}_tryUpdateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._updateLayout(),this._raf=0})}_updateLayout(){const e=[...this._watchSet],t=this._container,n=y(t),{top:s,left:r}=t.getBoundingClientRect(),o=t.scrollTop-s,a=t.scrollLeft-r,l={};e.forEach(c=>{const[d,u]=c.split("_"),p=n.find(`${this._multiKanban?`.kanban[z-key="${d}"] `:""}.kanban-item[z-key="${u}"]`).children()[0];if(p&&bs(p,{container:".kanban-lane-col"})){const{top:g,left:b,bottom:C,right:S}=p.getBoundingClientRect();l[c]={top:g+o,left:b+a,bottom:C+o,right:S+a}}}),this.setState({layout:l})}_renderLink(e){const{layout:t}=this.state,{from:n,fromKanban:s="",to:r,toKanban:o=""}=e,a=`${s}_${n}`,l=`${o}_${r}`,c=t[a],d=t[l];return this._watchSet.add(a),this._watchSet.add(l),!c||!d?null:k(Jp,{...e,fromRect:c,toRect:d,onDelete:this.props.onDeleteLink},`${n}-${r}`)}_renderLinks(e){const{links:t,filters:n}=e,s=new Set(n),r=o=>{const{from:a,to:l,fromKanban:c="",toKanban:d=""}=o;return this._multiKanban?s.has(`${c}_${a}`)||s.has(`${d}_${l}`)||s.has(c)||s.has(d)||s.has(Bn(o)):s.has(a)||s.has(l)||s.has(`${a}-${l}`)};return t.reduce((o,a)=>{if(!n||r(a)){const l=this._renderLink(a);l&&o.push(l)}return o},[])}_renderEditor(e){const{editLinks:t,onAddLink:n,container:s}=e;return t?k(Db,{container:s,onAddLink:n},"editor"):null}render(e){return this._watchSet.clear(),k("div",{className:"kanban-links",ref:this._ref,children:[this._renderLinks(e),this._renderEditor(e)]})}}function Ib(i,e,t){if(!i||!i.length)return[];const{getCol:n,colProps:s,itemCountPerRow:r,itemGap:o}=e;let a=!1;const l=[],c=new Map;return i=i.reduce((d,u,p)=>{if(u=xe({itemGap:o,itemCountPerRow:r},s,u),n){const g=n.call(this,u);g!==!1&&(u=g||u)}return u.deleted||(typeof u.order=="number"?a=!0:u.order=p,typeof u.name!="string"&&(u.name=String(u.name)),t==null||t.call(this,u),u.parentName!==void 0?(u.parentName=String(u.parentName),l.push(u)):(c.set(u.name,u),d.push(u))),d},[]),l.forEach(d=>{const u=c.get(d.parentName);u&&(u.subCols=_n(u.subCols,[d],"name"))}),a&&(i.sort(Gs),[...c.values()].forEach(d=>{d.subCols&&d.subCols.sort(Gs)})),i}function Nb(i,e,t){if(!i||!i.length)return[];const{getLane:n,laneProps:s}=e;let r=!1;return i=i.reduce((o,a,l)=>{if(s&&(a=xe({},s,a)),n){const c=n.call(this,a);c!==!1&&(a=c||a)}return a.deleted||(typeof a.order=="number"?r=!0:a.order=l,a.color===void 0&&(a.color=`hsl(${43*Dl(a.name)%360}deg 40% 50%)`),typeof a.name!="string"&&(a.name=String(a.name)),t==null||t.call(this,a),o.push(a)),o},[]),r&&i.sort(Gs),i}function tm(i,e,t,n,s){if(!(i!=null&&i.length))return[];const{itemProps:r,getItem:o}=n;let a=!1;return i=i.reduce((l,c)=>{r&&(c=xe({},r,c));const d=(o==null?void 0:o.call(this,{col:t.name,lane:e.name,item:c,laneInfo:e,colInfo:t}))??c;return d!==!1&&!d.deleted&&(typeof d.order=="number"?a=!0:d.order=l.length-1,l.push(d),s==null||s.call(this,d)),l},[]),a&&i.sort(Gs),i}function Gs(i,e){return i.order-e.order}function _n(i,e,t="key"){if(!i)return e?[...e]:[];const n=[...i];if(e){let s=0;const r=n.reduce((o,a,l)=>(o.set(String(a[t]??l),l),s=Math.max(a.order??l,s),o),new Map);e.forEach(o=>{const a=String(o[t]);r.has(a)?n[r.get(a)]={...n[r.get(a)],...o}:n.push({order:s++,...o})})}return n}function nm(i,e){return Array.isArray(i)?i.map(t=>({...t,[e]:String(t[e])})):Object.keys(i).reduce((t,n)=>{const s=i[n];return Object.keys(s).forEach(r=>{t.push(...(s[r]||[]).map(o=>({...o,lane:n,col:r,[e]:String(o[e])})))}),t},[])}function im(i,e){const{items:t=[],...n}=i;return{items:nm(t,e),...n}}function _h(i,e,t){var a;const n=_n(i.lanes,e.lanes,"name"),s=_n(i.cols,e.cols,"name"),r=_n(i.links,(a=e.links)==null?void 0:a.map(l=>(l[t]===void 0&&(l[t]=Bn(l)),l)),t),o=_n(i.items,nm(e.items||[],t),t);return{lanes:n,cols:s,items:o,links:r}}let Ys=class extends Fe{constructor(){super(...arguments),this._ref=fe(),this._raf=0,this._data=new ii(this._getData.bind(this),()=>{const{getCol:e,colProps:t,itemCountPerRow:n,itemGap:s,getLane:r,laneProps:o,itemProps:a,getItem:l,getLink:c,linkProps:d,responsive:u}=this.props;return[this._kanbanData,e,t,n,s,r,o,a,l,d,c,u]}),this._kanbanData=new ii(()=>{const{itemKey:e,props:t}=this,{data:n}=t,{data:s,changes:r}=this.state,o=(s||ol(n)?s:im(n,e))||{};return r?_h(o,r,e):o},()=>{const{data:e,changes:t,selected:n}=this.state;return[e,t,n,this.props.data]}),this._handleGlobalClick=e=>{y(e.target).closest(".kanban-item").length||this.select([])},this._onAddLink=async e=>{const{onAddLink:t}=this.props;e[this.itemKey]=Bn(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)},this._handleMouseMove=e=>{this._hoverTimer&&clearTimeout(this._hoverTimer);const t=this._getElementInfo(e.target),n=(t==null?void 0:t.type)==="item"?t.key:void 0;this._hoverTimer=window.setTimeout(()=>{n!==this.state.hover&&this.setState({hover:n},()=>{y(this._ref.current).trigger("kanbanItemHover",{kanban:this.props.key,hover:n})}),this._hoverTimer=0},!n&&this.state.hover?0:20)},this._handleClick=e=>{if(e.target.closest("a,button"))return;const{onClickItem:t,selectable:n}=this.props,s=this._getElementInfo(e.target);t&&(s==null?void 0:s.type)==="item"&&t.call(this,e,s)===!1||n&&(s==null?void 0:s.type)==="item"&&this.select(s.key,!0)}}get data(){return this._data.cache}get itemKey(){return this.props.itemKey||"id"}componentDidMount(){this._afterRender(!0),this.tryLoad(),this._initDraggable();const{responsive:e,selectable:t}=this.props,n=this._ref.current;if(n&&e){const s=new ResizeObserver(this.updateLayout.bind(this));y(typeof e!="boolean"?e:n.closest(".kanban-list")||n.parentElement).each((o,a)=>{s.observe(a)}),this._rob=s,this.state.containerWidth||this.updateLayout()}t&&y(document).on("click.kanban",this._handleGlobalClick)}componentDidUpdate(){this._afterRender(!1),this.tryLoad()}componentWillUnmount(){var e,t,n;(e=this.props.beforeDestroy)==null||e.call(this),(t=this._draggable)==null||t.destroy(),(n=this._rob)==null||n.disconnect(),this.props.selectable&&y(document).off("click.kanban",this._handleGlobalClick)}getDefaultState(e){return{loading:!1,selected:(e||this.props).defaultSelected,data:void 0,changes:void 0,loadFailed:void 0}}load(){const{data:e,onLoad:t,onLoadFail:n}=this.props;this._loadedSetting=e,this.setState({loading:!0},async()=>{const s={loading:!1};try{const r=im(await zt(e,[this],{throws:!0}),this.itemKey);s.data=(t==null?void 0:t.call(this,r))||r}catch(r){s.loadFailed=(typeof n=="function"?n.call(this,r):n)||String(r)}this.setState(s)})}updateLayout(){this._raf&&cancelAnimationFrame(this._raf),this._raf=requestAnimationFrame(()=>{this._raf=0;const e=this._ref.current;if(e){const{responsive:t,laneNameWidth:n=20}=this.props,s=y(typeof t!="boolean"?t:e.closest(".kanban-list")||e.parentElement),r=s[0];let o=s.width()-n-(r.offsetWidth-r.clientWidth);const a=e.closest(".kanban-region");a&&(o-=a.clientWidth-y(a).width()),this.setState({containerWidth:o})}})}tryLoad(){const{loading:e}=this.state,{data:t}=this.props;e||!t||!ol(t)||t===this._loadedSetting||this.load()}getCol(e){return this.data.colMap.get(String(e))}getLane(e){return e=String(e),this.data.lanes.find(t=>t.name===e)}getItem(e){return this.data.map.get(String(e))}update(e){return this.changeState(t=>({changes:_h({...t.changes},e,this.itemKey)}))}createSnap(){return{date:Date.now(),kanban:this,data:y.extend(!0,{},this._data),restore(){this.kanban.changeState({changes:this.data})}}}addItem(e,t,n){return this.updateItem(e,t,n)}updateItem(e,t,n){const s=Array.isArray(e)?e:[e];return this.update({items:t||n?s.map(r=>({...r,lane:t??r.lane,col:n??r.col})):s})}deleteItem(e){return this.updateItem(Array.isArray(e)?e.map(t=>({[this.props.itemKey||"id"]:t,deleted:!0})):{[this.itemKey]:e,deleted:!0})}updateLane(e){return this.update({lanes:Array.isArray(e)?e:[e]})}addLane(e){return this.updateLane(e)}deleteLane(e){return this.updateLane(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateCol(e){return this.update({cols:Array.isArray(e)?e:[e]})}addCol(e){return this.updateCol(e)}deleteCol(e){return this.updateCol(Array.isArray(e)?e.map(t=>({name:t,deleted:!0})):{name:e,deleted:!0})}updateLink(e,t){return this.update({links:(Array.isArray(e)?e:[e]).map(n=>({deleted:!1,...n,...t,[this.itemKey]:Bn(n)}))})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}select(e,t){let n=Array.isArray(e)?e:e?[e]:[],s=this.state.selected||[];const{onSelect:r}=this.props;return this.changeState(o=>{if(s=o.selected||[],t){const a=new Set(s),l=new Set;return n.forEach(c=>{a.has(c)?a.delete(c):l.add(c)}),n=[...a,...l],{selected:n}}return{selected:n}},()=>{r==null||r(n,s),y(this._ref.current).trigger("kanbanItemSelected",{kanban:this.props.key,selected:n,oldSelected:s})})}_getElementInfo(e){const t=y(e),n=t.closest(".kanban-item");if(n.length){const a=n.attr("z-key");if(a){const l=this.getItem(a);if(l)return{type:"item",key:a,element:e,item:l,lane:l.lane,col:l.col}}}if(t.closest(".kanban-new-item").length)return{type:"newItem",element:e};const r=t.closest(".kanban-header-col,.kanban-lane-col");if(r.length)return{type:"col",element:e,col:r.attr("z-col"),lane:r.attr("z-lane")};const o=t.closest(".kanban-lane").attr("z-lane");if(o!==void 0)return{type:"lane",element:e,lane:o}}_getDropInfo(e,t,n){const s=this._getElementInfo(t);if(!s)return;const r=this._getElementInfo(n);if(!r||r.element.closest(".kanban")!==this.element)return;let o;if(s.type==="item"&&r.type==="col")o="inside";else{const a=n.getBoundingClientRect();s.type==="col"?o=e.clientX<a.left+a.width/2?"before":"after":o=e.clientY<a.top+a.height/2?"before":"after"}return{side:o,event:e,drag:s,drop:r}}_getDropChanges(e){const{drag:t,drop:n}=e,s=this.data,r={},{itemKey:o}=this,a={list:[],lane:n.lane,col:n.col};if(t.type==="item"){const l=t.item,c=s.items[n.lane][n.col],d=[...c],u={[o]:l[o],order:l.order},p=n.col===l.col,g=n.lane===l.lane;if(p&&g&&l[o]===n.item[o])return{changes:r,data:a};p||(u.col=n.col),g||(u.lane=n.lane);let b=!1;if(n.type==="col"&&(!g||!p))d.push(u),b=!0;else if(n.type==="item"){const C=n.item,S=n.col!==l.col||n.lane!==l.lane?-1:d.findIndex(D=>D[o]===l[o]);S>=0&&d.splice(S,1);const x=d.findIndex(D=>D[o]===C[o]);d.splice(e.side==="before"?x:x+1,0,u),b=!0}if(b){r.items=[];let C=-1;d.forEach((S,x)=>{const D=Math.max(0,C+1,S.order??x),A=c[x];C=D,(A!==S||D!==A.order)&&(S={...S,order:D}),S!==A&&r.items.push(S),a.list.push(S[o])})}}else if(t.type==="newItem"){const{onDropNewItem:l}=this.props;let c;if(l?c=l.call(this,e):(c=y(t.element).data(),c!=null&&c.item&&(c=c.item)),c={lane:n.lane,col:n.col,...c},c!=null&&c[o]){const u=[...s.items[n.lane][n.col]];u.push(c),r.items=u,a.list.push(c[o])}}return{changes:r,data:a}}_initDraggable(){const{draggable:e}=this.props,t=this._ref.current;if(!e||!t)return;const{dragTypes:n=["item","newItem"],onDragStart:s,onDrop:r,canDrop:o,dropRules:a}=this.props,l=typeof n=="string"?n.split(","):n,c={item:".kanban-item",lane:".kanban-lane-name",col:".kanban-header-col",newItem:".kanban-new-item"},d=typeof e=="object"?e:{},u=(g,b)=>{y(g).attr({"z-drag-type":b?b.drag.type:null,"z-drop-type":b?b.drop.type:null,"z-drop-side":b?b.side:null})},p={...d,selector:d.selector||l.map(g=>c[g]||"").filter(Boolean).join(","),target:d.target||(g=>{const b=this._getElementInfo(g);if(!b)return;const C={lane:".kanban-lane",col:".kanban-header-col",item:".kanban-item,.kanban-items",newItem:".kanban-item,.kanban-items"}[b.type];return y(t).find(C)}),canDrop:d.canDrop||o||a?(g,b,C)=>{const S=this._getElementInfo(b);if(!S)return!1;const x=this._getElementInfo(C);if(!x||x.element.closest(".kanban")!==this.element)return!1;if(S.type==="item"&&a){const D=S.col,A=x.col,B=S.lane,H=x.lane,G=a[`${B}:${D}`]??a[D];return typeof G=="boolean"?G:!G||G.includes(A)||G.includes(`${H}:${A}`)||G.includes(`${H}:`)}if(o)return o.call(this,S,x)}:void 0,onDragStart:(g,b)=>{var S;const C=this._getElementInfo(b);return C?s?s.call(this,{event:g,drag:C}):(S=d.onDragStart)==null?void 0:S.call(this,g,b):!1},onDragOver:(g,b,C)=>{const S=this._getDropInfo(g,b,C);S&&u(C,S)},onDragLeave:(g,b,C)=>{u(C)},onDrop:(g,b,C)=>{var x;u(C);const S=this._getDropInfo(g,b,C);if(!S)return!1;if(r){const{changes:D,data:A}=this._getDropChanges(S);if(Object.keys(D).length){S.data=A;const B=this.createSnap();r.call(this,D,S,B.restore)!==!1&&this.update(D)}}return(x=d.onDrop)==null?void 0:x.call(this,g,b,C)}};this._draggable=new Is(t,p)}_afterRender(e){var t;(t=this.props.afterRender)==null||t.call(this,e)}_getData(){const{itemKey:e,props:t}=this,n=this._kanbanData.value;let s=!1;const{items:r=[]}=n,o={},a=new Map,l=Ib.call(this,n.cols,t,S=>{S.parentName!==void 0&&(s=!0),a.set(S.name,S)}),c=Nb.call(this,n.lanes,t,S=>{o[S.name]=l.reduce((x,D)=>(D.subCols?D.subCols.forEach(A=>{x[A.name]=[]}):x[D.name]=[],x),{})}),d=new Set,u=r.reduce((S,x)=>{if(x.deleted)return d.add(x[e]),S;S.set(x[e],x);const D=o[x.lane];if(D){const A=D[x.col];A&&A.push(x)}return S},new Map),{selected:p=[]}=this.state,g=new Set(p),b=S=>{S.selected=g.has(S[e])};c.forEach(S=>{const x=o[S.name];x&&l.forEach(D=>{var A;x[D.name]=tm.call(this,x[D.name],S,D,t,b),(A=D.subCols)==null||A.forEach(B=>{x[B.name]=tm.call(this,x[B.name],S,B,t,b)})})});let{links:C=[]}=n;return C=C.reduce((S,x)=>{var D;if(!x.deleted&&u.has(x.from)&&u.has(x.to)&&!d.has(x.from)&&!d.has(x.to)){x[e]===void 0&&(x[e]=Bn(x));const A=((D=t.getLink)==null?void 0:D.call(this,x))??x;A!==!1&&!A.deleted&&S.push(A)}return S},[]),{cols:l,lanes:c,items:o,map:u,colMap:a,links:C,hasSubCols:s}}_layoutCols(e,t){const{containerWidth:n=0}=this.state,{colsGap:s=8,minColWidth:r=150,maxColWidth:o=600,colWidth:a=200}=t,l=[];let c=0;const d=u=>{const{minWidth:p=r,maxWidth:g=o}=u;let{width:b=a}=u;typeof b=="function"&&(b=b.call(this,u));const C=b==="auto";if(C)b=p;else{const[S,x]=ai(b);x==="%"?b=n*S/100:b=S}return b=Math.min(g,Math.max(p,b)),c+=b+(c?s:0),u={...u,width:b,maxWidth:g,minWidth:p},C&&l.push(u),u};if(e=e.map(u=>u.subCols?{...u,subCols:u.subCols.map(d)}:d(u)),l.length&&c<n){const u=Math.floor((n-c)/l.length);l.forEach(p=>{p.width=Math.min(p.maxWidth,Math.max(p.minWidth,p.width+u))})}return e}_layoutLanes(e,t){const{laneHeight:n,maxLaneHeight:s,minLaneHeight:r}=t;return!n&&!s&&!r?e:e.map(o=>({height:typeof n=="function"?n.call(this,o):n,maxHeight:s,minHeight:r,...o}))}_getClassName(e){return["kanban",e.className,e.sticky?"kanban-sticky":"",this.data.hasSubCols?"has-sub-cols":""]}_getProps(e){const{laneNameWidth:t,colsGap:n,lanesGap:s,selectable:r,onClickItem:o,showLinkOnHover:a}=e;return xe(super._getProps(e),{ref:this._ref,style:{"--kanban-lane-name-width":t,"--kanban-cols-gap":Be(n),"--kanban-lanes-gap":Be(s)},onClick:o||r?this._handleClick:void 0,onMouseMove:a?this._handleMouseMove:void 0})}_renderLinks(e){const{links:t=[]}=this.data,{editLinks:n}=e;if(!n&&!t.length)return;const{showLinkOnHover:s,showLinkOnSelected:r}=e;let o;if(r||s){o=[];const{selected:a,hover:l}=this.state;r&&a&&o.push(...a),s&&l&&o.push(l),o=[...new Set(o)]}return k(em,{links:t,filters:o,editLinks:n,onDeleteLink:n?this._onDeleteLink:void 0,onAddLink:n?this._onAddLink:void 0},"links")}_getChildren(e){const t=this._data.value,{cols:n,lanes:s,items:r}=t,{laneNameWidth:o}=e,a=this._layoutCols(n,e),l=this._layoutLanes(s,e);return[k(vb,{cols:a},"header"),k(wb,{itemRender:e.itemRender,getLaneCol:e.getLaneCol,cols:a,lanes:l,items:r,hideLaneName:o===0},"body"),this._renderLinks(e),e.children]}};Ys.defaultProps={draggable:!0,sticky:!0,responsive:!0,itemKey:"id",colWidth:200,colsGap:8},Ys.customProps=["onDrop","onDragStart"];class sm extends Fe{constructor(){super(...arguments),this._kanbanRefs=new Map,this._needUpdateData=new Map,this._handleClickHeading=e=>{y(e.target).closest("a,.btn,button").not(".kanban-region-toggle").length||this.setState(t=>({collapsed:!t.collapsed}))}}componentDidUpdate(){if(this.state.collapsed)return;const e=this._needUpdateData;[...e.keys()].forEach(t=>{const n=this.getKanban(t);n&&(n.update(e.get(t)),e.delete(t))})}getDefaultState(e){return{collapsed:(e||this.props).collapsed,heading:void 0,items:void 0}}resetState(e,t){this._kanbanRefs.forEach(n=>{var s;return(s=n.current)==null?void 0:s.resetState()}),super.resetState(e,t)}getKanban(e){var t;return(t=this._kanbanRefs.get(String(e)))==null?void 0:t.current}toggle(e){this.setState(t=>({collapsed:e===void 0?!t.collapsed:!e}))}update(e){const{items:t}=e;return t&&(e={...e},e.items=t.map((n,s)=>{const r=String(n.key||s);return n.deleted?{key:r,deleted:!0}:(n.data&&typeof n.data=="object"&&this.getKanban(r)&&(this._needUpdateKanban(r,n.data),n={...n},delete n.data),n)})),new Promise(n=>{this.setState(e.items?s=>({...e,items:_n(s.items,e.items)}):e,n)})}_needUpdateKanban(e,t){const n=this._needUpdateData,s=n.get(e),{kanbanItemKey:r="key"}=this.props;n.set(e,_h(s||{},t,r))}_buildItems(e){const{items:t=[],kanbanProps:n,kanbanItemKey:s="key"}=e;let{items:r}=this.state;r?(r=_n(t,r,s).filter(c=>!c.deleted),r.sort(Gs)):r=t;const o=this._kanbanRefs,a=new Set(o.keys()),l=r.map((c,d)=>{if(c.deleted)return null;const u=xe({className:"kanban-region-item",key:d},typeof n=="function"?n.call(this,c,d):n,c),p=String(u.key);let g=o.get(p);return g||(g=fe(),o.set(p,g)),u.ref=g,a.delete(p),k(Ys,{"z-key":p,...u})});return a.forEach(c=>{o.delete(c)}),l}_getClassName(e){return["kanban-region",e.className,this.state.collapsed?"is-collapsed":"is-expanded",e.heading?"has-heading":""]}_getChildren(e){const{heading:t,toggleFromHeading:n}=e,{collapsed:s,heading:r}=this.state,o=xe({className:"kanban-heading",onClick:n?this._handleClickHeading:void 0},typeof t=="function"?t.call(this):t,r);return[t&&k(Zt,{...o},"heading"),s?null:this._buildItems(e)]}}const vh=".kanban";let rm=class extends Fe{constructor(){super(...arguments),this.state={},this._ref=fe(),this._kanbanRefs=new Map,this._onAddLink=async e=>{const{onAddLink:t,linkItemKey:n}=this.props;e[n]=Bn(e),await(t==null?void 0:t.call(this,e))!==!1&&this.addLink(e)},this._onDeleteLink=async e=>{const{onDeleteLink:t}=this.props;await(t==null?void 0:t.call(this,e))!==!1&&this.deleteLink(e)}}componentDidMount(){const e=this._ref.current;if(e){const{moveable:t,responsive:n,showLinkOnSelected:s,showLinkOnHover:r}=this.props;if(t&&(this._moveable=new Ns(e,y.extend({selector:"self",move:"scroll",onMoveStart:(o,a)=>{const{bottom:l,right:c}=a.getBoundingClientRect();return o.clientY<l&&o.clientY>l-20||o.clientX<c&&o.clientX>c-20?!1:!y(o.target).closest("a,input,.btn,.state,.kanban-item,.not-moveable").length}},typeof t=="object"?t:null))),s&&y(e).on(`kanbanItemSelected${vh}`,(o,a)=>{this.setState(l=>({selected:{...l.selected,[a.kanban]:a.selected}}))}),r&&y(e).on(`kanbanItemHover${vh}`,(o,{kanban:a,hover:l})=>{this.setState({hover:l===void 0?l:`${a}_${l}`})}),n){const o=new ResizeObserver(this._tryUpdateLayout.bind(this));(typeof n!="boolean"?y(n):y(e).parent()).each((l,c)=>{o.observe(c)}),this._rob=o}}}componentWillUnmount(){var t,n;(t=this._moveable)==null||t.destroy(),(n=this._rob)==null||n.disconnect();const e=this._ref.current;e&&y(e).off(vh)}getDefaultState(e){return{linkChanges:void 0}}resetState(e,t){this._kanbanRefs.forEach(n=>{var s;(s=n.current)==null||s.resetState()}),super.resetState(e,t)}getKanban(e){const t=String(e),n=this._kanbanRefs;if(n.has(t))return n.get(t).current;let s=null;const r=Array.from(n.values());for(const o of r){const a=o.current;if(a instanceof sm&&(s=a.getKanban(e),s))break}return s||null}updateKanban(e,t){const n=this.getKanban(e);return n?n.update(t):Promise.reject(new Error(`[ZUI] Kanban not found: ${e}`))}updateLayout(){const e=this._ref.current;if(!e)return;const t=y(e),n=t.width(),s=t.height();this.setState({width:n,height:s})}updateLink(e,t){return this.changeState(n=>{let s=Array.isArray(e)?e:[e];return t&&(s=s.map(r=>({...r,...t}))),{linkChanges:_n(n.linkChanges,s,this.props.linkItemKey)}})}addLink(e){return this.updateLink(e)}deleteLink(e){return this.updateLink(e,{deleted:!0})}_tryUpdateLayout(){this._layoutTimer&&cancelAnimationFrame(this._layoutTimer),this._layoutTimer=requestAnimationFrame(()=>{this.updateLayout(),this._layoutTimer=0})}_getClassName(e){return["kanban-list",e.className,e.sticky?"has-sticky":"",e.moveable?"is-moveable":"",e.scrollbarHover?"scrollbar-hover":""]}_getProps(e){const{width:t,height:n}=e,s=typeof t=="function"?t.call(this):t,r=typeof n=="function"?n.call(this):n,{width:o,height:a}=this.state??{};return xe(super._getProps(e),{ref:this._ref,style:{width:s,height:r,"--kanban-list-width":`${o||t}px`,"--kanban-list-height":`${a||n}px`}})}_getLinks(e){const{linkChanges:t=[]}=this.state,{links:n=[],getLink:s,linkItemKey:r}=e;return _n(n,t,this.props.linkItemKey).reduce((o,a)=>{const l=s==null?void 0:s.call(this,a);return l!==!1&&(a=l||a,a.deleted||(a[r]||(a[r]=Bn(a)),o.push(a))),o},[])}_renderLinks(e){const t=this._getLinks(e),{editLinks:n}=e;if(!n&&!t.length)return;const{showLinkOnHover:s,showLinkOnSelected:r}=e;let o;if(t.length&&(r||s)){o=[];const{selected:a={},hover:l}=this.state;r&&a&&Object.keys(a).forEach(c=>{const d=a[c];d.length&&o.push(...d.map(u=>`${c}_${u}`))}),s&&l&&o.push(l),o=[...new Set(o)]}return k(em,{container:".kanban-list",links:t,filters:o,editLinks:n,onDeleteLink:n?this._onDeleteLink:void 0,onAddLink:n?this._onAddLink:void 0},"links")}_getChildren(e){const{items:t=[],kanbanProps:n,showLinkOnSelected:s,showLinkOnHover:r,selectable:o,editLinks:a}=e,l=this._kanbanRefs,c=new Set(l.keys()),d=[...t.map((p,g)=>{n&&(p=typeof n=="function"?n.call(this,p,g):y.extend({},n,p));const b=String(p.key??g);let C=l.get(b);C||(C=fe(),l.set(b,C)),c.delete(b);const S=p.heading!==void 0||p.items;return(s||r||o)&&(S?p.kanbanProps={showLinkOnSelected:s,showLinkOnHover:r,selectable:o,...p.kanbanProps}:p={showLinkOnSelected:s,showLinkOnHover:r,selectable:o,...p}),a&&(S?p.items=(p.items||[]).map(D=>({...D,editLinks:!1})):p={...p,editLinks:!1}),k(S?sm:Ys,{ref:C,sticky:e.sticky,...p,"z-key":b},b)}),e.children];c.forEach(p=>{l.delete(p)});const u=this._renderLinks(e);return u&&d.push(u),d}};rm.defaultProps={moveable:!0,sticky:!0,responsive:!0,scrollbarHover:!0,linkItemKey:"id"};class Qs extends _e{}Qs.NAME="Kanban",Qs.replace=!0,Qs.Component=Ys,Qs.register();class Xs extends _e{update(e,t){if(e=Array.isArray(e)?e:[e],t)return this.render({items:e});const n=this.options.items||[],s=new Map(n.map((o,a)=>[o.key,a])),r=[...n];return e.forEach(o=>{if(s.has(o.key)){const a=s.get(o.key);r[a]={...n[a],...o}}else r.push(o)}),this.render({items:r.filter(o=>!o.deleted)})}}Xs.NAME="KanbanList",Xs.replace=!0,Xs.Component=rm,Xs.register();const Px="",Lx="",Rx="",Ox="",zx="",Fx="",jx="",Bx="",Hx="",Wx="",Mb="nav",bh='[data-toggle="tab"]',Eb="active";class Zs extends ze{constructor(){super(...arguments),this._timer=0}active(e){const t=this.$element,n=t.find(bh);let s=e?y(e).closest(bh):n.filter(`.${Eb}`);if(!s.length&&(s=t.find(bh).first(),!s.length))return;n.removeClass("active"),s.addClass("active");const r=s.attr("href")||s.data("target"),o=s.data("name")||r,a=y(r);a.length&&(a.parent().children(".tab-pane").removeClass("active in"),a.addClass("active").trigger("show",[o]),this.emit("show",o),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{a.addClass("in").trigger("shown",[o]),this.emit("shown",o),this._timer=0},10))}}Zs.NAME="Tabs",Zs.toggle={name:"tab",handler(i,e){const t=y(i),n=t.closest(`.${Mb}`);n.length&&Zs.ensure(n,e).active(t)}},Zs.register();function Ab(i){const[e,t]=i.split(":"),n=e[0]==="-"?{name:e.substring(1),disabled:!0}:{name:e};return t!=null&&t.length&&(n.type="dropdown",n.items=t.split(",").reduce((s,r)=>(r=r.trim(),r.length&&s.push(r[0]==="-"?{name:r.substring(1),disabled:!0}:{name:r}),s),[])),n}const Pb=(i,e)=>{var s;i.url&&(i.url=Ce(i.url,e.row.data));const t={row:e.row.id,col:e.col.name},n=((s=i.dropdown)==null?void 0:s.items)||i.items;return n&&n.forEach(r=>(r.url&&(r.url=Ce(r.url,e.row.data)),r.data=t,r)),i.data=t,i},om=i=>i?(typeof i=="string"&&(i=i.split("|")),i.map(e=>typeof e=="string"?Ab(e):e).filter(Boolean)):[],Lb=Ke({name:"actions",colTypes:{actions:{onRenderCell(i,e){var d;const{row:t,col:n}=e,s=om(((d=t.data)==null?void 0:d[n.name])||n.setting.actions);if(!s.length)return i;const{actionsSetting:r,actionsMap:o,actionsCreator:a=this.options.actionsCreator,actionItemCreator:l=this.options.actionItemCreator||Pb}=n.setting,c={items:(a==null?void 0:a(e))??s.map(u=>{const{name:p,...g}=u;if(o&&p){Object.assign(g,o[p],{...g});const{buildProps:C}=g;typeof C=="function"&&(delete g.buildProps,Object.assign(g,C(i,e)))}const{items:b}=g;if(g.disabled&&(delete g.url,delete g["data-toggle"]),b&&g.type==="dropdown"){const{dropdown:C={placement:"bottom-end"}}=g;C.menu={className:"menu-dtable-actions"},C.items=b.map(S=>{const x=typeof S=="string"?{name:S}:{...S};return x.name&&o&&o[x.name]&&Object.assign(x,o[x.name],{...x}),x.disabled?(delete x.url,delete x["data-toggle"]):x.url&&(x.url=Ce(x.url,t.data)),x}),g.dropdown=C,delete g.items}return l?l(g,e):g}),btnProps:{btnType:"ghost",size:"sm",className:"text-primary"},...r};return i[0]=k(He,{...c}),i}}},beforeLayout(i){!Array.isArray(i.data)||!i.data.length||i.cols.forEach((e,t)=>{if(e.type!=="actions"||e.width)return;const{actionsMap:n={}}=e,r=om(i.data[0][e.name]).reduce((o,a)=>{const l=a.name?n[a.name]:null;return l&&l.type==="dropdown"&&l.caret&&!l.text?o+16:o+24},24);i.cols[t]={...e,width:r}})}}),Rb=Ke({name:"toolbar",footer:{toolbar(){const{footToolbar:i,showToolbarOnChecked:e}=this.options;return e&&!this.getChecks().length?[]:[i?He.render(i,[this],{gap:2}):null]}}}),Kx="",am=function(i,e){var s,r;const{col:t}=e,{sortColFrom:n}=this.state;if(n){n.name===t.name&&i.push({outer:!0,className:"is-sorting-from-col"});const o=(r=(s=this.data.sortColInfo)==null?void 0:s.colOffsetMap)==null?void 0:r[t.name];typeof o=="number"&&i.push({outer:!0,className:"is-sorting-col-move",style:{left:t.left+o}})}return i},Ob=Ke({name:"sort-col",when:i=>!!i.sortCol,plugins:[la,qp],resetState:!0,state(){return{colOrders:{},sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0}},events:{mousedown(i){var r;if(this.data.disableSortCol)return;const e=this.getPointerInfo(i);if(!e||e.rowID!=="HEADER")return;const t=this.getColInfo(e.colName);if(!t||((r=this.options.onSortColStart)==null?void 0:r.call(this,t,i))===!1)return;y(i.target).closest("a,button,img").attr("draggable","false").length&&i.preventDefault(),i.preventDefault();const n=i.clientX,{cellElement:s}=e;this.data.sortColInfo={from:t,element:s,offset:n-s.getBoundingClientRect().left,startMouseX:n,lastMouseX:n},y(s).zuiCall("ContextMenu.hide")},document_mouseup(i){var n;const{sortColInfo:e}=this.data;if(!e)return;this.stopScrollToMouse();const t=this.getSortingColState(i);if(t){let s,r;const{from:o,to:a,side:l}=t;if(a){if(o.name===a.name)s={};else if(l){const c=this.layout.cols[o.side].list,d=o.sideIndex,u=a.sideIndex,p=c.splice(d,1);c.splice(u+(l==="after"?1:0),0,p[0]),s={},r=[],c.forEach(({name:g},b)=>{s[g]=b+1,r.push(g)}),((n=this.options.onSortCol)==null?void 0:n.call(this,o,a,l,r))===!1&&(s=void 0,r=void 0)}Math.abs(e.lastMouseX-e.startMouseX)>4&&this.ignoreNextClick()}this.disableAnimation(),this.update({dirtyType:"layout",state:y.extend({sortColFrom:void 0,sortingColPos:void 0,sortingColTo:void 0,sortingColSide:void 0},s?{colOrders:{...this.state.colOrders,...s}}:null)},()=>{var c;(c=this.options.onSortColEnd)==null||c.call(this,o,a,l,r)})}this.data.sortColInfo=void 0},document_mousemovesmooth(i){const{sortColInfo:e}=this.data;if(!e)return;const t=this.getSortingColState(i);t&&(e.state||this.startScrollToMouse({side:"x"}),e.lastMouseX=i.clientX,e.state=t,this.setState({sortColFrom:t.from,sortingColPos:t.pos,sortingColTo:t.to,sortingColSide:t.side}))}},methods:{getSortingColState(i){var S;const{disableSortCol:e,sortColInfo:t}=this.data;if(e||!t)return;const{from:n,element:s}=t,o=y(s).closest(".dtable-cells")[0].getBoundingClientRect(),a=i.clientX-o.left,{cols:l,scrollLeft:c}=this.layout,d=l[n.side].list;if(d.length<=1)return t.state;const u=c+a,p=d.find(x=>x.visible&&x.left<=u&&x.left+x.width>u);if(!p)return t.state;const g=u<p.left+p.width/2?"before":"after";return n.side===p.side&&((S=this.options.canSortColTo)==null?void 0:S.call(this,n,p,g))!==!1?{from:n,pos:a+c,to:p,side:n.name!==p.name?g:void 0}:{from:n,pos:a,to:void 0,side:void 0}}},onAddCol(i){const{colOrders:e={}}=this.state,t=e[i.name];t!==void 0&&(i.order=t)},beforeRender(i){const{sortColFrom:e,sortingColTo:t,sortingColSide:n}=this.state;if(e&&t){i.className=V(i.className,"has-sorting-col");const s=[...i.cols[e.side].list],r=e.sideIndex,o=t.sideIndex,a=s.splice(r,1);s.splice(o+(n==="after"?1:0),0,a[0]);let l=0;const c={};s.forEach(d=>{const u=l-d.left;u&&(c[d.name]=u),l+=d.realWidth}),this.data.sortColInfo.colOffsetMap=c}},onRenderHeaderCell(i,e,t,n){const{sortCol:s}=this.options;return s&&(this.layout.cols[e.col.side].list.length>1&&(s===!0||Array.isArray(s)&&s.includes(e.col.name)||typeof s=="function"&&s.call(this,e.col))&&i.push({outer:!0,className:"is-sortable-col"}),i=am.call(this,i,e,t,n)),i},onRenderCell:am}),Gx="";function lm(i,e,t){const{colResizing:n}=i.state;if(!n)return;const s=Math.round(e.clientX-n.startX);if(!s&&!t)return;const r={};t&&(r.colResizing=void 0);const{colName:o}=n;let a=i.getColInfo(o);if(!a)return i.update({dirtyType:"layout",state:r});r.colsSizes={...i.state.colsSizes,[o]:n.startSize+s},i.update({dirtyType:"layout",state:r},t?()=>{var l;if(a=i.getColInfo(o),a){const c=i.data.colOriginSize.get(o);(l=i.options.onColResize)==null||l.call(i,o,a.width-c,a)}}:void 0),e.stopPropagation(),e.preventDefault()}const zb=Ke({name:"resize",when:i=>!!i.colResize,plugins:[la],resetState(i){var e;return{colsSizes:(e=i.cols)==null?void 0:e.reduce((t,n)=>(n.extraWidth!==void 0&&(t[n.name]=n.extraWidth),t),{})}},state(){var i;return{colsSizes:(i=this.props.cols)==null?void 0:i.reduce((e,t)=>(t.extraWidth!==void 0&&(e[t.name]=t.extraWidth),e),{})}},data(){return{colOriginSize:new Map}},events:{mousedown(i){const e=i.target.closest(".dtable-col-splitter");if(!e)return;const t=e.closest(".dtable-cell"),n=t==null?void 0:t.dataset.col;if(n)return this.setState({colResizing:{colName:n,startSize:this.state.colsSizes[n]??0,startX:i.clientX}},()=>{y(t).zuiCall("ContextMenu.hide")}),!1},dblclick(i){var s;const e=i.target.closest(".dtable-col-splitter");if(!e)return;const t=(s=e.closest(".dtable-cell"))==null?void 0:s.dataset.col;if(!t)return;const{colsSizes:n}=this.state;n[t]&&(delete n[t],this.update({dirtyType:"layout",state:{colResizing:void 0,colsSizes:{...n}}},()=>{var r;(r=this.options.onColResize)==null||r.call(this,t,0,this.getColInfo(t))}))},document_mouseup(i){if(this.state.colResizing)return lm(this,i,!0),!1},document_mousemovesmooth(i){if(this.state.colResizing)return lm(this,i),!1}},methods:{isColResizable(i){if(typeof i=="string"&&(i=this.getColInfo(i)),!i||i.side!=="left"&&i.sideIndex===this.layout.cols[i.side].list.length-1)return;let e=i.setting.colResize??this.options.colResize;return typeof e=="function"&&(e=e.call(this,i.name)),!!e}},onRenderHeaderCell(i,{col:e}){var t;return this.isColResizable(e)&&(i.push({className:"has-col-splitter",children:k("div",{className:"dtable-col-splitter no-cell-event"}),outer:!0}),((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&i.push({className:"has-col-resizing",outer:!0})),i},onRenderCell(i,{col:e}){var t;return((t=this.state.colResizing)==null?void 0:t.colName)===e.name&&i.push({className:"is-col-resizing",outer:!0}),i},onAddCol(i){const e=this.state.colsSizes[i.name]??i.setting.extraWidth;typeof e=="number"&&(this.data.colOriginSize.set(i.name,i.width),i.width=Hf(i.width+e,i.setting.minWidth,i.setting.maxWidth))},onRender(){if(this.state.colResizing)return{className:"has-col-resizing"}}}),Qx="",Fb=Ke({name:"contextmenu",when:i=>!!i.contextmenu,events:{contextmenu(i){const e=this.getPointerInfo(i);if(!e)return;const t=this.getContextMenuItems(i,e);if(!t||!t.length)return;i.preventDefault();const n=y(e.cellElement).addClass("has-contextmenu-show");e.cellElement.classList.add("active"),ts.show({items:t,key:`dtable-ctx-${this.id}`,triggerEvent:i,hideOthers:!0,onHide(){n.removeClass("has-contextmenu-show")}})}},methods:{getContextMenuItems(i,e){const{contextmenu:t}=this.options;if(typeof t=="function")return t.call(this,i,e);if(!t||Array.isArray(t))return t;const{header:n,cell:s}=t;return e.rowID==="HEADER"?typeof n=="function"?n.call(this,i,e):n:typeof s=="function"?s.call(this,i,e):s}}});function cm(i,e){if(typeof e=="string"&&(e=i.getColInfo.call(i,e)),!e)return{};const{colBorders:t}=i.state,{side:n,sideIndex:s}=e,r=i.layout.cols[n].list,o=s>0?r[s-1]:null,a=r[s+1];return{prevName:o==null?void 0:o.name,nextName:a==null?void 0:a.name,prev:o?t[o.name]??o.setting.border:void 0,next:a?t[a.name]??a.setting.border:void 0}}function is(i,e){return i===e||i===!0}const jb=Ke({name:"custom-col",when:i=>!!i.customCol,plugins:[Fb],resetState:!0,options(i){return i.customCol&&!i.contextmenu&&(i.contextmenu={header:(e,t)=>{var o,a;const n=this.getColBorder(t.colName),s=l=>{const c={width:"12px",margin:"0 2px",height:"12px",border:"1px dotted var(--color-border-strong)"},d="2px solid var(--color-border-strong)";return l==="left"?c.borderLeft=d:l==="right"?c.borderRight=d:l===!0&&(c.borderLeft=d,c.borderRight=d),k("span",{style:c})},r=((o=this.getColInfo(t.colName))==null?void 0:o.setting.required)||!((a=this.options.canSetColVisibility)!=null&&a.call(this,t.colName,!1));return[{icon:s(n),text:this.i18n("setDivider"),items:[{text:this.i18n("leftDivider"),icon:s("left"),selected:n==="left",onClick:()=>this.setColBorder(t.colName,"left")},{text:this.i18n("rightDivider"),icon:s("right"),selected:n==="right",onClick:()=>this.setColBorder(t.colName,"right")},{text:this.i18n("allDivider"),icon:s(!0),selected:n===!0,onClick:()=>this.setColBorder(t.colName,!0)},{text:this.i18n("noDivider"),icon:s(!1),selected:!n,onClick:()=>this.setColBorder(t.colName,!1)}]},{text:this.i18n("hideCol"),icon:"eye-off",disabled:r,onClick:r?void 0:()=>this.setColVisibility(t.colName,!1)}]}}),i},state(){return{colBorders:{},colVisibility:{}}},methods:{getColBorder(i,e=!0){const t=this.getColInfo(i);if(!t)return!1;const{colBorders:n}=this.state,s=n[i]??t.setting.border;if(s===!0||!e)return s;const{prev:r,next:o}=cm(this,t),a=s==="left"||is(r,"right"),l=s==="right"||is(o,"left");return a&&l?!0:a?"left":l?"right":!1},setColBorder(i,e){if(this.getColBorder(i,!1)===e)return;const{onSetColBorder:n}=this.options,{prev:s,next:r,prevName:o,nextName:a}=cm(this,i);this.update({dirtyType:"layout",state:l=>{const c={...l.colBorders,[i]:e};return!is(e,"left")&&is(s,"right")&&(c[o]=!1),!is(e,"right")&&is(r,"left")&&(c[a]=!1),{colBorders:c}}},n?()=>{n.call(this,i,e,this.state.colBorders)}:void 0)},setColVisibility(i,e){const{onSetColVisibility:t}=this.options;this.update({dirtyType:"options",state:n=>({colVisibility:{...n.colVisibility,[i]:e}})},t?()=>{t.call(this,i,e)}:void 0)}},onAddCol(i){const{colBorders:e}=this.state;e[i.name]!==void 0&&(i.border=e[i.name])},beforeLayout(i){const{colVisibility:e}=this.state;Object.keys(e).length&&i.cols&&(i.cols=i.cols.map(t=>(e[t.name]!==void 0&&(t={...t,hidden:!e[t.name]}),t)))},i18n:{zh_cn:{setDivider:"设置分割线",leftDivider:"左侧",rightDivider:"右侧",allDivider:"两侧",noDivider:"无",hideCol:"隐藏此列"},zh_tw:{setDivider:"設置分割線",leftDivider:"左側",rightDivider:"右側",allDivider:"兩側",noDivider:"無",hideCol:"隱藏此列"},en:{setDivider:"Set divider",leftDivider:"Left Side",rightDivider:"Right Side",allDivider:"Both Sides",noDivider:"No Divider",hideCol:"Hide this column"}}}),Jx="";function wh(i,e,t){if(t){if(typeof t=="object"){const n=t[i];return typeof n=="string"?n:typeof n=="object"&&n?n.realname:void 0}if(typeof t=="function")return t(i,e)}}function hm(i,e,t){let n;if(typeof i=="function"?n=i(e,t):typeof i=="object"&&(n=i[e]),n)return w(Ie,{className:"dtable-cell-icon",icon:n})}const um={name:"zentao",plugins:["group","checkable","nested",Lb,Rb,Gp,Ob,zb,jb],defaultOptions:{colHover:"header",rowHeight:36,striped:!1,responsive:"window,parent,.search-form,~document_layout",checkable:"auto",nested:"auto",width:"100%",footer:void 0,showToolbarOnChecked:!0,checkOnClickRow:!0,groupDivider:!0,preserveNested:!0,extraHeight:"+",height(i){var r;const e=(r=this.element)==null?void 0:r.closest(".modal-dialog"),t=y(e||"body");let n=this.options.extraHeight;typeof n=="string"&&(n[0]==="+"&&(n=(e?".modal-header,.modal-footer,.search-form,36,#featureBar,":"#header,#mainMenu,#mainNavbar,.search-form,")+n.slice(1)),n=n.split(",")),Array.isArray(n)||(n=[n]);const s=n.reduce((o,a)=>a?typeof a=="number"||/^\d+$/.test(a)?o+Number(a):o+(t.find(a).outerHeight()||0):o,0);return Math.min(i,window.innerHeight-(e?64:1)-s)}},options(i){var l;const{checkable:e,footToolbar:t,footPager:n,footer:s}=i;if(s===void 0){const c=[];if(e&&c.push("checkbox"),t){const d=Array.isArray(t)?{items:t}:t;c.push("toolbar"),d.btnProps=y.extend({btnType:"primary",size:"sm"},d.btnProps),i.footToolbar=d}e&&c.push("checkedInfo"),n&&c.push("flex","pager"),c.length&&(i.footer=c)}const r={"data-load":"table","data-selector":"dtable","data-target":i.id,...i.loadOptions},o=i.loadPartial||((l=this.parent||this.element)==null?void 0:l.closest(".modal"));o&&(r["data-partial"]=!0),n&&(n.btnProps=y.extend({type:"ghost",size:"sm"},n.btnProps),n.items&&n.items.forEach(c=>{c.type==="size-menu"?y.extend(!0,c,{itemProps:o?{...r,...c.itemProps}:{"data-app":"current",...c.itemProps},placement:"top"}):c.type==="link"&&y.extend(c,r)}));let{sortLink:a}=i;if(a&&(typeof a=="string"&&(a={url:a}),typeof a=="object"&&(a=y.extend(r,a)),i.sortLink=a),i.customCols){i.colResize===void 0&&(i.colResize=!0),i.sortCol===void 0&&(i.sortCol=!0);const c=()=>{this.trySaveColsSetting()};i.sortCol&&!i.onSortColEnd&&(i.onSortColEnd=c),i.colResize&&!i.on&&(i.onColResize=c),i.customCol===void 0&&(i.customCol=!0),i.customCol&&(i.onSetColBorder||(i.onSetColBorder=c),i.onSetColVisibility||(i.onSetColVisibility=c),i.canSetColVisibility||(i.canSetColVisibility=d=>{const u=this.getColInfo(d);return!u||u.side!=="center"?!1:this.layout.cols[u.side].list.length>1}))}return i},i18n:{zh_cn:{unassigned:"未指派"},zh_tw:{unassigned:"未指派"},en:{unassigned:"Unassigned"}},colTypes:{id:{width:60,fixed:"left",align:"center",sortType:!0,maxWidth:120},checkID:{width:80,fixed:"left",align:"left",sortType:!0,checkbox:!0,maxWidth:160},title:{width:.44,fixed:"left",align:"left",sortType:!0,flex:1,hint:!0,maxWidth:600},shortTitle:{width:.2,align:"left",sortType:!0,fixed:"left",checkbox:!0,flex:1,hint:!0,maxWidth:250},nestedTitle:{width:.5,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:650},shortNestedTitle:{width:.33,align:"left",sortType:!0,fixed:"left",flex:1,nestedToggle:!0,nestedIndent:20,hint:!0,maxWidth:300},status:{width:80,align:"center",sortType:!0,onRenderCell(i,{col:e,row:t}){var o,a;const n=(o=t.data)==null?void 0:o[e.name];let s,r;return typeof n=="string"?(s=n,r=(a=e.setting.statusMap)==null?void 0:a[n]):typeof n=="object"&&n&&({name:s,label:r}=n),i[0]=w("span",{class:`${e.setting.statusClassPrefix??"status-"}${s}`},r??s),i}},user:{width:80,align:"center",sortType:!0,onRenderCell(i,{col:e,row:t,value:n}){const{userMap:s=this.options.userMap,userJoiner:r=" "}=e.setting;if(Array.isArray(n))i[0]=n.map(o=>wh(o,t,s)).filter(Boolean).join(r);else{const o=wh(n,t,s);o!==void 0&&(i[0]=o)}return i}},assign:{width:108,align:"left",sortType:!0,cellClass:"px-1.5",onRenderCell(i,e){const{col:t,row:n,value:s}=e,{options:r}=this,{userMap:o=r.userMap,currentUser:a=r.currentUser,assignLink:l,unassignedText:c=r.unassignedText||this.i18n("unassigned")}=t.setting,d=!s,u=s==="closed",p=d?c:wh(s,n,o)??s;return i[0]=uh(l,e,[w("i",{className:"icon icon-hand-right"}),w("span",null,p)],{"data-toggle":u?void 0:"modal",className:`dtable-assign-btn${a===s?" is-me":""}${d?" is-unassigned":""}${u?" disabled":""}`}),i}},avatar:{width:44,align:"center",sortType:!0},avatarName:{width:108,align:"left",sortType:!0},avatarBtn:{width:108,align:"left",sortType:!0},category:{width:80,align:"center",flex:1,hint:!0},desc:{width:160,align:"left",flex:1,hint:!0},text:{width:136,align:"left",flex:1,hint:!0},icon:{width:52,align:"center",cellClass:"px-1",onRenderCell(i,{row:e,col:t,value:n}){const{iconRender:s}=t.setting,r=hm(s,n,e);return r&&(i[0]=r),i}},pri:{width:68,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(i,{col:e,value:t}){const{priList:n=this.options.priList||{}}=e.setting,s=n[t]??t;return i[0]=w(bp,{pri:t,text:s}),i}},severity:{width:92,align:"center",cellClass:"px-1",sortType:!0,onRenderCell(i,{col:e,value:t}){const{severityList:n=this.options.severityList||{}}=e.setting,s=n[t]??t;return i[0]=w(wp,{severity:t,text:s}),i}},burn:{width:88,align:"center",onRenderCell(i,{col:e}){const t=i[0];if(!t)return i;const{burn:n}=e.setting,s={data:t,className:"border-b",width:64,height:24,responsive:!1,...n};return i[0]=w(Mc,{...s}),i}},date:{width:96,align:"center",sortType:!0},time:{width:64,align:"center",sortType:!0},datetime:{width:128,align:"center",sortType:!0},progress:{width:64,align:"center",sortType:!0},money:{width:96,align:"right",sortType:!0},count:{width:92,align:"right",sortType:!0},number:{width:64,align:"center",sortType:!0,digits:-1},percent:{width:64,align:"center",sortType:!0,format(i){return typeof i=="string"&&i.endsWith("%")?i:`${i}%`}},actions:{minWidth:120,align:"left",fixed:"right"}},methods:{trySaveColsSetting(){this.data.saveColsSettingTimer&&clearTimeout(this.data.saveColsSettingTimer),this.data.saveColsSettingTimer=window.setTimeout(()=>{this.saveColsSetting(),this.data.saveColsSettingTimer=0},200)},getColsSetting(){const{colOrders:i,colsSizes:e,colBorders:t,colVisibility:n}=this.state,s={},r=(o,a)=>{const l=s[o];l?Object.assign(l,a):s[o]={id:o,...a}};return i&&Object.keys(i).forEach(o=>{r(o,{order:i[o]})}),e&&Object.keys(e).forEach(o=>{r(o,{extraWidth:e[o]})}),t&&Object.keys(t).forEach(o=>{r(o,{border:t[o]})}),n&&Object.keys(n).forEach(o=>{r(o,{show:n[o]})}),Object.values(s)},async saveColsSetting(){const i=this.getColsSetting();if(!i.length)return;const{saveFieldsUrl:e}=this.options.customCols||{};if(!e)return;const t=JSON.stringify(i);t!==this.data.lastSavedColsSetting&&(this.data.lastSavedColsSetting=t,await y.post(e,{fields:t}))}},onRenderCell(i,{row:e,col:t,value:n}){const{iconRender:s}=t.setting;if(s&&t.type!=="icon"){const r=hm(s,n,e);r&&i.push(r)}return i},onRender(){const{customCols:i}=this.options;if(!i)return;const{custom:e,setGlobal:t,reset:n,resetGlobal:s}=i;return{children:w("div",{className:"absolute gap-1.5 pr-1.5 top-0 right-0 z-20 row items-center",style:"background:var(--dtable-header-bg);height: calc(var(--dtable-header-height) - 2px)"},w("div",{className:"w-px border-l h-5"}),w("a",{className:"btn ghost square size-sm rounded","data-toggle":"dropdown","data-placement":"bottom-end"},w("i",{class:"icon icon-cog-outline"})),w("menu",{class:"dropdown-menu menu"},e&&w("li",{class:"menu-item"},w("a",{href:e.url,"data-toggle":"modal"},e.text)),t&&w("li",{class:"menu-item"},w("a",{class:"ajax-submit",href:t.url},t.text)),n&&w("li",{class:"menu-item"},w("a",{class:"ajax-submit",href:n.url},n.text)),s&&w("li",{class:"menu-item"},w("a",{class:"ajax-submit",href:s.url},s.text))))}},onUpdated(){const{updateCheckedRows:i}=this.options;i&&i!==this.data.updateCheckedRows&&(this.data.updateCheckedRows=i,this.toggleCheckRows(i,!0))}},Bb=Ke(um,{buildIn:!0}),ek="",Js=i=>`${i.col.name}[${i.row.id}]`,er=(i,e,t,n="value")=>{const s=Js(e),r=i.data.formData[s]??e.value;return{[n]:r,className:"form-control",onChange:o=>i.setFormData(s,o instanceof Event?o.currentTarget.value:o),...t}};function Ch(i){const e=Js(i);let t=this.data.pickRefs.get(e);return t||(t=fe(),this.data.pickRefs.set(e,t)),er(this,i,{ref:t},"defaultValue")}const Hb={input:{component:"input",props(i){return er(this,i,{type:"text"})}},select:{component:function(i){const{items:e,defaultValue:t,...n}=i;return w("select",{...n},e.map(s=>w("option",{key:s.value,value:s.value},s.text)))},props(i){return er(this,i)}},picker:{component:Kt,props:Ch},datePicker:{component:Vi,props(i){return er(this,i,{className:"flex-auto",icon:"calendar"},"defaultValue")}},timePicker:{component:bo,props(i){return er(this,i,{className:"flex-auto",icon:"time"},"defaultValue")}},priPicker:{component:Ks,props:Ch},severityPicker:{component:ih,props:Ch}},Wb=Ke({name:"form",plugins:[zp],data(){return{formData:{},pickRefs:new Map}},colTypes:{control:{custom(i){let{control:e}=i.col.setting;if(typeof e=="function"&&(e=e.call(this,i)),!e)return;typeof e=="string"&&(e={type:e});const{controlMap:t}=this.options,{type:n}=e,s={name:Js(i)};let r;if([Hb[n],t==null?void 0:t[n],e].forEach(o=>{if(o){const{props:a}=o;a&&y.extend(s,typeof a=="function"?a.call(this,i):a),r=o.component||r}}),!!r)return{component:r,props:s}}}},methods:{setFormData(i,e,t){var r,o;const{formData:n}=this.data;n[i]=e,t||(r=this.options.onFormChange)==null||r.call(this,i,e,n);const s=this.data.pickRefs.get(i);s&&((o=s.current)==null||o.setValue(e))},getFormData(i=!0){let{formData:e}=this.data;if(!i)return e;const{rows:t,cols:n}=this.layout,s=t.reduce((r,o)=>(n.list.forEach(a=>{var l;a.setting.control&&(r[Js({col:a,row:o})]=(l=o.data)==null?void 0:l[a.name])}),r),{});return e=y.extend(s,e),i===!0?e:e[i]},resetFormData(){this.data.formData={};const{rows:i,cols:e}=this.layout;i.forEach(t=>{e.list.forEach(n=>{var r,o;if(!n.setting.control)return;const s=this.data.pickRefs.get(Js({col:n,row:t}));s&&((o=s.current)==null||o.setValue(((r=t.data)==null?void 0:r[n.name])??""))})})}}}),nk="",ik="",sk="",rk="",ok="",ak="",lk="",ck="",hk="",uk="",dk="",fk="",pk="",mk="",gk="",yk="";var dm=11;function Ub(i,e){var t=e.attributes,n,s,r,o,a;if(!(e.nodeType===dm||i.nodeType===dm)){for(var l=t.length-1;l>=0;l--)n=t[l],s=n.name,r=n.namespaceURI,o=n.value,r?(s=n.localName||s,a=i.getAttributeNS(r,s),a!==o&&(n.prefix==="xmlns"&&(s=n.name),i.setAttributeNS(r,s,o))):(a=i.getAttribute(s),a!==o&&i.setAttribute(s,o));for(var c=i.attributes,d=c.length-1;d>=0;d--)n=c[d],s=n.name,r=n.namespaceURI,r?(s=n.localName||s,e.hasAttributeNS(r,s)||i.removeAttributeNS(r,s)):e.hasAttribute(s)||i.removeAttribute(s)}}var ca,Vb="http://www.w3.org/1999/xhtml",kt=typeof document>"u"?void 0:document,Kb=!!kt&&"content"in kt.createElement("template"),qb=!!kt&&kt.createRange&&"createContextualFragment"in kt.createRange();function Gb(i){var e=kt.createElement("template");return e.innerHTML=i,e.content.childNodes[0]}function Yb(i){ca||(ca=kt.createRange(),ca.selectNode(kt.body));var e=ca.createContextualFragment(i);return e.childNodes[0]}function Qb(i){var e=kt.createElement("body");return e.innerHTML=i,e.childNodes[0]}function Xb(i){return i=i.trim(),Kb?Gb(i):qb?Yb(i):Qb(i)}function ha(i,e){var t=i.nodeName,n=e.nodeName,s,r;return t===n?!0:(s=t.charCodeAt(0),r=n.charCodeAt(0),s<=90&&r>=97?t===n.toUpperCase():r<=90&&s>=97?n===t.toUpperCase():!1)}function Zb(i,e){return!e||e===Vb?kt.createElement(i):kt.createElementNS(e,i)}function Jb(i,e){for(var t=i.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}function xh(i,e,t){i[t]!==e[t]&&(i[t]=e[t],i[t]?i.setAttribute(t,""):i.removeAttribute(t))}var fm={OPTION:function(i,e){var t=i.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(i.hasAttribute("selected")&&!e.selected&&(i.setAttribute("selected","selected"),i.removeAttribute("selected")),t.selectedIndex=-1)}xh(i,e,"selected")},INPUT:function(i,e){xh(i,e,"checked"),xh(i,e,"disabled"),i.value!==e.value&&(i.value=e.value),e.hasAttribute("value")||i.removeAttribute("value")},TEXTAREA:function(i,e){var t=e.value;i.value!==t&&(i.value=t);var n=i.firstChild;if(n){var s=n.nodeValue;if(s==t||!t&&s==i.placeholder)return;n.nodeValue=t}},SELECT:function(i,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,s=i.firstChild,r,o;s;)if(o=s.nodeName&&s.nodeName.toUpperCase(),o==="OPTGROUP")r=s,s=r.firstChild;else{if(o==="OPTION"){if(s.hasAttribute("selected")){t=n;break}n++}s=s.nextSibling,!s&&r&&(s=r.nextSibling,r=null)}i.selectedIndex=t}}},tr=1,pm=11,mm=3,gm=8;function Hn(){}function ew(i){if(i)return i.getAttribute&&i.getAttribute("id")||i.id}function tw(i){return function(t,n,s){if(s||(s={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var r=n;n=kt.createElement("html"),n.innerHTML=r}else n=Xb(n);else n.nodeType===pm&&(n=n.firstElementChild);var o=s.getNodeKey||ew,a=s.onBeforeNodeAdded||Hn,l=s.onNodeAdded||Hn,c=s.onBeforeElUpdated||Hn,d=s.onElUpdated||Hn,u=s.onBeforeNodeDiscarded||Hn,p=s.onNodeDiscarded||Hn,g=s.onBeforeElChildrenUpdated||Hn,b=s.skipFromChildren||Hn,C=s.addChild||function(ce,J){return ce.appendChild(J)},S=s.childrenOnly===!0,x=Object.create(null),D=[];function A(ce){D.push(ce)}function B(ce,J){if(ce.nodeType===tr)for(var we=ce.firstChild;we;){var ve=void 0;J&&(ve=o(we))?A(ve):(p(we),we.firstChild&&B(we,J)),we=we.nextSibling}}function H(ce,J,we){u(ce)!==!1&&(J&&J.removeChild(ce),p(ce),B(ce,we))}function G(ce){if(ce.nodeType===tr||ce.nodeType===pm)for(var J=ce.firstChild;J;){var we=o(J);we&&(x[we]=J),G(J),J=J.nextSibling}}G(t);function Y(ce){l(ce);for(var J=ce.firstChild;J;){var we=J.nextSibling,ve=o(J);if(ve){var Ee=x[ve];Ee&&ha(J,Ee)?(J.parentNode.replaceChild(Ee,J),ee(Ee,J)):Y(J)}else Y(J);J=we}}function Z(ce,J,we){for(;J;){var ve=J.nextSibling;(we=o(J))?A(we):H(J,ce,!0),J=ve}}function ee(ce,J,we){var ve=o(J);if(ve&&delete x[ve],!we){var Ee=c(ce,J);if(Ee===!1||(Ee instanceof HTMLElement&&(ce=Ee),i(ce,J),d(ce),g(ce,J)===!1))return}ce.nodeName!=="TEXTAREA"?he(ce,J):fm.TEXTAREA(ce,J)}function he(ce,J){var we=b(ce,J),ve=J.firstChild,Ee=ce.firstChild,Vn,pt,vn,bn,wt;e:for(;ve;){for(bn=ve.nextSibling,Vn=o(ve);!we&&Ee;){if(vn=Ee.nextSibling,ve.isSameNode&&ve.isSameNode(Ee)){ve=bn,Ee=vn;continue e}pt=o(Ee);var Kn=Ee.nodeType,sn=void 0;if(Kn===ve.nodeType&&(Kn===tr?(Vn?Vn!==pt&&((wt=x[Vn])?vn===wt?sn=!1:(ce.insertBefore(wt,Ee),pt?A(pt):H(Ee,ce,!0),Ee=wt,pt=o(Ee)):sn=!1):pt&&(sn=!1),sn=sn!==!1&&ha(Ee,ve),sn&&ee(Ee,ve)):(Kn===mm||Kn==gm)&&(sn=!0,Ee.nodeValue!==ve.nodeValue&&(Ee.nodeValue=ve.nodeValue))),sn){ve=bn,Ee=vn;continue e}pt?A(pt):H(Ee,ce,!0),Ee=vn}if(Vn&&(wt=x[Vn])&&ha(wt,ve))we||C(ce,wt),ee(wt,ve);else{var de=a(ve);de!==!1&&(de&&(ve=de),ve.actualize&&(ve=ve.actualize(ce.ownerDocument||kt)),C(ce,ve),Y(ve))}ve=bn,Ee=vn}Z(ce,Ee,pt);var lr=fm[ce.nodeName];lr&&lr(ce,J)}var X=t,se=X.nodeType,ge=n.nodeType;if(!S){if(se===tr)ge===tr?ha(t,n)||(p(t),X=Jb(t,Zb(n.nodeName,n.namespaceURI))):X=n;else if(se===mm||se===gm){if(ge===se)return X.nodeValue!==n.nodeValue&&(X.nodeValue=n.nodeValue),X;X=n}}if(X===n)p(t);else{if(n.isSameNode&&n.isSameNode(X))return;if(ee(X,n,S),D)for(var be=0,Me=D.length;be<Me;be++){var Pe=x[D[be]];Pe&&H(Pe,Pe.parentNode,!1)}}return!S&&X!==t&&t.parentNode&&(X.actualize&&(X=X.actualize(t.ownerDocument||kt)),t.parentNode.replaceChild(X,t)),X}}var nw=tw(Ub);function kh(i,e,t={}){const n=y(i);if(typeof e=="string"&&!e.length){t.childrenOnly?n.empty():n.replaceWith(document.createTextNode(""));return}if(e===null){n.remove();return}const s="z-zui-inited",{getNodeKey:r,onElUpdated:o,onBeforeElUpdated:a,onBeforeElChildrenUpdated:l,executeScript:c=!0,...d}=t,u=new Set;nw(i,e,{...d,getNodeKey:function(p){const g=r==null?void 0:r(p);if(g!==void 0)return g;if(p instanceof Element&&p.tagName==="BODY")return p.tagName;if(p.getAttribute)return p.getAttribute("zui-key")??p.id},onBeforeElUpdated(p,g){const b=a==null?void 0:a(p,g);if(b!==void 0)return b;if(p.classList.contains("preserve-on-morph"))return!1;if(p.classList.contains("no-morph")||p.hasAttribute("zui-create")!==g.hasAttribute("zui-create")||p.tagName==="IFRAME"&&!p.classList.contains("morph")||p.tagName==="ZEN-EDITOR"||p.tagName.includes("-")&&p.isEqualNode(g))return p.replaceWith(g),!1;if(p.tagName==="SCRIPT"&&c){const S=g.textContent;S&&y(p).addClass("zui-js-run").parent().runJS(S)}const C=y(p);if((p.hasAttribute("zui-create")||p.hasAttribute("data-zui"))&&(!g.childNodes.length||C.zui()instanceof _e)){if(p.isEqualNode(g))u.add(p);else{let S=!0;Array.from(g.attributes).forEach(x=>{const{name:D,value:A}=x;D==="class"?C.addClass(A):p.getAttribute(D)!==A&&((D==="zui-create"||D.startsWith("zui-create-"))&&(S=!1),p.setAttribute(D,A))}),S&&u.add(p)}return!1}return!0},onBeforeElChildrenUpdated(p,g){const b=l==null?void 0:l(p,g);return b!==void 0?b:p.classList.contains("no-morph")?!1:!p.tagName.includes("-")},onElUpdated(p){if(o==null||o(p),p.tagName!=="SCRIPT"){p.hasAttribute(s)&&p.removeAttribute(s);const g=ms(p);Object.values(g).forEach(b=>{if(b instanceof ze){const{ATTR_KEY:C,DATA_KEY:S}=b.constructor;p.setAttribute(C,""),p.setAttribute(S,`${b.gid}`)}})}}}),n.zuiInit({update:"reset",beforeCreate:p=>!u.has(p)}),u.forEach(p=>{y(p).trigger("skipMorph")}),c&&n.find("script:not(.zui-js-run)").each((p,g)=>{const b=g.textContent;b&&n.runJS(b)})}y.fn.morph=function(i,e){return this.each((t,n)=>{kh(n,i,e)})},y.fn.morphInner=function(i,e){return this.each((t,n)=>{kh(n,i,{...e,childrenOnly:!0})})};function Sh(i){const e=y(i);e.css({minHeight:0}).css({minHeight:Math.max(32,e[0].scrollHeight)})}y.fn.autoHeight=function(){return this.each(function(){const i=y(this);i.data("auto-height")||i.on("input paste change",function(){Sh(this)}).data("auto-height",!0),Sh(i),setTimeout(()=>Sh(i),100)})},y.fn._append=y.fn.append,y.fn._prepend=y.fn.prepend,y.fn._before=y.fn.before,y.fn._after=y.fn.after,y.fn._html=y.fn.html;function ua(i,e){return typeof e=="string"&&(e.includes("zui-create")||e.includes("zui-init"))&&i.zuiInit(),i}function iw(i){return!!i&&i.nodeType===1}y.extend(y.fn,{append(...i){return ua(this._append(...i),i.join(""))},prepend(...i){return ua(this._prepend(...i),i.join(""))},before(...i){const e=this.parent();return this._before(...i),ua(e,i.join("")),this},after(...i){const e=this.parent();return this._after(...i),ua(e,i.join("")),this},html(i,e){if(!arguments.length)return this[0]&&this[0].innerHTML;if(i===void 0)return this;const t=/<script[\s>]/.test(i);return typeof e=="boolean"&&(e={zuiInit:e}),this.each((n,s)=>{iw(s)&&(t?y(s).empty()._append(i):s.innerHTML=i,(e==null?void 0:e.zuiInit)!==!1&&y(s).zuiInit())})}});const sw=Object.freeze(Object.defineProperty({__proto__:null,createLink:yn,parseLink:ep,parseUrlParams:Jf},Symbol.toStringTag,{value:"Module"}));window.$&&Object.assign(window.$,{...sw,parseRawData:ll}),N.$=y,N.Ajax=ps,N.AjaxForm=ta,N.Avatar=Gl,N.BUILD=1730965283023,N.BUILD_MODE=lg,N.BatchForm=pv,N.BtnGroup=Yl,N.Burn=Ec,N.Bus=sd,N.Card=sa,N.CardList=lh,N.ColorPicker=dc,N.CommonList=xs,N.Component=ze,N.ComponentFromReact=_e,N.Computed=ii,N.ContextMenu=ts,N.CustomContent=me,N.CustomRender=zl,N.DTable=ns,N.Dashboard=hh,N.DataHub=Xd,N.DatePicker=Co,N.DatetimePicker=xo,N.Dexie=Es,N.DocApp=ea,N.Draggable=Is,N.Dropdown=nn,N.Dropmenu=Zc,N.ECharts=up,N.Editor=Xo,N.Entity=f_,N.FileList=Jc,N.FileSelector=Do,N.FormGrid=mp,N.FormSetting=pp,N.Gantt=gp,N.GlobalSearch=na,N.Graph=vp,N.HElement=Fe,N.HElementSignals=Ol,N.HistoryPanel=Vs,N.HtmlContent=fn,N.Icon=Ie,N.ImageSelector=Io,N.ImgCutter=nh,N.Kanban=Qs,N.KanbanList=Xs,N.List=Ss,N.Mammoth=Bv,N.Menu=no,N.Messager=An,N.Modal=Ue,N.ModalBase=qi,N.ModalTrigger=Yi,N.Moveable=Ns,N.Nav=wc,N.NestedList=Ts,N.PageEditor=Zo,N.Pager=Cc,N.Pick=Po,N.Picker=Lo,N.Popover=Et,N.PopoverPanel=No,N.Portal=Fl,N.PriPicker=sh,N.ProgressCircle=oo,N.PropModSymbol=p_,N.PropModification=m_,N.RangeSet=u_,N.ReactComponent=pe,N.SearchBox=Ro,N.SearchForm=Ft,N.SearchMenu=io,N.SearchTree=$c,N.SeverityPicker=rh,N.Sidebar=zo,N.Signal=it,N.Sortable=ao,N.SortableList=lo,N.SortableTree=co,N.Sticky=Sl,N.TIME_DAY=Ei,N.Tabs=Zs,N.TimePicker=wo,N.Toolbar=Tc,N.Tooltip=Zi,N.Tree=Fo,N.Upload=jo,N.UploadImgs=Dc,N.UserAvatar=ia,N.VERSION=ag,N.Zinbar=ah,N.addDate=ud,N.addQueryToSearchForm=kp,N.ajaxSubmit=pi,N.batch=Yr,N.bindCommands=Ur,N.bindHotkeys=bl,N.bus=Xt,N.cash=y,N.classes=V,N.clearData=ey,N.cmp=d_,N.computed=Ge,N.convertBytes=$n,N.cookie=Kd,N.create=xl,N.createDate=We,N.createFormData=Mr,N.createPortal=Bd,N.createRef=fe,N.deepCall=Tn,N.deepGet=fs,N.deepGetPath=Fu,N.defineFn=my,N.delay=gs,N.disableScroll=nd,N.dom=Dy,N.downloadFile=jr,N.effect=dn,N.enterFullscreen=ld,N.evalValue=si,N.executeCommand=Il,N.executeCommands=fd,N.fetchData=zt,N.form=Wb,N.formatBytes=dt,N.formatDate=ht,N.formatDateSpan=ky,N.formatString=Ce,N.getClassList=al,N.getComponent=_s,N.getFullscreenElement=Br,N.getHotkeysMap=vl,N.getReactComponent=zd,N.getUniqueCode=Dl,N.getZData=Ni,N.h=w,N.hotkeys=fy,N.i18n=Ne,N.initGlobalComponents=kl,N.isDiff=Er,N.isFetchSetting=ol,N.isSameDay=Mn,N.isSameMonth=Tl,N.isSameWeek=by,N.isSameYear=vs,N.isToday=wy,N.isTomorrow=xy,N.isValidDate=$l,N.isYesterday=Cy,N.liveQuery=l_,N.mapFormData=fp,N.mergeProps=xe,N.mergeRanges=c_,N.morph=kh,N.nextGid=ft,N.parseCommand=Wr,N.parseCommands=dd,N.parseRawData=ll,N.parseSize=ai,N.processSubmitResult=eh,N.rangesOverlap=h_,N.reactComponents=Rl,N.registerComponent=cd,N.registerGlobalListener=id,N.registerReactComponent=Xe,N.removeUndefinedProps=gl,N.render=oi,N.renderCustomContent=Jr,N.renderCustomResult=Fd,N.replacePrefix=g_,N.setZData=cl,N.shareData=Hu,N.showCommentModal=th,N.signal=It,N.store=Ze,N.storeData=Ar,N.takeData=ms,N.toCssSize=Be,N.toggleFullscreen=Cl,N.toggleSearchForm=oh,N.unbindCommands=Vr,N.unbindHotkeys=wl,N.untracked=Py,N.updateSearchForm=xp,N.zentao=Bb,N.zentaoPlugin=um,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
