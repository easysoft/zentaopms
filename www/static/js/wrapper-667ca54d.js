var se=Object.defineProperty,ae=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var I=(e,t,n)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))de.call(t,n)&&I(e,n,t[n]);if(W)for(var n of W(t))le.call(t,n)&&I(e,n,t[n]);return e},P=(e,t)=>ae(e,ce(t));var z=(e,t,n)=>new Promise((i,o)=>{var s=d=>{try{c(n.next(d))}catch(l){o(l)}},r=d=>{try{c(n.throw(d))}catch(l){o(l)}},c=d=>d.done?i(d.value):Promise.resolve(d.value).then(s,r);c((n=n.apply(e,t)).next())});import{g as G}from"./storage-f100d103.js";import{az as C,aH as he,j as O,d as x,o as w,m as g,A,ad as b,f as a,aI as V,aJ as R,aK as k,aL as q,aM as U,c as _,aN as j,aO as K,L as X,F as Y,v as f,a5 as F,x as J,ab as L,z as Q,aP as y,a6 as S,e as N,aQ as H,aR as ue,S as we}from"./index.js";import{u as Z,c as pe,F as ge,C as $}from"./chartEditStore-b43ccce8.js";import{t as E,F as ve,u as fe,f as ye}from"./index-6dfe8fa9.js";import"./plugin-89d380c3.js";import"./icon-bf69a156.js";import"./chartLayoutStore-bba11018.js";import"./tables_list-16bd57ab.js";/* empty css                                                                */import"./SettingItemBox-fa88acd0.js";import"./CollapseItem-9c1330df.js";import"./useTargetData.hook-3477a16d.js";const _e=(e,t,n,i)=>{const o=e,s=t,r={width:1,height:1},c=parseFloat((o/s).toFixed(5)),d=()=>{const v=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(v>c?(r.width=parseFloat((window.innerHeight*c/o).toFixed(5)),r.height=parseFloat((window.innerHeight/s).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`):(r.height=parseFloat((window.innerWidth/c/s).toFixed(5)),r.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`),i&&i(r))},l=E(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},me=(e,t,n,i)=>{const o=e,s=t,r={width:1,height:1},c=parseFloat((o/s).toFixed(5)),d=()=>{n&&(r.height=parseFloat((window.innerWidth/c/s).toFixed(5)),r.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`,i&&i(r))},l=E(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Ce=(e,t,n,i)=>{const o=e,s=t,r={height:1,width:1},c=parseFloat((o/s).toFixed(5)),d=()=>{n&&(r.width=parseFloat((window.innerHeight*c/o).toFixed(5)),r.height=parseFloat((window.innerHeight/s).toFixed(5)),n.style.transform=`scale(${r.width}, ${r.height})`,i&&i(r))},l=E(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Se=(e,t,n,i)=>{const o={width:1,height:1},s=()=>{n&&(o.width=parseFloat((window.innerWidth/e).toFixed(5)),o.height=parseFloat((window.innerHeight/t).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,i&&i(o))},r=E(()=>{s()},200);return{calcRate:s,windowResize:()=>{window.addEventListener("resize",r)},unWindowResize:()=>{window.removeEventListener("resize",r)}}},ee={},M={echarts:he},te=e=>{if(!e.events)return{};const t={};for(const o in e.events.baseEvent){const s=e.events.baseEvent[o];s&&(t[o]=Re(s))}const n=e.events.advancedEvents||{},i={[C.VNODE_BEFORE_MOUNT](o){ee[e.id]=o.component;const s=(n[C.VNODE_BEFORE_MOUNT]||"").trim();D(s,o)},[C.VNODE_MOUNTED](o){const s=(n[C.VNODE_MOUNTED]||"").trim();D(s,o)}};return u(u({},t),i)};function Re(e){try{return new Function(`
      return (
        async function(mouseEvent){
          ${e}
        }
      )`)()}catch(t){console.error(t)}}function D(e,t){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(M).join()}} = node_modules;
          ${e}
        }
      )`)().bind(t==null?void 0:t.component)(t,ee,M)}catch(n){console.error(n)}}const ne=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),Fe=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),xe=(e,t,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h-t:e.h-t}px`}:{},oe=e=>({display:e.hide?"none":"block"}),ie=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},Ee=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return u({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},t)};const ze=x({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(w(!0),g(Y,null,A(e.groupData.groupList,i=>(w(),g("div",{class:b(["chart-item",a(V)(i.styles.animations)]),key:i.id,style:R(u(u(u(u(u(u({},a(ne)(i.attr,e.groupIndex)),a(k)(i.styles)),a(q)(i.styles)),a(oe)(i.status)),a(ie)(i.preview)),a(U)(i.styles)))},[(w(),_(X(i.chartConfig.chartKey),j({id:i.id,chartConfig:i,themeSetting:e.themeSetting,themeColor:e.themeColor,style:u({},a(Fe)(i.attr))},K(a(te)(i))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var $e=O(ze,[["__scopeId","data-v-3933053a"]]);const Le=x({__name:"index",setup(e){const t=f(!1),{initDataPond:n,clearMittDataPondMap:i}=fe(),o=Z(),s=l=>{var p;return!!((p=l.chartConfig.filters)!=null&&p.length)},r=l=>{var T;const p=(T=l.chartConfig.filters)==null?void 0:T.map(m=>m.type==ge.DATE&&m.from!="query"?221:450);if(!(p!=null&&p.length))return 0;const h=p==null?void 0:p.reduce((m,re)=>m+re+8),v=h?Math.ceil(h/l.attr.w):0;return v*24+(v-1)*8+16},c=F(()=>o.editCanvasConfig.chartThemeSetting),d=F(()=>{const l=o.editCanvasConfig.chartThemeColor;return pe[l]});return i(),J(()=>{n(o.requestGlobalConfig)}),(l,p)=>(w(!0),g(Y,null,A(a(o).componentList,(h,v)=>(w(),g("div",{key:h.id,class:"chart-item",style:R(u(u(u(u(u(u({},a(ne)(h.attr,v)),a(k)(h.styles)),a(q)(h.styles)),a(oe)(h.status)),a(ie)(h.preview)),a(U)(h.styles)))},[s(h)?(w(),_(a(ve),{key:0,class:"filter-content",componentIdx:h.id,attr:h.attr,filters:h.chartConfig.filters,type:h.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):L("",!0),Q("div",{class:b(a(V)(h.styles.animations))},[h.isGroup?(w(),_(a($e),{key:0,groupData:h,groupIndex:v,themeSetting:a(c),themeColor:a(d)},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(w(),_(X(h.chartConfig.chartKey),j({key:1,id:h.id,chartConfig:h,themeSetting:a(c),themeColor:a(d),style:u({},a(xe)(h.attr,r(h))),scrollMode:t.value?"manual":"auto"},K(a(te)(h))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4))),128))}});var B=O(Le,[["__scopeId","data-v-ca8a492c"]]);const Oe=e=>{const t=f(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const i=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,ye(o.chartConfig))};e.componentList.forEach(o=>z(void 0,null,function*(){o.isGroup?o.groupList.forEach(s=>{i(s)}):i(o)})),t.value=!0}},200);return{show:t}},be=e=>{const t=f(),n=f(),i=f(e.editCanvasConfig.width),o=f(e.editCanvasConfig.height);return J(()=>{switch(e.editCanvasConfig.previewScaleType){case y.FIT:(()=>{const{calcRate:s,windowResize:r,unWindowResize:c}=_e(i.value,o.value,n.value);s(),r(),S(()=>{c()})})();break;case y.SCROLL_Y:(()=>{const{calcRate:s,windowResize:r,unWindowResize:c}=me(i.value,o.value,n.value,d=>{const l=t.value;l.style.width=`${i.value*d.width}px`,l.style.height=`${o.value*d.height}px`});s(),r(),S(()=>{c()})})();break;case y.SCROLL_X:(()=>{const{calcRate:s,windowResize:r,unWindowResize:c}=Ce(i.value,o.value,n.value,d=>{const l=t.value;l.style.width=`${i.value*d.width}px`,l.style.height=`${o.value*d.height}px`});s(),r(),S(()=>{c()})})();break;case y.FULL:(()=>{const{calcRate:s,windowResize:r,unWindowResize:c}=Se(i.value,o.value,n.value);s(),r(),S(()=>{c()})})();break}}),{entityRef:t,previewRef:n}},ke=e=>{const t=Z();t.requestGlobalConfig=e[$.REQUEST_GLOBAL_CONFIG],t.editCanvasConfig=e[$.EDIT_CANVAS_CONFIG],t.componentList=e[$.COMPONENT_LIST]};const Te=x({__name:"index",setup(e){let t=G();const n=F(()=>u(u({},Ee(t.editCanvasConfig)),k(t.editCanvasConfig))),i=F(()=>{const c=t.editCanvasConfig.previewScaleType;return c===y.SCROLL_Y||c===y.SCROLL_X});ke(t);const{entityRef:o,previewRef:s}=be(t),{show:r}=Oe(t);return(c,d)=>(w(),g("div",{class:b(`go-preview ${a(t).editCanvasConfig.previewScaleType}`)},[a(i)?(w(),g("div",{key:0,ref_key:"entityRef",ref:o,class:"go-preview-entity"},[Q("div",{ref_key:"previewRef",ref:s,class:"go-preview-scale"},[a(r)?(w(),g("div",{key:0,style:R(a(n))},[N(a(B))],4)):L("",!0)],512)],512)):(w(),g("div",{key:1,ref_key:"previewRef",ref:s,class:"go-preview-scale"},[a(r)?(w(),g("div",{key:0,style:R(a(n))},[N(a(B))],4)):L("",!0)],512))],2))}});var We=O(Te,[["__scopeId","data-v-21ad7af6"]]);const Xe=x({__name:"wrapper",setup(e){let t=f(Date.now());return[H.JSON,H.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,i=>z(this,null,function*(){const o=yield G();ue(we.GO_CHART_STORAGE_LIST,[P(u({},i.detail),{id:o.id})]),t.value=Date.now()}))}),(n,i)=>(w(),_(We,{key:a(t)}))}});export{Xe as default};
